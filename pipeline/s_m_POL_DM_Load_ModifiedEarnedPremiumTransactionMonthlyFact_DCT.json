{
    "name": "s_m_POL_DM_Load_ModifiedEarnedPremiumTransactionMonthlyFact_DCT",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DM_Load_ModifiedEarnedPremiumTransactionMonthl_00",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_WC_DirectPremium AS (\n\tDECLARE @SELECTION_START_TS AS DATETIME,\r\n\t@MIN_START_CLNDR_ID AS INT\r\n\t\r\n\tSELECT @MIN_START_CLNDR_ID = MIN(clndr_id) FROM calendar_dim WHERE clndr_date >= '@{pipeline().parameters.SELECTION_START_TS}'\r\n\t\r\n\t\r\n\tSELECT a.AnnualStatementLineDimID, \r\n\ta.AnnualStatementLineProductCodeDimID,\r\n\ta.AgencyDimID,\r\n\ta.PolicyDimID,\r\n\ta.ContractCustomerDimID,\r\n\ta.RiskLocationDimID,\r\n\ta.PremiumTransactionTypeDimID, \r\n\ta.PremiumTransactionEnteredDateID, \r\n\ta.PremiumTransactionEffectiveDateID, \r\n\ta.PremiumTransactionExpirationDateID, \r\n\ta.PremiumTransactionBookedDateID, \r\n\ta.PremiumTransactionRunDateID, \r\n\ta.MonthlyChangeinDirectEarnedPremium,\r\n\ta.InsuranceReferenceDimId,\r\n\ta.EDWPremiumMasterCalculationPKId, \r\n\ta.CoverageDetailDimId, \r\n\ta.InsuranceReferenceCoverageDimId, \r\n\ta.CoverageCancellationDateId,\r\n\t'0' as GeneratedRecordIndicator,\r\n\t'Direct' as ModifiedPremiumType,\r\n\ta.EDWEarnedPremiumMonthlyCalculationPKID\r\n\tFROM\r\n\t@{pipeline().parameters.TARGET_TABLE_OWNER}.EarnedPremiumTransactionMonthlyFact a\r\n\tINNER JOIN  @{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransactionTypeDim pttd\r\n\ton a.PremiumTransactionTypeDimID=pttd.PremiumTransactionTypeDimID and pttd.PremiumTypeCode='D'\r\n\t@{pipeline().parameters.WHERE_EPTMF_SINCE_LAST_LOAD} \r\n\tINNER JOIN  @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceDim i \r\n\ton a.InsuranceReferenceDimId =i.InsuranceReferenceDimId  and InsuranceReferenceLineOfBusinessAbbreviation ='WC'\r\n\tINNER JOIN  @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim pd\r\n\ton a.PolicyDimID = pd.pol_dim_id \r\n\tAND pd.pol_sym = '000'\r\n\t@{pipeline().parameters.JOIN_POLICY_LIST_IL}\n),\nEXP_DirectPremium AS (\n\tSELECT\n\tEDWPremiumMasterCalculationPKId,\n\tPremiumTransactionEnteredDateID,\n\tPremiumTransactionEffectiveDateID,\n\tPremiumTransactionRunDateID,\n\tAnnualStatementLineDimID,\n\tAnnualStatementLineProductCodeDimID,\n\tAgencyDimID,\n\tPolicyDimID,\n\tContractCustomerDimID,\n\tRiskLocationDimID,\n\tPremiumTransactionTypeDimID,\n\tInsuranceReferenceDimId,\n\tInsuranceReferenceCoverageDimId,\n\tCoverageDetailDimId,\n\tPremiumTransactionBookedDateID,\n\tPremiumTransactionExpirationDateID,\n\tCoverageCancellationDateId,\n\tGeneratedRecordIndicator,\n\tMonthlyChangeinDirectEarnedPremium,\n\tModifiedPremiumType,\n\tEDWEarnedPremiumMonthlyCalculationPKID\n\tFROM SQ_WC_DirectPremium\n),\nSQ_WC_ModifiedPremium AS (\n\t--SQ_WC_ModifiedPremium \r\n\tSELECT WEMP.SourceSystemID, \r\n\tWEMP.PolicyAKID, \r\n\tWEMP.StatisticalCoverageAKID, \r\n\tWEMP.PremiumTransactionAKID, \r\n\tWNMP.PremiumMasterCalculationId, \r\n\tWEMP.StatisticalCoverageCancellationDate, \r\n\tWEMP.PremiumTransactionEnteredDate, \r\n\tWEMP.PremiumTransactionEffectiveDate, \r\n\tWEMP.PremiumTransactionExpirationDate, \r\n\tWEMP.PremiumTransactionBookedDate, \r\n\tWEMP.PremiumTransactionCode, \r\n\tWEMP.PremiumType, \r\n\tWEMP.ReasonAmendedCode, \r\n\tWEMP.EarnedPremium, \r\n\tWEMP.ChangeInEarnedPremium, \r\n\tWEMP.UnearnedPremium, \r\n\tWEMP.ChangeInUnearnedPremium, \r\n\tisnull(PRODUCT.ProductCode, '000') as ProductCode, \r\n\tWEMP.AnnualStatementLineCode, \r\n\tWEMP.SubAnnualStatementLineCode, \r\n\tWEMP.NonSubAnnualStatementLineCode, \r\n\tWEMP.AnnualStatementLineProductCode, \r\n\tIsnull(InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessCode, '000') as LineOfBusinessCode, \r\n\tIsnull(PolicyOffering.PolicyOfferingCode, '000') as PolicyOfferingCode, \r\n\tWEMP.RunDate, \r\n\tisnull(SPC.StrategicProfitCenterCode, '6') as StrategicProfitCenterCode, \r\n\tisnull(EGP.EnterpriseGroupCode, '1') as EnterpriseGroupCode, \r\n\tisnull(IRLE.InsuranceReferenceLegalEntityCode, '1') as InsuranceReferenceLegalEntityCode, \r\n\tisnull(ISS.InsuranceSegmentCode, 'N/A') as InsuranceSegmentCode, \r\n\t'N/A' as RiskUnitGroup, \r\n\t'N/A' as RiskUnit, \r\n\t'N/A' as RiskUnitSequenceNumber, \r\n\t'N/A' as MajorPerilCode, \r\n\t'N/A' as ClassCode, \r\n\tRC.RiskType , \r\n\tRC.CoverageType, \r\n\tSIL.StandardInsuranceLineCode, \r\n\tRL.RiskLocationHashKey, \r\n\tPC.TypeBureauCode,\r\n\tRC.PerilGroup,\r\n\tRC.CoverageForm,\r\n\tRC.SubCoverageTypeCode,\r\n\tRC.CoverageVersion,\r\n\tPC.CustomerCareCommissionRate,\r\n\tRPDT.RatingPlanCode,\r\n\tWNMP.GeneratedRecordFlag,\r\n\tWNMP.ModifiedPremiumType\r\n\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkEarnedModifiedPremium WEMP\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkNormalizedModifiedPremium WNMP\r\n\tON WEMP.PremiumMasterCalculationPKID=WNMP.WorkNormalizedModifiedPremiumId\r\n\tAND WEMP.SourceSystemID = '@{pipeline().parameters.SOURCE_SYSTEM_ID}' \r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumMasterCalculation PMC on PMC.PremiumMasterCalculationID=WNMP.PremiumMasterCalculationId\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage RC ON PMC.RatingCoverageAKID=RC.RatingCoverageAKID and PMC.RatingCoverageEffectiveDate = RC.EffectiveDate\r\n\t@{pipeline().parameters.WHERE_WEMP_SINCE_LAST_LOAD}\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\t             ON WEMP.PolicyCoverageAKID=PC.PolicyCoverageAKID  and PC.CurrentSnapshotFlag=1\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation RL\r\n\t             ON WEMP.RiskLocationAKID=RL.RiskLocationAKID and RL.CurrentSnapshotFlag=1\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.Policy P\r\n\t\t\tON WEMP.PolicyAKID=P.pol_ak_id\r\n\t\t\tAND P.crrnt_snpsht_flag=1\r\n\t\t\t@{pipeline().parameters.JOIN_POLICY_LIST_IL}\t\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product \r\n\ton RC.ProductAKID=Product.ProductAKID and Product.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLineOfBusiness \r\n\tOn RC.InsuranceReferenceLineOfBusinessAKID=InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessAKId \r\n\tand InsuranceReferenceLineOfBusiness.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyOffering\r\n\tOn PolicyOffering.PolicyOfferingAKID=P.PolicyOfferingAKID and PolicyOffering.CurrentSnapshotFlag=1\t\t\t\r\n\t\t\t\r\n\tLEFT OUTER JOIN  @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment ISS\r\n\t\t\tON P.InsuranceSegmentAKId=ISS.InsuranceSegmentAKId\r\n\t\t\tAND ISS.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN  @{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter SPC\r\n\t            ON P.StrategicProfitCenterAKId=SPC.StrategicProfitCenterAKId\r\n\t            AND SPC.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN  @{pipeline().parameters.SOURCE_TABLE_OWNER}.EnterpriseGroup EGP\r\n\t           ON SPC.EnterpriseGroupId=EGP.EnterpriseGroupId\r\n\t           AND EGP.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN  @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLegalEntity IRLE\r\n\t          ON SPC.InsuranceReferenceLegalEntityId=IRLE.InsuranceReferenceLegalEntityId\r\n\t          AND IRLE.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line SIL\r\n\t          ON SIL.ins_line_code=PC.InsuranceLine\r\n\t          AND SIL.crrnt_snpsht_flag=1 \r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingPlan RPDT\r\n\t           ON PC.RatingPlanAKId=RPDT.RatingPlanAKId and RPDT.CurrentSnapshotFlag=1\r\n\tWHERE WEMP.SourceSystemID='@{pipeline().parameters.SOURCE_SYSTEM_ID}'  \r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n),\nEXP_EarnedPremiumCalculation_IN AS (\n\tSELECT\n\tSourceSystemID,\n\tPolicyAKID,\n\tStatisticalCoverageAKID,\n\tPremiumTransactionAKID AS PremiumTransactionAKId,\n\tPremiumMasterCalculationPKID,\n\tStatisticalCoverageCancellationDate,\n\tPremiumTransactionEnteredDate,\n\tPremiumTransactionEffectiveDate,\n\tPremiumTransactionExpirationDate,\n\tPremiumTransactionBookedDate,\n\tPremiumTransactionCode,\n\tPremiumType,\n\tReasonAmendedCode,\n\tEarnedPremium,\n\tChangeInEarnedPremium,\n\tUnearnedPremium,\n\tChangeInUnearnedPremium,\n\tProductCode,\n\tAnnualStatementLineCode,\n\tSubAnnualStatementLineCode,\n\tNonSubAnnualStatementLineCode AS i_NonSubAnnualStatementLineCode,\n\tAnnualStatementLineProductCode,\n\tLineOfBusinessCode,\n\tPolicyOfferingCode,\n\tRunDate,\n\tStrategicProfitCenterCode,\n\tEnterpriseGroupCode,\n\tInsuranceReferenceLegalEntityCode,\n\tInsuranceSegmentCode,\n\tRiskUnitGroup AS i_RiskUnitGroup,\n\tRiskUnit AS i_RiskUnit,\n\tRiskUnitSequenceNumber AS i_RiskUnitSequenceNumber,\n\tMajorPerilCode AS i_MajorPerilCode,\n\tClassCode AS i_ClassCode,\n\tCoverageForm AS i_CoverageForm,\n\tRiskType AS i_RiskType,\n\tCoverageType AS i_CoverageType,\n\tStandardInsuranceLineCode AS i_StandardInsuranceLineCode,\n\tRiskLocationHashKey,\n\tTypeBureauCode AS i_TypeBureauCode,\n\tPerilGroup AS i_PerilGroup,\n\tSubCoverageTypeCode AS i_SubCoverageTypeCode,\n\tCoverageVersion AS i_CoverageVersion,\n\tCustomerCareCommissionRate,\n\tRatingPlanCode AS i_RatingPlanCode,\n\tGeneratedRecordIndicator AS i_GeneratedRecordIndicator,\n\tModifiedPremiumType\n\tFROM SQ_WC_ModifiedPremium\n),\nSQ_OtherLines_NaturalTransaction AS (\n\tDECLARE @SELECTION_START_TS AS DATETIME,\r\n\t@MIN_START_CLNDR_ID AS INT\r\n\t\r\n\tSELECT @MIN_START_CLNDR_ID = MIN(clndr_id) FROM calendar_dim WHERE clndr_date >= '@{pipeline().parameters.SELECTION_START_TS}'\r\n\t\r\n\t--SQ_OtherLines_NaturalTransaction\r\n\t\r\n\tSELECT ISNULL(rmNonWCCalc.DirectWrittenPremium,1.0 ),\r\n\tISNULL(rmNonWCCalc.OtherModifiedPremium,1.0 ),\r\n\tISNULL(rmNonWCCalc.ScheduleModifiedPremium,1.0 ),\r\n\tISNULL(rmNonWCCalc.ExperienceModifiedPremium,1.0 ),\r\n\tISNULL(rmNonWCCalc.SubjectWrittenPremium,1.0 ),\r\n\ta.AnnualStatementLineDimID, \r\n\ta.AnnualStatementLineProductCodeDimID,\r\n\ta.AgencyDimID,\r\n\ta.PolicyDimID,\r\n\ta.ContractCustomerDimID,\r\n\ta.RiskLocationDimID,\r\n\ta.PremiumTransactionTypeDimID, \r\n\ta.PremiumTransactionEnteredDateID, \r\n\ta.PremiumTransactionEffectiveDateID, \r\n\ta.PremiumTransactionExpirationDateID, \r\n\ta.PremiumTransactionBookedDateID, \r\n\ta.PremiumTransactionRunDateID, \r\n\ta.MonthlyChangeinDirectEarnedPremium,\r\n\ta.InsuranceReferenceDimId,\r\n\ta.EDWPremiumMasterCalculationPKId, \r\n\ta.CoverageDetailDimId, \r\n\ta.InsuranceReferenceCoverageDimId, \r\n\ta.CoverageCancellationDateId,\r\n\tirc.InsuranceLineCode,\r\n\ta.EDWEarnedPremiumMonthlyCalculationPKID\r\n\tFROM\r\n\t@{pipeline().parameters.TARGET_TABLE_OWNER}.EarnedPremiumTransactionMonthlyFact a\r\n\t@{pipeline().parameters.JOIN_PREMIUMTRANSACTION_LIST} \r\n\tINNER JOIN @{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransactionTypeDim ptdim\r\n\ton a.PremiumTransactionTypeDimID=ptdim.PremiumTransactionTypeDimID and ptdim.PremiumTypeCode='D'\r\n\t@{pipeline().parameters.WHERE_EPTMF_SINCE_LAST_LOAD}\r\n\tINNER JOIN @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceDim i \r\n\ton a.InsuranceReferenceDimId =i.InsuranceReferenceDimId  and InsuranceReferenceLineOfBusinessAbbreviation <>'WC'\r\n\tINNER JOIN @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceCoverageDim irc  \r\n\ton irc.InsuranceReferenceCoverageDimId = a.InsuranceReferenceCoverageDimId\r\n\tINNER JOIN @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim pd\r\n\ton a.PolicyDimID = pd.pol_dim_id  AND pd.pol_sym = '000'\r\n\t@{pipeline().parameters.JOIN_POLICY_LIST_IL}\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.ModifiedPremiumNonWorkersCompensationCalculation rmNonWCCalc\r\n\ton a.EDWPremiumMasterCalculationPKId = rmNonWCCalc.PremiumMasterCalculationId\r\n\tand rmNonWCCalc.GeneratedRecordIndicator=0 \r\n\tand rmNonWCCalc.SourceSystemID = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\n),\nEXP_OtherLinesEarnedPremium AS (\n\tSELECT\n\tDirectWrittenPremium,\n\tOtherModifiedPremium,\n\tScheduleModifiedPremium,\n\tExperienceModifiedPremium,\n\tSubjectWrittenPremium,\n\tAnnualStatementLineDimID,\n\tAnnualStatementLineProductCodeDimID,\n\tAgencyDimID,\n\tPolicyDimID,\n\tContractCustomerDimID,\n\tRiskLocationDimID,\n\tPremiumTransactionTypeDimID,\n\tPremiumTransactionEnteredDateID,\n\tPremiumTransactionEffectiveDateID,\n\tPremiumTransactionExpirationDateID,\n\tPremiumTransactionBookedDateID,\n\tPremiumTransactionRunDateID,\n\tMonthlyChangeinDirectEarnedPremium,\n\tInsuranceReferenceDimId,\n\tEDWPremiumMasterCalculationPKId,\n\tCoverageDetailDimId,\n\tInsuranceReferenceCoverageDimId,\n\tCoverageCancellationDateId,\n\tInsuranceLineCode,\n\tEDWEarnedPremiumMonthlyCalculationPKID\n\tFROM SQ_OtherLines_NaturalTransaction\n),\nmplt_PolicyDimID_PremiumMaster AS (WITH\n\tInput AS (\n\t\t\n\t),\n\tEXP_Default AS (\n\t\tSELECT\n\t\tIN_PolicyAKID AS PolicyAKID,\n\t\tIN_Trans_Date\n\t\tFROM Input\n\t),\n\tLKP_V2_Policy AS (\n\t\tSELECT\n\t\tcontract_cust_ak_id,\n\t\tagencyakid,\n\t\tpol_status_code,\n\t\tstrtgc_bus_dvsn_ak_id,\n\t\tIN_Trans_Date,\n\t\tpol_ak_id,\n\t\teff_from_date,\n\t\teff_to_date\n\t\tFROM (\n\t\t\tSELECT policy.contract_cust_ak_id as contract_cust_ak_id, policy.agencyakid as agencyakid, policy.pol_status_code as pol_status_code, policy.strtgc_bus_dvsn_ak_id as strtgc_bus_dvsn_ak_id, policy.pol_ak_id as pol_ak_id, policy.eff_from_date as eff_from_date, policy.eff_to_date as eff_to_date FROM \r\n\t\t\tV2.policy\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY pol_ak_id,eff_from_date,eff_to_date ORDER BY contract_cust_ak_id DESC) = 1\n\t),\n\tLKP_PolicyDimID AS (\n\t\tSELECT\n\t\tpol_dim_id,\n\t\tpol_key,\n\t\tpol_eff_date,\n\t\tpol_exp_date,\n\t\tpms_pol_lob_code,\n\t\tClassOfBusinessCode,\n\t\tIN_Trans_Date,\n\t\tedw_pol_ak_id,\n\t\teff_from_date,\n\t\teff_to_date\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tpol_dim_id,\n\t\t\t\tpol_key,\n\t\t\t\tpol_eff_date,\n\t\t\t\tpol_exp_date,\n\t\t\t\tpms_pol_lob_code,\n\t\t\t\tClassOfBusinessCode,\n\t\t\t\tIN_Trans_Date,\n\t\t\t\tedw_pol_ak_id,\n\t\t\t\teff_from_date,\n\t\t\t\teff_to_date\n\t\t\tFROM policy_dim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_pol_ak_id,eff_from_date,eff_to_date ORDER BY pol_dim_id DESC) = 1\n\t),\n\tLKP_V3_AgencyDimID AS (\n\t\tSELECT\n\t\tagency_dim_id,\n\t\tedw_agency_ak_id,\n\t\teff_from_date,\n\t\teff_to_date\n\t\tFROM (\n\t\t\tSELECT AgencyDim.AgencyDimID as agency_dim_id, AgencyDim.EDWAgencyAKID as edw_agency_ak_id, AgencyDim.EffectiveDate as eff_from_date, AgencyDim.ExpirationDate as eff_to_date\r\n\t\t\t FROM V3.AgencyDim as AgencyDim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_agency_ak_id,eff_from_date,eff_to_date ORDER BY agency_dim_id DESC) = 1\n\t),\n\tLKP_ContractCustomerDim AS (\n\t\tSELECT\n\t\tcontract_cust_dim_id,\n\t\tIN_Trans_Date,\n\t\tedw_contract_cust_ak_id,\n\t\teff_from_date,\n\t\teff_to_date\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tcontract_cust_dim_id,\n\t\t\t\tIN_Trans_Date,\n\t\t\t\tedw_contract_cust_ak_id,\n\t\t\t\teff_from_date,\n\t\t\t\teff_to_date\n\t\t\tFROM contract_customer_dim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_contract_cust_ak_id,eff_from_date,eff_to_date ORDER BY contract_cust_dim_id DESC) = 1\n\t),\n\tlkp_StrategicBusinessDivisionDIM AS (\n\t\tSELECT\n\t\tstrtgc_bus_dvsn_dim_id,\n\t\tedw_strtgc_bus_dvsn_ak_id\n\t\tFROM (\n\t\t\tSELECT strategic_business_division_dim.strtgc_bus_dvsn_dim_id as strtgc_bus_dvsn_dim_id, strategic_business_division_dim.edw_strtgc_bus_dvsn_ak_id as edw_strtgc_bus_dvsn_ak_id \r\n\t\t\tFROM strategic_business_division_dim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_strtgc_bus_dvsn_ak_id ORDER BY strtgc_bus_dvsn_dim_id DESC) = 1\n\t),\n\tEXP_Values AS (\n\t\tSELECT\n\t\tLKP_V3_AgencyDimID.agency_dim_id,\n\t\tLKP_ContractCustomerDim.contract_cust_dim_id,\n\t\tLKP_PolicyDimID.pol_dim_id,\n\t\tLKP_V2_Policy.pol_status_code,\n\t\tLKP_PolicyDimID.pol_eff_date,\n\t\tLKP_PolicyDimID.pol_exp_date,\n\t\tlkp_StrategicBusinessDivisionDIM.strtgc_bus_dvsn_dim_id,\n\t\tLKP_PolicyDimID.pol_key,\n\t\tLKP_PolicyDimID.pms_pol_lob_code,\n\t\tLKP_PolicyDimID.ClassOfBusinessCode\n\t\tFROM \n\t\tLEFT JOIN LKP_ContractCustomerDim\n\t\tON LKP_ContractCustomerDim.edw_contract_cust_ak_id = LKP_V2_Policy.contract_cust_ak_id AND LKP_ContractCustomerDim.eff_from_date <= EXP_Default.IN_Trans_Date AND LKP_ContractCustomerDim.eff_to_date >= EXP_Default.IN_Trans_Date\n\t\tLEFT JOIN LKP_PolicyDimID\n\t\tON LKP_PolicyDimID.edw_pol_ak_id = EXP_Default.PolicyAKID AND LKP_PolicyDimID.eff_from_date <= EXP_Default.IN_Trans_Date AND LKP_PolicyDimID.eff_to_date >= EXP_Default.IN_Trans_Date\n\t\tLEFT JOIN LKP_V2_Policy\n\t\tON LKP_V2_Policy.pol_ak_id = EXP_Default.PolicyAKID AND LKP_V2_Policy.eff_from_date <= EXP_Default.IN_Trans_Date AND LKP_V2_Policy.eff_to_date >= EXP_Default.IN_Trans_Date\n\t\tLEFT JOIN LKP_V3_AgencyDimID\n\t\tON LKP_V3_AgencyDimID.edw_agency_ak_id = LKP_V2_Policy.agencyakid AND LKP_V3_AgencyDimID.eff_from_date <= EXP_Default.IN_Trans_Date AND LKP_V3_AgencyDimID.eff_to_date >= EXP_Default.IN_Trans_Date\n\t\tLEFT JOIN lkp_StrategicBusinessDivisionDIM\n\t\tON lkp_StrategicBusinessDivisionDIM.edw_strtgc_bus_dvsn_ak_id = LKP_V2_Policy.strtgc_bus_dvsn_ak_id\n\t),\n\tOutput AS (\n\t\tSELECT\n\t\tagency_dim_id, \n\t\tcontract_cust_dim_id, \n\t\tpol_dim_id, \n\t\tpol_status_code, \n\t\tpol_eff_date, \n\t\tpol_exp_date, \n\t\tstrtgc_bus_dvsn_dim_id, \n\t\tpol_key, \n\t\tpms_pol_lob_code, \n\t\tClassOfBusinessCode\n\t\tFROM EXP_Values\n\t),\n),\nmplt_EarnedPremium AS (WITH\n\tLKP_CoverageDetailDim AS (\n\t\tSELECT\n\t\tCoverageDetailDimId,\n\t\tPremiumTransactionAKId\n\t\tFROM (\n\t\t\tselect CDD.CoverageDetailDimId as CoverageDetailDimId, \r\n\t\t\tPT.PremiumTransactionAKId as PremiumTransactionAKId\r\n\t\t\tfrom @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction PT\r\n\t\t\tjoin @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailDim CDD\r\n\t\t\ton  PT.PremiumTransactionID=CDD.EDWPremiumTransactionPKID\r\n\t\t\twhere exists (\r\n\t\t\tselect 1 from @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkEarnedModifiedPremium EPMC\r\n\t\t\twhere EPMC.PremiumTransactionAKId=PT.PremiumTransactionAKId\r\n\t\t\tand EPMC.CreatedDate>='@{pipeline().parameters.SELECTION_START_TS}')\r\n\t\t\tor '@{pipeline().parameters.SELECTION_START_TS}'<='01/01/1800 00:00:00'\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionAKId ORDER BY CoverageDetailDimId) = 1\n\t),\n\tLKP_InsuranceReferenceCoverageDim_DCT AS (\n\t\tSELECT\n\t\tInsuranceReferenceCoverageDimId,\n\t\tDctRiskTypeCode,\n\t\tDctCoverageTypeCode,\n\t\tInsuranceLineCode,\n\t\tDctPerilGroup,\n\t\tDctSubCoverageTypeCode,\n\t\tDctCoverageVersion\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tInsuranceReferenceCoverageDimId,\n\t\t\t\tDctRiskTypeCode,\n\t\t\t\tDctCoverageTypeCode,\n\t\t\t\tInsuranceLineCode,\n\t\t\t\tDctPerilGroup,\n\t\t\t\tDctSubCoverageTypeCode,\n\t\t\t\tDctCoverageVersion\n\t\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceCoverageDim\n\t\t\tWHERE NOT (DctRiskTypeCode='N/A' AND DctCoverageTypeCode='N/A' AND DctPerilGroup='N/A' AND DctSubCoverageTypeCode='N/A' AND DctCoverageVersion='N/A')\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY DctRiskTypeCode,DctCoverageTypeCode,InsuranceLineCode,DctPerilGroup,DctSubCoverageTypeCode,DctCoverageVersion ORDER BY InsuranceReferenceCoverageDimId) = 1\n\t),\n\tLKP_InsuranceReferenceCoverageDim_PMS AS (\n\t\tSELECT\n\t\tInsuranceReferenceCoverageDimId,\n\t\tInsuranceLineCode,\n\t\tPmsRiskUnitGroupCode,\n\t\tPmsRiskUnitCode,\n\t\tPmsMajorPerilCode,\n\t\tPmsProductTypeCode\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tInsuranceReferenceCoverageDimId,\n\t\t\t\tInsuranceLineCode,\n\t\t\t\tPmsRiskUnitGroupCode,\n\t\t\t\tPmsRiskUnitCode,\n\t\t\t\tPmsMajorPerilCode,\n\t\t\t\tPmsProductTypeCode\n\t\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceCoverageDim\n\t\t\tWHERE DctRiskTypeCode='N/A' AND DctCoverageTypeCode='N/A' AND DctPerilGroup='N/A' AND DctSubCoverageTypeCode='N/A' AND DctCoverageVersion='N/A'\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY InsuranceLineCode,PmsRiskUnitGroupCode,PmsRiskUnitCode,PmsMajorPerilCode,PmsProductTypeCode ORDER BY InsuranceReferenceCoverageDimId) = 1\n\t),\n\tLKP_CoverageDetailDim_Hist AS (\n\t\tSELECT\n\t\tCoverageDetailDimId,\n\t\tStatisticalCoverageAKID\n\t\tFROM (\n\t\t\tselect CDD.CoverageDetailDimId as CoverageDetailDimId, \r\n\t\t\tSC.StatisticalCoverageAKID as StatisticalCoverageAKID\r\n\t\t\tfrom  @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkEarnedModifiedPremium EPMC\r\n\t\t\tjoin @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.StatisticalCoverage SC\r\n\t\t\ton EPMC.StatisticalCoverageAKId=SC.StatisticalCoverageAKId\r\n\t\t\tjoin @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailDim CDD\r\n\t\t\ton  SC.CoverageGUID=CDD.CoverageGUID and EPMC.PremiumTransactionEffectiveDate between CDD.EffectiveDate and CDD.ExpirationDate\r\n\t\t\twhere EPMC.CreatedDate>='@{pipeline().parameters.SELECTION_START_TS}' and EPMC.PremiumTransactionAKID=-1\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY StatisticalCoverageAKID ORDER BY CoverageDetailDimId) = 1\n\t),\n\tLKP_calender_dim AS (\n\t\tSELECT\n\t\tclndr_id,\n\t\tclndr_date\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tclndr_id,\n\t\t\t\tclndr_date\n\t\t\tFROM calendar_dim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY clndr_date ORDER BY clndr_id) = 1\n\t),\n\tINPUT_OtherLinesEarnedPremium AS (\n\t\t\n\t),\n\tINPUT_DirectPremium AS (\n\t\t\n\t),\n\tINPUT_OtherLinesGeneratedmodifiedPremium AS (\n\t\t\n\t),\n\tEXP_EarnedPremiumCalculation_IN AS (\n\t\tSELECT\n\t\tSourceSystemID,\n\t\tStatisticalCoverageAKID,\n\t\tPremiumTransactionAKId,\n\t\tPremiumMasterCalculationPKID,\n\t\tStatisticalCoverageCancellationDate,\n\t\tPremiumTransactionEnteredDate,\n\t\tPremiumTransactionEffectiveDate,\n\t\tPremiumTransactionExpirationDate,\n\t\tPremiumTransactionBookedDate,\n\t\tPremiumTransactionCode,\n\t\tPremiumType,\n\t\tReasonAmendedCode,\n\t\tEarnedPremium,\n\t\tChangeInEarnedPremium,\n\t\tUnearnedPremium,\n\t\tChangeInUnearnedPremium,\n\t\tProductCode,\n\t\tAnnualStatementLineCode,\n\t\tSubAnnualStatementLineCode,\n\t\ti_NonSubAnnualStatementLineCode,\n\t\t-- *INF*: i_NonSubAnnualStatementLineCode\r\n\t\t-- \r\n\t\t-- --IIF(SourceSystemID='DCT','N/A',i_NonSubAnnualStatementLineCode)\n\t\ti_NonSubAnnualStatementLineCode AS o_NonSubAnnualStatementLineCode,\n\t\tAnnualStatementLineProductCode,\n\t\tLineOfBusinessCode,\n\t\tPolicyOfferingCode,\n\t\tRunDate,\n\t\tStrategicProfitCenterCode,\n\t\tEnterpriseGroupCode,\n\t\tInsuranceReferenceLegalEntityCode,\n\t\tInsuranceSegmentCode,\n\t\ti_RiskUnitGroup,\n\t\ti_RiskUnit,\n\t\ti_RiskUnitSequenceNumber,\n\t\ti_MajorPerilCode,\n\t\ti_ClassCode,\n\t\ti_CoverageForm,\n\t\ti_RiskType,\n\t\ti_CoverageType,\n\t\ti_StandardInsuranceLineCode,\n\t\tRiskLocationHashKey,\n\t\ti_TypeBureauCode,\n\t\ti_PerilGroup,\n\t\ti_SubCoverageTypeCode,\n\t\ti_CoverageVersion,\n\t\t-- *INF*: i_RiskType\r\n\t\t-- \r\n\t\t-- --IIF(LTRIM(RTRIM(i_CoverageForm))='BusinessAuto','N/A',i_RiskType)\n\t\ti_RiskType AS v_RiskType,\n\t\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(SUBSTR(i_RiskUnitSequenceNumber,2,1))\n\t\tUDF_DEFAULT_VALUE_FOR_STRINGS(SUBSTR(i_RiskUnitSequenceNumber, 2, 1)) AS v_ProductTypeCode,\n\t\t-- *INF*: IIF(REG_MATCH(i_StandardInsuranceLineCode,'[^0-9a-zA-Z]'),'N/A',i_StandardInsuranceLineCode)\n\t\tIFF(\n\t\t    REGEXP_LIKE(i_StandardInsuranceLineCode, '[^0-9a-zA-Z]'), 'N/A', i_StandardInsuranceLineCode\n\t\t) AS v_Reg_StandardInsuranceLineCode,\n\t\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_MajorPerilCode)\n\t\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_MajorPerilCode) AS v_MajorPerilCode,\n\t\t-- *INF*: IIF(LTRIM(v_MajorPerilCode,'0')='','N/A',v_MajorPerilCode)\n\t\tIFF(LTRIM(v_MajorPerilCode, '0') = '', 'N/A', v_MajorPerilCode) AS v_Zero_MajorPerilCode,\n\t\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_ClassCode)\n\t\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_ClassCode) AS v_ClassCode,\n\t\t-- *INF*: IIF(v_Reg_StandardInsuranceLineCode='N/A' AND (IN(i_TypeBureauCode,'AL','AN','AP') OR IN(v_Zero_MajorPerilCode,'930','931')),'CA',v_Reg_StandardInsuranceLineCode)\n\t\tIFF(\n\t\t    v_Reg_StandardInsuranceLineCode = 'N/A'\n\t\t    and (i_TypeBureauCode IN ('AL','AN','AP')\n\t\t    or v_Zero_MajorPerilCode IN ('930','931')),\n\t\t    'CA',\n\t\t    v_Reg_StandardInsuranceLineCode\n\t\t) AS v_StandardInsuranceLineCode,\n\t\t-- *INF*: IIF(v_StandardInsuranceLineCode='N/A' AND IN(i_TypeBureauCode,'CF','B2','BB','BE','BF','BM','BT','FT','GL','GS','IM','MS','PF','PH','PI','PL','PQ','WC','WP','NB','RL','RN','RP','BC','N/A'),1,0)\n\t\tIFF(\n\t\t    v_StandardInsuranceLineCode = 'N/A'\n\t\t    and i_TypeBureauCode IN ('CF','B2','BB','BE','BF','BM','BT','FT','GL','GS','IM','MS','PF','PH','PI','PL','PQ','WC','WP','NB','RL','RN','RP','BC','N/A'),\n\t\t    1,\n\t\t    0\n\t\t) AS v_flag,\n\t\t-- *INF*: IIF(IN(v_StandardInsuranceLineCode,'CR') OR v_flag=1,'N/A',:UDF.DEFAULT_VALUE_FOR_STRINGS(i_RiskUnitGroup))\n\t\tIFF(\n\t\t    v_StandardInsuranceLineCode IN ('CR') OR v_flag = 1, 'N/A',\n\t\t    UDF_DEFAULT_VALUE_FOR_STRINGS(i_RiskUnitGroup)\n\t\t) AS v_RiskUnitGroup,\n\t\t-- *INF*: IIF(LTRIM(v_RiskUnitGroup,'0')='','N/A',v_RiskUnitGroup)\n\t\tIFF(LTRIM(v_RiskUnitGroup, '0') = '', 'N/A', v_RiskUnitGroup) AS v_Zero_RiskUnitGroup,\n\t\t-- *INF*: IIF(\r\n\t\t--   v_flag=1\r\n\t\t-- OR   (v_StandardInsuranceLineCode='GL' AND (NOT IN(v_MajorPerilCode,'540','599','919')\r\n\t\t--   OR NOT IN(v_ClassCode,'11111','22222','22250','92100','17000','17001','17002','80051','80052','80053','80054','80055','80056','80057','80058')))\r\n\t\t--   OR IN(v_StandardInsuranceLineCode,'WC','IM','CG','CA')=1,\r\n\t\t--  'N/A',:UDF.DEFAULT_VALUE_FOR_STRINGS(i_RiskUnit))\n\t\tIFF(\n\t\t    v_flag = 1\n\t\t    or (v_StandardInsuranceLineCode = 'GL'\n\t\t    and (NOT v_MajorPerilCode IN ('540','599','919')\n\t\t    or NOT v_ClassCode IN ('11111','22222','22250','92100','17000','17001','17002','80051','80052','80053','80054','80055','80056','80057','80058')))\n\t\t    or v_StandardInsuranceLineCode IN ('WC','IM','CG','CA') = 1,\n\t\t    'N/A',\n\t\t    UDF_DEFAULT_VALUE_FOR_STRINGS(i_RiskUnit)\n\t\t) AS v_RiskUnit,\n\t\t-- *INF*: IIF(LTRIM(v_RiskUnit,'0')='','N/A',v_RiskUnit)\n\t\tIFF(LTRIM(v_RiskUnit, '0') = '', 'N/A', v_RiskUnit) AS v_Zero_RiskUnit,\n\t\t-- *INF*: IIF(REG_MATCH(v_Zero_RiskUnitGroup,'[^0-9a-zA-Z]'),'N/A',v_Zero_RiskUnitGroup)\n\t\tIFF(REGEXP_LIKE(v_Zero_RiskUnitGroup, '[^0-9a-zA-Z]'), 'N/A', v_Zero_RiskUnitGroup) AS v_PmsRiskUnitGroupCode,\n\t\t-- *INF*: IIF(REG_MATCH(v_Zero_RiskUnit,'[^0-9a-zA-Z]'),'N/A',v_Zero_RiskUnit)\n\t\tIFF(REGEXP_LIKE(v_Zero_RiskUnit, '[^0-9a-zA-Z]'), 'N/A', v_Zero_RiskUnit) AS v_PmsRiskUnitCode,\n\t\t-- *INF*: SUBSTR(v_PmsRiskUnitCode, 1, 3)\n\t\tSUBSTR(v_PmsRiskUnitCode, 1, 3) AS v_PmsRiskUnitCode_1_3,\n\t\t-- *INF*: IIF(SourceSystemID='PMS',v_StandardInsuranceLineCode,i_StandardInsuranceLineCode)\n\t\tIFF(SourceSystemID = 'PMS', v_StandardInsuranceLineCode, i_StandardInsuranceLineCode) AS v_InsuranceLineCode,\n\t\t-- *INF*: IIF(REG_MATCH(v_Zero_MajorPerilCode,'[^0-9a-zA-Z]'),'N/A',v_Zero_MajorPerilCode)\n\t\tIFF(REGEXP_LIKE(v_Zero_MajorPerilCode, '[^0-9a-zA-Z]'), 'N/A', v_Zero_MajorPerilCode) AS v_PmsMajorPerilCode,\n\t\t-- *INF*: IIF(\r\n\t\t--   REG_MATCH(v_ProductTypeCode,'[^0-9a-zA-Z]') OR v_Reg_StandardInsuranceLineCode<>'GL' OR v_ProductTypeCode='0' OR LENGTH(v_ProductTypeCode)=0,\r\n\t\t--   'N/A',v_ProductTypeCode\r\n\t\t-- )\n\t\tIFF(\n\t\t    REGEXP_LIKE(v_ProductTypeCode, '[^0-9a-zA-Z]')\n\t\t    or v_Reg_StandardInsuranceLineCode <> 'GL'\n\t\t    or v_ProductTypeCode = '0'\n\t\t    or LENGTH(v_ProductTypeCode) = 0,\n\t\t    'N/A',\n\t\t    v_ProductTypeCode\n\t\t) AS v_PmsProductTypeCode,\n\t\t-- *INF*: :LKP.LKP_INSURANCEREFERENCECOVERAGEDIM_PMS(v_PmsRiskUnitGroupCode, v_PmsRiskUnitCode, v_PmsMajorPerilCode, v_InsuranceLineCode, v_PmsProductTypeCode)\n\t\tLKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode.InsuranceReferenceCoverageDimId AS v_InsuranceReferenceCoverageDimId_PMS_1,\n\t\t-- *INF*: v_InsuranceReferenceCoverageDimId_PMS_1\r\n\t\t-- \r\n\t\t-- --IIF(ISNULL(v_InsuranceReferenceCoverageDimId_PMS_1), :LKP.LKP_INSURANCEREFERENCECOVERAGEDIM_PMS(v_PmsRiskUnitGroupCode, v_PmsRiskUnitCode_1_3, v_PmsMajorPerilCode, v_InsuranceLineCode, v_PmsProductTypeCode), v_InsuranceReferenceCoverageDimId_PMS_1)\n\t\tv_InsuranceReferenceCoverageDimId_PMS_1 AS v_InsuranceReferenceCoverageDimId_PMS_2,\n\t\t-- *INF*: :LKP.LKP_INSURANCEREFERENCECOVERAGEDIM_DCT(v_RiskType, i_CoverageType, v_InsuranceLineCode, i_PerilGroup,i_SubCoverageTypeCode,i_CoverageVersion)\n\t\tLKP_INSURANCEREFERENCECOVERAGEDIM_DCT_v_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.InsuranceReferenceCoverageDimId AS v_InsuranceReferenceCoverageDimId_DCT,\n\t\t-- *INF*: IIF(PremiumTransactionAKId=-1,\r\n\t\t-- --Historical records\r\n\t\t-- :LKP.LKP_COVERAGEDETAILDIM_HIST(StatisticalCoverageAKID),\r\n\t\t-- --Incremental records\r\n\t\t-- :LKP.LKP_CoverageDetailDim(PremiumTransactionAKId)\r\n\t\t-- )\n\t\tIFF(\n\t\t    PremiumTransactionAKId = - 1,\n\t\t    LKP_COVERAGEDETAILDIM_HIST_StatisticalCoverageAKID.CoverageDetailDimId,\n\t\t    LKP_COVERAGEDETAILDIM_PremiumTransactionAKId.CoverageDetailDimId\n\t\t) AS v_CoverageDetailDimId,\n\t\t-- *INF*: IIF(ISNULL(v_InsuranceReferenceCoverageDimId_PMS_2), -1, v_InsuranceReferenceCoverageDimId_PMS_2)\n\t\tIFF(\n\t\t    v_InsuranceReferenceCoverageDimId_PMS_2 IS NULL, - 1,\n\t\t    v_InsuranceReferenceCoverageDimId_PMS_2\n\t\t) AS o_InsuranceReferenceCoverageDimId_PMS,\n\t\t-- *INF*: IIF(ISNULL(v_InsuranceReferenceCoverageDimId_DCT), -1, v_InsuranceReferenceCoverageDimId_DCT)\n\t\tIFF(\n\t\t    v_InsuranceReferenceCoverageDimId_DCT IS NULL, - 1, v_InsuranceReferenceCoverageDimId_DCT\n\t\t) AS o_InsuranceReferenceCoverageDimId_DCT,\n\t\t-- *INF*: IIF(ISNULL(v_CoverageDetailDimId), -1, v_CoverageDetailDimId)\n\t\tIFF(v_CoverageDetailDimId IS NULL, - 1, v_CoverageDetailDimId) AS o_CoverageDetailDimId_lkp,\n\t\tCustomerCareCommissionRate,\n\t\ti_RatingPlanCode,\n\t\t-- *INF*: IIF(ISNULL(i_RatingPlanCode), '1', i_RatingPlanCode)\n\t\tIFF(i_RatingPlanCode IS NULL, '1', i_RatingPlanCode) AS o_RatingPlanCode,\n\t\ti_GeneratedRecordIndicator,\n\t\t-- *INF*: IIF(i_GeneratedRecordIndicator='T' or i_GeneratedRecordIndicator='1','1','0')\n\t\tIFF(i_GeneratedRecordIndicator = 'T' or i_GeneratedRecordIndicator = '1', '1', '0') AS o_GeneratedRecordIndicator,\n\t\tModifiedPremiumType,\n\t\tAgencyDimID,\n\t\tPolicyDimID,\n\t\tContractCustomerDimID\n\t\tFROM INPUT_OtherLinesGeneratedmodifiedPremium\n\t\tLEFT JOIN LKP_INSURANCEREFERENCECOVERAGEDIM_PMS LKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode\n\t\tON LKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode.InsuranceLineCode = v_PmsRiskUnitGroupCode\n\t\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode.PmsRiskUnitGroupCode = v_PmsRiskUnitCode\n\t\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode.PmsRiskUnitCode = v_PmsMajorPerilCode\n\t\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode.PmsMajorPerilCode = v_InsuranceLineCode\n\t\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode.PmsProductTypeCode = v_PmsProductTypeCode\n\t\n\t\tLEFT JOIN LKP_INSURANCEREFERENCECOVERAGEDIM_DCT LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_v_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion\n\t\tON LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_v_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.DctRiskTypeCode = v_RiskType\n\t\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_v_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.DctCoverageTypeCode = i_CoverageType\n\t\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_v_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.InsuranceLineCode = v_InsuranceLineCode\n\t\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_v_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.DctPerilGroup = i_PerilGroup\n\t\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_v_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.DctSubCoverageTypeCode = i_SubCoverageTypeCode\n\t\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_v_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.DctCoverageVersion = i_CoverageVersion\n\t\n\t\tLEFT JOIN LKP_COVERAGEDETAILDIM_HIST LKP_COVERAGEDETAILDIM_HIST_StatisticalCoverageAKID\n\t\tON LKP_COVERAGEDETAILDIM_HIST_StatisticalCoverageAKID.StatisticalCoverageAKID = StatisticalCoverageAKID\n\t\n\t\tLEFT JOIN LKP_COVERAGEDETAILDIM LKP_COVERAGEDETAILDIM_PremiumTransactionAKId\n\t\tON LKP_COVERAGEDETAILDIM_PremiumTransactionAKId.PremiumTransactionAKId = PremiumTransactionAKId\n\t\n\t),\n\tEXP_OtherLinesEarnedPremium AS (\n\t\tSELECT\n\t\tDirectWrittenPremium,\n\t\tOtherModifiedPremium,\n\t\tScheduleModifiedPremium,\n\t\tExperienceModifiedPremium,\n\t\tSubjectWrittenPremium,\n\t\tAnnualStatementLineDimID,\n\t\tAnnualStatementLineProductCodeDimID,\n\t\tAgencyDimID,\n\t\tPolicyDimID,\n\t\tContractCustomerDimID,\n\t\tRiskLocationDimID,\n\t\tPremiumTransactionTypeDimID,\n\t\tPremiumTransactionEnteredDateID,\n\t\tPremiumTransactionEffectiveDateID,\n\t\tPremiumTransactionExpirationDateID,\n\t\tPremiumTransactionBookedDateID,\n\t\tPremiumTransactionRunDateID,\n\t\tMonthlyChangeinDirectEarnedPremium,\n\t\tInsuranceReferenceDimId,\n\t\tEDWPremiumMasterCalculationPKId,\n\t\tCoverageDetailDimId,\n\t\tInsuranceReferenceCoverageDimId,\n\t\tCoverageCancellationDateId,\n\t\tInsuranceLineCode,\n\t\t'0' AS GeneratedRecordFlag,\n\t\tMonthlyChangeinDirectEarnedPremium AS EarnedDirectWrittenPremium,\n\t\t-- *INF*: 0\r\n\t\t-- \r\n\t\t-- --IIF(InsuranceLineCode='WC',MonthlyChangeinDirectEarnedPremium,0)\r\n\t\t-- \n\t\t0 AS EarnedClassifiedPremium,\n\t\t-- *INF*: 0\r\n\t\t-- \r\n\t\t-- --IIF(InsuranceLineCode='WC',MonthlyChangeinDirectEarnedPremium,0)\r\n\t\t-- \n\t\t0 AS EarnedRatablePremium,\n\t\t-- *INF*: TO_DECIMAL(OtherModifiedPremium/DirectWrittenPremium*MonthlyChangeinDirectEarnedPremium,8)\n\t\tCAST(OtherModifiedPremium / DirectWrittenPremium * MonthlyChangeinDirectEarnedPremium AS FLOAT) AS v_EarnedOtherModifiedPremium,\n\t\t-- *INF*: TO_DECIMAL(ScheduleModifiedPremium/DirectWrittenPremium*MonthlyChangeinDirectEarnedPremium,8)\n\t\tCAST(ScheduleModifiedPremium / DirectWrittenPremium * MonthlyChangeinDirectEarnedPremium AS FLOAT) AS v_EarnedScheduleModifiedPremium,\n\t\t-- *INF*: TO_DECIMAL(ExperienceModifiedPremium/DirectWrittenPremium*MonthlyChangeinDirectEarnedPremium,8)\n\t\tCAST(ExperienceModifiedPremium / DirectWrittenPremium * MonthlyChangeinDirectEarnedPremium AS FLOAT) AS v_EarnedExperienceModifiedPremium,\n\t\t-- *INF*: TO_DECIMAL(SubjectWrittenPremium/DirectWrittenPremium*MonthlyChangeinDirectEarnedPremium,8)\n\t\tCAST(SubjectWrittenPremium / DirectWrittenPremium * MonthlyChangeinDirectEarnedPremium AS FLOAT) AS v_EarnedSubjectWrittenPremium,\n\t\t-- *INF*: ROUND(v_EarnedOtherModifiedPremium,4)\n\t\tROUND(v_EarnedOtherModifiedPremium, 4) AS o_EarnedOtherModifiedPremium,\n\t\t-- *INF*: ROUND(v_EarnedScheduleModifiedPremium,4)\n\t\tROUND(v_EarnedScheduleModifiedPremium, 4) AS o_EarnedScheduleModifiedPremium,\n\t\t-- *INF*: ROUND(v_EarnedExperienceModifiedPremium,4)\n\t\tROUND(v_EarnedExperienceModifiedPremium, 4) AS o_EarnedExperienceModifiedPremium,\n\t\t-- *INF*: ROUND(v_EarnedSubjectWrittenPremium,4)\n\t\tROUND(v_EarnedSubjectWrittenPremium, 4) AS o_EarnedSubjectWrittenPremium,\n\t\tEDWEarnedPremiumMonthlyCalculationPKID\n\t\tFROM INPUT_OtherLinesEarnedPremium\n\t),\n\tEXP_DirectPremium AS (\n\t\tSELECT\n\t\tEDWPremiumMasterCalculationPKId,\n\t\tPremiumTransactionEnteredDateID,\n\t\tPremiumTransactionEffectiveDateID,\n\t\tPremiumTransactionRunDateID,\n\t\tAnnualStatementLineDimID,\n\t\tAnnualStatementLineProductCodeDimID,\n\t\tAgencyDimID,\n\t\tPolicyDimID,\n\t\tContractCustomerDimID,\n\t\tRiskLocationDimID,\n\t\tPremiumTransactionTypeDimID,\n\t\tInsuranceReferenceDimId,\n\t\tInsuranceReferenceCoverageDimId,\n\t\tCoverageDetailDimId,\n\t\tPremiumTransactionBookedDateID,\n\t\tPremiumTransactionExpirationDateID,\n\t\tCoverageCancellationDateId,\n\t\tGeneratedRecordIndicator,\n\t\tMonthlyChangeinDirectEarnedPremium,\n\t\tModifiedPremiumType,\n\t\tEDWEarnedPremiumMonthlyCalculationPKID\n\t\tFROM INPUT_DirectPremium\n\t),\n\tlkp_PremiumTransactionTypeDim AS (\n\t\tSELECT\n\t\tPremiumTransactionTypeDimID,\n\t\tPremiumTransactionCode,\n\t\tReasonAmendedCode,\n\t\tPremiumTypeCode\n\t\tFROM (\n\t\t\tSELECT \r\n\t\t\tPTTD.PremiumTransactionTypeDimID as PremiumTransactionTypeDimID,\r\n\t\t\tLTRIM(RTRIM(PTTD.PremiumTransactionCode)) as PremiumTransactionCode, \r\n\t\t\tLTRIM(RTRIM(PTTD.ReasonAmendedCode)) as ReasonAmendedCode, \r\n\t\t\tLTRIM(RTRIM(PTTD.PremiumTypeCode)) as PremiumTypeCode \r\n\t\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransactionTypeDim PTTD\r\n\t\t\twhere PTTD.CurrentSnapShotFlag=1\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionCode,ReasonAmendedCode,PremiumTypeCode ORDER BY PremiumTransactionTypeDimID DESC) = 1\n\t),\n\tLKP_asl_dim AS (\n\t\tSELECT\n\t\tasl_dim_id,\n\t\tasl_code,\n\t\tsub_asl_code,\n\t\tsub_non_asl_code\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tasl_dim_id,\n\t\t\t\tasl_code,\n\t\t\t\tsub_asl_code,\n\t\t\t\tsub_non_asl_code\n\t\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.asl_dim\n\t\t\tWHERE crrnt_snpsht_flag=1\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY asl_code,sub_asl_code,sub_non_asl_code ORDER BY asl_dim_id DESC) = 1\n\t),\n\tLKP_asl_product_code AS (\n\t\tSELECT\n\t\tasl_prdct_code_dim_id,\n\t\tasl_prdct_code\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tasl_prdct_code_dim_id,\n\t\t\t\tasl_prdct_code\n\t\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.asl_product_code_dim\n\t\t\tWHERE crrnt_snpsht_flag=1\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY asl_prdct_code ORDER BY asl_prdct_code_dim_id DESC) = 1\n\t),\n\tLKP_RiskLocationDim AS (\n\t\tSELECT\n\t\tRiskLocationDimID,\n\t\tRiskLocationHashKey\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tRiskLocationDimID,\n\t\t\t\tRiskLocationHashKey\n\t\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocationDim\n\t\t\tWHERE CurrentSnapshotFlag=1\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY RiskLocationHashKey ORDER BY RiskLocationDimID) = 1\n\t),\n\tLKP_InsuranceReferenceDimId AS (\n\t\tSELECT\n\t\tInsuranceReferenceDimId,\n\t\tEnterpriseGroupCode,\n\t\tInsuranceReferenceLegalEntityCode,\n\t\tStrategicProfitCenterCode,\n\t\tInsuranceSegmentCode,\n\t\tPolicyOfferingCode,\n\t\tProductCode,\n\t\tInsuranceReferenceLineOfBusinessCode,\n\t\tRatingPlanCode\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tInsuranceReferenceDimId,\n\t\t\t\tEnterpriseGroupCode,\n\t\t\t\tInsuranceReferenceLegalEntityCode,\n\t\t\t\tStrategicProfitCenterCode,\n\t\t\t\tInsuranceSegmentCode,\n\t\t\t\tPolicyOfferingCode,\n\t\t\t\tProductCode,\n\t\t\t\tInsuranceReferenceLineOfBusinessCode,\n\t\t\t\tRatingPlanCode\n\t\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceDim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EnterpriseGroupCode,InsuranceReferenceLegalEntityCode,StrategicProfitCenterCode,InsuranceSegmentCode,PolicyOfferingCode,ProductCode,InsuranceReferenceLineOfBusinessCode,RatingPlanCode ORDER BY InsuranceReferenceDimId) = 1\n\t),\n\tEXP_Consolidate_Data_from_Lookups AS (\n\t\tSELECT\n\t\tEXP_EarnedPremiumCalculation_IN.AgencyDimID,\n\t\t-- *INF*: IIF(NOT ISNULL(AgencyDimID),AgencyDimID,-1)\n\t\tIFF(AgencyDimID IS NOT NULL, AgencyDimID, - 1) AS AgencyDimID_out,\n\t\tEXP_EarnedPremiumCalculation_IN.PolicyDimID,\n\t\t-- *INF*: IIF(NOT ISNULL(PolicyDimID),PolicyDimID,-1)\n\t\tIFF(PolicyDimID IS NOT NULL, PolicyDimID, - 1) AS PolicyDimID_out,\n\t\tEXP_EarnedPremiumCalculation_IN.ContractCustomerDimID,\n\t\t-- *INF*: IIF(NOT ISNULL(ContractCustomerDimID),ContractCustomerDimID,-1)\n\t\tIFF(ContractCustomerDimID IS NOT NULL, ContractCustomerDimID, - 1) AS ContractCustomerDimID_out,\n\t\tLKP_RiskLocationDim.RiskLocationDimID,\n\t\t-- *INF*: IIF(NOT ISNULL(RiskLocationDimID),RiskLocationDimID,-1)\n\t\tIFF(RiskLocationDimID IS NOT NULL, RiskLocationDimID, - 1) AS RiskLocationDimID_out,\n\t\tlkp_PremiumTransactionTypeDim.PremiumTransactionTypeDimID,\n\t\t-- *INF*: IIF(NOT ISNULL(PremiumTransactionTypeDimID),PremiumTransactionTypeDimID,-1)\n\t\tIFF(PremiumTransactionTypeDimID IS NOT NULL, PremiumTransactionTypeDimID, - 1) AS PremiumTransactionTypeDimID_out,\n\t\tEXP_EarnedPremiumCalculation_IN.EarnedPremium,\n\t\tEXP_EarnedPremiumCalculation_IN.ChangeInEarnedPremium,\n\t\tEXP_EarnedPremiumCalculation_IN.UnearnedPremium,\n\t\tEXP_EarnedPremiumCalculation_IN.ChangeInUnearnedPremium,\n\t\tEXP_EarnedPremiumCalculation_IN.PremiumTransactionBookedDate,\n\t\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PremiumTransactionBookedDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\t\tLKP_CALENDER_DIM_to_date_to_char_PremiumTransactionBookedDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PremiumTransactionBookedDateID,\n\t\t-- *INF*: IIF(NOT ISNULL(v_PremiumTransactionBookedDateID),v_PremiumTransactionBookedDateID,-1)\n\t\tIFF(v_PremiumTransactionBookedDateID IS NOT NULL, v_PremiumTransactionBookedDateID, - 1) AS PremiumTransactionBookedDateID_out,\n\t\tEXP_EarnedPremiumCalculation_IN.RunDate AS PremiumTransactionRunDate,\n\t\t-- *INF*: IIF((PremiumTransactionBookedDate<=LAST_DAY(PremiumTransactionRunDate)) AND (PremiumTransactionBookedDate>=\r\n\t\t-- SET_DATE_PART(SET_DATE_PART(SET_DATE_PART(SET_DATE_PART( PremiumTransactionRunDate, 'DD', 1 ),'HH',0),'MI',0),'SS',0)),'Y','N')\n\t\tIFF(\n\t\t    (PremiumTransactionBookedDate <= LAST_DAY(PremiumTransactionRunDate))\n\t\t    and (PremiumTransactionBookedDate >= DATEADD(SECOND,0-DATE_PART(SECOND,DATEADD(MINUTE,0-DATE_PART(MINUTE,DATEADD(HOUR,0-DATE_PART(HOUR,DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate)),DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate))),DATEADD(HOUR,0-DATE_PART(HOUR,DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate)),DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate)))),DATEADD(MINUTE,0-DATE_PART(MINUTE,DATEADD(HOUR,0-DATE_PART(HOUR,DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate)),DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate))),DATEADD(HOUR,0-DATE_PART(HOUR,DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate)),DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate))))),\n\t\t    'Y',\n\t\t    'N'\n\t\t) AS DateFlagForWrittenPremium,\n\t\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PremiumTransactionRunDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\t\tLKP_CALENDER_DIM_to_date_to_char_PremiumTransactionRunDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PremiumTransactionRunDateID,\n\t\t-- *INF*: IIF(NOT ISNULL(v_PremiumTransactionRunDateID),v_PremiumTransactionRunDateID,-1)\n\t\tIFF(v_PremiumTransactionRunDateID IS NOT NULL, v_PremiumTransactionRunDateID, - 1) AS PremiumTransactionRunDateID_out,\n\t\tEXP_EarnedPremiumCalculation_IN.PremiumTransactionEnteredDate,\n\t\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PremiumTransactionEnteredDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\t\tLKP_CALENDER_DIM_to_date_to_char_PremiumTransactionEnteredDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PremiumTransactionEnteredDateID,\n\t\t-- *INF*: IIF(NOT ISNULL(v_PremiumTransactionEnteredDateID),v_PremiumTransactionEnteredDateID,-1)\n\t\tIFF(v_PremiumTransactionEnteredDateID IS NOT NULL, v_PremiumTransactionEnteredDateID, - 1) AS PremiumTransactionEnteredDateID_out,\n\t\tEXP_EarnedPremiumCalculation_IN.PremiumTransactionEffectiveDate,\n\t\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PremiumTransactionEffectiveDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\t\tLKP_CALENDER_DIM_to_date_to_char_PremiumTransactionEffectiveDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PremiumTransactionEffectiveDateID,\n\t\t-- *INF*: IIF(NOT ISNULL(v_PremiumTransactionEffectiveDateID),v_PremiumTransactionEffectiveDateID,-1)\n\t\tIFF(\n\t\t    v_PremiumTransactionEffectiveDateID IS NOT NULL, v_PremiumTransactionEffectiveDateID, - 1\n\t\t) AS PremiumTransactionEffectiveDateID_out,\n\t\tEXP_EarnedPremiumCalculation_IN.PremiumTransactionExpirationDate,\n\t\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PremiumTransactionExpirationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\t\tLKP_CALENDER_DIM_to_date_to_char_PremiumTransactionExpirationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PremiumTransactionExpirationDateID,\n\t\t-- *INF*: IIF(NOT ISNULL(v_PremiumTransactionExpirationDateID),v_PremiumTransactionExpirationDateID,-1)\n\t\tIFF(\n\t\t    v_PremiumTransactionExpirationDateID IS NOT NULL, v_PremiumTransactionExpirationDateID, - 1\n\t\t) AS PremiumTransactionExpirationDateID_out,\n\t\tEXP_EarnedPremiumCalculation_IN.PremiumType,\n\t\tLKP_asl_dim.asl_dim_id AS ASLdimID,\n\t\t-- *INF*: IIF(NOT ISNULL(ASLdimID),ASLdimID,-1)\n\t\tIFF(ASLdimID IS NOT NULL, ASLdimID, - 1) AS ASLdimID_out,\n\t\tLKP_asl_product_code.asl_prdct_code_dim_id AS ASLproductcodedimID,\n\t\t-- *INF*: IIF(NOT ISNULL(ASLproductcodedimID),ASLproductcodedimID,-1)\n\t\tIFF(ASLproductcodedimID IS NOT NULL, ASLproductcodedimID, - 1) AS ASLproductcodedimID_out,\n\t\tEXP_EarnedPremiumCalculation_IN.PremiumMasterCalculationPKID,\n\t\tLKP_InsuranceReferenceDimId.InsuranceReferenceDimId,\n\t\t-- *INF*: IIF(ISNULL(InsuranceReferenceDimId), -1, InsuranceReferenceDimId)\n\t\tIFF(InsuranceReferenceDimId IS NULL, - 1, InsuranceReferenceDimId) AS o_InsuranceReferenceDimId,\n\t\tEXP_EarnedPremiumCalculation_IN.SourceSystemID,\n\t\tEXP_EarnedPremiumCalculation_IN.o_InsuranceReferenceCoverageDimId_PMS AS InsuranceReferenceCoverageDimId_PMS,\n\t\tEXP_EarnedPremiumCalculation_IN.o_InsuranceReferenceCoverageDimId_DCT AS InsuranceReferenceCoverageDimId_DCT,\n\t\t-- *INF*: DECODE(SourceSystemID,'DCT',InsuranceReferenceCoverageDimId_DCT,'PMS',InsuranceReferenceCoverageDimId_PMS)\n\t\tDECODE(\n\t\t    SourceSystemID,\n\t\t    'DCT', InsuranceReferenceCoverageDimId_DCT,\n\t\t    'PMS', InsuranceReferenceCoverageDimId_PMS\n\t\t) AS o_InsuranceReferenceCoverageDimId,\n\t\tEXP_EarnedPremiumCalculation_IN.o_CoverageDetailDimId_lkp AS CoverageDetailDimId,\n\t\tEXP_EarnedPremiumCalculation_IN.StatisticalCoverageCancellationDate AS i_StatisticalCoverageCancellationDate,\n\t\t-- *INF*: :LKP.LKP_CALENDER_DIM(TO_DATE(TO_CHAR(i_StatisticalCoverageCancellationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\t\tLKP_CALENDER_DIM_TO_DATE_TO_CHAR_i_StatisticalCoverageCancellationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_StatisticalCoverageCancellationDateId,\n\t\t-- *INF*: IIF(NOT ISNULL(v_StatisticalCoverageCancellationDateId),v_StatisticalCoverageCancellationDateId,-1)\n\t\tIFF(\n\t\t    v_StatisticalCoverageCancellationDateId IS NOT NULL, v_StatisticalCoverageCancellationDateId,\n\t\t    - 1\n\t\t) AS o_StatisticalCoverageCancellationDateId,\n\t\tEXP_EarnedPremiumCalculation_IN.o_GeneratedRecordIndicator AS GeneratedRecordIndicator,\n\t\tEXP_EarnedPremiumCalculation_IN.ModifiedPremiumType\n\t\tFROM EXP_EarnedPremiumCalculation_IN\n\t\tLEFT JOIN LKP_InsuranceReferenceDimId\n\t\tON LKP_InsuranceReferenceDimId.EnterpriseGroupCode = EXP_EarnedPremiumCalculation_IN.EnterpriseGroupCode AND LKP_InsuranceReferenceDimId.InsuranceReferenceLegalEntityCode = EXP_EarnedPremiumCalculation_IN.InsuranceReferenceLegalEntityCode AND LKP_InsuranceReferenceDimId.StrategicProfitCenterCode = EXP_EarnedPremiumCalculation_IN.StrategicProfitCenterCode AND LKP_InsuranceReferenceDimId.InsuranceSegmentCode = EXP_EarnedPremiumCalculation_IN.InsuranceSegmentCode AND LKP_InsuranceReferenceDimId.PolicyOfferingCode = EXP_EarnedPremiumCalculation_IN.PolicyOfferingCode AND LKP_InsuranceReferenceDimId.ProductCode = EXP_EarnedPremiumCalculation_IN.ProductCode AND LKP_InsuranceReferenceDimId.InsuranceReferenceLineOfBusinessCode = EXP_EarnedPremiumCalculation_IN.LineOfBusinessCode AND LKP_InsuranceReferenceDimId.RatingPlanCode = EXP_EarnedPremiumCalculation_IN.o_RatingPlanCode\n\t\tLEFT JOIN LKP_RiskLocationDim\n\t\tON LKP_RiskLocationDim.RiskLocationHashKey = EXP_EarnedPremiumCalculation_IN.RiskLocationHashKey\n\t\tLEFT JOIN LKP_asl_dim\n\t\tON LKP_asl_dim.asl_code = EXP_EarnedPremiumCalculation_IN.AnnualStatementLineCode AND LKP_asl_dim.sub_asl_code = EXP_EarnedPremiumCalculation_IN.SubAnnualStatementLineCode AND LKP_asl_dim.sub_non_asl_code = EXP_EarnedPremiumCalculation_IN.o_NonSubAnnualStatementLineCode\n\t\tLEFT JOIN LKP_asl_product_code\n\t\tON LKP_asl_product_code.asl_prdct_code = EXP_EarnedPremiumCalculation_IN.AnnualStatementLineProductCode\n\t\tLEFT JOIN lkp_PremiumTransactionTypeDim\n\t\tON lkp_PremiumTransactionTypeDim.PremiumTransactionCode = EXP_EarnedPremiumCalculation_IN.PremiumTransactionCode AND lkp_PremiumTransactionTypeDim.ReasonAmendedCode = EXP_EarnedPremiumCalculation_IN.ReasonAmendedCode AND lkp_PremiumTransactionTypeDim.PremiumTypeCode = EXP_EarnedPremiumCalculation_IN.PremiumType\n\t\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionBookedDate_MM_DD_YYYY_MM_DD_YYYY\n\t\tON LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionBookedDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PremiumTransactionBookedDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\t\n\t\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionRunDate_MM_DD_YYYY_MM_DD_YYYY\n\t\tON LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionRunDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PremiumTransactionRunDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\t\n\t\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionEnteredDate_MM_DD_YYYY_MM_DD_YYYY\n\t\tON LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionEnteredDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PremiumTransactionEnteredDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\t\n\t\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionEffectiveDate_MM_DD_YYYY_MM_DD_YYYY\n\t\tON LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionEffectiveDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PremiumTransactionEffectiveDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\t\n\t\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionExpirationDate_MM_DD_YYYY_MM_DD_YYYY\n\t\tON LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionExpirationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PremiumTransactionExpirationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\t\n\t\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_TO_DATE_TO_CHAR_i_StatisticalCoverageCancellationDate_MM_DD_YYYY_MM_DD_YYYY\n\t\tON LKP_CALENDER_DIM_TO_DATE_TO_CHAR_i_StatisticalCoverageCancellationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(TO_CHAR(i_StatisticalCoverageCancellationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\t\n\t),\n\tEXP_Evaluate_Fields AS (\n\t\tSELECT\n\t\tASLdimID_out AS AnnualStatementLineDimID,\n\t\tASLproductcodedimID_out AS AnnualStatementLineProductCodeDimID,\n\t\tAgencyDimID_out AS AgencyDimID,\n\t\tPolicyDimID_out AS PolicyDimID,\n\t\tContractCustomerDimID_out AS ContractCustomerDimID,\n\t\tRiskLocationDimID_out AS RiskLocationDimID,\n\t\tPremiumTransactionTypeDimID_out AS PremiumTransactionTypeDimID,\n\t\tPremiumTransactionEnteredDateID_out AS PremiumTransactionEnteredDateID,\n\t\tPremiumTransactionEffectiveDateID_out AS PremiumTransactionEffectiveDateID,\n\t\tPremiumTransactionExpirationDateID_out AS PremiumTransactionExpirationDateID,\n\t\tPremiumTransactionBookedDateID_out AS PremiumTransactionBookedDateID,\n\t\t-1 AS EDWEarnedPremiumMonthlyCalculationPKID,\n\t\tPremiumTransactionRunDateID_out AS PremiumTransactionRunDateID,\n\t\tDateFlagForWrittenPremium,\n\t\tPremiumType,\n\t\tChangeInEarnedPremium,\n\t\t-- *INF*: IIF(rtrim(PremiumType)='D',ChangeInEarnedPremium,0)\n\t\tIFF(rtrim(PremiumType) = 'D', ChangeInEarnedPremium, 0) AS v_ChangeinDirectEarnedPremium,\n\t\tv_ChangeinDirectEarnedPremium AS ChangeinDirectEarnedPremium,\n\t\to_InsuranceReferenceDimId AS InsuranceReferenceDimId,\n\t\tPremiumMasterCalculationPKID AS EDWPremiumMasterCalculationId,\n\t\to_InsuranceReferenceCoverageDimId AS InsuranceReferenceCoverageDimId,\n\t\tCoverageDetailDimId,\n\t\to_StatisticalCoverageCancellationDateId AS StatisticalCoverageCancellationDateId,\n\t\tGeneratedRecordIndicator,\n\t\tModifiedPremiumType\n\t\tFROM EXP_Consolidate_Data_from_Lookups\n\t),\n\tUnion_WC_OtherLinesGenerated AS (\n\t\tSELECT EDWPremiumMasterCalculationId, PremiumTransactionEnteredDateID AS PremiumTransactionEnteredDateId, PremiumTransactionEffectiveDateID AS PremiumTransactionEffectiveDateId, PremiumTransactionRunDateID AS EarnedPremiumRunDateId, AnnualStatementLineDimID, AnnualStatementLineProductCodeDimID AS AnnualStatementLineProductCodeDimId, AgencyDimID AS AgencyDimId, PolicyDimID AS PolicyDimId, ContractCustomerDimID AS ContractCustomerDimId, RiskLocationDimID AS RiskLocationDimId, PremiumTransactionTypeDimID AS PremiumTransactionTypeDimId, InsuranceReferenceDimId, InsuranceReferenceCoverageDimId, CoverageDetailDimId, PremiumTransactionBookedDateID AS PremiumTransactionBookedDateId, PremiumTransactionExpirationDateID AS PremiumTransactionExpirationDateId, StatisticalCoverageCancellationDateId AS CoverageCancellationDateId, GeneratedRecordIndicator AS GeneratedRecordFlag, ChangeinDirectEarnedPremium AS ChangeInEarnedPremium, ModifiedPremiumType, EDWEarnedPremiumMonthlyCalculationPKID\n\t\tFROM EXP_Evaluate_Fields\n\t\tUNION\n\t\tSELECT EDWPremiumMasterCalculationPKId AS EDWPremiumMasterCalculationId, PremiumTransactionEnteredDateID AS PremiumTransactionEnteredDateId, PremiumTransactionEffectiveDateID AS PremiumTransactionEffectiveDateId, PremiumTransactionRunDateID AS EarnedPremiumRunDateId, AnnualStatementLineDimID, AnnualStatementLineProductCodeDimID AS AnnualStatementLineProductCodeDimId, AgencyDimID AS AgencyDimId, PolicyDimID AS PolicyDimId, ContractCustomerDimID AS ContractCustomerDimId, RiskLocationDimID AS RiskLocationDimId, PremiumTransactionTypeDimID AS PremiumTransactionTypeDimId, InsuranceReferenceDimId, InsuranceReferenceCoverageDimId, CoverageDetailDimId, PremiumTransactionBookedDateID AS PremiumTransactionBookedDateId, PremiumTransactionExpirationDateID AS PremiumTransactionExpirationDateId, CoverageCancellationDateId, GeneratedRecordIndicator AS GeneratedRecordFlag, MonthlyChangeinDirectEarnedPremium AS ChangeInEarnedPremium, ModifiedPremiumType, EDWEarnedPremiumMonthlyCalculationPKID\n\t\tFROM EXP_DirectPremium\n\t),\n\tAGG_Premium AS (\n\t\tSELECT\n\t\tEDWPremiumMasterCalculationId,\n\t\tPremiumTransactionEnteredDateId,\n\t\tPremiumTransactionEffectiveDateId,\n\t\tEarnedPremiumRunDateId,\n\t\tAnnualStatementLineDimID,\n\t\tAnnualStatementLineProductCodeDimId,\n\t\tAgencyDimId,\n\t\tPolicyDimId,\n\t\tContractCustomerDimId,\n\t\tRiskLocationDimId,\n\t\tPremiumTransactionTypeDimId,\n\t\tInsuranceReferenceDimId,\n\t\tInsuranceReferenceCoverageDimId,\n\t\tCoverageDetailDimId,\n\t\tPremiumTransactionBookedDateId,\n\t\tPremiumTransactionExpirationDateId,\n\t\tCoverageCancellationDateId,\n\t\tGeneratedRecordFlag,\n\t\tEDWEarnedPremiumMonthlyCalculationPKID,\n\t\tChangeInEarnedPremium,\n\t\tModifiedPremiumType,\n\t\t-- *INF*: SUM(ChangeInEarnedPremium,ModifiedPremiumType='Direct')\n\t\tSUM(ChangeInEarnedPremium, ModifiedPremiumType = 'Direct') AS EarnedDirectWrittenPremium,\n\t\t-- *INF*: SUM(ChangeInEarnedPremium,ModifiedPremiumType='Classified')\n\t\tSUM(ChangeInEarnedPremium, ModifiedPremiumType = 'Classified') AS EarnedClassifiedPremium,\n\t\t-- *INF*: SUM(ChangeInEarnedPremium,ModifiedPremiumType='Ratable')\n\t\tSUM(ChangeInEarnedPremium, ModifiedPremiumType = 'Ratable') AS EarnedRatablePremium,\n\t\t-- *INF*: SUM(ChangeInEarnedPremium,ModifiedPremiumType='Other')\n\t\tSUM(ChangeInEarnedPremium, ModifiedPremiumType = 'Other') AS EarnedOtherModifiedPremium,\n\t\t-- *INF*: SUM(ChangeInEarnedPremium,ModifiedPremiumType='Schedule')\n\t\tSUM(ChangeInEarnedPremium, ModifiedPremiumType = 'Schedule') AS EarnedScheduleModifiedPremium,\n\t\t-- *INF*: SUM(ChangeInEarnedPremium,ModifiedPremiumType='Experience')\n\t\tSUM(ChangeInEarnedPremium, ModifiedPremiumType = 'Experience') AS EarnedExperienceModifiedPremium,\n\t\t-- *INF*: SUM(ChangeInEarnedPremium,ModifiedPremiumType='Subject')\n\t\tSUM(ChangeInEarnedPremium, ModifiedPremiumType = 'Subject') AS EarnedSubjectWrittenPremium\n\t\tFROM Union_WC_OtherLinesGenerated\n\t\tGROUP BY EDWPremiumMasterCalculationId, PremiumTransactionEnteredDateId, EarnedPremiumRunDateId, AnnualStatementLineDimID, AnnualStatementLineProductCodeDimId, GeneratedRecordFlag, EDWEarnedPremiumMonthlyCalculationPKID\n\t),\n\tEXP_DefaultPremium AS (\n\t\tSELECT\n\t\tEDWPremiumMasterCalculationId,\n\t\tPremiumTransactionEnteredDateId,\n\t\tPremiumTransactionEffectiveDateId,\n\t\tEarnedPremiumRunDateId,\n\t\tAnnualStatementLineDimID,\n\t\tAnnualStatementLineProductCodeDimId,\n\t\tAgencyDimId,\n\t\tPolicyDimId,\n\t\tContractCustomerDimId,\n\t\tRiskLocationDimId,\n\t\tPremiumTransactionTypeDimId,\n\t\tInsuranceReferenceDimId,\n\t\tInsuranceReferenceCoverageDimId,\n\t\tCoverageDetailDimId,\n\t\tPremiumTransactionBookedDateId,\n\t\tPremiumTransactionExpirationDateId,\n\t\tCoverageCancellationDateId,\n\t\tGeneratedRecordFlag,\n\t\tEarnedDirectWrittenPremium AS i_EarnedDirectWrittenPremium,\n\t\tEarnedClassifiedPremium AS i_EarnedClassifiedPremium,\n\t\tEarnedRatablePremium AS i_EarnedRatablePremium,\n\t\tEarnedOtherModifiedPremium AS i_EarnedOtherModifiedPremium,\n\t\tEarnedScheduleModifiedPremium AS i_EarnedScheduleModifiedPremium,\n\t\tEarnedExperienceModifiedPremium AS i_EarnedExperienceModifiedPremium,\n\t\tEarnedSubjectWrittenPremium AS i_EarnedSubjectWrittenPremium,\n\t\t-- *INF*: IIF(NOT ISNULL(i_EarnedDirectWrittenPremium),i_EarnedDirectWrittenPremium,0)\n\t\tIFF(i_EarnedDirectWrittenPremium IS NOT NULL, i_EarnedDirectWrittenPremium, 0) AS EarnedDirectWrittenPremium,\n\t\t-- *INF*: IIF(NOT ISNULL(i_EarnedClassifiedPremium),i_EarnedClassifiedPremium,0)\n\t\tIFF(i_EarnedClassifiedPremium IS NOT NULL, i_EarnedClassifiedPremium, 0) AS EarnedClassifiedPremium,\n\t\t-- *INF*: IIF(NOT ISNULL(i_EarnedRatablePremium),i_EarnedRatablePremium,0)\n\t\tIFF(i_EarnedRatablePremium IS NOT NULL, i_EarnedRatablePremium, 0) AS EarnedRatablePremium,\n\t\t-- *INF*: IIF(NOT ISNULL(i_EarnedOtherModifiedPremium),i_EarnedOtherModifiedPremium,0)\n\t\tIFF(i_EarnedOtherModifiedPremium IS NOT NULL, i_EarnedOtherModifiedPremium, 0) AS EarnedOtherModifiedPremium,\n\t\t-- *INF*: IIF(NOT ISNULL(i_EarnedScheduleModifiedPremium),i_EarnedScheduleModifiedPremium,0)\n\t\tIFF(i_EarnedScheduleModifiedPremium IS NOT NULL, i_EarnedScheduleModifiedPremium, 0) AS EarnedScheduleModifiedPremium,\n\t\t-- *INF*: IIF(NOT ISNULL(i_EarnedExperienceModifiedPremium),i_EarnedExperienceModifiedPremium,0)\n\t\tIFF(i_EarnedExperienceModifiedPremium IS NOT NULL, i_EarnedExperienceModifiedPremium, 0) AS EarnedExperienceModifiedPremium,\n\t\t-- *INF*: IIF(NOT ISNULL(i_EarnedSubjectWrittenPremium),i_EarnedSubjectWrittenPremium,0)\n\t\tIFF(i_EarnedSubjectWrittenPremium IS NOT NULL, i_EarnedSubjectWrittenPremium, 0) AS EarnedSubjectWrittenPremium,\n\t\tEDWEarnedPremiumMonthlyCalculationPKID\n\t\tFROM AGG_Premium\n\t),\n\tUnion_WC_OtherLinesGenerated_OtherLinesNatural AS (\n\t\tSELECT EDWPremiumMasterCalculationPKId AS EDWPremiumMasterCalculationId, PremiumTransactionEnteredDateID AS PremiumTransactionEnteredDateId, PremiumTransactionEffectiveDateID AS PremiumTransactionEffectiveDateId, PremiumTransactionRunDateID AS EarnedPremiumRunDateId, AnnualStatementLineDimID, AnnualStatementLineProductCodeDimID AS AnnualStatementLineProductCodeDimId, AgencyDimID AS AgencyDimId, PolicyDimID AS PolicyDimId, ContractCustomerDimID AS ContractCustomerDimId, RiskLocationDimID AS RiskLocationDimId, PremiumTransactionTypeDimID AS PremiumTransactionTypeDimId, InsuranceReferenceDimId, InsuranceReferenceCoverageDimId, CoverageDetailDimId, PremiumTransactionBookedDateID AS PremiumTransactionBookedDateId, PremiumTransactionExpirationDateID AS PremiumTransactionExpirationDateId, CoverageCancellationDateId, GeneratedRecordFlag, EarnedDirectWrittenPremium, EarnedClassifiedPremium, EarnedRatablePremium, o_EarnedOtherModifiedPremium AS EarnedOtherModifiedPremium, o_EarnedScheduleModifiedPremium AS EarnedScheduleModifiedPremium, o_EarnedExperienceModifiedPremium AS EarnedExperienceModifiedPremium, o_EarnedSubjectWrittenPremium AS EarnedSubjectWrittenPremium, EDWEarnedPremiumMonthlyCalculationPKID\n\t\tFROM EXP_OtherLinesEarnedPremium\n\t\tUNION\n\t\tSELECT EDWPremiumMasterCalculationId, PremiumTransactionEnteredDateId, PremiumTransactionEffectiveDateId, EarnedPremiumRunDateId, AnnualStatementLineDimID, AnnualStatementLineProductCodeDimId, AgencyDimId, PolicyDimId, ContractCustomerDimId, RiskLocationDimId, PremiumTransactionTypeDimId, InsuranceReferenceDimId, InsuranceReferenceCoverageDimId, CoverageDetailDimId, PremiumTransactionBookedDateId, PremiumTransactionExpirationDateId, CoverageCancellationDateId, GeneratedRecordFlag, EarnedDirectWrittenPremium, EarnedClassifiedPremium, EarnedRatablePremium, EarnedOtherModifiedPremium, EarnedScheduleModifiedPremium, EarnedExperienceModifiedPremium, EarnedSubjectWrittenPremium, EDWEarnedPremiumMonthlyCalculationPKID\n\t\tFROM EXP_DefaultPremium\n\t),\n\tOUTPUT AS (\n\t\tSELECT\n\t\tEDWPremiumMasterCalculationId, \n\t\tPremiumTransactionEnteredDateId, \n\t\tPremiumTransactionEffectiveDateId, \n\t\tEarnedPremiumRunDateId, \n\t\tAnnualStatementLineDimID, \n\t\tAnnualStatementLineProductCodeDimId, \n\t\tAgencyDimId, \n\t\tPolicyDimId, \n\t\tContractCustomerDimId, \n\t\tRiskLocationDimId, \n\t\tPremiumTransactionTypeDimId, \n\t\tInsuranceReferenceDimId, \n\t\tInsuranceReferenceCoverageDimId, \n\t\tCoverageDetailDimId, \n\t\tPremiumTransactionBookedDateId, \n\t\tPremiumTransactionExpirationDateId, \n\t\tCoverageCancellationDateId, \n\t\tGeneratedRecordFlag, \n\t\tEarnedDirectWrittenPremium, \n\t\tEarnedClassifiedPremium, \n\t\tEarnedRatablePremium, \n\t\tEarnedOtherModifiedPremium, \n\t\tEarnedScheduleModifiedPremium, \n\t\tEarnedExperienceModifiedPremium, \n\t\tEarnedSubjectWrittenPremium, \n\t\tEDWEarnedPremiumMonthlyCalculationPKID\n\t\tFROM Union_WC_OtherLinesGenerated_OtherLinesNatural\n\t),\n),\nEXP_Audit AS (\n\tSELECT\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditId,\n\tEDWPremiumMasterCalculationId,\n\tPremiumTransactionEnteredDateId2 AS PremiumTransactionEnteredDateId,\n\tPremiumTransactionEffectiveDateId2 AS PremiumTransactionEffectiveDateId,\n\t'0' AS DirectOrEarnedPremiumFlag,\n\tEarnedPremiumRunDateId,\n\tAnnualStatementLineDimID2 AS AnnualStatementLineDimID,\n\tAnnualStatementLineProductCodeDimId2 AS AnnualStatementLineProductCodeDimId,\n\tAgencyDimId3 AS AgencyDimId,\n\tPolicyDimId3 AS PolicyDimId,\n\tContractCustomerDimId3 AS ContractCustomerDimId,\n\tRiskLocationDimId2 AS RiskLocationDimId,\n\tPremiumTransactionTypeDimId2 AS PremiumTransactionTypeDimId,\n\tInsuranceReferenceDimId2 AS InsuranceReferenceDimId,\n\tInsuranceReferenceCoverageDimId2 AS InsuranceReferenceCoverageDimId,\n\tCoverageDetailDimId2 AS CoverageDetailDimId,\n\tPremiumTransactionBookedDateId2 AS PremiumTransactionBookedDateId,\n\tPremiumTransactionExpirationDateId2 AS PremiumTransactionExpirationDateId,\n\tCoverageCancellationDateId2 AS CoverageCancellationDateId,\n\tGeneratedRecordFlag,\n\t0 AS DirectWrittenPremium,\n\t0 AS RatablePremium,\n\t0 AS ClassifiedPremium,\n\t0 AS OtherModifiedPremium,\n\t0 AS ScheduleModifiedPremium,\n\t0 AS ExperienceModifiedPremium,\n\t0 AS SubjectWrittenPremium,\n\tEarnedDirectWrittenPremium,\n\tEarnedClassifiedPremium,\n\tEarnedRatablePremium,\n\tEarnedOtherModifiedPremium,\n\tEarnedScheduleModifiedPremium,\n\tEarnedExperienceModifiedPremium,\n\tEarnedSubjectWrittenPremium,\n\tEDWEarnedPremiumMonthlyCalculationPKID2 AS EDWEarnedPremiumMonthlyCalculationPKID\n\tFROM mplt_EarnedPremium\n),\nLKP_ModifiedEarnedPremiumTransactionMonthlyFact AS (\n\tSELECT\n\tModifiedEarnedPremiumTransactionMonthlyFactId,\n\tEDWPremiumMasterCalculationPKId,\n\tRunDateId,\n\tPremiumTransactionEnteredDateId,\n\tAnnualStatementLineDimID,\n\tAnnualStatementLineProductCodeDimId\n\tFROM (\n\t\tSELECT ModifiedEarnedPremiumTransactionMonthlyFactId as ModifiedEarnedPremiumTransactionMonthlyFactId,\r\n\t\tEDWPremiumMasterCalculationPKId as EDWPremiumMasterCalculationPKId,\r\n\t\tRunDateId as RunDateId,\r\n\t\tPremiumTransactionEnteredDateId as PremiumTransactionEnteredDateId,\r\n\t\tAnnualStatementLineDimID as AnnualStatementLineDimID,\r\n\t\tAnnualStatementLineProductCodeDimId as AnnualStatementLineProductCodeDimId\r\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.@{pipeline().parameters.TARGET_TABLE_NAME} F \r\n\t\t@{pipeline().parameters.TARGET_LOOKUP_SOURCE_FILTER}\r\n\t\tORDER BY EDWPremiumMasterCalculationPKId,RunDateId,PremiumTransactionEnteredDateId,AnnualStatementLineDimID,AnnualStatementLineProductCodeDimId --\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EDWPremiumMasterCalculationPKId,RunDateId,PremiumTransactionEnteredDateId,AnnualStatementLineDimID,AnnualStatementLineProductCodeDimId ORDER BY ModifiedEarnedPremiumTransactionMonthlyFactId) = 1\n),\nRTR_INSERT_UPDATE AS (\n\tSELECT\n\tLKP_ModifiedEarnedPremiumTransactionMonthlyFact.ModifiedEarnedPremiumTransactionMonthlyFactId AS ModifiedPremiumTransactionMonthlyFactId,\n\tEXP_Audit.AuditId,\n\tEXP_Audit.EDWPremiumMasterCalculationId,\n\tEXP_Audit.PremiumTransactionEnteredDateId,\n\tEXP_Audit.PremiumTransactionEffectiveDateId,\n\tEXP_Audit.EarnedPremiumRunDateId,\n\tEXP_Audit.DirectOrEarnedPremiumFlag,\n\tEXP_Audit.AnnualStatementLineDimID,\n\tEXP_Audit.AnnualStatementLineProductCodeDimId,\n\tEXP_Audit.AgencyDimId,\n\tEXP_Audit.PolicyDimId,\n\tEXP_Audit.ContractCustomerDimId,\n\tEXP_Audit.RiskLocationDimId,\n\tEXP_Audit.PremiumTransactionTypeDimId,\n\tEXP_Audit.InsuranceReferenceDimId,\n\tEXP_Audit.InsuranceReferenceCoverageDimId,\n\tEXP_Audit.CoverageDetailDimId,\n\tEXP_Audit.PremiumTransactionBookedDateId,\n\tEXP_Audit.PremiumTransactionExpirationDateId,\n\tEXP_Audit.CoverageCancellationDateId,\n\tEXP_Audit.GeneratedRecordFlag,\n\tEXP_Audit.DirectWrittenPremium,\n\tEXP_Audit.RatablePremium,\n\tEXP_Audit.ClassifiedPremium,\n\tEXP_Audit.OtherModifiedPremium,\n\tEXP_Audit.ScheduleModifiedPremium,\n\tEXP_Audit.ExperienceModifiedPremium,\n\tEXP_Audit.SubjectWrittenPremium,\n\tEXP_Audit.EarnedDirectWrittenPremium,\n\tEXP_Audit.EarnedClassifiedPremium,\n\tEXP_Audit.EarnedRatablePremium,\n\tEXP_Audit.EarnedOtherModifiedPremium,\n\tEXP_Audit.EarnedScheduleModifiedPremium,\n\tEXP_Audit.EarnedExperienceModifiedPremium,\n\tEXP_Audit.EarnedSubjectWrittenPremium,\n\tEXP_Audit.EDWEarnedPremiumMonthlyCalculationPKID\n\tFROM EXP_Audit\n\tLEFT JOIN LKP_ModifiedEarnedPremiumTransactionMonthlyFact\n\tON LKP_ModifiedEarnedPremiumTransactionMonthlyFact.EDWPremiumMasterCalculationPKId = EXP_Audit.EDWPremiumMasterCalculationId AND LKP_ModifiedEarnedPremiumTransactionMonthlyFact.RunDateId = EXP_Audit.EarnedPremiumRunDateId AND LKP_ModifiedEarnedPremiumTransactionMonthlyFact.PremiumTransactionEnteredDateId = EXP_Audit.PremiumTransactionEnteredDateId AND LKP_ModifiedEarnedPremiumTransactionMonthlyFact.AnnualStatementLineDimID = EXP_Audit.AnnualStatementLineDimID AND LKP_ModifiedEarnedPremiumTransactionMonthlyFact.AnnualStatementLineProductCodeDimId = EXP_Audit.AnnualStatementLineProductCodeDimId\n),\nRTR_INSERT_UPDATE_INSERT AS (SELECT * FROM RTR_INSERT_UPDATE WHERE ISNULL(ModifiedPremiumTransactionMonthlyFactId)),\nModifiedEarnedPremiumTransactionMonthlyFact AS (\n\n\t------------ PRE SQL ----------\n\t@{pipeline().parameters.PRE_SQL}\n\t-------------------------------\n\n\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.@{pipeline().parameters.TARGET_TABLE_NAME}\n\t(AuditId, AnnualStatementLineDimID, AnnualStatementLineProductCodeDimId, AgencyDimId, PolicyDimId, ContractCustomerDimId, RiskLocationDimId, InsuranceReferenceDimId, InsuranceReferenceCoverageDimId, CoverageDetailDimId, PremiumTransactionTypeDimId, EDWPremiumMasterCalculationPKId, RunDateId, PremiumTransactionEnteredDateId, PremiumTransactionEffectiveDateId, PremiumTransactionBookedDateId, PremiumTransactionExpirationDateId, CoverageCancellationDateId, GeneratedRecordFlag, EarnedDirectWrittenPremium, EarnedClassifiedPremium, EarnedRatablePremium, EarnedOtherModifiedPremium, EarnedScheduleModifiedPremium, EarnedExperienceModifiedPremium, EarnedSubjectWrittenPremium, EDWEarnedPremiumMonthlyCalculationPKID)\n\tSELECT \n\tAUDITID, \n\tANNUALSTATEMENTLINEDIMID, \n\tANNUALSTATEMENTLINEPRODUCTCODEDIMID, \n\tAGENCYDIMID, \n\tPOLICYDIMID, \n\tCONTRACTCUSTOMERDIMID, \n\tRISKLOCATIONDIMID, \n\tINSURANCEREFERENCEDIMID, \n\tINSURANCEREFERENCECOVERAGEDIMID, \n\tCOVERAGEDETAILDIMID, \n\tPREMIUMTRANSACTIONTYPEDIMID, \n\tEDWPremiumMasterCalculationId AS EDWPREMIUMMASTERCALCULATIONPKID, \n\tEarnedPremiumRunDateId AS RUNDATEID, \n\tPREMIUMTRANSACTIONENTEREDDATEID, \n\tPREMIUMTRANSACTIONEFFECTIVEDATEID, \n\tPREMIUMTRANSACTIONBOOKEDDATEID, \n\tPREMIUMTRANSACTIONEXPIRATIONDATEID, \n\tCOVERAGECANCELLATIONDATEID, \n\tGENERATEDRECORDFLAG, \n\tEARNEDDIRECTWRITTENPREMIUM, \n\tEARNEDCLASSIFIEDPREMIUM, \n\tEARNEDRATABLEPREMIUM, \n\tEARNEDOTHERMODIFIEDPREMIUM, \n\tEARNEDSCHEDULEMODIFIEDPREMIUM, \n\tEARNEDEXPERIENCEMODIFIEDPREMIUM, \n\tEARNEDSUBJECTWRITTENPREMIUM, \n\tEDWEARNEDPREMIUMMONTHLYCALCULATIONPKID\n\tFROM RTR_INSERT_UPDATE_INSERT\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_EPTMF_SINCE_LAST_LOAD": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "JOIN_POLICY_LIST_IL": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_WEMP_SINCE_LAST_LOAD": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_TABLE_OWNER_V2": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "JOIN_PREMIUMTRANSACTION_LIST": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_NAME": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_LOOKUP_SOURCE_FILTER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "PRE_SQL": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "PolicyDataMart/"
        },
        "annotations": []
    }
}