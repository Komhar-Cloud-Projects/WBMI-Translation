{
    "name": "s_m_POL_CUS_DM_LOAD_Policy_Dim",
    "properties": {
        "activities": [
            {
                "name": "m_POL_CUS_DM_LOAD_Policy_Dim",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_All_Support_tables AS (\n\tSELECT\n\tdescript,\n\tsource_sys_id,\n\ttablename,\n\tcode\n\tFROM (\n\t\tSELECT \r\n\t\t\tbill_plan_use_code_descript as descript,\r\n\t\t\t'sup_bill_plan_use_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(bill_plan_use_code)) as code\r\n\t\tFROM \tsup_bill_plan_use_code \r\n\t\tWHERE   sup_bill_plan_use_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tbill_type_code_descript as descript,\r\n\t\t\t'sup_bill_type_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(bill_type_code)) as code\r\n\t\tFROM \tsup_bill_type_code \r\n\t\tWHERE   sup_bill_type_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tbill_class_code_descript as descript,\r\n\t\t\t'sup_bill_class_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(bill_class_code)) as code\r\n\t\tFROM \tsup_bill_class_code \r\n\t\tWHERE   sup_bill_class_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tbill_trans_code_descript as descript,\r\n\t\t\t'sup_bill_transaction_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(bill_trans_code)) as code\t\r\n\t\tFROM \tsup_bill_transaction_code \r\n\t\tWHERE   sup_bill_transaction_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tars_type_code_descript as descript,\r\n\t\t\t'sup_bill_ars_type_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(ars_type_code)) as code\r\n\t\tFROM \tsup_bill_ars_type_code \r\n\t\tWHERE   sup_bill_ars_type_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tpayby_code_descript as descript,\r\n\t\t\t'sup_payby_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(payby_code)) as code\r\n\t\tFROM \tsup_payby_code \r\n\t\tWHERE   sup_payby_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tmrktng_pkg_description as descript,\r\n\t\t\t'sup_marketing_package_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(mrktng_pkg_code)) as code\r\n\t\tFROM \tsup_marketing_package_code\r\n\t\tWHERE   sup_marketing_package_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\texcess_claim_code_descript as descript,\r\n\t\t\t'sup_excess_claim_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(excess_claim_code)) as code\r\n\t\tFROM \tsup_excess_claim_code\r\n\t\tWHERE   sup_excess_claim_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tnon_smoker_disc_code_descript as descript,\r\n\t\t\t'sup_non_smoker_discount_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(non_smoker_disc_code)) as code\r\n\t\tFROM \tsup_non_smoker_discount_code\r\n\t\tWHERE   sup_non_smoker_discount_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tvariation_code_descript as descript,\r\n\t\t\t'sup_policy_variation_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(variation_code)) as code\t\r\n\t\tFROM \tsup_policy_variation_code\r\n\t\tWHERE   sup_policy_variation_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tpol_audit_frqncy_descript as descript,\r\n\t\t\t'sup_policy_audit_frequency' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(pol_audit_frqncy)) as code\r\n\t\tFROM \tsup_policy_audit_frequency\r\n\t\tWHERE   sup_policy_audit_frequency.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\trenl_code_descript as descript,\r\n\t\t\t'sup_policy_renewal_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(renl_code)) as code\r\n\t\tFROM \tsup_policy_renewal_code\r\n\t\tWHERE   sup_policy_renewal_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tmvr_request_code_descript as descript,\r\n\t\t\t'sup_mvr_request_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(mvr_request_code)) as code\t\r\n\t\tFROM \tsup_mvr_request_code\r\n\t\tWHERE   sup_mvr_request_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tindustry_risk_grade_code_descript as descript,\r\n\t\t\t'sup_industry_risk_grade_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(industry_risk_grade_code)) as code\t\r\n\t\tFROM \tsup_industry_risk_grade_code\r\n\t\tWHERE   sup_industry_risk_grade_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tpol_issue_code_descript as descript,\r\n\t\t\t'sup_policy_issue_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(pol_issue_code)) as code\r\n\t\tFROM \tsup_policy_issue_code\r\n\t\tWHERE   sup_policy_issue_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT\r\n\t\t\tpol_status_code_descript as descript, \r\n\t\t\t'sup_policy_status_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(pol_status_code)) as code\r\n\t\tFROM \tsup_policy_status_code\r\n\t\tWHERE   sup_policy_status_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT\r\n\t\t\tpol_term_descript as descript, \r\n\t\t\t'sup_policy_term' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(pol_term)) as code\r\n\t\tFROM \tsup_policy_term\r\n\t\tWHERE   sup_policy_term.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tserv_center_support_code_descript as descript,\r\n\t\t\t'sup_service_center_support_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(serv_center_support_code)) as code\r\n\t\tFROM \tsup_service_center_support_code\r\n\t\tWHERE   sup_service_center_support_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\twbconnect_upload_code_descript as descript,\r\n\t\t\t'sup_wbconnect_upload_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(wbconnect_upload_code)) as code\r\n\t\tFROM \tsup_wbconnect_upload_code\r\n\t\tWHERE   sup_wbconnect_upload_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tstate_descript as descript,\r\n\t\t\t'sup_state' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(state_abbrev)) as code\r\n\t\tFROM \tsup_state\r\n\t\tWHERE   sup_state.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tstate_descript as descript,\r\n\t\t\t'sup_state' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(state_code)) as code\r\n\t\tFROM \tsup_state\r\n\t\tWHERE   sup_state.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tstate_code as descript,\r\n\t\t\t'sup_state_abbrev' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(state_abbrev)) as code\r\n\t\tFROM \tsup_state\r\n\t\tWHERE   sup_state.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tpol_co_num_descript as descript,\r\n\t\t\t'sup_policy_company_number' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(pol_co_num)) as code\r\n\t\tFROM \tsup_policy_company_number\r\n\t\tWHERE   sup_policy_company_number.crrnt_snpsht_flag=1\r\n\t\t\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tpol_co_line_code_descript as descript,\r\n\t\t\t'sup_policy_company_line_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(pol_co_line_code)) as code\r\n\t\tFROM \tsup_policy_company_line_code\r\n\t\tWHERE   sup_policy_company_line_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\treins_code_descript as descript,\r\n\t\t\t'sup_reinsurance_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(reins_code)) as code\r\n\t\tFROM \tsup_reinsurance_code\r\n\t\tWHERE   sup_reinsurance_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tbus_class_code_descript as descript,\r\n\t\t\t'sup_business_classification_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(bus_class_code)) as code\r\n\t\tFROM \tsup_business_classification_code\r\n\t\tWHERE   sup_business_classification_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\ttarget_mrkt_code_descript as descript,\r\n\t\t\t'sup_target_market_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(target_mrkt_code)) as code\r\n\t\tFROM \tsup_target_market_code\r\n\t\tWHERE   sup_target_market_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tassoc_prog_code_descript as descript,\r\n\t\t\t'sup_association_program_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(assoc_prog_code)) as code\r\n\t\tFROM \tsup_association_program_code\r\n\t\tWHERE   sup_association_program_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tlgl_ent_code_descript as descript,\r\n\t\t\t'sup_legal_entity_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(lgl_ent_code)) as code\r\n\t\tFROM \tsup_legal_entity_code\r\n\t\tWHERE   sup_legal_entity_code.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tcdt_rating_score_descript as descript,\r\n\t\t\t'sup_credit_rating_score' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(cdt_rating_score)) as code\r\n\t\tFROM \tsup_credit_rating_score\r\n\t\tWHERE   sup_credit_rating_score.crrnt_snpsht_flag=1\r\n\t\tUNION ALL\r\n\t\tSELECT \r\n\t\t\tsic_code_descript as descript,\r\n\t\t\t'sup_sic_code' AS tablename ,\r\n\t\t\tLTRIM(RTRIM(sic_code)) as code\r\n\t\tFROM \tsup_sic_code\r\n\t\tWHERE   sup_sic_code.crrnt_snpsht_flag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY source_sys_id,tablename,code ORDER BY descript DESC) = 1\n),\nLKP_AgencyEmployeeDim_DCT AS (\n\tSELECT\n\tAgencyEmployeeDimID,\n\tAgencyCode,\n\tAgencyEmployeeUserID\n\tFROM (\n\t\tselect a.AgencyEmployeeDimID as AgencyEmployeeDimID,\r\n\t\tLTRIM(RTRIM(c.AgencyCode)) as AgencyCode,\r\n\t\tLTRIM(RTRIM(a.AgencyEmployeeUserID)) as AgencyEmployeeUserID\r\n\t\tfrom @{pipeline().parameters.TARGET_TABLE_OWNER}.AgencyEmployeeDim a\r\n\t\tjoin @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.AgencyEmployee b\r\n\t\ton a.EDWAgencyEmployeeAKID=b.AgencyEmployeeAKID\r\n\t\tand a.CurrentSnapshotFlag=1\r\n\t\tand b.CurrentSnapshotFlag=1\r\n\t\tjoin @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.Agency c\r\n\t\ton b.AgencyAKID=c.AgencyAKID\r\n\t\tand c.CurrentSnapshotFlag=1\r\n\t\twhere a.AgencyEmployeeUserID<>'N/A'\r\n\t\torder by c.AgencyCode,a.AgencyEmployeeUserID,a.AgencyEmployeeDimID desc\r\n\t\t--\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY AgencyCode,AgencyEmployeeUserID ORDER BY AgencyEmployeeDimID) = 1\n),\nSQ_policy AS (\n\tSELECT\n\t\tpol_id,\n\t\tcrrnt_snpsht_flag,\n\t\taudit_id,\n\t\teff_from_date,\n\t\teff_to_date,\n\t\tsource_sys_id,\n\t\tcreated_date,\n\t\tmodified_date,\n\t\tpol_ak_id,\n\t\tcontract_cust_ak_id,\n\t\tAgencyAKId AS agencyakid,\n\t\tpol_sym,\n\t\tpol_num,\n\t\tpol_mod,\n\t\tpol_key,\n\t\tmco,\n\t\tpol_co_num,\n\t\tpol_eff_date,\n\t\tpol_exp_date,\n\t\torig_incptn_date,\n\t\tprim_bus_class_code,\n\t\treins_code,\n\t\tpms_pol_lob_code,\n\t\tpol_co_line_code,\n\t\tpol_cancellation_ind,\n\t\tpol_cancellation_date,\n\t\tpol_cancellation_rsn_code,\n\t\tstate_of_domicile_code,\n\t\twbconnect_upload_code,\n\t\tserv_center_support_code,\n\t\tpol_term,\n\t\tterrorism_risk_ind,\n\t\tprior_pol_key,\n\t\tpol_status_code,\n\t\tpol_issue_code,\n\t\tpol_age,\n\t\tindustry_risk_grade_code,\n\t\tuw_review_yr,\n\t\tmvr_request_code,\n\t\trenl_code,\n\t\tamend_num,\n\t\tanniversary_rerate_code,\n\t\tpol_audit_frqncy,\n\t\tfinal_audit_code,\n\t\tzip_ind,\n\t\tguarantee_ind,\n\t\tvariation_code,\n\t\tcounty,\n\t\tnon_smoker_disc_code,\n\t\trenl_disc,\n\t\trenl_safe_driver_disc_count,\n\t\tnonrenewal_flag_date,\n\t\taudit_complt_date,\n\t\torig_acct_date,\n\t\tpol_enter_date,\n\t\texcess_claim_code,\n\t\tpol_status_on_pif,\n\t\ttarget_mrkt_code,\n\t\tpkg_code,\n\t\tpol_kind_code,\n\t\tbus_seg_code,\n\t\tpif_upload_audit_ind,\n\t\terr_flag_bal_txn,\n\t\terr_flag_bal_reins,\n\t\tproducer_code_ak_id,\n\t\tprdcr_code,\n\t\tClassOfBusiness,\n\t\tstrtgc_bus_dvsn_ak_id,\n\t\tErrorFlagBalancePremiumTransaction,\n\t\tRenewalPolicyNumber,\n\t\tRenewalPolicySymbol,\n\t\tRenewalPolicyMod,\n\t\tBillingType,\n\t\tproducer_code_id,\n\t\tsup_bus_class_code_id,\n\t\tsup_pol_term_id,\n\t\tsup_pol_status_code_id,\n\t\tsup_pol_issue_code_id,\n\t\tsup_pol_audit_frqncy_id,\n\t\tsup_industry_risk_grade_code_id,\n\t\tsup_state_id,\n\t\tSupSurchargeExemptID,\n\t\tInsuranceSegmentAKId,\n\t\tProgramAKId,\n\t\tUnderwritingAssociateAKId,\n\t\tObligeeName,\n\t\tAutomatedUnderwritingServicesIndicator,\n\t\tAutomaticRenewalIndicator,\n\t\tAssociationCode,\n\t\tRolloverPolicyIndicator,\n\t\tRolloverPriorCarrier,\n\t\tMailToInsuredFlag,\n\t\tAgencyEmployeeAKId,\n\t\tPolicyIssueCodeOverride,\n\t\tDCBillFlag,\n\t\tIssuedUWID,\n\t\tIssuedUnderwriter\n\tFROM policy\n\tWHERE (policy.created_date>='@{pipeline().parameters.SELECTION_START_TS}' OR policy.modified_date>='@{pipeline().parameters.SELECTION_START_TS}')\n),\nEXP_values AS (\n\tSELECT\n\tpol_id,\n\teff_from_date,\n\tpol_ak_id,\n\tpol_sym,\n\tpol_num,\n\tpol_mod,\n\tpol_key,\n\tmco,\n\tpol_co_num AS in_pol_co_num,\n\tpol_eff_date,\n\tpol_exp_date,\n\torig_incptn_date,\n\tprim_bus_class_code,\n\treins_code,\n\tpms_pol_lob_code,\n\tpol_co_line_code,\n\tpol_cancellation_ind,\n\tpol_cancellation_date,\n\tpol_cancellation_rsn_code,\n\tstate_of_domicile_code,\n\twbconnect_upload_code,\n\tserv_center_support_code,\n\tpol_term,\n\tterrorism_risk_ind,\n\tprior_pol_key AS in_prior_pol_key,\n\t-- *INF*: iif(substr(in_prior_pol_key,1,1)='+','N/A',iif(substr(in_prior_pol_key,14,1)='+','N/A',in_prior_pol_key))\n\tIFF(substr(in_prior_pol_key, 1, 1) = '+', 'N/A', IFF(substr(in_prior_pol_key, 14, 1) = '+', 'N/A', in_prior_pol_key)) AS prior_pol_key,\n\tpol_status_code,\n\tpol_issue_code,\n\tpol_age,\n\tindustry_risk_grade_code,\n\tuw_review_yr,\n\tmvr_request_code,\n\trenl_code,\n\tamend_num,\n\tanniversary_rerate_code,\n\tpol_audit_frqncy,\n\tfinal_audit_code,\n\tzip_ind,\n\tguarantee_ind,\n\tvariation_code,\n\tcounty,\n\tnon_smoker_disc_code,\n\trenl_disc,\n\trenl_safe_driver_disc_count,\n\tnonrenewal_flag_date,\n\taudit_complt_date,\n\torig_acct_date,\n\tpol_enter_date,\n\texcess_claim_code,\n\tpol_status_on_pif,\n\ttarget_mrkt_code AS target_mrkt_code1,\n\t-- *INF*: :UDF.LTRIM_RTRIM(target_mrkt_code1)\n\t:UDF.LTRIM_RTRIM(target_mrkt_code1) AS target_mrkt_code,\n\tpkg_code AS pkg_code1,\n\t-- *INF*: :UDF.LTRIM_RTRIM(pkg_code1)\n\t:UDF.LTRIM_RTRIM(pkg_code1) AS pkg_code,\n\tpol_kind_code AS pol_kind_code1,\n\t-- *INF*: :UDF.LTRIM_RTRIM(pol_kind_code1)\n\t:UDF.LTRIM_RTRIM(pol_kind_code1) AS pol_kind_code,\n\tbus_seg_code AS bus_seg_code1,\n\t-- *INF*: :UDF.LTRIM_RTRIM(bus_seg_code1)\n\t:UDF.LTRIM_RTRIM(bus_seg_code1) AS bus_seg_code,\n\tpif_upload_audit_ind AS pif_upload_audit_ind1,\n\t-- *INF*: :UDF.LTRIM_RTRIM(pif_upload_audit_ind1)\n\t:UDF.LTRIM_RTRIM(pif_upload_audit_ind1) AS pif_upload_audit_ind,\n\terr_flag_bal_txn,\n\terr_flag_bal_reins,\n\tprdcr_code,\n\tClassOfBusiness,\n\tErrorFlagBalancePremiumTransaction,\n\tRenewalPolicyNumber,\n\tRenewalPolicySymbol,\n\tRenewalPolicyMod,\n\tBillingType,\n\tsource_sys_id,\n\tsup_bus_class_code_id,\n\tsup_pol_term_id,\n\tsup_pol_status_code_id,\n\tsup_pol_issue_code_id,\n\tsup_pol_audit_frqncy_id,\n\tsup_industry_risk_grade_code_id,\n\tsup_state_id,\n\tSupSurchargeExemptID,\n\tInsuranceSegmentAKId,\n\tProgramAKId,\n\tUnderwritingAssociateAKId,\n\tagencyakid AS AgencyAKId,\n\tObligeeName,\n\tAutomatedUnderwritingServicesIndicator,\n\tAutomaticRenewalIndicator AS i_AutomaticRenewalIndicator,\n\t-- *INF*: IIF(i_AutomaticRenewalIndicator='T', '1', '0')\n\tIFF(i_AutomaticRenewalIndicator = 'T', '1', '0') AS o_AutomaticRenewalIndicator,\n\tAssociationCode,\n\tRolloverPolicyIndicator AS i_RolloverPolicyIndicator,\n\t-- *INF*: IIF(i_RolloverPolicyIndicator='T','1','0')\n\tIFF(i_RolloverPolicyIndicator = 'T', '1', '0') AS o_RolloverPolicyIndicator,\n\tRolloverPriorCarrier,\n\tMailToInsuredFlag AS i_MailToInsuredFlag,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_MailToInsuredFlag='T','1',\r\n\t-- i_MailToInsuredFlag='1','1',\r\n\t-- '0')\n\tDECODE(TRUE,\n\t\ti_MailToInsuredFlag = 'T', '1',\n\t\ti_MailToInsuredFlag = '1', '1',\n\t\t'0') AS o_MailToInsuredFlag,\n\tAgencyEmployeeAKId,\n\tPolicyIssueCodeOverride AS i_PolicyIssueCodeOverride,\n\t-- *INF*: IIF(i_PolicyIssueCodeOverride='T','Y','N')\n\tIFF(i_PolicyIssueCodeOverride = 'T', 'Y', 'N') AS o_PolicyIssueCodeOverride,\n\tDCBillFlag,\n\tIssuedUWID,\n\tIssuedUnderwriter\n\tFROM SQ_policy\n),\nLKP_AgencyEmployeeDim AS (\n\tSELECT\n\tAgencyEmployeeDimId,\n\tEDWAgencyEmployeeAKId,\n\tAgencyEmployeeAKId\n\tFROM (\n\t\tSELECT \n\t\t\tAgencyEmployeeDimId,\n\t\t\tEDWAgencyEmployeeAKId,\n\t\t\tAgencyEmployeeAKId\n\t\tFROM AgencyEmployeeDim\n\t\tWHERE CurrentSnapshotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EDWAgencyEmployeeAKId ORDER BY AgencyEmployeeDimId) = 1\n),\nLKP_Agency_V2 AS (\n\tSELECT\n\tAgencyCode,\n\tAgencyAKID\n\tFROM (\n\t\tSELECT \n\t\t\tAgencyCode,\n\t\t\tAgencyAKID\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.Agency\n\t\tWHERE CurrentSnapshotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY AgencyAKID ORDER BY AgencyCode) = 1\n),\nLKP_AssociationDescription AS (\n\tSELECT\n\tAssociationDescription,\n\tAssociationCode\n\tFROM (\n\t\tSELECT \n\t\t\tAssociationDescription,\n\t\t\tAssociationCode\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.Association\n\t\tWHERE CurrentSnapshotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY AssociationCode ORDER BY AssociationDescription) = 1\n),\nLKP_AssociationDiscountFactor_DCT AS (\n\tSELECT\n\tAssociationDiscountFactor,\n\tPolicyKey,\n\tAssociationCode\n\tFROM (\n\t\tselect DISTINCT (case when wbp.AssociationDiscountFactor is not null then wbp.AssociationDiscountFactor\r\n\t\t     when WBIM.AssociationFactor is not null then WBIM.AssociationFactor\r\n\t\t\t when wbbp.AssociationFactorliability is not null then wbbp.AssociationFactorliability\r\n\t\t\t when wbbp.AssociationFactorProperty is not null then wbbp.AssociationFactorProperty\r\n\t\t\t when loc.AssociationFactor is not null then loc.AssociationFactor\r\n\t\t\t else 0 end ) as AssociationDiscountFactor,\r\n\t\tLTRIM(RTRIM(DCP.PolicyNumber))+ISNULL(WBP.PolicyVersionFormatted,'00') as PolicyKey,\r\n\t\tLTRIM(RTRIM(WBP.Association)) AS AssociationCode\r\n\t\tfrom DCPolicyStaging DCP\r\n\t\tJOIN WBPolicyStaging WBP\r\n\t\tON DCP.PolicyId=WBP.PolicyId \r\n\t\tand DCP.SessionId=WBP.SessionId\r\n\t\tjoin DCTransactionStaging DCT\r\n\t\ton dct.SessionId = dcp.SessionId\r\n\t\tand dct.HistoryID in (select max(historyid) from DCTransactionStaging where SessionId= dct.SessionId)\r\n\t\tand dct.state = 'committed'\r\n\t\tJOIN DCLineStaging DCL\r\n\t\ton dcp.PolicyId=dcl.PolicyId\r\n\t\tleft join DCIMLineStage DCIM\r\n\t\ton dcim.LineId = dcl.LineId\r\n\t\tleft join WBIMLineStage wbim\r\n\t\ton dcim.IM_LineId = wbim.IM_LineId\r\n\t\tleft join DCBPlineStage DCBP\r\n\t\ton dcl.LineId = dcbp.LineId\r\n\t\tleft join WBBPLineStage wbbp\r\n\t\ton wbbp.BP_LineId = dcbp.BP_LineId\r\n\t\tleft hash join (\r\n\t\tselect dcl.SessionId, wbgla.AssociationFactor \r\n\t\tfrom DCLocationStaging dcl\r\n\t\tjoin DCLocationAssociationStaging dcla\r\n\t\ton dcl.SessionId = dcla.SessionId\r\n\t\tand dcla.LocationId = dcl.LocationId\r\n\t\tjoin DCGLLocationStaging dcgl1\r\n\t\ton dcgl1.GL_LocationId = dcla.ObjectId\r\n\t\tand dcla.ObjectName = 'DC_GL_Location'\r\n\t\tjoin WBLocationAccountStage wbla\r\n\t\ton dcl.LocationId = wbla.LocationId\r\n\t\tjoin WBCLLocationAccountStage wbcla\r\n\t\ton wbla.WBLocationAccountId = wbcla.WBLocationAccountId\r\n\t\tjoin WBGLLocationAccountStage wbgla\r\n\t\ton wbcla.WBCLLocationAccountId = wbgla.WB_CL_LocationAccountId) loc\r\n\t\ton dcl.SessionId = loc.SessionId\r\n\t\t--and dcl.type in ('GeneralLiability','SBOPGeneralLiability')\r\n\t\t\r\n\t\tWHERE WBP.Association='ABC'\r\n\t\tAND (WBP.AssociationDiscountFactor IS NOT NULL\r\n\t\tOR WBIM.AssociationFactor IS NOT NULL\r\n\t\tOR WBBP.AssociationFactorLiability IS NOT NULL\r\n\t\tOR WBBP.AssociationFactorProperty IS NOT NULL\r\n\t\tOR loc.AssociationFactor IS NOT NULL\r\n\t\t)\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey,AssociationCode ORDER BY AssociationDiscountFactor) = 1\n),\nLKP_AssociationDiscountPercentage AS (\n\tSELECT\n\tAssociationDiscountPercentage,\n\tPolicyKey,\n\tAssociationCode\n\tFROM (\n\t\tSELECT\r\n\t\tpol_key AS PolicyKey,\r\n\t\tAssociationCode AS AssociationCode,\r\n\t\tCASE WHEN InsuranceLineList='CF,,' THEN PackagePropertyPercentage\r\n\t\t  WHEN InsuranceLineList='CF,CR,IM' THEN PackageCrimeInlandMarinePercentage\r\n\t\t WHEN InsuranceLineList='CR,IM,' THEN PackageNoPropertyCrimePercentage\r\n\t\t ELSE 0 END AS AssociationDiscountPercentage\r\n\t\tFROM\r\n\t\t(\r\n\t\tselect distinct\r\n\t\tpol_key, \r\n\t\tMAX(case when seq=1 then InsuranceLine else '' end)+','+MAX(case when seq=2 then InsuranceLine else '' end)\r\n\t\t +','+MAX(case when seq=3 then InsuranceLine else '' end) as InsuranceLineList,\r\n\t\tMAX(AssociationCode) as AssociationCode,\r\n\t\tMAX(AssociationDescription) as AssociationDescription,\r\n\t\tMAX(PackagePropertyPercentage) as PackagePropertyPercentage,\r\n\t\tMAX(PackageCrimeInlandMarinePercentage) as PackageCrimeInlandMarinePercentage,\r\n\t\tMAX(PackageNoPropertyCrimePercentage) as PackageNoPropertyCrimePercentage\r\n\t\tfrom (select pol_key,\r\n\t\tInsuranceLine,\r\n\t\tROW_NUMBER() over (PARTITION BY pol_key order by insuranceline) seq,\r\n\t\tAssociationCode,\r\n\t\tAssociationDescription,\r\n\t\tPackagePropertyPercentage,\r\n\t\tPackageCrimeInlandMarinePercentage,\r\n\t\tPackageNoPropertyCrimePercentage\r\n\t\tfrom (SELECT  distinct \r\n\t\tpol.pol_key,\r\n\t\tpc.InsuranceLine,\r\n\t\tassoc.AssociationCode,\r\n\t\tassoc.AssociationDescription,\r\n\t\tassoc.PackagePropertyPercentage,\r\n\t\tassoc.PackageCrimeInlandMarinePercentage,\r\n\t\tassoc.PackageNoPropertyCrimePercentage\r\n\t\t FROM @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy pol \r\n\t\tJOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage pc\r\n\t\t ON pol.pol_ak_id=pc.PolicyAKID\r\n\t\t AND pol.crrnt_snpsht_flag=1 \r\n\t\tJOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Association assoc \r\n\t\ton pol.AssociationCode=assoc.AssociationCode and assoc.CurrentSnapshotFlag=1\r\n\t\tWHERE pol.AssociationCode IN ('AE','AG') \r\n\t\tand pc.InsuranceLine in ('CF','IM','CR')) source) order_source\r\n\t\tgroup by pol_key\r\n\t\t)T\r\n\t\t\r\n\t\torder by PolicyKey,AssociationCode\r\n\t\t--\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey,AssociationCode ORDER BY AssociationDiscountPercentage) = 1\n),\nLKP_BusinessClassDim AS (\n\tSELECT\n\ti_pol_eff_date,\n\tBusinessClassDimId,\n\tCurrentSnapshotFlag,\n\tAuditId,\n\tEffectiveDate,\n\tExpirationDate,\n\tSourceSystemId,\n\tCreatedDate,\n\tModifiedDate,\n\tBusinessClassCode,\n\tBusinessClassDescription,\n\tBusinessSegmentCode,\n\tBusinessSegmentDescription,\n\tStrategicBusinessGroupCode,\n\tStrategicBusinessGroupDescription\n\tFROM (\n\t\tSELECT \n\t\t\ti_pol_eff_date,\n\t\t\tBusinessClassDimId,\n\t\t\tCurrentSnapshotFlag,\n\t\t\tAuditId,\n\t\t\tEffectiveDate,\n\t\t\tExpirationDate,\n\t\t\tSourceSystemId,\n\t\t\tCreatedDate,\n\t\t\tModifiedDate,\n\t\t\tBusinessClassCode,\n\t\t\tBusinessClassDescription,\n\t\t\tBusinessSegmentCode,\n\t\t\tBusinessSegmentDescription,\n\t\t\tStrategicBusinessGroupCode,\n\t\t\tStrategicBusinessGroupDescription\n\t\tFROM BusinessClassDim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EffectiveDate,ExpirationDate,BusinessClassCode ORDER BY i_pol_eff_date) = 1\n),\nLKP_InsuranceSegment AS (\n\tSELECT\n\tInsuranceSegmentCode,\n\tInsuranceSegmentDescription,\n\tInsuranceSegmentAKId\n\tFROM (\n\t\tSELECT \n\t\t\tInsuranceSegmentCode,\n\t\t\tInsuranceSegmentDescription,\n\t\t\tInsuranceSegmentAKId\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment\n\t\tWHERE CurrentSnapshotFlag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY InsuranceSegmentAKId ORDER BY InsuranceSegmentCode) = 1\n),\nLKP_Program AS (\n\tSELECT\n\tProgramCode,\n\tProgramDescription,\n\tProgramAKId\n\tFROM (\n\t\tSELECT \n\t\t\tProgramCode,\n\t\t\tProgramDescription,\n\t\t\tProgramAKId\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.Program\n\t\tWHERE CurrentSnapshotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ProgramAKId ORDER BY ProgramCode) = 1\n),\nLKP_QuoteDim AS (\n\tSELECT\n\tQuoteChannel,\n\tQuoteChannelOrigin,\n\tQuoteNumber\n\tFROM (\n\t\tSELECT \n\t\t\tQuoteChannel,\n\t\t\tQuoteChannelOrigin,\n\t\t\tQuoteNumber\n\t\tFROM QuoteDim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY QuoteNumber ORDER BY QuoteChannel) = 1\n),\nLKP_SupSurchargeExempt AS (\n\tSELECT\n\tStandardSurchargeExemptCode,\n\tStandardSurchargeExemptDescription,\n\tSupSurchargeExemptId\n\tFROM (\n\t\tSELECT \n\t\t\tStandardSurchargeExemptCode,\n\t\t\tStandardSurchargeExemptDescription,\n\t\t\tSupSurchargeExemptId\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.SupSurchargeExempt\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY SupSurchargeExemptId ORDER BY StandardSurchargeExemptCode) = 1\n),\nLKP_UnderWritingDivisionDim AS (\n\tSELECT\n\tUnderwritingDivisionDimID,\n\tEDWUnderwritingAssociateAKID\n\tFROM (\n\t\tSELECT \n\t\t\tUnderwritingDivisionDimID,\n\t\t\tEDWUnderwritingAssociateAKID\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.UnderwritingDivisionDim\n\t\tWHERE CurrentSnapshotFlag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EDWUnderwritingAssociateAKID ORDER BY UnderwritingDivisionDimID) = 1\n),\nLKP_UserId AS (\n\tSELECT\n\tUserID,\n\tPolicyNumber,\n\tPolicyVersion\n\tFROM (\n\t\tselect LTRIM(RTRIM(substring(name,CHARINDEX('\\',name)+1,len(Name)))) as UserID,\r\n\t\tDCP.PolicyNumber as PolicyNumber,\r\n\t\tISNULL(WBP.PolicyVersionFormatted,'00') as PolicyVersion\r\n\t\tfrom @{pipeline().parameters.SOURCE_TABLE_OWNER}.DCPolicyStaging DCP\r\n\t\tinner hash join @{pipeline().parameters.SOURCE_TABLE_OWNER}.WBPolicyStaging WBP\r\n\t\ton DCP.PolicyId=WBP.PolicyId\r\n\t\tand DCP.SessionId=WBP.SessionId\r\n\t\tinner hash join @{pipeline().parameters.SOURCE_TABLE_OWNER}.WBProducerStage WBProducer\r\n\t\ton DCP.PolicyId=WBProducer.PolicyId\r\n\t\tand DCP.SessionId=WBP.SessionId\r\n\t\torder by DCP.PolicyNumber,WBP.PolicyVersion,DCP.SessionId desc--\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyNumber,PolicyVersion ORDER BY UserID) = 1\n),\nLKP_sup_business_classification_code AS (\n\tSELECT\n\tStandardBusinessClassCode,\n\tStandardBusinessClassCodeDescription,\n\tsup_bus_class_code_id\n\tFROM (\n\t\tSELECT \n\t\t\tStandardBusinessClassCode,\n\t\t\tStandardBusinessClassCodeDescription,\n\t\t\tsup_bus_class_code_id\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_business_classification_code\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY sup_bus_class_code_id ORDER BY StandardBusinessClassCode DESC) = 1\n),\nLKP_sup_industry_risk_grade_code AS (\n\tSELECT\n\tStandardIndustryRiskGradeCode,\n\tStandardIndustryRiskGradeCodeDescription,\n\tsup_industry_risk_grade_code_id\n\tFROM (\n\t\tSELECT \n\t\t\tStandardIndustryRiskGradeCode,\n\t\t\tStandardIndustryRiskGradeCodeDescription,\n\t\t\tsup_industry_risk_grade_code_id\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_industry_risk_grade_code\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY sup_industry_risk_grade_code_id ORDER BY StandardIndustryRiskGradeCode DESC) = 1\n),\nLKP_sup_policy_audit_frequency AS (\n\tSELECT\n\tStandardPolicyAuditFrequency,\n\tStandardPolicyAuditFrequencyDescription,\n\tsup_pol_audit_frqncy_id\n\tFROM (\n\t\tSELECT \n\t\t\tStandardPolicyAuditFrequency,\n\t\t\tStandardPolicyAuditFrequencyDescription,\n\t\t\tsup_pol_audit_frqncy_id\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_policy_audit_frequency\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY sup_pol_audit_frqncy_id ORDER BY StandardPolicyAuditFrequency DESC) = 1\n),\nLKP_sup_policy_issue_code AS (\n\tSELECT\n\tStandardPolicyIssueCode,\n\tStandardPolicyIssueCodeDescription,\n\tsup_pol_issue_code_id\n\tFROM (\n\t\tSELECT \n\t\t\tStandardPolicyIssueCode,\n\t\t\tStandardPolicyIssueCodeDescription,\n\t\t\tsup_pol_issue_code_id\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_policy_issue_code\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY sup_pol_issue_code_id ORDER BY StandardPolicyIssueCode DESC) = 1\n),\nLKP_sup_policy_status_code AS (\n\tSELECT\n\tStandardPolicyStatusCode,\n\tStandardPolicyStatusCodeDescription,\n\tsup_pol_status_code_id\n\tFROM (\n\t\tSELECT \n\t\t\tStandardPolicyStatusCode,\n\t\t\tStandardPolicyStatusCodeDescription,\n\t\t\tsup_pol_status_code_id\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_policy_status_code\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY sup_pol_status_code_id ORDER BY StandardPolicyStatusCode DESC) = 1\n),\nLKP_sup_policy_term AS (\n\tSELECT\n\tStandardPolicyTerm,\n\tStandardPolicyTermDescription,\n\tsup_pol_term_id\n\tFROM (\n\t\tSELECT \n\t\t\tStandardPolicyTerm,\n\t\t\tStandardPolicyTermDescription,\n\t\t\tsup_pol_term_id\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_policy_term\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY sup_pol_term_id ORDER BY StandardPolicyTerm DESC) = 1\n),\nLKP_sup_state AS (\n\tSELECT\n\tstate_code,\n\tstate_descript,\n\tsup_state_id\n\tFROM (\n\t\tSELECT \n\t\t\tstate_code,\n\t\t\tstate_descript,\n\t\t\tsup_state_id\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_state\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY sup_state_id ORDER BY state_code DESC) = 1\n),\nEXP_sup_description AS (\n\tSELECT\n\tEXP_values.source_sys_id AS i_source_sys_id,\n\tEXP_values.pol_id,\n\tEXP_values.pol_ak_id,\n\tEXP_values.pol_sym,\n\tEXP_values.pol_num,\n\tEXP_values.pol_mod,\n\tEXP_values.pol_key,\n\tEXP_values.mco,\n\tEXP_values.prdcr_code,\n\tLKP_InsuranceSegment.InsuranceSegmentCode AS StandardInsuranceSegmentCode,\n\tLKP_InsuranceSegment.InsuranceSegmentDescription AS StandardInsuranceSegmentDescription,\n\tLKP_sup_business_classification_code.StandardBusinessClassCode,\n\tLKP_sup_business_classification_code.StandardBusinessClassCodeDescription,\n\tLKP_sup_policy_term.StandardPolicyTerm,\n\tLKP_sup_policy_term.StandardPolicyTermDescription,\n\tLKP_sup_policy_status_code.StandardPolicyStatusCode,\n\tLKP_sup_policy_status_code.StandardPolicyStatusCodeDescription,\n\tLKP_sup_policy_issue_code.StandardPolicyIssueCode,\n\tLKP_sup_policy_issue_code.StandardPolicyIssueCodeDescription,\n\tLKP_sup_industry_risk_grade_code.StandardIndustryRiskGradeCode,\n\tLKP_sup_industry_risk_grade_code.StandardIndustryRiskGradeCodeDescription,\n\tLKP_sup_policy_audit_frequency.StandardPolicyAuditFrequency,\n\tLKP_sup_policy_audit_frequency.StandardPolicyAuditFrequencyDescription,\n\tLKP_sup_state.state_code AS StandardStateAbbreviation,\n\tLKP_sup_state.state_descript AS StandardStateDescription,\n\tLKP_SupSurchargeExempt.StandardSurchargeExemptCode,\n\tLKP_SupSurchargeExempt.StandardSurchargeExemptDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(prdcr_code)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(prdcr_code) AS producer_code,\n\tEXP_values.in_pol_co_num AS pol_co_num,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id), 'sup_policy_company_number',:UDF.LTRIM_RTRIM(pol_co_num))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_company_number_UDF_LTRIM_RTRIM_pol_co_num.descript AS v_pol_co_num_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_co_num_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_co_num_descript) AS pol_co_num_descript,\n\tEXP_values.pol_eff_date,\n\tEXP_values.pol_exp_date,\n\tEXP_values.orig_incptn_date,\n\tEXP_values.prim_bus_class_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM('DCT'),'sup_business_classification_code',:UDF.LTRIM_RTRIM(prim_bus_class_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_DCT_sup_business_classification_code_UDF_LTRIM_RTRIM_prim_bus_class_code.descript AS v_prim_bus_class_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_prim_bus_class_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_prim_bus_class_code_descript) AS prim_bus_class_code_descript,\n\tEXP_values.reins_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_reinsurance_code',:UDF.LTRIM_RTRIM(reins_code))\r\n\t-- \r\n\t-- \n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_reinsurance_code_UDF_LTRIM_RTRIM_reins_code.descript AS v_reins_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_reins_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_reins_code_descript) AS reins_code_descript,\n\tEXP_values.pms_pol_lob_code,\n\t'N/A' AS pms_pol_lob_code_descript,\n\tEXP_values.pol_co_line_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_policy_company_line_code',:UDF.LTRIM_RTRIM(pol_co_line_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_company_line_code_UDF_LTRIM_RTRIM_pol_co_line_code.descript AS v_pol_co_line_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_co_line_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_co_line_code_descript) AS pol_co_line_code_descript,\n\tEXP_values.pol_cancellation_ind,\n\tEXP_values.pol_cancellation_date,\n\tEXP_values.pol_cancellation_rsn_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_reason_amended_code',:UDF.LTRIM_RTRIM(pol_cancellation_rsn_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_reason_amended_code_UDF_LTRIM_RTRIM_pol_cancellation_rsn_code.descript AS v_pol_cancellation_rsn_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_cancellation_rsn_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_cancellation_rsn_code_descript) AS pol_cancellation_rsn_code_descript,\n\tEXP_values.state_of_domicile_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_state_abbrev',:UDF.LTRIM_RTRIM(state_of_domicile_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_state_abbrev_UDF_LTRIM_RTRIM_state_of_domicile_code.descript AS v_state_of_domicile_code_abbrev,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_state_of_domicile_code_abbrev)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_state_of_domicile_code_abbrev) AS state_of_domicile_code_abbrev,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM('EXCEED'),'sup_state',:UDF.LTRIM_RTRIM(state_of_domicile_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_EXCEED_sup_state_UDF_LTRIM_RTRIM_state_of_domicile_code.descript AS v_state_of_domicile_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_state_of_domicile_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_state_of_domicile_code_descript) AS state_of_domicile_code_descript,\n\tEXP_values.wbconnect_upload_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_wbconnect_upload_code',:UDF.LTRIM_RTRIM(wbconnect_upload_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_wbconnect_upload_code_UDF_LTRIM_RTRIM_wbconnect_upload_code.descript AS v_wbconnect_upload_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_wbconnect_upload_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_wbconnect_upload_code_descript) AS wbconnect_upload_code_descript,\n\tEXP_values.serv_center_support_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_service_center_support_code',:UDF.LTRIM_RTRIM(serv_center_support_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_service_center_support_code_UDF_LTRIM_RTRIM_serv_center_support_code.descript AS v_serv_center_support_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_serv_center_support_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_serv_center_support_code_descript) AS serv_center_support_code_descript,\n\tEXP_values.pol_term,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM('PMS'),'sup_policy_term',:UDF.LTRIM_RTRIM(pol_term))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_term_UDF_LTRIM_RTRIM_pol_term.descript AS v_pol_term_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_term_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_term_descript) AS pol_term_descript,\n\tEXP_values.terrorism_risk_ind,\n\tEXP_values.prior_pol_key,\n\tEXP_values.pol_status_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_policy_status_code',:UDF.LTRIM_RTRIM(pol_status_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_status_code_UDF_LTRIM_RTRIM_pol_status_code.descript AS v_pol_status_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_status_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_status_code_descript) AS pol_status_code_descript,\n\t'N/A' AS pol_count_type_code,\n\tEXP_values.pol_issue_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM('PMS'),'sup_policy_issue_code',:UDF.LTRIM_RTRIM(pol_issue_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_issue_code_UDF_LTRIM_RTRIM_pol_issue_code.descript AS v_pol_issue_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_issue_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_issue_code_descript) AS pol_issue_code_descript,\n\tEXP_values.pol_age,\n\tEXP_values.industry_risk_grade_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM('PMS'),'sup_industry_risk_grade_code',:UDF.LTRIM_RTRIM(industry_risk_grade_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_industry_risk_grade_code_UDF_LTRIM_RTRIM_industry_risk_grade_code.descript AS v_industry_risk_grade_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_industry_risk_grade_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_industry_risk_grade_code_descript) AS industry_risk_grade_code_descript,\n\tEXP_values.uw_review_yr,\n\tEXP_values.mvr_request_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_mvr_request_code',:UDF.LTRIM_RTRIM(mvr_request_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_mvr_request_code_UDF_LTRIM_RTRIM_mvr_request_code.descript AS v_mvr_request_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_mvr_request_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_mvr_request_code_descript) AS mvr_request_code_descript,\n\tEXP_values.renl_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_policy_renewal_code',:UDF.LTRIM_RTRIM(renl_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_renewal_code_UDF_LTRIM_RTRIM_renl_code.descript AS v_renl_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_renl_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_renl_code_descript) AS renl_code_descript,\n\tEXP_values.amend_num,\n\tEXP_values.anniversary_rerate_code,\n\tEXP_values.pol_audit_frqncy,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM('PMS'),'sup_policy_audit_frequency',:UDF.LTRIM_RTRIM(pol_audit_frqncy))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_audit_frequency_UDF_LTRIM_RTRIM_pol_audit_frqncy.descript AS v_pol_audit_frqncy_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_audit_frqncy_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_pol_audit_frqncy_descript) AS pol_audit_frqncy_descript,\n\tEXP_values.final_audit_code,\n\tEXP_values.zip_ind,\n\tEXP_values.guarantee_ind,\n\tEXP_values.variation_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_policy_variation_code',:UDF.LTRIM_RTRIM(variation_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_variation_code_UDF_LTRIM_RTRIM_variation_code.descript AS v_variation_ind_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_variation_ind_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_variation_ind_descript) AS variation_ind_descript,\n\tEXP_values.county,\n\tEXP_values.non_smoker_disc_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_non_smoker_discount_code',:UDF.LTRIM_RTRIM(non_smoker_disc_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_non_smoker_discount_code_UDF_LTRIM_RTRIM_non_smoker_disc_code.descript AS v_non_smoker_disc_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_non_smoker_disc_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_non_smoker_disc_code_descript) AS non_smoker_disc_code_descript,\n\tEXP_values.renl_disc,\n\tEXP_values.renl_safe_driver_disc_count,\n\tEXP_values.nonrenewal_flag_date,\n\tEXP_values.audit_complt_date,\n\tEXP_values.orig_acct_date,\n\tEXP_values.pol_enter_date,\n\tEXP_values.excess_claim_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_excess_claim_code',:UDF.LTRIM_RTRIM(excess_claim_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_excess_claim_code_UDF_LTRIM_RTRIM_excess_claim_code.descript AS v_excess_claim_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_excess_claim_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_excess_claim_code_descript) AS excess_claim_code_descript,\n\tEXP_values.pol_status_on_pif,\n\tEXP_values.target_mrkt_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_target_market_code',:UDF.LTRIM_RTRIM(target_mrkt_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_target_market_code_UDF_LTRIM_RTRIM_target_mrkt_code.descript AS v_target_mrkt_code_descript,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_target_mrkt_code_descript)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_target_mrkt_code_descript) AS target_mrkt_code_descript,\n\tEXP_values.pkg_code,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_marketing_package_code',:UDF.LTRIM_RTRIM(pkg_code))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_marketing_package_code_UDF_LTRIM_RTRIM_pkg_code.descript AS v_mrktng_pkg_description,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_mrktng_pkg_description)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_mrktng_pkg_description) AS mrktng_pkg_description,\n\tEXP_values.pol_kind_code,\n\t'N/A' AS pol_kind_code_description,\n\tEXP_values.bus_seg_code,\n\t-- *INF*: IIF(pol_sym='000',bus_seg_code,'N/A')\n\tIFF(pol_sym = '000', bus_seg_code, 'N/A') AS bus_seg_code_description,\n\tEXP_values.pif_upload_audit_ind,\n\t1 AS crrnt_snpsht_flag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS audit_id,\n\tEXP_values.eff_from_date,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS eff_to_date,\n\tSYSDATE AS created_date,\n\tSYSDATE AS modified_date,\n\tEXP_values.err_flag_bal_txn,\n\tEXP_values.err_flag_bal_reins,\n\t-- *INF*: Decode(TRUE,\r\n\t-- substr(pol_sym,1,1)='N','N',\r\n\t-- in(substr(pol_sym,1,1),'R','S','T') and pms_pol_lob_code='WCP','N',\r\n\t-- in(substr(pol_sym,1,1),'A','J','L'),'A',\r\n\t-- 'W')\r\n\t-- \n\tDecode(TRUE,\n\t\tsubstr(pol_sym, 1, 1) = 'N', 'N',\n\t\tin(substr(pol_sym, 1, 1), 'R', 'S', 'T') AND pms_pol_lob_code = 'WCP', 'N',\n\t\tin(substr(pol_sym, 1, 1), 'A', 'J', 'L'), 'A',\n\t\t'W') AS reporting_dvsn_code,\n\tEXP_values.ClassOfBusiness,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(ClassOfBusiness)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(ClassOfBusiness) AS class_of_business,\n\t-- *INF*: :LKP.LKP_ALL_SUPPORT_TABLES(:UDF.LTRIM_RTRIM(i_source_sys_id),'sup_association_program_code',:UDF.LTRIM_RTRIM(ClassOfBusiness))\n\tLKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_association_program_code_UDF_LTRIM_RTRIM_ClassOfBusiness.descript AS v_ClassOfBusinessCodeDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_ClassOfBusinessCodeDescription)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_ClassOfBusinessCodeDescription) AS ClassOfBusinessCodeDescription,\n\t'N/A' AS policy_type,\n\t'N/A' AS prog_code,\n\t'N/A' AS prog_code_desc,\n\tEXP_values.ErrorFlagBalancePremiumTransaction,\n\tEXP_values.RenewalPolicyNumber,\n\tEXP_values.RenewalPolicySymbol,\n\tEXP_values.RenewalPolicyMod,\n\tEXP_values.BillingType,\n\tLKP_Program.ProgramCode AS i_ProgramCode,\n\tLKP_Program.ProgramDescription AS i_ProgramDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardInsuranceSegmentCode)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardInsuranceSegmentCode) AS o_StandardInsuranceSegmentCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardInsuranceSegmentDescription)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardInsuranceSegmentDescription) AS o_StandardInsuranceSegmentDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardBusinessClassCode)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardBusinessClassCode) AS o_StandardBusinessClassCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardBusinessClassCodeDescription)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardBusinessClassCodeDescription) AS o_StandardBusinessClassCodeDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyTerm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyTerm) AS o_StandardPolicyTerm,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyTermDescription)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyTermDescription) AS o_StandardPolicyTermDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyStatusCode)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyStatusCode) AS o_StandardPolicyStatusCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyStatusCodeDescription)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyStatusCodeDescription) AS o_StandardPolicyStatusCodeDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyIssueCode)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyIssueCode) AS o_StandardPolicyIssueCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyIssueCodeDescription)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyIssueCodeDescription) AS o_StandardPolicyIssueCodeDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardIndustryRiskGradeCode)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardIndustryRiskGradeCode) AS o_StandardIndustryRiskGradeCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardIndustryRiskGradeCodeDescription)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardIndustryRiskGradeCodeDescription) AS o_StandardIndustryRiskGradeCodeDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyAuditFrequency)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyAuditFrequency) AS o_StandardPolicyAuditFrequency,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyAuditFrequencyDescription)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardPolicyAuditFrequencyDescription) AS o_StandardPolicyAuditFrequencyDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardStateAbbreviation)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardStateAbbreviation) AS o_StandardStateAbbreviation,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardStateDescription)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardStateDescription) AS o_StandardStateDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardSurchargeExemptCode)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardSurchargeExemptCode) AS o_StandardSurchargeExemptCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(StandardSurchargeExemptDescription)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(StandardSurchargeExemptDescription) AS o_StandardSurchargeExemptDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_ProgramCode)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(i_ProgramCode) AS o_ProgramCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_ProgramDescription)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(i_ProgramDescription) AS o_ProgramDescription,\n\tLKP_UnderWritingDivisionDim.UnderwritingDivisionDimID,\n\tLKP_UserId.UserID AS i_UserID,\n\tLKP_Agency_V2.AgencyCode AS i_AgencyCode,\n\t-- *INF*: LTRIM(RTRIM(i_AgencyCode))\n\tLTRIM(RTRIM(i_AgencyCode)) AS v_AgencyCode,\n\tLKP_AgencyEmployeeDim.AgencyEmployeeDimId AS i_AgencyEmployeeDimID,\n\t-- *INF*: IIF(ISNULL(i_AgencyEmployeeDimID),-1,i_AgencyEmployeeDimID)\n\tIFF(i_AgencyEmployeeDimID IS NULL, - 1, i_AgencyEmployeeDimID) AS v_AgencyEmployeeDimID,\n\tv_AgencyEmployeeDimID AS o_AgencyEmployeeDimID,\n\tEXP_values.ObligeeName,\n\tEXP_values.AutomatedUnderwritingServicesIndicator,\n\tEXP_values.o_AutomaticRenewalIndicator AS AutomaticRenewalIndicator,\n\tEXP_values.AssociationCode,\n\tLKP_AssociationDescription.AssociationDescription AS i_AssociationDescription,\n\t-- *INF*: IIF(ISNULL(i_AssociationDescription),'N/A',i_AssociationDescription)\n\tIFF(i_AssociationDescription IS NULL, 'N/A', i_AssociationDescription) AS o_AssociationDescription,\n\tLKP_AssociationDiscountPercentage.AssociationDiscountPercentage AS i_AssociationDiscountPercentage_PMS,\n\t-- *INF*: IIF(ISNULL(i_AssociationDiscountPercentage_PMS),0,i_AssociationDiscountPercentage_PMS)\n\tIFF(i_AssociationDiscountPercentage_PMS IS NULL, 0, i_AssociationDiscountPercentage_PMS) AS v_AssociationDiscountPercentage_PMS,\n\tLKP_AssociationDiscountFactor_DCT.AssociationDiscountFactor AS i_AssociationDiscountFactor_DCT,\n\t-- *INF*: IIF(ISNULL(i_AssociationDiscountFactor_DCT),0,i_AssociationDiscountFactor_DCT)\n\tIFF(i_AssociationDiscountFactor_DCT IS NULL, 0, i_AssociationDiscountFactor_DCT) AS v_AssociationDiscountFactor_DCT,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_source_sys_id='PMS',v_AssociationDiscountPercentage_PMS,\r\n\t-- i_source_sys_id='DCT',v_AssociationDiscountFactor_DCT,0\r\n\t-- )\n\tDECODE(TRUE,\n\t\ti_source_sys_id = 'PMS', v_AssociationDiscountPercentage_PMS,\n\t\ti_source_sys_id = 'DCT', v_AssociationDiscountFactor_DCT,\n\t\t0) AS o_AssociationDiscountPercentage,\n\t'N/A' AS o_ExpiringPriorPolicyKey,\n\tLKP_BusinessClassDim.BusinessClassDimId AS i_BusinessClassDimId,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_INTEGERS(i_BusinessClassDimId)\n\t:UDF.DEFAULT_VALUE_FOR_INTEGERS(i_BusinessClassDimId) AS o_BusinessClassDimId,\n\tEXP_values.o_RolloverPolicyIndicator AS RolloverPolicyIndicator,\n\tEXP_values.RolloverPriorCarrier,\n\tEXP_values.o_MailToInsuredFlag AS MailToInsuredFlag,\n\tEXP_values.o_PolicyIssueCodeOverride AS PolicyIssueCodeOverride,\n\tEXP_values.DCBillFlag,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- DCBillFlag='T',1,\r\n\t-- 0)\n\tDECODE(TRUE,\n\t\tDCBillFlag = 'T', 1,\n\t\t0) AS out_DCBillFlag,\n\tEXP_values.IssuedUWID AS i_IssuedUWID,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_IssuedUWID)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(i_IssuedUWID) AS o_IssuedUWID,\n\tEXP_values.IssuedUnderwriter AS i_IssuedUnderwriter,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_IssuedUnderwriter)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(i_IssuedUnderwriter) AS o_IssuedUnderwriter,\n\tLKP_QuoteDim.QuoteChannel,\n\t-- *INF*: iif(isnull(QuoteChannel), 'N/A',QuoteChannel)\n\tIFF(QuoteChannel IS NULL, 'N/A', QuoteChannel) AS o_QuoteChannel,\n\tLKP_QuoteDim.QuoteChannelOrigin,\n\t-- *INF*: iif(isnull(QuoteChannelOrigin), 'N/A',QuoteChannelOrigin)\n\tIFF(QuoteChannelOrigin IS NULL, 'N/A', QuoteChannelOrigin) AS o_QuoteChannelOrigin\n\tFROM EXP_values\n\tLEFT JOIN LKP_AgencyEmployeeDim\n\tON LKP_AgencyEmployeeDim.EDWAgencyEmployeeAKId = EXP_values.AgencyEmployeeAKId\n\tLEFT JOIN LKP_Agency_V2\n\tON LKP_Agency_V2.AgencyAKID = EXP_values.AgencyAKId\n\tLEFT JOIN LKP_AssociationDescription\n\tON LKP_AssociationDescription.AssociationCode = EXP_values.AssociationCode\n\tLEFT JOIN LKP_AssociationDiscountFactor_DCT\n\tON LKP_AssociationDiscountFactor_DCT.PolicyKey = EXP_values.pol_key AND LKP_AssociationDiscountFactor_DCT.AssociationCode = EXP_values.AssociationCode\n\tLEFT JOIN LKP_AssociationDiscountPercentage\n\tON LKP_AssociationDiscountPercentage.PolicyKey = EXP_values.pol_key AND LKP_AssociationDiscountPercentage.AssociationCode = EXP_values.AssociationCode\n\tLEFT JOIN LKP_BusinessClassDim\n\tON LKP_BusinessClassDim.EffectiveDate <= EXP_values.pol_eff_date AND LKP_BusinessClassDim.ExpirationDate >= EXP_values.pol_eff_date AND LKP_BusinessClassDim.BusinessClassCode = EXP_values.prim_bus_class_code\n\tLEFT JOIN LKP_InsuranceSegment\n\tON LKP_InsuranceSegment.InsuranceSegmentAKId = EXP_values.InsuranceSegmentAKId\n\tLEFT JOIN LKP_Program\n\tON LKP_Program.ProgramAKId = EXP_values.ProgramAKId\n\tLEFT JOIN LKP_QuoteDim\n\tON LKP_QuoteDim.QuoteNumber = EXP_values.pol_num\n\tLEFT JOIN LKP_SupSurchargeExempt\n\tON LKP_SupSurchargeExempt.SupSurchargeExemptId = EXP_values.SupSurchargeExemptID\n\tLEFT JOIN LKP_UnderWritingDivisionDim\n\tON LKP_UnderWritingDivisionDim.EDWUnderwritingAssociateAKID = EXP_values.UnderwritingAssociateAKId\n\tLEFT JOIN LKP_UserId\n\tON LKP_UserId.PolicyNumber = EXP_values.pol_num AND LKP_UserId.PolicyVersion = EXP_values.pol_mod\n\tLEFT JOIN LKP_sup_business_classification_code\n\tON LKP_sup_business_classification_code.sup_bus_class_code_id = EXP_values.sup_bus_class_code_id\n\tLEFT JOIN LKP_sup_industry_risk_grade_code\n\tON LKP_sup_industry_risk_grade_code.sup_industry_risk_grade_code_id = EXP_values.sup_industry_risk_grade_code_id\n\tLEFT JOIN LKP_sup_policy_audit_frequency\n\tON LKP_sup_policy_audit_frequency.sup_pol_audit_frqncy_id = EXP_values.sup_pol_audit_frqncy_id\n\tLEFT JOIN LKP_sup_policy_issue_code\n\tON LKP_sup_policy_issue_code.sup_pol_issue_code_id = EXP_values.sup_pol_issue_code_id\n\tLEFT JOIN LKP_sup_policy_status_code\n\tON LKP_sup_policy_status_code.sup_pol_status_code_id = EXP_values.sup_pol_status_code_id\n\tLEFT JOIN LKP_sup_policy_term\n\tON LKP_sup_policy_term.sup_pol_term_id = EXP_values.sup_pol_term_id\n\tLEFT JOIN LKP_sup_state\n\tON LKP_sup_state.sup_state_id = EXP_values.sup_state_id\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_company_number_UDF_LTRIM_RTRIM_pol_co_num\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_company_number_UDF_LTRIM_RTRIM_pol_co_num.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_company_number_UDF_LTRIM_RTRIM_pol_co_num.tablename = 'sup_policy_company_number'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_company_number_UDF_LTRIM_RTRIM_pol_co_num.code = :UDF.LTRIM_RTRIM(pol_co_num)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_DCT_sup_business_classification_code_UDF_LTRIM_RTRIM_prim_bus_class_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_DCT_sup_business_classification_code_UDF_LTRIM_RTRIM_prim_bus_class_code.source_sys_id = :UDF.LTRIM_RTRIM('DCT')\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_DCT_sup_business_classification_code_UDF_LTRIM_RTRIM_prim_bus_class_code.tablename = 'sup_business_classification_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_DCT_sup_business_classification_code_UDF_LTRIM_RTRIM_prim_bus_class_code.code = :UDF.LTRIM_RTRIM(prim_bus_class_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_reinsurance_code_UDF_LTRIM_RTRIM_reins_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_reinsurance_code_UDF_LTRIM_RTRIM_reins_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_reinsurance_code_UDF_LTRIM_RTRIM_reins_code.tablename = 'sup_reinsurance_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_reinsurance_code_UDF_LTRIM_RTRIM_reins_code.code = :UDF.LTRIM_RTRIM(reins_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_company_line_code_UDF_LTRIM_RTRIM_pol_co_line_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_company_line_code_UDF_LTRIM_RTRIM_pol_co_line_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_company_line_code_UDF_LTRIM_RTRIM_pol_co_line_code.tablename = 'sup_policy_company_line_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_company_line_code_UDF_LTRIM_RTRIM_pol_co_line_code.code = :UDF.LTRIM_RTRIM(pol_co_line_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_reason_amended_code_UDF_LTRIM_RTRIM_pol_cancellation_rsn_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_reason_amended_code_UDF_LTRIM_RTRIM_pol_cancellation_rsn_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_reason_amended_code_UDF_LTRIM_RTRIM_pol_cancellation_rsn_code.tablename = 'sup_reason_amended_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_reason_amended_code_UDF_LTRIM_RTRIM_pol_cancellation_rsn_code.code = :UDF.LTRIM_RTRIM(pol_cancellation_rsn_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_state_abbrev_UDF_LTRIM_RTRIM_state_of_domicile_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_state_abbrev_UDF_LTRIM_RTRIM_state_of_domicile_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_state_abbrev_UDF_LTRIM_RTRIM_state_of_domicile_code.tablename = 'sup_state_abbrev'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_state_abbrev_UDF_LTRIM_RTRIM_state_of_domicile_code.code = :UDF.LTRIM_RTRIM(state_of_domicile_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_EXCEED_sup_state_UDF_LTRIM_RTRIM_state_of_domicile_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_EXCEED_sup_state_UDF_LTRIM_RTRIM_state_of_domicile_code.source_sys_id = :UDF.LTRIM_RTRIM('EXCEED')\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_EXCEED_sup_state_UDF_LTRIM_RTRIM_state_of_domicile_code.tablename = 'sup_state'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_EXCEED_sup_state_UDF_LTRIM_RTRIM_state_of_domicile_code.code = :UDF.LTRIM_RTRIM(state_of_domicile_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_wbconnect_upload_code_UDF_LTRIM_RTRIM_wbconnect_upload_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_wbconnect_upload_code_UDF_LTRIM_RTRIM_wbconnect_upload_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_wbconnect_upload_code_UDF_LTRIM_RTRIM_wbconnect_upload_code.tablename = 'sup_wbconnect_upload_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_wbconnect_upload_code_UDF_LTRIM_RTRIM_wbconnect_upload_code.code = :UDF.LTRIM_RTRIM(wbconnect_upload_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_service_center_support_code_UDF_LTRIM_RTRIM_serv_center_support_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_service_center_support_code_UDF_LTRIM_RTRIM_serv_center_support_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_service_center_support_code_UDF_LTRIM_RTRIM_serv_center_support_code.tablename = 'sup_service_center_support_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_service_center_support_code_UDF_LTRIM_RTRIM_serv_center_support_code.code = :UDF.LTRIM_RTRIM(serv_center_support_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_term_UDF_LTRIM_RTRIM_pol_term\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_term_UDF_LTRIM_RTRIM_pol_term.source_sys_id = :UDF.LTRIM_RTRIM('PMS')\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_term_UDF_LTRIM_RTRIM_pol_term.tablename = 'sup_policy_term'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_term_UDF_LTRIM_RTRIM_pol_term.code = :UDF.LTRIM_RTRIM(pol_term)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_status_code_UDF_LTRIM_RTRIM_pol_status_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_status_code_UDF_LTRIM_RTRIM_pol_status_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_status_code_UDF_LTRIM_RTRIM_pol_status_code.tablename = 'sup_policy_status_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_status_code_UDF_LTRIM_RTRIM_pol_status_code.code = :UDF.LTRIM_RTRIM(pol_status_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_issue_code_UDF_LTRIM_RTRIM_pol_issue_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_issue_code_UDF_LTRIM_RTRIM_pol_issue_code.source_sys_id = :UDF.LTRIM_RTRIM('PMS')\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_issue_code_UDF_LTRIM_RTRIM_pol_issue_code.tablename = 'sup_policy_issue_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_issue_code_UDF_LTRIM_RTRIM_pol_issue_code.code = :UDF.LTRIM_RTRIM(pol_issue_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_industry_risk_grade_code_UDF_LTRIM_RTRIM_industry_risk_grade_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_industry_risk_grade_code_UDF_LTRIM_RTRIM_industry_risk_grade_code.source_sys_id = :UDF.LTRIM_RTRIM('PMS')\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_industry_risk_grade_code_UDF_LTRIM_RTRIM_industry_risk_grade_code.tablename = 'sup_industry_risk_grade_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_industry_risk_grade_code_UDF_LTRIM_RTRIM_industry_risk_grade_code.code = :UDF.LTRIM_RTRIM(industry_risk_grade_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_mvr_request_code_UDF_LTRIM_RTRIM_mvr_request_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_mvr_request_code_UDF_LTRIM_RTRIM_mvr_request_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_mvr_request_code_UDF_LTRIM_RTRIM_mvr_request_code.tablename = 'sup_mvr_request_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_mvr_request_code_UDF_LTRIM_RTRIM_mvr_request_code.code = :UDF.LTRIM_RTRIM(mvr_request_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_renewal_code_UDF_LTRIM_RTRIM_renl_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_renewal_code_UDF_LTRIM_RTRIM_renl_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_renewal_code_UDF_LTRIM_RTRIM_renl_code.tablename = 'sup_policy_renewal_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_renewal_code_UDF_LTRIM_RTRIM_renl_code.code = :UDF.LTRIM_RTRIM(renl_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_audit_frequency_UDF_LTRIM_RTRIM_pol_audit_frqncy\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_audit_frequency_UDF_LTRIM_RTRIM_pol_audit_frqncy.source_sys_id = :UDF.LTRIM_RTRIM('PMS')\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_audit_frequency_UDF_LTRIM_RTRIM_pol_audit_frqncy.tablename = 'sup_policy_audit_frequency'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_PMS_sup_policy_audit_frequency_UDF_LTRIM_RTRIM_pol_audit_frqncy.code = :UDF.LTRIM_RTRIM(pol_audit_frqncy)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_variation_code_UDF_LTRIM_RTRIM_variation_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_variation_code_UDF_LTRIM_RTRIM_variation_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_variation_code_UDF_LTRIM_RTRIM_variation_code.tablename = 'sup_policy_variation_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_policy_variation_code_UDF_LTRIM_RTRIM_variation_code.code = :UDF.LTRIM_RTRIM(variation_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_non_smoker_discount_code_UDF_LTRIM_RTRIM_non_smoker_disc_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_non_smoker_discount_code_UDF_LTRIM_RTRIM_non_smoker_disc_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_non_smoker_discount_code_UDF_LTRIM_RTRIM_non_smoker_disc_code.tablename = 'sup_non_smoker_discount_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_non_smoker_discount_code_UDF_LTRIM_RTRIM_non_smoker_disc_code.code = :UDF.LTRIM_RTRIM(non_smoker_disc_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_excess_claim_code_UDF_LTRIM_RTRIM_excess_claim_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_excess_claim_code_UDF_LTRIM_RTRIM_excess_claim_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_excess_claim_code_UDF_LTRIM_RTRIM_excess_claim_code.tablename = 'sup_excess_claim_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_excess_claim_code_UDF_LTRIM_RTRIM_excess_claim_code.code = :UDF.LTRIM_RTRIM(excess_claim_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_target_market_code_UDF_LTRIM_RTRIM_target_mrkt_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_target_market_code_UDF_LTRIM_RTRIM_target_mrkt_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_target_market_code_UDF_LTRIM_RTRIM_target_mrkt_code.tablename = 'sup_target_market_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_target_market_code_UDF_LTRIM_RTRIM_target_mrkt_code.code = :UDF.LTRIM_RTRIM(target_mrkt_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_marketing_package_code_UDF_LTRIM_RTRIM_pkg_code\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_marketing_package_code_UDF_LTRIM_RTRIM_pkg_code.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_marketing_package_code_UDF_LTRIM_RTRIM_pkg_code.tablename = 'sup_marketing_package_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_marketing_package_code_UDF_LTRIM_RTRIM_pkg_code.code = :UDF.LTRIM_RTRIM(pkg_code)\n\n\tLEFT JOIN LKP_ALL_SUPPORT_TABLES LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_association_program_code_UDF_LTRIM_RTRIM_ClassOfBusiness\n\tON LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_association_program_code_UDF_LTRIM_RTRIM_ClassOfBusiness.source_sys_id = :UDF.LTRIM_RTRIM(i_source_sys_id)\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_association_program_code_UDF_LTRIM_RTRIM_ClassOfBusiness.tablename = 'sup_association_program_code'\n\tAND LKP_ALL_SUPPORT_TABLES__UDF_LTRIM_RTRIM_i_source_sys_id_sup_association_program_code_UDF_LTRIM_RTRIM_ClassOfBusiness.code = :UDF.LTRIM_RTRIM(ClassOfBusiness)\n\n),\nLKP_policy_dim AS (\n\tSELECT\n\tpol_dim_id,\n\tedw_pol_pk_id\n\tFROM (\n\t\tSELECT \n\t\t\tpol_dim_id,\n\t\t\tedw_pol_pk_id\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_pol_pk_id ORDER BY pol_dim_id DESC) = 1\n),\nRTR_INS_UPD AS (\n\tSELECT\n\tLKP_policy_dim.pol_dim_id AS lkp_pol_dim_id,\n\tEXP_sup_description.pol_id,\n\tEXP_sup_description.pol_ak_id,\n\tEXP_sup_description.pol_sym,\n\tEXP_sup_description.pol_num,\n\tEXP_sup_description.pol_mod,\n\tEXP_sup_description.pol_key,\n\tEXP_sup_description.mco,\n\tEXP_sup_description.producer_code,\n\tEXP_sup_description.pol_co_num,\n\tEXP_sup_description.pol_co_num_descript,\n\tEXP_sup_description.pol_eff_date,\n\tEXP_sup_description.pol_exp_date,\n\tEXP_sup_description.orig_incptn_date,\n\tEXP_sup_description.prim_bus_class_code,\n\tEXP_sup_description.prim_bus_class_code_descript,\n\tEXP_sup_description.reins_code,\n\tEXP_sup_description.reins_code_descript,\n\tEXP_sup_description.pms_pol_lob_code,\n\tEXP_sup_description.pms_pol_lob_code_descript,\n\tEXP_sup_description.pol_co_line_code,\n\tEXP_sup_description.pol_co_line_code_descript,\n\tEXP_sup_description.pol_cancellation_ind,\n\tEXP_sup_description.pol_cancellation_date,\n\tEXP_sup_description.pol_cancellation_rsn_code,\n\tEXP_sup_description.pol_cancellation_rsn_code_descript,\n\tEXP_sup_description.state_of_domicile_code,\n\tEXP_sup_description.state_of_domicile_code_abbrev,\n\tEXP_sup_description.state_of_domicile_code_descript,\n\tEXP_sup_description.wbconnect_upload_code,\n\tEXP_sup_description.wbconnect_upload_code_descript,\n\tEXP_sup_description.serv_center_support_code,\n\tEXP_sup_description.serv_center_support_code_descript,\n\tEXP_sup_description.pol_term,\n\tEXP_sup_description.pol_term_descript,\n\tEXP_sup_description.terrorism_risk_ind,\n\tEXP_sup_description.prior_pol_key,\n\tEXP_sup_description.pol_status_code,\n\tEXP_sup_description.pol_status_code_descript,\n\tEXP_sup_description.pol_count_type_code,\n\tEXP_sup_description.pol_issue_code,\n\tEXP_sup_description.pol_issue_code_descript,\n\tEXP_sup_description.pol_age,\n\tEXP_sup_description.industry_risk_grade_code,\n\tEXP_sup_description.industry_risk_grade_code_descript,\n\tEXP_sup_description.uw_review_yr,\n\tEXP_sup_description.mvr_request_code,\n\tEXP_sup_description.mvr_request_code_descript,\n\tEXP_sup_description.renl_code,\n\tEXP_sup_description.renl_code_descript,\n\tEXP_sup_description.amend_num,\n\tEXP_sup_description.anniversary_rerate_code,\n\tEXP_sup_description.pol_audit_frqncy,\n\tEXP_sup_description.pol_audit_frqncy_descript,\n\tEXP_sup_description.final_audit_code,\n\tEXP_sup_description.zip_ind,\n\tEXP_sup_description.guarantee_ind,\n\tEXP_sup_description.variation_code,\n\tEXP_sup_description.variation_ind_descript,\n\tEXP_sup_description.county,\n\tEXP_sup_description.non_smoker_disc_code,\n\tEXP_sup_description.non_smoker_disc_code_descript,\n\tEXP_sup_description.renl_disc,\n\tEXP_sup_description.renl_safe_driver_disc_count,\n\tEXP_sup_description.nonrenewal_flag_date,\n\tEXP_sup_description.audit_complt_date,\n\tEXP_sup_description.orig_acct_date,\n\tEXP_sup_description.pol_enter_date,\n\tEXP_sup_description.excess_claim_code,\n\tEXP_sup_description.excess_claim_code_descript,\n\tEXP_sup_description.pol_status_on_pif,\n\tEXP_sup_description.target_mrkt_code,\n\tEXP_sup_description.target_mrkt_code_descript,\n\tEXP_sup_description.pkg_code,\n\tEXP_sup_description.mrktng_pkg_description,\n\tEXP_sup_description.pol_kind_code,\n\tEXP_sup_description.pol_kind_code_description,\n\tEXP_sup_description.bus_seg_code,\n\tEXP_sup_description.bus_seg_code_description,\n\tEXP_sup_description.pif_upload_audit_ind,\n\tEXP_sup_description.crrnt_snpsht_flag,\n\tEXP_sup_description.audit_id,\n\tEXP_sup_description.eff_from_date,\n\tEXP_sup_description.eff_to_date,\n\tEXP_sup_description.created_date,\n\tEXP_sup_description.modified_date,\n\tEXP_sup_description.err_flag_bal_txn,\n\tEXP_sup_description.err_flag_bal_reins,\n\tEXP_sup_description.reporting_dvsn_code,\n\tEXP_sup_description.class_of_business,\n\tEXP_sup_description.ClassOfBusinessCodeDescription,\n\tEXP_sup_description.policy_type,\n\tEXP_sup_description.ErrorFlagBalancePremiumTransaction,\n\tEXP_sup_description.RenewalPolicyNumber,\n\tEXP_sup_description.RenewalPolicySymbol,\n\tEXP_sup_description.RenewalPolicyMod,\n\tEXP_sup_description.BillingType,\n\tEXP_sup_description.o_StandardInsuranceSegmentCode AS StandardInsuranceSegmentCode,\n\tEXP_sup_description.o_StandardInsuranceSegmentDescription AS StandardInsuranceSegmentDescription,\n\tEXP_sup_description.o_StandardBusinessClassCode AS StandardBusinessClassCode,\n\tEXP_sup_description.o_StandardBusinessClassCodeDescription AS StandardBusinessClassCodeDescription,\n\tEXP_sup_description.o_StandardPolicyTerm AS StandardPolicyTerm,\n\tEXP_sup_description.o_StandardPolicyTermDescription AS StandardPolicyTermDescription,\n\tEXP_sup_description.o_StandardPolicyStatusCode AS StandardPolicyStatusCode,\n\tEXP_sup_description.o_StandardPolicyStatusCodeDescription AS StandardPolicyStatusCodeDescription,\n\tEXP_sup_description.o_StandardPolicyIssueCode AS StandardPolicyIssueCode,\n\tEXP_sup_description.o_StandardPolicyIssueCodeDescription AS StandardPolicyIssueCodeDescription,\n\tEXP_sup_description.o_StandardIndustryRiskGradeCode AS StandardIndustryRiskGradeCode,\n\tEXP_sup_description.o_StandardIndustryRiskGradeCodeDescription AS StandardIndustryRiskGradeCodeDescription,\n\tEXP_sup_description.o_StandardPolicyAuditFrequency AS StandardPolicyAuditFrequency,\n\tEXP_sup_description.o_StandardPolicyAuditFrequencyDescription AS StandardPolicyAuditFrequencyDescription,\n\tEXP_sup_description.o_StandardStateAbbreviation AS StandardStateAbbreviation,\n\tEXP_sup_description.o_StandardStateDescription AS StandardStateDescription,\n\tEXP_sup_description.o_StandardSurchargeExemptCode AS StandardSurchargeExemptCode,\n\tEXP_sup_description.o_StandardSurchargeExemptDescription AS StandardSurchargeExemptDescription,\n\tEXP_sup_description.o_ProgramCode AS ProgramCode,\n\tEXP_sup_description.o_ProgramDescription AS ProgramDescription,\n\tEXP_sup_description.UnderwritingDivisionDimID,\n\tEXP_sup_description.o_AgencyEmployeeDimID AS AgencyEmployeeDimId,\n\tEXP_sup_description.ObligeeName,\n\tEXP_sup_description.AutomatedUnderwritingServicesIndicator,\n\tEXP_sup_description.AutomaticRenewalIndicator,\n\tEXP_sup_description.AssociationCode,\n\tEXP_sup_description.o_AssociationDescription AS AssociationDescription,\n\tEXP_sup_description.o_AssociationDiscountPercentage AS AssociationDiscountPercentage,\n\tEXP_sup_description.o_ExpiringPriorPolicyKey AS ExpiringPriorPolicyKey,\n\tEXP_sup_description.o_BusinessClassDimId AS BusinessClassDimId,\n\tEXP_sup_description.RolloverPolicyIndicator,\n\tEXP_sup_description.RolloverPriorCarrier,\n\tEXP_sup_description.MailToInsuredFlag,\n\tEXP_sup_description.PolicyIssueCodeOverride,\n\tEXP_sup_description.out_DCBillFlag AS DCBillFlag,\n\tEXP_sup_description.o_IssuedUWID AS IssuedUWID,\n\tEXP_sup_description.o_IssuedUnderwriter AS IssuedUnderwriter,\n\tEXP_sup_description.o_QuoteChannel AS QuoteChannel,\n\tEXP_sup_description.o_QuoteChannelOrigin AS QuoteChannelOrigin\n\tFROM EXP_sup_description\n\tLEFT JOIN LKP_policy_dim\n\tON LKP_policy_dim.edw_pol_pk_id = EXP_sup_description.pol_id\n),\nRTR_INS_UPD_INSERT AS (SELECT * FROM RTR_INS_UPD WHERE ISNULL(lkp_pol_dim_id)),\nRTR_INS_UPD_DEFAULT1 AS (SELECT * FROM RTR_INS_UPD WHERE NOT ( (ISNULL(lkp_pol_dim_id)) )),\nTGT_policy_dim_INSERT AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim\n\t(crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, created_date, modified_date, edw_pol_pk_id, edw_pol_ak_id, pol_sym, pol_num, pol_mod, pol_key, mco, producer_code, pol_co_num, pol_co_num_descript, pol_eff_date, pol_exp_date, orig_incptn_date, prim_bus_class_code, prim_bus_class_code_descript, reins_code, reins_code_descript, pms_pol_lob_code, pms_pol_lob_code_descript, pol_co_line_code, pol_co_line_code_descript, pol_cancellation_ind, pol_cancellation_date, pol_cancellation_rsn_code, pol_cancellation_rsn_code_descript, state_of_domicile_code, state_of_domicile_abbrev, state_of_domicile_code_descript, wbconnect_upload_code, wbconnect_upload_code_descript, serv_center_support_code, serv_center_support_code_descript, pol_term, pol_term_descript, terrorism_risk_ind, prior_pol_key, pol_status_code, pol_status_code_descript, pol_count_type_code, pol_issue_code, pol_issue_code_descript, pol_age, industry_risk_grade_code, industry_risk_grade_code_descript, uw_review_yr, mvr_request_code, mvr_request_code_descript, renl_code, renl_code_descript, amend_num, anniversary_rerate_code, pol_audit_frqncy, pol_audit_frqncy_descript, final_audit_code, zip_ind, guarantee_ind, variation_code, variation_code_descript, county, non_smoker_disc_code, non_smoker_disc_code_descript, renl_disc, renl_safe_driver_disc_count, nonrenewal_flag_date, audit_complt_date, orig_acct_date, pol_enter_date, excess_claim_code, excess_claim_code_descript, pol_status_on_pif, target_mrkt_code, target_mrkt_code_descript, pkg_code, pkg_code_descript, pol_kind_code, bus_seg_code, bus_seg_code_descript, pif_upload_audit_ind, err_flag_bal_txn, err_flag_bal_reins, reporting_dvsn_code, ClassOfBusinessCode, ClassOfBusinessCodeDescription, ErrorFlagBalancePremiumTransaction, RenewalPolicyNumber, RenewalPolicySymbol, RenewalPolicyMod, BillingType, SurchargeExemptCode, SurchargeExemptDescription, ProgramCode, ProgramDescription, UnderwritingDivisionDimId, AgencyEmployeeDimID, ObligeeName, AutomatedUnderwritingServicesIndicator, AutomaticRenewalIndicator, AssociationCode, AssociationDescription, AssociationDiscountPercentage, ExpiringPriorPolicyKey, BusinessClassDimId, RolloverPolicyIndicator, RolloverPriorCarrier, MailToInsuredFlag, PolicyIssueCodeOverrideInd, DCBillFlag, IssuedUWID, IssuedUnderwriter, QuoteChannel, QuoteChannelOrigin)\n\tSELECT \n\tCRRNT_SNPSHT_FLAG, \n\tAUDIT_ID, \n\tEFF_FROM_DATE, \n\tEFF_TO_DATE, \n\tCREATED_DATE, \n\tMODIFIED_DATE, \n\tpol_id AS EDW_POL_PK_ID, \n\tpol_ak_id AS EDW_POL_AK_ID, \n\tPOL_SYM, \n\tPOL_NUM, \n\tPOL_MOD, \n\tPOL_KEY, \n\tMCO, \n\tPRODUCER_CODE, \n\tPOL_CO_NUM, \n\tPOL_CO_NUM_DESCRIPT, \n\tPOL_EFF_DATE, \n\tPOL_EXP_DATE, \n\tORIG_INCPTN_DATE, \n\tStandardBusinessClassCode AS PRIM_BUS_CLASS_CODE, \n\tStandardBusinessClassCodeDescription AS PRIM_BUS_CLASS_CODE_DESCRIPT, \n\tREINS_CODE, \n\tREINS_CODE_DESCRIPT, \n\tPMS_POL_LOB_CODE, \n\tPMS_POL_LOB_CODE_DESCRIPT, \n\tPOL_CO_LINE_CODE, \n\tPOL_CO_LINE_CODE_DESCRIPT, \n\tPOL_CANCELLATION_IND, \n\tPOL_CANCELLATION_DATE, \n\tPOL_CANCELLATION_RSN_CODE, \n\tPOL_CANCELLATION_RSN_CODE_DESCRIPT, \n\tSTATE_OF_DOMICILE_CODE, \n\tStandardStateAbbreviation AS STATE_OF_DOMICILE_ABBREV, \n\tStandardStateDescription AS STATE_OF_DOMICILE_CODE_DESCRIPT, \n\tWBCONNECT_UPLOAD_CODE, \n\tWBCONNECT_UPLOAD_CODE_DESCRIPT, \n\tSERV_CENTER_SUPPORT_CODE, \n\tSERV_CENTER_SUPPORT_CODE_DESCRIPT, \n\tStandardPolicyTerm AS POL_TERM, \n\tStandardPolicyTermDescription AS POL_TERM_DESCRIPT, \n\tTERRORISM_RISK_IND, \n\tPRIOR_POL_KEY, \n\tStandardPolicyStatusCode AS POL_STATUS_CODE, \n\tStandardPolicyStatusCodeDescription AS POL_STATUS_CODE_DESCRIPT, \n\tPOL_COUNT_TYPE_CODE, \n\tStandardPolicyIssueCode AS POL_ISSUE_CODE, \n\tStandardPolicyIssueCodeDescription AS POL_ISSUE_CODE_DESCRIPT, \n\tPOL_AGE, \n\tStandardIndustryRiskGradeCode AS INDUSTRY_RISK_GRADE_CODE, \n\tStandardIndustryRiskGradeCodeDescription AS INDUSTRY_RISK_GRADE_CODE_DESCRIPT, \n\tUW_REVIEW_YR, \n\tMVR_REQUEST_CODE, \n\tMVR_REQUEST_CODE_DESCRIPT, \n\tRENL_CODE, \n\tRENL_CODE_DESCRIPT, \n\tAMEND_NUM, \n\tANNIVERSARY_RERATE_CODE, \n\tStandardPolicyAuditFrequency AS POL_AUDIT_FRQNCY, \n\tStandardPolicyAuditFrequencyDescription AS POL_AUDIT_FRQNCY_DESCRIPT, \n\tFINAL_AUDIT_CODE, \n\tZIP_IND, \n\tGUARANTEE_IND, \n\tVARIATION_CODE, \n\tvariation_ind_descript AS VARIATION_CODE_DESCRIPT, \n\tCOUNTY, \n\tNON_SMOKER_DISC_CODE, \n\tNON_SMOKER_DISC_CODE_DESCRIPT, \n\tRENL_DISC, \n\tRENL_SAFE_DRIVER_DISC_COUNT, \n\tNONRENEWAL_FLAG_DATE, \n\tAUDIT_COMPLT_DATE, \n\tORIG_ACCT_DATE, \n\tPOL_ENTER_DATE, \n\tEXCESS_CLAIM_CODE, \n\tEXCESS_CLAIM_CODE_DESCRIPT, \n\tPOL_STATUS_ON_PIF, \n\tTARGET_MRKT_CODE, \n\tTARGET_MRKT_CODE_DESCRIPT, \n\tPKG_CODE, \n\tmrktng_pkg_description AS PKG_CODE_DESCRIPT, \n\tPOL_KIND_CODE, \n\tBUS_SEG_CODE, \n\tbus_seg_code_description AS BUS_SEG_CODE_DESCRIPT, \n\tPIF_UPLOAD_AUDIT_IND, \n\tERR_FLAG_BAL_TXN, \n\tERR_FLAG_BAL_REINS, \n\tREPORTING_DVSN_CODE, \n\tclass_of_business AS CLASSOFBUSINESSCODE, \n\tCLASSOFBUSINESSCODEDESCRIPTION, \n\tERRORFLAGBALANCEPREMIUMTRANSACTION, \n\tRENEWALPOLICYNUMBER, \n\tRENEWALPOLICYSYMBOL, \n\tRENEWALPOLICYMOD, \n\tBILLINGTYPE, \n\tStandardSurchargeExemptCode AS SURCHARGEEXEMPTCODE, \n\tStandardSurchargeExemptDescription AS SURCHARGEEXEMPTDESCRIPTION, \n\tPROGRAMCODE, \n\tPROGRAMDESCRIPTION, \n\tUnderwritingDivisionDimID AS UNDERWRITINGDIVISIONDIMID, \n\tAgencyEmployeeDimId AS AGENCYEMPLOYEEDIMID, \n\tOBLIGEENAME, \n\tAUTOMATEDUNDERWRITINGSERVICESINDICATOR, \n\tAUTOMATICRENEWALINDICATOR, \n\tASSOCIATIONCODE, \n\tASSOCIATIONDESCRIPTION, \n\tASSOCIATIONDISCOUNTPERCENTAGE, \n\tEXPIRINGPRIORPOLICYKEY, \n\tBUSINESSCLASSDIMID, \n\tROLLOVERPOLICYINDICATOR, \n\tROLLOVERPRIORCARRIER, \n\tMAILTOINSUREDFLAG, \n\tPolicyIssueCodeOverride AS POLICYISSUECODEOVERRIDEIND, \n\tDCBILLFLAG, \n\tISSUEDUWID, \n\tISSUEDUNDERWRITER, \n\tQUOTECHANNEL, \n\tQUOTECHANNELORIGIN\n\tFROM RTR_INS_UPD_INSERT\n),\nUPD_policy_dim AS (\n\tSELECT\n\tlkp_pol_dim_id AS lkp_pol_dim_id2, \n\tpol_id, \n\tpol_ak_id, \n\tpol_sym, \n\tpol_num, \n\tpol_mod, \n\tpol_key, \n\tmco, \n\tproducer_code AS producer_code2, \n\tpol_co_num, \n\tpol_co_num_descript, \n\tpol_eff_date, \n\tpol_exp_date, \n\torig_incptn_date, \n\tprim_bus_class_code, \n\tprim_bus_class_code_descript, \n\treins_code, \n\treins_code_descript AS reins_code_descript2, \n\tpms_pol_lob_code, \n\tpms_pol_lob_code_descript AS pms_pol_lob_code_descript2, \n\tpol_co_line_code, \n\tpol_co_line_code_descript, \n\tpol_cancellation_ind, \n\tpol_cancellation_date, \n\tpol_cancellation_rsn_code, \n\tpol_cancellation_rsn_code_descript AS pol_cancellation_rsn_code_descript2, \n\tstate_of_domicile_code, \n\tstate_of_domicile_code_abbrev, \n\tstate_of_domicile_code_descript AS state_of_domicile_code_descript2, \n\twbconnect_upload_code, \n\twbconnect_upload_code_descript AS wbconnect_upload_code_descript2, \n\tserv_center_support_code, \n\tserv_center_support_code_descript, \n\tpol_term, \n\tpol_term_descript AS pol_term_descript2, \n\tterrorism_risk_ind, \n\tprior_pol_key AS prior_pol_key2, \n\tpol_status_code, \n\tpol_status_code_descript, \n\tpol_count_type_code AS pol_count_type_code2, \n\tpol_issue_code, \n\tpol_issue_code_descript, \n\tpol_age, \n\tindustry_risk_grade_code, \n\tindustry_risk_grade_code_descript, \n\tuw_review_yr, \n\tmvr_request_code, \n\tmvr_request_code_descript AS mvr_request_code_descript2, \n\trenl_code, \n\trenl_code_descript AS renl_code_descript2, \n\tamend_num, \n\tanniversary_rerate_code, \n\tpol_audit_frqncy, \n\tpol_audit_frqncy_descript AS pol_audit_frqncy_descript2, \n\tfinal_audit_code, \n\tzip_ind, \n\tguarantee_ind, \n\tvariation_code, \n\tvariation_ind_descript, \n\tcounty, \n\tnon_smoker_disc_code, \n\tnon_smoker_disc_code_descript AS non_smoker_disc_code_descript2, \n\trenl_disc, \n\trenl_safe_driver_disc_count, \n\tnonrenewal_flag_date, \n\taudit_complt_date, \n\torig_acct_date, \n\tpol_enter_date, \n\texcess_claim_code, \n\texcess_claim_code_descript AS excess_claim_code_descript2, \n\tpol_status_on_pif, \n\ttarget_mrkt_code AS target_mrkt_code2, \n\ttarget_mrkt_code_descript AS target_mrkt_code_descript2, \n\tpkg_code AS pkg_code2, \n\tmrktng_pkg_description, \n\tpol_kind_code AS pol_kind_code2, \n\tpol_kind_code_description AS pol_kind_code_description2, \n\tbus_seg_code AS bus_seg_code2, \n\tbus_seg_code_description AS bus_seg_code_description2, \n\tpif_upload_audit_ind AS pif_upload_audit_ind2, \n\tcrrnt_snpsht_flag AS crrnt_snpsht_flag2, \n\taudit_id AS audit_id2, \n\teff_from_date, \n\teff_to_date AS eff_to_date2, \n\tcreated_date AS created_date2, \n\tmodified_date AS modified_date2, \n\terr_flag_bal_txn AS err_flag_bal_txn2, \n\terr_flag_bal_reins AS err_flag_bal_reins2, \n\treporting_dvsn_code AS reporting_dvsn_code2, \n\tclass_of_business AS class_of_business2, \n\tClassOfBusinessCodeDescription AS ClassOfBusinessCodeDescription2, \n\tErrorFlagBalancePremiumTransaction AS ErrorFlagBalancePremiumTransaction2, \n\tRenewalPolicyNumber AS RenewalPolicyNumber1, \n\tRenewalPolicySymbol AS RenewalPolicySymbol1, \n\tRenewalPolicyMod AS RenewalPolicyMod2, \n\tBillingType AS BillingType2, \n\tStandardInsuranceSegmentCode AS StandardInsuranceSegmentCode2, \n\tStandardInsuranceSegmentDescription AS StandardInsuranceSegmentDescription2, \n\tStandardBusinessClassCode AS StandardBusinessClassCode2, \n\tStandardBusinessClassCodeDescription AS StandardBusinessClassCodeDescription2, \n\tStandardPolicyTerm AS StandardPolicyTerm2, \n\tStandardPolicyTermDescription AS StandardPolicyTermDescription2, \n\tStandardPolicyStatusCode AS StandardPolicyStatusCode2, \n\tStandardPolicyStatusCodeDescription AS StandardPolicyStatusCodeDescription2, \n\tStandardPolicyIssueCode AS StandardPolicyIssueCode2, \n\tStandardPolicyIssueCodeDescription AS StandardPolicyIssueCodeDescription2, \n\tStandardIndustryRiskGradeCode AS StandardIndustryRiskGradeCode2, \n\tStandardIndustryRiskGradeCodeDescription AS StandardIndustryRiskGradeCodeDescription2, \n\tStandardPolicyAuditFrequency AS StandardPolicyAuditFrequency2, \n\tStandardPolicyAuditFrequencyDescription AS StandardPolicyAuditFrequencyDescription2, \n\tStandardStateAbbreviation AS StandardStateAbbreviation2, \n\tStandardStateDescription AS StandardStateDescription2, \n\tStandardSurchargeExemptCode AS StandardSurchargeExemptCode2, \n\tStandardSurchargeExemptDescription AS StandardSurchargeExemptDescription2, \n\tProgramCode AS ProgramCode2, \n\tProgramDescription AS ProgramDescription2, \n\tUnderwritingDivisionDimID AS UnderwritingDivisionDimID2, \n\tAgencyEmployeeDimId AS AgencyEmployeeDimId2, \n\tObligeeName AS ObligeeName2, \n\tAutomatedUnderwritingServicesIndicator AS AutomatedUnderwritingServicesIndicator2, \n\tAutomaticRenewalIndicator AS AutomaticRenewalIndicator2, \n\tAssociationCode, \n\tAssociationDescription, \n\tAssociationDiscountPercentage, \n\tBusinessClassDimId AS BusinessClassDimId2, \n\tRolloverPolicyIndicator AS RolloverPolicyIndicator2, \n\tRolloverPriorCarrier AS RolloverPriorCarrier2, \n\tMailToInsuredFlag AS MailToInsuredFlag2, \n\tPolicyIssueCodeOverride AS PolicyIssueCodeOverride2, \n\tDCBillFlag, \n\tIssuedUWID AS IssuedUWID2, \n\tIssuedUnderwriter AS IssuedUnderwriter2, \n\tQuoteChannel AS QuoteChannel2, \n\tQuoteChannelOrigin AS QuoteChannelOrigin2\n\tFROM RTR_INS_UPD_DEFAULT1\n),\nTGT_policy_dim_UPDATE AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim AS T\n\tUSING UPD_policy_dim AS S\n\tON T.pol_dim_id = S.lkp_pol_dim_id2\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.eff_from_date = S.eff_from_date, T.modified_date = S.modified_date2, T.mco = S.mco, T.producer_code = S.producer_code2, T.pol_co_num = S.pol_co_num, T.pol_co_num_descript = S.pol_co_num_descript, T.pol_eff_date = S.pol_eff_date, T.pol_exp_date = S.pol_exp_date, T.orig_incptn_date = S.orig_incptn_date, T.prim_bus_class_code = S.StandardBusinessClassCode2, T.prim_bus_class_code_descript = S.StandardBusinessClassCodeDescription2, T.reins_code = S.reins_code, T.reins_code_descript = S.reins_code_descript2, T.pms_pol_lob_code = S.pms_pol_lob_code, T.pms_pol_lob_code_descript = S.pms_pol_lob_code_descript2, T.pol_co_line_code = S.pol_co_line_code, T.pol_co_line_code_descript = S.pol_co_line_code_descript, T.pol_cancellation_ind = S.pol_cancellation_ind, T.pol_cancellation_date = S.pol_cancellation_date, T.pol_cancellation_rsn_code = S.pol_cancellation_rsn_code, T.pol_cancellation_rsn_code_descript = S.pol_cancellation_rsn_code_descript2, T.state_of_domicile_code = S.state_of_domicile_code, T.state_of_domicile_abbrev = S.StandardStateAbbreviation2, T.state_of_domicile_code_descript = S.StandardStateDescription2, T.wbconnect_upload_code = S.wbconnect_upload_code, T.wbconnect_upload_code_descript = S.wbconnect_upload_code_descript2, T.serv_center_support_code = S.serv_center_support_code, T.serv_center_support_code_descript = S.serv_center_support_code_descript, T.pol_term = S.StandardPolicyTerm2, T.pol_term_descript = S.StandardPolicyTermDescription2, T.terrorism_risk_ind = S.terrorism_risk_ind, T.prior_pol_key = S.prior_pol_key2, T.pol_status_code = S.StandardPolicyStatusCode2, T.pol_status_code_descript = S.StandardPolicyStatusCodeDescription2, T.pol_count_type_code = S.pol_count_type_code2, T.pol_issue_code = S.StandardPolicyIssueCode2, T.pol_issue_code_descript = S.StandardPolicyIssueCodeDescription2, T.pol_age = S.pol_age, T.industry_risk_grade_code = S.StandardIndustryRiskGradeCode2, T.industry_risk_grade_code_descript = S.StandardIndustryRiskGradeCodeDescription2, T.uw_review_yr = S.uw_review_yr, T.mvr_request_code = S.mvr_request_code, T.mvr_request_code_descript = S.mvr_request_code_descript2, T.renl_code = S.renl_code, T.renl_code_descript = S.renl_code_descript2, T.amend_num = S.amend_num, T.anniversary_rerate_code = S.anniversary_rerate_code, T.pol_audit_frqncy = S.StandardPolicyAuditFrequency2, T.pol_audit_frqncy_descript = S.StandardPolicyAuditFrequencyDescription2, T.final_audit_code = S.final_audit_code, T.zip_ind = S.zip_ind, T.guarantee_ind = S.guarantee_ind, T.variation_code = S.variation_code, T.variation_code_descript = S.variation_ind_descript, T.county = S.county, T.non_smoker_disc_code = S.non_smoker_disc_code, T.non_smoker_disc_code_descript = S.non_smoker_disc_code_descript2, T.renl_disc = S.renl_disc, T.renl_safe_driver_disc_count = S.renl_safe_driver_disc_count, T.nonrenewal_flag_date = S.nonrenewal_flag_date, T.audit_complt_date = S.audit_complt_date, T.orig_acct_date = S.orig_acct_date, T.pol_enter_date = S.pol_enter_date, T.excess_claim_code = S.excess_claim_code, T.excess_claim_code_descript = S.excess_claim_code_descript2, T.pol_status_on_pif = S.pol_status_on_pif, T.target_mrkt_code = S.target_mrkt_code2, T.target_mrkt_code_descript = S.target_mrkt_code_descript2, T.pkg_code = S.pkg_code2, T.pkg_code_descript = S.mrktng_pkg_description, T.pol_kind_code = S.pol_kind_code2, T.bus_seg_code = S.bus_seg_code2, T.bus_seg_code_descript = S.bus_seg_code_description2, T.pif_upload_audit_ind = S.pif_upload_audit_ind2, T.err_flag_bal_txn = S.err_flag_bal_txn2, T.err_flag_bal_reins = S.err_flag_bal_reins2, T.reporting_dvsn_code = S.reporting_dvsn_code2, T.ClassOfBusinessCode = S.class_of_business2, T.ClassOfBusinessCodeDescription = S.ClassOfBusinessCodeDescription2, T.ErrorFlagBalancePremiumTransaction = S.ErrorFlagBalancePremiumTransaction2, T.RenewalPolicyNumber = S.RenewalPolicyNumber1, T.RenewalPolicySymbol = S.RenewalPolicySymbol1, T.RenewalPolicyMod = S.RenewalPolicyMod2, T.BillingType = S.BillingType2, T.SurchargeExemptCode = S.StandardSurchargeExemptCode2, T.SurchargeExemptDescription = S.StandardSurchargeExemptDescription2, T.ProgramCode = S.ProgramCode2, T.ProgramDescription = S.ProgramDescription2, T.UnderwritingDivisionDimId = S.UnderwritingDivisionDimID2, T.AgencyEmployeeDimID = S.AgencyEmployeeDimId2, T.ObligeeName = S.ObligeeName2, T.AutomatedUnderwritingServicesIndicator = S.AutomatedUnderwritingServicesIndicator2, T.AutomaticRenewalIndicator = S.AutomaticRenewalIndicator2, T.AssociationCode = S.AssociationCode, T.AssociationDescription = S.AssociationDescription, T.AssociationDiscountPercentage = S.AssociationDiscountPercentage, T.BusinessClassDimId = S.BusinessClassDimId2, T.RolloverPolicyIndicator = S.RolloverPolicyIndicator2, T.RolloverPriorCarrier = S.RolloverPriorCarrier2, T.MailToInsuredFlag = S.MailToInsuredFlag2, T.PolicyIssueCodeOverrideInd = S.PolicyIssueCodeOverride2, T.DCBillFlag = S.DCBillFlag, T.IssuedUWID = S.IssuedUWID2, T.IssuedUnderwriter = S.IssuedUnderwriter2, T.QuoteChannel = S.QuoteChannel2, T.QuoteChannelOrigin = S.QuoteChannelOrigin2\n),\nSQ_policy_dim AS (\n\tSELECT \r\n\t\tpol_dim_id, \r\n\t\teff_from_date, \r\n\t\teff_to_date, \r\n\t\tedw_pol_ak_id \r\n\tFROM\r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim\r\n\tWHERE edw_pol_ak_id   IN \r\n\t\t   (SELECT edw_pol_ak_id  FROM @{pipeline().parameters.TARGET_TABLE_OWNER}. policy_dim\r\n\t           WHERE crrnt_snpsht_flag = 1 GROUP BY edw_pol_ak_id   HAVING count(*) > 1)\r\n\tORDER BY edw_pol_ak_id,eff_from_date  DESC\r\n\t\r\n\t\r\n\t--IN Subquery exists to pick AK ID column values that have multiple rows with a 12/31/2100 eff_to_date.\r\n\t--When this condition occurs this is an indication that we must expire one or more of these rows.\r\n\t--WHERE clause is always made up of current snapshot flag \r\n\t--GROUP BY clause is always on AK\r\n\t--HAVING clause stays the same\n),\nEXP_Lag_eff_from_date AS (\n\tSELECT\n\tpol_dim_id,\n\teff_from_date AS in_eff_from_date,\n\teff_to_date AS orig_eff_to_date,\n\tedw_pol_ak_id,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- edw_pol_ak_id = v_prev_edw_pol_ak_id  ,\r\n\t-- ADD_TO_DATE(v_prev_eff_from_date,'SS',-1),orig_eff_to_date)\n\tDECODE(TRUE,\n\t\tedw_pol_ak_id = v_prev_edw_pol_ak_id, ADD_TO_DATE(v_prev_eff_from_date, 'SS', - 1),\n\t\torig_eff_to_date) AS v_eff_to_date,\n\tv_eff_to_date AS eff_to_date,\n\tedw_pol_ak_id AS v_prev_edw_pol_ak_id,\n\tin_eff_from_date AS v_prev_eff_from_date,\n\t0 AS crrnt_snpsht_flag,\n\tSYSDATE AS modified_date\n\tFROM SQ_policy_dim\n),\nFIL_FirstRowInAKGroup AS (\n\tSELECT\n\tpol_dim_id, \n\torig_eff_to_date, \n\teff_to_date, \n\tcrrnt_snpsht_flag, \n\tmodified_date\n\tFROM EXP_Lag_eff_from_date\n\tWHERE orig_eff_to_date != eff_to_date\n),\nUPD_policy_dim_expire AS (\n\tSELECT\n\tpol_dim_id, \n\teff_to_date, \n\tcrrnt_snpsht_flag, \n\tmodified_date\n\tFROM FIL_FirstRowInAKGroup\n),\nTGT_policy_dim_EXP_UPDATE AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim AS T\n\tUSING UPD_policy_dim_expire AS S\n\tON T.pol_dim_id = S.pol_dim_id\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.crrnt_snpsht_flag = S.crrnt_snpsht_flag, T.eff_to_date = S.eff_to_date, T.modified_date = S.modified_date\n),\nSQ_policy_dim_updated AS (\n\tSELECT\n\t\tpol_dim_id,\n\t\tcrrnt_snpsht_flag,\n\t\taudit_id,\n\t\teff_from_date,\n\t\teff_to_date,\n\t\tcreated_date,\n\t\tmodified_date,\n\t\tedw_pol_pk_id,\n\t\tedw_pol_ak_id,\n\t\tpol_sym,\n\t\tpol_num,\n\t\tpol_mod,\n\t\tpol_key,\n\t\tmco,\n\t\tproducer_code,\n\t\tpol_co_num,\n\t\tpol_co_num_descript,\n\t\tpol_eff_date,\n\t\tpol_exp_date,\n\t\torig_incptn_date,\n\t\tprim_bus_class_code,\n\t\tprim_bus_class_code_descript,\n\t\treins_code,\n\t\treins_code_descript,\n\t\tpms_pol_lob_code,\n\t\tpms_pol_lob_code_descript,\n\t\tpol_co_line_code,\n\t\tpol_co_line_code_descript,\n\t\tpol_cancellation_ind,\n\t\tpol_cancellation_date,\n\t\tpol_cancellation_rsn_code,\n\t\tpol_cancellation_rsn_code_descript,\n\t\tstate_of_domicile_code,\n\t\tstate_of_domicile_abbrev,\n\t\tstate_of_domicile_code_descript,\n\t\twbconnect_upload_code,\n\t\twbconnect_upload_code_descript,\n\t\tserv_center_support_code,\n\t\tserv_center_support_code_descript,\n\t\tpol_term,\n\t\tpol_term_descript,\n\t\tterrorism_risk_ind,\n\t\tprior_pol_key,\n\t\tpol_status_code,\n\t\tpol_status_code_descript,\n\t\tpol_count_type_code,\n\t\tpol_issue_code,\n\t\tpol_issue_code_descript,\n\t\tpol_age,\n\t\tindustry_risk_grade_code,\n\t\tindustry_risk_grade_code_descript,\n\t\tuw_review_yr,\n\t\tmvr_request_code,\n\t\tmvr_request_code_descript,\n\t\trenl_code,\n\t\trenl_code_descript,\n\t\tamend_num,\n\t\tanniversary_rerate_code,\n\t\tpol_audit_frqncy,\n\t\tpol_audit_frqncy_descript,\n\t\tfinal_audit_code,\n\t\tzip_ind,\n\t\tguarantee_ind,\n\t\tvariation_code,\n\t\tvariation_code_descript,\n\t\tcounty,\n\t\tnon_smoker_disc_code,\n\t\tnon_smoker_disc_code_descript,\n\t\trenl_disc,\n\t\trenl_safe_driver_disc_count,\n\t\tnonrenewal_flag_date,\n\t\taudit_complt_date,\n\t\torig_acct_date,\n\t\tpol_enter_date,\n\t\texcess_claim_code,\n\t\texcess_claim_code_descript,\n\t\tpol_status_on_pif,\n\t\ttarget_mrkt_code,\n\t\ttarget_mrkt_code_descript,\n\t\tpkg_code,\n\t\tpkg_code_descript,\n\t\tpol_kind_code,\n\t\tbus_seg_code,\n\t\tbus_seg_code_descript,\n\t\tpif_upload_audit_ind,\n\t\terr_flag_bal_txn,\n\t\terr_flag_bal_reins,\n\t\treporting_dvsn_code,\n\t\tClassOfBusinessCode,\n\t\tClassOfBusinessCodeDescription,\n\t\tErrorFlagBalancePremiumTransaction,\n\t\tRenewalPolicyNumber,\n\t\tRenewalPolicySymbol,\n\t\tRenewalPolicyMod,\n\t\tBillingType,\n\t\tSurchargeExemptCode,\n\t\tSurchargeExemptDescription,\n\t\tProgramCode,\n\t\tProgramDescription,\n\t\tUnderwritingDivisionDimId,\n\t\tAgencyEmployeeDimID,\n\t\tObligeeName,\n\t\tAutomatedUnderwritingServicesIndicator,\n\t\tAutomaticRenewalIndicator,\n\t\tAssociationCode,\n\t\tAssociationDescription,\n\t\tAssociationDiscountPercentage\n\tFROM policy_dim\n\tWHERE policy_dim.crrnt_snpsht_flag=1 AND policy_dim.modified_date>='@{pipeline().parameters.SELECTION_START_TS}'\n),\nUPD_Policy_Dim_UnderwritngDivisionDimId AS (\n\tSELECT\n\tedw_pol_ak_id, \n\tUnderwritingDivisionDimId\n\tFROM SQ_policy_dim_updated\n),\npolicy_dim_UNDERWRITER AS (\n\tUPDATE @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim SET UnderwritingDivisionDimId = S.UnderwritingDivisionDimId WHERE edw_pol_ak_id = S.edw_pol_ak_id\n\tFROM UPD_Policy_Dim_UnderwritngDivisionDimId S\n),\nSQ_policy_dim_updateExpiringPriorPolicy AS (\n\tselect p.pol_key\r\n\tfrom @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim p \r\n\twhere  p.crrnt_snpsht_flag=1\r\n\t\tand (p.created_date>='@{pipeline().parameters.SELECTION_START_TS}' OR p.modified_date>='@{pipeline().parameters.SELECTION_START_TS}')\n),\nLKP_GetPriorPolicyKey_V2_Policy AS (\n\tSELECT\n\tPolicyKey,\n\tPreviousPolicyKey,\n\tin_PolicyKey\n\tFROM (\n\t\tselect distinct P.pol_key as PolicyKey, P.prior_pol_key as PreviousPolicyKey \r\n\t\tfrom @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy P with (nolock)\r\n\t\twhere (P.created_date>='@{pipeline().parameters.SELECTION_START_TS}' OR P.modified_date>='@{pipeline().parameters.SELECTION_START_TS}')\r\n\t\tand P.prior_pol_key <> 'N/A' \r\n\t\tand P.prior_pol_key is not null \r\n\t\tand P.prior_pol_key <> ''\r\n\t\tand P.prior_pol_key <> P.pol_key\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey ORDER BY PolicyKey) = 1\n),\nLKP_Policy_Dim_DeriveExpiringPriorPolicyKey AS (\n\tSELECT\n\tpol_key,\n\tExpiringPriorPolicyKey,\n\tPolicyKey\n\tFROM (\n\t\tSelect P1.pol_key as ExpiringPriorPolicyKey,ISNULL(P2.pol_key,'N/A')  as PolicyKey from (SELECT  distinct\r\n\t\t\t b.pol_key \r\n\t\t\t,b.pol_num\r\n\t\t\t,b.pol_mod\r\n\t\t    ,dense_RANK() OVER (PARTITION BY b.pol_num order by b.pol_mod) as ranked  \r\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim  a\r\n\t\t\tinner join @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim b on b.pol_num = a.pol_num and b.crrnt_snpsht_flag = 1\r\n\t\twhere b.pol_cancellation_date <> b.pol_eff_date\r\n\t\t   and (a.created_date>='@{pipeline().parameters.SELECTION_START_TS}' OR a.modified_date>='@{pipeline().parameters.SELECTION_START_TS}')\r\n\t\t) P1\r\n\t\t\tLeft join (SELECT  distinct\r\n\t\t\t b.pol_key \r\n\t\t\t,b.pol_num\r\n\t\t\t,b.pol_mod\r\n\t\t    ,dense_RANK() OVER (PARTITION BY b.pol_num order by b.pol_mod) as ranked  \r\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim  a\r\n\t\t\tinner join @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim b on b.pol_num = a.pol_num and b.crrnt_snpsht_flag = 1\r\n\t\twhere b.pol_cancellation_date <> b.pol_eff_date\r\n\t\t   and (a.created_date>='@{pipeline().parameters.SELECTION_START_TS}' OR a.modified_date>='@{pipeline().parameters.SELECTION_START_TS}')\r\n\t\t) P2 on P1.pol_num = P2.pol_num\r\n\t\twhere\r\n\t\t\tP1.ranked = P2.Ranked -1\r\n\t\torder by 1,2\r\n\t\t--\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey ORDER BY pol_key) = 1\n),\nLKP_Policy_Dim_GetExpiringPriorPolicyKey AS (\n\tSELECT\n\tpol_key,\n\tPolicyKey,\n\tExpiringPriorPolicyKey\n\tFROM (\n\t\tSELECT Distinct\r\n\t\t P2.pol_key     as PolicyKey\r\n\t\t,P2.ExpiringPriorPolicyKey as ExpiringPriorPolicyKey\r\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim P1\r\n\t\tinner join @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim P2 on P1.Pol_Key = P2.Pol_Key\r\n\t\twhere P2.ExpiringPriorPolicyKey <> 'N/A'\r\n\t\tand P2.ExpiringPriorPolicyKey is not  null\r\n\t\tand (P1.created_date>='@{pipeline().parameters.SELECTION_START_TS}' OR P1.modified_date>='@{pipeline().parameters.SELECTION_START_TS}')\r\n\t\torder by P2.pol_key\r\n\t\t--\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey ORDER BY pol_key) = 1\n),\nExp_CollectdifferentExpPolicyKey AS (\n\tSELECT\n\tSQ_policy_dim_updateExpiringPriorPolicy.pol_key AS PolicyKey,\n\tLKP_Policy_Dim_GetExpiringPriorPolicyKey.ExpiringPriorPolicyKey AS lkp_GetExpiringPriorPolicyKey_Step1,\n\tLKP_Policy_Dim_DeriveExpiringPriorPolicyKey.ExpiringPriorPolicyKey AS lkp_DeriveExpiringPriorPolicyKey_Step2,\n\tLKP_GetPriorPolicyKey_V2_Policy.PreviousPolicyKey AS lkp_GetPriorPolicyKey_V2_Policy_Step4,\n\t-- *INF*: IIF(ISNULL(lkp_GetPriorPolicyKey_V2_Policy_Step4) OR lkp_GetPriorPolicyKey_V2_Policy_Step4='' OR IS_SPACES(lkp_GetPriorPolicyKey_V2_Policy_Step4),'N/A',lkp_GetPriorPolicyKey_V2_Policy_Step4)\n\tIFF(lkp_GetPriorPolicyKey_V2_Policy_Step4 IS NULL OR lkp_GetPriorPolicyKey_V2_Policy_Step4 = '' OR IS_SPACES(lkp_GetPriorPolicyKey_V2_Policy_Step4), 'N/A', lkp_GetPriorPolicyKey_V2_Policy_Step4) AS o_GetPriorPolicyKey_V2_Policy_Step4,\n\t-- *INF*: DECODE(\r\n\t-- True,\r\n\t-- (Not isnull(lkp_GetExpiringPriorPolicyKey_Step1) AND lkp_GetExpiringPriorPolicyKey_Step1  != 'N/A' AND lkp_GetExpiringPriorPolicyKey_Step1 <> '' and NOT IS_SPACES(lkp_GetExpiringPriorPolicyKey_Step1 ) ), lkp_GetExpiringPriorPolicyKey_Step1,\r\n\t-- \r\n\t-- (not isnull(lkp_DeriveExpiringPriorPolicyKey_Step2) and lkp_DeriveExpiringPriorPolicyKey_Step2  !=  'N/A' AND lkp_DeriveExpiringPriorPolicyKey_Step2 <> '' and NOT IS_SPACES(lkp_DeriveExpiringPriorPolicyKey_Step2) ), lkp_DeriveExpiringPriorPolicyKey_Step2\r\n\t-- ,'N/A')\n\tDECODE(True,\n\t\t( NOT lkp_GetExpiringPriorPolicyKey_Step1 IS NULL AND lkp_GetExpiringPriorPolicyKey_Step1 != 'N/A' AND lkp_GetExpiringPriorPolicyKey_Step1 <> '' AND NOT IS_SPACES(lkp_GetExpiringPriorPolicyKey_Step1) ), lkp_GetExpiringPriorPolicyKey_Step1,\n\t\t( NOT lkp_DeriveExpiringPriorPolicyKey_Step2 IS NULL AND lkp_DeriveExpiringPriorPolicyKey_Step2 != 'N/A' AND lkp_DeriveExpiringPriorPolicyKey_Step2 <> '' AND NOT IS_SPACES(lkp_DeriveExpiringPriorPolicyKey_Step2) ), lkp_DeriveExpiringPriorPolicyKey_Step2,\n\t\t'N/A') AS o_ExpiringPriorPolicyKey\n\tFROM SQ_policy_dim_updateExpiringPriorPolicy\n\tLEFT JOIN LKP_GetPriorPolicyKey_V2_Policy\n\tON LKP_GetPriorPolicyKey_V2_Policy.PolicyKey = SQ_policy_dim_updateExpiringPriorPolicy.pol_key\n\tLEFT JOIN LKP_Policy_Dim_DeriveExpiringPriorPolicyKey\n\tON LKP_Policy_Dim_DeriveExpiringPriorPolicyKey.PolicyKey = SQ_policy_dim_updateExpiringPriorPolicy.pol_key\n\tLEFT JOIN LKP_Policy_Dim_GetExpiringPriorPolicyKey\n\tON LKP_Policy_Dim_GetExpiringPriorPolicyKey.PolicyKey = SQ_policy_dim_updateExpiringPriorPolicy.pol_key\n),\nSQ_policy_dim_updateExpiringPriorPolicyCancelRewrite AS (\n\tWITH ExpiringPolicyKey\r\n\tAS (\r\n\t\tSELECT DISTINCT C.cust_num AS CustomerNumber\r\n\t\t\t,S.StrategicProfitCenterAbbreviation\r\n\t\t\t,ISG.InsuranceSegmentAbbreviation\r\n\t\t\t,PO.PolicyOfferingAbbreviation\r\n\t\t\t,P.pol_key AS PolicyKey\r\n\t\t\t,P.pol_eff_date AS PolicyEffDate\r\n\t\t\t,CASE \r\n\t\t\t\tWHEN P.pol_cancellation_date < P.pol_exp_date\r\n\t\t\t\t\tTHEN P.pol_cancellation_date\r\n\t\t\t\tELSE P.pol_exp_date\r\n\t\t\t\tEND AS MinPolExpDtPolCancelDt\r\n\t\t\t,DENSE_RANK() OVER (\r\n\t\t\t\tPARTITION BY C.Cust_num\r\n\t\t\t\t,s.StrategicProfitCenterAbbreviation\r\n\t\t\t\t,isg.InsuranceSegmentAbbreviation\r\n\t\t\t\t,po.PolicyOfferingAbbreviation ORDER BY p.pol_eff_date\r\n\t\t\t\t\t,CASE \r\n\t\t\t\t\t\tWHEN P.pol_cancellation_date < P.pol_exp_date\r\n\t\t\t\t\t\t\tTHEN P.pol_cancellation_date\r\n\t\t\t\t\t\tELSE P.pol_exp_date\r\n\t\t\t\t\t\tEND\r\n\t\t\t\t) AS PolicyExpirationRenewOrder\r\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy P1 WITH (NOLOCK)\r\n\t\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.Policy P WITH (NOLOCK) ON P1.pol_ak_id = P.pol_ak_id\r\n\t\t\tAND P.crrnt_snpsht_flag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.contract_customer C WITH (NOLOCK) ON C.contract_cust_ak_id = P.contract_cust_ak_id\r\n\t\t\tAND P.crrnt_snpsht_flag = 1\r\n\t\t\tAND C.crrnt_snpsht_flag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyOffering PO WITH (NOLOCK) ON PO.PolicyOfferingAKId = P.PolicyOfferingAKId\r\n\t\t\tAND P.crrnt_snpsht_flag = 1\r\n\t\t\tAND PO.CurrentSnapshotFlag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter S WITH (NOLOCK) ON S.StrategicProfitCenterAKId = P.StrategicProfitCenterAKId\r\n\t\t\tAND P.crrnt_snpsht_flag = 1\r\n\t\t\tAND S.CurrentSnapshotFlag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment ISG WITH (NOLOCK) ON ISG.InsuranceSegmentAKId = P.InsuranceSegmentAKId\r\n\t\t\tAND P.crrnt_snpsht_flag = 1\r\n\t\t\tAND ISG.CurrentSnapshotFlag = 1\r\n\t\tWHERE  P.pol_cancellation_date <> P.pol_eff_date\r\n\t\t\t\tAND P.pol_ak_id IN (\r\n\t\t\t\tSELECT distinct P3.pol_ak_id\r\n\t\t\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy P3 WITH (NOLOCK)\r\n\t\t\t\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.contract_customer C2 WITH (NOLOCK) ON C2.contract_cust_ak_id = P3.contract_cust_ak_id\r\n\t\t\t\t\t--AND P3.crrnt_snpsht_flag = 1\r\n\t\t\t\t\t--AND C2.crrnt_snpsht_flag = 1\r\n\t\t\t\tWHERE p3.created_date >= '@{pipeline().parameters.SELECTION_START_TS}'\r\n\t\t\t\t\tOR p3.modified_date >= '@{pipeline().parameters.SELECTION_START_TS}'\r\n\t\t\t\t\tAND c2.cust_num = c.cust_num\r\n\t\t\t\t)\r\n\t\t\t\r\n\t\t)\r\n\t\r\n\tSELECT DISTINCT \r\n\t\tT1.PolicyKey\r\n\t \t,CASE WHEN T2.MinPolExpDtPolCancelDt=T1.PolicyEffDate THEN ISNULL(T2.PolicyKey, 'N/A') END as ExpiringPolicyKey\r\n\t\t\r\n\t\t\r\n\tFROM ExpiringPolicyKey T1\r\n\tLEFT JOIN ExpiringPolicyKey T2 ON T1.CustomerNumber = T2.CustomerNumber\r\n\t\tAND T1.StrategicProfitCenterAbbreviation = T2.StrategicProfitCenterAbbreviation\r\n\t\tAND T1.PolicyOfferingAbbreviation = T2.PolicyOfferingAbbreviation\r\n\t\tAND T1.InsuranceSegmentAbbreviation = T2.InsuranceSegmentAbbreviation\r\n\t\tAND T2.PolicyExpirationRenewOrder = T1.PolicyExpirationRenewOrder - 1\r\n\tORDER BY policyKey\n),\nJnr_ExpiringPolicyderivationJoiner AS (SELECT\n\tExp_CollectdifferentExpPolicyKey.PolicyKey AS Pol_Key, \n\tExp_CollectdifferentExpPolicyKey.o_GetPriorPolicyKey_V2_Policy_Step4 AS GetPriorPolicyKey_V2_Policy_Step4, \n\tExp_CollectdifferentExpPolicyKey.o_ExpiringPriorPolicyKey AS ExpiringPriorPolicyKey_Step1_2, \n\tSQ_policy_dim_updateExpiringPriorPolicyCancelRewrite.pol_key AS Pol_Key_Step3, \n\tSQ_policy_dim_updateExpiringPriorPolicyCancelRewrite.ExpiringPolicyKey AS ExpiringPriorPolicyKey_Step3\n\tFROM SQ_policy_dim_updateExpiringPriorPolicyCancelRewrite\n\tINNER JOIN Exp_CollectdifferentExpPolicyKey\n\tON Exp_CollectdifferentExpPolicyKey.PolicyKey = SQ_policy_dim_updateExpiringPriorPolicyCancelRewrite.pol_key\n),\nExp_FinalDerivationOfExpiringPolicyKey AS (\n\tSELECT\n\tPol_Key AS PolicyKey,\n\tGetPriorPolicyKey_V2_Policy_Step4 AS ExpiringPriorPolicyKey_Step4,\n\tExpiringPriorPolicyKey_Step1_2,\n\tExpiringPriorPolicyKey_Step3,\n\t-- *INF*: DECODE(\r\n\t-- True,\r\n\t-- \r\n\t-- (Not isnull(ExpiringPriorPolicyKey_Step1_2) and ExpiringPriorPolicyKey_Step1_2 != 'N/A' AND ExpiringPriorPolicyKey_Step1_2 <> '' and NOT IS_SPACES(ExpiringPriorPolicyKey_Step1_2) ), ExpiringPriorPolicyKey_Step1_2,\r\n\t-- \r\n\t-- (not isnull(ExpiringPriorPolicyKey_Step3) and ExpiringPriorPolicyKey_Step3  !=  'N/A' AND ExpiringPriorPolicyKey_Step3 <> '' and NOT IS_SPACES(ExpiringPriorPolicyKey_Step3) ), ExpiringPriorPolicyKey_Step3,\r\n\t-- \r\n\t-- (not isnull(ExpiringPriorPolicyKey_Step4) and ExpiringPriorPolicyKey_Step4  !=  'N/A' AND ExpiringPriorPolicyKey_Step4 <> '' and NOT IS_SPACES(ExpiringPriorPolicyKey_Step4)), ExpiringPriorPolicyKey_Step4,\r\n\t-- \r\n\t-- 'N/A')\n\tDECODE(True,\n\t\t( NOT ExpiringPriorPolicyKey_Step1_2 IS NULL AND ExpiringPriorPolicyKey_Step1_2 != 'N/A' AND ExpiringPriorPolicyKey_Step1_2 <> '' AND NOT IS_SPACES(ExpiringPriorPolicyKey_Step1_2) ), ExpiringPriorPolicyKey_Step1_2,\n\t\t( NOT ExpiringPriorPolicyKey_Step3 IS NULL AND ExpiringPriorPolicyKey_Step3 != 'N/A' AND ExpiringPriorPolicyKey_Step3 <> '' AND NOT IS_SPACES(ExpiringPriorPolicyKey_Step3) ), ExpiringPriorPolicyKey_Step3,\n\t\t( NOT ExpiringPriorPolicyKey_Step4 IS NULL AND ExpiringPriorPolicyKey_Step4 != 'N/A' AND ExpiringPriorPolicyKey_Step4 <> '' AND NOT IS_SPACES(ExpiringPriorPolicyKey_Step4) ), ExpiringPriorPolicyKey_Step4,\n\t\t'N/A') AS o_ExpiringPriorPolicyKey\n\tFROM Jnr_ExpiringPolicyderivationJoiner\n),\nUPD_Policy_Dim_UpdateExpiringPriorPolicy AS (\n\tSELECT\n\tPolicyKey AS pol_key, \n\to_ExpiringPriorPolicyKey AS ExpiringPriorPolicyKey\n\tFROM Exp_FinalDerivationOfExpiringPolicyKey\n),\npolicy_dim_ExpiringPriorPolicy AS (\n\tUPDATE @{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim SET ExpiringPriorPolicyKey = S.ExpiringPriorPolicyKey WHERE pol_key = S.pol_key\n\tFROM UPD_Policy_Dim_UpdateExpiringPriorPolicy S\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246511"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905531"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604531"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 02:57:01"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 03:31:13"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Policy"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_WC_DATA_MART_Policy"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "PMS"
            },
            "TARGET_TABLE_OWNER_V2": {
                "type": "string",
                "defaultValue": "V2"
            },
            "SOURCE_TABLE_OWNER_V2": {
                "type": "string",
                "defaultValue": "v2"
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "RPT_EDM"
            },
            "DBCONNECTION_STAGE": {
                "type": "string",
                "defaultValue": "SQLServer_WC_STAGE_Claim"
            }
        },
        "folder": {
            "name": "Policy DataMart/"
        },
        "annotations": []
    }
}