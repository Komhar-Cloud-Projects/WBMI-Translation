{
    "name": "s_m_POL_FEED_WorkCatastropheExposureTransaction_DCT",
    "properties": {
        "activities": [
            {
                "name": "m_POL_FEED_WorkCatastropheExposureTransaction_DCT",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_InsuranceReferenceCoverageDim AS (\n\tselect distinct DctRiskTypeCode,\r\n\tDctCoverageTypeCode,\r\n\tDctPerilGroup,\r\n\tDctSubCoverageTypeCode,\r\n\tInsuranceLineCode,\r\n\tDctCoverageVersion,\r\n\tCoverageDescription,\r\n\tCoverageGroupDescription \r\n\tfrom @{pipeline().parameters.DATAMART_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceCoverageDim\n),\nEXP_Src_Data AS (\n\tSELECT\n\tDctRiskTypeCode,\n\tDctCoverageTypeCode,\n\t-- *INF*: Upper(DctCoverageTypeCode)\n\tUpper(DctCoverageTypeCode) AS Upper_DctCoverageTypeCode,\n\tDctPerilGroup,\n\tDctSubCoverageTypeCode,\n\tInsuranceLineCode,\n\tDctCoverageVersion,\n\tCoverageDescription,\n\tCoverageGroupDescription\n\tFROM SQ_InsuranceReferenceCoverageDim\n),\nSQ_PremiumTransaction AS (\n\tdeclare @ProcessDate as datetime\r\n\t\r\n\tset @ProcessDate=@{pipeline().parameters.PROCESS_DATE};\r\n\t\r\n\tSELECT PT.SourceSystemID,\r\n\t\tPT.PremiumTransactionAKID,\r\n\t\tPOL.pol_key,\r\n\t\tPOL.Pol_ak_id,\r\n\t\tRL.LocationUnitNumber,\r\n\t\tRC.SubLocationUnitNumber,\r\n\t\tPT.WindCoverageFlag,\r\n\t\tPT.PremiumTransactionAmount,\r\n\t\tRC.RatingCoverageAKID,\r\n\t\tPC.PolicyCoverageAKID,\r\n\t\tRL.RiskLocationAKID,\r\n\t\tCDCA.VehicleNumber,\r\n\t\tRC.RiskType,\r\n\t\tRC.CoverageType,\r\n\t\tRC.PerilGroup,\r\n\t\tRC.SubCoverageTypeCode,\r\n\t\tSIL.StandardInsuranceLineCode,\r\n\t\tRC.CoverageVersion,\r\n\t      POL.Terrorism_risk_ind,\r\n\t      POL.StrategicProfitCenterAKId,\r\n\t      POL.InsuranceSegmentAKId,\r\n\t      POL.PolicyOfferingAKId,\r\n\t\tRC.ProductAKId,\r\n\t\tRC.InsuranceReferenceLineOfBusinessAKId\r\n\tFROM @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction PT\r\n\tINNER JOIN @{pipeline().parameters.DATAMART_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.CoverageDetailDim CDD ON PT.PremiumTransactionID = CDD.EDWPremiumTransactionPKId\r\n\t\tAND CDD.CoverageEffectiveDate <= @ProcessDate\r\n\t\tAND CDD.CoverageExpirationDate > @ProcessDate\r\n\t      AND PT.SourceSystemID='DCT'\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage RC ON PT.RatingCoverageAKID = RC.RatingCoverageAKID\r\n\t\tAND RC.EffectiveDate = PT.EffectiveDate\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC ON PC.PolicyCoverageAKID = RC.PolicyCoverageAKID\r\n\t\tAND PC.CurrentSnapshotFlag = 1\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line SIL ON PC.SupInsuranceLineId = SIL.sup_ins_line_id\r\n\t\tAND SIL.crrnt_snpsht_flag = 1\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation RL ON PC.RiskLocationAKID = RL.RiskLocationAKID\r\n\t\tAND RL.CurrentSnapshotFlag = 1\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy POL ON POL.pol_ak_id = RL.PolicyAKID\r\n\t\tAND POL.crrnt_snpsht_flag = 1\r\n\t\tAND POL.pol_eff_date <= @ProcessDate\r\n\t\tAND POL.pol_exp_date > @ProcessDate \r\n\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.Product PRD ON PRD.ProductAKId = RC.ProductAKId\r\n\t\tAND PRD.CurrentSnapshotFlag = 1\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLineOfBusiness IRLOB ON IRLOB.InsuranceReferenceLineOfBusinessAKId = RC.InsuranceReferenceLineOfBusinessAKId\r\n\t\tAND IRLOB.CurrentSnapshotFlag = 1\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.CoverageDetailCommercialAuto CDCA ON CDCA.PremiumTransactionId = PT.PremiumTransactionId\r\n\tWHERE PT.CurrentSnapshotFlag = 1\r\n\tAND PT.ReasonAmendedCode not in ('CWO','Claw Back')\t\r\n\tAND PT.PremiumTransactionBookedDate<=@ProcessDate\r\n\tAND PT.PremiumTransactionEnteredDate<=@ProcessDate\r\n\tAND PT.PremiumTransactionEffectiveDate<=@ProcessDate\r\n\t\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n),\nEXP_SRCData AS (\n\tSELECT\n\tSourceSystemID,\n\tPremiumTransactionAKID,\n\tpol_key,\n\tpol_ak_id,\n\tLocationUnitNumber,\n\tSubLocationUnitNumber,\n\tWindCoverageFlag,\n\tPremiumTransactionAmount,\n\tRatingCoverageAKID,\n\tPolicyCoverageAKID,\n\tRiskLocationAKID,\n\tVehicleNumber,\n\tRiskType,\n\tCoverageType,\n\tPerilGroup,\n\tSubCoverageTypeCode,\n\tStandardInsuranceLineCode,\n\tCoverageVersion,\n\tTerrorism_risk_ind,\n\tStrategicProfitCenterAKId,\n\tInsuranceSegmentAKId,\n\tPolicyOfferingAKId,\n\tProductAKId,\n\tInsuranceReferenceLineOfBusinessAKId\n\tFROM SQ_PremiumTransaction\n),\nLKP_CancelledCVG AS (\n\tSELECT\n\tRatingCoverageAKID,\n\tPolicyCoverageAKID\n\tFROM (\n\t\tdeclare @ProcessDate as datetime\r\n\t\t\r\n\t\tset @ProcessDate=DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,-1,GETDATE()) + @{pipeline().parameters.NO_OF_MONTH},0))\r\n\t\t\r\n\t\tselect distinct RatingCoverageAKID as RatingCoverageAKID,PolicyCoverageAKID as PolicyCoverageAKID from (\r\n\t\tselect A.PolicyCoverageAKID,A.RatingCoverageAKID,First_Value(RatingCoverageCancellationDate) over(partition by PolicyCoverageAKID,A.RatingCoverageAKID order by A.EffectiveDate desc) RatingCoverageCancellationDate\r\n\t\tfrom @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage A \r\n\t\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction B\r\n\t\ton A.RatingCoverageAKID=B.RatingCoverageAKId\r\n\t\tand A.EffectiveDate=B.EffectiveDate\r\n\t\twhere B.ReasonAmendedCode not in ('CWO','Claw Back')\t\r\n\t\tAND B.PremiumTransactionBookedDate<=@ProcessDate\r\n\t\tAND B.PremiumTransactionEnteredDate<=@ProcessDate\r\n\t\tAND B.PremiumTransactionEffectiveDate<=@ProcessDate\r\n\t\tand B.SourceSystemID='DCT') A\r\n\t\twhere RatingCoverageCancellationDate<=@ProcessDate\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY RatingCoverageAKID,PolicyCoverageAKID ORDER BY RatingCoverageAKID) = 1\n),\nLKP_CancelledPolicy AS (\n\tSELECT\n\tEDWPolicyAKId,\n\tpol_ak_id\n\tFROM (\n\t\tdeclare @ProcessDate as datetime\r\n\t\t\r\n\t\tset @ProcessDate=@{pipeline().parameters.PROCESS_DATE};\r\n\t\t\r\n\t\tselect EDWPolicyAKId as EDWPolicyAKId from (\r\n\t\tselect PCSD.EDWPolicyAKId, Rundate,max(Rundate) over(partition by PCSD.EDWPolicyAKId) MaxRundate,PolicyCancellationDate\r\n\t\tfrom @{pipeline().parameters.DATAMART_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCurrentStatusDim PCSD\r\n\t\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy p \r\n\t\ton PCSD.EDWPolicyAKId = p.pol_ak_id \r\n\t\tand p.source_sys_id = 'DCT' \r\n\t\tand p.crrnt_snpsht_flag = 1\r\n\t\twhere PCSD.RunDate<=@ProcessDate) A\r\n\t\twhere RunDate=MaxRundate\r\n\t\tand PolicyCancellationDate > @ProcessDate\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EDWPolicyAKId ORDER BY EDWPolicyAKId) = 1\n),\nLKP_InsuranceReferenceLineOfBusiness AS (\n\tSELECT\n\tInsuranceReferenceLineOfBusinessDescription,\n\tIN_InsuranceReferenceLineOfBusinessAKId,\n\tInsuranceReferenceLineOfBusinessAKId\n\tFROM (\n\t\tSELECT \n\t\t\tInsuranceReferenceLineOfBusinessDescription,\n\t\t\tIN_InsuranceReferenceLineOfBusinessAKId,\n\t\t\tInsuranceReferenceLineOfBusinessAKId\n\t\tFROM @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLineOfBusiness\n\t\tWHERE CurrentSnapshotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY InsuranceReferenceLineOfBusinessAKId ORDER BY InsuranceReferenceLineOfBusinessDescription) = 1\n),\nLKP_PolicyOffering AS (\n\tSELECT\n\tPolicyOfferingDescription,\n\tInsuranceSegmentAKId,\n\tStrategicProfitCenterAKId,\n\tPolicyOfferingAKId\n\tFROM (\n\t\tselect distinct PO.PolicyOfferingDescription as PolicyOfferingDescription,\r\n\t\tISG.InsuranceSegmentAKId as InsuranceSegmentAKId,\r\n\t\tSPC.StrategicProfitCenterAKId as StrategicProfitCenterAKId,\r\n\t\tPO.PolicyOfferingAKId as PolicyOfferingAKId\r\n\t\t\r\n\t\tfrom @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy POL \r\n\t\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment ISG \r\n\t\t\ton POL.InsuranceSegmentAKId = ISG.InsuranceSegmentAKId\r\n\t\t\tAND ISG.CurrentSnapshotFlag = 1\r\n\t\t\tAND ISG.InsuranceSegmentAbbreviation = 'CL'\r\n\t\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter SPC \r\n\t\t       ON POL.StrategicProfitCenterAKId = SPC.StrategicProfitCenterAKId\r\n\t\t\tAND SPC.CurrentSnapshotFlag = 1\r\n\t\t\tAND SPC.StrategicProfitCenterDescription IN ('West Bend Commercial Lines', 'NSI')\r\n\t\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyOffering PO \r\n\t\t       ON POL.PolicyOfferingAKId = PO.PolicyOfferingAKId\r\n\t\t\tAND PO.CurrentSnapshotFlag = 1\r\n\t\twhere POL.source_sys_id='DCT'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY InsuranceSegmentAKId,StrategicProfitCenterAKId,PolicyOfferingAKId ORDER BY PolicyOfferingDescription) = 1\n),\nLKP_Product AS (\n\tSELECT\n\tProductDescription,\n\tIN_ProductAKId,\n\tProductAKId\n\tFROM (\n\t\tSELECT \n\t\t\tProductDescription,\n\t\t\tIN_ProductAKId,\n\t\t\tProductAKId\n\t\tFROM @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.Product\n\t\tWHERE CurrentSnapshotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ProductAKId ORDER BY ProductDescription) = 1\n),\nEXP_Flag_Cancelled_Policy_Coverages AS (\n\tSELECT\n\tEXP_SRCData.SourceSystemID,\n\tEXP_SRCData.PremiumTransactionAKID,\n\tEXP_SRCData.pol_key,\n\tEXP_SRCData.LocationUnitNumber,\n\tEXP_SRCData.SubLocationUnitNumber,\n\tEXP_SRCData.PremiumTransactionAmount,\n\tEXP_SRCData.RatingCoverageAKID,\n\tEXP_SRCData.PolicyCoverageAKID,\n\tEXP_SRCData.RiskLocationAKID,\n\tEXP_SRCData.VehicleNumber,\n\tLKP_Product.ProductDescription AS LKP_ProductDescription,\n\tLKP_InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessDescription AS LKP_InsuranceReferenceLineOfBusinessDescription,\n\tLKP_PolicyOffering.PolicyOfferingDescription,\n\tEXP_SRCData.RiskType,\n\tEXP_SRCData.CoverageType,\n\t-- *INF*: Upper(CoverageType)\n\tUpper(CoverageType) AS Upper_CoverageType,\n\tEXP_SRCData.PerilGroup,\n\tEXP_SRCData.SubCoverageTypeCode,\n\tEXP_SRCData.StandardInsuranceLineCode,\n\tEXP_SRCData.CoverageVersion,\n\tEXP_SRCData.Terrorism_risk_ind,\n\tLKP_CancelledCVG.RatingCoverageAKID AS LKP_RatingCoverageAKID,\n\tLKP_CancelledPolicy.EDWPolicyAKId AS LKP_EDWPolicyAKId,\n\t-- *INF*: IIF((NOT ISNULL(LKP_RatingCoverageAKID)) OR ISNULL(LKP_EDWPolicyAKId) OR ISNULL(PolicyOfferingDescription) OR ISNULL(LKP_ProductDescription) OR ISNULL(LKP_InsuranceReferenceLineOfBusinessDescription),'1','0')\n\tIFF(\n\t    (LKP_RatingCoverageAKID IS NOT NULL)\n\t    or LKP_EDWPolicyAKId IS NULL\n\t    or PolicyOfferingDescription IS NULL\n\t    or LKP_ProductDescription IS NULL\n\t    or LKP_InsuranceReferenceLineOfBusinessDescription IS NULL,\n\t    '1',\n\t    '0'\n\t) AS FilterFlag,\n\tEXP_SRCData.StrategicProfitCenterAKId,\n\tEXP_SRCData.InsuranceSegmentAKId,\n\tEXP_SRCData.PolicyOfferingAKId,\n\tEXP_SRCData.ProductAKId,\n\tEXP_SRCData.InsuranceReferenceLineOfBusinessAKId,\n\tEXP_SRCData.WindCoverageFlag\n\tFROM EXP_SRCData\n\tLEFT JOIN LKP_CancelledCVG\n\tON LKP_CancelledCVG.RatingCoverageAKID = EXP_SRCData.RatingCoverageAKID AND LKP_CancelledCVG.PolicyCoverageAKID = EXP_SRCData.PolicyCoverageAKID\n\tLEFT JOIN LKP_CancelledPolicy\n\tON LKP_CancelledPolicy.EDWPolicyAKId = EXP_SRCData.pol_ak_id\n\tLEFT JOIN LKP_InsuranceReferenceLineOfBusiness\n\tON LKP_InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessAKId = EXP_SRCData.InsuranceReferenceLineOfBusinessAKId\n\tLEFT JOIN LKP_PolicyOffering\n\tON LKP_PolicyOffering.InsuranceSegmentAKId = EXP_SRCData.InsuranceSegmentAKId AND LKP_PolicyOffering.StrategicProfitCenterAKId = EXP_SRCData.StrategicProfitCenterAKId AND LKP_PolicyOffering.PolicyOfferingAKId = EXP_SRCData.PolicyOfferingAKId\n\tLEFT JOIN LKP_Product\n\tON LKP_Product.ProductAKId = EXP_SRCData.ProductAKId\n),\nFIL_Cancelled_Policies_Coverages AS (\n\tSELECT\n\tSourceSystemID, \n\tPremiumTransactionAKID, \n\tpol_key, \n\tLocationUnitNumber, \n\tSubLocationUnitNumber, \n\tWindCoverageFlag, \n\tPremiumTransactionAmount, \n\tRatingCoverageAKID, \n\tPolicyCoverageAKID, \n\tRiskLocationAKID, \n\tVehicleNumber, \n\tLKP_ProductDescription AS ProductDescription, \n\tLKP_InsuranceReferenceLineOfBusinessDescription AS InsuranceReferenceLineOfBusinessDescription, \n\tPolicyOfferingDescription, \n\tRiskType, \n\tCoverageType, \n\tUpper_CoverageType, \n\tPerilGroup, \n\tSubCoverageTypeCode, \n\tStandardInsuranceLineCode, \n\tCoverageVersion, \n\tTerrorism_risk_ind, \n\tFilterFlag, \n\tLKP_RatingCoverageAKID, \n\tLKP_EDWPolicyAKId\n\tFROM EXP_Flag_Cancelled_Policy_Coverages\n\tWHERE FilterFlag='0'\n),\nJNR_Get_CVG_Info AS (SELECT\n\tFIL_Cancelled_Policies_Coverages.SourceSystemID, \n\tFIL_Cancelled_Policies_Coverages.PremiumTransactionAKID, \n\tFIL_Cancelled_Policies_Coverages.pol_key, \n\tFIL_Cancelled_Policies_Coverages.LocationUnitNumber, \n\tFIL_Cancelled_Policies_Coverages.SubLocationUnitNumber, \n\tFIL_Cancelled_Policies_Coverages.WindCoverageFlag, \n\tFIL_Cancelled_Policies_Coverages.PremiumTransactionAmount, \n\tFIL_Cancelled_Policies_Coverages.RatingCoverageAKID, \n\tFIL_Cancelled_Policies_Coverages.PolicyCoverageAKID, \n\tFIL_Cancelled_Policies_Coverages.RiskLocationAKID, \n\tFIL_Cancelled_Policies_Coverages.VehicleNumber, \n\tFIL_Cancelled_Policies_Coverages.ProductDescription, \n\tFIL_Cancelled_Policies_Coverages.InsuranceReferenceLineOfBusinessDescription, \n\tFIL_Cancelled_Policies_Coverages.PolicyOfferingDescription, \n\tFIL_Cancelled_Policies_Coverages.RiskType, \n\tFIL_Cancelled_Policies_Coverages.CoverageType, \n\tFIL_Cancelled_Policies_Coverages.Upper_CoverageType, \n\tFIL_Cancelled_Policies_Coverages.PerilGroup, \n\tFIL_Cancelled_Policies_Coverages.SubCoverageTypeCode, \n\tFIL_Cancelled_Policies_Coverages.StandardInsuranceLineCode, \n\tFIL_Cancelled_Policies_Coverages.CoverageVersion, \n\tFIL_Cancelled_Policies_Coverages.Terrorism_risk_ind, \n\tEXP_Src_Data.DctRiskTypeCode, \n\tEXP_Src_Data.DctCoverageTypeCode, \n\tEXP_Src_Data.DctPerilGroup, \n\tEXP_Src_Data.DctSubCoverageTypeCode, \n\tEXP_Src_Data.Upper_DctCoverageTypeCode, \n\tEXP_Src_Data.InsuranceLineCode, \n\tEXP_Src_Data.DctCoverageVersion, \n\tEXP_Src_Data.CoverageDescription, \n\tEXP_Src_Data.CoverageGroupDescription\n\tFROM FIL_Cancelled_Policies_Coverages\n\tINNER JOIN EXP_Src_Data\n\tON EXP_Src_Data.DctRiskTypeCode = FIL_Cancelled_Policies_Coverages.RiskType AND EXP_Src_Data.Upper_DctCoverageTypeCode = FIL_Cancelled_Policies_Coverages.Upper_CoverageType AND EXP_Src_Data.DctPerilGroup = FIL_Cancelled_Policies_Coverages.PerilGroup AND EXP_Src_Data.DctSubCoverageTypeCode = FIL_Cancelled_Policies_Coverages.SubCoverageTypeCode AND EXP_Src_Data.InsuranceLineCode = FIL_Cancelled_Policies_Coverages.StandardInsuranceLineCode AND EXP_Src_Data.DctCoverageVersion = FIL_Cancelled_Policies_Coverages.CoverageVersion\n),\nLKP_SupCatastropheExposureBusinessType_BusinessType AS (\n\tSELECT\n\tBusinessType,\n\tAddToLocationPremiumFlag,\n\tSourceSystemId,\n\tPolicyOfferingDescription,\n\tProductDescription,\n\tInsuranceReferenceLineOfBusinessDescription,\n\tCoverageGroupDescription,\n\tCoverageDescription,\n\tDctCoverageTypeCode\n\tFROM (\n\t\tSELECT \n\t\t\tBusinessType,\n\t\t\tAddToLocationPremiumFlag,\n\t\t\tSourceSystemId,\n\t\t\tPolicyOfferingDescription,\n\t\t\tProductDescription,\n\t\t\tInsuranceReferenceLineOfBusinessDescription,\n\t\t\tCoverageGroupDescription,\n\t\t\tCoverageDescription,\n\t\t\tDctCoverageTypeCode\n\t\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.SupCatastropheExposureBusinessType\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY SourceSystemId,PolicyOfferingDescription,ProductDescription,InsuranceReferenceLineOfBusinessDescription,CoverageGroupDescription,CoverageDescription,DctCoverageTypeCode ORDER BY BusinessType) = 1\n),\nEXP_Cal AS (\n\tSELECT\n\tJNR_Get_CVG_Info.SourceSystemID AS i_SourceSystemID,\n\tJNR_Get_CVG_Info.PremiumTransactionAKID AS i_PremiumTransactionAKID,\n\tJNR_Get_CVG_Info.pol_key AS i_pol_key,\n\tJNR_Get_CVG_Info.LocationUnitNumber AS i_LocationUnitNumber,\n\tJNR_Get_CVG_Info.SubLocationUnitNumber AS i_SubLocationUnitNumber,\n\tJNR_Get_CVG_Info.WindCoverageFlag AS i_WindCoverageFlag,\n\tJNR_Get_CVG_Info.PremiumTransactionAmount AS i_PremiumTransactionAmount,\n\tJNR_Get_CVG_Info.RatingCoverageAKID AS i_RatingCoverageAKID,\n\tJNR_Get_CVG_Info.PolicyCoverageAKID AS i_PolicyCoverageAKID,\n\tJNR_Get_CVG_Info.RiskLocationAKID AS i_RiskLocationAKID,\n\tJNR_Get_CVG_Info.VehicleNumber AS i_VehicleNumber,\n\tJNR_Get_CVG_Info.ProductDescription AS i_ProductDescription,\n\ti_ProductDescription AS o_ProductDescription,\n\tJNR_Get_CVG_Info.CoverageGroupDescription AS i_CoverageGroupDescription,\n\tJNR_Get_CVG_Info.InsuranceReferenceLineOfBusinessDescription AS i_InsuranceReferenceLineOfBusinessDescription,\n\tJNR_Get_CVG_Info.CoverageDescription AS i_CoverageDescription,\n\tJNR_Get_CVG_Info.DctCoverageTypeCode AS i_DctCoverageTypeCode,\n\tJNR_Get_CVG_Info.PolicyOfferingDescription AS i_PolicyOfferingDescription,\n\tLKP_SupCatastropheExposureBusinessType_BusinessType.BusinessType AS i_BusinessType,\n\tLKP_SupCatastropheExposureBusinessType_BusinessType.AddToLocationPremiumFlag AS i_AddToLocationPremiumFlag,\n\tJNR_Get_CVG_Info.Terrorism_risk_ind AS i_Terrorism_risk_ind,\n\t-- *INF*: --IIF( i_BusinessType <> '', i_BusinessType, \r\n\t-- DECODE(TRUE, \r\n\t-- NOT IsNull(i_BusinessType),i_BusinessType,\r\n\t-- i_ProductDescription='Commercial Auto' AND in(i_CoverageGroupDescription,'Comprehensive'), 'Commercial Auto',\r\n\t-- --i_ProductDescription = 'Commercial Property', 'Commercial Property',\r\n\t-- --i_ProductDescription = 'SBOP' AND i_InsuranceReferenceLineOfBusinessDescription <> 'Commercial Inland Marine', 'SBOP',\r\n\t-- --i_ProductDescription = 'SMARTbusiness' AND i_InsuranceReferenceLineOfBusinessDescription <> 'Commercial Inland Marine', 'SMARTbusiness',\r\n\t-- --i_InsuranceReferenceLineOfBusinessDescription = 'Commercial Inland Marine', 'Commercial Inland Marine',\r\n\t-- INSTR(i_CoverageGroupDescription,'Dealers Physical Damage')  > 0 AND INSTR(i_CoverageDescription,'Comprehensive') > 0 , 'Dealers Physical Damage',\r\n\t--  i_CoverageGroupDescription = 'Garagekeepers' AND INSTR(i_CoverageDescription,'Comprehensive') > 0 , 'Garagekeepers Liability',\r\n\t-- NULL)\r\n\t-- --)\n\tDECODE(\n\t    TRUE,\n\t    i_BusinessType IS NOT NULL, i_BusinessType,\n\t    i_ProductDescription = 'Commercial Auto' AND i_CoverageGroupDescription IN ('Comprehensive'), 'Commercial Auto',\n\t    REGEXP_INSTR(i_CoverageGroupDescription, 'Dealers Physical Damage') > 0 AND REGEXP_INSTR(i_CoverageDescription, 'Comprehensive') > 0, 'Dealers Physical Damage',\n\t    i_CoverageGroupDescription = 'Garagekeepers' AND REGEXP_INSTR(i_CoverageDescription, 'Comprehensive') > 0, 'Garagekeepers Liability',\n\t    NULL\n\t) AS v_BusinessType,\n\t-- *INF*: IIF(ISNULL(i_VehicleNumber),-1,i_VehicleNumber)\n\tIFF(i_VehicleNumber IS NULL, - 1, i_VehicleNumber) AS v_VehicleNumber,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditId,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\t-- *INF*: IIF(ISNULL(i_SourceSystemID),'N/A',i_SourceSystemID)\n\tIFF(i_SourceSystemID IS NULL, 'N/A', i_SourceSystemID) AS o_SourceSystemID,\n\t-- *INF*: IIF(ISNULL(i_PremiumTransactionAKID),-1,i_PremiumTransactionAKID)\n\tIFF(i_PremiumTransactionAKID IS NULL, - 1, i_PremiumTransactionAKID) AS o_PremiumTransactionAKID,\n\t-- *INF*: IIF(ISNULL(i_pol_key),'N/A',i_pol_key)\n\tIFF(i_pol_key IS NULL, 'N/A', i_pol_key) AS o_PolicyKey,\n\t-- *INF*: IIF(ISNULL(i_LocationUnitNumber),'N/A',i_LocationUnitNumber)\n\tIFF(i_LocationUnitNumber IS NULL, 'N/A', i_LocationUnitNumber) AS o_LocationNumber,\n\t-- *INF*: IIF(ISNULL(i_SubLocationUnitNumber),'N/A',i_SubLocationUnitNumber)\n\tIFF(i_SubLocationUnitNumber IS NULL, 'N/A', i_SubLocationUnitNumber) AS o_BuildingNumber,\n\t-- *INF*: IIF(v_BusinessType<>'Commercial Auto', NULL, v_VehicleNumber)\n\tIFF(v_BusinessType <> 'Commercial Auto', NULL, v_VehicleNumber) AS o_VehicleNumber,\n\tv_BusinessType AS o_BusinessType,\n\t-- *INF*: IIF(ISNULL(i_CoverageGroupDescription),'N/A',i_CoverageGroupDescription)\n\tIFF(i_CoverageGroupDescription IS NULL, 'N/A', i_CoverageGroupDescription) AS o_CoverageGroupDescription,\n\t-- *INF*: IIF(ISNULL(i_CoverageDescription),'N/A',i_CoverageDescription)\n\tIFF(i_CoverageDescription IS NULL, 'N/A', i_CoverageDescription) AS o_CoverageDescription,\n\t-- *INF*: IIF(ISNULL(i_DctCoverageTypeCode),'N/A',i_DctCoverageTypeCode)\n\tIFF(i_DctCoverageTypeCode IS NULL, 'N/A', i_DctCoverageTypeCode) AS o_DCTCoverageTypeCode,\n\t-- *INF*: IIF(ISNULL(i_PolicyOfferingDescription),'N/A',i_PolicyOfferingDescription)\n\tIFF(i_PolicyOfferingDescription IS NULL, 'N/A', i_PolicyOfferingDescription) AS o_PolicyOfferingDescription,\n\t-- *INF*: DECODE(i_WindCoverageFlag, 'T', 1, 'F', 0, NULL)\n\tDECODE(\n\t    i_WindCoverageFlag,\n\t    'T', 1,\n\t    'F', 0,\n\t    NULL\n\t) AS o_WindCoverageFlag,\n\ti_PremiumTransactionAmount AS o_PremiumTransactionAmount,\n\t-- *INF*: i_RatingCoverageAKID\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- ---IIF(IN(v_BusinessType, 'CIM','DPD','GKD'), NULL, v_RatingCoverageAKID)\n\ti_RatingCoverageAKID AS o_RatingCoverageAKID,\n\t-- *INF*: IIF(ISNULL(i_PolicyCoverageAKID),-1,i_PolicyCoverageAKID)\n\tIFF(i_PolicyCoverageAKID IS NULL, - 1, i_PolicyCoverageAKID) AS o_PolicyCoverageAKID,\n\t-- *INF*: IIF(ISNULL(i_RiskLocationAKID),-1,i_RiskLocationAKID)\n\tIFF(i_RiskLocationAKID IS NULL, - 1, i_RiskLocationAKID) AS o_RiskLocationAKID,\n\t-- *INF*: DECODE(i_AddToLocationPremiumFlag,\r\n\t-- 'T',1,\r\n\t-- 'F',0,\r\n\t-- IIF(i_CoverageDescription <> 'Plus Pak'  \r\n\t-- AND  i_CoverageGroupDescription <>'Terrorism'\r\n\t-- AND  i_CoverageGroupDescription <>'Equipment Breakdown' \r\n\t-- AND  i_CoverageGroupDescription <>'Data Compromise',\r\n\t-- 1,\r\n\t-- 0))\n\tDECODE(\n\t    i_AddToLocationPremiumFlag,\n\t    'T', 1,\n\t    'F', 0,\n\t    IFF(\n\t        i_CoverageDescription <> 'Plus Pak'\n\t        and i_CoverageGroupDescription <> 'Terrorism'\n\t        and i_CoverageGroupDescription <> 'Equipment Breakdown'\n\t        and i_CoverageGroupDescription <> 'Data Compromise',\n\t        1,\n\t        0\n\t    )\n\t) AS o_AddToLocationPremiumFlag,\n\t-- *INF*: DECODE (i_Terrorism_risk_ind, '1', 1, 'Y', 1,'0',0,'N',0, NULL)\r\n\t-- \r\n\t-- --DECODE(i_WindCoverageFlag, 'T', 1, 'F', 0, NULL)\n\tDECODE(\n\t    i_Terrorism_risk_ind,\n\t    '1', 1,\n\t    'Y', 1,\n\t    '0', 0,\n\t    'N', 0,\n\t    NULL\n\t) AS o_TerrorismRiskIndicator\n\tFROM JNR_Get_CVG_Info\n\tLEFT JOIN LKP_SupCatastropheExposureBusinessType_BusinessType\n\tON LKP_SupCatastropheExposureBusinessType_BusinessType.SourceSystemId = JNR_Get_CVG_Info.SourceSystemID AND LKP_SupCatastropheExposureBusinessType_BusinessType.PolicyOfferingDescription = JNR_Get_CVG_Info.PolicyOfferingDescription AND LKP_SupCatastropheExposureBusinessType_BusinessType.ProductDescription = JNR_Get_CVG_Info.ProductDescription AND LKP_SupCatastropheExposureBusinessType_BusinessType.InsuranceReferenceLineOfBusinessDescription = JNR_Get_CVG_Info.InsuranceReferenceLineOfBusinessDescription AND LKP_SupCatastropheExposureBusinessType_BusinessType.CoverageGroupDescription = JNR_Get_CVG_Info.CoverageGroupDescription AND LKP_SupCatastropheExposureBusinessType_BusinessType.CoverageDescription = JNR_Get_CVG_Info.CoverageDescription AND LKP_SupCatastropheExposureBusinessType_BusinessType.DctCoverageTypeCode = JNR_Get_CVG_Info.DctCoverageTypeCode\n),\nFIL_NULL AS (\n\tSELECT\n\to_AuditId AS AuditId, \n\to_CreatedDate AS CreatedDate, \n\to_ModifiedDate AS ModifiedDate, \n\to_SourceSystemID AS SourceSystemID, \n\to_PremiumTransactionAKID AS PremiumTransactionAKID, \n\to_PolicyKey AS PolicyKey, \n\to_LocationNumber AS LocationNumber, \n\to_BuildingNumber AS BuildingNumber, \n\to_VehicleNumber AS VehicleNumber, \n\to_BusinessType AS BusinessType, \n\to_CoverageGroupDescription AS CoverageGroupDescription, \n\to_CoverageDescription AS CoverageDescription, \n\to_DCTCoverageTypeCode AS DCTCoverageTypeCode, \n\to_PolicyOfferingDescription AS PolicyOfferingDescription, \n\to_WindCoverageFlag AS WindCoverageFlag, \n\to_PremiumTransactionAmount AS PremiumTransactionAmount, \n\to_RatingCoverageAKID AS RatingCoverageAKID, \n\to_PolicyCoverageAKID AS PolicyCoverageAKID, \n\to_RiskLocationAKID AS RiskLocationAKID, \n\to_AddToLocationPremiumFlag, \n\to_TerrorismRiskIndicator, \n\to_ProductDescription AS ProductDescription\n\tFROM EXP_Cal\n\tWHERE NOT ISNULL(BusinessType)\n),\nWorkCatastropheExposureTransaction AS (\n\tTRUNCATE TABLE @{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureTransaction;\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureTransaction\n\t(AuditId, CreatedDate, ModifiedDate, SourceSystemId, PremiumTransactionAKID, PolicyKey, LocationNumber, BuildingNumber, VehicleNumber, BusinessType, CoverageGroupDescription, CoverageDescription, DCTCoverageTypeCode, PolicyOfferingDescription, WindCoverageFlag, PremiumTransactionAmount, RatingCoverageAKID, PolicyCoverageAKID, RiskLocationAKID, AddToLocationPremiumFlag, TerrorismRiskIndicator, ProductDescription)\n\tSELECT \n\tAUDITID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tSourceSystemID AS SOURCESYSTEMID, \n\tPREMIUMTRANSACTIONAKID, \n\tPOLICYKEY, \n\tLOCATIONNUMBER, \n\tBUILDINGNUMBER, \n\tVEHICLENUMBER, \n\tBUSINESSTYPE, \n\tCOVERAGEGROUPDESCRIPTION, \n\tCOVERAGEDESCRIPTION, \n\tDCTCOVERAGETYPECODE, \n\tPOLICYOFFERINGDESCRIPTION, \n\tWINDCOVERAGEFLAG, \n\tPREMIUMTRANSACTIONAMOUNT, \n\tRATINGCOVERAGEAKID, \n\tPOLICYCOVERAGEAKID, \n\tRISKLOCATIONAKID, \n\to_AddToLocationPremiumFlag AS ADDTOLOCATIONPREMIUMFLAG, \n\to_TerrorismRiskIndicator AS TERRORISMRISKINDICATOR, \n\tPRODUCTDESCRIPTION\n\tFROM FIL_NULL\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "DATAMART_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "PROCESS_DATE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_TABLE_OWNER_V2": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "NO_OF_MONTH": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "DataFeed -Informatica/PolicyDataServices/"
        },
        "annotations": []
    }
}