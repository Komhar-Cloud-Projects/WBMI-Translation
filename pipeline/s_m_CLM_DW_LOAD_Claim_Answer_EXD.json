{
    "name": "s_m_CLM_DW_LOAD_Claim_Answer_EXD",
    "properties": {
        "activities": [
            {
                "name": "m_CLM_DW_LOAD_Claim_Answer_EXD",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_claim_quest_data_stage AS (\n\tSELECT  \r\n\t    a. claim_nbr\r\n\t      ,a.claimant_id      \r\n\t      , a.question_guid\r\n\t      ,a.optn_set_item_guid\r\n\t      ,a.optn_set_item_val\r\n\t      ,a.optn_text   \r\n\t    \r\n\t  FROM   @{pipeline().parameters.SOURCE_TABLE_OWNER}.claim_quest_data_stage a\n),\nEXP_VALIDATE AS (\n\tSELECT\n\tclaim_nbr AS IN_claim_nbr,\n\tclaimant_id AS IN_claimant_id,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(IN_claim_nbr))) OR IS_SPACES(LTRIM(RTRIM(IN_claim_nbr))) OR LENGTH(LTRIM(RTRIM(IN_claim_nbr)))=0,'N/A',LTRIM(RTRIM(IN_claim_nbr)))\n\tIFF(LTRIM(RTRIM(IN_claim_nbr)) IS NULL OR IS_SPACES(LTRIM(RTRIM(IN_claim_nbr))) OR LENGTH(LTRIM(RTRIM(IN_claim_nbr))) = 0, 'N/A', LTRIM(RTRIM(IN_claim_nbr))) AS v_claim_nbr,\n\tv_claim_nbr AS claim_nbr,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(IN_claimant_id))) OR IS_SPACES(LTRIM(RTRIM(IN_claimant_id))) OR LENGTH(LTRIM(RTRIM(IN_claimant_id)))=0,'N/A',LTRIM(RTRIM(IN_claimant_id)))\n\tIFF(LTRIM(RTRIM(IN_claimant_id)) IS NULL OR IS_SPACES(LTRIM(RTRIM(IN_claimant_id))) OR LENGTH(LTRIM(RTRIM(IN_claimant_id))) = 0, 'N/A', LTRIM(RTRIM(IN_claimant_id))) AS v_client_id,\n\tv_client_id AS client_id,\n\toptn_set_item_guid AS IN_optn_set_item_guid,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(IN_optn_set_item_guid))) OR IS_SPACES(LTRIM(RTRIM(IN_optn_set_item_guid))) OR LENGTH(LTRIM(RTRIM(IN_optn_set_item_guid)))=0,'N/A' ,LTRIM(RTRIM(IN_optn_set_item_guid)))\n\tIFF(LTRIM(RTRIM(IN_optn_set_item_guid)) IS NULL OR IS_SPACES(LTRIM(RTRIM(IN_optn_set_item_guid))) OR LENGTH(LTRIM(RTRIM(IN_optn_set_item_guid))) = 0, 'N/A', LTRIM(RTRIM(IN_optn_set_item_guid))) AS optn_set_item_guid,\n\toptn_set_item_val AS IN_optn_set_item_val,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(IN_optn_set_item_val))) OR IS_SPACES(LTRIM(RTRIM(IN_optn_set_item_val))) OR LENGTH(LTRIM(RTRIM(IN_optn_set_item_val)))=0,'N/A' ,LTRIM(RTRIM(IN_optn_set_item_val)))\n\tIFF(LTRIM(RTRIM(IN_optn_set_item_val)) IS NULL OR IS_SPACES(LTRIM(RTRIM(IN_optn_set_item_val))) OR LENGTH(LTRIM(RTRIM(IN_optn_set_item_val))) = 0, 'N/A', LTRIM(RTRIM(IN_optn_set_item_val))) AS optn_set_item_val,\n\toptn_text AS IN_optn_text,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(IN_optn_text))) OR IS_SPACES(LTRIM(RTRIM(IN_optn_text))) OR LENGTH(LTRIM(RTRIM(IN_optn_text)))=0,'N/A' ,LTRIM(RTRIM(IN_optn_text)))\n\tIFF(LTRIM(RTRIM(IN_optn_text)) IS NULL OR IS_SPACES(LTRIM(RTRIM(IN_optn_text))) OR LENGTH(LTRIM(RTRIM(IN_optn_text))) = 0, 'N/A', LTRIM(RTRIM(IN_optn_text))) AS optn_text,\n\tquestion_guid AS IN_question_guid,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(IN_question_guid))) OR IS_SPACES(LTRIM(RTRIM(IN_question_guid))) OR LENGTH(LTRIM(RTRIM(IN_question_guid)))=0,'N/A' ,LTRIM(RTRIM(IN_question_guid)))\r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(LTRIM(RTRIM(IN_question_guid)) IS NULL OR IS_SPACES(LTRIM(RTRIM(IN_question_guid))) OR LENGTH(LTRIM(RTRIM(IN_question_guid))) = 0, 'N/A', LTRIM(RTRIM(IN_question_guid))) AS question_guid\n\tFROM SQ_claim_quest_data_stage\n),\nLKP_CLAIM_OCCURRENCE_AK_IDS AS (\n\tSELECT\n\tclaimant_num,\n\tclaimant_id,\n\tclaim_party_occurrence_ak_id,\n\tclaim_occurrence_ak_id\n\tFROM (\n\t\tselect\r\n\t\t   LTRIM(RTRIM(CO.claim_occurrence_key)) as claimant_num,\r\n\t\t   LTRIM(RTRIM(CP.claim_party_key))  as claimant_id,\r\n\t\t     CPO.claim_party_occurrence_ak_id as claim_party_occurrence_ak_id , \r\n\t\tCPO.claim_occurrence_ak_id as claim_occurrence_ak_id\r\n\t\t   FROM \r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_party_occurrence CPO,\r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_party CP, \r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_occurrence CO \r\n\t\tWHERE CO.claim_occurrence_ak_id = CPO.claim_occurrence_ak_id  \r\n\t\tAND CP.claim_party_ak_id = CPO.claim_party_ak_id  \r\n\t\tAND CO.source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\r\n\t\tAND CP.source_sys_id =  '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\r\n\t\tAND CPO.source_sys_id =  '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\r\n\t\tAND CPO.claim_party_role_code = 'CLMT'  \r\n\t\tAND CO.crrnt_snpsht_flag = 1\r\n\t\tAND CP.crrnt_snpsht_flag = 1\r\n\t\tAND CPO.crrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claimant_num,claimant_id ORDER BY claimant_num DESC) = 1\n),\nLKP_QUESTION AS (\n\tSELECT\n\tquestion_guid,\n\tquestion_ak_id\n\tFROM (\n\t\tselect        \r\n\t\t         q.question_guid as question_guid, \r\n\t\t         q.question_ak_id as question_ak_id         \r\n\t\t  FROM  question q\r\n\t\t  where q.crrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY question_guid ORDER BY question_guid DESC) = 1\n),\nEXP_LKP_VALUES1 AS (\n\tSELECT\n\tEXP_VALIDATE.claim_nbr,\n\tEXP_VALIDATE.client_id,\n\tEXP_VALIDATE.optn_set_item_guid,\n\tEXP_VALIDATE.optn_set_item_val,\n\tEXP_VALIDATE.optn_text,\n\tLKP_CLAIM_OCCURRENCE_AK_IDS.claim_party_occurrence_ak_id,\n\tLKP_CLAIM_OCCURRENCE_AK_IDS.claim_occurrence_ak_id,\n\tLKP_QUESTION.question_ak_id\n\tFROM EXP_VALIDATE\n\tLEFT JOIN LKP_CLAIM_OCCURRENCE_AK_IDS\n\tON LKP_CLAIM_OCCURRENCE_AK_IDS.claimant_num = EXP_VALIDATE.claim_nbr AND LKP_CLAIM_OCCURRENCE_AK_IDS.claimant_id = EXP_VALIDATE.client_id\n\tLEFT JOIN LKP_QUESTION\n\tON LKP_QUESTION.question_guid = EXP_VALIDATE.question_guid\n),\nLKP_CLAIM_ANSWER AS (\n\tSELECT\n\tclaim_answer_ak_id,\n\toptn_set_item_guid,\n\toptn_set_item_val,\n\toptn_text,\n\tquestion_ak_id,\n\tclaim_occurrence_ak_id,\n\tclaim_party_occurrence_ak_id\n\tFROM (\n\t\tSELECT\r\n\t\t       a.claim_answer_ak_id as claim_answer_ak_id\r\n\t\t       ,a.question_ak_id as question_ak_id\r\n\t\t      ,a.claim_occurrence_ak_id as claim_occurrence_ak_id\r\n\t\t      ,a.claim_party_occurrence_ak_id as claim_party_occurrence_ak_id\r\n\t\t      ,a.optn_set_item_guid as optn_set_item_guid\r\n\t\t      ,a.optn_set_item_val as optn_set_item_val\r\n\t\t      ,a.optn_text as optn_text\r\n\t\t  FROM  claim_answer a\r\n\t\t  WHERE a.crrnt_snpsht_flag = 1\r\n\t\t  AND a.source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY question_ak_id,claim_occurrence_ak_id,claim_party_occurrence_ak_id ORDER BY claim_answer_ak_id DESC) = 1\n),\nEXP_DETECT_CHANGES1 AS (\n\tSELECT\n\tLKP_CLAIM_ANSWER.claim_answer_ak_id,\n\tLKP_CLAIM_ANSWER.optn_set_item_guid AS LKP_optn_set_item_guid,\n\tLKP_CLAIM_ANSWER.optn_set_item_val AS LKP_optn_set_item_val,\n\tLKP_CLAIM_ANSWER.optn_text AS LKP_optn_text,\n\tEXP_LKP_VALUES1.optn_set_item_guid,\n\tEXP_LKP_VALUES1.optn_set_item_val,\n\tEXP_LKP_VALUES1.optn_text,\n\t-- *INF*: IIF(ISNULL(claim_answer_ak_id),'NEW',\r\n\t--      IIF(LTRIM(RTRIM(LKP_optn_set_item_guid)) <> LTRIM(RTRIM(optn_set_item_guid)) OR \r\n\t-- \tLTRIM(RTRIM(LKP_optn_set_item_val)) <> LTRIM(RTRIM(optn_set_item_val)) OR \r\n\t-- \tLTRIM(RTRIM(LKP_optn_text)) <> LTRIM(RTRIM(optn_text))     ,\r\n\t-- \t'UPDATE','NOCHANGE'))\r\n\t-- \n\tIFF(claim_answer_ak_id IS NULL, 'NEW', IFF(LTRIM(RTRIM(LKP_optn_set_item_guid)) <> LTRIM(RTRIM(optn_set_item_guid)) OR LTRIM(RTRIM(LKP_optn_set_item_val)) <> LTRIM(RTRIM(optn_set_item_val)) OR LTRIM(RTRIM(LKP_optn_text)) <> LTRIM(RTRIM(optn_text)), 'UPDATE', 'NOCHANGE')) AS v_changed_flag,\n\tv_changed_flag AS changed_flag,\n\t1 AS crrnt_snpsht_flag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS audit_id,\n\t-- *INF*: IIF(v_changed_flag='NEW',TO_DATE('01/01/1800 01:00:00','MM/DD/YYYY HH24:MI:SS'),SYSDATE)\n\tIFF(v_changed_flag = 'NEW', TO_DATE('01/01/1800 01:00:00', 'MM/DD/YYYY HH24:MI:SS'), SYSDATE) AS eff_from_date,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS eff_to_date,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS source_sys_id,\n\tSYSDATE AS created_date,\n\tSYSDATE AS modified_date,\n\t-- *INF*: TO_DATE('01/01/1800 00:00:00','MM:DD:YYYY HH24:MI:SS')\n\tTO_DATE('01/01/1800 00:00:00', 'MM:DD:YYYY HH24:MI:SS') AS default_date,\n\tEXP_LKP_VALUES1.claim_party_occurrence_ak_id,\n\tEXP_LKP_VALUES1.claim_occurrence_ak_id,\n\tEXP_LKP_VALUES1.question_ak_id\n\tFROM EXP_LKP_VALUES1\n\tLEFT JOIN LKP_CLAIM_ANSWER\n\tON LKP_CLAIM_ANSWER.question_ak_id = EXP_LKP_VALUES1.question_ak_id AND LKP_CLAIM_ANSWER.claim_occurrence_ak_id = EXP_LKP_VALUES1.claim_occurrence_ak_id AND LKP_CLAIM_ANSWER.claim_party_occurrence_ak_id = EXP_LKP_VALUES1.claim_party_occurrence_ak_id\n),\nFIL_INSERT1 AS (\n\tSELECT\n\tclaim_answer_ak_id, \n\toptn_set_item_guid, \n\toptn_set_item_val, \n\toptn_text, \n\tchanged_flag, \n\tcrrnt_snpsht_flag, \n\taudit_id, \n\teff_from_date, \n\teff_to_date, \n\tsource_sys_id, \n\tcreated_date, \n\tmodified_date, \n\tdefault_date, \n\tclaim_party_occurrence_ak_id, \n\tclaim_occurrence_ak_id, \n\tquestion_ak_id\n\tFROM EXP_DETECT_CHANGES1\n\tWHERE changed_flag='NEW' OR changed_flag='UPDATE'\n),\nSEQ_CLAIM_ANSWER AS (\n\tCREATE SEQUENCE SEQ_CLAIM_ANSWER\n\tSTART = 0\n\tINCREMENT = 1;\n),\nEXP_Determine_AK1 AS (\n\tSELECT\n\tclaim_answer_ak_id AS IN_claim_answer_ak_id,\n\t-- *INF*: IIF(changed_flag ='NEW',NEXTVAL,IN_claim_answer_ak_id)\n\tIFF(changed_flag = 'NEW', NEXTVAL, IN_claim_answer_ak_id) AS claim_answer_ak_id,\n\toptn_set_item_guid,\n\toptn_set_item_val,\n\toptn_text,\n\tchanged_flag,\n\tcrrnt_snpsht_flag,\n\taudit_id,\n\teff_from_date,\n\teff_to_date,\n\tsource_sys_id,\n\tcreated_date,\n\tmodified_date,\n\tdefault_date,\n\tSEQ_CLAIM_ANSWER.NEXTVAL,\n\tquestion_ak_id,\n\tclaim_occurrence_ak_id,\n\tclaim_party_occurrence_ak_id\n\tFROM FIL_INSERT1\n),\nclaim_answer_INS AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_answer\n\t(crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date, claim_answer_ak_id, question_ak_id, claim_occurrence_ak_id, claim_party_occurrence_ak_id, optn_set_item_guid, optn_set_item_val, optn_text)\n\tSELECT \n\tCRRNT_SNPSHT_FLAG, \n\tAUDIT_ID, \n\tEFF_FROM_DATE, \n\tEFF_TO_DATE, \n\tSOURCE_SYS_ID, \n\tCREATED_DATE, \n\tMODIFIED_DATE, \n\tCLAIM_ANSWER_AK_ID, \n\tQUESTION_AK_ID, \n\tCLAIM_OCCURRENCE_AK_ID, \n\tCLAIM_PARTY_OCCURRENCE_AK_ID, \n\tOPTN_SET_ITEM_GUID, \n\tOPTN_SET_ITEM_VAL, \n\tOPTN_TEXT\n\tFROM EXP_Determine_AK1\n),\nSQ_claim_answer1 AS (\n\tSELECT \r\n\ta.claim_answer_id,\r\n\ta.source_sys_id,\r\n\ta.claim_answer_ak_id,\r\n\ta.question_ak_id,\r\n\ta.claim_occurrence_ak_id,\r\n\ta.claim_party_occurrence_ak_id,\r\n\ta.optn_set_item_guid,\r\n\ta.optn_set_item_val,\r\n\ta.optn_text \r\n\tFROM\r\n\t @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_answer a\r\n\tWHERE \r\n\ta.source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'  AND\r\n\ta.crrnt_snpsht_flag = 1 AND \r\n\t(a.optn_text <> 'N/A'  OR a.optn_set_item_val <> 'N/A' ) --AND\r\n\t---a.audit_id  <>   '@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}'\n),\nEXP_Pass_Through AS (\n\tSELECT\n\tclaim_answer_id,\n\tquestion_ak_id,\n\tclaim_occurrence_ak_id,\n\tclaim_party_occurrence_ak_id,\n\tsource_sys_id,\n\tclaim_answer_ak_id,\n\toptn_set_item_guid,\n\toptn_set_item_val,\n\toptn_text\n\tFROM SQ_claim_answer1\n),\nLKP_CLAIM_OCCURRENCE_AK_IDS2 AS (\n\tSELECT\n\tclaimant_num,\n\tclaimant_id,\n\tclaim_occurrence_ak_id,\n\tclaim_party_occurrence_ak_id\n\tFROM (\n\t\tselect\r\n\t\t   LTRIM(RTRIM(CO.claim_occurrence_key)) as claimant_num,\r\n\t\t   LTRIM(RTRIM(CP.claim_party_key))  as claimant_id,\r\n\t\t     CPO.claim_party_occurrence_ak_id as claim_party_occurrence_ak_id , \r\n\t\tCPO.claim_occurrence_ak_id as claim_occurrence_ak_id\r\n\t\t   FROM \r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_party_occurrence CPO,\r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_party CP, \r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_occurrence CO \r\n\t\tWHERE CO.claim_occurrence_ak_id = CPO.claim_occurrence_ak_id  \r\n\t\tAND CP.claim_party_ak_id = CPO.claim_party_ak_id  \r\n\t\tAND CO.source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\r\n\t\tAND CP.source_sys_id =  '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\r\n\t\tAND CPO.source_sys_id =  '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\r\n\t\tAND CPO.claim_party_role_code = 'CLMT'  \r\n\t\tAND CO.crrnt_snpsht_flag = 1\r\n\t\tAND CP.crrnt_snpsht_flag = 1\r\n\t\tAND CPO.crrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_occurrence_ak_id,claim_party_occurrence_ak_id ORDER BY claimant_num DESC) = 1\n),\nLKP_QUESTION2 AS (\n\tSELECT\n\tquestion_guid,\n\tquestion_ak_id\n\tFROM (\n\t\tselect        \r\n\t\t         q.question_guid as question_guid, \r\n\t\t         q.question_ak_id as question_ak_id         \r\n\t\t  FROM   @{pipeline().parameters.TARGET_TABLE_OWNER}.question q\r\n\t\t  where q.crrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY question_ak_id ORDER BY question_guid DESC) = 1\n),\nEXP_LKP_VALUES_STAGE AS (\n\tSELECT\n\tLKP_CLAIM_OCCURRENCE_AK_IDS2.claimant_num AS claim_nbr,\n\tLKP_CLAIM_OCCURRENCE_AK_IDS2.claimant_id,\n\tsysdate AS v_sysdate,\n\t'N/A' AS o_optn_set_item_val,\n\tLKP_QUESTION2.question_guid,\n\tv_sysdate AS o_created_date,\n\tv_sysdate AS o_modified_date,\n\tEXP_Pass_Through.claim_answer_id,\n\tEXP_Pass_Through.question_ak_id,\n\tEXP_Pass_Through.claim_occurrence_ak_id AS claim_occurrence_ak_id1,\n\tEXP_Pass_Through.claim_party_occurrence_ak_id AS claim_party_occurrence_ak_id1,\n\tEXP_Pass_Through.claim_answer_ak_id,\n\tEXP_Pass_Through.optn_set_item_guid,\n\tEXP_Pass_Through.optn_text,\n\tEXP_Pass_Through.source_sys_id,\n\tEXP_Pass_Through.optn_set_item_val\n\tFROM EXP_Pass_Through\n\tLEFT JOIN LKP_CLAIM_OCCURRENCE_AK_IDS2\n\tON LKP_CLAIM_OCCURRENCE_AK_IDS2.claim_occurrence_ak_id = EXP_Pass_Through.claim_occurrence_ak_id AND LKP_CLAIM_OCCURRENCE_AK_IDS2.claim_party_occurrence_ak_id = EXP_Pass_Through.claim_party_occurrence_ak_id\n\tLEFT JOIN LKP_QUESTION2\n\tON LKP_QUESTION2.question_ak_id = EXP_Pass_Through.question_ak_id\n),\nLKP_CLAIM_QUEST_DATA_STAGE AS (\n\tSELECT\n\tclaim_quest_data_stage_id,\n\tclaim_nbr,\n\tclaimant_id,\n\tquestion_guid\n\tFROM (\n\t\tSELECT a.claim_quest_data_stage_id  as claim_quest_data_stage_id \r\n\t\t       ,a.claim_nbr as claim_nbr\r\n\t\t      ,a.claimant_id as claimant_id\r\n\t\t      ,a.question_guid as question_guid \r\n\t\t  FROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.claim_quest_data_stage a --\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_nbr,claimant_id,question_guid ORDER BY claim_quest_data_stage_id DESC) = 1\n),\nEXPTRANS1 AS (\n\tSELECT\n\tEXP_LKP_VALUES_STAGE.claim_answer_id,\n\tEXP_LKP_VALUES_STAGE.o_optn_set_item_val,\n\tEXP_LKP_VALUES_STAGE.o_created_date,\n\tEXP_LKP_VALUES_STAGE.o_modified_date,\n\tLKP_CLAIM_QUEST_DATA_STAGE.claim_quest_data_stage_id,\n\tsysdate AS v_sysdate,\n\tv_sysdate AS eff_from_date,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS eff_to_date,\n\tv_sysdate AS eff_to_date_update,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS audit_id,\n\t1 AS crrnt_snpsht_flag_1,\n\t0 AS crrnt_snpsht_flag_0,\n\tEXP_LKP_VALUES_STAGE.question_ak_id,\n\tEXP_LKP_VALUES_STAGE.claim_occurrence_ak_id1,\n\tEXP_LKP_VALUES_STAGE.claim_party_occurrence_ak_id1,\n\tEXP_LKP_VALUES_STAGE.claim_answer_ak_id,\n\tEXP_LKP_VALUES_STAGE.optn_set_item_guid,\n\t'N/A' AS o_optn_text,\n\tEXP_LKP_VALUES_STAGE.source_sys_id,\n\tEXP_LKP_VALUES_STAGE.optn_set_item_val,\n\tEXP_LKP_VALUES_STAGE.optn_text\n\tFROM EXP_LKP_VALUES_STAGE\n\tLEFT JOIN LKP_CLAIM_QUEST_DATA_STAGE\n\tON LKP_CLAIM_QUEST_DATA_STAGE.claim_nbr = EXP_LKP_VALUES_STAGE.claim_nbr AND LKP_CLAIM_QUEST_DATA_STAGE.claimant_id = EXP_LKP_VALUES_STAGE.claimant_id AND LKP_CLAIM_QUEST_DATA_STAGE.question_guid = EXP_LKP_VALUES_STAGE.question_guid\n),\nFILT_DEL AS (\n\tSELECT\n\tclaim_answer_id, \n\to_created_date AS created_date, \n\to_modified_date AS modified_date, \n\tclaim_quest_data_stage_id, \n\tcrrnt_snpsht_flag_1, \n\tcrrnt_snpsht_flag_0, \n\teff_to_date_update, \n\teff_from_date, \n\teff_to_date, \n\taudit_id, \n\tquestion_ak_id, \n\tclaim_occurrence_ak_id1, \n\tclaim_party_occurrence_ak_id1 AS claim_party_occurrence_ak_id11, \n\tclaim_answer_ak_id, \n\toptn_set_item_guid, \n\to_optn_text AS optn_text, \n\tsource_sys_id, \n\toptn_set_item_val, \n\toptn_text AS optn_text1\n\tFROM EXPTRANS1\n\tWHERE ISNULL(claim_quest_data_stage_id)\n),\nEXP_Determine_AK11 AS (\n\tSELECT\n\tclaim_answer_ak_id,\n\toptn_set_item_guid,\n\toptn_set_item_val,\n\toptn_text,\n\tcrrnt_snpsht_flag_1 AS crrnt_snpsht_flag,\n\taudit_id,\n\teff_from_date,\n\teff_to_date,\n\tsource_sys_id,\n\tcreated_date,\n\tmodified_date,\n\tquestion_ak_id,\n\tclaim_occurrence_ak_id1 AS claim_occurrence_ak_id,\n\tclaim_party_occurrence_ak_id11 AS claim_party_occurrence_ak_id,\n\t'N/A' AS o_default_NA\n\tFROM FILT_DEL\n),\nclaim_answer_upd_del AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_answer\n\t(crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date, claim_answer_ak_id, question_ak_id, claim_occurrence_ak_id, claim_party_occurrence_ak_id, optn_set_item_guid, optn_set_item_val, optn_text)\n\tSELECT \n\tCRRNT_SNPSHT_FLAG, \n\tAUDIT_ID, \n\tEFF_FROM_DATE, \n\tEFF_TO_DATE, \n\tSOURCE_SYS_ID, \n\tCREATED_DATE, \n\tMODIFIED_DATE, \n\tCLAIM_ANSWER_AK_ID, \n\tQUESTION_AK_ID, \n\tCLAIM_OCCURRENCE_AK_ID, \n\tCLAIM_PARTY_OCCURRENCE_AK_ID, \n\tOPTN_SET_ITEM_GUID, \n\to_default_NA AS OPTN_SET_ITEM_VAL, \n\to_default_NA AS OPTN_TEXT\n\tFROM EXP_Determine_AK11\n),\nSQ_claim_answer AS (\n\tSELECT \r\n\ta.claim_answer_id, \r\n\ta.eff_from_date, \r\n\ta.eff_to_date ,\r\n\ta.question_ak_id,\r\n\ta.claim_occurrence_ak_id,\r\n\ta.claim_party_occurrence_ak_id\r\n\t \r\n\tFROM\r\n\t @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_answer a \r\n\tWHERE \r\n\ta.source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'  AND\r\n\tEXISTS(SELECT 1 \r\n\t                 FROM @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_answer b               \r\n\t                 WHERE source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}' and crrnt_snpsht_flag = 1\r\n\t                 AND a.question_ak_id = b.question_ak_id\r\n\t                 AND a.claim_occurrence_ak_id = b.claim_occurrence_ak_id\r\n\t                 AND a.claim_party_occurrence_ak_id = b.claim_party_occurrence_ak_id\r\n\t \t           GROUP BY b.question_ak_id,\r\n\t                        b.claim_occurrence_ak_id,\r\n\t                         b.claim_party_occurrence_ak_id\r\n\t                 HAVING COUNT(*) >1) \r\n\tORDER BY a.question_ak_id,\r\n\ta.claim_occurrence_ak_id,\r\n\ta.claim_party_occurrence_ak_id, a.eff_from_date DESC\n),\nEXP_Lag_eff_from_date AS (\n\tSELECT\n\tclaim_answer_id,\n\tquestion_ak_id,\n\tclaim_occurrence_ak_id AS claim_occurence_ak_id,\n\tclaim_party_occurrence_ak_id AS claim_party_ccurrence_ak_id,\n\teff_from_date,\n\teff_to_date AS orig_eff_to_date,\n\t-- *INF*: DECODE(TRUE, question_ak_id=v_prev_row_question_ak_id AND claim_occurence_ak_id = v_prev_row_claim_occurrence_ak_id AND claim_party_ccurrence_ak_id = v_prev_row_claim_party_ccurrence_ak_id,ADD_TO_DATE(v_prev_row_eff_from_date,'SS',-1),orig_eff_to_date)\n\tDECODE(TRUE,\n\t\tquestion_ak_id = v_prev_row_question_ak_id AND claim_occurence_ak_id = v_prev_row_claim_occurrence_ak_id AND claim_party_ccurrence_ak_id = v_prev_row_claim_party_ccurrence_ak_id, ADD_TO_DATE(v_prev_row_eff_from_date, 'SS', - 1),\n\t\torig_eff_to_date) AS v_eff_to_date,\n\tv_eff_to_date AS eff_to_date,\n\tquestion_ak_id AS v_prev_row_question_ak_id,\n\tclaim_occurence_ak_id AS v_prev_row_claim_occurrence_ak_id,\n\tclaim_party_ccurrence_ak_id AS v_prev_row_claim_party_ccurrence_ak_id,\n\teff_from_date AS v_prev_row_eff_from_date,\n\t0 AS crrnt_snpsht_flag,\n\tSYSDATE AS modified_date\n\tFROM SQ_claim_answer\n),\nFIL_Firstrow_INAKIDGROUP AS (\n\tSELECT\n\tclaim_answer_id, \n\torig_eff_to_date, \n\teff_to_date, \n\tcrrnt_snpsht_flag, \n\tmodified_date\n\tFROM EXP_Lag_eff_from_date\n\tWHERE orig_eff_to_date <>eff_to_date\n),\nUPD_CLAIM_ANSWER AS (\n\tSELECT\n\tclaim_answer_id, \n\teff_to_date, \n\tcrrnt_snpsht_flag, \n\tmodified_date\n\tFROM FIL_Firstrow_INAKIDGROUP\n),\nclaim_answer_UPD AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_answer AS T\n\tUSING UPD_CLAIM_ANSWER AS S\n\tON T.claim_answer_id = S.claim_answer_id\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.crrnt_snpsht_flag = S.crrnt_snpsht_flag, T.eff_to_date = S.eff_to_date, T.modified_date = S.modified_date\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "Claims DataWarehouse/"
        },
        "annotations": []
    }
}