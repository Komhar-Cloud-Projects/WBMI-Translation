{
    "name": "m_POL_DW_LOAD_CoverageDetailWorkersCompensation",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DW_LOAD_CoverageDetailWorkersCompensation",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_Pif43LXZWCStage AS (\n\tSELECT PT.PremiumTransactionID,\r\n\tPT.CurrentSnapshotFlag,\r\n\tSC.StatisticalCoverageHashKey,\r\n\tBS.BureauCode5\r\n\tFrom @{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction PT\r\n\tInner join @{pipeline().parameters.TARGET_TABLE_OWNER}.StatisticalCoverage SC on PT.StatisticalCoverageAKID = SC.StatisticalCoverageAKID\r\n\tInner join @{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage PC on SC.PolicyCoverageAKID = PC.PolicyCoverageAKID and PC.TypeBureauCode in ('WC','WP')\r\n\tLeft join @{pipeline().parameters.TARGET_TABLE_OWNER}.BureauStatisticalCode BS on BS.PremiumTransactionAKID = PT.PremiumTransactionAKID and BS.CurrentSnapshotFlag = 1\r\n\twhere\r\n\tPT.CreatedDate >='@{pipeline().parameters.SELECTION_START_TS}'\r\n\tand PT.SourceSystemID = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n),\nEXP_DefaultValue AS (\n\tSELECT\n\tPremiumTransactionID AS i_PremiumTransactionID,\n\tCurrentSnapshotFlag AS i_CurrentSnapshotFlag,\n\tStatisticalCoverageHashKey AS i_StatisticalCoverageHashKey,\n\tBureauCode5 AS i_BureauCode5,\n\ti_PremiumTransactionID AS o_PremiumTransactionID,\n\ti_CurrentSnapshotFlag AS o_CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t-- *INF*: TO_DATE('01/01/1800 00:00:00','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('01/01/1800 00:00:00', 'MM/DD/YYYY HH24:MI:SS') AS o_EffectiveDate,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS o_ExpirationDate,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemID,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\ti_StatisticalCoverageHashKey AS o_CoverageGuid,\n\t-- *INF*: Decode(TRUE,\r\n\t-- ISNULL(i_BureauCode5),'0',\r\n\t-- IS_SPACES(i_BureauCode5),'0',\r\n\t-- i_BureauCode5='','0',\r\n\t-- SUBSTR(i_BureauCode5,1,1)='A','1',\r\n\t-- SUBSTR(i_BureauCode5,2,1)='M','1',\r\n\t-- '0'\r\n\t-- )\n\tDecode(TRUE,\n\ti_BureauCode5 IS NULL, '0',\n\tIS_SPACES(i_BureauCode5), '0',\n\ti_BureauCode5 = '', '0',\n\tSUBSTR(i_BureauCode5, 1, 1) = 'A', '1',\n\tSUBSTR(i_BureauCode5, 2, 1) = 'M', '1',\n\t'0') AS o_AdmiraltyActFlag,\n\t-- *INF*: Decode(TRUE,\r\n\t-- ISNULL(i_BureauCode5),'0',\r\n\t-- IS_SPACES(i_BureauCode5),'0',\r\n\t-- i_BureauCode5='','0',\r\n\t-- SUBSTR(i_BureauCode5,1,1)='L','1',\r\n\t-- SUBSTR(i_BureauCode5,2,1)='M','1',\r\n\t-- '0')\n\tDecode(TRUE,\n\ti_BureauCode5 IS NULL, '0',\n\tIS_SPACES(i_BureauCode5), '0',\n\ti_BureauCode5 = '', '0',\n\tSUBSTR(i_BureauCode5, 1, 1) = 'L', '1',\n\tSUBSTR(i_BureauCode5, 2, 1) = 'M', '1',\n\t'0') AS o_FederalEmployersLiabilityActFlag,\n\t-- *INF*: Decode(TRUE,\r\n\t-- ISNULL(i_BureauCode5),'0',\r\n\t-- IS_SPACES(i_BureauCode5),'0',\r\n\t-- i_BureauCode5='','0',\r\n\t-- SUBSTR(i_BureauCode5,1,1)='F','1',\r\n\t-- SUBSTR(i_BureauCode5,1,1)='U','1',\r\n\t-- '0'\r\n\t-- )\n\tDecode(TRUE,\n\ti_BureauCode5 IS NULL, '0',\n\tIS_SPACES(i_BureauCode5), '0',\n\ti_BureauCode5 = '', '0',\n\tSUBSTR(i_BureauCode5, 1, 1) = 'F', '1',\n\tSUBSTR(i_BureauCode5, 1, 1) = 'U', '1',\n\t'0') AS o_USLongshoreandHarborWorkersCompensationActFlag\n\tFROM SQ_Pif43LXZWCStage\n),\nLKP_CoverageDetailWorkersCompensation AS (\n\tSELECT\n\tPremiumTransactionID,\n\tCoverageGuid,\n\tAdmiraltyActFlag,\n\tFederalEmployersLiabilityActFlag,\n\tUSLongShoreAndHarborWorkersCompensationActFlag\n\tFROM (\n\t\tSELECT \n\t\t\tPremiumTransactionID,\n\t\t\tCoverageGuid,\n\t\t\tAdmiraltyActFlag,\n\t\t\tFederalEmployersLiabilityActFlag,\n\t\t\tUSLongShoreAndHarborWorkersCompensationActFlag\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailWorkersCompensation\n\t\tWHERE SourceSystemID='@{pipeline().parameters.SOURCE_SYSTEM_ID}'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionID ORDER BY PremiumTransactionID) = 1\n),\nEXP_DetectChange AS (\n\tSELECT\n\tLKP_CoverageDetailWorkersCompensation.PremiumTransactionID AS lkp_PremiumTransactionID,\n\tLKP_CoverageDetailWorkersCompensation.CoverageGuid AS lkp_CoverageGuid,\n\tLKP_CoverageDetailWorkersCompensation.AdmiraltyActFlag AS lkp_AdmiraltyActFlag,\n\tLKP_CoverageDetailWorkersCompensation.FederalEmployersLiabilityActFlag AS lkp_FederalEmployersLiabilityActFlag,\n\tLKP_CoverageDetailWorkersCompensation.USLongShoreAndHarborWorkersCompensationActFlag AS lkp_USLongShoreAndHarborWorkersCompensationActFlag,\n\tEXP_DefaultValue.o_PremiumTransactionID AS PremiumTransactionID,\n\tEXP_DefaultValue.o_CurrentSnapshotFlag AS CurrentSnapshotFlag,\n\tEXP_DefaultValue.o_AuditID AS AuditID,\n\tEXP_DefaultValue.o_EffectiveDate AS EffectiveDate,\n\tEXP_DefaultValue.o_ExpirationDate AS ExpirationDate,\n\tEXP_DefaultValue.o_SourceSystemID AS SourceSystemID,\n\tEXP_DefaultValue.o_CreatedDate AS CreatedDate,\n\tEXP_DefaultValue.o_ModifiedDate AS ModifiedDate,\n\tEXP_DefaultValue.o_CoverageGuid AS CoverageGuid,\n\t-- *INF*: IIF(lkp_AdmiraltyActFlag='T','1','0')\n\tIFF(lkp_AdmiraltyActFlag = 'T', '1', '0') AS v_AdmiraltyActFlag,\n\t-- *INF*: IIF(lkp_FederalEmployersLiabilityActFlag='T','1','0')\n\tIFF(lkp_FederalEmployersLiabilityActFlag = 'T', '1', '0') AS v_FederalEmployersLiabilityActFlag,\n\t-- *INF*: IIF(lkp_USLongShoreAndHarborWorkersCompensationActFlag='T','1','0')\n\tIFF(lkp_USLongShoreAndHarborWorkersCompensationActFlag = 'T', '1', '0') AS v_USLongShoreAndHarborWorkersCompensationActFlag,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- ISNULL(lkp_PremiumTransactionID), 'New', \r\n\t-- (lkp_CoverageGuid<>CoverageGuid\r\n\t--  OR v_AdmiraltyActFlag<>AdmiraltyActFlag\r\n\t--  OR v_FederalEmployersLiabilityActFlag<>FederalEmployersLiabilityActFlag\r\n\t--  OR v_USLongShoreAndHarborWorkersCompensationActFlag<>USLongshoreandHarborWorkersCompensationActFlag), 'Update',\r\n\t-- 'No Change'\r\n\t-- ) \r\n\t-- \n\tDECODE(TRUE,\n\tlkp_PremiumTransactionID IS NULL, 'New',\n\t( lkp_CoverageGuid <> CoverageGuid OR v_AdmiraltyActFlag <> AdmiraltyActFlag OR v_FederalEmployersLiabilityActFlag <> FederalEmployersLiabilityActFlag OR v_USLongShoreAndHarborWorkersCompensationActFlag <> USLongshoreandHarborWorkersCompensationActFlag ), 'Update',\n\t'No Change') AS v_ChangeFlag,\n\tv_ChangeFlag AS o_ChangeFlag,\n\t'0' AS o_ConsentToRateFlag,\n\t0 AS o_RateOverride,\n\tEXP_DefaultValue.o_AdmiraltyActFlag AS AdmiraltyActFlag,\n\tEXP_DefaultValue.o_FederalEmployersLiabilityActFlag AS FederalEmployersLiabilityActFlag,\n\tEXP_DefaultValue.o_USLongshoreandHarborWorkersCompensationActFlag AS USLongshoreandHarborWorkersCompensationActFlag,\n\t'N/A' AS TermType,\n\t-- *INF*: TO_DATE('01/01/1800','MM/DD/YYYY')\n\tTO_DATE('01/01/1800', 'MM/DD/YYYY') AS Term_Start_Date,\n\t-- *INF*: TO_DATE('12/31/2100','MM/DD/YYYY')\n\tTO_DATE('12/31/2100', 'MM/DD/YYYY') AS Term_End_Date,\n\t0 AS ARDIndicatorFlag,\n\t0 AS ExperienceRatedFlag,\n\t'00' AS DeductibleType,\n\t'00' AS DeductibleBasis\n\tFROM EXP_DefaultValue\n\tLEFT JOIN LKP_CoverageDetailWorkersCompensation\n\tON LKP_CoverageDetailWorkersCompensation.PremiumTransactionID = EXP_DefaultValue.o_PremiumTransactionID\n),\nRTR_InsertElseUpdate AS (\n\tSELECT\n\tlkp_PremiumTransactionID,\n\tPremiumTransactionID,\n\tCurrentSnapshotFlag,\n\tAuditID,\n\tEffectiveDate,\n\tExpirationDate,\n\tSourceSystemID,\n\tCreatedDate,\n\tModifiedDate,\n\tCoverageGuid,\n\to_ChangeFlag AS ChangeFlag,\n\to_ConsentToRateFlag AS ConsentToRateFlag,\n\to_RateOverride AS RateOverride,\n\tAdmiraltyActFlag,\n\tFederalEmployersLiabilityActFlag,\n\tUSLongshoreandHarborWorkersCompensationActFlag,\n\tTermType,\n\tTerm_Start_Date,\n\tTerm_End_Date,\n\tARDIndicatorFlag,\n\tExperienceRatedFlag,\n\tDeductibleType,\n\tDeductibleBasis\n\tFROM EXP_DetectChange\n),\nRTR_InsertElseUpdate_INSERT AS (SELECT * FROM RTR_InsertElseUpdate WHERE ChangeFlag='New'),\nRTR_InsertElseUpdate_UPDATE AS (SELECT * FROM RTR_InsertElseUpdate WHERE ChangeFlag='Update'),\nTGT_CoverageDetailWorkersCompensation_Insert AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailWorkersCompensation\n\t(PremiumTransactionID, CurrentSnapshotFlag, AuditID, EffectiveDate, ExpirationDate, SourceSystemID, CreatedDate, ModifiedDate, CoverageGuid, ConsentToRateFlag, RateOverride, AdmiraltyActFlag, FederalEmployersLiabilityActFlag, USLongShoreAndHarborWorkersCompensationActFlag, TermType, TermStartDate, TermEndDate, ARDIndicatorFlag, ExperienceRatedFlag, DeductibleType, DeductibleBasis)\n\tSELECT \n\tPREMIUMTRANSACTIONID, \n\tCURRENTSNAPSHOTFLAG, \n\tAUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tSOURCESYSTEMID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tCOVERAGEGUID, \n\tCONSENTTORATEFLAG, \n\tRATEOVERRIDE, \n\tADMIRALTYACTFLAG, \n\tFEDERALEMPLOYERSLIABILITYACTFLAG, \n\tUSLongshoreandHarborWorkersCompensationActFlag AS USLONGSHOREANDHARBORWORKERSCOMPENSATIONACTFLAG, \n\tTERMTYPE, \n\tTerm_Start_Date AS TERMSTARTDATE, \n\tTerm_End_Date AS TERMENDDATE, \n\tARDINDICATORFLAG, \n\tEXPERIENCERATEDFLAG, \n\tDEDUCTIBLETYPE, \n\tDEDUCTIBLEBASIS\n\tFROM RTR_InsertElseUpdate_INSERT\n),\nUPD_UpdateData AS (\n\tSELECT\n\tlkp_PremiumTransactionID AS PremiumTransactionID, \n\tCurrentSnapshotFlag, \n\tAuditID, \n\tEffectiveDate, \n\tExpirationDate, \n\tSourceSystemID, \n\tCreatedDate, \n\tModifiedDate, \n\tCoverageGuid, \n\tConsentToRateFlag, \n\tRateOverride, \n\tAdmiraltyActFlag AS AdmiraltyActFlag3, \n\tFederalEmployersLiabilityActFlag AS FederalEmployersLiabilityActFlag3, \n\tUSLongshoreandHarborWorkersCompensationActFlag AS USLongshoreandHarborWorkersCompensationActFlag3\n\tFROM RTR_InsertElseUpdate_UPDATE\n),\nTGT_CoverageDetailWorkersCompensation_Update AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailWorkersCompensation AS T\n\tUSING UPD_UpdateData AS S\n\tON T.PremiumTransactionID = S.PremiumTransactionID\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.CurrentSnapshotFlag = S.CurrentSnapshotFlag, T.EffectiveDate = S.EffectiveDate, T.ExpirationDate = S.ExpirationDate, T.SourceSystemID = S.SourceSystemID, T.ModifiedDate = S.ModifiedDate, T.CoverageGuid = S.CoverageGuid, T.ConsentToRateFlag = S.ConsentToRateFlag, T.RateOverride = S.RateOverride, T.AdmiraltyActFlag = S.AdmiraltyActFlag3, T.FederalEmployersLiabilityActFlag = S.FederalEmployersLiabilityActFlag3, T.USLongShoreAndHarborWorkersCompensationActFlag = S.USLongshoreandHarborWorkersCompensationActFlag3\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246483"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905516"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604204"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 01:21:59"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 01:54:57"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Stage_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "PMS"
            },
            "TARGET_TABLE_OWNER_V2": {
                "type": "string",
                "defaultValue": "V2"
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "WC_Stage"
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": ""
            }
        },
        "folder": {
            "name": "Policy DataWarehouse/"
        },
        "annotations": []
    }
}