{
    "name": "m_IR_DW_Load_SystemCoverage",
    "properties": {
        "activities": [
            {
                "name": "m_IR_DW_Load_SystemCoverage",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_CSV_ConformedCoverage AS (\n\n-- TODO Manual --\n\n),\nEXP_Trim_Values AS (\n\tSELECT\n\tCoverageSummaryCode AS i_CoverageSummaryCode,\n\tCoverageGroupCode AS i_CoverageGroupCode,\n\tCoverageCode AS i_CoverageCode,\n\tRatedCoverageCode AS i_RatedCoverageCode,\n\tRatedCoverageDescription AS i_RatedCoverageDescription,\n\tInsuranceLineCode AS i_InsuranceLineCode,\n\tInsuranceLineDescription AS i_InsuranceLineDescription,\n\tSourceSystemId AS i_SourceSystemId,\n\tDctRiskTypeCode AS i_DctRiskTypeCode,\n\tDctCoverageTypeCode AS i_DctCoverageTypeCode,\n\tDctSubCoverageTypeCode AS i_DctSubCoverageTypeCode,\n\tDctPerilGroup AS i_DctPerilGroup,\n\tDctCoverageVersion AS i_DctCoverageVersion,\n\tPmsRiskUnitGroupCode AS i_PmsRiskUnitGroupCode,\n\tPmsRiskUnitGroupDescription AS i_PmsRiskUnitGroupDescription,\n\tPmsRiskUnitCode AS i_PmsRiskUnitCode,\n\tPmsRiskUnitDescription AS i_PmsRiskUnitDescription,\n\tPmsMajorPerilCode AS i_PmsMajorPerilCode,\n\tPmsMajorPerilDescription AS i_PmsMajorPerilDescription,\n\tPmsProductTypeCode AS i_PmsProductTypeCode,\n\tLossHistoryCode AS i_LossHistoryCode,\n\tLossHistoryDescription AS i_LossHistoryDescription,\n\tISOMajorCrimeGroup AS i_ISOMajorCrimeGroup,\n\t-- *INF*: LTRIM(RTRIM(i_CoverageSummaryCode))\n\tLTRIM(RTRIM(i_CoverageSummaryCode)) AS o_CoverageSummaryCode,\n\t-- *INF*: LTRIM(RTRIM(i_CoverageGroupCode))\n\tLTRIM(RTRIM(i_CoverageGroupCode)) AS o_CoverageGroupCode,\n\t-- *INF*: LTRIM(RTRIM(i_CoverageCode))\n\tLTRIM(RTRIM(i_CoverageCode)) AS o_CoverageCode,\n\t-- *INF*: LTRIM(RTRIM(i_RatedCoverageCode))\n\tLTRIM(RTRIM(i_RatedCoverageCode)) AS o_RatedCoverageCode,\n\t-- *INF*: LTRIM(RTRIM(i_RatedCoverageDescription))\r\n\t-- \n\tLTRIM(RTRIM(i_RatedCoverageDescription)) AS o_RatedCoverageDescription,\n\t-- *INF*: LTRIM(RTRIM(i_InsuranceLineCode))\n\tLTRIM(RTRIM(i_InsuranceLineCode)) AS o_InsuranceLineCode,\n\t-- *INF*: LTRIM(RTRIM(i_InsuranceLineDescription))\n\tLTRIM(RTRIM(i_InsuranceLineDescription)) AS o_InsuranceLineDescription,\n\t-- *INF*: LTRIM(RTRIM(i_SourceSystemId))\n\tLTRIM(RTRIM(i_SourceSystemId)) AS o_SourceSystemId,\n\t-- *INF*: LTRIM(RTRIM(i_DctRiskTypeCode))\n\tLTRIM(RTRIM(i_DctRiskTypeCode)) AS o_DctRiskTypeCode,\n\t-- *INF*: LTRIM(RTRIM(i_DctCoverageTypeCode))\n\tLTRIM(RTRIM(i_DctCoverageTypeCode)) AS o_DctCoverageTypeCode,\n\t-- *INF*: LTRIM(RTRIM(i_PmsRiskUnitGroupCode))\n\tLTRIM(RTRIM(i_PmsRiskUnitGroupCode)) AS o_PmsRiskUnitGroupCode,\n\t-- *INF*: LTRIM(RTRIM(i_PmsRiskUnitGroupDescription))\n\tLTRIM(RTRIM(i_PmsRiskUnitGroupDescription)) AS o_PmsRiskUnitGroupDescription,\n\t-- *INF*: LTRIM(RTRIM(i_PmsRiskUnitCode))\n\tLTRIM(RTRIM(i_PmsRiskUnitCode)) AS o_PmsRiskUnitCode,\n\t-- *INF*: LTRIM(RTRIM(i_PmsRiskUnitDescription))\n\tLTRIM(RTRIM(i_PmsRiskUnitDescription)) AS o_PmsRiskUnitDescription,\n\t-- *INF*: LTRIM(RTRIM(i_PmsMajorPerilCode))\n\tLTRIM(RTRIM(i_PmsMajorPerilCode)) AS o_PmsMajorPerilCode,\n\t-- *INF*: LTRIM(RTRIM(i_PmsMajorPerilDescription))\n\tLTRIM(RTRIM(i_PmsMajorPerilDescription)) AS o_PmsMajorPerilDescription,\n\t-- *INF*: LTRIM(RTRIM(i_PmsProductTypeCode))\n\tLTRIM(RTRIM(i_PmsProductTypeCode)) AS o_PmsProductTypeCode,\n\t-- *INF*: LTRIM(RTRIM(i_DctPerilGroup))\n\tLTRIM(RTRIM(i_DctPerilGroup)) AS o_DctPerilGroup,\n\t-- *INF*: LTRIM(RTRIM(i_DctSubCoverageTypeCode))\n\tLTRIM(RTRIM(i_DctSubCoverageTypeCode)) AS o_DctSubCoverageTypeCode,\n\t-- *INF*: LTRIM(RTRIM(i_DctCoverageVersion))\n\tLTRIM(RTRIM(i_DctCoverageVersion)) AS o_DctCoverageVersion,\n\t-- *INF*: IIF(ISNULL(i_LossHistoryCode),'N/A',\r\n\t-- IIF(LENGTH(i_LossHistoryCode)>=2,\r\n\t-- LTRIM(RTRIM(i_LossHistoryCode)),\r\n\t-- LTRIM(RTRIM(LPAD(i_LossHistoryCode,2,'0')))\r\n\t-- )\r\n\t-- )\n\tIFF(i_LossHistoryCode IS NULL, 'N/A', IFF(LENGTH(i_LossHistoryCode) >= 2, LTRIM(RTRIM(i_LossHistoryCode)), LTRIM(RTRIM(LPAD(i_LossHistoryCode, 2, '0'))))) AS o_LossHistoryCode,\n\t-- *INF*: IIF(ISNULL(i_LossHistoryDescription),'N/A',LTRIM(RTRIM(i_LossHistoryDescription)))\n\tIFF(i_LossHistoryDescription IS NULL, 'N/A', LTRIM(RTRIM(i_LossHistoryDescription))) AS o_LossHistoryDescription,\n\t-- *INF*: IIF(ISNULL(i_ISOMajorCrimeGroup) OR IS_SPACES(i_ISOMajorCrimeGroup) OR LENGTH(i_ISOMajorCrimeGroup)=0,'N/A',LTRIM(RTRIM(i_ISOMajorCrimeGroup)))\n\tIFF(i_ISOMajorCrimeGroup IS NULL OR IS_SPACES(i_ISOMajorCrimeGroup) OR LENGTH(i_ISOMajorCrimeGroup) = 0, 'N/A', LTRIM(RTRIM(i_ISOMajorCrimeGroup))) AS o_ISOMajorCrimeGroup\n\tFROM SQ_CSV_ConformedCoverage\n),\nAGG_Remove_Duplicate AS (\n\tSELECT\n\to_CoverageSummaryCode AS CoverageSummaryCode, \n\to_CoverageGroupCode AS CoverageGroupCode, \n\to_CoverageCode AS CoverageCode, \n\to_RatedCoverageCode AS RatedCoverageCode, \n\to_RatedCoverageDescription AS RatedCoverageDescription, \n\to_InsuranceLineCode AS InsuranceLineCode, \n\to_InsuranceLineDescription AS InsuranceLineDescription, \n\to_SourceSystemId AS SourceSystemId, \n\to_DctRiskTypeCode AS DctRiskTypeCode, \n\to_DctCoverageTypeCode AS DctCoverageTypeCode, \n\to_PmsRiskUnitGroupCode AS PmsRiskUnitGroupCode, \n\to_PmsRiskUnitGroupDescription AS PmsRiskUnitGroupDescription, \n\to_PmsRiskUnitCode AS PmsRiskUnitCode, \n\to_PmsRiskUnitDescription AS PmsRiskUnitDescription, \n\to_PmsMajorPerilCode AS PmsMajorPerilCode, \n\to_PmsMajorPerilDescription AS PmsMajorPerilDescription, \n\to_PmsProductTypeCode AS PmsProductTypeCode, \n\to_DctPerilGroup AS DctPerilGroup, \n\to_DctSubCoverageTypeCode AS DctSubCoverageTypeCode, \n\to_DctCoverageVersion AS DctCoverageVersion, \n\to_LossHistoryCode AS LossHistoryCode, \n\to_LossHistoryDescription AS LossHistoryDescription, \n\to_ISOMajorCrimeGroup\n\tFROM EXP_Trim_Values\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY CoverageSummaryCode, CoverageGroupCode, InsuranceLineCode, DctRiskTypeCode, DctCoverageTypeCode, PmsRiskUnitGroupCode, PmsRiskUnitCode, PmsMajorPerilCode, PmsProductTypeCode, DctPerilGroup, DctSubCoverageTypeCode, DctCoverageVersion ORDER BY NULL) = 1\n),\nLKP_CoverageSummary AS (\n\tSELECT\n\tCoverageSummaryId,\n\tCoverageSummaryCode\n\tFROM (\n\t\tSELECT \n\t\t\tCoverageSummaryId,\n\t\t\tCoverageSummaryCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageSummary\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY CoverageSummaryCode ORDER BY CoverageSummaryId) = 1\n),\nLKP_CoverageGroup AS (\n\tSELECT\n\tCoverageGroupId,\n\tCoverageGroupCode,\n\tCoverageSummaryId\n\tFROM (\n\t\tSELECT \n\t\t\tCoverageGroupId,\n\t\t\tCoverageGroupCode,\n\t\t\tCoverageSummaryId\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageGroup\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY CoverageGroupCode,CoverageSummaryId ORDER BY CoverageGroupId) = 1\n),\nLKP_ConformedCoverage AS (\n\tSELECT\n\tConformedCoverageId,\n\ti_CoverageGroupId,\n\tCoverageCode,\n\tCoverageGroupId,\n\tRatedCoverageCode,\n\tRatedCoverageDescription\n\tFROM (\n\t\tSELECT \n\t\t\tConformedCoverageId,\n\t\t\ti_CoverageGroupId,\n\t\t\tCoverageCode,\n\t\t\tCoverageGroupId,\n\t\t\tRatedCoverageCode,\n\t\t\tRatedCoverageDescription\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.ConformedCoverage\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY CoverageCode,CoverageGroupId,RatedCoverageCode,RatedCoverageDescription ORDER BY ConformedCoverageId) = 1\n),\nLKP_SystemCoverage AS (\n\tSELECT\n\tSystemCoverageId,\n\tConformedCoverageId,\n\tInsuranceLineDescription,\n\tSourceSystemId,\n\tPmsRiskUnitGroupDescription,\n\tPmsRiskUnitDescription,\n\tPmsMajorPerilDescription,\n\tLossHistoryCode,\n\tLossHistoryDescription,\n\tISOMajorCrimeGroup,\n\tInsuranceLineCode,\n\tDctRiskTypeCode,\n\tDctCoverageTypeCode,\n\tPmsRiskUnitGroupCode,\n\tPmsRiskUnitCode,\n\tPmsMajorPerilCode,\n\tPmsProductTypeCode,\n\tDctPerilGroup,\n\tDctSubCoverageTypeCode,\n\tDctCoverageVersion\n\tFROM (\n\t\tSELECT SystemCoverage.SystemCoverageId AS SystemCoverageId\r\n\t\t\t,SystemCoverage.ConformedCoverageId AS ConformedCoverageId\r\n\t\t\t,SystemCoverage.InsuranceLineDescription AS InsuranceLineDescription\r\n\t\t\t,SystemCoverage.SourceSystemId AS SourceSystemId\r\n\t\t\t,SystemCoverage.PmsRiskUnitGroupDescription AS PmsRiskUnitGroupDescription\r\n\t\t\t,SystemCoverage.PmsRiskUnitDescription AS PmsRiskUnitDescription\r\n\t\t\t,SystemCoverage.PmsMajorPerilDescription AS PmsMajorPerilDescription\r\n\t\t\t,SystemCoverage.InsuranceLineCode AS InsuranceLineCode\r\n\t\t\t,SystemCoverage.DctRiskTypeCode AS DctRiskTypeCode\r\n\t\t\t,SystemCoverage.DctCoverageTypeCode AS DctCoverageTypeCode\r\n\t\t\t,SystemCoverage.PmsRiskUnitGroupCode AS PmsRiskUnitGroupCode\r\n\t\t\t,SystemCoverage.PmsRiskUnitCode AS PmsRiskUnitCode\r\n\t\t\t,SystemCoverage.PmsMajorPerilCode AS PmsMajorPerilCode\r\n\t\t\t,LTRIM(RTRIM(SystemCoverage.PmsProductTypeCode)) AS PmsProductTypeCode\r\n\t\t\t,SystemCoverage.DctPerilGroup AS DctPerilGroup\r\n\t\t\t,SystemCoverage.DctSubCoverageTypeCode AS DctSubCoverageTypeCode\r\n\t\t\t,SystemCoverage.DctCoverageVersion AS DctCoverageVersion\r\n\t\t\t,LTRIM(RTRIM(SystemCoverage.LossHistoryCode)) As LossHistoryCode\r\n\t\t\t,LTRIM(RTRIM(SystemCoverage.LossHistoryDescription)) AS LossHistoryDescription \r\n\t\t\t,LTRIM(RTRIM(SystemCoverage.ISOMajorCrimeGroup)) AS ISOMajorCrimeGroup\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.SystemCoverage\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY InsuranceLineCode,DctRiskTypeCode,DctCoverageTypeCode,PmsRiskUnitGroupCode,PmsRiskUnitCode,PmsMajorPerilCode,PmsProductTypeCode,DctPerilGroup,DctSubCoverageTypeCode,DctCoverageVersion ORDER BY SystemCoverageId) = 1\n),\nEXP_Detect_Changes AS (\n\tSELECT\n\tLKP_SystemCoverage.SystemCoverageId AS lkp_SystemCoverageId,\n\tLKP_SystemCoverage.ConformedCoverageId AS lkp_ConformedCoverageId,\n\tLKP_SystemCoverage.InsuranceLineDescription AS lkp_InsuranceLineDescription,\n\tLKP_SystemCoverage.SourceSystemId AS lkp_SourceSystemId,\n\tLKP_SystemCoverage.PmsRiskUnitGroupDescription AS lkp_PmsRiskUnitGroupDescription,\n\tLKP_SystemCoverage.PmsRiskUnitDescription AS lkp_PmsRiskUnitDescription,\n\tLKP_SystemCoverage.PmsMajorPerilDescription AS lkp_PmsMajorPerilDescription,\n\tLKP_SystemCoverage.LossHistoryCode AS lkp_LossHistoryCode,\n\tLKP_SystemCoverage.LossHistoryDescription AS lkp_LossHistoryDescription,\n\tLKP_SystemCoverage.ISOMajorCrimeGroup AS lkp_ISOMajorCrimeGroup,\n\tLKP_ConformedCoverage.ConformedCoverageId,\n\tAGG_Remove_Duplicate.InsuranceLineCode,\n\tAGG_Remove_Duplicate.InsuranceLineDescription,\n\tAGG_Remove_Duplicate.SourceSystemId,\n\tAGG_Remove_Duplicate.DctRiskTypeCode,\n\tAGG_Remove_Duplicate.DctCoverageTypeCode,\n\tAGG_Remove_Duplicate.PmsRiskUnitGroupCode,\n\tAGG_Remove_Duplicate.PmsRiskUnitGroupDescription,\n\tAGG_Remove_Duplicate.PmsRiskUnitCode,\n\tAGG_Remove_Duplicate.PmsRiskUnitDescription,\n\tAGG_Remove_Duplicate.PmsMajorPerilCode,\n\tAGG_Remove_Duplicate.PmsMajorPerilDescription,\n\tAGG_Remove_Duplicate.PmsProductTypeCode,\n\tAGG_Remove_Duplicate.DctPerilGroup,\n\tAGG_Remove_Duplicate.DctSubCoverageTypeCode,\n\tAGG_Remove_Duplicate.DctCoverageVersion,\n\tAGG_Remove_Duplicate.LossHistoryCode,\n\tAGG_Remove_Duplicate.LossHistoryDescription,\n\tAGG_Remove_Duplicate.o_ISOMajorCrimeGroup AS ISOMajorCrimeGroup,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\t-- *INF*: DECODE(TRUE,ISNULL(lkp_SystemCoverageId),1,\r\n\t-- lkp_ConformedCoverageId<>ConformedCoverageId OR\r\n\t-- lkp_InsuranceLineDescription<>InsuranceLineDescription OR\r\n\t-- lkp_SourceSystemId<>SourceSystemId OR\r\n\t-- lkp_PmsRiskUnitGroupDescription<>PmsRiskUnitGroupDescription OR\r\n\t-- lkp_PmsRiskUnitDescription<>PmsRiskUnitDescription OR\r\n\t-- lkp_PmsMajorPerilDescription<>PmsMajorPerilDescription OR lkp_LossHistoryCode<>LossHistoryCode OR lkp_LossHistoryDescription<>LossHistoryDescription OR \r\n\t-- lkp_ISOMajorCrimeGroup<>ISOMajorCrimeGroup,2,0)\n\tDECODE(TRUE,\n\tlkp_SystemCoverageId IS NULL, 1,\n\tlkp_ConformedCoverageId <> ConformedCoverageId OR lkp_InsuranceLineDescription <> InsuranceLineDescription OR lkp_SourceSystemId <> SourceSystemId OR lkp_PmsRiskUnitGroupDescription <> PmsRiskUnitGroupDescription OR lkp_PmsRiskUnitDescription <> PmsRiskUnitDescription OR lkp_PmsMajorPerilDescription <> PmsMajorPerilDescription OR lkp_LossHistoryCode <> LossHistoryCode OR lkp_LossHistoryDescription <> LossHistoryDescription OR lkp_ISOMajorCrimeGroup <> ISOMajorCrimeGroup, 2,\n\t0) AS o_change_flag\n\tFROM AGG_Remove_Duplicate\n\tLEFT JOIN LKP_ConformedCoverage\n\tON LKP_ConformedCoverage.CoverageCode = AGG_Remove_Duplicate.CoverageCode AND LKP_ConformedCoverage.CoverageGroupId = LKP_CoverageGroup.CoverageGroupId AND LKP_ConformedCoverage.RatedCoverageCode = AGG_Remove_Duplicate.RatedCoverageCode AND LKP_ConformedCoverage.RatedCoverageDescription = AGG_Remove_Duplicate.RatedCoverageDescription\n\tLEFT JOIN LKP_SystemCoverage\n\tON LKP_SystemCoverage.InsuranceLineCode = AGG_Remove_Duplicate.InsuranceLineCode AND LKP_SystemCoverage.DctRiskTypeCode = AGG_Remove_Duplicate.DctRiskTypeCode AND LKP_SystemCoverage.DctCoverageTypeCode = AGG_Remove_Duplicate.DctCoverageTypeCode AND LKP_SystemCoverage.PmsRiskUnitGroupCode = AGG_Remove_Duplicate.PmsRiskUnitGroupCode AND LKP_SystemCoverage.PmsRiskUnitCode = AGG_Remove_Duplicate.PmsRiskUnitCode AND LKP_SystemCoverage.PmsMajorPerilCode = AGG_Remove_Duplicate.PmsMajorPerilCode AND LKP_SystemCoverage.PmsProductTypeCode = AGG_Remove_Duplicate.PmsProductTypeCode AND LKP_SystemCoverage.DctPerilGroup = AGG_Remove_Duplicate.DctPerilGroup AND LKP_SystemCoverage.DctSubCoverageTypeCode = AGG_Remove_Duplicate.DctSubCoverageTypeCode AND LKP_SystemCoverage.DctCoverageVersion = AGG_Remove_Duplicate.DctCoverageVersion\n),\nRTR_INSERT_UPDATE AS (\n\tSELECT\n\tlkp_SystemCoverageId AS SystemCoverageId,\n\tConformedCoverageId,\n\tInsuranceLineCode,\n\tInsuranceLineDescription,\n\tSourceSystemId,\n\tDctRiskTypeCode,\n\tDctCoverageTypeCode,\n\tPmsRiskUnitGroupCode,\n\tPmsRiskUnitGroupDescription,\n\tPmsRiskUnitCode,\n\tPmsRiskUnitDescription,\n\tPmsMajorPerilCode,\n\tPmsMajorPerilDescription,\n\tPmsProductTypeCode,\n\tDctPerilGroup,\n\to_CreatedDate AS CreatedDate,\n\to_ModifiedDate AS ModifiedDate,\n\to_change_flag AS change_flag,\n\tDctSubCoverageTypeCode,\n\tDctCoverageVersion,\n\tLossHistoryCode,\n\tLossHistoryDescription,\n\tISOMajorCrimeGroup AS i_ISOMajorCrimeGroup\n\tFROM EXP_Detect_Changes\n),\nRTR_INSERT_UPDATE_INSERT AS (SELECT * FROM RTR_INSERT_UPDATE WHERE change_flag=1 AND  NOT ISNULL(ConformedCoverageId) AND  NOT (ISNULL(InsuranceLineCode) OR IS_SPACES(InsuranceLineCode) OR LENGTH(InsuranceLineCode)=0)\r\nAND  NOT (ISNULL(DctRiskTypeCode) OR IS_SPACES(DctRiskTypeCode) OR LENGTH(DctRiskTypeCode)=0)\r\nAND  NOT (ISNULL(DctCoverageTypeCode) OR IS_SPACES(DctCoverageTypeCode) OR LENGTH(DctCoverageTypeCode)=0) \r\nAND  NOT (ISNULL(PmsRiskUnitGroupCode) OR IS_SPACES(PmsRiskUnitGroupCode) OR LENGTH(PmsRiskUnitGroupCode)=0)\r\nAND  NOT (ISNULL(PmsRiskUnitCode) OR IS_SPACES(PmsRiskUnitCode) OR LENGTH(PmsRiskUnitCode)=0)\r\nAND  NOT (ISNULL(PmsMajorPerilCode) OR IS_SPACES(PmsMajorPerilCode) OR LENGTH(PmsMajorPerilCode)=0)\r\nAND  NOT (ISNULL(PmsProductTypeCode) OR IS_SPACES(PmsProductTypeCode) OR LENGTH(PmsProductTypeCode)=0)\r\nAND  NOT (ISNULL(DctPerilGroup) OR IS_SPACES(DctPerilGroup) OR LENGTH(DctPerilGroup)=0)\r\nAND  NOT (ISNULL(DctSubCoverageTypeCode) OR IS_SPACES(DctSubCoverageTypeCode) OR LENGTH(DctSubCoverageTypeCode)=0)\r\nAND  NOT (ISNULL(DctCoverageVersion) OR IS_SPACES(DctCoverageVersion) OR LENGTH(DctCoverageVersion)=0)),\nRTR_INSERT_UPDATE_UPDATE AS (SELECT * FROM RTR_INSERT_UPDATE WHERE change_flag=2 AND  NOT ISNULL(ConformedCoverageId) AND  NOT (ISNULL(InsuranceLineCode) OR IS_SPACES(InsuranceLineCode) OR LENGTH(InsuranceLineCode)=0)\r\nAND  NOT (ISNULL(DctRiskTypeCode) OR IS_SPACES(DctRiskTypeCode) OR LENGTH(DctRiskTypeCode)=0)\r\nAND  NOT (ISNULL(DctCoverageTypeCode) OR IS_SPACES(DctCoverageTypeCode) OR LENGTH(DctCoverageTypeCode)=0) \r\nAND  NOT (ISNULL(PmsRiskUnitGroupCode) OR IS_SPACES(PmsRiskUnitGroupCode) OR LENGTH(PmsRiskUnitGroupCode)=0)\r\nAND  NOT (ISNULL(PmsRiskUnitCode) OR IS_SPACES(PmsRiskUnitCode) OR LENGTH(PmsRiskUnitCode)=0)\r\nAND  NOT (ISNULL(PmsMajorPerilCode) OR IS_SPACES(PmsMajorPerilCode) OR LENGTH(PmsMajorPerilCode)=0)\r\nAND  NOT (ISNULL(PmsProductTypeCode) OR IS_SPACES(PmsProductTypeCode) OR LENGTH(PmsProductTypeCode)=0)\r\nAND  NOT (ISNULL(DctPerilGroup) OR IS_SPACES(DctPerilGroup) OR LENGTH(DctPerilGroup)=0)\r\nAND  NOT (ISNULL(DctSubCoverageTypeCode) OR IS_SPACES(DctSubCoverageTypeCode) OR LENGTH(DctSubCoverageTypeCode)=0)\r\nAND  NOT (ISNULL(DctCoverageVersion) OR IS_SPACES(DctCoverageVersion) OR LENGTH(DctCoverageVersion)=0)),\nUPD_SystemCoverage_INSERT AS (\n\tSELECT\n\tCreatedDate, \n\tModifiedDate, \n\tConformedCoverageId, \n\tInsuranceLineCode, \n\tInsuranceLineDescription, \n\tSourceSystemId, \n\tDctRiskTypeCode, \n\tDctCoverageTypeCode, \n\tPmsRiskUnitGroupCode, \n\tPmsRiskUnitGroupDescription, \n\tPmsRiskUnitCode, \n\tPmsRiskUnitDescription, \n\tPmsMajorPerilCode, \n\tPmsMajorPerilDescription, \n\tPmsProductTypeCode, \n\tDctPerilGroup, \n\tDctSubCoverageTypeCode, \n\tDctCoverageVersion, \n\tLossHistoryCode, \n\tLossHistoryDescription, \n\ti_ISOMajorCrimeGroup AS i_ISOMajorCrimeGroup1\n\tFROM RTR_INSERT_UPDATE_INSERT\n),\nSystemCoverage_INSERT AS (\n\tSET QUOTED_IDENTIFIER ON\r\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.SystemCoverage(CreatedDate,ModifiedDate,ConformedCoverageId,InsuranceLineCode,InsuranceLineDescription,SourceSystemId,DctRiskTypeCode,DctCoverageTypeCode,PmsRiskUnitGroupCode,PmsRiskUnitGroupDescription,PmsRiskUnitCode,PmsRiskUnitDescription,PmsMajorPerilCode,PmsMajorPerilDescription,PmsProductTypeCode,DctPerilGroup,DctSubCoverageTypeCode,DctCoverageVersion,LossHistoryCode,LossHistoryDescription,ISOMajorCrimeGroup\r\n\t) \n\tSELECT S.CreatedDate,S.ModifiedDate,S.ConformedCoverageId,S.InsuranceLineCode,S.InsuranceLineDescription,S.SourceSystemId,S.DctRiskTypeCode,S.DctCoverageTypeCode,S.PmsRiskUnitGroupCode,S.PmsRiskUnitGroupDescription,S.PmsRiskUnitCode,S.PmsRiskUnitDescription,S.PmsMajorPerilCode,S.PmsMajorPerilDescription, S.PmsProductTypeCode,S.DctPerilGroup,S.DctSubCoverageTypeCode,S.DctCoverageVersion,S.LossHistoryCode, S.LossHistoryDescription, S.ISOMajorCrimeGroup\n\tFROM UPD_SystemCoverage_INSERT S\n),\nUPD_SystemCoverage AS (\n\tSELECT\n\tSystemCoverageId, \n\tConformedCoverageId, \n\tInsuranceLineDescription, \n\tSourceSystemId, \n\tPmsRiskUnitGroupDescription, \n\tPmsRiskUnitDescription, \n\tPmsMajorPerilDescription, \n\tModifiedDate, \n\tLossHistoryCode, \n\tLossHistoryDescription, \n\ti_ISOMajorCrimeGroup AS i_ISOMajorCrimeGroup3\n\tFROM RTR_INSERT_UPDATE_UPDATE\n),\nSystemCoverage_UPDATE AS (\n\tSET QUOTED_IDENTIFIER ON\r\n\tUPDATE @{pipeline().parameters.TARGET_TABLE_OWNER}.SystemCoverage SET ModifiedDate = S.ModifiedDate, ConformedCoverageId = S.ConformedCoverageId, InsuranceLineDescription = S.InsuranceLineDescription, SourceSystemId = S.SourceSystemId, PmsRiskUnitGroupDescription = S.PmsRiskUnitGroupDescription, PmsRiskUnitDescription = S.PmsRiskUnitDescription, PmsMajorPerilDescription = S.PmsMajorPerilDescription,LossHistoryCode = S.LossHistoryCode, LossHistoryDescription = S.LossHistoryDescription, ISOMajorCrimeGroup= S.ISOMajorCrimeGroup WHERE SystemCoverageId = S.SystemCoverageId\n\tFROM UPD_SystemCoverage S\n),"
                        }
                    ]
                }
            }
        ],
        "parameters": {
            "INPUTFILECONFORMEDCOVERAGE": {
                "type": "string",
                "defaultValue": "$PMSourceFileDir\\FlatFiles\\SRC_ConformedCoverage.csv"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_InsuranceReference_Policy"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            }
        },
        "folder": {
            "name": ""
        },
        "annotations": []
    }
}