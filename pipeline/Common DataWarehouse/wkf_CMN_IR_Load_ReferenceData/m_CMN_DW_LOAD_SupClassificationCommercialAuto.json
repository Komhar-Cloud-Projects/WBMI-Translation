{
    "name": "m_CMN_DW_LOAD_SupClassificationCommercialAuto",
    "properties": {
        "activities": [
            {
                "name": "m_CMN_DW_LOAD_SupClassificationCommercialAuto",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_SupClassificationCommercialAuto_CurrentChangeFlag AS (\n\tSELECT\n\tSupClassificationCommercialAutoID,\n\tRatingStateCode,\n\tClassCode,\n\tEffectiveDate,\n\tClassDescription,\n\tOriginatingOrganizationCode,\n\tVehicleTypeSize,\n\tBusinessUseClass,\n\tSecondaryClass,\n\tRadiusofOperation,\n\tFleetType,\n\tSecondaryClassGroup\n\tFROM (\n\t\tSELECT \n\t\t\tSupClassificationCommercialAutoID,\n\t\t\tRatingStateCode,\n\t\t\tClassCode,\n\t\t\tEffectiveDate,\n\t\t\tClassDescription,\n\t\t\tOriginatingOrganizationCode,\n\t\t\tVehicleTypeSize,\n\t\t\tBusinessUseClass,\n\t\t\tSecondaryClass,\n\t\t\tRadiusofOperation,\n\t\t\tFleetType,\n\t\t\tSecondaryClassGroup\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupClassificationCommercialAuto\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY RatingStateCode,ClassCode,EffectiveDate,ClassDescription,OriginatingOrganizationCode,VehicleTypeSize,BusinessUseClass,SecondaryClass,RadiusofOperation,FleetType,SecondaryClassGroup ORDER BY SupClassificationCommercialAutoID) = 1\n),\nSQ_SupClassificationCommercialAuto AS (\n\tSELECT\n\t\tSupClassificationCommercialAutoId AS SupClassificationCommercialAutoID,\n\t\tAuditId,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tLineOfBusinessAbbreviation,\n\t\tRatingStateCode,\n\t\tEffectiveDate,\n\t\tExpirationDate,\n\t\tClassCode,\n\t\tClassDescription,\n\t\tOriginatingOrganizationCode AS ClassCodeOriginatingOrganization,\n\t\tVehicleTypeSize,\n\t\tBusinessUseClass,\n\t\tSecondaryClass,\n\t\tRadiusofOperation,\n\t\tFleetType,\n\t\tSecondaryClassGroup\n\tFROM SupClassificationCommercialAuto\n\tINNER JOIN SupClassificationCommercialAuto\n),\nLKP_SupClassificationCommercialAuto AS (\n\tSELECT\n\tSupClassificationCommercialAutoID,\n\tRatingStateCode,\n\tClassCode,\n\tEffectiveDate,\n\tExpirationDate,\n\tClassDescription,\n\tOriginatingOrganizationCode,\n\tVehicleTypeSize,\n\tBusinessUseClass,\n\tSecondaryClass,\n\tRadiusofOperation,\n\tFleetType,\n\tSecondaryClassGroup\n\tFROM (\n\t\tSELECT \n\t\t\tSupClassificationCommercialAutoID,\n\t\t\tRatingStateCode,\n\t\t\tClassCode,\n\t\t\tEffectiveDate,\n\t\t\tExpirationDate,\n\t\t\tClassDescription,\n\t\t\tOriginatingOrganizationCode,\n\t\t\tVehicleTypeSize,\n\t\t\tBusinessUseClass,\n\t\t\tSecondaryClass,\n\t\t\tRadiusofOperation,\n\t\t\tFleetType,\n\t\t\tSecondaryClassGroup\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupClassificationCommercialAuto\n\t\tWHERE CurrentSnapshotFlag =1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY RatingStateCode,ClassCode,OriginatingOrganizationCode ORDER BY SupClassificationCommercialAutoID) = 1\n),\nEXP_Detect_Changes AS (\n\tSELECT\n\tSQ_SupClassificationCommercialAuto.LineOfBusinessAbbreviation AS i_LineOfBusinessAbbreviation,\n\tSQ_SupClassificationCommercialAuto.RatingStateCode AS i_RatingStateCode,\n\tSQ_SupClassificationCommercialAuto.EffectiveDate AS i_EffectiveDate,\n\tSQ_SupClassificationCommercialAuto.ExpirationDate AS i_ExpirationDate,\n\tSQ_SupClassificationCommercialAuto.ClassCode AS i_ClassCode,\n\tSQ_SupClassificationCommercialAuto.ClassDescription AS i_ClassDescription,\n\tSQ_SupClassificationCommercialAuto.ClassCodeOriginatingOrganization AS i_ClassCodeOriginatingOrganization,\n\tSQ_SupClassificationCommercialAuto.VehicleTypeSize AS i_CommercialAutoVehicleTypeSize,\n\tSQ_SupClassificationCommercialAuto.BusinessUseClass AS i_CommercialAutoBusinessUseClass,\n\tSQ_SupClassificationCommercialAuto.SecondaryClass AS i_SecondaryClass,\n\tSQ_SupClassificationCommercialAuto.RadiusofOperation AS i_RadiusofOperation,\n\tSQ_SupClassificationCommercialAuto.FleetType AS i_FleetType,\n\tSQ_SupClassificationCommercialAuto.SecondaryClassGroup AS i_SecondaryClassGroup,\n\tLKP_SupClassificationCommercialAuto.SupClassificationCommercialAutoID AS lkp_SupClassificationCommercialAutoID,\n\tLKP_SupClassificationCommercialAuto.RatingStateCode AS lkp_RatingStateCode,\n\tLKP_SupClassificationCommercialAuto.ClassCode AS lkp_ClassCode,\n\tLKP_SupClassificationCommercialAuto.EffectiveDate AS lkp_EffectiveDate,\n\tLKP_SupClassificationCommercialAuto.ExpirationDate AS lkp_ExpirationDate,\n\tLKP_SupClassificationCommercialAuto.ClassDescription AS lkp_ClassDescription,\n\tLKP_SupClassificationCommercialAuto.OriginatingOrganizationCode AS lkp_ClassCodeOriginatingOrganization,\n\tLKP_SupClassificationCommercialAuto.VehicleTypeSize AS lkp_CommercialAutoVehicleTypeSize,\n\tLKP_SupClassificationCommercialAuto.BusinessUseClass AS lkp_CommercialAutoBusinessUseClass,\n\tLKP_SupClassificationCommercialAuto.SecondaryClass AS lkp_SecondaryClass,\n\tLKP_SupClassificationCommercialAuto.RadiusofOperation AS lkp_RadiusofOperation,\n\tLKP_SupClassificationCommercialAuto.FleetType AS lkp_FleetType,\n\tLKP_SupClassificationCommercialAuto.SecondaryClassGroup AS lkp_SecondaryClassGroup,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- NOT ISNULL(:LKP.LKP_SupClassificationCommercialAuto_CurrentChangeFlag(i_RatingStateCode,i_ClassCode,i_EffectiveDate,i_ClassDescription,i_ClassCodeOriginatingOrganization,i_CommercialAutoVehicleTypeSize,i_CommercialAutoBusinessUseClass,i_SecondaryClass,i_RadiusofOperation,i_FleetType,i_SecondaryClassGroup)),\r\n\t-- 'NOCHANGE',\r\n\t-- 'INSERT')\t\t\t\t\t\t\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t--  \n\tDECODE(TRUE,\n\tNOT LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup.SupClassificationCommercialAutoID IS NULL, 'NOCHANGE',\n\t'INSERT') AS v_RecordPopulated,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- --i_ExpirationDate   <=  lkp_EffectiveDate OR 1=0 , 'NOCHANGE',\r\n\t-- i_ExpirationDate   <=  lkp_EffectiveDate OR v_RecordPopulated = 'NOCHANGE', 'NOCHANGE',\r\n\t-- ISNULL(lkp_SupClassificationCommercialAutoID) OR ( i_RatingStateCode = lkp_RatingStateCode\r\n\t-- \t\t\t\t\t\t\t\tAND   i_ClassCode = lkp_ClassCode\r\n\t--                                                    AND   i_ClassCodeOriginatingOrganization = lkp_ClassCodeOriginatingOrganization  \r\n\t-- \t\t\t \t\t\t\t\tAND   (i_ClassDescription <>lkp_ClassDescription \r\n\t-- \t\t\t\t\t\t\t\t  OR i_EffectiveDate <> lkp_EffectiveDate\r\n\t-- \t\t\t\t\t\t\t\t  OR i_ExpirationDate <> lkp_ExpirationDate\r\n\t-- \t\t\t\t\t\t\t\t  OR  i_CommercialAutoVehicleTypeSize <> lkp_CommercialAutoVehicleTypeSize  \r\n\t-- \t\t\t\t\t\t\t\t  OR  i_CommercialAutoBusinessUseClass <> lkp_CommercialAutoBusinessUseClass  \r\n\t-- \t\t\t\t\t\t\t\t  OR  i_SecondaryClass <> lkp_SecondaryClass   \r\n\t-- \t\t\t\t\t\t\t\t  OR  i_RadiusofOperation <> lkp_RadiusofOperation   \r\n\t-- \t\t\t\t\t\t\t\t  OR  i_FleetType <> lkp_FleetType   \r\n\t-- \t\t\t\t\t\t\t\t  OR  i_SecondaryClassGroup <> lkp_SecondaryClassGroup \r\n\t-- \t\t\t\t\t\t\t\t  )\r\n\t-- \t\t\t\t\t\t\t\t),'INSERT',\r\n\t-- i_RatingStateCode<>lkp_RatingStateCode OR\r\n\t-- i_ClassCode<>lkp_ClassCode  OR\r\n\t-- i_ClassCodeOriginatingOrganization <> lkp_ClassCodeOriginatingOrganization  ,\r\n\t-- 'UPDATE',\r\n\t-- 'NOCHANGE'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_ExpirationDate <= lkp_EffectiveDate OR v_RecordPopulated = 'NOCHANGE', 'NOCHANGE',\n\tlkp_SupClassificationCommercialAutoID IS NULL OR ( i_RatingStateCode = lkp_RatingStateCode AND i_ClassCode = lkp_ClassCode AND i_ClassCodeOriginatingOrganization = lkp_ClassCodeOriginatingOrganization AND ( i_ClassDescription <> lkp_ClassDescription OR i_EffectiveDate <> lkp_EffectiveDate OR i_ExpirationDate <> lkp_ExpirationDate OR i_CommercialAutoVehicleTypeSize <> lkp_CommercialAutoVehicleTypeSize OR i_CommercialAutoBusinessUseClass <> lkp_CommercialAutoBusinessUseClass OR i_SecondaryClass <> lkp_SecondaryClass OR i_RadiusofOperation <> lkp_RadiusofOperation OR i_FleetType <> lkp_FleetType OR i_SecondaryClassGroup <> lkp_SecondaryClassGroup ) ), 'INSERT',\n\ti_RatingStateCode <> lkp_RatingStateCode OR i_ClassCode <> lkp_ClassCode OR i_ClassCodeOriginatingOrganization <> lkp_ClassCodeOriginatingOrganization, 'UPDATE',\n\t'NOCHANGE') AS v_ChangeFlag,\n\t'Please correct the EffectiveDate in CSV file for ClassCode = '||i_ClassCode||' and RatingStateCode = '|| i_RatingStateCode ||', because EffectiveDate should reflect the real effective date for any change on this ClassCode.' AS v_ErrorMessage,\n\t-- *INF*: 'PASS'\r\n\t-- --DECODE(TRUE, \r\n\t-- --i_RatingStateCode = lkp_RatingStateCode\r\n\t-- --AND i_ClassCode = lkp_ClassCode\r\n\t-- --AND i_EffectiveDate  = lkp_EffectiveDate\r\n\t-- --AND \r\n\t-- --(i_ClassDescription <>lkp_ClassDescription\r\n\t-- --OR i_ClassCodeOriginatingOrganization <> lkp_ClassCodeOriginatingOrganization\r\n\t-- --OR i_CommercialAutoVehicleTypeSize <> lkp_CommercialAutoVehicleTypeSize\r\n\t-- --OR i_CommercialAutoBusinessUseClass <> lkp_CommercialAutoBusinessUseClass\r\n\t-- --OR i_SecondaryClass <> lkp_SecondaryClass\r\n\t-- --OR i_RadiusofOperation <> lkp_RadiusofOperation\r\n\t-- --OR i_FleetType <> lkp_FleetType\r\n\t-- --OR i_SecondaryClassGroup <> lkp_SecondaryClassGroup\r\n\t-- --), \r\n\t-- --ERROR(v_ErrorMessage)\r\n\t-- --,'PASS\n\t'PASS' AS v_RaiseError,\n\tv_ChangeFlag AS o_ChangeFlag,\n\t1 AS o_CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditId,\n\t-- *INF*: @{pipeline().parameters.SOURCE_SYSTEM_ID}\r\n\t-- --'N/A'\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemID,\n\tsysdate AS o_CreatedDate,\n\tsysdate AS o_ModifiedDate,\n\ti_LineOfBusinessAbbreviation AS o_LineOfBusinessAbbreviation,\n\ti_RatingStateCode AS o_RatingStateCode,\n\t-- *INF*: i_EffectiveDate\r\n\t-- --IIF(v_ChangeFlag='INSERT',\r\n\t-- \t--TO_DATE('01/01/1800 00:00:00','MM/DD/YYYY HH24:MI:SS'),\r\n\t-- \t--TO_DATE(TO_CHAR(SYSDATE,'MM/DD/YYYY HH24:MI:SS'),'MM/DD/YYYY HH24:MI:SS'))\n\ti_EffectiveDate AS o_ClassEffectiveDate,\n\t-- *INF*: i_ExpirationDate\r\n\t-- --TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\ti_ExpirationDate AS o_ClassExpirationDate,\n\ti_ClassCode AS o_ClassCode,\n\ti_ClassDescription AS o_ClassDescription,\n\ti_ClassCodeOriginatingOrganization AS o_ClassCodeOriginatingOrganization,\n\ti_CommercialAutoVehicleTypeSize AS o_CommercialAutoVehicleTypeSize,\n\ti_CommercialAutoBusinessUseClass AS o_CommercialAutoBusinessUseClass,\n\ti_SecondaryClass AS o_SecondaryClass,\n\ti_RadiusofOperation AS o_RadiusofOperation,\n\ti_FleetType AS o_FleetType,\n\ti_SecondaryClassGroup AS o_SecondaryClassGroup\n\tFROM SQ_SupClassificationCommercialAuto\n\tLEFT JOIN LKP_SupClassificationCommercialAuto\n\tON LKP_SupClassificationCommercialAuto.RatingStateCode = SQ_SupClassificationCommercialAuto.RatingStateCode AND LKP_SupClassificationCommercialAuto.ClassCode = SQ_SupClassificationCommercialAuto.ClassCode AND LKP_SupClassificationCommercialAuto.OriginatingOrganizationCode = SQ_SupClassificationCommercialAuto.ClassCodeOriginatingOrganization\n\tLEFT JOIN LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup\n\tON LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup.RatingStateCode = i_RatingStateCode\n\tAND LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup.ClassCode = i_ClassCode\n\tAND LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup.EffectiveDate = i_EffectiveDate\n\tAND LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup.ClassDescription = i_ClassDescription\n\tAND LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup.OriginatingOrganizationCode = i_ClassCodeOriginatingOrganization\n\tAND LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup.VehicleTypeSize = i_CommercialAutoVehicleTypeSize\n\tAND LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup.BusinessUseClass = i_CommercialAutoBusinessUseClass\n\tAND LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup.SecondaryClass = i_SecondaryClass\n\tAND LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup.RadiusofOperation = i_RadiusofOperation\n\tAND LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup.FleetType = i_FleetType\n\tAND LKP_SUPCLASSIFICATIONCOMMERCIALAUTO_CURRENTCHANGEFLAG_i_RatingStateCode_i_ClassCode_i_EffectiveDate_i_ClassDescription_i_ClassCodeOriginatingOrganization_i_CommercialAutoVehicleTypeSize_i_CommercialAutoBusinessUseClass_i_SecondaryClass_i_RadiusofOperation_i_FleetType_i_SecondaryClassGroup.SecondaryClassGroup = i_SecondaryClassGroup\n\n),\nRTR_Insert_Update AS (\n\tSELECT\n\to_ChangeFlag AS ChangeFlag,\n\to_CurrentSnapshotFlag AS CurrentSnapshotFlag,\n\to_AuditId AS AuditId,\n\to_SourceSystemID AS SourceSystemID,\n\to_CreatedDate AS CreatedDate,\n\to_ModifiedDate AS ModifiedDate,\n\to_LineOfBusinessAbbreviation AS LineOfBusinessAbbreviation,\n\to_RatingStateCode AS RatingStateCode,\n\to_ClassEffectiveDate AS ClassEffectiveDate,\n\to_ClassExpirationDate AS ClassExpirationDate,\n\to_ClassCode AS ClassCode,\n\to_ClassDescription AS ClassDescription,\n\to_ClassCodeOriginatingOrganization AS ClassCodeOriginatingOrganization,\n\to_CommercialAutoVehicleTypeSize AS CommercialAutoVehicleTypeSize,\n\to_CommercialAutoBusinessUseClass AS CommercialAutoBusinessUseClass,\n\to_SecondaryClass AS SecondaryClass,\n\to_RadiusofOperation AS RadiusofOperation,\n\to_FleetType AS FleetType,\n\to_SecondaryClassGroup AS SecondaryClassGroup\n\tFROM EXP_Detect_Changes\n),\nRTR_Insert_Update_INSERT_OR_UPDATE AS (SELECT * FROM RTR_Insert_Update WHERE ChangeFlag='INSERT'\r\nOR ChangeFlag='UPDATE'),\nSupClassificationCommercialAuto AS (\n\tINSERT INTO SupClassificationCommercialAuto\n\t(CurrentSnapshotFlag, AuditId, EffectiveDate, ExpirationDate, SourceSystemId, CreatedDate, ModifiedDate, LineOfBusinessAbbreviation, RatingStateCode, ClassCode, ClassDescription, OriginatingOrganizationCode, VehicleTypeSize, BusinessUseClass, SecondaryClass, RadiusofOperation, FleetType, SecondaryClassGroup)\n\tSELECT \n\tCURRENTSNAPSHOTFLAG, \n\tAUDITID, \n\tClassEffectiveDate AS EFFECTIVEDATE, \n\tClassExpirationDate AS EXPIRATIONDATE, \n\tSourceSystemID AS SOURCESYSTEMID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tLINEOFBUSINESSABBREVIATION, \n\tRATINGSTATECODE, \n\tCLASSCODE, \n\tCLASSDESCRIPTION, \n\tClassCodeOriginatingOrganization AS ORIGINATINGORGANIZATIONCODE, \n\tCommercialAutoVehicleTypeSize AS VEHICLETYPESIZE, \n\tCommercialAutoBusinessUseClass AS BUSINESSUSECLASS, \n\tSECONDARYCLASS, \n\tRADIUSOFOPERATION, \n\tFLEETTYPE, \n\tSECONDARYCLASSGROUP\n\tFROM RTR_Insert_Update_INSERT_OR_UPDATE\n),\nSQ_SupClassificationCommercialAuto_CheckExpDate AS (\n\tSELECT SupClassificationCommercialAuto.SupClassificationCommercialAutoId\r\n\t     , SupClassificationCommercialAuto.LineOfBusinessAbbreviation\r\n\t     , SupClassificationCommercialAuto.RatingStateCode\r\n\t\t , SupClassificationCommercialAuto.EffectiveDate\r\n\t\t , SupClassificationCommercialAuto.ExpirationDate\r\n\t\t , SupClassificationCommercialAuto.ClassCode \r\n\t\t , SupClassificationCommercialAuto.ClassDescription\r\n\t\t , SupClassificationCommercialAuto.OriginatingOrganizationCode\r\n\t\t , SupClassificationCommercialAuto.VehicleTypeSize\t\r\n\t\t , SupClassificationCommercialAuto.BusinessUseClass\t\r\n\t\t , SupClassificationCommercialAuto.SecondaryClass\t\r\n\t\t , SupClassificationCommercialAuto.RadiusofOperation\t\r\n\t\t , SupClassificationCommercialAuto.FleetType\t\r\n\t\t , SupClassificationCommercialAuto.SecondaryClassGroup\t\r\n\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupClassificationCommercialAuto\r\n\twhere  CurrentSnapshotFlag =1\r\n\tORDER BY SupClassificationCommercialAuto.ClassCode  ,\r\n\tSupClassificationCommercialAuto.RatingStateCode, \r\n\tSupClassificationCommercialAuto.EffectiveDate DESC,\r\n\tSupClassificationCommercialAuto.CreatedDate DESC\n),\nEXP_Lag_Eff_dates AS (\n\tSELECT\n\tSupClassificationCommercialAutoID,\n\tLineOfBusinessAbbreviation,\n\tRatingStateCode,\n\tEffectiveDate,\n\tExpirationDate,\n\tClassCode,\n\tClassDescription,\n\tClassCodeOriginatingOrganization,\n\tVehicleTypeSize AS CommercialAutoVehicleTypeSize,\n\tBusinessUseClass AS CommercialAutoBusinessUseClass,\n\tSecondaryClass,\n\tRadiusofOperation,\n\tFleetType,\n\tSecondaryClassGroup,\n\t-- *INF*: DECODE(TRUE,RatingStateCode = v_PREV_ROW_RatingStateCode\r\n\t-- \t\t\t\t\t\t\t\tAND   ClassCode = v_PREV_ROW_ClassCode\r\n\t--                                                    AND   ClassCodeOriginatingOrganization = v_PREV_ROW_ClassCodeOriginatingOrganization\r\n\t-- \t\t\t \t\t\t\t\tand (ClassDescription <>v_PREV_ROW_ClassDescription\r\n\t-- \t\t\t\t\t\t\t\t  --OR EffectiveDate <> v_PREV_ROW_EffectiveDate\r\n\t-- \t\t\t\t\t\t\t\t -- OR ExpirationDate <> v_PREV_ROW_ExpirationDate\r\n\t--                                                      OR ADD_TO_DATE(ExpirationDate,'SS',+1) <>v_PREV_ROW_EffectiveDate   \t\t\t\t\t\r\n\t-- \t\t\t\t\t\t\t\t  OR CommercialAutoVehicleTypeSize <> v_PREV_ROW_CommercialAutoVehicleTypeSize\r\n\t-- \t\t\t\t\t\t\t\t  OR CommercialAutoBusinessUseClass <> v_PREV_ROW_CommercialAutoBusinessUseClass\r\n\t-- \t\t\t\t\t\t\t\t  OR SecondaryClass <> v_PREV_ROW_SecondaryClass\r\n\t-- \t\t\t\t\t\t\t\t  OR RadiusofOperation <> v_PREV_ROW_RadiusofOperation\r\n\t-- \t\t\t\t\t\t\t\t  OR FleetType <> v_PREV_ROW_FleetType\r\n\t-- \t\t\t\t\t\t\t\t  OR SecondaryClassGroup <> v_PREV_ROW_SecondaryClassGroup\r\n\t-- \t\t\t\t\t\t\t\t  )\r\n\t-- \t\t,'0','1')\n\tDECODE(TRUE,\n\tRatingStateCode = v_PREV_ROW_RatingStateCode AND ClassCode = v_PREV_ROW_ClassCode AND ClassCodeOriginatingOrganization = v_PREV_ROW_ClassCodeOriginatingOrganization AND ( ClassDescription <> v_PREV_ROW_ClassDescription OR ADD_TO_DATE(ExpirationDate, 'SS', + 1) <> v_PREV_ROW_EffectiveDate OR CommercialAutoVehicleTypeSize <> v_PREV_ROW_CommercialAutoVehicleTypeSize OR CommercialAutoBusinessUseClass <> v_PREV_ROW_CommercialAutoBusinessUseClass OR SecondaryClass <> v_PREV_ROW_SecondaryClass OR RadiusofOperation <> v_PREV_ROW_RadiusofOperation OR FleetType <> v_PREV_ROW_FleetType OR SecondaryClassGroup <> v_PREV_ROW_SecondaryClassGroup ), '0',\n\t'1') AS v_CurrentSnapshotFlag,\n\t-- *INF*: ADD_TO_DATE(   --v_PREV_ROW_EffectiveDate\r\n\t-- \r\n\t-- \tIIF(v_PREV_ROW_EffectiveDate =  TO_DATE('1800-01-01 00:00:00' , 'YYYY-MM-DD HH24:MI:SS' ) , sysdate ,v_PREV_ROW_EffectiveDate )\r\n\t-- \r\n\t-- ,'SS',-1)\r\n\t-- \r\n\t-- \r\n\t-- --ADD_TO_DATE(v_PREV_ROW_EffectiveDate,'SS',-1)\n\tADD_TO_DATE(IFF(v_PREV_ROW_EffectiveDate = TO_DATE('1800-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), sysdate, v_PREV_ROW_EffectiveDate), 'SS', - 1) AS v_ClassExpirationDate,\n\tv_CurrentSnapshotFlag AS o_CurrentSnapshotFlag,\n\tv_ClassExpirationDate AS ClassExpirationDate,\n\tLineOfBusinessAbbreviation AS v_PREV_ROW_LineOfBusinessAbbreviation,\n\tRatingStateCode AS v_PREV_ROW_RatingStateCode,\n\tClassCode AS v_PREV_ROW_ClassCode,\n\tEffectiveDate AS v_PREV_ROW_EffectiveDate,\n\tExpirationDate AS v_PREV_ROW_ExpirationDate,\n\tClassDescription AS v_PREV_ROW_ClassDescription,\n\tClassCodeOriginatingOrganization AS v_PREV_ROW_ClassCodeOriginatingOrganization,\n\tCommercialAutoVehicleTypeSize AS v_PREV_ROW_CommercialAutoVehicleTypeSize,\n\tCommercialAutoBusinessUseClass AS v_PREV_ROW_CommercialAutoBusinessUseClass,\n\tSecondaryClass AS v_PREV_ROW_SecondaryClass,\n\tRadiusofOperation AS v_PREV_ROW_RadiusofOperation,\n\tFleetType AS v_PREV_ROW_FleetType,\n\tSecondaryClassGroup AS v_PREV_ROW_SecondaryClassGroup,\n\tsysdate AS ModifiedDate\n\tFROM SQ_SupClassificationCommercialAuto_CheckExpDate\n),\nFIL_FirstRowInAKGroup AS (\n\tSELECT\n\tSupClassificationCommercialAutoID, \n\to_CurrentSnapshotFlag AS CurrentSnapshotFlag, \n\tClassExpirationDate AS ExpirationDate, \n\tModifiedDate\n\tFROM EXP_Lag_Eff_dates\n\tWHERE CurrentSnapshotFlag ='0'\n),\nUPD_SupISOGLClassGroup AS (\n\tSELECT\n\tSupClassificationCommercialAutoID, \n\tCurrentSnapshotFlag, \n\tExpirationDate, \n\tModifiedDate\n\tFROM FIL_FirstRowInAKGroup\n),\nSupClassificationCommercialAuto_CheckExpDate AS (\n\tMERGE INTO SupClassificationCommercialAuto AS T\n\tUSING UPD_SupISOGLClassGroup AS S\n\tON T.SupClassificationCommercialAutoId = S.SupClassificationCommercialAutoID\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.CurrentSnapshotFlag = S.CurrentSnapshotFlag, T.ExpirationDate = S.ExpirationDate, T.ModifiedDate = S.ModifiedDate\n),"
                        }
                    ]
                }
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246484"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905454"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7603035"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/29/2023 22:02:48"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 22:02:41"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_InsuranceReference_Policy"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Policy"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "InsRef"
            }
        },
        "folder": {
            "name": ""
        },
        "annotations": []
    }
}