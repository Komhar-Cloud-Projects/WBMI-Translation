{
    "name": "s_m_FEED_Load_WCSTAT_WorkWCSTATExtract_Premium",
    "properties": {
        "activities": [
            {
                "name": "m_FEED_Load_WCSTAT_WorkWCSTATExtract_Premium",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSEQTRANS AS (\n\tCREATE SEQUENCE SEQTRANS\n\tSTART = 0\n\tINCREMENT = 1;\n),\nWorkWCSTATAggregatedPremium AS (\n\tSELECT\n\t\tWorkWCSTATAggregatedPremiumId,\n\t\tAuditId,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tSourceSystemId,\n\t\tEDWPremiumMasterCalculationPKId,\n\t\tEDWLossMasterCalculationPKId,\n\t\tTypeBureauCode,\n\t\tPremiumMasterRunDate,\n\t\tLossMasterRunDate,\n\t\tBureauCompanyCode,\n\t\tPolicyKey,\n\t\tStateProvinceCode,\n\t\tPolicyEffectiveDate,\n\t\tPolicyEndDate,\n\t\tInterstateRiskId,\n\t\tEmployeeLeasingCode,\n\t\tStateRatingEffectiveDate,\n\t\tFederalTaxId,\n\t\tThreeYearFixedRatePolicyIndicator,\n\t\tMultistatePolicyIndicator,\n\t\tInterstateRatedPolicyIndicator,\n\t\tRetrospectiveratedPolicyIndicator,\n\t\tCancelledMidTermPolicyIndicator,\n\t\tManagedCareOrganizationPolicyIndicator,\n\t\tTypeOfCoverageIdCode,\n\t\tTypeOfPlan,\n\t\tDeductibleAmountPerClaimAccident,\n\t\tInsuredName,\n\t\tWCSTATAddress,\n\t\tPremiumMasterClassCode,\n\t\tExperienceModificationFactor,\n\t\tExperienceModificationEffectiveDate,\n\t\tExposure,\n\t\tPremiumMasterDirectWrittenPremiumAmount,\n\t\tManualChargedRate,\n\t\tLossMasterClassCode,\n\t\tClaimLossDate,\n\t\tClaimOccurrenceStatusCode,\n\t\tInjuryTypeCode,\n\t\tCatastropheCode,\n\t\tIncurredIndemnityAmount,\n\t\tIncurredMedicalAmount,\n\t\tCauseOfLoss,\n\t\tTypeOfRecoveryCode,\n\t\tJurisdictionStateCode,\n\t\tBodyPartCode,\n\t\tNatureOfInjuryCode,\n\t\tCauseOfInjuryCode,\n\t\tPaidIndemnityAmount,\n\t\tPaidMedicalAmount,\n\t\tDeductibleReimbursementAmount,\n\t\tPaidAllocatedLossAdjustmentExpenseAmount,\n\t\tIncurredAllocatedLossAdjustmentExpenseAmount,\n\t\tLossCondition,\n\t\tTypeOfSettlement,\n\t\tManagedCareOrganizationType,\n\t\tLumpSumIndicator,\n\t\tEstimatedAuditCode,\n\t\tCorrectionSeqNumber,\n\t\tClaimNumber,\n\t\tRunMonthAuditPremium,\n\t\tAgeOfPolicy,\n\t\tPolicyPremiumTotal,\n\t\tManualPremiumIndicator,\n\t\tPolicyStateManualPremiumTotal,\n\t\tBalMinPremiumTotal,\n\t\tRateEffectiveDate,\n\t\tAnyARDIndicator,\n\t\tExperienceRated,\n\t\tTermType,\n\t\tARDPassFlag,\n\t\tSplitPeriodCode,\n\t\tLossesSubjectToDeductibleCode,\n\t\tBasisOfDeductibleCalculationCode\n\tFROM WorkWCSTATAggregatedPremium\n\tINNER JOIN WorkWCSTATAggregatedPremium\n\tWHERE AuditId=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}  @{pipeline().parameters.WHERE_CLAUSE}\n),\nEXP_Extract AS (\n\tSELECT\n\tSourceSystemId,\n\tEDWPremiumMasterCalculationPKId,\n\tEDWLossMasterCalculationPKId,\n\tTypeBureauCode,\n\tPremiumMasterRunDate,\n\tLossMasterRunDate,\n\tBureauCompanyCode,\n\tPolicyKey,\n\tStateProvinceCode,\n\tPolicyEffectiveDate,\n\tPolicyEndDate,\n\tInterstateRiskId,\n\tEmployeeLeasingCode,\n\tStateRatingEffectiveDate,\n\tFederalTaxId,\n\tThreeYearFixedRatePolicyIndicator,\n\tMultistatePolicyIndicator,\n\tInterstateRatedPolicyIndicator,\n\tRetrospectiveratedPolicyIndicator,\n\tCancelledMidTermPolicyIndicator,\n\tManagedCareOrganizationPolicyIndicator,\n\tTypeOfCoverageIdCode,\n\tTypeOfPlan,\n\tDeductibleAmountPerClaimAccident,\n\tInsuredName,\n\tWCSTATAddress,\n\tPremiumMasterClassCode,\n\tExperienceModificationFactor,\n\tExperienceModificationEffectiveDate,\n\tExposure,\n\tPremiumMasterDirectWrittenPremiumAmount,\n\tManualChargedRate,\n\tLossMasterClassCode,\n\tClaimLossDate,\n\tClaimOccurrenceStatusCode,\n\tInjuryTypeCode,\n\tCatastropheCode,\n\tIncurredIndemnityAmount,\n\tIncurredMedicalAmount,\n\tCauseOfLoss,\n\tTypeOfRecoveryCode,\n\tJurisdictionStateCode,\n\tBodyPartCode,\n\tNatureOfInjuryCode,\n\tCauseOfInjuryCode,\n\tPaidIndemnityAmount,\n\tPaidMedicalAmount,\n\tDeductibleReimbursementAmount,\n\tPaidAllocatedLossAdjustmentExpenseAmount,\n\tIncurredAllocatedLossAdjustmentExpenseAmount,\n\tLossCondition AS loss_condition,\n\tTypeOfSettlement,\n\tManagedCareOrganizationType,\n\tLumpSumIndicator,\n\tEstimatedAuditCode,\n\tCorrectionSeqNumber,\n\tClaimNumber,\n\tRunMonthAuditPremium,\n\tAgeOfPolicy,\n\tPolicyPremiumTotal,\n\tManualPremiumIndicator AS ManualPremiumInd,\n\tPolicyStateManualPremiumTotal,\n\tBalMinPremiumTotal,\n\tRateEffectiveDate,\n\tCreatedDate,\n\tARDPassFlag AS ARD_Pass_Flag,\n\tLossesSubjectToDeductibleCode,\n\tBasisOfDeductibleCalculationCode\n\tFROM WorkWCSTATAggregatedPremium\n),\nRTR_PremTrans AS (\n\tSELECT\n\tSourceSystemId,\n\tEDWPremiumMasterCalculationPKId,\n\tEDWLossMasterCalculationPKId,\n\tTypeBureauCode,\n\tPremiumMasterRunDate,\n\tLossMasterRunDate,\n\tBureauCompanyCode,\n\tPolicyKey,\n\tStateProvinceCode,\n\tPolicyEffectiveDate,\n\tPolicyEndDate,\n\tInterstateRiskId,\n\tEmployeeLeasingCode,\n\tStateRatingEffectiveDate,\n\tFederalTaxId,\n\tThreeYearFixedRatePolicyIndicator,\n\tMultistatePolicyIndicator,\n\tInterstateRatedPolicyIndicator,\n\tRetrospectiveratedPolicyIndicator,\n\tCancelledMidTermPolicyIndicator,\n\tManagedCareOrganizationPolicyIndicator,\n\tTypeOfCoverageIdCode,\n\tTypeOfPlan,\n\tDeductibleAmountPerClaimAccident,\n\tInsuredName,\n\tWCSTATAddress,\n\tPremiumMasterClassCode,\n\tExperienceModificationFactor,\n\tExperienceModificationEffectiveDate,\n\tExposure,\n\tPremiumMasterDirectWrittenPremiumAmount,\n\tManualChargedRate,\n\tLossMasterClassCode,\n\tClaimLossDate,\n\tClaimOccurrenceStatusCode,\n\tInjuryTypeCode,\n\tCatastropheCode,\n\tIncurredIndemnityAmount,\n\tIncurredMedicalAmount,\n\tCauseOfLoss,\n\tTypeOfRecoveryCode,\n\tJurisdictionStateCode,\n\tBodyPartCode,\n\tNatureOfInjuryCode,\n\tCauseOfInjuryCode,\n\tPaidIndemnityAmount,\n\tPaidMedicalAmount,\n\tDeductibleReimbursementAmount,\n\tPaidAllocatedLossAdjustmentExpenseAmount,\n\tIncurredAllocatedLossAdjustmentExpenseAmount,\n\tloss_condition,\n\tTypeOfSettlement,\n\tManagedCareOrganizationType,\n\tLumpSumIndicator,\n\tEstimatedAuditCode,\n\tCorrectionSeqNumber,\n\tClaimNumber,\n\tRunMonthAuditPremium,\n\tAgeOfPolicy,\n\tPolicyPremiumTotal,\n\tManualPremiumInd,\n\tPolicyStateManualPremiumTotal,\n\tBalMinPremiumTotal,\n\tRateEffectiveDate,\n\tARD_Pass_Flag AS ARDPassFlag,\n\tLossesSubjectToDeductibleCode,\n\tBasisOfDeductibleCalculationCode\n\tFROM EXP_Extract\n),\nRTR_PremTrans_PolicyClassCodesWithPremium AS (SELECT * FROM RTR_PremTrans WHERE --PolicyClassCodesWithPremium\r\n--Fix PROD-8663\r\n--Source File\r\n--we do not report class codes with @{pipeline().parameters.0} premium (w/exception of 0174-MN only) in the source file. \r\n--- Class code -0012/1212 (covid class code) with zero rate and zero premium should be send to output file US-194087/US-183058\r\n\r\n(AgeOfPolicy=18 AND (\r\nPremiumMasterDirectWrittenPremiumAmount != 0 OR ARDPassFlag='1' OR (PremiumMasterClassCode='0174' AND StateProvinceCode='22')\r\nOR (PremiumMasterClassCode='0012' AND NOT IN(StateProvinceCode,'07','37'))\r\nOR (PremiumMasterClassCode='1212' AND IN(StateProvinceCode,'07','37'))\r\n)\r\n)\r\nOR\r\n--Correction File\r\n--However, if we have a code in source file and it changes to @{pipeline().parameters.0} premium in correction report, we need to show. \r\n(AgeOfPolicy<>18  AND (PremiumMasterDirectWrittenPremiumAmount != 0 OR ARDPassFlag='1'\r\nOR RunMonthAuditPremium !=0))\r\nAND\r\nStateProvinceCode <> '29'),\nRTR_PremTrans_PolicyClassCode1111Processing AS (SELECT * FROM RTR_PremTrans WHERE --PolicyClassCode1111Processing\r\n--Filter the Policy records that qualify for generating 1111 class code record\r\n--For WI 0990 class code (balance to minimum) premium should be 0\r\n-- US 448022 : NCCI states only: If Class Code 0012 is reported then we CAN'T report code 1111 for that state. Added logic - AND (PremiumMasterClassCode<>'0012' AND NOT IN(StateProvinceCode,  '04','07','20','21','29','31', '32','37','48'))\r\n\r\nPolicyPremiumTotal !=0 AND \r\nManualPremiumInd != 0 AND \r\nPolicyStateManualPremiumTotal = 0 AND \r\nStateProvinceCode != '29' AND\r\n(PremiumMasterClassCode<>'0012' AND NOT IN(StateProvinceCode,  '04','07','20','21','29','31', '32','37','48'))\r\n\r\n--Removed below logic as part of US-118475\r\n--AND (StateProvinceCode = '48' AND BalMinPremiumTotal = 0 OR StateProvinceCode <> '48' )),\nRTR_PremTrans_PolicyClassCodeNewJersey AS (SELECT * FROM RTR_PremTrans WHERE -- This group of the router is to bring only NJ records through\r\nStateProvinceCode = '29'),\nSRT_PolState AS (\n\tSELECT\n\tSourceSystemId, \n\tEDWPremiumMasterCalculationPKId, \n\tEDWLossMasterCalculationPKId, \n\tTypeBureauCode, \n\tPremiumMasterRunDate, \n\tLossMasterRunDate, \n\tBureauCompanyCode, \n\tPolicyKey, \n\tStateProvinceCode, \n\tPolicyEffectiveDate, \n\tPolicyEndDate, \n\tInterstateRiskId, \n\tEmployeeLeasingCode, \n\tStateRatingEffectiveDate, \n\tFederalTaxId, \n\tThreeYearFixedRatePolicyIndicator, \n\tMultistatePolicyIndicator, \n\tInterstateRatedPolicyIndicator, \n\tRetrospectiveratedPolicyIndicator, \n\tCancelledMidTermPolicyIndicator, \n\tManagedCareOrganizationPolicyIndicator, \n\tTypeOfCoverageIdCode, \n\tTypeOfPlan, \n\tDeductibleAmountPerClaimAccident, \n\tInsuredName, \n\tWCSTATAddress, \n\tPremiumMasterClassCode, \n\tExperienceModificationFactor, \n\tExperienceModificationEffectiveDate, \n\tExposure, \n\tPremiumMasterDirectWrittenPremiumAmount, \n\tManualChargedRate, \n\tLossMasterClassCode, \n\tClaimLossDate, \n\tClaimOccurrenceStatusCode, \n\tInjuryTypeCode, \n\tCatastropheCode, \n\tIncurredIndemnityAmount, \n\tIncurredMedicalAmount, \n\tCauseOfLoss, \n\tTypeOfRecoveryCode, \n\tJurisdictionStateCode, \n\tBodyPartCode, \n\tNatureOfInjuryCode, \n\tCauseOfInjuryCode, \n\tPaidIndemnityAmount, \n\tPaidMedicalAmount, \n\tDeductibleReimbursementAmount, \n\tPaidAllocatedLossAdjustmentExpenseAmount, \n\tIncurredAllocatedLossAdjustmentExpenseAmount, \n\tloss_condition, \n\tTypeOfSettlement, \n\tManagedCareOrganizationType, \n\tLumpSumIndicator, \n\tEstimatedAuditCode, \n\tCorrectionSeqNumber, \n\tClaimNumber, \n\tRateEffectiveDate AS RateEffectiveDate3, \n\tLossesSubjectToDeductibleCode, \n\tBasisOfDeductibleCalculationCode\n\tFROM RTR_PremTrans_PolicyClassCode1111Processing\n\tORDER BY PolicyKey ASC, StateProvinceCode ASC\n),\nagg_PolState AS (\n\tSELECT\n\tSourceSystemId,\n\tEDWPremiumMasterCalculationPKId,\n\tEDWLossMasterCalculationPKId,\n\tTypeBureauCode,\n\tPremiumMasterRunDate,\n\tLossMasterRunDate,\n\tBureauCompanyCode,\n\tPolicyKey,\n\tStateProvinceCode,\n\tPolicyEffectiveDate,\n\tPolicyEndDate,\n\tInterstateRiskId,\n\tEmployeeLeasingCode,\n\tStateRatingEffectiveDate,\n\tFederalTaxId,\n\tThreeYearFixedRatePolicyIndicator,\n\tMultistatePolicyIndicator,\n\tInterstateRatedPolicyIndicator,\n\tRetrospectiveratedPolicyIndicator,\n\tCancelledMidTermPolicyIndicator,\n\tManagedCareOrganizationPolicyIndicator,\n\tTypeOfCoverageIdCode,\n\tTypeOfPlan,\n\tDeductibleAmountPerClaimAccident,\n\tInsuredName,\n\tWCSTATAddress,\n\tPremiumMasterClassCode,\n\tExperienceModificationFactor,\n\tExperienceModificationEffectiveDate,\n\tExposure,\n\tPremiumMasterDirectWrittenPremiumAmount,\n\tManualChargedRate,\n\tLossMasterClassCode,\n\tClaimLossDate,\n\tClaimOccurrenceStatusCode,\n\tInjuryTypeCode,\n\tCatastropheCode,\n\tIncurredIndemnityAmount,\n\tIncurredMedicalAmount,\n\tCauseOfLoss,\n\tTypeOfRecoveryCode,\n\tJurisdictionStateCode,\n\tBodyPartCode,\n\tNatureOfInjuryCode,\n\tCauseOfInjuryCode,\n\tPaidIndemnityAmount,\n\tPaidMedicalAmount,\n\tDeductibleReimbursementAmount,\n\tPaidAllocatedLossAdjustmentExpenseAmount,\n\tIncurredAllocatedLossAdjustmentExpenseAmount,\n\tloss_condition,\n\tTypeOfSettlement,\n\tManagedCareOrganizationType,\n\tLumpSumIndicator,\n\tEstimatedAuditCode,\n\tCorrectionSeqNumber,\n\tClaimNumber,\n\tRateEffectiveDate3,\n\tLossesSubjectToDeductibleCode,\n\tBasisOfDeductibleCalculationCode\n\tFROM SRT_PolState\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey, StateProvinceCode ORDER BY NULL) = 1\n),\nEXP_1111ClassCode AS (\n\tSELECT\n\tSourceSystemId,\n\t-1 AS o_EDWPremiumMasterCalculationPKId,\n\t-1 AS o_EDWLossMasterCalculationPKId,\n\tTypeBureauCode,\n\tPremiumMasterRunDate,\n\tLossMasterRunDate,\n\tBureauCompanyCode,\n\tPolicyKey,\n\tStateProvinceCode,\n\tPolicyEffectiveDate,\n\tPolicyEndDate,\n\tInterstateRiskId,\n\tEmployeeLeasingCode,\n\tStateRatingEffectiveDate,\n\tFederalTaxId,\n\tThreeYearFixedRatePolicyIndicator,\n\tMultistatePolicyIndicator,\n\tInterstateRatedPolicyIndicator,\n\tRetrospectiveratedPolicyIndicator,\n\tCancelledMidTermPolicyIndicator,\n\tManagedCareOrganizationPolicyIndicator,\n\tTypeOfCoverageIdCode,\n\tTypeOfPlan,\n\tDeductibleAmountPerClaimAccident,\n\tInsuredName,\n\tWCSTATAddress,\n\t'1111' AS o_PremiumMasterClassCode,\n\tExperienceModificationFactor,\n\tExperienceModificationEffectiveDate AS i_ExperienceModificationEffectiveDate,\n\t-- *INF*: -- Code that was here previously\r\n\t-- --TO_DATE('2100-12-31', 'YYYY-MM-DD')\r\n\t-- -- force exp mod date to default 12/31/2100 as we do for all exp mod factor of 0\r\n\t-- \r\n\t-- -- ExpModEffDate needs to be the same as the PolicyEffectiveDate when the ClassCode is 1111\r\n\t-- IIF(MultistatePolicyIndicator='1' AND NOT IN(StateProvinceCode,'04','07','20','21','29','31','37','48'), PolicyEffectiveDate, TO_DATE('2100-12-31', 'YYYY-MM-DD'))\n\tIFF(\n\t    MultistatePolicyIndicator = '1'\n\t    and NOT StateProvinceCode IN ('04','07','20','21','29','31','37','48'),\n\t    PolicyEffectiveDate,\n\t    TO_TIMESTAMP('2100-12-31', 'YYYY-MM-DD')\n\t) AS o_ExperienceModificationEffectiveDate,\n\t0 AS o_Exposure,\n\t0 AS o_PremiumMasterDirectWrittenPremiumAmount,\n\t0 AS o_ManualChargedRate,\n\tLossMasterClassCode,\n\tClaimLossDate,\n\tClaimOccurrenceStatusCode,\n\tInjuryTypeCode,\n\tCatastropheCode,\n\tIncurredIndemnityAmount,\n\tIncurredMedicalAmount,\n\tCauseOfLoss,\n\tTypeOfRecoveryCode,\n\tJurisdictionStateCode,\n\tBodyPartCode,\n\tNatureOfInjuryCode,\n\tCauseOfInjuryCode,\n\tPaidIndemnityAmount,\n\tPaidMedicalAmount,\n\tDeductibleReimbursementAmount,\n\tPaidAllocatedLossAdjustmentExpenseAmount,\n\tIncurredAllocatedLossAdjustmentExpenseAmount,\n\tloss_condition,\n\tTypeOfSettlement,\n\tManagedCareOrganizationType,\n\tLumpSumIndicator,\n\tEstimatedAuditCode,\n\tCorrectionSeqNumber,\n\tClaimNumber,\n\tRateEffectiveDate3 AS RateEffectiveDate,\n\t0 AS Split_Period_Code,\n\tLossesSubjectToDeductibleCode,\n\tBasisOfDeductibleCalculationCode\n\tFROM agg_PolState\n),\nsrt_Policy_key AS (\n\tSELECT\n\tSourceSystemId, \n\tEDWPremiumMasterCalculationPKId, \n\tEDWLossMasterCalculationPKId, \n\tTypeBureauCode, \n\tPremiumMasterRunDate, \n\tLossMasterRunDate, \n\tBureauCompanyCode, \n\tPolicyKey, \n\tStateProvinceCode, \n\tPolicyEffectiveDate, \n\tPolicyEndDate, \n\tInterstateRiskId, \n\tEmployeeLeasingCode, \n\tStateRatingEffectiveDate, \n\tFederalTaxId, \n\tThreeYearFixedRatePolicyIndicator, \n\tMultistatePolicyIndicator, \n\tInterstateRatedPolicyIndicator, \n\tRetrospectiveratedPolicyIndicator, \n\tCancelledMidTermPolicyIndicator, \n\tManagedCareOrganizationPolicyIndicator, \n\tTypeOfCoverageIdCode, \n\tTypeOfPlan, \n\tDeductibleAmountPerClaimAccident, \n\tInsuredName, \n\tWCSTATAddress, \n\tPremiumMasterClassCode, \n\tExperienceModificationFactor, \n\tExperienceModificationEffectiveDate, \n\tExposure, \n\tPremiumMasterDirectWrittenPremiumAmount, \n\tManualChargedRate, \n\tLossMasterClassCode, \n\tClaimLossDate, \n\tClaimOccurrenceStatusCode, \n\tInjuryTypeCode, \n\tCatastropheCode, \n\tIncurredIndemnityAmount, \n\tIncurredMedicalAmount, \n\tCauseOfLoss, \n\tTypeOfRecoveryCode, \n\tJurisdictionStateCode, \n\tBodyPartCode, \n\tNatureOfInjuryCode, \n\tCauseOfInjuryCode, \n\tPaidIndemnityAmount, \n\tPaidMedicalAmount, \n\tDeductibleReimbursementAmount, \n\tPaidAllocatedLossAdjustmentExpenseAmount, \n\tIncurredAllocatedLossAdjustmentExpenseAmount, \n\tloss_condition, \n\tTypeOfSettlement, \n\tManagedCareOrganizationType, \n\tLumpSumIndicator, \n\tEstimatedAuditCode, \n\tCorrectionSeqNumber, \n\tClaimNumber, \n\tRateEffectiveDate AS RateEffectiveDate1, \n\tLossesSubjectToDeductibleCode, \n\tBasisOfDeductibleCalculationCode\n\tFROM RTR_PremTrans_PolicyClassCodesWithPremium\n\tORDER BY PolicyKey ASC\n),\nAgg_Policy_Count AS (\n\tSELECT\n\tPolicyKey,\n\t-- *INF*: Count( PolicyKey)\n\tCount(PolicyKey) AS Rec_Count\n\tFROM srt_Policy_key\n\tGROUP BY PolicyKey\n),\nJnr_Premium_Policy_Count AS (SELECT\n\tsrt_Policy_key.SourceSystemId, \n\tsrt_Policy_key.EDWPremiumMasterCalculationPKId, \n\tsrt_Policy_key.EDWLossMasterCalculationPKId, \n\tsrt_Policy_key.TypeBureauCode, \n\tsrt_Policy_key.PremiumMasterRunDate, \n\tsrt_Policy_key.LossMasterRunDate, \n\tsrt_Policy_key.BureauCompanyCode, \n\tsrt_Policy_key.PolicyKey, \n\tsrt_Policy_key.StateProvinceCode, \n\tsrt_Policy_key.PolicyEffectiveDate, \n\tsrt_Policy_key.PolicyEndDate, \n\tsrt_Policy_key.InterstateRiskId, \n\tsrt_Policy_key.EmployeeLeasingCode, \n\tsrt_Policy_key.StateRatingEffectiveDate, \n\tsrt_Policy_key.FederalTaxId, \n\tsrt_Policy_key.ThreeYearFixedRatePolicyIndicator, \n\tsrt_Policy_key.MultistatePolicyIndicator, \n\tsrt_Policy_key.InterstateRatedPolicyIndicator, \n\tsrt_Policy_key.RetrospectiveratedPolicyIndicator, \n\tsrt_Policy_key.CancelledMidTermPolicyIndicator, \n\tsrt_Policy_key.ManagedCareOrganizationPolicyIndicator, \n\tsrt_Policy_key.TypeOfCoverageIdCode, \n\tsrt_Policy_key.TypeOfPlan, \n\tsrt_Policy_key.DeductibleAmountPerClaimAccident, \n\tsrt_Policy_key.InsuredName, \n\tsrt_Policy_key.WCSTATAddress, \n\tsrt_Policy_key.PremiumMasterClassCode, \n\tsrt_Policy_key.ExperienceModificationFactor, \n\tsrt_Policy_key.ExperienceModificationEffectiveDate, \n\tsrt_Policy_key.Exposure, \n\tsrt_Policy_key.PremiumMasterDirectWrittenPremiumAmount, \n\tsrt_Policy_key.ManualChargedRate, \n\tsrt_Policy_key.LossMasterClassCode, \n\tsrt_Policy_key.ClaimLossDate, \n\tsrt_Policy_key.ClaimOccurrenceStatusCode, \n\tsrt_Policy_key.InjuryTypeCode, \n\tsrt_Policy_key.CatastropheCode, \n\tsrt_Policy_key.IncurredIndemnityAmount, \n\tsrt_Policy_key.IncurredMedicalAmount, \n\tsrt_Policy_key.CauseOfLoss, \n\tsrt_Policy_key.TypeOfRecoveryCode, \n\tsrt_Policy_key.JurisdictionStateCode, \n\tsrt_Policy_key.BodyPartCode, \n\tsrt_Policy_key.NatureOfInjuryCode, \n\tsrt_Policy_key.CauseOfInjuryCode, \n\tsrt_Policy_key.PaidIndemnityAmount, \n\tsrt_Policy_key.PaidMedicalAmount, \n\tsrt_Policy_key.DeductibleReimbursementAmount, \n\tsrt_Policy_key.PaidAllocatedLossAdjustmentExpenseAmount, \n\tsrt_Policy_key.IncurredAllocatedLossAdjustmentExpenseAmount, \n\tsrt_Policy_key.loss_condition, \n\tsrt_Policy_key.TypeOfSettlement, \n\tsrt_Policy_key.ManagedCareOrganizationType, \n\tsrt_Policy_key.LumpSumIndicator, \n\tsrt_Policy_key.EstimatedAuditCode, \n\tsrt_Policy_key.CorrectionSeqNumber, \n\tsrt_Policy_key.ClaimNumber, \n\tsrt_Policy_key.RateEffectiveDate1, \n\tAgg_Policy_Count.PolicyKey AS PolicyKey1, \n\tAgg_Policy_Count.Rec_Count AS Count, \n\tsrt_Policy_key.LossesSubjectToDeductibleCode, \n\tsrt_Policy_key.BasisOfDeductibleCalculationCode\n\tFROM srt_Policy_key\n\tINNER JOIN Agg_Policy_Count\n\tON Agg_Policy_Count.PolicyKey = srt_Policy_key.PolicyKey\n),\nFil_Class_CD_0174_ZeroValuePremiumPolicy AS (\n\tSELECT\n\tSourceSystemId, \n\tEDWPremiumMasterCalculationPKId, \n\tEDWLossMasterCalculationPKId, \n\tTypeBureauCode, \n\tPremiumMasterRunDate, \n\tLossMasterRunDate, \n\tBureauCompanyCode, \n\tPolicyKey, \n\tStateProvinceCode, \n\tPolicyEffectiveDate, \n\tPolicyEndDate, \n\tInterstateRiskId, \n\tEmployeeLeasingCode, \n\tStateRatingEffectiveDate, \n\tFederalTaxId, \n\tThreeYearFixedRatePolicyIndicator, \n\tMultistatePolicyIndicator, \n\tInterstateRatedPolicyIndicator, \n\tRetrospectiveratedPolicyIndicator, \n\tCancelledMidTermPolicyIndicator, \n\tManagedCareOrganizationPolicyIndicator, \n\tTypeOfCoverageIdCode, \n\tTypeOfPlan, \n\tDeductibleAmountPerClaimAccident, \n\tInsuredName, \n\tWCSTATAddress, \n\tPremiumMasterClassCode, \n\tExperienceModificationFactor, \n\tExperienceModificationEffectiveDate, \n\tExposure, \n\tPremiumMasterDirectWrittenPremiumAmount, \n\tManualChargedRate, \n\tLossMasterClassCode, \n\tClaimLossDate, \n\tClaimOccurrenceStatusCode, \n\tInjuryTypeCode, \n\tCatastropheCode, \n\tIncurredIndemnityAmount, \n\tIncurredMedicalAmount, \n\tCauseOfLoss, \n\tTypeOfRecoveryCode, \n\tJurisdictionStateCode, \n\tBodyPartCode, \n\tNatureOfInjuryCode, \n\tCauseOfInjuryCode, \n\tPaidIndemnityAmount, \n\tPaidMedicalAmount, \n\tDeductibleReimbursementAmount, \n\tPaidAllocatedLossAdjustmentExpenseAmount, \n\tIncurredAllocatedLossAdjustmentExpenseAmount, \n\tloss_condition, \n\tTypeOfSettlement, \n\tManagedCareOrganizationType, \n\tLumpSumIndicator, \n\tEstimatedAuditCode, \n\tCorrectionSeqNumber, \n\tClaimNumber, \n\tRateEffectiveDate1, \n\tCount AS Rec_Count, \n\tLossesSubjectToDeductibleCode, \n\tBasisOfDeductibleCalculationCode\n\tFROM Jnr_Premium_Policy_Count\n\tWHERE -- This condition is being used to filter out the transaction (PremiumMasterClassCode ='0174') from Minnesota state if Policy has been cancelled flat and there is no premium available\r\nIIF(PremiumMasterClassCode='0174'  AND  StateProvinceCode = '22'  AND Rec_Count  =1, FALSE,TRUE)\n),\nsort_split_period_code AS (\n\tSELECT\n\tSourceSystemId, \n\tEDWPremiumMasterCalculationPKId, \n\tEDWLossMasterCalculationPKId, \n\tTypeBureauCode, \n\tPremiumMasterRunDate, \n\tLossMasterRunDate, \n\tBureauCompanyCode, \n\tPolicyKey, \n\tStateProvinceCode, \n\tPolicyEffectiveDate, \n\tPolicyEndDate, \n\tInterstateRiskId, \n\tEmployeeLeasingCode, \n\tStateRatingEffectiveDate, \n\tFederalTaxId, \n\tThreeYearFixedRatePolicyIndicator, \n\tMultistatePolicyIndicator, \n\tInterstateRatedPolicyIndicator, \n\tRetrospectiveratedPolicyIndicator, \n\tCancelledMidTermPolicyIndicator, \n\tManagedCareOrganizationPolicyIndicator, \n\tTypeOfCoverageIdCode, \n\tTypeOfPlan, \n\tDeductibleAmountPerClaimAccident, \n\tInsuredName, \n\tWCSTATAddress, \n\tPremiumMasterClassCode, \n\tExperienceModificationFactor, \n\tExposure, \n\tPremiumMasterDirectWrittenPremiumAmount, \n\tManualChargedRate, \n\tLossMasterClassCode, \n\tClaimLossDate, \n\tClaimOccurrenceStatusCode, \n\tInjuryTypeCode, \n\tCatastropheCode, \n\tIncurredIndemnityAmount, \n\tIncurredMedicalAmount, \n\tCauseOfLoss, \n\tTypeOfRecoveryCode, \n\tJurisdictionStateCode, \n\tBodyPartCode, \n\tNatureOfInjuryCode, \n\tCauseOfInjuryCode, \n\tPaidIndemnityAmount, \n\tPaidMedicalAmount, \n\tDeductibleReimbursementAmount, \n\tPaidAllocatedLossAdjustmentExpenseAmount, \n\tIncurredAllocatedLossAdjustmentExpenseAmount, \n\tloss_condition, \n\tTypeOfSettlement, \n\tManagedCareOrganizationType, \n\tLumpSumIndicator, \n\tEstimatedAuditCode, \n\tCorrectionSeqNumber, \n\tClaimNumber, \n\tRateEffectiveDate1, \n\tExperienceModificationEffectiveDate, \n\tLossesSubjectToDeductibleCode, \n\tBasisOfDeductibleCalculationCode\n\tFROM Fil_Class_CD_0174_ZeroValuePremiumPolicy\n\tORDER BY TypeBureauCode ASC, BureauCompanyCode ASC, PolicyKey ASC, StateProvinceCode ASC, PolicyEffectiveDate ASC, PolicyEndDate ASC, PremiumMasterClassCode ASC, RateEffectiveDate1 ASC, ExperienceModificationEffectiveDate ASC\n),\nExp_SPlitPeriodCode AS (\n\tSELECT\n\tSourceSystemId,\n\tEDWPremiumMasterCalculationPKId,\n\tEDWLossMasterCalculationPKId,\n\tTypeBureauCode,\n\tPremiumMasterRunDate,\n\tLossMasterRunDate,\n\tBureauCompanyCode,\n\tPolicyKey,\n\tStateProvinceCode,\n\tPolicyEffectiveDate,\n\tPolicyEndDate,\n\tInterstateRiskId,\n\tEmployeeLeasingCode,\n\tStateRatingEffectiveDate,\n\tFederalTaxId,\n\tThreeYearFixedRatePolicyIndicator,\n\tMultistatePolicyIndicator,\n\tInterstateRatedPolicyIndicator,\n\tRetrospectiveratedPolicyIndicator,\n\tCancelledMidTermPolicyIndicator,\n\tManagedCareOrganizationPolicyIndicator,\n\tTypeOfCoverageIdCode,\n\tTypeOfPlan,\n\tDeductibleAmountPerClaimAccident,\n\tInsuredName,\n\tWCSTATAddress,\n\tPremiumMasterClassCode,\n\tExperienceModificationFactor,\n\tExposure,\n\tPremiumMasterDirectWrittenPremiumAmount,\n\tManualChargedRate,\n\tLossMasterClassCode,\n\tClaimLossDate,\n\tClaimOccurrenceStatusCode,\n\tInjuryTypeCode,\n\tCatastropheCode,\n\tIncurredIndemnityAmount,\n\tIncurredMedicalAmount,\n\tCauseOfLoss,\n\tTypeOfRecoveryCode,\n\tJurisdictionStateCode,\n\tBodyPartCode,\n\tNatureOfInjuryCode,\n\tCauseOfInjuryCode,\n\tPaidIndemnityAmount,\n\tPaidMedicalAmount,\n\tDeductibleReimbursementAmount,\n\tPaidAllocatedLossAdjustmentExpenseAmount,\n\tIncurredAllocatedLossAdjustmentExpenseAmount,\n\tloss_condition,\n\tTypeOfSettlement,\n\tManagedCareOrganizationType,\n\tLumpSumIndicator,\n\tEstimatedAuditCode,\n\tCorrectionSeqNumber,\n\tClaimNumber,\n\tRateEffectiveDate1,\n\tExperienceModificationEffectiveDate,\n\t-- *INF*: IIF(TypeBureauCode=V_Prev_TypeBureauCode and BureauCompanyCode=V_Prev_BureauCompanyCode and PolicyKey=V_Prev_PolicyKey and StateProvinceCode=V_Prev_StateProvinceCode and PolicyEffectiveDate=V_Prev_PolicyEffectiveDate and PolicyEndDate=V_Prev_PolicyEndDate and PremiumMasterClassCode=V_Prev_PremiumMasterClassCode  and SourceSystemId='DCT' and (RateEffectiveDate1>V_Prev_RateEffectiveDate OR ExperienceModificationEffectiveDate>V_Prev_ExperienceModificationEffectiveDate),V_SplitPeriodCode+1,0)\n\tIFF(\n\t    TypeBureauCode = V_Prev_TypeBureauCode\n\t    and BureauCompanyCode = V_Prev_BureauCompanyCode\n\t    and PolicyKey = V_Prev_PolicyKey\n\t    and StateProvinceCode = V_Prev_StateProvinceCode\n\t    and PolicyEffectiveDate = V_Prev_PolicyEffectiveDate\n\t    and PolicyEndDate = V_Prev_PolicyEndDate\n\t    and PremiumMasterClassCode = V_Prev_PremiumMasterClassCode\n\t    and SourceSystemId = 'DCT'\n\t    and (RateEffectiveDate1 > V_Prev_RateEffectiveDate\n\t    or ExperienceModificationEffectiveDate > V_Prev_ExperienceModificationEffectiveDate),\n\t    V_SplitPeriodCode + 1,\n\t    0\n\t) AS V_SplitPeriodCode,\n\tV_SplitPeriodCode AS O_SplitPeriodCode,\n\tTypeBureauCode AS V_Prev_TypeBureauCode,\n\tBureauCompanyCode AS V_Prev_BureauCompanyCode,\n\tPolicyKey AS V_Prev_PolicyKey,\n\tStateProvinceCode AS V_Prev_StateProvinceCode,\n\tPolicyEffectiveDate AS V_Prev_PolicyEffectiveDate,\n\tPolicyEndDate AS V_Prev_PolicyEndDate,\n\tPremiumMasterClassCode AS V_Prev_PremiumMasterClassCode,\n\tRateEffectiveDate1 AS V_Prev_RateEffectiveDate,\n\tExperienceModificationEffectiveDate AS V_Prev_ExperienceModificationEffectiveDate,\n\tLossesSubjectToDeductibleCode,\n\tBasisOfDeductibleCalculationCode\n\tFROM sort_split_period_code\n),\nsrt_Policy_Key_NJ AS (\n\tSELECT\n\tSourceSystemId, \n\tEDWPremiumMasterCalculationPKId, \n\tEDWLossMasterCalculationPKId, \n\tTypeBureauCode, \n\tPremiumMasterRunDate, \n\tLossMasterRunDate, \n\tBureauCompanyCode, \n\tPolicyKey, \n\tStateProvinceCode, \n\tPolicyEffectiveDate, \n\tPolicyEndDate, \n\tInterstateRiskId, \n\tEmployeeLeasingCode, \n\tStateRatingEffectiveDate, \n\tFederalTaxId, \n\tThreeYearFixedRatePolicyIndicator, \n\tMultistatePolicyIndicator, \n\tInterstateRatedPolicyIndicator, \n\tRetrospectiveratedPolicyIndicator, \n\tCancelledMidTermPolicyIndicator, \n\tManagedCareOrganizationPolicyIndicator, \n\tTypeOfCoverageIdCode, \n\tTypeOfPlan, \n\tDeductibleAmountPerClaimAccident, \n\tInsuredName, \n\tWCSTATAddress, \n\tPremiumMasterClassCode, \n\tExperienceModificationFactor, \n\tExperienceModificationEffectiveDate, \n\tExposure, \n\tPremiumMasterDirectWrittenPremiumAmount, \n\tManualChargedRate, \n\tLossMasterClassCode, \n\tClaimLossDate, \n\tClaimOccurrenceStatusCode, \n\tInjuryTypeCode, \n\tCatastropheCode, \n\tIncurredIndemnityAmount, \n\tIncurredMedicalAmount, \n\tCauseOfLoss, \n\tTypeOfRecoveryCode, \n\tJurisdictionStateCode, \n\tBodyPartCode, \n\tNatureOfInjuryCode, \n\tCauseOfInjuryCode, \n\tPaidIndemnityAmount, \n\tPaidMedicalAmount, \n\tDeductibleReimbursementAmount, \n\tPaidAllocatedLossAdjustmentExpenseAmount, \n\tIncurredAllocatedLossAdjustmentExpenseAmount, \n\tloss_condition, \n\tTypeOfSettlement, \n\tManagedCareOrganizationType, \n\tLumpSumIndicator, \n\tEstimatedAuditCode, \n\tCorrectionSeqNumber, \n\tClaimNumber, \n\tRateEffectiveDate AS RateEffectiveDate1, \n\tLossesSubjectToDeductibleCode, \n\tBasisOfDeductibleCalculationCode\n\tFROM RTR_PremTrans_PolicyClassCodeNewJersey\n\tORDER BY PolicyKey ASC\n),\nAgg_Policy_ManualChargedRate_NJ AS (\n\tSELECT\n\tPolicyKey,\n\tManualChargedRate,\n\t-- *INF*: MAX(ManualChargedRate)\n\tMAX(ManualChargedRate) AS MaxManualChargedRate\n\tFROM srt_Policy_Key_NJ\n\tGROUP BY PolicyKey\n),\nJnr_Premium_Policy_Count1 AS (SELECT\n\tsrt_Policy_Key_NJ.SourceSystemId, \n\tsrt_Policy_Key_NJ.EDWPremiumMasterCalculationPKId, \n\tsrt_Policy_Key_NJ.EDWLossMasterCalculationPKId, \n\tsrt_Policy_Key_NJ.TypeBureauCode, \n\tsrt_Policy_Key_NJ.PremiumMasterRunDate, \n\tsrt_Policy_Key_NJ.LossMasterRunDate, \n\tsrt_Policy_Key_NJ.BureauCompanyCode, \n\tsrt_Policy_Key_NJ.PolicyKey, \n\tsrt_Policy_Key_NJ.StateProvinceCode, \n\tsrt_Policy_Key_NJ.PolicyEffectiveDate, \n\tsrt_Policy_Key_NJ.PolicyEndDate, \n\tsrt_Policy_Key_NJ.InterstateRiskId, \n\tsrt_Policy_Key_NJ.EmployeeLeasingCode, \n\tsrt_Policy_Key_NJ.StateRatingEffectiveDate, \n\tsrt_Policy_Key_NJ.FederalTaxId, \n\tsrt_Policy_Key_NJ.ThreeYearFixedRatePolicyIndicator, \n\tsrt_Policy_Key_NJ.MultistatePolicyIndicator, \n\tsrt_Policy_Key_NJ.InterstateRatedPolicyIndicator, \n\tsrt_Policy_Key_NJ.RetrospectiveratedPolicyIndicator, \n\tsrt_Policy_Key_NJ.CancelledMidTermPolicyIndicator, \n\tsrt_Policy_Key_NJ.ManagedCareOrganizationPolicyIndicator, \n\tsrt_Policy_Key_NJ.TypeOfCoverageIdCode, \n\tsrt_Policy_Key_NJ.TypeOfPlan, \n\tsrt_Policy_Key_NJ.DeductibleAmountPerClaimAccident, \n\tsrt_Policy_Key_NJ.InsuredName, \n\tsrt_Policy_Key_NJ.WCSTATAddress, \n\tsrt_Policy_Key_NJ.PremiumMasterClassCode, \n\tsrt_Policy_Key_NJ.ExperienceModificationFactor, \n\tsrt_Policy_Key_NJ.ExperienceModificationEffectiveDate, \n\tsrt_Policy_Key_NJ.Exposure, \n\tsrt_Policy_Key_NJ.PremiumMasterDirectWrittenPremiumAmount, \n\tsrt_Policy_Key_NJ.ManualChargedRate, \n\tsrt_Policy_Key_NJ.LossMasterClassCode, \n\tsrt_Policy_Key_NJ.ClaimLossDate, \n\tsrt_Policy_Key_NJ.ClaimOccurrenceStatusCode, \n\tsrt_Policy_Key_NJ.InjuryTypeCode, \n\tsrt_Policy_Key_NJ.CatastropheCode, \n\tsrt_Policy_Key_NJ.IncurredIndemnityAmount, \n\tsrt_Policy_Key_NJ.IncurredMedicalAmount, \n\tsrt_Policy_Key_NJ.CauseOfLoss, \n\tsrt_Policy_Key_NJ.TypeOfRecoveryCode, \n\tsrt_Policy_Key_NJ.JurisdictionStateCode, \n\tsrt_Policy_Key_NJ.BodyPartCode, \n\tsrt_Policy_Key_NJ.NatureOfInjuryCode, \n\tsrt_Policy_Key_NJ.CauseOfInjuryCode, \n\tsrt_Policy_Key_NJ.PaidIndemnityAmount, \n\tsrt_Policy_Key_NJ.PaidMedicalAmount, \n\tsrt_Policy_Key_NJ.DeductibleReimbursementAmount, \n\tsrt_Policy_Key_NJ.PaidAllocatedLossAdjustmentExpenseAmount, \n\tsrt_Policy_Key_NJ.IncurredAllocatedLossAdjustmentExpenseAmount, \n\tsrt_Policy_Key_NJ.loss_condition, \n\tsrt_Policy_Key_NJ.TypeOfSettlement, \n\tsrt_Policy_Key_NJ.ManagedCareOrganizationType, \n\tsrt_Policy_Key_NJ.LumpSumIndicator, \n\tsrt_Policy_Key_NJ.EstimatedAuditCode, \n\tsrt_Policy_Key_NJ.CorrectionSeqNumber, \n\tsrt_Policy_Key_NJ.ClaimNumber, \n\tsrt_Policy_Key_NJ.RateEffectiveDate1, \n\tAgg_Policy_ManualChargedRate_NJ.PolicyKey AS PolicyKey1, \n\tAgg_Policy_ManualChargedRate_NJ.MaxManualChargedRate, \n\tsrt_Policy_Key_NJ.LossesSubjectToDeductibleCode, \n\tsrt_Policy_Key_NJ.BasisOfDeductibleCalculationCode\n\tFROM srt_Policy_Key_NJ\n\tINNER JOIN Agg_Policy_ManualChargedRate_NJ\n\tON Agg_Policy_ManualChargedRate_NJ.PolicyKey = srt_Policy_Key_NJ.PolicyKey\n),\nFil_NewJersey AS (\n\tSELECT\n\tSourceSystemId, \n\tEDWPremiumMasterCalculationPKId, \n\tEDWLossMasterCalculationPKId, \n\tTypeBureauCode, \n\tPremiumMasterRunDate, \n\tLossMasterRunDate, \n\tBureauCompanyCode, \n\tPolicyKey, \n\tStateProvinceCode, \n\tPolicyEffectiveDate, \n\tPolicyEndDate, \n\tInterstateRiskId, \n\tEmployeeLeasingCode, \n\tStateRatingEffectiveDate, \n\tFederalTaxId, \n\tThreeYearFixedRatePolicyIndicator, \n\tMultistatePolicyIndicator, \n\tInterstateRatedPolicyIndicator, \n\tRetrospectiveratedPolicyIndicator, \n\tCancelledMidTermPolicyIndicator, \n\tManagedCareOrganizationPolicyIndicator, \n\tTypeOfCoverageIdCode, \n\tTypeOfPlan, \n\tDeductibleAmountPerClaimAccident, \n\tInsuredName, \n\tWCSTATAddress, \n\tPremiumMasterClassCode, \n\tExperienceModificationFactor, \n\tExperienceModificationEffectiveDate, \n\tExposure, \n\tPremiumMasterDirectWrittenPremiumAmount, \n\tManualChargedRate, \n\tLossMasterClassCode, \n\tClaimLossDate, \n\tClaimOccurrenceStatusCode, \n\tInjuryTypeCode, \n\tCatastropheCode, \n\tIncurredIndemnityAmount, \n\tIncurredMedicalAmount, \n\tCauseOfLoss, \n\tTypeOfRecoveryCode, \n\tJurisdictionStateCode, \n\tBodyPartCode, \n\tNatureOfInjuryCode, \n\tCauseOfInjuryCode, \n\tPaidIndemnityAmount, \n\tPaidMedicalAmount, \n\tDeductibleReimbursementAmount, \n\tPaidAllocatedLossAdjustmentExpenseAmount, \n\tIncurredAllocatedLossAdjustmentExpenseAmount, \n\tloss_condition, \n\tTypeOfSettlement, \n\tManagedCareOrganizationType, \n\tLumpSumIndicator, \n\tEstimatedAuditCode, \n\tCorrectionSeqNumber, \n\tClaimNumber, \n\tRateEffectiveDate1, \n\tMaxManualChargedRate, \n\tLossesSubjectToDeductibleCode, \n\tBasisOfDeductibleCalculationCode\n\tFROM Jnr_Premium_Policy_Count1\n\tWHERE -- This condition is being used to allow only the transactions that have a ClassCode of 0936 or the Max ManualCharge\r\nIIF(PremiumMasterClassCode='0936' OR ManualChargedRate=MaxManualChargedRate, TRUE, FALSE)\n),\nsort_split_period_code_NJ AS (\n\tSELECT\n\tSourceSystemId, \n\tEDWPremiumMasterCalculationPKId, \n\tEDWLossMasterCalculationPKId, \n\tTypeBureauCode, \n\tPremiumMasterRunDate, \n\tLossMasterRunDate, \n\tBureauCompanyCode, \n\tPolicyKey, \n\tStateProvinceCode, \n\tPolicyEffectiveDate, \n\tPolicyEndDate, \n\tInterstateRiskId, \n\tEmployeeLeasingCode, \n\tStateRatingEffectiveDate, \n\tFederalTaxId, \n\tThreeYearFixedRatePolicyIndicator, \n\tMultistatePolicyIndicator, \n\tInterstateRatedPolicyIndicator, \n\tRetrospectiveratedPolicyIndicator, \n\tCancelledMidTermPolicyIndicator, \n\tManagedCareOrganizationPolicyIndicator, \n\tTypeOfCoverageIdCode, \n\tTypeOfPlan, \n\tDeductibleAmountPerClaimAccident, \n\tInsuredName, \n\tWCSTATAddress, \n\tPremiumMasterClassCode, \n\tExperienceModificationFactor, \n\tExposure, \n\tPremiumMasterDirectWrittenPremiumAmount, \n\tManualChargedRate, \n\tLossMasterClassCode, \n\tClaimLossDate, \n\tClaimOccurrenceStatusCode, \n\tInjuryTypeCode, \n\tCatastropheCode, \n\tIncurredIndemnityAmount, \n\tIncurredMedicalAmount, \n\tCauseOfLoss, \n\tTypeOfRecoveryCode, \n\tJurisdictionStateCode, \n\tBodyPartCode, \n\tNatureOfInjuryCode, \n\tCauseOfInjuryCode, \n\tPaidIndemnityAmount, \n\tPaidMedicalAmount, \n\tDeductibleReimbursementAmount, \n\tPaidAllocatedLossAdjustmentExpenseAmount, \n\tIncurredAllocatedLossAdjustmentExpenseAmount, \n\tloss_condition, \n\tTypeOfSettlement, \n\tManagedCareOrganizationType, \n\tLumpSumIndicator, \n\tEstimatedAuditCode, \n\tCorrectionSeqNumber, \n\tClaimNumber, \n\tRateEffectiveDate1, \n\tExperienceModificationEffectiveDate, \n\tLossesSubjectToDeductibleCode, \n\tBasisOfDeductibleCalculationCode\n\tFROM Fil_NewJersey\n\tORDER BY TypeBureauCode ASC, BureauCompanyCode ASC, PolicyKey ASC, StateProvinceCode ASC, PolicyEffectiveDate ASC, PolicyEndDate ASC, PremiumMasterClassCode ASC, RateEffectiveDate1 ASC, ExperienceModificationEffectiveDate ASC\n),\nExp_SPlitPeriodCode_NJ AS (\n\tSELECT\n\tSourceSystemId,\n\tEDWPremiumMasterCalculationPKId,\n\tEDWLossMasterCalculationPKId,\n\tTypeBureauCode,\n\tPremiumMasterRunDate,\n\tLossMasterRunDate,\n\tBureauCompanyCode,\n\tPolicyKey,\n\tStateProvinceCode,\n\tPolicyEffectiveDate,\n\tPolicyEndDate,\n\tInterstateRiskId,\n\tEmployeeLeasingCode,\n\tStateRatingEffectiveDate,\n\tFederalTaxId,\n\tThreeYearFixedRatePolicyIndicator,\n\tMultistatePolicyIndicator,\n\tInterstateRatedPolicyIndicator,\n\tRetrospectiveratedPolicyIndicator,\n\tCancelledMidTermPolicyIndicator,\n\tManagedCareOrganizationPolicyIndicator,\n\tTypeOfCoverageIdCode,\n\tTypeOfPlan,\n\tDeductibleAmountPerClaimAccident,\n\tInsuredName,\n\tWCSTATAddress,\n\tPremiumMasterClassCode,\n\tExperienceModificationFactor,\n\tExposure,\n\tPremiumMasterDirectWrittenPremiumAmount,\n\tManualChargedRate,\n\tLossMasterClassCode,\n\tClaimLossDate,\n\tClaimOccurrenceStatusCode,\n\tInjuryTypeCode,\n\tCatastropheCode,\n\tIncurredIndemnityAmount,\n\tIncurredMedicalAmount,\n\tCauseOfLoss,\n\tTypeOfRecoveryCode,\n\tJurisdictionStateCode,\n\tBodyPartCode,\n\tNatureOfInjuryCode,\n\tCauseOfInjuryCode,\n\tPaidIndemnityAmount,\n\tPaidMedicalAmount,\n\tDeductibleReimbursementAmount,\n\tPaidAllocatedLossAdjustmentExpenseAmount,\n\tIncurredAllocatedLossAdjustmentExpenseAmount,\n\tloss_condition,\n\tTypeOfSettlement,\n\tManagedCareOrganizationType,\n\tLumpSumIndicator,\n\tEstimatedAuditCode,\n\tCorrectionSeqNumber,\n\tClaimNumber,\n\tRateEffectiveDate1,\n\tExperienceModificationEffectiveDate,\n\t-- *INF*: IIF(TypeBureauCode=V_Prev_TypeBureauCode and BureauCompanyCode=V_Prev_BureauCompanyCode and PolicyKey=V_Prev_PolicyKey and StateProvinceCode=V_Prev_StateProvinceCode and PolicyEffectiveDate=V_Prev_PolicyEffectiveDate and PolicyEndDate=V_Prev_PolicyEndDate and PremiumMasterClassCode=V_Prev_PremiumMasterClassCode  and SourceSystemId='DCT' and (RateEffectiveDate1>V_Prev_RateEffectiveDate OR ExperienceModificationEffectiveDate>V_Prev_ExperienceModificationEffectiveDate),V_SplitPeriodCode+1,0)\n\tIFF(\n\t    TypeBureauCode = V_Prev_TypeBureauCode\n\t    and BureauCompanyCode = V_Prev_BureauCompanyCode\n\t    and PolicyKey = V_Prev_PolicyKey\n\t    and StateProvinceCode = V_Prev_StateProvinceCode\n\t    and PolicyEffectiveDate = V_Prev_PolicyEffectiveDate\n\t    and PolicyEndDate = V_Prev_PolicyEndDate\n\t    and PremiumMasterClassCode = V_Prev_PremiumMasterClassCode\n\t    and SourceSystemId = 'DCT'\n\t    and (RateEffectiveDate1 > V_Prev_RateEffectiveDate\n\t    or ExperienceModificationEffectiveDate > V_Prev_ExperienceModificationEffectiveDate),\n\t    V_SplitPeriodCode + 1,\n\t    0\n\t) AS V_SplitPeriodCode,\n\tV_SplitPeriodCode AS O_SplitPeriodCode,\n\tTypeBureauCode AS V_Prev_TypeBureauCode,\n\tBureauCompanyCode AS V_Prev_BureauCompanyCode,\n\tPolicyKey AS V_Prev_PolicyKey,\n\tStateProvinceCode AS V_Prev_StateProvinceCode,\n\tPolicyEffectiveDate AS V_Prev_PolicyEffectiveDate,\n\tPolicyEndDate AS V_Prev_PolicyEndDate,\n\tPremiumMasterClassCode AS V_Prev_PremiumMasterClassCode,\n\tRateEffectiveDate1 AS V_Prev_RateEffectiveDate,\n\tExperienceModificationEffectiveDate AS V_Prev_ExperienceModificationEffectiveDate,\n\tLossesSubjectToDeductibleCode,\n\tBasisOfDeductibleCalculationCode\n\tFROM sort_split_period_code_NJ\n),\nUN_ALL_Premium_Loss AS (\n\tSELECT EDWPremiumMasterCalculationPKId, EDWLossMasterCalculationPKId, TypeBureauCode, PremiumMasterRunDate, LossMasterRunDate, BureauCompanyCode, PolicyKey, StateProvinceCode, PolicyEffectiveDate, PolicyEndDate, InterstateRiskId, EmployeeLeasingCode, StateRatingEffectiveDate, FederalTaxId, ThreeYearFixedRatePolicyIndicator, MultistatePolicyIndicator, InterstateRatedPolicyIndicator, RetrospectiveratedPolicyIndicator, CancelledMidTermPolicyIndicator, ManagedCareOrganizationPolicyIndicator, TypeOfCoverageIdCode, TypeOfPlan, DeductibleAmountPerClaimAccident, InsuredName, WCSTATAddress, PremiumMasterClassCode, ExperienceModificationFactor, ExperienceModificationEffectiveDate, Exposure, PremiumMasterDirectWrittenPremiumAmount, ManualChargedRate, LossMasterClassCode, ClaimLossDate, ClaimOccurrenceStatusCode, InjuryTypeCode, CatastropheCode, IncurredIndemnityAmount, IncurredMedicalAmount, CauseOfLoss, TypeOfRecoveryCode, JurisdictionStateCode, BodyPartCode, NatureOfInjuryCode, CauseOfInjuryCode, PaidIndemnityAmount, PaidMedicalAmount, DeductibleReimbursementAmount, PaidAllocatedLossAdjustmentExpenseAmount, IncurredAllocatedLossAdjustmentExpenseAmount, loss_condition, TypeOfSettlement, ManagedCareOrganizationType, LumpSumIndicator, EstimatedAuditCode, CorrectionSeqNumber, ClaimNumber, RateEffectiveDate1 AS RateEffectiveDate, O_SplitPeriodCode AS Split_Period_Code, LossesSubjectToDeductibleCode, BasisOfDeductibleCalculationCode\n\tFROM Exp_SPlitPeriodCode\n\tUNION\n\tSELECT o_EDWPremiumMasterCalculationPKId AS EDWPremiumMasterCalculationPKId, o_EDWLossMasterCalculationPKId AS EDWLossMasterCalculationPKId, TypeBureauCode, PremiumMasterRunDate, LossMasterRunDate, BureauCompanyCode, PolicyKey, StateProvinceCode, PolicyEffectiveDate, PolicyEndDate, InterstateRiskId, EmployeeLeasingCode, StateRatingEffectiveDate, FederalTaxId, ThreeYearFixedRatePolicyIndicator, MultistatePolicyIndicator, InterstateRatedPolicyIndicator, RetrospectiveratedPolicyIndicator, CancelledMidTermPolicyIndicator, ManagedCareOrganizationPolicyIndicator, TypeOfCoverageIdCode, TypeOfPlan, DeductibleAmountPerClaimAccident, InsuredName, WCSTATAddress, o_PremiumMasterClassCode AS PremiumMasterClassCode, ExperienceModificationFactor, o_ExperienceModificationEffectiveDate AS ExperienceModificationEffectiveDate, o_Exposure AS Exposure, o_PremiumMasterDirectWrittenPremiumAmount AS PremiumMasterDirectWrittenPremiumAmount, o_ManualChargedRate AS ManualChargedRate, LossMasterClassCode, ClaimLossDate, ClaimOccurrenceStatusCode, InjuryTypeCode, CatastropheCode, IncurredIndemnityAmount, IncurredMedicalAmount, CauseOfLoss, TypeOfRecoveryCode, JurisdictionStateCode, BodyPartCode, NatureOfInjuryCode, CauseOfInjuryCode, PaidIndemnityAmount, PaidMedicalAmount, DeductibleReimbursementAmount, PaidAllocatedLossAdjustmentExpenseAmount, IncurredAllocatedLossAdjustmentExpenseAmount, loss_condition, TypeOfSettlement, ManagedCareOrganizationType, LumpSumIndicator, EstimatedAuditCode, CorrectionSeqNumber, ClaimNumber, RateEffectiveDate, Split_Period_Code, LossesSubjectToDeductibleCode, BasisOfDeductibleCalculationCode\n\tFROM EXP_1111ClassCode\n\tUNION\n\tSELECT EDWPremiumMasterCalculationPKId, EDWLossMasterCalculationPKId, TypeBureauCode, PremiumMasterRunDate, LossMasterRunDate, BureauCompanyCode, PolicyKey, StateProvinceCode, PolicyEffectiveDate, PolicyEndDate, InterstateRiskId, EmployeeLeasingCode, StateRatingEffectiveDate, FederalTaxId, ThreeYearFixedRatePolicyIndicator, MultistatePolicyIndicator, InterstateRatedPolicyIndicator, RetrospectiveratedPolicyIndicator, CancelledMidTermPolicyIndicator, ManagedCareOrganizationPolicyIndicator, TypeOfCoverageIdCode, TypeOfPlan, DeductibleAmountPerClaimAccident, InsuredName, WCSTATAddress, PremiumMasterClassCode, ExperienceModificationFactor, ExperienceModificationEffectiveDate, Exposure, PremiumMasterDirectWrittenPremiumAmount, ManualChargedRate, LossMasterClassCode, ClaimLossDate, ClaimOccurrenceStatusCode, InjuryTypeCode, CatastropheCode, IncurredIndemnityAmount, IncurredMedicalAmount, CauseOfLoss, TypeOfRecoveryCode, JurisdictionStateCode, BodyPartCode, NatureOfInjuryCode, CauseOfInjuryCode, PaidIndemnityAmount, PaidMedicalAmount, DeductibleReimbursementAmount, PaidAllocatedLossAdjustmentExpenseAmount, IncurredAllocatedLossAdjustmentExpenseAmount, loss_condition, TypeOfSettlement, ManagedCareOrganizationType, LumpSumIndicator, EstimatedAuditCode, CorrectionSeqNumber, ClaimNumber, RateEffectiveDate1 AS RateEffectiveDate, O_SplitPeriodCode AS Split_Period_Code, LossesSubjectToDeductibleCode, BasisOfDeductibleCalculationCode\n\tFROM Exp_SPlitPeriodCode_NJ\n),\nSRT_AllRecords AS (\n\tSELECT\n\tEDWPremiumMasterCalculationPKId, \n\tEDWLossMasterCalculationPKId, \n\tTypeBureauCode, \n\tPremiumMasterRunDate, \n\tLossMasterRunDate, \n\tBureauCompanyCode, \n\tPolicyKey, \n\tStateProvinceCode, \n\tPolicyEffectiveDate, \n\tPolicyEndDate, \n\tInterstateRiskId, \n\tEmployeeLeasingCode, \n\tStateRatingEffectiveDate, \n\tFederalTaxId, \n\tThreeYearFixedRatePolicyIndicator, \n\tMultistatePolicyIndicator, \n\tInterstateRatedPolicyIndicator, \n\tRetrospectiveratedPolicyIndicator, \n\tCancelledMidTermPolicyIndicator, \n\tManagedCareOrganizationPolicyIndicator, \n\tTypeOfCoverageIdCode, \n\tTypeOfPlan, \n\tDeductibleAmountPerClaimAccident, \n\tInsuredName, \n\tWCSTATAddress, \n\tPremiumMasterClassCode, \n\tExperienceModificationFactor, \n\tExperienceModificationEffectiveDate, \n\tExposure, \n\tPremiumMasterDirectWrittenPremiumAmount, \n\tManualChargedRate, \n\tLossMasterClassCode, \n\tClaimLossDate, \n\tClaimOccurrenceStatusCode, \n\tInjuryTypeCode, \n\tCatastropheCode, \n\tIncurredIndemnityAmount, \n\tIncurredMedicalAmount, \n\tCauseOfLoss, \n\tTypeOfRecoveryCode, \n\tJurisdictionStateCode, \n\tBodyPartCode, \n\tNatureOfInjuryCode, \n\tCauseOfInjuryCode, \n\tPaidIndemnityAmount, \n\tPaidMedicalAmount, \n\tDeductibleReimbursementAmount, \n\tPaidAllocatedLossAdjustmentExpenseAmount, \n\tIncurredAllocatedLossAdjustmentExpenseAmount, \n\tloss_condition, \n\tTypeOfSettlement, \n\tManagedCareOrganizationType, \n\tLumpSumIndicator, \n\tEstimatedAuditCode, \n\tClaimNumber, \n\tClaimPayCategoryCode, \n\tclaimant_num, \n\tRateEffectiveDate, \n\tSplit_Period_Code, \n\tLossesSubjectToDeductibleCode, \n\tBasisOfDeductibleCalculationCode\n\tFROM UN_ALL_Premium_Loss\n\tORDER BY PolicyKey ASC\n),\nAGG_MaxExperienceModificationFactor AS (\n\tSELECT\n\tPolicyKey,\n\tExperienceModificationFactor,\n\tSplit_Period_Code,\n\t-- *INF*: MAX(ExperienceModificationFactor)\n\tMAX(ExperienceModificationFactor) AS o_MaxExperienceModificationFactor,\n\t-- *INF*: IIF(MAX(Split_Period_Code)<>'0', '1', '0')\n\tIFF(MAX(Split_Period_Code) <> '0', '1', '0') AS o_SplitPeriodCodeIndicator\n\tFROM SRT_AllRecords\n\tGROUP BY PolicyKey\n),\nFIL_SplitPeriodCode AS (\n\tSELECT\n\tPolicyKey, \n\tSplit_Period_Code, \n\tExperienceModificationFactor\n\tFROM SRT_AllRecords\n\tWHERE IIF(Split_Period_Code='0', TRUE, FALSE)\n),\nAGG_MaxModFactorSplitPolicyCode AS (\n\tSELECT\n\tPolicyKey,\n\tSplit_Period_Code,\n\tExperienceModificationFactor,\n\t-- *INF*: MAX(ExperienceModificationFactor)\n\tMAX(ExperienceModificationFactor) AS o_MaxModFactorSplitPolicyCode\n\tFROM FIL_SplitPeriodCode\n\tGROUP BY PolicyKey\n),\nJNR_AllRecordsAndAggregates AS (SELECT\n\tAGG_MaxExperienceModificationFactor.PolicyKey, \n\tAGG_MaxExperienceModificationFactor.o_MaxExperienceModificationFactor, \n\tAGG_MaxExperienceModificationFactor.o_SplitPeriodCodeIndicator, \n\tAGG_MaxModFactorSplitPolicyCode.PolicyKey AS PolicyKey1, \n\tAGG_MaxModFactorSplitPolicyCode.o_MaxModFactorSplitPolicyCode\n\tFROM AGG_MaxExperienceModificationFactor\n\tRIGHT OUTER JOIN AGG_MaxModFactorSplitPolicyCode\n\tON AGG_MaxModFactorSplitPolicyCode.PolicyKey = AGG_MaxExperienceModificationFactor.PolicyKey\n),\nJNRTRANS_AllRecordsAndMaxModFactor AS (SELECT\n\tSRT_AllRecords.EDWPremiumMasterCalculationPKId, \n\tSRT_AllRecords.EDWLossMasterCalculationPKId, \n\tSRT_AllRecords.TypeBureauCode, \n\tSRT_AllRecords.PremiumMasterRunDate, \n\tSRT_AllRecords.LossMasterRunDate, \n\tSRT_AllRecords.BureauCompanyCode, \n\tSRT_AllRecords.PolicyKey, \n\tSRT_AllRecords.StateProvinceCode, \n\tSRT_AllRecords.PolicyEffectiveDate, \n\tSRT_AllRecords.PolicyEndDate, \n\tSRT_AllRecords.InterstateRiskId, \n\tSRT_AllRecords.EmployeeLeasingCode, \n\tSRT_AllRecords.StateRatingEffectiveDate, \n\tSRT_AllRecords.FederalTaxId, \n\tSRT_AllRecords.ThreeYearFixedRatePolicyIndicator, \n\tSRT_AllRecords.MultistatePolicyIndicator, \n\tSRT_AllRecords.InterstateRatedPolicyIndicator, \n\tSRT_AllRecords.RetrospectiveratedPolicyIndicator, \n\tSRT_AllRecords.CancelledMidTermPolicyIndicator, \n\tSRT_AllRecords.ManagedCareOrganizationPolicyIndicator, \n\tSRT_AllRecords.TypeOfCoverageIdCode, \n\tSRT_AllRecords.TypeOfPlan, \n\tSRT_AllRecords.DeductibleAmountPerClaimAccident, \n\tSRT_AllRecords.InsuredName, \n\tSRT_AllRecords.WCSTATAddress, \n\tSRT_AllRecords.PremiumMasterClassCode, \n\tSRT_AllRecords.ExperienceModificationFactor, \n\tSRT_AllRecords.ExperienceModificationEffectiveDate, \n\tSRT_AllRecords.Exposure, \n\tSRT_AllRecords.PremiumMasterDirectWrittenPremiumAmount, \n\tSRT_AllRecords.ManualChargedRate, \n\tSRT_AllRecords.LossMasterClassCode, \n\tSRT_AllRecords.ClaimLossDate, \n\tSRT_AllRecords.ClaimOccurrenceStatusCode, \n\tSRT_AllRecords.InjuryTypeCode, \n\tSRT_AllRecords.CatastropheCode, \n\tSRT_AllRecords.IncurredIndemnityAmount, \n\tSRT_AllRecords.IncurredMedicalAmount, \n\tSRT_AllRecords.CauseOfLoss, \n\tSRT_AllRecords.TypeOfRecoveryCode, \n\tSRT_AllRecords.JurisdictionStateCode, \n\tSRT_AllRecords.BodyPartCode, \n\tSRT_AllRecords.NatureOfInjuryCode, \n\tSRT_AllRecords.CauseOfInjuryCode, \n\tSRT_AllRecords.PaidIndemnityAmount, \n\tSRT_AllRecords.PaidMedicalAmount, \n\tSRT_AllRecords.DeductibleReimbursementAmount, \n\tSRT_AllRecords.PaidAllocatedLossAdjustmentExpenseAmount, \n\tSRT_AllRecords.IncurredAllocatedLossAdjustmentExpenseAmount, \n\tSRT_AllRecords.loss_condition, \n\tSRT_AllRecords.TypeOfSettlement, \n\tSRT_AllRecords.ManagedCareOrganizationType, \n\tSRT_AllRecords.LumpSumIndicator, \n\tSRT_AllRecords.EstimatedAuditCode, \n\tSRT_AllRecords.ClaimNumber, \n\tSRT_AllRecords.ClaimPayCategoryCode, \n\tSRT_AllRecords.claimant_num, \n\tSRT_AllRecords.RateEffectiveDate, \n\tSRT_AllRecords.Split_Period_Code, \n\tSRT_AllRecords.LossesSubjectToDeductibleCode, \n\tSRT_AllRecords.BasisOfDeductibleCalculationCode, \n\tJNR_AllRecordsAndAggregates.PolicyKey AS PolicyKey1, \n\tJNR_AllRecordsAndAggregates.o_MaxExperienceModificationFactor AS MaxExperienceModificationFactor, \n\tJNR_AllRecordsAndAggregates.o_SplitPeriodCodeIndicator, \n\tJNR_AllRecordsAndAggregates.o_MaxModFactorSplitPolicyCode\n\tFROM SRT_AllRecords\n\tINNER JOIN JNR_AllRecordsAndAggregates\n\tON JNR_AllRecordsAndAggregates.PolicyKey = SRT_AllRecords.PolicyKey\n),\nEXP_Prem AS (\n\tSELECT\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t-- *INF*: TRUNC(SESSSTARTTIME,'D')\n\tCAST(TRUNC(SESSSTARTTIME, 'DAY') AS TIMESTAMP_NTZ(0)) AS o_CreateDate,\n\tEDWPremiumMasterCalculationPKId,\n\tEDWLossMasterCalculationPKId,\n\tTypeBureauCode,\n\tPremiumMasterRunDate,\n\tLossMasterRunDate,\n\tBureauCompanyCode,\n\tPolicyKey,\n\tStateProvinceCode,\n\tPolicyEffectiveDate AS i_PolicyEffectiveDate,\n\ti_PolicyEffectiveDate AS PolicyEffectiveDate,\n\tPolicyEndDate,\n\tInterstateRiskId,\n\tEmployeeLeasingCode,\n\tStateRatingEffectiveDate,\n\tFederalTaxId,\n\tThreeYearFixedRatePolicyIndicator,\n\tMultistatePolicyIndicator,\n\tInterstateRatedPolicyIndicator,\n\tEstimatedAuditCode,\n\tRetrospectiveratedPolicyIndicator,\n\tCancelledMidTermPolicyIndicator,\n\tManagedCareOrganizationPolicyIndicator,\n\tTypeOfCoverageIdCode,\n\tTypeOfPlan,\n\tClaimPayCategoryCode AS ClaimPayCategoryType,\n\tLossesSubjectToDeductibleCode,\n\tBasisOfDeductibleCalculationCode,\n\tDeductibleAmountPerClaimAccident,\n\tInsuredName AS i_InsuredName,\n\t-- *INF*: REPLACECHR(0,i_InsuredName,CHR(34),'')\n\tREGEXP_REPLACE(i_InsuredName,CHR(34),'','i') AS o_InsuredName,\n\tWCSTATAddress,\n\tPremiumMasterDirectWrittenPremiumAmount AS i_PremiumMasterDirectWrittenPremiumAmount,\n\t-- *INF*: ROUND(i_PremiumMasterDirectWrittenPremiumAmount)\n\tROUND(i_PremiumMasterDirectWrittenPremiumAmount) AS o_PremiumMasterDirectWrittenPremiumAmount,\n\tPremiumMasterClassCode,\n\tExperienceModificationFactor AS i_ExperienceModificationFactor,\n\t-- *INF*: -- This was the code here before the changes for US 448020\r\n\t-- --iif(i_PremiumMasterDirectWrittenPremiumAmount=0 AND i_ExperienceModificationFactor!=0 AND PremiumMasterClassCode <> '1111',\r\n\t-- --0,\r\n\t-- --i_ExperienceModificationFactor) \r\n\t-- \r\n\t-- \r\n\t-- -- The decode and logic was added for US 448020\r\n\t-- DECODE(TRUE,\r\n\t-- MultistatePolicyIndicator='0' AND StateProvinceCode='22' AND PremiumMasterClassCode='1111', 0,\r\n\t-- i_PremiumMasterDirectWrittenPremiumAmount=0 AND i_ExperienceModificationFactor!=0 AND PremiumMasterClassCode <> '1111',0,\r\n\t-- i_ExperienceModificationFactor<>0 AND PremiumMasterClassCode='1111' AND MultistatePolicyIndicator='1' AND IN(StateProvinceCode, '20'), 0,\r\n\t-- i_ExperienceModificationFactor=0 AND PremiumMasterClassCode='1111' AND MultistatePolicyIndicator='1' AND NOT IN(StateProvinceCode,'04','07','20','21','29','31','37','48') AND o_SplitPeriodCodeIndicator='1', MaxExpModFactorForSplitPeriodCode,\r\n\t-- i_ExperienceModificationFactor=0 AND PremiumMasterClassCode='1111' AND MultistatePolicyIndicator='1' AND NOT IN(StateProvinceCode,'04','07','20','21','29','31','37','48'),MaxExperienceModificationFactor,\r\n\t-- i_ExperienceModificationFactor)\n\tDECODE(\n\t    TRUE,\n\t    MultistatePolicyIndicator = '0' AND StateProvinceCode = '22' AND PremiumMasterClassCode = '1111', 0,\n\t    i_PremiumMasterDirectWrittenPremiumAmount = 0 AND i_ExperienceModificationFactor != 0 AND PremiumMasterClassCode <> '1111', 0,\n\t    i_ExperienceModificationFactor <> 0 AND PremiumMasterClassCode = '1111' AND MultistatePolicyIndicator = '1' AND StateProvinceCode IN ('20'), 0,\n\t    i_ExperienceModificationFactor = 0 AND PremiumMasterClassCode = '1111' AND MultistatePolicyIndicator = '1' AND NOT StateProvinceCode IN ('04','07','20','21','29','31','37','48') AND o_SplitPeriodCodeIndicator = '1', MaxExpModFactorForSplitPeriodCode,\n\t    i_ExperienceModificationFactor = 0 AND PremiumMasterClassCode = '1111' AND MultistatePolicyIndicator = '1' AND NOT StateProvinceCode IN ('04','07','20','21','29','31','37','48'), MaxExperienceModificationFactor,\n\t    i_ExperienceModificationFactor\n\t) AS v_ExperienceModificationFactor,\n\tv_ExperienceModificationFactor AS o_ExperienceModificationFactor,\n\tExperienceModificationEffectiveDate,\n\tExposure AS i_Exposure,\n\t-- *INF*: IIF(IN(SUBSTR(PremiumMasterClassCode,1,4) ,'0908','0913','9108'),(i_Exposure*10),i_Exposure)\n\tIFF(\n\t    SUBSTR(PremiumMasterClassCode, 1, 4) IN ('0908','0913','9108'), (i_Exposure * 10),\n\t    i_Exposure\n\t) AS v_Exposure,\n\t-- *INF*: ROUND(IIF(ISNULL(v_Exposure),0,v_Exposure))\n\tROUND(\n\t    IFF(\n\t        v_Exposure IS NULL, 0, v_Exposure\n\t    )) AS o_Exposure,\n\tManualChargedRate,\n\tLossMasterClassCode,\n\tClaimLossDate,\n\tClaimNumber,\n\tClaimOccurrenceStatusCode,\n\tInjuryTypeCode,\n\tCatastropheCode,\n\tIncurredIndemnityAmount,\n\tIncurredMedicalAmount,\n\tCauseOfLoss,\n\tTypeOfRecoveryCode,\n\tJurisdictionStateCode,\n\tBodyPartCode,\n\tNatureOfInjuryCode,\n\tCauseOfInjuryCode,\n\tPaidIndemnityAmount,\n\tPaidMedicalAmount,\n\tDeductibleReimbursementAmount,\n\tPaidAllocatedLossAdjustmentExpenseAmount,\n\tIncurredAllocatedLossAdjustmentExpenseAmount,\n\t'N/A' AS SubjectPremiumTotal,\n\t'N/A' AS StandarPremiumTotal,\n\t'0' AS CorrectionSeqNumber,\n\t'N' AS ReplacementReportCode,\n\t'' AS CorrectionTypeCode,\n\t'01' AS TypeOfNonStandardIdCode,\n\t-- *INF*: TO_INTEGER(DATE_DIFF(TRUNC(SYSDATE,'MM'),TRUNC(i_PolicyEffectiveDate,'MM'),'MM'),TRUE)\n\tCAST(DATEDIFF(MONTH,CAST(TRUNC(CURRENT_TIMESTAMP, 'MONTH') AS TIMESTAMP_NTZ(0)),CAST(TRUNC(i_PolicyEffectiveDate, 'MONTH') AS TIMESTAMP_NTZ(0))) AS INTEGER) AS v_AfterEffDate,\n\t-- *INF*: DECODE(v_AfterEffDate,\r\n\t-- 18,'1',\r\n\t-- 30,'2',\r\n\t-- 42,'3',\r\n\t-- 54,'4',\r\n\t-- 66,'5',\r\n\t-- 78,'6',\r\n\t-- 90,'7',\r\n\t-- 102,'8',\r\n\t-- 114,'9',\r\n\t-- 126,'A',\r\n\t-- '0')\n\tDECODE(\n\t    v_AfterEffDate,\n\t    18, '1',\n\t    30, '2',\n\t    42, '3',\n\t    54, '4',\n\t    66, '5',\n\t    78, '6',\n\t    90, '7',\n\t    102, '8',\n\t    114, '9',\n\t    126, 'A',\n\t    '0'\n\t) AS v_PreviousReportLevelCodeReportNumber,\n\tv_PreviousReportLevelCodeReportNumber AS PreviousReportLevelCodeReportNumber,\n\t'P' AS UpdateTypeCode,\n\tloss_condition AS TypeOfLoss,\n\t'01' AS TypeOfClaim,\n\tTypeOfSettlement,\n\tManagedCareOrganizationType,\n\t'N' AS VocationalRehabIndicator,\n\tLumpSumIndicator,\n\t'00' AS FraudulentClaimCode,\n\t-- *INF*: DECODE(TRUE, \r\n\t-- EDWPremiumMasterCalculationPKId != -1,'',\r\n\t-- IN(RTRIM(LTRIM(ClaimPayCategoryType)), 'DT'),'01',\r\n\t-- IN(RTRIM(LTRIM(ClaimPayCategoryType)), 'PT'),'02',\r\n\t-- StateProvinceCode = '21' AND IN(RTRIM(LTRIM(ClaimPayCategoryType)), 'PP','DF'),'03',\r\n\t-- StateProvinceCode <> '21' AND IN(RTRIM(LTRIM(ClaimPayCategoryType)), 'PP','DF','PB'),'09',\r\n\t-- StateProvinceCode = '21' AND IN(RTRIM(LTRIM(ClaimPayCategoryType)), 'PB'),'04',\r\n\t-- IN(RTRIM(LTRIM(ClaimPayCategoryType)), 'PD','TD','VR','SI','1B') AND IN(RTRIM(LTRIM(StateProvinceCode)), '22','48') AND DATE_DIFF(SYSDATE,i_PolicyEffectiveDate,'MM')  <= 30  AND  IncurredIndemnityAmount >  0 ,'05',\r\n\t-- IN(RTRIM(LTRIM(ClaimPayCategoryType)), 'PD','TD','VR') AND IN(RTRIM(LTRIM(StateProvinceCode)), '22','48') AND DATE_DIFF(SYSDATE,i_PolicyEffectiveDate,'MM')  > 30  and  IncurredIndemnityAmount  >  0,'09',\r\n\t-- IncurredMedicalAmount+IncurredIndemnityAmount = 0  and  IncurredAllocatedLossAdjustmentExpenseAmount > 0,'06',\r\n\t--  IncurredMedicalAmount>0 and   IncurredIndemnityAmount = 0,'06',\r\n\t-- IncurredIndemnityAmount>0,'05',\r\n\t-- '00'\r\n\t-- )\r\n\t-- \r\n\t-- \n\tDECODE(\n\t    TRUE,\n\t    EDWPremiumMasterCalculationPKId != - 1, '',\n\t    RTRIM(LTRIM(ClaimPayCategoryType)) IN ('DT'), '01',\n\t    RTRIM(LTRIM(ClaimPayCategoryType)) IN ('PT'), '02',\n\t    StateProvinceCode = '21' AND RTRIM(LTRIM(ClaimPayCategoryType)) IN ('PP','DF'), '03',\n\t    StateProvinceCode <> '21' AND RTRIM(LTRIM(ClaimPayCategoryType)) IN ('PP','DF','PB'), '09',\n\t    StateProvinceCode = '21' AND RTRIM(LTRIM(ClaimPayCategoryType)) IN ('PB'), '04',\n\t    RTRIM(LTRIM(ClaimPayCategoryType)) IN ('PD','TD','VR','SI','1B') AND RTRIM(LTRIM(StateProvinceCode)) IN ('22','48') AND DATEDIFF(MONTH,CURRENT_TIMESTAMP,i_PolicyEffectiveDate) <= 30 AND IncurredIndemnityAmount > 0, '05',\n\t    RTRIM(LTRIM(ClaimPayCategoryType)) IN ('PD','TD','VR') AND RTRIM(LTRIM(StateProvinceCode)) IN ('22','48') AND DATEDIFF(MONTH,CURRENT_TIMESTAMP,i_PolicyEffectiveDate) > 30 and IncurredIndemnityAmount > 0, '09',\n\t    IncurredMedicalAmount + IncurredIndemnityAmount = 0 and IncurredAllocatedLossAdjustmentExpenseAmount > 0, '06',\n\t    IncurredMedicalAmount > 0 and IncurredIndemnityAmount = 0, '06',\n\t    IncurredIndemnityAmount > 0, '05',\n\t    '00'\n\t) AS o_InjuryTypecode,\n\tclaimant_num AS i_claimant_num,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_claimant_num)\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_claimant_num) AS claimant_num,\n\tRateEffectiveDate,\n\t-- *INF*: iif(i_ExperienceModificationFactor=0 and Split_Period_Code='0',i_PolicyEffectiveDate,RateEffectiveDate)\n\tIFF(\n\t    i_ExperienceModificationFactor = 0 and Split_Period_Code = '0', i_PolicyEffectiveDate,\n\t    RateEffectiveDate\n\t) AS o_RateEffectiveDate,\n\tSplit_Period_Code,\n\t-- *INF*: iif(isnull(in_OccupationDescription),'N/A',in_OccupationDescription)\n\tIFF(in_OccupationDescription IS NULL, 'N/A', in_OccupationDescription) AS OccupationDescription,\n\t-- *INF*: iif(isnull(in_WeeklyWageAmount),0,in_WeeklyWageAmount)\n\tIFF(in_WeeklyWageAmount IS NULL, 0, in_WeeklyWageAmount) AS WeeklyWageAmount,\n\t-- *INF*: iif(isnull(in_EmployerAttorneyFees),0,in_EmployerAttorneyFees)\n\tIFF(in_EmployerAttorneyFees IS NULL, 0, in_EmployerAttorneyFees) AS EmployerAttorneyFees,\n\tMaxExperienceModificationFactor,\n\to_SplitPeriodCodeIndicator,\n\to_MaxModFactorSplitPolicyCode AS MaxExpModFactorForSplitPeriodCode\n\tFROM JNRTRANS_AllRecordsAndMaxModFactor\n),\nWorkWCSTATExtract AS (\n\n\t------------ PRE SQL ----------\n\t@{pipeline().parameters.DELETE_PRESQL}\n\t-------------------------------\n\n\n\tINSERT INTO WorkWCSTATExtract\n\t(AuditId, CreatedDate, EDWPremiumMasterCalculationPKId, EDWLossMasterCalculationPKId, TypeBureauCode, PremiumMasterRunDate, LossMasterRunDate, BureauCompanyCode, PolicyKey, StateProvinceCode, PolicyEffectiveDate, PolicyEndDate, InterstateRiskId, EmployeeLeasingCode, StateRatingEffectiveDate, FederalTaxId, ThreeYearFixedRatePolicyIndicator, MultistatePolicyIndicator, InterstateRatedPolicyIndicator, EstimatedAuditCode, RetrospectiveratedPolicyIndicator, CancelledMidTermPolicyIndicator, ManagedCareOrganizationPolicyIndicator, TypeOfCoverageIdCode, TypeOfPlan, LossSubjectToDeductibleCode, BasisOfDeductibleCalculationCode, DeductibleAmountPerClaimAccident, InsuredName, WCSTATAddress, PremiumMasterClassCode, ExperienceModificationFactor, ExperienceModificationEffectiveDate, Exposure, PremiumMasterDirectWrittenPremiumAmount, ManualChargedRate, LossMasterClassCode, ClaimLossDate, ClaimNumber, ClaimOccurrenceStatusCode, InjuryTypeCode, CatastropheCode, IncurredIndemnityAmount, IncurredMedicalAmount, CauseOfLoss, TypeOfRecoveryCode, JurisdictionStateCode, BodyPartCode, NatureOfInjuryCode, CauseOfInjuryCode, PaidIndemnityAmount, PaidMedicalAmount, DeductibleReimbursementAmount, PaidAllocatedLossAdjustmentExpenseAmount, IncurredAllocatedLossAdjustmentExpenseAmount, SubjectPremiumTotal, StandarPremiumTotal, CorrectionSeqNumber, ReplacementReportCode, CorrectionTypeCode, TypeOfNonStandardIdCode, PreviousReportLevelCodeReportNumber, UpdateTypeCode, TypeOfLoss, TypeOfClaim, TypeOfSettlement, ManagedCareOrganizationType, VocationalRehabIndicator, LumpSumIndicator, FraudulentClaimCode, ClaimantNumber, RateEffectiveDate, SplitPeriodCode, OccupationDescription, WeeklyWageAmount, EmployerAttorneyFees)\n\tSELECT \n\to_AuditID AS AUDITID, \n\to_CreateDate AS CREATEDDATE, \n\tEDWPREMIUMMASTERCALCULATIONPKID, \n\tEDWLOSSMASTERCALCULATIONPKID, \n\tTYPEBUREAUCODE, \n\tPREMIUMMASTERRUNDATE, \n\tLOSSMASTERRUNDATE, \n\tBUREAUCOMPANYCODE, \n\tPOLICYKEY, \n\tSTATEPROVINCECODE, \n\tPOLICYEFFECTIVEDATE, \n\tPOLICYENDDATE, \n\tINTERSTATERISKID, \n\tEMPLOYEELEASINGCODE, \n\tSTATERATINGEFFECTIVEDATE, \n\tFEDERALTAXID, \n\tTHREEYEARFIXEDRATEPOLICYINDICATOR, \n\tMULTISTATEPOLICYINDICATOR, \n\tINTERSTATERATEDPOLICYINDICATOR, \n\tESTIMATEDAUDITCODE, \n\tRETROSPECTIVERATEDPOLICYINDICATOR, \n\tCANCELLEDMIDTERMPOLICYINDICATOR, \n\tMANAGEDCAREORGANIZATIONPOLICYINDICATOR, \n\tTYPEOFCOVERAGEIDCODE, \n\tTYPEOFPLAN, \n\tLossesSubjectToDeductibleCode AS LOSSSUBJECTTODEDUCTIBLECODE, \n\tBASISOFDEDUCTIBLECALCULATIONCODE, \n\tDEDUCTIBLEAMOUNTPERCLAIMACCIDENT, \n\to_InsuredName AS INSUREDNAME, \n\tWCSTATADDRESS, \n\tPREMIUMMASTERCLASSCODE, \n\to_ExperienceModificationFactor AS EXPERIENCEMODIFICATIONFACTOR, \n\tEXPERIENCEMODIFICATIONEFFECTIVEDATE, \n\to_Exposure AS EXPOSURE, \n\to_PremiumMasterDirectWrittenPremiumAmount AS PREMIUMMASTERDIRECTWRITTENPREMIUMAMOUNT, \n\tMANUALCHARGEDRATE, \n\tLOSSMASTERCLASSCODE, \n\tCLAIMLOSSDATE, \n\tCLAIMNUMBER, \n\tCLAIMOCCURRENCESTATUSCODE, \n\to_InjuryTypecode AS INJURYTYPECODE, \n\tCATASTROPHECODE, \n\tINCURREDINDEMNITYAMOUNT, \n\tINCURREDMEDICALAMOUNT, \n\tCAUSEOFLOSS, \n\tTYPEOFRECOVERYCODE, \n\tJURISDICTIONSTATECODE, \n\tBODYPARTCODE, \n\tNATUREOFINJURYCODE, \n\tCAUSEOFINJURYCODE, \n\tPAIDINDEMNITYAMOUNT, \n\tPAIDMEDICALAMOUNT, \n\tDEDUCTIBLEREIMBURSEMENTAMOUNT, \n\tPAIDALLOCATEDLOSSADJUSTMENTEXPENSEAMOUNT, \n\tINCURREDALLOCATEDLOSSADJUSTMENTEXPENSEAMOUNT, \n\tSUBJECTPREMIUMTOTAL, \n\tSTANDARPREMIUMTOTAL, \n\tCORRECTIONSEQNUMBER, \n\tREPLACEMENTREPORTCODE, \n\tCORRECTIONTYPECODE, \n\tTYPEOFNONSTANDARDIDCODE, \n\tPREVIOUSREPORTLEVELCODEREPORTNUMBER, \n\tUPDATETYPECODE, \n\tTYPEOFLOSS, \n\tTYPEOFCLAIM, \n\tTYPEOFSETTLEMENT, \n\tMANAGEDCAREORGANIZATIONTYPE, \n\tVOCATIONALREHABINDICATOR, \n\tLUMPSUMINDICATOR, \n\tFRAUDULENTCLAIMCODE, \n\tclaimant_num AS CLAIMANTNUMBER, \n\to_RateEffectiveDate AS RATEEFFECTIVEDATE, \n\tSplit_Period_Code AS SPLITPERIODCODE, \n\tOCCUPATIONDESCRIPTION, \n\tWEEKLYWAGEAMOUNT, \n\tEMPLOYERATTORNEYFEES\n\tFROM EXP_Prem\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "0": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "DELETE_PRESQL": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "PolicyDataServices/"
        },
        "annotations": []
    }
}