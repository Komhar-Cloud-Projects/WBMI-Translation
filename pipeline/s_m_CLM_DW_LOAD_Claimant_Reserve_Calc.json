{
    "name": "s_m_CLM_DW_LOAD_Claimant_Reserve_Calc",
    "properties": {
        "activities": [
            {
                "name": "m_CLM_DW_LOAD_Claimant_Reserve_Calc",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_claimant_coverage_detail AS (\n\tSELECT claimant_coverage_detail.claimant_cov_det_ak_id, claimant_coverage_detail.claim_party_occurrence_ak_id \r\n\tFROM claimant_coverage_detail\r\n\tWHERE claimant_coverage_detail.crrnt_snpsht_flag = 1  \r\n\tORDER BY claimant_coverage_detail.claim_party_occurrence_ak_id\n),\nSQ_claimant_coverage_detail_reserve_calculation AS (\n\tSELECT  a.claimant_cov_det_ak_id, a.financial_type_code, a.reserve_date, a.reserve_date_type, a.source_sys_id\r\n\tFROM  dbo.claimant_coverage_detail_reserve_calculation a \r\n\tWHERE a.claimant_cov_det_ak_id IN\r\n\t(SELECT claimant_cov_det_ak_id from claimant_coverage_detail where claim_party_occurrence_ak_id in (\r\n\t(SELECT  d.claim_party_occurrence_ak_id FROM claimant_coverage_detail_reserve_calculation c\r\n\tINNER JOIN claimant_coverage_detail d on c.claimant_cov_det_ak_id=d.claimant_cov_det_ak_id\r\n\t                         WHERE      c.created_date >= '@{pipeline().parameters.SELECTION_START_TS}')))\r\n\t\r\n\t--- 7/6/2009 - For a coverage that has any change, we need to get the corresponding claimant and then we get all the coverages --- for that claimant.\r\n\t\r\n\t\r\n\t--SELECT    a.claimant_cov_det_ak_id, a.financial_type_code, \r\n\t   ---                   a.reserve_date, a.reserve_date_type, a.source_sys_id\r\n\t----FROM         dbo.claimant_coverage_detail_reserve_calculation a \r\n\t---WHERE a.claimant_cov_det_ak_id IN\r\n\t    ---                  (SELECT     c.claimant_cov_det_ak_id\r\n\t        ---                FROM          claimant_coverage_detail_reserve_calculation c\r\n\t            -----             WHERE      c.created_date >= '@{pipeline().parameters.SELECTION_START_TS}')\n),\nJNR_Coverage_Reserve_Coverage_detail AS (SELECT\n\tSQ_claimant_coverage_detail.claimant_cov_det_ak_id, \n\tSQ_claimant_coverage_detail.claim_party_occurrence_ak_id, \n\tSQ_claimant_coverage_detail_reserve_calculation.claimant_cov_det_ak_id AS claimant_cov_det_ak_id1, \n\tSQ_claimant_coverage_detail_reserve_calculation.financial_type_code, \n\tSQ_claimant_coverage_detail_reserve_calculation.reserve_date, \n\tSQ_claimant_coverage_detail_reserve_calculation.reserve_date_type, \n\tSQ_claimant_coverage_detail_reserve_calculation.source_sys_id\n\tFROM SQ_claimant_coverage_detail_reserve_calculation\n\tINNER JOIN SQ_claimant_coverage_detail\n\tON SQ_claimant_coverage_detail.claimant_cov_det_ak_id = SQ_claimant_coverage_detail_reserve_calculation.claimant_cov_det_ak_id\n),\nSRT_Coverage_Reserve AS (\n\tSELECT\n\tclaim_party_occurrence_ak_id, \n\tclaimant_cov_det_ak_id1, \n\treserve_date, \n\tfinancial_type_code, \n\treserve_date_type, \n\tsource_sys_id\n\tFROM JNR_Coverage_Reserve_Coverage_detail\n\tORDER BY claim_party_occurrence_ak_id ASC, reserve_date ASC, financial_type_code ASC, reserve_date_type ASC\n),\nEXP_default AS (\n\tSELECT\n\tclaim_party_occurrence_ak_id,\n\tclaimant_cov_det_ak_id1 AS claimant_cov_det_ak_id,\n\tfinancial_type_code,\n\treserve_date,\n\treserve_date_type,\n\tsource_sys_id\n\tFROM SRT_Coverage_Reserve\n),\nLKP_Work_Claimant_Reserve_Calculation AS (\n\tSELECT\n\tNewLookupRow,\n\twork_claimant_reserve_calculation_id,\n\tclaim_party_occurrence_ak_id,\n\tclaimant_cov_det_ak_id,\n\tfinancial_type_code,\n\treserve_date,\n\treserve_date_type,\n\tsource_sys_id,\n\tIN_claim_party_occurrence_ak_id,\n\tIN_claimant_cov_det_ak_id,\n\tIN_financial_type_code,\n\tIN_reserve_date,\n\tIN_reserve_date_type,\n\tIN_source_sys_id\n\tFROM (\n\t\tSELECT \n\t\t\tNewLookupRow,\n\t\t\twork_claimant_reserve_calculation_id,\n\t\t\tclaim_party_occurrence_ak_id,\n\t\t\tclaimant_cov_det_ak_id,\n\t\t\tfinancial_type_code,\n\t\t\treserve_date,\n\t\t\treserve_date_type,\n\t\t\tsource_sys_id,\n\t\t\tIN_claim_party_occurrence_ak_id,\n\t\t\tIN_claimant_cov_det_ak_id,\n\t\t\tIN_financial_type_code,\n\t\t\tIN_reserve_date,\n\t\t\tIN_reserve_date_type,\n\t\t\tIN_source_sys_id\n\t\tFROM work_claimant_reserve_calculation\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_party_occurrence_ak_id,claimant_cov_det_ak_id,financial_type_code ORDER BY NewLookupRow) = 1\n),\nEXP_detect_insert_update AS (\n\tSELECT\n\tNewLookupRow,\n\tclaim_party_occurrence_ak_id,\n\tclaimant_cov_det_ak_id,\n\tfinancial_type_code,\n\treserve_date,\n\treserve_date_type,\n\tsource_sys_id,\n\t-- *INF*: IIF(claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id ,'OLD','NEW')\n\tIFF(claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id, 'OLD', 'NEW') AS v_claimant,\n\tv_claimant AS v_claimant_out,\n\t-- *INF*: IIF(v_claimant ='NEW', 'TRUNCATE' ,DECODE(NewLookupRow,1,'INSERT',\r\n\t--                                                        \t                                                                                   2,'UPDATE',\r\n\t-- \t                                                                                                                                0,'NOCHANGE'))\n\tIFF(\n\t    v_claimant = 'NEW', 'TRUNCATE',\n\t    DECODE(\n\t        NewLookupRow,\n\t        1, 'INSERT',\n\t        2, 'UPDATE',\n\t        0, 'NOCHANGE'\n\t    )\n\t) AS V_SQL,\n\tV_SQL AS OUT_SQL,\n\tclaim_party_occurrence_ak_id AS v_prev_row_claim_party_occurrence_ak_id\n\tFROM LKP_Work_Claimant_Reserve_Calculation\n),\nFIL_INSERT_UPDATE AS (\n\tSELECT\n\tclaim_party_occurrence_ak_id, \n\tclaimant_cov_det_ak_id, \n\tfinancial_type_code, \n\treserve_date, \n\treserve_date_type, \n\tsource_sys_id, \n\tOUT_SQL\n\tFROM EXP_detect_insert_update\n\tWHERE OUT_SQL != 'NOCHANGE'\n),\nproc_work_claimant_reserve_calculation AS (\n),\nEXP_Inserts_Noninserts AS (\n\tSELECT\n\tclaim_party_occurrence_ak_id,\n\tclaimant_cov_det_ak_id,\n\tfinancial_type_code,\n\treserve_date,\n\treserve_date_type,\n\tsource_sys_id,\n\tcount_coverages,\n\tcount_open_reopen,\n\tcount_notice_only,\n\t-- *INF*: IIF(claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id, IIF(financial_type_code = 'D' AND v_claimant_D_old = 'NEW' or v_claimant_D_old = 'OLD', 'OLD', 'NEW' ), IIF(financial_type_code = 'D', 'NEW', 'NA'))\r\n\t-- \n\tIFF(\n\t    claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id,\n\t    IFF(\n\t        financial_type_code = 'D'\n\t    and v_claimant_D_old = 'NEW'\n\t    or v_claimant_D_old = 'OLD',\n\t        'OLD',\n\t        'NEW'\n\t    ),\n\t    IFF(\n\t        financial_type_code = 'D', 'NEW', 'NA'\n\t    )\n\t) AS v_claimant_D,\n\tv_claimant_D AS v_claimant_D_old,\n\t-- *INF*: IIF(claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id, IIF(financial_type_code = 'E' AND v_claimant_E_old = 'NEW' or v_claimant_E_old = 'OLD', 'OLD' , 'NEW'), IIF(financial_type_code = 'E', 'NEW', 'NA'))\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- --IIF(claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id, IIF(financial_type_code = 'D' AND v_claimant_D_old = 'NEW' or v_claimant_D_old = 'OLD', 'OLD', 'NEW' ), IIF(financial_type_code = 'D', 'NEW', 'NA'))\n\tIFF(\n\t    claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id,\n\t    IFF(\n\t        financial_type_code = 'E'\n\t    and v_claimant_E_old = 'NEW'\n\t    or v_claimant_E_old = 'OLD',\n\t        'OLD',\n\t        'NEW'\n\t    ),\n\t    IFF(\n\t        financial_type_code = 'E', 'NEW', 'NA'\n\t    )\n\t) AS v_claimant_E,\n\tv_claimant_E AS v_claimant_E_old,\n\t-- *INF*: IIF(claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id, IIF(financial_type_code = 'S' AND v_claimant_S_old = 'NEW' or v_claimant_S_old = 'OLD', 'OLD' , 'NEW'), IIF(financial_type_code = 'S', 'NEW', 'NA'))\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- --IIF(claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id, IIF(financial_type_code = 'S' AND v_claimant_S_old = 'NEW' or v_claimant_S_old = 'OLD', 'OLD' ), 'NEW')\n\tIFF(\n\t    claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id,\n\t    IFF(\n\t        financial_type_code = 'S'\n\t    and v_claimant_S_old = 'NEW'\n\t    or v_claimant_S_old = 'OLD',\n\t        'OLD',\n\t        'NEW'\n\t    ),\n\t    IFF(\n\t        financial_type_code = 'S', 'NEW', 'NA'\n\t    )\n\t) AS v_claimant_S,\n\tv_claimant_S AS v_claimant_S_old,\n\t-- *INF*: IIF(claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id, IIF(financial_type_code = 'B' AND v_claimant_B_old = 'NEW' or v_claimant_B_old = 'OLD', 'OLD' , 'NEW'), IIF(financial_type_code = 'B', 'NEW', 'NA'))\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- --IIF(claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id, IIF(financial_type_code = 'B' AND v_claimant_B_old = 'NEW' or v_claimant_B_old = 'OLD', 'OLD' ), 'NEW')\n\tIFF(\n\t    claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id,\n\t    IFF(\n\t        financial_type_code = 'B'\n\t    and v_claimant_B_old = 'NEW'\n\t    or v_claimant_B_old = 'OLD',\n\t        'OLD',\n\t        'NEW'\n\t    ),\n\t    IFF(\n\t        financial_type_code = 'B', 'NEW', 'NA'\n\t    )\n\t) AS v_claimant_B,\n\tv_claimant_B AS v_claimant_B_old,\n\t-- *INF*: IIF(claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id, IIF(financial_type_code = 'R' AND v_claimant_R_old = 'NEW' or v_claimant_R_old = 'OLD', 'OLD' , 'NEW'), IIF(financial_type_code = 'R', 'NEW', 'NA'))\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- --IIF(claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id, IIF(financial_type_code = 'R' AND v_claimant_R_old = 'NEW' or v_claimant_R_old = 'OLD', 'OLD' ), 'NEW')\n\tIFF(\n\t    claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id,\n\t    IFF(\n\t        financial_type_code = 'R'\n\t    and v_claimant_R_old = 'NEW'\n\t    or v_claimant_R_old = 'OLD',\n\t        'OLD',\n\t        'NEW'\n\t    ),\n\t    IFF(\n\t        financial_type_code = 'R', 'NEW', 'NA'\n\t    )\n\t) AS v_claimant_R,\n\tv_claimant_R AS v_claimant_R_old,\n\t-- *INF*: IIF(v_claimant_D='NEW',IIF(financial_type_code = 'D', reserve_date_type, 'NA'), IIF(financial_type_code = 'D',reserve_date_type, v_claimant_fin_type_D_old))\r\n\t-- \r\n\t-- \r\n\t-- --IIF(v_claimant_D='NEW',IIF(financial_type_code = 'D', reserve_date_type, 'NA'), IIF(financial_type_code = 'D',v_claimant_fin_type_D_old))\n\tIFF(\n\t    v_claimant_D = 'NEW',\n\t    IFF(\n\t        financial_type_code = 'D', reserve_date_type, 'NA'\n\t    ),\n\t    IFF(\n\t        financial_type_code = 'D', reserve_date_type, v_claimant_fin_type_D_old\n\t    )\n\t) AS v_claimant_fin_type_D,\n\tv_claimant_fin_type_D AS v_claimant_fin_type_D_old,\n\t-- *INF*: IIF(v_claimant_E='NEW',IIF(financial_type_code='E',reserve_date_type,'NA'),IIF(financial_type_code = 'E', reserve_date_type, v_claimant_fin_type_E_old))\r\n\t-- \r\n\t-- \r\n\t-- --IIF(v_claimant='NEW',IIF(financial_type_code='E',reserve_date_type,'NA'),IIF(financial_type_code = 'E', v_claimant_fin_type_E_old))\n\tIFF(\n\t    v_claimant_E = 'NEW',\n\t    IFF(\n\t        financial_type_code = 'E', reserve_date_type, 'NA'\n\t    ),\n\t    IFF(\n\t        financial_type_code = 'E', reserve_date_type, v_claimant_fin_type_E_old\n\t    )\n\t) AS v_claimant_fin_type_E,\n\tv_claimant_fin_type_E AS v_claimant_fin_type_E_old,\n\t-- *INF*: IIF(v_claimant_S='NEW',IIF(financial_type_code='S',reserve_date_type,'NA'),IIF(financial_type_code = 'S', reserve_date_type, v_claimant_fin_type_S_old))\n\tIFF(\n\t    v_claimant_S = 'NEW',\n\t    IFF(\n\t        financial_type_code = 'S', reserve_date_type, 'NA'\n\t    ),\n\t    IFF(\n\t        financial_type_code = 'S', reserve_date_type, v_claimant_fin_type_S_old\n\t    )\n\t) AS v_claimant_fin_type_S,\n\tv_claimant_fin_type_S AS v_claimant_fin_type_S_old,\n\t-- *INF*: IIF(v_claimant_B='NEW',IIF(financial_type_code='B',reserve_date_type,'NA'),IIF(financial_type_code = 'B', reserve_date_type, v_claimant_fin_type_B_old))\n\tIFF(\n\t    v_claimant_B = 'NEW',\n\t    IFF(\n\t        financial_type_code = 'B', reserve_date_type, 'NA'\n\t    ),\n\t    IFF(\n\t        financial_type_code = 'B', reserve_date_type, v_claimant_fin_type_B_old\n\t    )\n\t) AS v_claimant_fin_type_B,\n\tv_claimant_fin_type_B AS v_claimant_fin_type_B_old,\n\t-- *INF*: IIF(v_claimant_R='NEW',IIF(financial_type_code='R',reserve_date_type,'NA'),IIF(financial_type_code = 'R', reserve_date_type, v_claimant_fin_type_R_old))\n\tIFF(\n\t    v_claimant_R = 'NEW',\n\t    IFF(\n\t        financial_type_code = 'R', reserve_date_type, 'NA'\n\t    ),\n\t    IFF(\n\t        financial_type_code = 'R', reserve_date_type, v_claimant_fin_type_R_old\n\t    )\n\t) AS v_claimant_fin_type_R,\n\tv_claimant_fin_type_R AS v_claimant_fin_type_R_old,\n\t-- *INF*: IIF(financial_type_code='D',IIF(count_coverages = count_notice_only,'1NOTICEONLY',IIF(count_open_reopen>=1,'2OPEN','3CLOSED')),IIF(v_claimant_D = 'OLD' OR v_claimant_D = 'NEW'  ,v_claimant_overall_status_old_D))\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(\n\t    financial_type_code = 'D',\n\t    IFF(\n\t        count_coverages = count_notice_only, '1NOTICEONLY',\n\t        IFF(\n\t            count_open_reopen >= 1, '2OPEN', '3CLOSED'\n\t        )\n\t    ),\n\t    IFF(\n\t        v_claimant_D = 'OLD' OR v_claimant_D = 'NEW', v_claimant_overall_status_old_D\n\t    )\n\t) AS v_claimant_overall_status_crrnt_D,\n\t-- *INF*: IIF(financial_type_code='E',IIF(count_coverages = count_notice_only,'1NOTICEONLY',IIF(count_open_reopen>=1,'2OPEN','3CLOSED')),IIF(v_claimant_E = 'OLD' OR v_claimant_E = 'NEW' ,v_claimant_overall_status_old_E))\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(\n\t    financial_type_code = 'E',\n\t    IFF(\n\t        count_coverages = count_notice_only, '1NOTICEONLY',\n\t        IFF(\n\t            count_open_reopen >= 1, '2OPEN', '3CLOSED'\n\t        )\n\t    ),\n\t    IFF(\n\t        v_claimant_E = 'OLD' OR v_claimant_E = 'NEW', v_claimant_overall_status_old_E\n\t    )\n\t) AS v_claimant_overall_status_crrnt_E,\n\t-- *INF*: IIF(financial_type_code='S',IIF(count_coverages = count_notice_only,'1NOTICEONLY',IIF(count_open_reopen>=1,'2OPEN','3CLOSED')),IIF(v_claimant_S = 'OLD' OR v_claimant_S = 'NEW' ,v_claimant_overall_status_old_S))\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(\n\t    financial_type_code = 'S',\n\t    IFF(\n\t        count_coverages = count_notice_only, '1NOTICEONLY',\n\t        IFF(\n\t            count_open_reopen >= 1, '2OPEN', '3CLOSED'\n\t        )\n\t    ),\n\t    IFF(\n\t        v_claimant_S = 'OLD' OR v_claimant_S = 'NEW', v_claimant_overall_status_old_S\n\t    )\n\t) AS v_claimant_overall_status_crrnt_S,\n\t-- *INF*: IIF(financial_type_code='B',IIF(count_coverages = count_notice_only,'1NOTICEONLY',IIF(count_open_reopen>=1,'2OPEN','3CLOSED')),IIF(v_claimant_B = 'OLD' OR v_claimant_B = 'NEW' ,v_claimant_overall_status_old_B))\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(\n\t    financial_type_code = 'B',\n\t    IFF(\n\t        count_coverages = count_notice_only, '1NOTICEONLY',\n\t        IFF(\n\t            count_open_reopen >= 1, '2OPEN', '3CLOSED'\n\t        )\n\t    ),\n\t    IFF(\n\t        v_claimant_B = 'OLD' OR v_claimant_B = 'NEW', v_claimant_overall_status_old_B\n\t    )\n\t) AS v_claimant_overall_status_crrnt_B,\n\t-- *INF*: IIF(financial_type_code='R',IIF(count_coverages = count_notice_only,'1NOTICEONLY',IIF(count_open_reopen>=1,'2OPEN','3CLOSED')),IIF(v_claimant_R = 'OLD' OR v_claimant_R = 'NEW' ,v_claimant_overall_status_old_R))\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(\n\t    financial_type_code = 'R',\n\t    IFF(\n\t        count_coverages = count_notice_only, '1NOTICEONLY',\n\t        IFF(\n\t            count_open_reopen >= 1, '2OPEN', '3CLOSED'\n\t        )\n\t    ),\n\t    IFF(\n\t        v_claimant_R = 'OLD' OR v_claimant_R = 'NEW', v_claimant_overall_status_old_R\n\t    )\n\t) AS v_claimant_overall_status_crrnt_R,\n\t-- *INF*: IIF(claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id, \r\n\t-- \r\n\t-- IIF(financial_type_code = 'D', IIF(v_claimant_D = 'NEW', 'INSERT', IIF(v_claimant_overall_status_crrnt_D = v_claimant_overall_status_old_D, 'NOCHANGE', 'INSERT')), \r\n\t-- IIF(financial_type_code = 'E', IIF(v_claimant_E = 'NEW', 'INSERT', IIF(v_claimant_overall_status_crrnt_E = v_claimant_overall_status_old_E, 'NOCHANGE', 'INSERT')), \r\n\t-- IIF(financial_type_code = 'S', IIF(v_claimant_S = 'NEW', 'INSERT', IIF(v_claimant_overall_status_crrnt_S = v_claimant_overall_status_old_S, 'NOCHANGE', 'INSERT')),\r\n\t-- IIF(financial_type_code = 'B', IIF(v_claimant_B = 'NEW', 'INSERT', IIF(v_claimant_overall_status_crrnt_B = v_claimant_overall_status_old_B, 'NOCHANGE', 'INSERT')), \r\n\t-- IIF(financial_type_code = 'R', IIF(v_claimant_R = 'NEW', 'INSERT', IIF(v_claimant_overall_status_crrnt_R = v_claimant_overall_status_old_R, 'NOCHANGE', 'INSERT'))\r\n\t-- ))))),'INSERT')\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(\n\t    claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id,\n\t    IFF(\n\t        financial_type_code = 'D',\n\t        IFF(\n\t            v_claimant_D = 'NEW', 'INSERT',\n\t            IFF(\n\t                v_claimant_overall_status_crrnt_D = v_claimant_overall_status_old_D,\n\t                'NOCHANGE',\n\t                'INSERT'\n\t            )\n\t        ),\n\t        IFF(\n\t            financial_type_code = 'E',\n\t            IFF(\n\t                v_claimant_E = 'NEW', 'INSERT',\n\t                IFF(\n\t                    v_claimant_overall_status_crrnt_E = v_claimant_overall_status_old_E,\n\t                    'NOCHANGE',\n\t                    'INSERT'\n\t                )\n\t            ),\n\t            IFF(\n\t                financial_type_code = 'S',\n\t                IFF(\n\t                    v_claimant_S = 'NEW', 'INSERT',\n\t                    IFF(\n\t                        v_claimant_overall_status_crrnt_S = v_claimant_overall_status_old_S,\n\t                        'NOCHANGE',\n\t                        'INSERT'\n\t                    )\n\t                ),\n\t                IFF(\n\t                    financial_type_code = 'B',\n\t                    IFF(\n\t                        v_claimant_B = 'NEW', 'INSERT',\n\t                        IFF(\n\t                            v_claimant_overall_status_crrnt_B = v_claimant_overall_status_old_B,\n\t                            'NOCHANGE',\n\t                            'INSERT'\n\t                        )\n\t                    ),\n\t                    IFF(\n\t                        financial_type_code = 'R',\n\t                        IFF(\n\t                            v_claimant_R = 'NEW', 'INSERT',\n\t                            IFF(\n\t                                v_claimant_overall_status_crrnt_R = v_claimant_overall_status_old_R,\n\t                                'NOCHANGE',\n\t                                'INSERT'\n\t                            )\n\t                        )\n\t                    )\n\t                )\n\t            )\n\t        )\n\t    ),\n\t    'INSERT'\n\t) AS v_insert_flag,\n\tv_insert_flag AS insert_flag_out,\n\t-- *INF*: IIF(financial_type_code = 'D',\r\n\t-- IIF(v_insert_flag = 'INSERT',\r\n\t-- DECODE(v_claimant_overall_status_crrnt_D,'1NOTICEONLY','1NOTICEONLY',\r\n\t--                                                                                           '2OPEN', IIF(v_claimant_overall_status_old_D = '3CLOSED',IIF(v_claimant_D = 'OLD','4REOPEN', '2OPEN'), '2OPEN')\r\n\t--                                                                                          ,'3CLOSED',IIF(v_claimant_reserve_date_type_out_old_D ='4REOPEN','5CLOSEDAFTERREOPEN','3CLOSED')) ,v_claimant_reserve_date_type_out_old_D),v_claimant_reserve_date_type_out_old_D)\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- --IIF(financial_type_code = 'D', IIF(v_claimant_overall_status_crrnt_D = '2OPEN',IIF(v_claimant_overall_status_old_D = '3CLOSED',\r\n\t--  --IIF(v_claimant_D = 'OLD','4REOPEN', '2OPEN'), '2OPEN'),IIF(v_claimant_overall_status_crrnt_D ='3CLOSED',IIF(v_claimant_reserve_date_type_out_old_D ='4REOPEN','5CLOSEDAFTERREOPEN','3CLOSED'),v_claimant_overall_status_crrnt_D)),IIF(v_claimant_D = 'OLD',v_claimant_reserve_date_type_out_old_D)) \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(\n\t    financial_type_code = 'D',\n\t    IFF(\n\t        v_insert_flag = 'INSERT',\n\t        DECODE(\n\t            v_claimant_overall_status_crrnt_D,\n\t            '1NOTICEONLY', '1NOTICEONLY',\n\t            '2OPEN', IFF(\n\t                v_claimant_overall_status_old_D = '3CLOSED',\n\t                IFF(\n\t                    v_claimant_D = 'OLD', '4REOPEN', '2OPEN'\n\t                ),\n\t                '2OPEN'\n\t            ),\n\t            '3CLOSED', IFF(\n\t                v_claimant_reserve_date_type_out_old_D = '4REOPEN',\n\t                '5CLOSEDAFTERREOPEN',\n\t                '3CLOSED'\n\t            )\n\t        ),\n\t        v_claimant_reserve_date_type_out_old_D\n\t    ),\n\t    v_claimant_reserve_date_type_out_old_D\n\t) AS v_claimant_reserve_date_type_out_crrnt_D,\n\t-- *INF*: IIF(financial_type_code = 'E',\r\n\t-- IIF(v_insert_flag = 'INSERT',\r\n\t-- DECODE(v_claimant_overall_status_crrnt_E,'1NOTICEONLY','1NOTICEONLY',\r\n\t--                                                                                           '2OPEN', IIF(v_claimant_overall_status_old_E = '3CLOSED',IIF(v_claimant_E = 'OLD','4REOPEN', '2OPEN'), '2OPEN')\r\n\t--                                                                                          ,'3CLOSED',IIF(v_claimant_reserve_date_type_out_old_E ='4REOPEN','5CLOSEDAFTERREOPEN','3CLOSED')) ,v_claimant_reserve_date_type_out_old_E),v_claimant_reserve_date_type_out_old_E)\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- --IIF(financial_type_code = 'E', IIF(v_claimant_overall_status_crrnt_E = '2OPEN',IIF(v_claimant_overall_status_old_E = '3CLOSED',\r\n\t-- -- IIF(v_claimant_E = 'OLD','4REOPEN', '2OPEN'), '2OPEN'),IIF(v_claimant_overall_status_crrnt_E ='3CLOSED',IIF(v_claimant_reserve_date_type_out_old_E ='4REOPEN','5CLOSEDAFTERREOPEN','3CLOSED'),v_claimant_overall_status_crrnt_E)),IIF(v_claimant_E = 'OLD',v_claimant_reserve_date_type_out_old_E)) \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(\n\t    financial_type_code = 'E',\n\t    IFF(\n\t        v_insert_flag = 'INSERT',\n\t        DECODE(\n\t            v_claimant_overall_status_crrnt_E,\n\t            '1NOTICEONLY', '1NOTICEONLY',\n\t            '2OPEN', IFF(\n\t                v_claimant_overall_status_old_E = '3CLOSED',\n\t                IFF(\n\t                    v_claimant_E = 'OLD', '4REOPEN', '2OPEN'\n\t                ),\n\t                '2OPEN'\n\t            ),\n\t            '3CLOSED', IFF(\n\t                v_claimant_reserve_date_type_out_old_E = '4REOPEN',\n\t                '5CLOSEDAFTERREOPEN',\n\t                '3CLOSED'\n\t            )\n\t        ),\n\t        v_claimant_reserve_date_type_out_old_E\n\t    ),\n\t    v_claimant_reserve_date_type_out_old_E\n\t) AS v_claimant_reserve_date_type_out_crrnt_E,\n\t-- *INF*: IIF(financial_type_code = 'S',\r\n\t-- IIF(v_insert_flag = 'INSERT',\r\n\t-- DECODE(v_claimant_overall_status_crrnt_S,'1NOTICEONLY','1NOTICEONLY',\r\n\t--                                                                                           '2OPEN', IIF(v_claimant_overall_status_old_S = '3CLOSED',IIF(v_claimant_S = 'OLD','4REOPEN', '2OPEN'), '2OPEN')\r\n\t--                                                                                          ,'3CLOSED',IIF(v_claimant_reserve_date_type_out_old_S ='4REOPEN','5CLOSEDAFTERREOPEN','3CLOSED')) ,v_claimant_reserve_date_type_out_old_S),v_claimant_reserve_date_type_out_old_S)\r\n\t-- \r\n\t-- --------------\r\n\t-- \r\n\t-- --IIF(financial_type_code = 'S', IIF(v_claimant_overall_status_crrnt_S = '2OPEN',IIF(v_claimant_overall_status_old_S = '3CLOSED',\r\n\t-- -- IIF(v_claimant_S = 'OLD','4REOPEN', '2OPEN'), '2OPEN'),IIF(v_claimant_overall_status_crrnt_S ='3CLOSED',IIF(v_claimant_reserve_date_type_out_old_S ='4REOPEN','5CLOSEDAFTERREOPEN','3CLOSED'),v_claimant_overall_status_crrnt_S)),IIF(v_claimant_S = 'OLD',v_claimant_reserve_date_type_out_old_S)) \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(\n\t    financial_type_code = 'S',\n\t    IFF(\n\t        v_insert_flag = 'INSERT',\n\t        DECODE(\n\t            v_claimant_overall_status_crrnt_S,\n\t            '1NOTICEONLY', '1NOTICEONLY',\n\t            '2OPEN', IFF(\n\t                v_claimant_overall_status_old_S = '3CLOSED',\n\t                IFF(\n\t                    v_claimant_S = 'OLD', '4REOPEN', '2OPEN'\n\t                ),\n\t                '2OPEN'\n\t            ),\n\t            '3CLOSED', IFF(\n\t                v_claimant_reserve_date_type_out_old_S = '4REOPEN',\n\t                '5CLOSEDAFTERREOPEN',\n\t                '3CLOSED'\n\t            )\n\t        ),\n\t        v_claimant_reserve_date_type_out_old_S\n\t    ),\n\t    v_claimant_reserve_date_type_out_old_S\n\t) AS v_claimant_reserve_date_type_out_crrnt_S,\n\t-- *INF*: IIF(financial_type_code = 'B',\r\n\t-- IIF(v_insert_flag = 'INSERT',\r\n\t-- DECODE(v_claimant_overall_status_crrnt_B,'1NOTICEONLY','1NOTICEONLY',\r\n\t--                                                                                           '2OPEN', IIF(v_claimant_overall_status_old_B = '3CLOSED',IIF(v_claimant_B = 'OLD','4REOPEN', '2OPEN'), '2OPEN')\r\n\t--                                                                                          ,'3CLOSED',IIF(v_claimant_reserve_date_type_out_old_B ='4REOPEN','5CLOSEDAFTERREOPEN','3CLOSED')) ,v_claimant_reserve_date_type_out_old_B),v_claimant_reserve_date_type_out_old_B)\r\n\t-- \r\n\t-- ----------------\r\n\t-- \r\n\t-- --IIF(financial_type_code = 'B', IIF(v_claimant_overall_status_crrnt_B = '2OPEN',IIF(v_claimant_overall_status_old_B = '3CLOSED',\r\n\t-- -- IIF(v_claimant_B = 'OLD','4REOPEN', '2OPEN'), '2OPEN'),IIF(v_claimant_overall_status_crrnt_B ='3CLOSED',IIF(v_claimant_reserve_date_type_out_old_B ='4REOPEN','5CLOSEDAFTERREOPEN','3CLOSED'),v_claimant_overall_status_crrnt_B)),IIF(v_claimant_B = 'OLD',v_claimant_reserve_date_type_out_old_B)) \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(\n\t    financial_type_code = 'B',\n\t    IFF(\n\t        v_insert_flag = 'INSERT',\n\t        DECODE(\n\t            v_claimant_overall_status_crrnt_B,\n\t            '1NOTICEONLY', '1NOTICEONLY',\n\t            '2OPEN', IFF(\n\t                v_claimant_overall_status_old_B = '3CLOSED',\n\t                IFF(\n\t                    v_claimant_B = 'OLD', '4REOPEN', '2OPEN'\n\t                ),\n\t                '2OPEN'\n\t            ),\n\t            '3CLOSED', IFF(\n\t                v_claimant_reserve_date_type_out_old_B = '4REOPEN',\n\t                '5CLOSEDAFTERREOPEN',\n\t                '3CLOSED'\n\t            )\n\t        ),\n\t        v_claimant_reserve_date_type_out_old_B\n\t    ),\n\t    v_claimant_reserve_date_type_out_old_B\n\t) AS v_claimant_reserve_date_type_out_crrnt_B,\n\t-- *INF*: IIF(financial_type_code = 'R',\r\n\t-- IIF(v_insert_flag = 'INSERT',\r\n\t-- DECODE(v_claimant_overall_status_crrnt_R,'1NOTICEONLY','1NOTICEONLY',\r\n\t--                                                                                           '2OPEN', IIF(v_claimant_overall_status_old_R = '3CLOSED',IIF(v_claimant_R = 'OLD','4REOPEN', '2OPEN'), '2OPEN')\r\n\t--                                                                                          ,'3CLOSED',IIF(v_claimant_reserve_date_type_out_old_R ='4REOPEN','5CLOSEDAFTERREOPEN','3CLOSED')) ,v_claimant_reserve_date_type_out_old_R),v_claimant_reserve_date_type_out_old_R)\r\n\t-- \r\n\t-- ----------\r\n\t-- \r\n\t-- --IIF(financial_type_code = 'R', IIF(v_claimant_overall_status_crrnt_R = '2OPEN',IIF(v_claimant_overall_status_old_R = '3CLOSED',\r\n\t-- -- IIF(v_claimant_R = 'OLD','4REOPEN', '2OPEN'), '2OPEN'),IIF(v_claimant_overall_status_crrnt_R ='3CLOSED',IIF(v_claimant_reserve_date_type_out_old_R ='4REOPEN','5CLOSEDAFTERREOPEN','3CLOSED'),v_claimant_overall_status_crrnt_R)),IIF(v_claimant_R = 'OLD',v_claimant_reserve_date_type_out_old_R)) \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(\n\t    financial_type_code = 'R',\n\t    IFF(\n\t        v_insert_flag = 'INSERT',\n\t        DECODE(\n\t            v_claimant_overall_status_crrnt_R,\n\t            '1NOTICEONLY', '1NOTICEONLY',\n\t            '2OPEN', IFF(\n\t                v_claimant_overall_status_old_R = '3CLOSED',\n\t                IFF(\n\t                    v_claimant_R = 'OLD', '4REOPEN', '2OPEN'\n\t                ),\n\t                '2OPEN'\n\t            ),\n\t            '3CLOSED', IFF(\n\t                v_claimant_reserve_date_type_out_old_R = '4REOPEN',\n\t                '5CLOSEDAFTERREOPEN',\n\t                '3CLOSED'\n\t            )\n\t        ),\n\t        v_claimant_reserve_date_type_out_old_R\n\t    ),\n\t    v_claimant_reserve_date_type_out_old_R\n\t) AS v_claimant_reserve_date_type_out_crrnt_R,\n\t-- *INF*: DECODE(financial_type_code,'D',v_claimant_reserve_date_type_out_crrnt_D,\r\n\t--                                                                'E',v_claimant_reserve_date_type_out_crrnt_E,\r\n\t-- \t\t                                                  'S',v_claimant_reserve_date_type_out_crrnt_S,\r\n\t--                                                                'B',v_claimant_reserve_date_type_out_crrnt_B,\r\n\t--                                                                'R',v_claimant_reserve_date_type_out_crrnt_R)\n\tDECODE(\n\t    financial_type_code,\n\t    'D', v_claimant_reserve_date_type_out_crrnt_D,\n\t    'E', v_claimant_reserve_date_type_out_crrnt_E,\n\t    'S', v_claimant_reserve_date_type_out_crrnt_S,\n\t    'B', v_claimant_reserve_date_type_out_crrnt_B,\n\t    'R', v_claimant_reserve_date_type_out_crrnt_R\n\t) AS claimant_reserve_date_type_out,\n\tv_claimant_reserve_date_type_out_crrnt_D AS v_claimant_reserve_date_type_out_old_D,\n\tv_claimant_reserve_date_type_out_crrnt_E AS v_claimant_reserve_date_type_out_old_E,\n\tv_claimant_reserve_date_type_out_crrnt_S AS v_claimant_reserve_date_type_out_old_S,\n\tv_claimant_reserve_date_type_out_crrnt_B AS v_claimant_reserve_date_type_out_old_B,\n\tv_claimant_reserve_date_type_out_crrnt_R AS v_claimant_reserve_date_type_out_old_R,\n\tv_claimant_overall_status_crrnt_D AS v_claimant_overall_status_old_D,\n\tv_claimant_overall_status_crrnt_E AS v_claimant_overall_status_old_E,\n\tv_claimant_overall_status_crrnt_S AS v_claimant_overall_status_old_S,\n\tv_claimant_overall_status_crrnt_B AS v_claimant_overall_status_old_B,\n\tv_claimant_overall_status_crrnt_R AS v_claimant_overall_status_old_R,\n\tclaim_party_occurrence_ak_id AS v_prev_row_claim_party_occurrence_ak_id\n\tFROM proc_work_claimant_reserve_calculation\n),\nFIL_non_inserts AS (\n\tSELECT\n\tinsert_flag_out, \n\tclaim_party_occurrence_ak_id, \n\tfinancial_type_code, \n\treserve_date, \n\tclaimant_reserve_date_type_out AS reserve_date_type, \n\tsource_sys_id\n\tFROM EXP_Inserts_Noninserts\n\tWHERE insert_flag_out='INSERT'\n),\nLKP_Claimant_reserve_calculation AS (\n\tSELECT\n\tclaimant_reserve_calculation_id,\n\tclaim_party_occurrence_ak_id,\n\tfinancial_type_code,\n\treserve_date,\n\treserve_date_type,\n\tIN_claim_party_occurrence_ak_id,\n\tIN_financial_type_code,\n\tIN_reserve_date,\n\tIN_reserve_date_type\n\tFROM (\n\t\tSELECT \n\t\t\tclaimant_reserve_calculation_id,\n\t\t\tclaim_party_occurrence_ak_id,\n\t\t\tfinancial_type_code,\n\t\t\treserve_date,\n\t\t\treserve_date_type,\n\t\t\tIN_claim_party_occurrence_ak_id,\n\t\t\tIN_financial_type_code,\n\t\t\tIN_reserve_date,\n\t\t\tIN_reserve_date_type\n\t\tFROM claimant_reserve_calculation\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_party_occurrence_ak_id,financial_type_code,reserve_date,reserve_date_type ORDER BY claimant_reserve_calculation_id) = 1\n),\nFIL_Existing_records AS (\n\tSELECT\n\tLKP_Claimant_reserve_calculation.claimant_reserve_calculation_id AS lkp_claimant_reserve_calculation_id, \n\tFIL_non_inserts.claim_party_occurrence_ak_id, \n\tFIL_non_inserts.financial_type_code, \n\tFIL_non_inserts.reserve_date, \n\tFIL_non_inserts.reserve_date_type, \n\tFIL_non_inserts.source_sys_id\n\tFROM FIL_non_inserts\n\tLEFT JOIN LKP_Claimant_reserve_calculation\n\tON LKP_Claimant_reserve_calculation.claim_party_occurrence_ak_id = FIL_non_inserts.claim_party_occurrence_ak_id AND LKP_Claimant_reserve_calculation.financial_type_code = FIL_non_inserts.financial_type_code AND LKP_Claimant_reserve_calculation.reserve_date = FIL_non_inserts.reserve_date AND LKP_Claimant_reserve_calculation.reserve_date_type = FIL_non_inserts.reserve_date_type\n\tWHERE IIF(ISNULL(lkp_claimant_reserve_calculation_id),TRUE,FALSE)\n),\nEXP_Metadata AS (\n\tSELECT\n\tclaim_party_occurrence_ak_id,\n\tfinancial_type_code,\n\treserve_date,\n\treserve_date_type,\n\t-- *INF*: DECODE(reserve_date_type,'1NOTICEONLY','N',\r\n\t--                     \t\t\t\t\t\t   '2OPEN','O',\r\n\t-- \t              \t\t\t\t\t         '3CLOSED','C',\r\n\t--                                                              '4REOPEN','O',\r\n\t--                                                              '5CLOSEDAFTERREOPEN','C')\n\tDECODE(\n\t    reserve_date_type,\n\t    '1NOTICEONLY', 'N',\n\t    '2OPEN', 'O',\n\t    '3CLOSED', 'C',\n\t    '4REOPEN', 'O',\n\t    '5CLOSEDAFTERREOPEN', 'C'\n\t) AS financial_type_status_code,\n\t1 AS crrnt_snpsht_flag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS audit_id,\n\treserve_date AS eff_from_date,\n\t-- *INF*: to_date('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_TIMESTAMP('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS eff_to_date,\n\tsource_sys_id,\n\tSYSDATE AS created_date,\n\tSYSDATE AS modified_date\n\tFROM FIL_Existing_records\n),\nSEQ_Clmt_Rsrv_Calc_AK_ID AS (\n\tCREATE SEQUENCE SEQ_Clmt_Rsrv_Calc_AK_ID\n\tSTART = 0\n\tINCREMENT = 1;\n),\nclaimant_reserve_calculation_insert AS (\n\tINSERT INTO claimant_reserve_calculation\n\t(claimant_reserve_calculation_ak_id, claim_party_occurrence_ak_id, financial_type_code, reserve_date, reserve_date_type, financial_type_status_code, crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date)\n\tSELECT \n\tSEQ_Clmt_Rsrv_Calc_AK_ID.NEXTVAL AS CLAIMANT_RESERVE_CALCULATION_AK_ID, \n\tCLAIM_PARTY_OCCURRENCE_AK_ID, \n\tFINANCIAL_TYPE_CODE, \n\tRESERVE_DATE, \n\tRESERVE_DATE_TYPE, \n\tFINANCIAL_TYPE_STATUS_CODE, \n\tCRRNT_SNPSHT_FLAG, \n\tAUDIT_ID, \n\tEFF_FROM_DATE, \n\tEFF_TO_DATE, \n\tSOURCE_SYS_ID, \n\tCREATED_DATE, \n\tMODIFIED_DATE\n\tFROM EXP_Metadata\n),\nSQ_claimant_reserve_calculation_update AS (\n\tSELECT a.claimant_reserve_calculation_id, a.claim_party_occurrence_ak_id, a.financial_type_code, a.reserve_date_type,a.eff_from_date, a.eff_to_date, a.source_sys_id \r\n\tFROM  @{pipeline().parameters.TARGET_TABLE_OWNER}.claimant_reserve_calculation a\r\n\twhere EXISTS ( SELECT 1\t\t\t\r\n\t\tFROM  @{pipeline().parameters.TARGET_TABLE_OWNER}.claimant_reserve_calculation b\r\n\tWHERE b.crrnt_snpsht_flag = 1\r\n\tAND a.claim_party_occurrence_ak_id = b.claim_party_occurrence_ak_id \r\n\tAND a.source_sys_id = b.source_sys_id\r\n\tAND a.financial_type_code = b.financial_type_code \r\n\tGROUP BY b.claim_party_occurrence_ak_id, b.financial_type_code, b.source_sys_id\r\n\t\tHAVING COUNT(*) > 1)\r\n\tORDER BY a.claim_party_occurrence_ak_id, a.financial_type_code, a.source_sys_id,a.eff_from_date  DESC, a.claimant_reserve_calculation_ak_id DESC\r\n\t\r\n\t--EXISTS Subquery exists to pick AK Groups that have multiple rows with a 12/31/2100 eff_to_date.\r\n\t--When this condition occurs this is an indication that we must expire one or more of these rows.\r\n\t--WHERE clause is always made up of eff_to_date='12/31/2100 23:59:59' and all columns of the AK\r\n\t--GROUP BY clause is always on AK\r\n\t--HAVING clause stays the same\r\n\t\r\n\t--ORDER BY of main query orders all rows first by the AK and then by the eff_from_date in a DESC format\r\n\t--the descending order is important because this allows us to avoid another lookup and properly apply the eff_to_date by utilizing a local variable to keep track\r\n\t\r\n\t-- In the order by clause we added claimant_reserve_calculation_ak_id  DESC ,because say a claimant has staus order of \r\n\t-- '4REOPEN',\r\n\t-- '5CLOSEDAFTERREOPEN',\r\n\t-- '4REOPEN' on same day for PMS data , then the latest row with '4REOPEN' status should have a crrnt_snpsht_flag value of  1.\n),\nEXP_Expire_rows AS (\n\tSELECT\n\tclaimant_reserve_calculation_id,\n\tclaim_party_occurrence_ak_id,\n\tfinancial_type_code,\n\teff_from_date,\n\teff_to_date AS orig_eff_to_date,\n\tsource_sys_id,\n\t-- *INF*: DECODE(TRUE,claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id AND source_sys_id = v_source_sys_id AND financial_type_code = v_prev_row_financial_type_code, ADD_TO_DATE(v_eff_from_date,'SS',-1),\r\n\t-- \torig_eff_to_date)\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \n\tDECODE(\n\t    TRUE,\n\t    claim_party_occurrence_ak_id = v_prev_row_claim_party_occurrence_ak_id AND source_sys_id = v_source_sys_id AND financial_type_code = v_prev_row_financial_type_code, DATEADD(SECOND,- 1,v_eff_from_date),\n\t    orig_eff_to_date\n\t) AS v_eff_to_date,\n\tv_eff_to_date AS eff_to_date,\n\tclaim_party_occurrence_ak_id AS v_prev_row_claim_party_occurrence_ak_id,\n\tfinancial_type_code AS v_prev_row_financial_type_code,\n\teff_from_date AS v_eff_from_date,\n\tsource_sys_id AS v_source_sys_id,\n\t0 AS crrnt_snpsht_flag,\n\tSYSDATE AS modified_date,\n\treserve_date_type\n\tFROM SQ_claimant_reserve_calculation_update\n),\nFIL_claimant_reserve_calc_UPD AS (\n\tSELECT\n\tclaimant_reserve_calculation_id, \n\torig_eff_to_date, \n\teff_to_date, \n\tcrrnt_snpsht_flag, \n\tmodified_date\n\tFROM EXP_Expire_rows\n\tWHERE orig_eff_to_date != eff_to_date\n),\nUPD_CLMT_RESERVE_CALC AS (\n\tSELECT\n\tclaimant_reserve_calculation_id, \n\torig_eff_to_date, \n\teff_to_date, \n\tcrrnt_snpsht_flag, \n\tmodified_date\n\tFROM FIL_claimant_reserve_calc_UPD\n),\nclaimant_reserve_calculation_update AS (\n\tMERGE INTO claimant_reserve_calculation AS T\n\tUSING UPD_CLMT_RESERVE_CALC AS S\n\tON T.claimant_reserve_calculation_id = S.claimant_reserve_calculation_id\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.crrnt_snpsht_flag = S.crrnt_snpsht_flag, T.eff_to_date = S.eff_to_date, T.modified_date = S.modified_date\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "RPT_EDM and EDW/Claims DataWarehouse/"
        },
        "annotations": []
    }
}