{
    "name": "m_POL_DW_LOAD_CoverageDeductible",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DW_LOAD_CoverageDeductible",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_pif_4514_stage AS (\n\tSELECT DISTINCT  \r\n\tpif_4514_stage_ID as pif_4514_stage_id,\r\n\tCASE\r\n\tWHEN sar_major_peril = '145' and sar_type_bureau = 'AP' and sar_insurance_line in ('CA','') THEN \r\n\t(CASE WHEN sar_code_1+sar_code_2+sar_code_3 IN('703','710','715','755','734','735','756','757') THEN  'ComprehensiveFullGlassCoverageDeductible' \r\n\tELSE 'ComprehensiveDeductible' END)\r\n\tWHEN sar_major_peril = '170' and sar_type_bureau = 'AP' and sar_insurance_line in ('CA','') THEN  'CollisionDeductible'\r\n\tWHEN sar_major_peril = '130' and sar_insurance_line IN('CA','GA','') and sar_type_bureau = 'AN' THEN 'PersonalInjuryProtectionDeductible'\r\n\tWHEN sar_major_peril = '145' and sar_insurance_line = 'GA' and sar_type_bureau = 'AP' and sar_risk_unit_group = '116' and sar_unit = '971'THEN 'ComprehensiveDeductible'\r\n\tWHEN sar_major_peril = '170' and sar_insurance_line = 'GA' and sar_type_bureau = 'AP' THEN 'ComprehensiveDeductible'\r\n\tWHEN sar_major_peril = '171' and sar_type_bureau = 'AP' and sar_insurance_line in ('CA','') THEN 'BroadenedCollisionDeductible'\r\n\tWHEN sar_major_peril = '172' and sar_type_bureau = 'AP' and sar_insurance_line in ('CA','') THEN 'LimitedCollisionDeductible'\r\n\tWHEN D.Pif351StageId IS NOT NULL and sar_insurance_line in ('CA','') and sar_type_bureau in ('AL','AN','AP') THEN 'SingleLimitDeductible'\r\n\tWHEN sar_insurance_line='WC' THEN\r\n\t(CASE \r\n\tWHEN Pif43IXUnmodWCRatingState = '13' and B.Pif43IXUnmodReportingClassCode = '9915' then  'CoinsuranceDeductible'\r\n\tWHEN Pif43IXUnmodWCRatingState = '13' and B.Pif43IXUnmodReportingClassCode = '9916' then  'CoinsuranceDeductible'\r\n\tWHEN Pif43IXUnmodWCRatingState = '13' and B.Pif43IXUnmodReportingClassCode = '9917' then  'CoinsuranceDeductible'\r\n\tWHEN Pif43IXUnmodWCRatingState = '13' and B.Pif43IXUnmodReportingClassCode = '9918' then  'CoinsuranceDeductible'\r\n\tWHEN Pif43IXUnmodWCRatingState = '13' and B.Pif43IXUnmodReportingClassCode = '9919' then  'CoinsuranceDeductible'\r\n\tELSE 'MedicalDeductible' END)\r\n\t------------------------------------------------------\r\n\tWHEN A.sar_insurance_line IN('IM','CF','CR') THEN ISNULL(SDT.StandardDeductibleType,'N/A')\r\n\tWHEN A.sar_insurance_line='GL' THEN \r\n\t(CASE\r\n\tWHEN not (LTRIM(RTRIM(A.sar_code_4)) is null OR LEN(LTRIM(RTRIM(A.sar_code_4)))=0)  THEN 'BodilyInjury'\r\n\tWHEN not (LTRIM(RTRIM(A.sar_code_6)) is null OR LEN(LTRIM(RTRIM(A.sar_code_6)))=0) THEN 'PropertyDamage'\r\n\tWHEN LTRIM(RTRIM(A.sar_class_1_4+A.sar_class_5_6)) = '22222' THEN 'EmploymentPracticesLiability'\r\n\tWHEN LTRIM(RTRIM(A.sar_major_peril)) = '550' THEN 'ProductWithdrawalLiability' \r\n\tELSE 'N/A' END)\r\n\t------------------------------------------------------\r\n\tELSE 'N/A' END Type,\r\n\t\r\n\tCASE \r\n\tWHEN sar_insurance_line = 'CF' THEN\r\n\t(CASE \r\n\tWHEN sar_code_5 = '01' then 'FullCoverage'\r\n\tWHEN sar_code_5 = '05' then '500' \r\n\tWHEN sar_code_5 = '07' then '1000'\r\n\tWHEN sar_code_5 = '08' then '2500' \r\n\tWHEN sar_code_5 = '09' then '5000'\r\n\tWHEN sar_code_5 = '10' then '10000'\r\n\tWHEN sar_code_5 = '11' then '25000'\r\n\tWHEN sar_code_5 = '12' then '50000'\r\n\tWHEN sar_code_5 = '13' then '75000'\r\n\tELSE 'N/A' END)\r\n\tWHEN sar_major_peril = '565' and sar_insurance_line = 'CR' THEN \r\n\t(CASE \r\n\tWHEN sar_code_7 = '0' then '0'\r\n\tWHEN sar_code_7 = '04' then '250'\r\n\tWHEN sar_code_7 = '05' then '500'\r\n\tWHEN sar_code_7 = '07' then '1000'\r\n\tWHEN sar_code_7 = '08' then '2500'\r\n\tWHEN sar_code_7 = '09' then '5000'\r\n\tWHEN sar_code_7 = '10' then '10000' \r\n\tWHEN sar_code_7 = '11' then '25000'\r\n\tELSE 'N/A' END)\r\n\tWHEN sar_major_peril = '565' and sar_insurance_line='CR' and sar_type_bureau = 'CR' THEN\r\n\t(CASE \r\n\tWHEN sar_code_5 = '01' then '0'\r\n\tWHEN sar_code_5 = '02' then '50'\r\n\tWHEN sar_code_5 = '03' then '100'\r\n\tWHEN sar_code_5 = '04' then '250'\r\n\tWHEN sar_code_5 = '05' then '500'\r\n\tWHEN sar_code_5 = '06' then '750'\r\n\tWHEN sar_code_5 = '07' then '1000'\r\n\tWHEN sar_code_5 = '08' then '2500'\r\n\tWHEN sar_code_5 = '09' then '5000'\r\n\tWHEN sar_code_5 = '19' then '10000'\r\n\tWHEN sar_code_5 = '11' then '25000'\r\n\tELSE 'N/A' END)\r\n\tWHEN sar_major_peril = '566' and sar_insurance_line='CR' and sar_type_bureau = 'FT' THEN\r\n\t(CASE \r\n\tWHEN sar_code_5 = '01' THEN 'Blank'\r\n\tWHEN sar_code_5 = '02' THEN '50'\r\n\tWHEN sar_code_5 = '03' THEN '100'\r\n\tWHEN sar_code_5 = '04' THEN '250'\r\n\tWHEN sar_code_5 = '05' THEN '500'\r\n\tWHEN sar_code_5 = '06' THEN '750'\r\n\tWHEN sar_code_5 = '07' THEN '1000'\r\n\tWHEN sar_code_5 = '08' THEN '2500'\r\n\tWHEN sar_code_5 = '09' THEN '5000'\r\n\tWHEN sar_code_5 = '19' THEN '10000'\r\n\tWHEN sar_code_5 = '11' THEN '25000'\r\n\tELSE 'N/A' END)\r\n\tWHEN sar_major_peril = '145' and sar_type_bureau = 'AP' and sar_insurance_line in ('CA','') THEN\r\n\t(CASE \r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '0' AND sar_code_3 = '1' THEN '0'\r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '0' AND sar_code_3 = '3' THEN '50' \r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '1' AND sar_code_3 = '0' THEN '100' \r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '1' AND sar_code_3 = '5' THEN '200' \r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '5' AND sar_code_3 = '5' THEN '250' \r\n\tWHEN sar_code_1 = '7' AND sar_code_2 = '2' AND sar_code_3 = '6' THEN '500' \r\n\tWHEN sar_code_1 = '7' AND sar_code_2 = '2' AND sar_code_3 = '7' THEN '1000' \r\n\tWHEN sar_code_1 = '7' AND sar_code_2 = '3' AND sar_code_3 = '1' THEN '2000' \r\n\tWHEN sar_code_1 = '7' AND sar_code_2 = '3' AND sar_code_3 = '7' THEN '5000' \r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '9' AND sar_code_3 = '9' THEN '10000'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='703' THEN '50'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='710' THEN '100'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='715' THEN '200'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='755' THEN '250'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='734' THEN '300'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='735' THEN '400'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='756' THEN '500'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='757' THEN '1000'\r\n\tELSE 'N/A' END)\r\n\tWHEN sar_major_peril = '170' and sar_type_bureau = 'AP' and sar_insurance_line in ('CA','') THEN\r\n\t(CASE \r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '7' AND sar_code_3 = '4' THEN '100' \r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '7' AND sar_code_3 = '5' THEN '150' \r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '7' AND sar_code_3 = '6' THEN '250' \r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '7' AND sar_code_3 = '7' THEN '500' \r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '7' AND sar_code_3 = '8' THEN '1000'\r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '8' AND sar_code_3 = '4' THEN '2000' \r\n\tWHEN sar_code_1 = '1' AND sar_code_2 = '0' AND sar_code_3 = '1' THEN '3000' \r\n\tWHEN sar_code_1 = '1' AND sar_code_2 = '0' AND sar_code_3 = '2' THEN '5000' \r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '9' AND sar_code_3 = '9' THEN '10000'\r\n\tWHEN sar_class_1_4 = '9020'and sar_code_1 = '0' AND sar_code_2 = '8' AND sar_code_3 = '8' THEN '0'\r\n\tELSE 'N/A' END)\r\n\t\r\n\tWHEN sar_insurance_line IN('CA','GA','') and sar_major_peril = '130' and sar_type_bureau = 'AN' THEN\r\n\t(CASE WHEN sar_state = '16' THEN\r\n\t(CASE \r\n\tWHEN sar_code_3 = '1' THEN 'Basic Full Coverage' \r\n\tWHEN sar_code_3 = '2' THEN '250' \r\n\tWHEN sar_code_3 = '3' THEN '500'\r\n\tELSE 'N/A'\r\n\tEND)\r\n\tELSE (CASE \r\n\tWHEN sar_code_3 = '1' THEN '0' \r\n\tWHEN sar_code_3 = '2' THEN '100' \r\n\tWHEN sar_code_3 = '3' THEN '200' \r\n\tWHEN sar_code_3 = '4' THEN '300'\r\n\tELSE 'N/A' END)\r\n\tEND)\r\n\t\r\n\tWHEN sar_major_peril = '145' and sar_insurance_line = 'GA' and sar_type_bureau = 'AP' and sar_risk_unit_group = '116' and sar_unit = '971' THEN\r\n\t( CASE \r\n\tWHEN sar_code_1 = '2' AND sar_code_2 = '0' AND sar_code_3 = '1' THEN '100/500'\r\n\tWHEN sar_code_1 = '2' AND sar_code_2 = '0' AND sar_code_3 = '2' THEN '250/1000'\r\n\tWHEN sar_code_1 = '2' AND sar_code_2 = '0' AND sar_code_3 = '3' THEN '500/2500'\r\n\tELSE 'N/A' END)\r\n\tWHEN sar_major_peril = '170' and sar_insurance_line = 'GA' and sar_type_bureau = 'AP' THEN\r\n\t(CASE \r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '7' AND sar_code_3 = '4' THEN '100'\r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '7' AND sar_code_3 = '6' THEN '250'\r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '7' AND sar_code_3 = '7' THEN '500'\r\n\tWHEN sar_code_1 = '0' AND sar_code_2 = '7' AND sar_code_3 = '8' THEN '1000'\r\n\tELSE 'N/A'END)\r\n\tWHEN sar_major_peril = '171' and sar_type_bureau = 'AP' and sar_insurance_line in ('CA','') THEN\r\n\t(CASE WHEN sar_code_1+sar_code_2+sar_code_3='023' THEN '100'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='024' THEN '250'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='025' THEN '500'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='026' THEN '1000'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='301' THEN '2000'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='302' THEN '3000'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='303' THEN '5000'\r\n\tELSE 'N/A' END)\r\n\tWHEN sar_major_peril = '172' and sar_type_bureau = 'AP' and sar_insurance_line in ('CA','') THEN\r\n\t(CASE WHEN sar_code_1+sar_code_2+sar_code_3='056' THEN 'No Deductible'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='057' THEN '100'\r\n\tWHEN sar_code_1+sar_code_2+sar_code_3='058' THEN '250'\r\n\tELSE 'N/A' END)\r\n\tWHEN D.Pif351StageId IS NOT NULL and sar_insurance_line in ('CA','') and sar_type_bureau in ('AL','AN','AP') THEN\r\n\t(CASE WHEN VehicleCoverageCode1='63' THEN LTRIM(RTRIM(VehicleCoverageLimit1))\r\n\tWHEN VehicleCoverageCode2='63' THEN LTRIM(RTRIM(VehicleCoverageLimit2))\r\n\tWHEN VehicleCoverageCode3='63' THEN LTRIM(RTRIM(VehicleCoverageLimit3))\r\n\tWHEN VehicleCoverageCode4='63' THEN LTRIM(RTRIM(VehicleCoverageLimit4))\r\n\tWHEN VehicleCoverageCode5='63' THEN LTRIM(RTRIM(VehicleCoverageLimit5))\r\n\tWHEN VehicleCoverageCode6='63' THEN LTRIM(RTRIM(VehicleCoverageLimit6))\r\n\tWHEN VehicleCoverageCode7='63' THEN LTRIM(RTRIM(VehicleCoverageLimit7))\r\n\tWHEN VehicleCoverageCode8='63' THEN LTRIM(RTRIM(VehicleCoverageLimit8))\r\n\tWHEN VehicleCoverageCode9='63' THEN LTRIM(RTRIM(VehicleCoverageLimit9))\r\n\tWHEN VehicleCoverageCode10='63' THEN LTRIM(RTRIM(VehicleCoverageLimit10))\r\n\tWHEN VehicleCoverageCode11='63' THEN LTRIM(RTRIM(VehicleCoverageLimit11))\r\n\tWHEN VehicleCoverageCode12='63' THEN LTRIM(RTRIM(VehicleCoverageLimit12))\r\n\tWHEN VehicleCoverageCode13='63' THEN LTRIM(RTRIM(VehicleCoverageLimit14))\r\n\tWHEN VehicleCoverageCode14='63' THEN LTRIM(RTRIM(VehicleCoverageLimit14))\r\n\tELSE 'N/A' END)\r\n\tWHEN sar_insurance_line = 'WC' and Pif43IXUnmodWCRatingState IN('12','13','15','21','22','24','26') THEN\r\n\t(CASE\r\n\tWHEN B.Pif43IXUnmodReportingClassCode = '9931' then '1000'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9940' then '500'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9941' then '1000'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9942' then '1500'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9943' then '2000'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9944' then '2500'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9900' then '3000'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9904' then '3500'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9905' then '4000'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9906' then '4500'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9945' then '5000'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9915' then '500'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9916' then '1000'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9917' then '1500'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9918' then '2000'\r\n\tWhen B.Pif43IXUnmodReportingClassCode = '9919' then '2500'\r\n\tWHEN B.Pif43IXUnmodReportingClassCode = '9664' and Pmdi4w1ModifierPremBasis = '500' then '500'\r\n\tWHEN B.Pif43IXUnmodReportingClassCode = '9664' and Pmdi4w1ModifierPremBasis = '1000' then '1000'\r\n\tWHEN B.Pif43IXUnmodReportingClassCode = '9664' and Pmdi4w1ModifierPremBasis = '1500' then '1500'\r\n\tWHEN B.Pif43IXUnmodReportingClassCode = '9664' and Pmdi4w1ModifierPremBasis =  '2000' then '2000'\r\n\tWHEN B.Pif43IXUnmodReportingClassCode = '9664' and Pmdi4w1ModifierPremBasis =  '2500' then '2500'\r\n\tELSE 'N/A' END)\r\n\t\r\n\tWHEN sar_insurance_line = 'WC' and sar_state='14' THEN \r\n\t(CASE WHEN LTRIM(RTRIM(replace(replace(CASE WHEN LEN(DocumentText)>14 THEN substring(DocumentText,8,LEN(DocumentText)-14)\r\n\tELSE SUBSTRING(DocumentText,8,LEN(DocumentText)) end,',',''),'.',''))) IN ('100','150','200','250','300','350','400','450','500','550','600','650','700','750','800','850','900','950','1000','1050','2000','2050','3000','3050','4000','4050','5000','5050','6000','6050','7000','7050','8000','8050','9000','9050','10000')\r\n\tTHEN LTRIM(RTRIM(replace(replace(CASE WHEN LEN(DocumentText)>14 THEN substring(DocumentText,8,LEN(DocumentText)-14)\r\n\tELSE SUBSTRING(DocumentText,8,LEN(DocumentText)) end,',',''),'.',''))) ELSE '0' end \r\n\t)\r\n\t\r\n\t----------------------------------------------------------------\r\n\tWHEN A.sar_insurance_line='GL' and LTRIM(RTRIM(A.sar_major_peril)) = '550' THEN\r\n\t(CASE WHEN not (LTRIM(RTRIM(A.sar_code_4)) is null OR LEN(LTRIM(RTRIM(A.sar_code_4)))=0) THEN \r\n\t(CASE WHEN A.sar_code_4 = '01' THEN '0'\r\n\tWHEN A.sar_code_4 ='02' THEN '50'\r\n\tWHEN A.sar_code_4 ='03' THEN '100'\r\n\tWHEN A.sar_code_4 ='04' THEN '250'\r\n\tWHEN A.sar_code_4 ='05' THEN '500' \r\n\tWHEN A.sar_code_4 ='06' THEN '750'\r\n\tWHEN A.sar_code_4 ='07' THEN '1000'\r\n\tWHEN A.sar_code_4 ='09' THEN '2000'\r\n\tWHEN A.sar_code_4 ='08' THEN '2500' \r\n\tWHEN A.sar_code_4 ='15' THEN '5000'\r\n\tWHEN A.sar_code_4 ='10' THEN '10000'\r\n\tWHEN A.sar_code_4 ='90' THEN '99999'\r\n\tELSE 'N/A' END)\r\n\tWHEN not (LTRIM(RTRIM(A.sar_code_6)) is null OR LEN(LTRIM(RTRIM(A.sar_code_6)))=0) THEN\r\n\t(CASE WHEN A.sar_code_6 = '01' THEN '0'\r\n\tWHEN A.sar_code_6 ='02' THEN '50'\r\n\tWHEN A.sar_code_6 ='03' THEN '100'\r\n\tWHEN A.sar_code_6 ='04' THEN '250'\r\n\tWHEN A.sar_code_6 ='05' THEN '500' \r\n\tWHEN A.sar_code_6 ='06' THEN '750'\r\n\tWHEN A.sar_code_6 ='07' THEN '1000'\r\n\tWHEN A.sar_code_6 ='09' THEN '2000'\r\n\tWHEN A.sar_code_6 ='08' THEN '2500' \r\n\tWHEN A.sar_code_6 ='15' THEN '5000'\r\n\tWHEN A.sar_code_6 ='10' THEN '10000'\r\n\tWHEN A.sar_code_6 ='90' THEN '99999'\r\n\tELSE 'N/A' END)\r\n\tELSE 'N/A' END)\r\n\tWHEN A.sar_insurance_line='GL' and not (LTRIM(RTRIM(A.sar_code_4)) is null OR LEN(LTRIM(RTRIM(A.sar_code_4)))=0) THEN \r\n\t(CASE WHEN A.sar_code_4 = '01' THEN '0'\r\n\tWHEN A.sar_code_4 ='02' THEN '50'\r\n\tWHEN A.sar_code_4 ='03' THEN '100'\r\n\tWHEN A.sar_code_4 ='04' THEN '250'\r\n\tWHEN A.sar_code_4 ='05' THEN '500' \r\n\tWHEN A.sar_code_4 ='06' THEN '750'\r\n\tWHEN A.sar_code_4 ='07' THEN '1000'\r\n\tWHEN A.sar_code_4 ='09' THEN '2000'\r\n\tWHEN A.sar_code_4 ='08' THEN '2500' \r\n\tWHEN A.sar_code_4 ='15' THEN '5000'\r\n\tWHEN A.sar_code_4 ='10' THEN '10000'\r\n\tWHEN A.sar_code_4 ='90' THEN '99999'\r\n\tELSE 'N/A' END)\r\n\tWHEN A.sar_insurance_line='GL' and not (LTRIM(RTRIM(A.sar_code_6)) is null OR LEN(LTRIM(RTRIM(A.sar_code_6)))=0) THEN \r\n\t(CASE WHEN A.sar_code_6 = '01' THEN '0'\r\n\tWHEN A.sar_code_6 ='02' THEN '50'\r\n\tWHEN A.sar_code_6 ='03' THEN '100'\r\n\tWHEN A.sar_code_6 ='04' THEN '250'\r\n\tWHEN A.sar_code_6 ='05' THEN '500' \r\n\tWHEN A.sar_code_6 ='06' THEN '750'\r\n\tWHEN A.sar_code_6 ='07' THEN '1000'\r\n\tWHEN A.sar_code_6 ='09' THEN '2000'\r\n\tWHEN A.sar_code_6 ='08' THEN '2500' \r\n\tWHEN A.sar_code_6 ='15' THEN '5000'\r\n\tWHEN A.sar_code_6 ='10' THEN '10000'\r\n\tWHEN A.sar_code_6 ='90' THEN '99999'\r\n\tELSE 'N/A' END)\r\n\tWHEN A.sar_insurance_line='GL' and LTRIM(RTRIM(A.sar_class_1_4+A.sar_class_5_6))='22222' THEN '99999'\r\n\t----------------------------------------------------------------\r\n\t\r\n\tELSE 'N/A' END AS Value\r\n\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.pif_4514_stage A\r\n\tINNER JOIN  (SELECT DISTINCT Policykey  from @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.work_policytransactionstatus \r\n\tWHERE AuditID = @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AND\r\n\tPolicyStatus <> 'NOCHANGE')  E\r\n\tON  E.policykey = A.policykey\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Pif43IXUnmodStage  B \r\n\tON  A.Pif_Symbol=B.PifSymbol  \r\n\tAND A.Pif_Policy_Number=B.PifPolicyNumber \r\n\tAND A.Pif_Module=B.PifModule \r\n\tAND B.Pif43IXUnmodInsuranceLine=A.sar_insurance_line\r\n\tAND A.sar_state=CONVERT(varchar,B.Pif43IXUnmodWCRatingState)\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Pif43IXZWCModStage C\r\n\tON  A.Pif_Symbol=C.PifSymbol \r\n\tAND A.Pif_Policy_Number=C.PifPolicyNumber \r\n\tAND A.Pif_Module=C.PifModule \r\n\tAND C.Pmdi4w1InsuranceLine=A.sar_insurance_line\r\n\tAND A.Sar_state=CONVERT(varchar,Pmdi4w1WcRatingState)\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Pif351Stage D\r\n\tON A.Pif_Symbol=D.PifSymbol\r\n\tAND A.Pif_Policy_Number=D.PifPolicyNumber\r\n\tAND A.Pif_Module=D.PifModule\r\n\tAND A.sar_unit=RIGHT('0'+CONVERT(VARCHAR,D.UnitNum),3)\r\n\tAND D.UnitNum>=52 \r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Pif11Stage F\r\n\tON A.Pif_Symbol=F.PifSymbol\r\n\tAND A.Pif_Policy_Number=F.PifPolicyNumber\r\n\tAND A.Pif_Module=F.PifModule\r\n\tAND F.DocumentName in ('140601','140603')\r\n\tAND F.DocumentText is not null\r\n\tLEFT JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.SupDeductibleType SDT\r\n\ton SDT.RiskUnitGroupCode=A.sar_risk_unit_group\r\n\tAND SDT.InsuranceLine=A.sar_insurance_line\r\n\tAND SDT.SourceSystemId='@{pipeline().parameters.SOURCE_SYSTEM_ID}'\r\n\tWHERE A.logical_flag IN ('0','1','2','3')\n),\nEXP_GetVal AS (\n\tSELECT\n\tValue AS i_Value,\n\tpif_4514_stage_id,\n\tType,\n\t-- *INF*: rtrim(ltrim(i_Value))\n\trtrim(ltrim(i_Value)) AS o_Value\n\tFROM SQ_pif_4514_stage\n),\nFIL_Value AS (\n\tSELECT\n\tpif_4514_stage_id, \n\tType, \n\to_Value AS Value\n\tFROM EXP_GetVal\n\tWHERE NOT ISNULL(Type) and Type<>'N/A' and Value<>'N/A'\n),\nLKP_WorkPremiumTransaction AS (\n\tSELECT\n\tPremiumTransactionAKId,\n\tPremiumTransactionStageId\n\tFROM (\n\t\tSELECT PremiumTransactionAKId AS PremiumTransactionAKId ,\r\n\t\tPremiumTransactionStageId AS PremiumTransactionStageId\r\n\t\t FROM @{pipeline().parameters.TARGET_TABLE_OWNER}.WorkPremiumTransaction A\r\n\t\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.pif_4514_stage B\r\n\t\tON A.PremiumTransactionStageId=B.pif_4514_stage_ID\r\n\t\tORDER BY WorkPremiumTransactionId --\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionStageId ORDER BY PremiumTransactionAKId DESC) = 1\n),\nFIL_InvalidAKID AS (\n\tSELECT\n\tFIL_Value.Type, \n\tFIL_Value.Value, \n\tLKP_WorkPremiumTransaction.PremiumTransactionAKId\n\tFROM FIL_Value\n\tLEFT JOIN LKP_WorkPremiumTransaction\n\tON LKP_WorkPremiumTransaction.PremiumTransactionStageId = FIL_Value.pif_4514_stage_id\n\tWHERE NOT ISNULL(PremiumTransactionAKId)\n),\nSRT_BridgeRecords AS (\n\tSELECT\n\tType, \n\tValue, \n\tPremiumTransactionAKId\n\tFROM FIL_InvalidAKID\n\tORDER BY Type ASC, Value ASC\n),\nAGG_RemoveDup AS (\n\tSELECT\n\tType, \n\tValue\n\tFROM FIL_Value\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY Type, Value ORDER BY NULL) = 1\n),\nLKP_CoverageDeductible AS (\n\tSELECT\n\tCoverageDeductibleId,\n\tCoverageDeductibleType,\n\tCoverageDeductibleValue\n\tFROM (\n\t\tSELECT \n\t\t\tCoverageDeductibleId,\n\t\t\tCoverageDeductibleType,\n\t\t\tCoverageDeductibleValue\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDeductible\n\t\tWHERE SourceSystemID='@{pipeline().parameters.SOURCE_SYSTEM_ID}'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY CoverageDeductibleType,CoverageDeductibleValue ORDER BY CoverageDeductibleId) = 1\n),\nSEQ_CoverageDeductibleID AS (\n\tCREATE SEQUENCE SEQ_CoverageDeductibleID\n\tSTART = 0\n\tINCREMENT = 1;\n),\nEXP_Existing AS (\n\tSELECT\n\tLKP_CoverageDeductible.CoverageDeductibleId AS lkp_CoverageDeductibleId,\n\tSEQ_CoverageDeductibleID.NEXTVAL,\n\tAGG_RemoveDup.Type,\n\tAGG_RemoveDup.Value,\n\t-- *INF*: IIF(ISNULL(lkp_CoverageDeductibleId),NEXTVAL,lkp_CoverageDeductibleId)\n\tIFF(lkp_CoverageDeductibleId IS NULL, NEXTVAL, lkp_CoverageDeductibleId) AS o_CoverageDeductibleId\n\tFROM AGG_RemoveDup\n\tLEFT JOIN LKP_CoverageDeductible\n\tON LKP_CoverageDeductible.CoverageDeductibleType = AGG_RemoveDup.Type AND LKP_CoverageDeductible.CoverageDeductibleValue = AGG_RemoveDup.Value\n),\nSRT_Data AS (\n\tSELECT\n\tType, \n\tValue, \n\to_CoverageDeductibleId AS CoverageDeductibleId\n\tFROM EXP_Existing\n\tORDER BY Type ASC, Value ASC\n),\nJNR_AllData AS (SELECT\n\tSRT_Data.Type, \n\tSRT_Data.Value, \n\tSRT_BridgeRecords.Type AS Type1, \n\tSRT_BridgeRecords.Value AS Value1, \n\tSRT_BridgeRecords.PremiumTransactionAKId, \n\tSRT_Data.CoverageDeductibleId\n\tFROM SRT_Data\n\tINNER JOIN SRT_BridgeRecords\n\tON SRT_BridgeRecords.Type = SRT_Data.Type AND SRT_BridgeRecords.Value = SRT_Data.Value\n),\nLKP_CoverageDeductibleBridge AS (\n\tSELECT\n\tCoverageDeductibleBridgeId,\n\tPremiumTransactionAKId,\n\tCoverageDeductibleId\n\tFROM (\n\t\tSELECT \n\t\t\tCoverageDeductibleBridgeId,\n\t\t\tPremiumTransactionAKId,\n\t\t\tCoverageDeductibleId\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDeductibleBridge\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionAKId,CoverageDeductibleId ORDER BY CoverageDeductibleBridgeId) = 1\n),\nFIL_Bridge AS (\n\tSELECT\n\tLKP_CoverageDeductibleBridge.CoverageDeductibleBridgeId AS lkp_CoverageDeductibleBridgeId, \n\tJNR_AllData.PremiumTransactionAKId, \n\tJNR_AllData.CoverageDeductibleId\n\tFROM JNR_AllData\n\tLEFT JOIN LKP_CoverageDeductibleBridge\n\tON LKP_CoverageDeductibleBridge.PremiumTransactionAKId = JNR_AllData.PremiumTransactionAKId AND LKP_CoverageDeductibleBridge.CoverageDeductibleId = JNR_AllData.CoverageDeductibleId\n\tWHERE ISNULL(lkp_CoverageDeductibleBridgeId)\n),\nAGG_Cnt AS (\n\tSELECT\n\tPremiumTransactionAKId, \n\tCoverageDeductibleId, \n\tCOUNT(1) AS o_CoverageDeductibleIdCount\n\tFROM FIL_Bridge\n\tGROUP BY PremiumTransactionAKId, CoverageDeductibleId\n),\nEXP_brigdege AS (\n\tSELECT\n\tPremiumTransactionAKId,\n\tCoverageDeductibleId,\n\to_CoverageDeductibleIdCount AS CoverageDeductibleIdCount,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemID,\n\tSYSDATE AS o_CreatedDate,\n\t'N/A' AS o_CoverageDeductibleControl\n\tFROM AGG_Cnt\n),\nCoverageDeductibleBridge AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDeductibleBridge\n\t(AuditID, SourceSystemID, CreatedDate, PremiumTransactionAKId, CoverageDeductibleId, CoverageDeductibleIdCount, CoverageDeductibleControl)\n\tSELECT \n\to_AuditID AS AUDITID, \n\to_SourceSystemID AS SOURCESYSTEMID, \n\to_CreatedDate AS CREATEDDATE, \n\tPREMIUMTRANSACTIONAKID, \n\tCOVERAGEDEDUCTIBLEID, \n\tCOVERAGEDEDUCTIBLEIDCOUNT, \n\to_CoverageDeductibleControl AS COVERAGEDEDUCTIBLECONTROL\n\tFROM EXP_brigdege\n),\nFIL_ExistingDeductible AS (\n\tSELECT\n\tlkp_CoverageDeductibleId, \n\tType, \n\tValue, \n\to_CoverageDeductibleId AS CoverageDeductibleId\n\tFROM EXP_Existing\n\tWHERE ISNULL(lkp_CoverageDeductibleId)\n),\nEXP_Value AS (\n\tSELECT\n\tType,\n\tValue,\n\tCoverageDeductibleId,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditID,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS SourceSystemID,\n\tsysdate AS CreatedDate,\n\tType AS CoverageDeductibleType,\n\tValue AS CoverageDeductibleValue\n\tFROM FIL_ExistingDeductible\n),\nUPD_Target AS (\n\tSELECT\n\tCoverageDeductibleId, \n\tAuditID, \n\tSourceSystemID, \n\tCreatedDate, \n\tCoverageDeductibleType, \n\tCoverageDeductibleValue\n\tFROM EXP_Value\n),\nCoverageDeductible AS (\n\tSET IDENTITY_INSERT @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDeductible  ON\r\n\tINSERT @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDeductible (CoverageDeductibleId ,AuditID,SourceSystemID,CreatedDate,CoverageDeductibleType,CoverageDeductibleValue) \n\tSELECT S.CoverageDeductibleId,S.AuditID,S.SourceSystemID, S.CreatedDate,S.CoverageDeductibleType, S.CoverageDeductibleValue\n\tFROM UPD_Target S\n),"
                        }
                    ]
                }
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246483"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905516"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604198"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 01:21:59"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 01:54:57"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Stage_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "PMS"
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "WC_Stage"
            },
            "TARGET_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "RPT_EDM"
            },
            "WHEERE_JOIN1": {
                "type": "string",
                "defaultValue": "When sar_insurance_line = 'WC'  and B.Pif43IXUnmodWCRatingState = '26' and B.Pif43IXUnmodReportingClassCode = '9664' AND C.Pmdi4w1ModifierPremBasis = '1000' THEN  'MedicalDeductible'"
            },
            "WHEERE_JOIN2": {
                "type": "string",
                "defaultValue": "When sar_insurance_line = 'WC'  and B.Pif43IXUnmodWCRatingState = '26' and B.Pif43IXUnmodReportingClassCode = '9664' AND C.Pmdi4w1ModifierPremBasis = '1500' THEN  'MedicalDeductible'"
            },
            "WHEERE_JOIN3": {
                "type": "string",
                "defaultValue": "When sar_insurance_line = 'WC'  and B.Pif43IXUnmodWCRatingState = '26' and B.Pif43IXUnmodReportingClassCode = '9664' AND C.Pmdi4w1ModifierPremBasis = '2000' THEN  'MedicalDeductible'"
            },
            "WHEERE_JOIN4": {
                "type": "string",
                "defaultValue": "When sar_insurance_line = 'WC'  and B.Pif43IXUnmodWCRatingState = '26' and B.Pif43IXUnmodReportingClassCode = '9664' AND C.Pmdi4w1ModifierPremBasis = '2500' THEN  'MedicalDeductible' else 'NA' END TYPE,pif_4514_stage_ID as pif_4514_stage_id FROM pif_4514_stage"
            },
            "WHEERE_JOIN5": {
                "type": "string",
                "defaultValue": "LEFT JOIN   Pif43IXUnmodStage  AS B ON  PifSymbol=B.PifSymbol  AND PifPolicyNumber=B.PifPolicyNumber AND PifModule=B.PifModule AND B.Pif43IXUnmodInsuranceLine='WC' AND B.SourceSyStemID='PMS'  LEFT JOIN  (SELECT PifSymbol AS PifSymbol1, PifPolicyNumber AS PifPolicyNumber1,"
            },
            "WHEERE_JOIN6": {
                "type": "string",
                "defaultValue": "PifModule AS PifModule1,Pmdi4w1ModifierPremBasis as Pmdi4w1ModifierPremBasis FROM Pif43IXZWCModStage WHERE Pmdi4w1InsuranceLine='WC'AND SourceSystemId='PMS' ) as c on PifSymbol=C.PifSymbol1 AND PifPolicyNumber=C.PifPolicyNumber1 AND PifModule=C.PifModule1 WHERE sar_insurance_line='WC' AND source_system_id='PMS'"
            }
        },
        "folder": {
            "name": "Policy DataWarehouse/"
        },
        "annotations": []
    }
}