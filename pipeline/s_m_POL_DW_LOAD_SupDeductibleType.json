{
    "name": "s_m_POL_DW_LOAD_SupDeductibleType",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DW_LOAD_SupDeductibleType",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_SupDeductibleType_CSV AS (\n\n-- TODO Manual --\n\n),\nEXP_Default AS (\n\tSELECT\n\tSupDeductibleTypeId,\n\tCreatedDate,\n\tModifiedDate,\n\tModifiedUserId,\n\tSourceSystemId,\n\tInsuranceLine,\n\tCoverageType,\n\tDeductibleType,\n\tRiskUnitGroupCode,\n\tRiskUnitGroupDescription,\n\tStandardDeductibleType,\n\tDeductibleLevel,\n\t-- *INF*: SYSDATE\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- --IIF(ISNULL(LTRIM(RTRIM(CreatedDate))) OR LENGTH(LTRIM(RTRIM(CreatedDate)))=0, SYSDATE, TO_DATE(LTRIM(RTRIM(CreatedDate)),'MM/DD/YYYY'))\r\n\t-- \n\tCURRENT_TIMESTAMP AS o_CreatedDate,\n\t-- *INF*: SYSDATE\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- --IIF(ISNULL(LTRIM(RTRIM(ModifiedDate))) OR LENGTH(LTRIM(RTRIM(ModifiedDate)))=0, SYSDATE, TO_DATE(LTRIM(RTRIM(ModifiedDate)),'MM/DD/YYYY'))\n\tCURRENT_TIMESTAMP AS o_ModifiedDate,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(ModifiedUserId))) OR LENGTH(LTRIM(RTRIM(ModifiedUserId)))=0 OR IS_SPACES(LTRIM(RTRIM(ModifiedUserId))), 'InformS', LTRIM(RTRIM(ModifiedUserId)))\n\tIFF(\n\t    LTRIM(RTRIM(ModifiedUserId)) IS NULL\n\t    or LENGTH(LTRIM(RTRIM(ModifiedUserId))) = 0\n\t    or LENGTH(LTRIM(RTRIM(ModifiedUserId)))>0\n\t    and TRIM(LTRIM(RTRIM(ModifiedUserId)))='',\n\t    'InformS',\n\t    LTRIM(RTRIM(ModifiedUserId))\n\t) AS o_ModifiedUserId,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(SourceSystemId))) OR LENGTH(LTRIM(RTRIM(SourceSystemId)))=0 OR IS_SPACES(LTRIM(RTRIM(SourceSystemId))), 'N/A', LTRIM(RTRIM(SourceSystemId)))\n\tIFF(\n\t    LTRIM(RTRIM(SourceSystemId)) IS NULL\n\t    or LENGTH(LTRIM(RTRIM(SourceSystemId))) = 0\n\t    or LENGTH(LTRIM(RTRIM(SourceSystemId)))>0\n\t    and TRIM(LTRIM(RTRIM(SourceSystemId)))='',\n\t    'N/A',\n\t    LTRIM(RTRIM(SourceSystemId))\n\t) AS o_SourceSystemId,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(InsuranceLine))) OR LENGTH(LTRIM(RTRIM(InsuranceLine)))=0 OR IS_SPACES(LTRIM(RTRIM(InsuranceLine))), 'N/A', LTRIM(RTRIM(InsuranceLine)))\n\tIFF(\n\t    LTRIM(RTRIM(InsuranceLine)) IS NULL\n\t    or LENGTH(LTRIM(RTRIM(InsuranceLine))) = 0\n\t    or LENGTH(LTRIM(RTRIM(InsuranceLine)))>0\n\t    and TRIM(LTRIM(RTRIM(InsuranceLine)))='',\n\t    'N/A',\n\t    LTRIM(RTRIM(InsuranceLine))\n\t) AS o_InsuranceLine,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(CoverageType))) OR LENGTH(LTRIM(RTRIM(CoverageType)))=0 OR IS_SPACES(LTRIM(RTRIM(CoverageType))), 'N/A', LTRIM(RTRIM(CoverageType)))\n\tIFF(\n\t    LTRIM(RTRIM(CoverageType)) IS NULL\n\t    or LENGTH(LTRIM(RTRIM(CoverageType))) = 0\n\t    or LENGTH(LTRIM(RTRIM(CoverageType)))>0\n\t    and TRIM(LTRIM(RTRIM(CoverageType)))='',\n\t    'N/A',\n\t    LTRIM(RTRIM(CoverageType))\n\t) AS o_CoverageType,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(DeductibleType))) OR LENGTH(LTRIM(RTRIM(DeductibleType)))=0 OR IS_SPACES(LTRIM(RTRIM(DeductibleType))), 'N/A', LTRIM(RTRIM(DeductibleType)))\n\tIFF(\n\t    LTRIM(RTRIM(DeductibleType)) IS NULL\n\t    or LENGTH(LTRIM(RTRIM(DeductibleType))) = 0\n\t    or LENGTH(LTRIM(RTRIM(DeductibleType)))>0\n\t    and TRIM(LTRIM(RTRIM(DeductibleType)))='',\n\t    'N/A',\n\t    LTRIM(RTRIM(DeductibleType))\n\t) AS o_DeductibleType,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(RiskUnitGroupCode))) OR LENGTH(LTRIM(RTRIM(RiskUnitGroupCode)))=0 OR IS_SPACES(LTRIM(RTRIM(RiskUnitGroupCode))), 'N/A', LTRIM(RTRIM(RiskUnitGroupCode)))\n\tIFF(\n\t    LTRIM(RTRIM(RiskUnitGroupCode)) IS NULL\n\t    or LENGTH(LTRIM(RTRIM(RiskUnitGroupCode))) = 0\n\t    or LENGTH(LTRIM(RTRIM(RiskUnitGroupCode)))>0\n\t    and TRIM(LTRIM(RTRIM(RiskUnitGroupCode)))='',\n\t    'N/A',\n\t    LTRIM(RTRIM(RiskUnitGroupCode))\n\t) AS o_RiskUnitGroupCode,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(RiskUnitGroupDescription))) OR LENGTH(LTRIM(RTRIM(RiskUnitGroupDescription)))=0 OR IS_SPACES(LTRIM(RTRIM(RiskUnitGroupDescription))), 'N/A', LTRIM(RTRIM(RiskUnitGroupDescription)))\n\tIFF(\n\t    LTRIM(RTRIM(RiskUnitGroupDescription)) IS NULL\n\t    or LENGTH(LTRIM(RTRIM(RiskUnitGroupDescription))) = 0\n\t    or LENGTH(LTRIM(RTRIM(RiskUnitGroupDescription)))>0\n\t    and TRIM(LTRIM(RTRIM(RiskUnitGroupDescription)))='',\n\t    'N/A',\n\t    LTRIM(RTRIM(RiskUnitGroupDescription))\n\t) AS o_RiskUnitGroupDescription,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(StandardDeductibleType))) OR LENGTH(LTRIM(RTRIM(StandardDeductibleType)))=0 OR IS_SPACES(LTRIM(RTRIM(StandardDeductibleType))), 'N/A', LTRIM(RTRIM(StandardDeductibleType)))\n\tIFF(\n\t    LTRIM(RTRIM(StandardDeductibleType)) IS NULL\n\t    or LENGTH(LTRIM(RTRIM(StandardDeductibleType))) = 0\n\t    or LENGTH(LTRIM(RTRIM(StandardDeductibleType)))>0\n\t    and TRIM(LTRIM(RTRIM(StandardDeductibleType)))='',\n\t    'N/A',\n\t    LTRIM(RTRIM(StandardDeductibleType))\n\t) AS o_StandardDeductibleType,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(DeductibleLevel))) OR LENGTH(LTRIM(RTRIM(DeductibleLevel)))=0 OR IS_SPACES(LTRIM(RTRIM(DeductibleLevel))), 'N/A', LTRIM(RTRIM(DeductibleLevel)))\n\tIFF(\n\t    LTRIM(RTRIM(DeductibleLevel)) IS NULL\n\t    or LENGTH(LTRIM(RTRIM(DeductibleLevel))) = 0\n\t    or LENGTH(LTRIM(RTRIM(DeductibleLevel)))>0\n\t    and TRIM(LTRIM(RTRIM(DeductibleLevel)))='',\n\t    'N/A',\n\t    LTRIM(RTRIM(DeductibleLevel))\n\t) AS o_DeductibleLevel\n\tFROM SQ_SupDeductibleType_CSV\n),\nAGG_SourceFileChecks AS (\n\tSELECT\n\to_CreatedDate AS CreatedDate,\n\to_ModifiedDate AS ModifiedDate,\n\to_ModifiedUserId AS ModifiedUserId,\n\to_SourceSystemId AS SourceSystemId,\n\to_InsuranceLine AS InsuranceLine,\n\to_CoverageType AS CoverageType,\n\to_DeductibleType AS DeductibleType,\n\to_RiskUnitGroupCode AS RiskUnitGroupCode,\n\to_RiskUnitGroupDescription AS RiskUnitGroupDescription,\n\to_StandardDeductibleType AS StandardDeductibleType,\n\to_DeductibleLevel AS DeductibleLevel,\n\t-- *INF*: COUNT(1)\n\tCOUNT(1) AS o_Count\n\tFROM EXP_Default\n\tGROUP BY SourceSystemId, InsuranceLine, CoverageType, DeductibleType, RiskUnitGroupCode, RiskUnitGroupDescription\n),\nLKP_SupDeductibleType AS (\n\tSELECT\n\tSupDeductibleTypeId,\n\tModifiedUserId,\n\tStandardDeductibleType,\n\tDeductibleLevel,\n\tSourceSystemId,\n\tInsuranceLine,\n\tCoverageType,\n\tDeductibleType,\n\tRiskUnitGroupCode,\n\tRiskUnitGroupDescription\n\tFROM (\n\t\tSELECT SupDeductibleTypeId as SupDeductibleTypeId, \r\n\t\tLTRIM(RTRIM(ModifiedUserId)) as ModifiedUserId, \r\n\t\tLTRIM(RTRIM(SourceSystemId)) as SourceSystemId, \r\n\t\tLTRIM(RTRIM(InsuranceLine)) as InsuranceLine, \r\n\t\tLTRIM(RTRIM(CoverageType)) as CoverageType, \r\n\t\tLTRIM(RTRIM(DeductibleType)) as DeductibleType, \r\n\t\tLTRIM(RTRIM(RiskUnitGroupCode)) as RiskUnitGroupCode, \r\n\t\tLTRIM(RTRIM(RiskUnitGroupDescription)) as RiskUnitGroupDescription,\r\n\t\tLTRIM(RTRIM(StandardDeductibleType)) as StandardDeductibleType, \r\n\t\tLTRIM(RTRIM(DeductibleLevel)) as DeductibleLevel \r\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupDeductibleType\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY SourceSystemId,InsuranceLine,CoverageType,DeductibleType,RiskUnitGroupCode,RiskUnitGroupDescription ORDER BY SupDeductibleTypeId) = 1\n),\nEXP_DetectChange AS (\n\tSELECT\n\tLKP_SupDeductibleType.SupDeductibleTypeId AS lkp_SupDeductibleTypeId,\n\tLKP_SupDeductibleType.ModifiedUserId AS lkp_ModifiedUserId,\n\tLKP_SupDeductibleType.StandardDeductibleType AS lkp_StandardDeductibleType,\n\tLKP_SupDeductibleType.DeductibleLevel AS lkp_DeductibleLevel,\n\tAGG_SourceFileChecks.CreatedDate,\n\tAGG_SourceFileChecks.ModifiedDate,\n\tAGG_SourceFileChecks.ModifiedUserId,\n\tAGG_SourceFileChecks.SourceSystemId,\n\tAGG_SourceFileChecks.InsuranceLine,\n\tAGG_SourceFileChecks.CoverageType,\n\tAGG_SourceFileChecks.DeductibleType,\n\tAGG_SourceFileChecks.RiskUnitGroupCode,\n\tAGG_SourceFileChecks.RiskUnitGroupDescription,\n\tAGG_SourceFileChecks.StandardDeductibleType,\n\tAGG_SourceFileChecks.DeductibleLevel,\n\tAGG_SourceFileChecks.o_Count AS Count,\n\t'The source file is not good enough to be loaded into the target table. Please check and correct it. The source rows are - SourceSystemId: ' || SourceSystemId ||  ', InsuranceLine: ' || InsuranceLine || ', CoverageType: ' || CoverageType || ', DeductibleType: ' || DeductibleType  || ', RiskUnitGroupCode: ' || RiskUnitGroupCode || ', RiskUnitGroupDescription: ' || RiskUnitGroupDescription AS v_Message,\n\t-- *INF*: IIF(Count > 1, ABORT(v_Message))\n\tIFF(Count > 1, ABORT(v_Message)) AS v_ErrorOut,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- ISNULL(lkp_SupDeductibleTypeId), 'New',\r\n\t-- lkp_ModifiedUserId!=ModifiedUserId OR\r\n\t-- lkp_StandardDeductibleType!=StandardDeductibleType OR\r\n\t-- lkp_DeductibleLevel!=DeductibleLevel, 'Update',\r\n\t-- 'NoChange')\n\tDECODE(\n\t    TRUE,\n\t    lkp_SupDeductibleTypeId IS NULL, 'New',\n\t    lkp_ModifiedUserId != ModifiedUserId OR lkp_StandardDeductibleType != StandardDeductibleType OR lkp_DeductibleLevel != DeductibleLevel, 'Update',\n\t    'NoChange'\n\t) AS v_ChangeFlag,\n\tv_ChangeFlag AS o_ChangeFlag\n\tFROM AGG_SourceFileChecks\n\tLEFT JOIN LKP_SupDeductibleType\n\tON LKP_SupDeductibleType.SourceSystemId = AGG_SourceFileChecks.SourceSystemId AND LKP_SupDeductibleType.InsuranceLine = AGG_SourceFileChecks.InsuranceLine AND LKP_SupDeductibleType.CoverageType = AGG_SourceFileChecks.CoverageType AND LKP_SupDeductibleType.DeductibleType = AGG_SourceFileChecks.DeductibleType AND LKP_SupDeductibleType.RiskUnitGroupCode = AGG_SourceFileChecks.RiskUnitGroupCode AND LKP_SupDeductibleType.RiskUnitGroupDescription = AGG_SourceFileChecks.RiskUnitGroupDescription\n),\nRTR_InsertOrUpdate AS (\n\tSELECT\n\tlkp_SupDeductibleTypeId,\n\tCreatedDate,\n\tModifiedDate,\n\tModifiedUserId,\n\tSourceSystemId,\n\tInsuranceLine,\n\tCoverageType,\n\tDeductibleType,\n\tRiskUnitGroupCode,\n\tRiskUnitGroupDescription,\n\tStandardDeductibleType,\n\tDeductibleLevel,\n\to_ChangeFlag AS ChangeFlag\n\tFROM EXP_DetectChange\n),\nRTR_InsertOrUpdate_Insert AS (SELECT * FROM RTR_InsertOrUpdate WHERE ChangeFlag='New'),\nRTR_InsertOrUpdate_Update AS (SELECT * FROM RTR_InsertOrUpdate WHERE ChangeFlag='Update'),\nUPD_Insert AS (\n\tSELECT\n\tCreatedDate AS CreatedDate1, \n\tModifiedDate AS ModifiedDate1, \n\tModifiedUserId AS ModifiedUserId1, \n\tSourceSystemId AS SourceSystemId1, \n\tInsuranceLine AS InsuranceLine1, \n\tCoverageType AS CoverageType1, \n\tDeductibleType AS DeductibleType1, \n\tRiskUnitGroupCode AS RiskUnitGroupCode1, \n\tRiskUnitGroupDescription AS RiskUnitGroupDescription1, \n\tStandardDeductibleType AS StandardDeductibleType1, \n\tDeductibleLevel AS DeductibleLevel1\n\tFROM RTR_InsertOrUpdate_Insert\n),\nSupDeductibleType_Insert AS (\n\tSET QUOTED_IDENTIFIER ON;\r\n\t\r\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.SupDeductibleType \r\n\t(CreatedDate,ModifiedDate,ModifiedUserId ,SourceSystemId ,InsuranceLine ,CoverageType,DeductibleType,RiskUnitGroupCode, RiskUnitGroupDescription ,StandardDeductibleType ,DeductibleLevel \r\n\t) \n\tSELECT  S.CreatedDate, S.ModifiedDate, S.ModifiedUserId, S.SourceSystemId, S.InsuranceLine, S.CoverageType, S.DeductibleType, S.RiskUnitGroupCode, S.RiskUnitGroupDescription,  S.StandardDeductibleType, S.DeductibleLevel\n\tFROM UPD_Insert S\n),\nUPD_Update AS (\n\tSELECT\n\tlkp_SupDeductibleTypeId AS lkp_SupDeductibleTypeId3, \n\tModifiedDate AS ModifiedDate3, \n\tModifiedUserId AS ModifiedUserId3, \n\tSourceSystemId AS SourceSystemId3, \n\tInsuranceLine AS InsuranceLine3, \n\tCoverageType AS CoverageType3, \n\tDeductibleType AS DeductibleType3, \n\tRiskUnitGroupCode AS RiskUnitGroupCode3, \n\tRiskUnitGroupDescription AS RiskUnitGroupDescription3, \n\tStandardDeductibleType AS StandardDeductibleType3, \n\tDeductibleLevel AS DeductibleLevel3\n\tFROM RTR_InsertOrUpdate_Update\n),\nSupDeductibleType_Update AS (\n\tSET QUOTED_IDENTIFIER ON;\r\n\t\r\n\tUPDATE @{pipeline().parameters.TARGET_TABLE_OWNER}.SupDeductibleType SET ModifiedDate = S.ModifiedDate, ModifiedUserId = S.ModifiedUserId, SourceSystemId = S.SourceSystemId, InsuranceLine = S.InsuranceLine, CoverageType = S.CoverageType, DeductibleType = S.DeductibleType, RiskUnitGroupCode = S.RiskUnitGroupCode, RiskUnitGroupDescription = S.RiskUnitGroupDescription, StandardDeductibleType = S.StandardDeductibleType, DeductibleLevel = S.DeductibleLevel WHERE SupDeductibleTypeId = S.SupDeductibleTypeId\n\tFROM UPD_Update S\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "PolicyDataWarehouse/"
        },
        "annotations": []
    }
}