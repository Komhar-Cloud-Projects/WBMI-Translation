{
    "name": "s_m_FEED_Load_FutureInforcePolicy_DWP_Ins_Upd",
    "properties": {
        "activities": [
            {
                "name": "m_FEED_Load_FutureInforcePolicy_DWP_Ins_Upd",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_BusinessClassDim AS (\n\tSELECT\n\tStrategicBusinessGroupDescription,\n\tBusinessClassCode,\n\tPrimaryBusinessClassificationCode\n\tFROM (\n\t\tSELECT \n\t\t\tStrategicBusinessGroupDescription,\n\t\t\tBusinessClassCode,\n\t\t\tPrimaryBusinessClassificationCode\n\t\tFROM BusinessClassDim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY BusinessClassCode ORDER BY StrategicBusinessGroupDescription) = 1\n),\nSQ_PremiumTransactionFact AS (\n\tdeclare @ProcessDate as datetime\r\n\t\r\n\t\r\n\tset @ProcessDate=cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,-1,GETDATE()) + @{pipeline().parameters.NO_OF_MONTH},0)) as date);\r\n\t\r\n\tselect  \r\n\tcontract_customer_dim.cust_num,\r\n\tpolicy_dim.pol_num,\r\n\tpolicy_dim.pol_key,\r\n\tInsuranceReferenceDim.PolicyOfferingDescription,\r\n\tcontract_customer_dim.name,\r\n\tpolicy_dim.pol_eff_date,\r\n\tdbo.PremiumTransactionFact.DirectWrittenPremium,\r\n\tpolicy_dim.prim_bus_class_code,\r\n\tpolicy_dim.prim_bus_class_code_descript,\r\n\tpolicy_dim.ProgramCode,\r\n\tpolicy_dim.ProgramDescription,\r\n\tCDD.RiskGradeCode,\r\n\tAgencyDim.AgencyCode,\r\n\tAgencyDim.AbbreviatedName,\r\n\tpolicy_dim.pol_issue_code,\r\n\tunderwritingdivisiondim.UnderwritingRegionCodeDescription,\r\n\tSUM(DirectWrittenPremium) OVER (PARTITION BY pol_num,cust_num) as AcctOver150K,\r\n\tdbo.InsuranceReferenceDim.InsuranceReferenceLineOfBusinessDescription,\r\n\t\r\n\tInsuranceReferenceDim.StrategicProfitCenterDescription,\r\n\tSalesDivisionDim.SalesTerritoryCodeDescription,\r\n\tUnderwritingDivisionDim.UnderwriterDisplayName as UnderWriterName,\r\n\tUnderwritingDivisionDim.UnderwriterManagerDisplayName as UnderwriterManagerName,\r\n\tUnderwritingDivisionDim.UnderwriterManagerEmailAddress as UnderwriterManagerEmailAddress,\r\n\tUnderwritingDivisionDim.UnderwriterManagerCode as UnderwriterManagerCode,\r\n\tUnderwritingDivisionDim.UnderwriterEmailAddress as UnderwriterEmailAddress,\r\n\tUnderwritingDivisionDim.UnderwriterCode as UnderwriterCode\r\n\t\r\n\tFROM\r\n\t(\r\n\tselect DISTINCT edw_pol_ak_id from (\r\n\t select \r\n\tpol.pol_dim_id,edw_pol_ak_id,pol_key,pol_eff_date,pol_exp_date,\r\n\tROW_NUMBER() over(partition by pol.pol_num\r\n\t order by edw_pol_ak_id desc,rundate desc) Record_Rank\r\n\t from  PolicyCurrentStatusDim st join Policy_dim pol on pol.pol_dim_id=st.policydimid \r\n\t  where PolicyFutureStatusDescription<>'FutureCancellation'\r\n\t   ) a where Record_Rank=1\r\n\t ) pd INNER JOIN dbo.policy_Dim policy_dim on policy_dim.edw_pol_ak_id=pd.edw_pol_ak_id\r\n\t INNER JOIN  dbo.PremiumTransactionFact ON (policy_dim.pol_dim_id=dbo.PremiumTransactionFact.PolicyDimID)\r\n\t   INNER JOIN calendar_dim  PremBookedDateDim ON (dbo.PremiumTransactionFact.PremiumTransactionBookedDateID=PremBookedDateDim.clndr_id)\r\n\t   INNER JOIN calendar_dim  Transaction_Date_dim ON (dbo.PremiumTransactionFact.PremiumTransactionBookedDateID=Transaction_Date_dim.clndr_id)\r\n\t   INNER JOIN dbo.InsuranceReferenceDim ON (dbo.PremiumTransactionFact.InsuranceReferenceDimId=dbo.InsuranceReferenceDim.InsuranceReferenceDimId)\r\n\t   INNER JOIN V3.AgencyDim ON (V3.AgencyDim.AgencyDimID=dbo.PremiumTransactionFact.AgencyDimID)\r\n\t   INNER JOIN dbo.SalesDivisionDim ON (dbo.SalesDivisionDim.SalesDivisionDimID=V3.AgencyDim.SalesDivisionDimId)\r\n\t   INNER JOIN dbo.AgencyEmployeeDim ON (dbo.AgencyEmployeeDim.AgencyEmployeeDimID=policy_dim.AgencyEmployeeDimID)\r\n\t   INNER JOIN dbo.underwritingdivisiondim ON policy_dim.underwritingdivisiondimid = underwritingdivisiondim.underwritingdivisiondimid\r\n\t   INNER JOIN dbo.contract_customer_dim ON (dbo.contract_customer_dim.contract_cust_dim_id=dbo.PremiumTransactionFact.ContractCustomerDimID)\r\n\t   INNER JOIN DBO.CoverageDetailDim CDD ON (CDD.CoverageDetailDimId = dbo.PremiumTransactionFact.CoverageDetailDimId)\r\n\t   where\r\n\t    dbo.InsuranceReferenceDim.StrategicProfitCenterDescription  IN  ( 'WB - CL','West Bend Commercial Lines','NSI','Argent' )    \r\n\t\tAND policy_dim.pol_issue_code  IN  ( 'N','R' )  and policy_dim.pol_status_code <> 'C'\r\n\t \tand dbo.InsuranceReferenceDim.InsuranceSegmentDescription  IN  ('Commercial Lines')  \r\n\t  and policy_dim.pol_eff_date > @ProcessDate order by 1,2\n),\nExp_passThrough AS (\n\tSELECT\n\tCustomerNumber,\n\tPolicyNumber,\n\tPolicyKey,\n\tPolicyOfferingDescription,\n\tCustomerName,\n\tPolicyEffectiveDate,\n\tPremiumMasterDirectWrittenPremium,\n\tPrimaryBusinessClassCode,\n\t-- *INF*: :Lkp.LKP_BusinessClassDim(PrimaryBusinessClassCode)\n\t'' AS o_StrategicBusinessGroupDescription,\n\tPrimaryBusinessClassCodeDescription,\n\tProgramCode,\n\tProgramDescription,\n\tIndustryRiskGradeCode,\n\t-- *INF*: DECODE (TRUE, IndustryRiskGradeCode='1' , 1 ,\r\n\t-- IndustryRiskGradeCode='2' , 2 ,\r\n\t-- IndustryRiskGradeCode='3' , 3 ,\r\n\t-- IndustryRiskGradeCode='4' , 4 ,\r\n\t-- IndustryRiskGradeCode='5' , 5 ,\r\n\t-- IndustryRiskGradeCode='6' , 6 ,\r\n\t-- IndustryRiskGradeCode='7' , 7 ,\r\n\t-- IndustryRiskGradeCode='8' , 8 ,\r\n\t-- IndustryRiskGradeCode='9' , 9 ,\r\n\t-- IndustryRiskGradeCode='0' , 0 ,\r\n\t-- IndustryRiskGradeCode='D' , 10 ,\r\n\t-- IndustryRiskGradeCode='N/A' , -3 ,\r\n\t-- IndustryRiskGradeCode='DNW' , 11 ,\r\n\t-- IndustryRiskGradeCode='NSI' , -1 ,\r\n\t-- IndustryRiskGradeCode='Argent' , -2 ,-3)\n\tDECODE(\n\t    TRUE,\n\t    IndustryRiskGradeCode = '1', 1,\n\t    IndustryRiskGradeCode = '2', 2,\n\t    IndustryRiskGradeCode = '3', 3,\n\t    IndustryRiskGradeCode = '4', 4,\n\t    IndustryRiskGradeCode = '5', 5,\n\t    IndustryRiskGradeCode = '6', 6,\n\t    IndustryRiskGradeCode = '7', 7,\n\t    IndustryRiskGradeCode = '8', 8,\n\t    IndustryRiskGradeCode = '9', 9,\n\t    IndustryRiskGradeCode = '0', 0,\n\t    IndustryRiskGradeCode = 'D', 10,\n\t    IndustryRiskGradeCode = 'N/A', - 3,\n\t    IndustryRiskGradeCode = 'DNW', 11,\n\t    IndustryRiskGradeCode = 'NSI', - 1,\n\t    IndustryRiskGradeCode = 'Argent', - 2,\n\t    - 3\n\t) AS v_IndustryRiskGradeCode,\n\tv_IndustryRiskGradeCode AS o_IndustryRiskGradeCode,\n\tAgencyCode,\n\tAbbreviatedName,\n\tPolicyIssueCode,\n\tStateOfDomicileCodeDescription,\n\t-- *INF*: Decode(TRUE, ltrim(rtrim(upper(StateOfDomicileCodeDescription)))='EASTERN WISCONSIN' ,'EWI',\r\n\t-- ltrim(rtrim(upper(StateOfDomicileCodeDescription)))='WESTERN WISCONSIN' ,'WWI' ,\r\n\t-- ltrim(rtrim(upper(StateOfDomicileCodeDescription)))='METRO MILWAUKEE' ,'MKE',\r\n\t-- upper(SUBSTR(StateOfDomicileCodeDescription,1,3))\r\n\t--   )\n\tDecode(\n\t    TRUE,\n\t    ltrim(rtrim(upper(StateOfDomicileCodeDescription))) = 'EASTERN WISCONSIN', 'EWI',\n\t    ltrim(rtrim(upper(StateOfDomicileCodeDescription))) = 'WESTERN WISCONSIN', 'WWI',\n\t    ltrim(rtrim(upper(StateOfDomicileCodeDescription))) = 'METRO MILWAUKEE', 'MKE',\n\t    upper(SUBSTR(StateOfDomicileCodeDescription, 1, 3))\n\t) AS UWRegion,\n\tAcctOver150K,\n\t-- *INF*: IIF(AcctOver150K >150000,1,0)\n\tIFF(AcctOver150K > 150000, 1, 0) AS o_AcctOver150K,\n\tPolicyKey AS v_PolicyKey,\n\tCustomerNumber AS v_CustomerNumber,\n\t-- *INF*: IIF(PolicyKey=v_PolicyKey and CustomerNumber=v_CustomerNumber ,\r\n\t-- LineofBusinessDescription||','||v_LineofBusinessDescription,LineofBusinessDescription)\n\tIFF(\n\t    PolicyKey = v_PolicyKey and CustomerNumber = v_CustomerNumber,\n\t    LineofBusinessDescription || ',' || v_LineofBusinessDescription,\n\t    LineofBusinessDescription\n\t) AS v_LineofBusinessDescription,\n\tv_LineofBusinessDescription AS o_LineofBusinessDescription,\n\tStrategicProfitCenterDescription,\n\tSalesTerritoryCodeDescription,\n\tUnderWriterName,\n\tUnderWriterManagerName,\n\tUnderwriterManagerEmailAddress,\n\tUnderwriterManagerCode,\n\tUnderwriterEmailAddress,\n\tUnderwriterCode\n\tFROM SQ_PremiumTransactionFact\n),\nAGG_PolNum_RiskGrade AS (\n\tSELECT\n\tCustomerNumber,\n\tPolicyNumber,\n\tPolicyKey,\n\to_IndustryRiskGradeCode,\n\tPolicyOfferingDescription,\n\tCustomerName,\n\tPolicyEffectiveDate,\n\tPremiumMasterDirectWrittenPremium,\n\t-- *INF*: Round(SUM(PremiumMasterDirectWrittenPremium),4)\n\tRound(SUM(PremiumMasterDirectWrittenPremium), 4) AS o_PremiumMasterDirectWrittenPremium,\n\tPrimaryBusinessClassCode,\n\to_StrategicBusinessGroupDescription,\n\tPrimaryBusinessClassCodeDescription,\n\tProgramCode,\n\tProgramDescription,\n\tAgencyCode,\n\tAbbreviatedName,\n\tPolicyIssueCode,\n\tUWRegion,\n\to_AcctOver150K,\n\to_LineofBusinessDescription,\n\tStrategicProfitCenterDescription,\n\tSalesTerritoryCodeDescription,\n\tUnderWriterName,\n\tUnderWriterManagerName,\n\tUnderwriterManagerEmailAddress,\n\tUnderwriterManagerCode,\n\tUnderwriterEmailAddress,\n\tUnderwriterCode\n\tFROM Exp_passThrough\n\tGROUP BY CustomerNumber, PolicyNumber, o_IndustryRiskGradeCode\n),\nFIL_Premium_not_Zero AS (\n\tSELECT\n\tCustomerNumber, \n\tPolicyNumber, \n\tPolicyKey, \n\tPolicyOfferingDescription, \n\tCustomerName, \n\tPolicyEffectiveDate, \n\to_PremiumMasterDirectWrittenPremium AS PremiumMasterDirectWrittenPremium, \n\tPrimaryBusinessClassCode, \n\to_StrategicBusinessGroupDescription, \n\tPrimaryBusinessClassCodeDescription, \n\tProgramCode, \n\tProgramDescription, \n\to_IndustryRiskGradeCode, \n\tAgencyCode, \n\tAbbreviatedName, \n\tPolicyIssueCode, \n\tUWRegion, \n\to_AcctOver150K, \n\to_LineofBusinessDescription, \n\tStrategicProfitCenterDescription, \n\tSalesTerritoryCodeDescription, \n\tUnderWriterName, \n\tUnderWriterManagerName, \n\tUnderwriterManagerEmailAddress, \n\tUnderwriterManagerCode, \n\tUnderwriterEmailAddress, \n\tUnderwriterCode\n\tFROM AGG_PolNum_RiskGrade\n\tWHERE PremiumMasterDirectWrittenPremium<>0.00\n),\nRTR_New_Renewal AS (\n\tSELECT\n\tCustomerNumber,\n\tPolicyNumber,\n\tPolicyKey,\n\tPolicyOfferingDescription,\n\tCustomerName,\n\tPolicyEffectiveDate,\n\tPremiumMasterDirectWrittenPremium,\n\tPrimaryBusinessClassCode,\n\to_StrategicBusinessGroupDescription AS StrategicBusinessGroupDescription,\n\tPrimaryBusinessClassCodeDescription,\n\tProgramCode,\n\tProgramDescription,\n\to_IndustryRiskGradeCode AS IndustryRiskGradeCode,\n\tAgencyCode,\n\tAbbreviatedName,\n\tPolicyIssueCode,\n\tUWRegion,\n\to_AcctOver150K AS AcctOver150K,\n\to_LineofBusinessDescription AS LineofBusinessDescription,\n\tStrategicProfitCenterDescription,\n\tSalesTerritoryCodeDescription,\n\tUnderWriterName,\n\tUnderWriterManagerName,\n\tUnderwriterManagerEmailAddress,\n\tUnderwriterManagerCode,\n\tUnderwriterEmailAddress,\n\tUnderwriterCode\n\tFROM FIL_Premium_not_Zero\n),\nRTR_New_Renewal_New AS (SELECT * FROM RTR_New_Renewal WHERE PolicyIssueCode='N'),\nRTR_New_Renewal_Renewal AS (SELECT * FROM RTR_New_Renewal WHERE PolicyIssueCode='R'),\nLkp_CommercialProductManagementExtract AS (\n\tSELECT\n\tCustomerNumber,\n\tPolicyNumber,\n\tin_CustomerNumber,\n\tin_PolicyNumber\n\tFROM (\n\t\tSELECT \n\t\t\tCustomerNumber,\n\t\t\tPolicyNumber,\n\t\t\tin_CustomerNumber,\n\t\t\tin_PolicyNumber\n\t\tFROM CommercialProductManagementExtract\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY CustomerNumber,PolicyNumber ORDER BY CustomerNumber) = 1\n),\nExp_Insert_Upate AS (\n\tSELECT\n\tLkp_CommercialProductManagementExtract.PolicyNumber AS lkp_PolicyNumber,\n\t-- *INF*: IIF(isnull(lkp_PolicyNumber),0,1)\n\tIFF(lkp_PolicyNumber IS NULL, 0, 1) AS Flag,\n\tRTR_New_Renewal_New.CustomerNumber,\n\tRTR_New_Renewal_New.PolicyNumber,\n\tRTR_New_Renewal_New.PolicyKey,\n\tRTR_New_Renewal_New.PolicyOfferingDescription,\n\tRTR_New_Renewal_New.CustomerName,\n\tRTR_New_Renewal_New.PolicyEffectiveDate,\n\tRTR_New_Renewal_New.PremiumMasterDirectWrittenPremium,\n\tRTR_New_Renewal_New.PrimaryBusinessClassCode,\n\tRTR_New_Renewal_New.PrimaryBusinessClassCodeDescription,\n\tRTR_New_Renewal_New.ProgramCode,\n\tRTR_New_Renewal_New.ProgramDescription,\n\tRTR_New_Renewal_New.IndustryRiskGradeCode,\n\tRTR_New_Renewal_New.AgencyCode,\n\tRTR_New_Renewal_New.AbbreviatedName,\n\tRTR_New_Renewal_New.PolicyIssueCode,\n\tRTR_New_Renewal_New.UWRegion,\n\tRTR_New_Renewal_New.StrategicBusinessGroupDescription,\n\tRTR_New_Renewal_New.AcctOver150K,\n\tRTR_New_Renewal_New.StrategicProfitCenterDescription AS StrategicProfitCenterDescription1,\n\tRTR_New_Renewal_New.SalesTerritoryCodeDescription AS SalesTerritoryCodeDescription1,\n\tRTR_New_Renewal_New.UnderWriterName AS UnderWriterName1,\n\tRTR_New_Renewal_New.UnderWriterManagerName AS UnderWriterManagerName1,\n\tRTR_New_Renewal_New.UnderwriterManagerEmailAddress AS UnderwriterManagerEmailAddress1,\n\tRTR_New_Renewal_New.UnderwriterManagerCode AS UnderwriterManagerCode1,\n\tRTR_New_Renewal_New.UnderwriterEmailAddress AS UnderwriterEmailAddress1,\n\tRTR_New_Renewal_New.UnderwriterCode AS UnderwriterCode1\n\tFROM RTR_New_Renewal_New\n\tLEFT JOIN Lkp_CommercialProductManagementExtract\n\tON Lkp_CommercialProductManagementExtract.CustomerNumber = RTR_New_Renewal.CustomerNumber1 AND Lkp_CommercialProductManagementExtract.PolicyNumber = RTR_New_Renewal.PolicyNumber1\n),\nRTR_Insert_Update AS (\n\tSELECT\n\tFlag,\n\tCustomerNumber,\n\tPolicyNumber,\n\tPolicyKey,\n\tPolicyOfferingDescription,\n\tCustomerName,\n\tPolicyEffectiveDate,\n\tPremiumMasterDirectWrittenPremium,\n\tPrimaryBusinessClassCode,\n\tPrimaryBusinessClassCodeDescription,\n\tProgramCode,\n\tProgramDescription,\n\tIndustryRiskGradeCode,\n\tAgencyCode,\n\tAbbreviatedName,\n\tPolicyIssueCode,\n\tUWRegion,\n\tStrategicBusinessGroupDescription,\n\tAcctOver150K,\n\tStrategicProfitCenterDescription1,\n\tSalesTerritoryCodeDescription1,\n\tUnderWriterName1,\n\tUnderWriterManagerName1,\n\tUnderwriterManagerEmailAddress1,\n\tUnderwriterManagerCode1,\n\tUnderwriterEmailAddress1,\n\tUnderwriterCode1\n\tFROM Exp_Insert_Upate\n),\nRTR_Insert_Update_Insert AS (SELECT * FROM RTR_Insert_Update WHERE Flag=0),\nRTR_Insert_Update_Update AS (SELECT * FROM RTR_Insert_Update WHERE Flag=1),\nAgg_DWP_New AS (\n\tSELECT\n\tCustomerNumber,\n\tPolicyNumber,\n\tPolicyKey,\n\tPolicyOfferingDescription,\n\tCustomerName,\n\tPolicyEffectiveDate,\n\tPremiumMasterDirectWrittenPremium,\n\tPrimaryBusinessClassCode,\n\tPrimaryBusinessClassCodeDescription,\n\tProgramCode,\n\tProgramDescription,\n\tIndustryRiskGradeCode,\n\t-- *INF*: max(IndustryRiskGradeCode)\n\tmax(IndustryRiskGradeCode) AS o_IndustryRiskGradeCode,\n\tAgencyCode,\n\tAbbreviatedName,\n\tPolicyIssueCode,\n\tUWRegion AS UnderwritingRegionCodeDescription,\n\tStrategicBusinessGroupDescription,\n\t-- *INF*: sum(PremiumMasterDirectWrittenPremium)\n\tsum(PremiumMasterDirectWrittenPremium) AS o_DWP,\n\t-- *INF*: IIF(sum(PremiumMasterDirectWrittenPremium) >150000,1,0)\n\tIFF(sum(PremiumMasterDirectWrittenPremium) > 150000, 1, 0) AS AcctOver150K,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditID,\n\tSysdate AS CreateDate,\n\tsysdate AS ModifiedDate,\n\t-- *INF*: ADD_TO_DATE(SYSDATE,'MM',-1)\n\tDATEADD(MONTH,- 1,CURRENT_TIMESTAMP) AS RunDate,\n\t0 AS DirectLossIncurred,\n\t0 AS DirectLossIncurredRatio,\n\t0 AS DirectLossIncurred3Yrs,\n\t0 AS DirectLossIncurredRatio3Yrs,\n\tStrategicProfitCenterDescription,\n\tSalesTerritoryCodeDescription,\n\tUnderWriterName,\n\tUnderWriterManagerName,\n\tUnderwriterManagerEmailAddress AS UnderwriterManagerEmailAddress11,\n\tUnderwriterManagerCode AS UnderwriterManagerCode11,\n\tUnderwriterEmailAddress AS UnderwriterEmailAddress11,\n\tUnderwriterCode AS UnderwriterCode11\n\tFROM RTR_Insert_Update_Insert\n\tGROUP BY CustomerNumber, PolicyNumber\n),\nSRT_InsuranceLineofBusiness AS (\n\tSELECT\n\tCustomerNumber, \n\tPolicyNumber, \n\tInsuranceReferenceLineOfBusinessDescription\n\tFROM SQ_PremiumTransactionFact\n\tORDER BY CustomerNumber ASC, PolicyNumber ASC, InsuranceReferenceLineOfBusinessDescription ASC\n),\nmplt_InsuranceLineofBusiness AS (WITH\n\tMap_InsuranceLineofBusiness AS (\n\t\t\n\t),\n\tExp_InsuranceLineofBusiness AS (\n\t\tSELECT\n\t\tCustomerNumber,\n\t\tPolicyNumber,\n\t\tInsuranceReferenceLineOfBusinessDescription,\n\t\t-- *INF*: IIF(CustomerNumber=v_Prev_CustomerNumber and\r\n\t\t-- PolicyNumber=v_Prev_PolicyNumber\r\n\t\t-- ,InsuranceReferenceLineOfBusinessDescription||';'||v_InsuranceReferenceLineOfBusinessDescription,InsuranceReferenceLineOfBusinessDescription)\n\t\tIFF(\n\t\t    CustomerNumber = v_Prev_CustomerNumber and PolicyNumber = v_Prev_PolicyNumber,\n\t\t    InsuranceReferenceLineOfBusinessDescription || ';' || v_InsuranceReferenceLineOfBusinessDescription,\n\t\t    InsuranceReferenceLineOfBusinessDescription\n\t\t) AS v_InsuranceReferenceLineOfBusinessDescription,\n\t\tCustomerNumber AS v_Prev_CustomerNumber,\n\t\tPolicyNumber AS v_Prev_PolicyNumber,\n\t\tv_InsuranceReferenceLineOfBusinessDescription AS o_InsuranceReferenceLineOfBusinessDescription\n\t\tFROM Map_InsuranceLineofBusiness\n\t),\n\tagg AS (\n\t\tSELECT\n\t\tCustomerNumber,\n\t\tPolicyNumber,\n\t\to_InsuranceReferenceLineOfBusinessDescription\n\t\tFROM Exp_InsuranceLineofBusiness\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY CustomerNumber, PolicyNumber ORDER BY NULL) = 1\n\t),\n\tInsuranceLineofBusiness AS (\n\t\tSELECT\n\t\tCustomerNumber, \n\t\tPolicyNumber, \n\t\to_InsuranceReferenceLineOfBusinessDescription\n\t\tFROM agg\n\t),\n),\nJNR_New_DWP AS (SELECT\n\tAgg_DWP_New.CustomerNumber, \n\tAgg_DWP_New.PolicyNumber, \n\tAgg_DWP_New.PolicyKey, \n\tAgg_DWP_New.PolicyOfferingDescription, \n\tAgg_DWP_New.CustomerName, \n\tAgg_DWP_New.PolicyEffectiveDate, \n\tAgg_DWP_New.PrimaryBusinessClassCode, \n\tAgg_DWP_New.PrimaryBusinessClassCodeDescription, \n\tAgg_DWP_New.ProgramCode, \n\tAgg_DWP_New.ProgramDescription, \n\tAgg_DWP_New.o_IndustryRiskGradeCode AS IndustryRiskGradeCode, \n\tAgg_DWP_New.AgencyCode, \n\tAgg_DWP_New.AbbreviatedName, \n\tAgg_DWP_New.PolicyIssueCode, \n\tAgg_DWP_New.UnderwritingRegionCodeDescription, \n\tAgg_DWP_New.StrategicBusinessGroupDescription, \n\tAgg_DWP_New.AcctOver150K, \n\tAgg_DWP_New.o_DWP AS DWP, \n\tAgg_DWP_New.AuditID, \n\tAgg_DWP_New.CreateDate, \n\tAgg_DWP_New.ModifiedDate, \n\tAgg_DWP_New.RunDate, \n\tAgg_DWP_New.DirectLossIncurred, \n\tAgg_DWP_New.DirectLossIncurredRatio, \n\tAgg_DWP_New.DirectLossIncurred3Yrs, \n\tAgg_DWP_New.DirectLossIncurredRatio3Yrs, \n\tmplt_InsuranceLineofBusiness.CustomerNumber1, \n\tmplt_InsuranceLineofBusiness.PolicyNumber1, \n\tmplt_InsuranceLineofBusiness.o_InsuranceReferenceLineOfBusinessDescription, \n\tAgg_DWP_New.StrategicProfitCenterDescription AS StrategicProfitCenterDescription11, \n\tAgg_DWP_New.SalesTerritoryCodeDescription AS SalesTerritoryCodeDescription11, \n\tAgg_DWP_New.UnderWriterName AS UnderWriterName11, \n\tAgg_DWP_New.UnderWriterManagerName AS UnderWriterManagerName11, \n\tAgg_DWP_New.UnderwriterManagerEmailAddress11, \n\tAgg_DWP_New.UnderwriterManagerCode11, \n\tAgg_DWP_New.UnderwriterEmailAddress11, \n\tAgg_DWP_New.UnderwriterCode11\n\tFROM Agg_DWP_New\n\tLEFT OUTER JOIN mplt_InsuranceLineofBusiness\n\tON mplt_InsuranceLineofBusiness.CustomerNumber1 = Agg_DWP_New.CustomerNumber AND mplt_InsuranceLineofBusiness.PolicyNumber1 = Agg_DWP_New.PolicyNumber\n),\nEXP_Decoding_Industry_riskgrade_New AS (\n\tSELECT\n\tCustomerNumber,\n\tPolicyNumber,\n\tPolicyKey,\n\tPolicyOfferingDescription,\n\tCustomerName,\n\tPolicyEffectiveDate,\n\tPrimaryBusinessClassCode,\n\tPrimaryBusinessClassCodeDescription,\n\tProgramCode,\n\tProgramDescription,\n\tIndustryRiskGradeCode,\n\t-- *INF*: DECODE (TRUE,IndustryRiskGradeCode=1 , '1' ,\r\n\t-- IndustryRiskGradeCode=2 , '2' ,\r\n\t-- IndustryRiskGradeCode=3 , '3' ,\r\n\t-- IndustryRiskGradeCode=4 , '4' ,\r\n\t-- IndustryRiskGradeCode=5 , '5' ,\r\n\t-- IndustryRiskGradeCode=6 , '6' ,\r\n\t-- IndustryRiskGradeCode=7 , '7' ,\r\n\t-- IndustryRiskGradeCode=8 , '8' ,\r\n\t-- IndustryRiskGradeCode=9 , '9' ,\r\n\t-- IndustryRiskGradeCode=0 , '0' ,\r\n\t-- IndustryRiskGradeCode=10 , 'D' ,\r\n\t-- IndustryRiskGradeCode=-3 , 'N/A' ,\r\n\t-- IndustryRiskGradeCode=11 , 'DNW' ,\r\n\t-- IndustryRiskGradeCode=-1 , 'NSI' ,\r\n\t-- IndustryRiskGradeCode=-2 , 'Argent' ,'N/A')\n\tDECODE(\n\t    TRUE,\n\t    IndustryRiskGradeCode = 1, '1',\n\t    IndustryRiskGradeCode = 2, '2',\n\t    IndustryRiskGradeCode = 3, '3',\n\t    IndustryRiskGradeCode = 4, '4',\n\t    IndustryRiskGradeCode = 5, '5',\n\t    IndustryRiskGradeCode = 6, '6',\n\t    IndustryRiskGradeCode = 7, '7',\n\t    IndustryRiskGradeCode = 8, '8',\n\t    IndustryRiskGradeCode = 9, '9',\n\t    IndustryRiskGradeCode = 0, '0',\n\t    IndustryRiskGradeCode = 10, 'D',\n\t    IndustryRiskGradeCode = - 3, 'N/A',\n\t    IndustryRiskGradeCode = 11, 'DNW',\n\t    IndustryRiskGradeCode = - 1, 'NSI',\n\t    IndustryRiskGradeCode = - 2, 'Argent',\n\t    'N/A'\n\t) AS o_IndustryRiskGradeCode,\n\tAgencyCode,\n\tAbbreviatedName,\n\tPolicyIssueCode,\n\tUnderwritingRegionCodeDescription,\n\tStrategicBusinessGroupDescription,\n\tAcctOver150K,\n\tDWP,\n\tAuditID,\n\tCreateDate,\n\tModifiedDate,\n\tRunDate,\n\tDirectLossIncurred,\n\tDirectLossIncurredRatio,\n\tDirectLossIncurred3Yrs,\n\tDirectLossIncurredRatio3Yrs,\n\to_InsuranceReferenceLineOfBusinessDescription,\n\tStrategicProfitCenterDescription11,\n\tSalesTerritoryCodeDescription11,\n\tUnderWriterName11,\n\tUnderWriterManagerName11,\n\tUnderwriterManagerEmailAddress11,\n\tUnderwriterManagerCode11,\n\tUnderwriterEmailAddress11,\n\tUnderwriterCode11\n\tFROM JNR_New_DWP\n),\nUpd_Insert AS (\n\tSELECT\n\tCustomerNumber, \n\tPolicyNumber, \n\tPolicyKey, \n\tPolicyOfferingDescription, \n\tCustomerName, \n\tPolicyEffectiveDate, \n\tPrimaryBusinessClassCode, \n\tPrimaryBusinessClassCodeDescription, \n\tProgramCode, \n\tProgramDescription, \n\to_IndustryRiskGradeCode AS IndustryRiskGradeCode, \n\tAgencyCode, \n\tAbbreviatedName, \n\tPolicyIssueCode, \n\tUnderwritingRegionCodeDescription, \n\tStrategicBusinessGroupDescription, \n\tAcctOver150K, \n\tDWP, \n\tAuditID, \n\tCreateDate, \n\tModifiedDate, \n\tRunDate, \n\to_InsuranceReferenceLineOfBusinessDescription AS LineofBusinessDescription, \n\tDirectLossIncurred, \n\tDirectLossIncurredRatio, \n\tDirectLossIncurred3Yrs, \n\tDirectLossIncurredRatio3Yrs, \n\tStrategicProfitCenterDescription11, \n\tSalesTerritoryCodeDescription11, \n\tUnderWriterName11, \n\tUnderWriterManagerName11, \n\tUnderwriterManagerEmailAddress11, \n\tUnderwriterManagerCode11, \n\tUnderwriterEmailAddress11, \n\tUnderwriterCode11\n\tFROM EXP_Decoding_Industry_riskgrade_New\n),\nCommercialProductManagementExtract_New_Insert AS (\n\tINSERT INTO CommercialProductManagementExtract\n\t(AuditId, ModifiedDate, CustomerNumber, PolicyNumber, PolicyOfferingDescription, FirstNamedInsured, PolicyEffectiveDate, DirectWrittenPremium, DirectLossIncurred, DirectLossIncurredRatio, DirectLossIncurred3Yrs, DirectLossIncurredRatio3Yrs, PrimaryBusinessClassCode, PrimaryBusinessClassDescription, StrategicProfitCenterDescription, ProgramCode, ProgramDescription, IndustryRiskGradeCode, AgencyCode, AbbreviatedAgencyName, UnderwritingRegionCodeDescription, PolicyIssueCode, RunDate, AccountOver150KFlag, InsuranceReferenceLineOfBusinessDescription, UnderWriterName, UnderWriterManagerName, StrategicBusinessGroupDescription, SalesTerritoryDescription, UnderwriterManagerEmailAddress, UnderwriterManagerCode, UnderwriterEmailAddress, UnderwriterCode)\n\tSELECT \n\tAuditID AS AUDITID, \n\tCreateDate AS MODIFIEDDATE, \n\tCUSTOMERNUMBER, \n\tPOLICYNUMBER, \n\tPOLICYOFFERINGDESCRIPTION, \n\tCustomerName AS FIRSTNAMEDINSURED, \n\tPOLICYEFFECTIVEDATE, \n\tDWP AS DIRECTWRITTENPREMIUM, \n\tDIRECTLOSSINCURRED, \n\tDIRECTLOSSINCURREDRATIO, \n\tDIRECTLOSSINCURRED3YRS, \n\tDIRECTLOSSINCURREDRATIO3YRS, \n\tPRIMARYBUSINESSCLASSCODE, \n\tPrimaryBusinessClassCodeDescription AS PRIMARYBUSINESSCLASSDESCRIPTION, \n\tStrategicProfitCenterDescription11 AS STRATEGICPROFITCENTERDESCRIPTION, \n\tPROGRAMCODE, \n\tPROGRAMDESCRIPTION, \n\tINDUSTRYRISKGRADECODE, \n\tAGENCYCODE, \n\tAbbreviatedName AS ABBREVIATEDAGENCYNAME, \n\tUNDERWRITINGREGIONCODEDESCRIPTION, \n\tPOLICYISSUECODE, \n\tRUNDATE, \n\tAcctOver150K AS ACCOUNTOVER150KFLAG, \n\tLineofBusinessDescription AS INSURANCEREFERENCELINEOFBUSINESSDESCRIPTION, \n\tUnderWriterName11 AS UNDERWRITERNAME, \n\tUnderWriterManagerName11 AS UNDERWRITERMANAGERNAME, \n\tSTRATEGICBUSINESSGROUPDESCRIPTION, \n\tSalesTerritoryCodeDescription11 AS SALESTERRITORYDESCRIPTION, \n\tUnderwriterManagerEmailAddress11 AS UNDERWRITERMANAGEREMAILADDRESS, \n\tUnderwriterManagerCode11 AS UNDERWRITERMANAGERCODE, \n\tUnderwriterEmailAddress11 AS UNDERWRITEREMAILADDRESS, \n\tUnderwriterCode11 AS UNDERWRITERCODE\n\tFROM Upd_Insert\n),\nAgg_DWP AS (\n\tSELECT\n\tCustomerNumber,\n\tPolicyNumber,\n\tPolicyOfferingDescription,\n\tCustomerName,\n\tPolicyEffectiveDate,\n\tPremiumMasterDirectWrittenPremium,\n\tPrimaryBusinessClassCode,\n\tPrimaryBusinessClassCodeDescription,\n\tProgramCode,\n\tProgramDescription,\n\tIndustryRiskGradeCode,\n\t-- *INF*: max(IndustryRiskGradeCode)\n\tmax(IndustryRiskGradeCode) AS o_IndustryRiskGradeCode,\n\tAgencyCode,\n\tAbbreviatedName,\n\tPolicyIssueCode,\n\tUWRegion AS UnderwritingRegionCodeDescription,\n\tStrategicBusinessGroupDescription,\n\t-- *INF*: sum(PremiumMasterDirectWrittenPremium)\n\tsum(PremiumMasterDirectWrittenPremium) AS o_DWP,\n\t-- *INF*: IIF(sum(PremiumMasterDirectWrittenPremium) >150000,1,0)\n\tIFF(sum(PremiumMasterDirectWrittenPremium) > 150000, 1, 0) AS AcctOver150K,\n\t0 AS DirectLossIncurred,\n\t0 AS DirectLossIncurredRatio,\n\t0 AS DirectLossIncurred3Yrs,\n\t0 AS DirectLossIncurredRatio3Yrs,\n\tStrategicProfitCenterDescription,\n\tSalesTerritoryCodeDescription,\n\tUnderWriterName,\n\tUnderWriterManagerName,\n\tUnderwriterManagerEmailAddress AS UnderwriterManagerEmailAddress3,\n\tUnderwriterManagerCode AS UnderwriterManagerCode3,\n\tUnderwriterEmailAddress AS UnderwriterEmailAddress3,\n\tUnderwriterCode AS UnderwriterCode3\n\tFROM RTR_New_Renewal_Renewal\n\tGROUP BY CustomerNumber, PolicyNumber\n),\nJNR_Renewal_Insurance AS (SELECT\n\tAgg_DWP.CustomerNumber, \n\tAgg_DWP.PolicyNumber, \n\tAgg_DWP.PolicyKey, \n\tAgg_DWP.PolicyOfferingDescription, \n\tAgg_DWP.CustomerName, \n\tAgg_DWP.PolicyEffectiveDate, \n\tAgg_DWP.PremiumMasterDirectWrittenPremium, \n\tAgg_DWP.PrimaryBusinessClassCode, \n\tAgg_DWP.PrimaryBusinessClassCodeDescription, \n\tAgg_DWP.ProgramCode, \n\tAgg_DWP.ProgramDescription, \n\tAgg_DWP.o_IndustryRiskGradeCode AS IndustryRiskGradeCode, \n\tAgg_DWP.AgencyCode, \n\tAgg_DWP.AbbreviatedName, \n\tAgg_DWP.PolicyIssueCode, \n\tAgg_DWP.UnderwritingRegionCodeDescription, \n\tAgg_DWP.StrategicBusinessGroupDescription, \n\tAgg_DWP.AcctOver150K, \n\tAgg_DWP.o_DWP, \n\tAgg_DWP.DirectLossIncurred, \n\tAgg_DWP.DirectLossIncurredRatio, \n\tAgg_DWP.DirectLossIncurred3Yrs, \n\tAgg_DWP.DirectLossIncurredRatio3Yrs, \n\tAgg_DWP.StrategicProfitCenterDescription, \n\tAgg_DWP.SalesTerritoryCodeDescription, \n\tAgg_DWP.UnderWriterName, \n\tAgg_DWP.UnderWriterManagerName, \n\tAgg_DWP.UnderwriterManagerEmailAddress3, \n\tAgg_DWP.UnderwriterManagerCode3, \n\tAgg_DWP.UnderwriterEmailAddress3, \n\tAgg_DWP.UnderwriterCode3, \n\tmplt_InsuranceLineofBusiness.CustomerNumber1 AS InsuranceLOB_CustomerNumber, \n\tmplt_InsuranceLineofBusiness.PolicyNumber1 AS InsuranceLOB_PolicyNumber, \n\tmplt_InsuranceLineofBusiness.o_InsuranceReferenceLineOfBusinessDescription AS InsuranceLOB_InsuranceReferenceLineOfBusinessDescription\n\tFROM Agg_DWP\n\tLEFT OUTER JOIN mplt_InsuranceLineofBusiness\n\tON mplt_InsuranceLineofBusiness.CustomerNumber1 = Agg_DWP.CustomerNumber AND mplt_InsuranceLineofBusiness.PolicyNumber1 = Agg_DWP.PolicyNumber\n),\nEXP_Decoding_Industry_riskgrade AS (\n\tSELECT\n\tCustomerNumber,\n\tPolicyNumber,\n\tPolicyOfferingDescription,\n\tCustomerName,\n\tPolicyEffectiveDate,\n\tPrimaryBusinessClassCode,\n\tPrimaryBusinessClassCodeDescription,\n\tProgramCode,\n\tProgramDescription,\n\tIndustryRiskGradeCode,\n\t-- *INF*: DECODE (TRUE,IndustryRiskGradeCode=1 , '1' ,\r\n\t-- IndustryRiskGradeCode=2 , '2' ,\r\n\t-- IndustryRiskGradeCode=3 , '3' ,\r\n\t-- IndustryRiskGradeCode=4 , '4' ,\r\n\t-- IndustryRiskGradeCode=5 , '5' ,\r\n\t-- IndustryRiskGradeCode=6 , '6' ,\r\n\t-- IndustryRiskGradeCode=7 , '7' ,\r\n\t-- IndustryRiskGradeCode=8 , '8' ,\r\n\t-- IndustryRiskGradeCode=9 , '9' ,\r\n\t-- IndustryRiskGradeCode=0 , '0' ,\r\n\t-- IndustryRiskGradeCode=10 , 'D' ,\r\n\t-- IndustryRiskGradeCode=-3 , 'N/A' ,\r\n\t-- IndustryRiskGradeCode=11 , 'DNW' ,\r\n\t-- IndustryRiskGradeCode=-1 , 'NSI' ,\r\n\t-- IndustryRiskGradeCode=-2 , 'Argent' ,'N/A')\n\tDECODE(\n\t    TRUE,\n\t    IndustryRiskGradeCode = 1, '1',\n\t    IndustryRiskGradeCode = 2, '2',\n\t    IndustryRiskGradeCode = 3, '3',\n\t    IndustryRiskGradeCode = 4, '4',\n\t    IndustryRiskGradeCode = 5, '5',\n\t    IndustryRiskGradeCode = 6, '6',\n\t    IndustryRiskGradeCode = 7, '7',\n\t    IndustryRiskGradeCode = 8, '8',\n\t    IndustryRiskGradeCode = 9, '9',\n\t    IndustryRiskGradeCode = 0, '0',\n\t    IndustryRiskGradeCode = 10, 'D',\n\t    IndustryRiskGradeCode = - 3, 'N/A',\n\t    IndustryRiskGradeCode = 11, 'DNW',\n\t    IndustryRiskGradeCode = - 1, 'NSI',\n\t    IndustryRiskGradeCode = - 2, 'Argent',\n\t    'N/A'\n\t) AS o_IndustryRiskGradeCode,\n\tAgencyCode,\n\tAbbreviatedName,\n\tPolicyIssueCode,\n\tUnderwritingRegionCodeDescription,\n\tStrategicBusinessGroupDescription,\n\tAcctOver150K,\n\to_DWP,\n\tInsuranceLOB_InsuranceReferenceLineOfBusinessDescription,\n\tStrategicProfitCenterDescription,\n\tSalesTerritoryCodeDescription,\n\tUnderWriterName,\n\tUnderWriterManagerName,\n\tUnderwriterManagerEmailAddress3,\n\tUnderwriterManagerCode3,\n\tUnderwriterEmailAddress3,\n\tUnderwriterCode3\n\tFROM JNR_Renewal_Insurance\n),\nUpd_Update_Renewal AS (\n\tSELECT\n\tCustomerNumber, \n\tPolicyNumber, \n\tPolicyOfferingDescription, \n\tCustomerName, \n\tPolicyEffectiveDate, \n\tPrimaryBusinessClassCode, \n\tPrimaryBusinessClassCodeDescription, \n\tProgramCode, \n\tProgramDescription, \n\to_IndustryRiskGradeCode AS IndustryRiskGradeCode, \n\tAgencyCode, \n\tAbbreviatedName, \n\tPolicyIssueCode, \n\tUnderwritingRegionCodeDescription, \n\tStrategicProfitCenterDescription, \n\tAcctOver150K, \n\to_DWP AS DWP, \n\tInsuranceLOB_InsuranceReferenceLineOfBusinessDescription AS InsuranceReferenceLineOfBusinessDescription, \n\tStrategicBusinessGroupDescription, \n\tSalesTerritoryCodeDescription, \n\tUnderWriterName, \n\tUnderWriterManagerName, \n\tUnderwriterManagerEmailAddress3, \n\tUnderwriterManagerCode3, \n\tUnderwriterEmailAddress3, \n\tUnderwriterCode3\n\tFROM EXP_Decoding_Industry_riskgrade\n),\nCommercialProductManagementExtract_Renwal_Update AS (\n\tMERGE INTO CommercialProductManagementExtract AS T\n\tUSING Upd_Update_Renewal AS S\n\tON T.CustomerNumber = S.CustomerNumber\n\tAND T.PolicyNumber = S.PolicyNumber\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.PolicyOfferingDescription = S.PolicyOfferingDescription, T.FirstNamedInsured = S.CustomerName, T.PolicyEffectiveDate = S.PolicyEffectiveDate, T.DirectWrittenPremium = S.DWP, T.PrimaryBusinessClassCode = S.PrimaryBusinessClassCode, T.PrimaryBusinessClassDescription = S.PrimaryBusinessClassCodeDescription, T.StrategicProfitCenterDescription = S.StrategicProfitCenterDescription, T.ProgramCode = S.ProgramCode, T.ProgramDescription = S.ProgramDescription, T.IndustryRiskGradeCode = S.IndustryRiskGradeCode, T.AgencyCode = S.AgencyCode, T.AbbreviatedAgencyName = S.AbbreviatedName, T.UnderwritingRegionCodeDescription = S.UnderwritingRegionCodeDescription, T.PolicyIssueCode = S.PolicyIssueCode, T.AccountOver150KFlag = S.AcctOver150K, T.InsuranceReferenceLineOfBusinessDescription = S.InsuranceReferenceLineOfBusinessDescription, T.UnderWriterName = S.UnderWriterName, T.UnderWriterManagerName = S.UnderWriterManagerName, T.StrategicBusinessGroupDescription = S.StrategicBusinessGroupDescription, T.SalesTerritoryDescription = S.SalesTerritoryCodeDescription, T.UnderwriterManagerEmailAddress = S.UnderwriterManagerEmailAddress3, T.UnderwriterManagerCode = S.UnderwriterManagerCode3, T.UnderwriterEmailAddress = S.UnderwriterEmailAddress3, T.UnderwriterCode = S.UnderwriterCode3\n),\nAgg_DWP_Update AS (\n\tSELECT\n\tCustomerNumber,\n\tPolicyNumber,\n\tPolicyKey,\n\tPolicyOfferingDescription,\n\tCustomerName,\n\tPolicyEffectiveDate,\n\tPremiumMasterDirectWrittenPremium,\n\tPrimaryBusinessClassCode,\n\tPrimaryBusinessClassCodeDescription,\n\tProgramCode,\n\tProgramDescription,\n\tIndustryRiskGradeCode,\n\t-- *INF*: max(IndustryRiskGradeCode)\n\tmax(IndustryRiskGradeCode) AS o_IndustryRiskGradeCode,\n\tAgencyCode,\n\tAbbreviatedName,\n\tPolicyIssueCode,\n\tUWRegion AS StateOfDomicileCodeDescription,\n\tStrategicBusinessGroupDescription,\n\t-- *INF*: sum(PremiumMasterDirectWrittenPremium)\n\tsum(PremiumMasterDirectWrittenPremium) AS o_DWP,\n\t-- *INF*: IIF(sum(PremiumMasterDirectWrittenPremium) >150000,1,0)\n\tIFF(sum(PremiumMasterDirectWrittenPremium) > 150000, 1, 0) AS AcctOver150K,\n\tStrategicProfitCenterDescription1 AS StrategicProfitCenterDescription,\n\tSalesTerritoryCodeDescription1 AS SalesTerritoryCodeDescription,\n\tUnderWriterName1 AS UnderWriterName,\n\tUnderWriterManagerName1 AS UnderWriterManagerName,\n\tUnderwriterManagerEmailAddress1 AS UnderwriterManagerEmailAddress13,\n\tUnderwriterManagerCode1 AS UnderwriterManagerCode13,\n\tUnderwriterEmailAddress1 AS UnderwriterEmailAddress13,\n\tUnderwriterCode1 AS UnderwriterCode13\n\tFROM RTR_Insert_Update_Update\n\tGROUP BY CustomerNumber, PolicyNumber\n),\nJNR_New_DWP_Update AS (SELECT\n\tAgg_DWP_Update.CustomerNumber, \n\tAgg_DWP_Update.PolicyNumber, \n\tAgg_DWP_Update.PolicyKey, \n\tAgg_DWP_Update.PolicyOfferingDescription, \n\tAgg_DWP_Update.CustomerName, \n\tAgg_DWP_Update.PolicyEffectiveDate, \n\tAgg_DWP_Update.PrimaryBusinessClassCode, \n\tAgg_DWP_Update.PrimaryBusinessClassCodeDescription, \n\tAgg_DWP_Update.ProgramCode, \n\tAgg_DWP_Update.ProgramDescription, \n\tAgg_DWP_Update.o_IndustryRiskGradeCode AS IndustryRiskGradeCode, \n\tAgg_DWP_Update.AgencyCode, \n\tAgg_DWP_Update.AbbreviatedName, \n\tAgg_DWP_Update.PolicyIssueCode, \n\tAgg_DWP_Update.StateOfDomicileCodeDescription, \n\tAgg_DWP_Update.StrategicBusinessGroupDescription, \n\tAgg_DWP_Update.AcctOver150K, \n\tAgg_DWP_Update.o_DWP AS DWP, \n\tmplt_InsuranceLineofBusiness.CustomerNumber1, \n\tmplt_InsuranceLineofBusiness.PolicyNumber1, \n\tmplt_InsuranceLineofBusiness.o_InsuranceReferenceLineOfBusinessDescription, \n\tAgg_DWP_Update.StrategicProfitCenterDescription, \n\tAgg_DWP_Update.SalesTerritoryCodeDescription, \n\tAgg_DWP_Update.UnderWriterName, \n\tAgg_DWP_Update.UnderWriterManagerName, \n\tAgg_DWP_Update.UnderwriterManagerEmailAddress13, \n\tAgg_DWP_Update.UnderwriterManagerCode13, \n\tAgg_DWP_Update.UnderwriterEmailAddress13, \n\tAgg_DWP_Update.UnderwriterCode13\n\tFROM Agg_DWP_Update\n\tLEFT OUTER JOIN mplt_InsuranceLineofBusiness\n\tON mplt_InsuranceLineofBusiness.CustomerNumber1 = Agg_DWP_Update.CustomerNumber AND mplt_InsuranceLineofBusiness.PolicyNumber1 = Agg_DWP_Update.PolicyNumber\n),\nEXP_Decoding_Industry_riskgrade_update AS (\n\tSELECT\n\tCustomerNumber,\n\tPolicyNumber,\n\tPolicyKey,\n\tPolicyOfferingDescription,\n\tCustomerName,\n\tPolicyEffectiveDate,\n\tPrimaryBusinessClassCode,\n\tPrimaryBusinessClassCodeDescription,\n\tProgramCode,\n\tProgramDescription,\n\tIndustryRiskGradeCode,\n\t-- *INF*: DECODE (TRUE,IndustryRiskGradeCode=1 , '1' ,\r\n\t-- IndustryRiskGradeCode=2 , '2' ,\r\n\t-- IndustryRiskGradeCode=3 , '3' ,\r\n\t-- IndustryRiskGradeCode=4 , '4' ,\r\n\t-- IndustryRiskGradeCode=5 , '5' ,\r\n\t-- IndustryRiskGradeCode=6 , '6' ,\r\n\t-- IndustryRiskGradeCode=7 , '7' ,\r\n\t-- IndustryRiskGradeCode=8 , '8' ,\r\n\t-- IndustryRiskGradeCode=9 , '9' ,\r\n\t-- IndustryRiskGradeCode=0 , '0' ,\r\n\t-- IndustryRiskGradeCode=10 , 'D' ,\r\n\t-- IndustryRiskGradeCode=-3 , 'N/A' ,\r\n\t-- IndustryRiskGradeCode=11 , 'DNW' ,\r\n\t-- IndustryRiskGradeCode=-1 , 'NSI' ,\r\n\t-- IndustryRiskGradeCode=-2 , 'Argent' ,'N/A')\n\tDECODE(\n\t    TRUE,\n\t    IndustryRiskGradeCode = 1, '1',\n\t    IndustryRiskGradeCode = 2, '2',\n\t    IndustryRiskGradeCode = 3, '3',\n\t    IndustryRiskGradeCode = 4, '4',\n\t    IndustryRiskGradeCode = 5, '5',\n\t    IndustryRiskGradeCode = 6, '6',\n\t    IndustryRiskGradeCode = 7, '7',\n\t    IndustryRiskGradeCode = 8, '8',\n\t    IndustryRiskGradeCode = 9, '9',\n\t    IndustryRiskGradeCode = 0, '0',\n\t    IndustryRiskGradeCode = 10, 'D',\n\t    IndustryRiskGradeCode = - 3, 'N/A',\n\t    IndustryRiskGradeCode = 11, 'DNW',\n\t    IndustryRiskGradeCode = - 1, 'NSI',\n\t    IndustryRiskGradeCode = - 2, 'Argent',\n\t    'N/A'\n\t) AS o_IndustryRiskGradeCode,\n\tAgencyCode,\n\tAbbreviatedName,\n\tPolicyIssueCode,\n\tStateOfDomicileCodeDescription,\n\tStrategicBusinessGroupDescription,\n\tAcctOver150K,\n\tDWP,\n\to_InsuranceReferenceLineOfBusinessDescription,\n\tStrategicProfitCenterDescription,\n\tSalesTerritoryCodeDescription,\n\tUnderWriterName,\n\tUnderWriterManagerName,\n\tUnderwriterManagerEmailAddress13,\n\tUnderwriterManagerCode13,\n\tUnderwriterEmailAddress13,\n\tUnderwriterCode13\n\tFROM JNR_New_DWP_Update\n),\nUpd_Update AS (\n\tSELECT\n\tCustomerNumber, \n\tPolicyNumber, \n\tPolicyKey, \n\tPolicyOfferingDescription, \n\tCustomerName, \n\tPolicyEffectiveDate, \n\tPrimaryBusinessClassCode, \n\tPrimaryBusinessClassCodeDescription, \n\tProgramCode, \n\tProgramDescription, \n\to_IndustryRiskGradeCode AS IndustryRiskGradeCode, \n\tAgencyCode, \n\tAbbreviatedName, \n\tPolicyIssueCode, \n\tStateOfDomicileCodeDescription, \n\tStrategicBusinessGroupDescription, \n\tAcctOver150K, \n\tDWP, \n\to_InsuranceReferenceLineOfBusinessDescription AS InsuranceReferenceLineOfBusinessDescription, \n\tStrategicProfitCenterDescription, \n\tSalesTerritoryCodeDescription, \n\tUnderWriterName, \n\tUnderWriterManagerName, \n\tUnderwriterManagerEmailAddress13, \n\tUnderwriterManagerCode13, \n\tUnderwriterEmailAddress13, \n\tUnderwriterCode13\n\tFROM EXP_Decoding_Industry_riskgrade_update\n),\nCommercialProductManagementExtract_New_Update AS (\n\tMERGE INTO CommercialProductManagementExtract AS T\n\tUSING Upd_Update AS S\n\tON T.CustomerNumber = S.CustomerNumber\n\tAND T.PolicyNumber = S.PolicyNumber\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.PolicyOfferingDescription = S.PolicyOfferingDescription, T.FirstNamedInsured = S.CustomerName, T.PolicyEffectiveDate = S.PolicyEffectiveDate, T.PrimaryBusinessClassCode = S.PrimaryBusinessClassCode, T.PrimaryBusinessClassDescription = S.PrimaryBusinessClassCodeDescription, T.StrategicProfitCenterDescription = S.StrategicProfitCenterDescription, T.ProgramCode = S.ProgramCode, T.ProgramDescription = S.ProgramDescription, T.IndustryRiskGradeCode = S.IndustryRiskGradeCode, T.AgencyCode = S.AgencyCode, T.AbbreviatedAgencyName = S.AbbreviatedName, T.UnderwritingRegionCodeDescription = S.StateOfDomicileCodeDescription, T.PolicyIssueCode = S.PolicyIssueCode, T.AccountOver150KFlag = S.AcctOver150K, T.InsuranceReferenceLineOfBusinessDescription = S.InsuranceReferenceLineOfBusinessDescription, T.UnderWriterName = S.UnderWriterName, T.UnderWriterManagerName = S.UnderWriterManagerName, T.StrategicBusinessGroupDescription = S.StrategicBusinessGroupDescription, T.SalesTerritoryDescription = S.SalesTerritoryCodeDescription, T.UnderwriterManagerEmailAddress = S.UnderwriterManagerEmailAddress13, T.UnderwriterManagerCode = S.UnderwriterManagerCode13, T.UnderwriterEmailAddress = S.UnderwriterEmailAddress13, T.UnderwriterCode = S.UnderwriterCode13\n),\nSQ_CommercialProductManagementExtract AS (\n\tselect CommercialProductManagementExtractId\r\n\t,AuditId\r\n\t,ModifiedDate\r\n\t,CustomerNumber\r\n\t,PolicyNumber\r\n\t,PolicyOfferingDescription\r\n\t,FirstNamedInsured\r\n\t,PolicyEffectiveDate\r\n\t,DirectWrittenPremium\r\n\t,DirectLossIncurred\r\n\t,DirectLossIncurredRatio\r\n\t,DirectLossIncurred3Yrs\r\n\t,DirectLossIncurredRatio3Yrs\r\n\t,PrimaryBusinessClassCode\r\n\t,PrimaryBusinessClassDescription\r\n\t,StrategicProfitCenterDescription\r\n\t,ProgramCode\r\n\t,ProgramDescription\r\n\t,IndustryRiskGradeCode\r\n\t,AgencyCode\r\n\t,AbbreviatedAgencyName\r\n\t,UnderwritingRegionCodeDescription\r\n\t,PolicyIssueCode\r\n\t,RunDate\r\n\t,AccountOver150KFlag\r\n\t,InsuranceReferenceLineOfBusinessDescription\r\n\t,UnderWriterName\r\n\t,UnderWriterManagerName\r\n\t,StrategicBusinessGroupDescription\r\n\t,SalesTerritoryDescription\r\n\t,UnderwriterManagerEmailAddress\r\n\t,UnderwriterManagerCode\r\n\t,UnderwriterEmailAddress\r\n\t,UnderwriterCode\r\n\t,case\r\n\t\twhen SUM(DirectWrittenPremium) OVER (PARTITION BY CustomerNumber, StrategicProfitCenterDescription) between 0 and 4999.99\r\n\t\tthen 'XS'\r\n\t\twhen SUM(DirectWrittenPremium) OVER (PARTITION BY CustomerNumber, StrategicProfitCenterDescription) between 5000 and 24999.99\r\n\t\tthen 'S'\r\n\t\twhen SUM(DirectWrittenPremium) OVER (PARTITION BY CustomerNumber, StrategicProfitCenterDescription) between 25000 and 74999.99\r\n\t\tthen 'M'\r\n\t\twhen SUM(DirectWrittenPremium) OVER (PARTITION BY CustomerNumber, StrategicProfitCenterDescription) between 75000 and 249999.99\r\n\t\tthen 'L'\r\n\t\twhen SUM(DirectWrittenPremium) OVER (PARTITION BY CustomerNumber, StrategicProfitCenterDescription) >= 250000\r\n\t\tthen 'H'\r\n\tend as AccountSize\r\n\tfrom dbo.CommercialProductManagementExtract with (nolock)\n),\nEXP_CommercialProductManagementExtract AS (\n\tSELECT\n\tCommercialProductManagementExtractId,\n\tAuditId,\n\tModifiedDate,\n\tCustomerNumber,\n\tPolicyNumber,\n\tPolicyOfferingDescription,\n\tFirstNamedInsured,\n\tPolicyEffectiveDate,\n\tDirectWrittenPremium,\n\tDirectLossIncurred,\n\tDirectLossIncurredRatio,\n\tDirectLossIncurred3Yrs,\n\tDirectLossIncurredRatio3Yrs,\n\tPrimaryBusinessClassCode,\n\tPrimaryBusinessClassDescription,\n\tStrategicProfitCenterDescription,\n\tProgramCode,\n\tProgramDescription,\n\tIndustryRiskGradeCode,\n\tAgencyCode,\n\tAbbreviatedAgencyName,\n\tUnderwritingRegionCodeDescription,\n\tPolicyIssueCode,\n\tRunDate,\n\tAccountOver150KFlag,\n\tInsuranceReferenceLineOfBusinessDescription,\n\tUnderWriterName,\n\tUnderWriterManagerName,\n\tStrategicBusinessGroupDescription,\n\tSalesTerritoryDescription,\n\tUnderwriterManagerEmailAddress,\n\tUnderwriterManagerCode,\n\tUnderwriterEmailAddress,\n\tUnderwriterCode,\n\tAccountSize\n\tFROM SQ_CommercialProductManagementExtract\n),\nUPD_CommercialProductManagementExtract AS (\n\tSELECT\n\tCommercialProductManagementExtractId, \n\tAccountSize\n\tFROM EXP_CommercialProductManagementExtract\n),\nCommercialProductManagementExtract AS (\n\tMERGE INTO CommercialProductManagementExtract AS T\n\tUSING UPD_CommercialProductManagementExtract AS S\n\tON T.CommercialProductManagementExtractId = S.CommercialProductManagementExtractId\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.AccountSize = S.AccountSize\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "NO_OF_MONTH": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "PolicyDataServices/"
        },
        "annotations": []
    }
}