{
    "name": "s_m_CLM_DM_LOAD_Primary_Payee_Name_MP_Dim",
    "properties": {
        "activities": [
            {
                "name": "m_CLM_DM_LOAD_Primary_Payee_Name_MP_Dim",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_claim_payment_dim AS (\n\tSELECT\n\t\tclaim_pay_dim_id,\n\t\tcrrnt_snpsht_flag,\n\t\taudit_id,\n\t\teff_from_date,\n\t\teff_to_date,\n\t\tcreated_date,\n\t\tmodified_date,\n\t\tprim_payee_name\n\tFROM claim_payment_dim\n\tWHERE claim_payment_dim.created_date >= '@{pipeline().parameters.SELECTION_START_TS}' or claim_payment_dim.modified_date  > = '@{pipeline().parameters.SELECTION_START_TS}'\n),\nEXPTRANS AS (\n\tSELECT\n\tclaim_pay_dim_id,\n\tcrrnt_snpsht_flag,\n\taudit_id,\n\teff_from_date,\n\teff_to_date,\n\tcreated_date,\n\tmodified_date,\n\tprim_payee_name\n\tFROM SQ_claim_payment_dim\n),\nLKP_PRIM_PAYEE_NAME_MP_DIM AS (\n\tSELECT\n\tclaim_pay_dim_id,\n\tclaim_pay_dim_id_IN,\n\tcrrnt_snpsht_flag,\n\taudit_id,\n\teff_from_date,\n\teff_to_date,\n\tcreated_date,\n\tmodified_date\n\tFROM (\n\t\tSELECT \n\t\t\tclaim_pay_dim_id,\n\t\t\tclaim_pay_dim_id_IN,\n\t\t\tcrrnt_snpsht_flag,\n\t\t\taudit_id,\n\t\t\teff_from_date,\n\t\t\teff_to_date,\n\t\t\tcreated_date,\n\t\t\tmodified_date\n\t\tFROM primary_payee_name_mp_dim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_pay_dim_id ORDER BY claim_pay_dim_id) = 1\n),\nmplt_namebreak_double_metaphone AS (WITH\n\tINPUT AS (\n\t\t\n\t),\n\tDoubleMetaPhone AS (\n\t),\n\tEXPTRANS AS (\n\t\tSELECT\n\t\tinput\n\t\tFROM INPUT\n\t),\n\tNameBreakerSixParts AS (\n\t),\n\tEXPTRANS1 AS (\n\t\tSELECT\n\t\tOne_out AS One_in,\n\t\t-- *INF*: IIF(ISNULL(One_in),One_in,:SP.DOUBLEMETAPHONE(One_in))\n\t\tIFF(One_in IS NULL, One_in, :SP.DOUBLEMETAPHONE(One_in)) AS One_var,\n\t\t-- *INF*: IIF(isnull(One_var),One_var,substr(One_var,1,5))\n\t\tIFF(One_var IS NULL, One_var, substr(One_var, 1, 5)) AS One_primary,\n\t\t-- *INF*: IIF(isnull(One_var),One_var,substr(One_var,6,5))\n\t\tIFF(One_var IS NULL, One_var, substr(One_var, 6, 5)) AS One_secondary,\n\t\tTwo_out AS Two_in,\n\t\t-- *INF*: IIF(ISNULL(Two_in),Two_in,:SP.DOUBLEMETAPHONE(Two_in))\n\t\tIFF(Two_in IS NULL, Two_in, :SP.DOUBLEMETAPHONE(Two_in)) AS Two_var,\n\t\t-- *INF*: IIF(isnull(Two_var),Two_var,substr(Two_var,1,5))\n\t\tIFF(Two_var IS NULL, Two_var, substr(Two_var, 1, 5)) AS Two_primary,\n\t\t-- *INF*: IIF(isnull(Two_var),Two_var,substr(Two_var,6,5))\n\t\tIFF(Two_var IS NULL, Two_var, substr(Two_var, 6, 5)) AS Two_secondary,\n\t\tThree_out AS Three_in,\n\t\t-- *INF*: IIF(ISNULL(Three_in),Three_in,:SP.DOUBLEMETAPHONE(Three_in))\n\t\tIFF(Three_in IS NULL, Three_in, :SP.DOUBLEMETAPHONE(Three_in)) AS Three_var,\n\t\t-- *INF*: IIF(isnull(Three_var),Three_var,substr(Three_var,1,5))\n\t\tIFF(Three_var IS NULL, Three_var, substr(Three_var, 1, 5)) AS Three_primary,\n\t\t-- *INF*: IIF(isnull(Three_var),Three_var,substr(Three_var,6,5))\n\t\tIFF(Three_var IS NULL, Three_var, substr(Three_var, 6, 5)) AS Three_secondary,\n\t\tFour_out AS Four_in,\n\t\t-- *INF*: IIF(ISNULL(Four_in),Four_in,:SP.DOUBLEMETAPHONE(Four_in))\n\t\tIFF(Four_in IS NULL, Four_in, :SP.DOUBLEMETAPHONE(Four_in)) AS Four_var,\n\t\t-- *INF*: IIF(isnull(Four_var),Four_var,substr(Four_var,1,5))\n\t\tIFF(Four_var IS NULL, Four_var, substr(Four_var, 1, 5)) AS Four_primary,\n\t\t-- *INF*: IIF(isnull(Four_var),Four_var,substr(Four_var,6,5))\n\t\tIFF(Four_var IS NULL, Four_var, substr(Four_var, 6, 5)) AS Four_secondary,\n\t\tFive_out AS Five_in,\n\t\t-- *INF*: IIF(ISNULL(Five_in),Five_in,:SP.DOUBLEMETAPHONE(Five_in))\n\t\tIFF(Five_in IS NULL, Five_in, :SP.DOUBLEMETAPHONE(Five_in)) AS Five_var,\n\t\t-- *INF*: IIF(isnull(Five_var),Five_var,substr(Five_var,1,5))\n\t\tIFF(Five_var IS NULL, Five_var, substr(Five_var, 1, 5)) AS Five_primary,\n\t\t-- *INF*: IIF(isnull(Five_var),Five_var,substr(Five_var,6,5))\n\t\tIFF(Five_var IS NULL, Five_var, substr(Five_var, 6, 5)) AS Five_secondary,\n\t\tSix_out AS Six_in,\n\t\t-- *INF*: IIF(ISNULL(Six_in),Six_in,:SP.DOUBLEMETAPHONE(Six_in))\n\t\tIFF(Six_in IS NULL, Six_in, :SP.DOUBLEMETAPHONE(Six_in)) AS Six_var,\n\t\t-- *INF*: IIF(isnull(Six_var),Six_var,substr(Six_var,1,5))\n\t\tIFF(Six_var IS NULL, Six_var, substr(Six_var, 1, 5)) AS Six_primary,\n\t\t-- *INF*: IIF(isnull(Six_var),Six_var,substr(Six_var,6,5))\n\t\tIFF(Six_var IS NULL, Six_var, substr(Six_var, 6, 5)) AS Six_secondary\n\t\tFROM NameBreakerSixParts\n\t),\n\tOUTPUT AS (\n\t\tSELECT\n\t\tOne_in, \n\t\tOne_primary, \n\t\tOne_secondary, \n\t\tTwo_in, \n\t\tTwo_primary, \n\t\tTwo_secondary, \n\t\tThree_in, \n\t\tThree_primary, \n\t\tThree_secondary, \n\t\tFour_in, \n\t\tFour_primary, \n\t\tFour_secondary, \n\t\tFive_in, \n\t\tFive_primary, \n\t\tFive_secondary, \n\t\tSix_in, \n\t\tSix_primary, \n\t\tSix_secondary\n\t\tFROM EXPTRANS1\n\t),\n),\nEXP_consolidate AS (\n\tSELECT\n\tLKP_PRIM_PAYEE_NAME_MP_DIM.claim_pay_dim_id AS claim_pay_dim_id_lkp,\n\tLKP_PRIM_PAYEE_NAME_MP_DIM.claim_pay_dim_id_IN,\n\tLKP_PRIM_PAYEE_NAME_MP_DIM.crrnt_snpsht_flag,\n\tLKP_PRIM_PAYEE_NAME_MP_DIM.audit_id,\n\tLKP_PRIM_PAYEE_NAME_MP_DIM.eff_from_date,\n\tLKP_PRIM_PAYEE_NAME_MP_DIM.eff_to_date,\n\tLKP_PRIM_PAYEE_NAME_MP_DIM.created_date,\n\tLKP_PRIM_PAYEE_NAME_MP_DIM.modified_date,\n\tmplt_namebreak_double_metaphone.One_in,\n\tmplt_namebreak_double_metaphone.One_primary,\n\tmplt_namebreak_double_metaphone.One_secondary,\n\tmplt_namebreak_double_metaphone.Two_in,\n\tmplt_namebreak_double_metaphone.Two_primary,\n\tmplt_namebreak_double_metaphone.Two_secondary,\n\tmplt_namebreak_double_metaphone.Three_in,\n\tmplt_namebreak_double_metaphone.Three_primary,\n\tmplt_namebreak_double_metaphone.Three_secondary,\n\tmplt_namebreak_double_metaphone.Four_in,\n\tmplt_namebreak_double_metaphone.Four_primary,\n\tmplt_namebreak_double_metaphone.Four_secondary,\n\tmplt_namebreak_double_metaphone.Five_in,\n\tmplt_namebreak_double_metaphone.Five_primary,\n\tmplt_namebreak_double_metaphone.Five_secondary,\n\tmplt_namebreak_double_metaphone.Six_in,\n\tmplt_namebreak_double_metaphone.Six_primary,\n\tmplt_namebreak_double_metaphone.Six_secondary\n\tFROM mplt_namebreak_double_metaphone\n\tLEFT JOIN LKP_PRIM_PAYEE_NAME_MP_DIM\n\tON LKP_PRIM_PAYEE_NAME_MP_DIM.claim_pay_dim_id = EXPTRANS.claim_pay_dim_id\n),\nRTRTRANS AS (\n\tSELECT\n\tclaim_pay_dim_id_lkp AS lkp_claim_pay_dim_id,\n\tclaim_pay_dim_id_IN,\n\tcrrnt_snpsht_flag,\n\taudit_id,\n\teff_from_date,\n\teff_to_date,\n\tcreated_date,\n\tmodified_date,\n\tOne_in,\n\tOne_primary,\n\tOne_secondary,\n\tTwo_in,\n\tTwo_primary,\n\tTwo_secondary,\n\tThree_in,\n\tThree_primary,\n\tThree_secondary,\n\tFour_in,\n\tFour_primary,\n\tFour_secondary,\n\tFive_in,\n\tFive_primary,\n\tFive_secondary,\n\tSix_in,\n\tSix_primary,\n\tSix_secondary\n\tFROM EXP_consolidate\n),\nRTRTRANS_UPDATE AS (SELECT * FROM RTRTRANS WHERE NOT ISNULL(lkp_claim_pay_dim_id)),\nRTRTRANS_INSERT AS (SELECT * FROM RTRTRANS WHERE ISNULL(lkp_claim_pay_dim_id)),\nUPD_INSERT AS (\n\tSELECT\n\tclaim_pay_dim_id_IN AS claim_pay_dim_id3, \n\tcrrnt_snpsht_flag AS crrnt_snpsht_flag3, \n\taudit_id AS audit_id3, \n\teff_from_date AS eff_from_date3, \n\teff_to_date AS eff_to_date3, \n\tcreated_date AS created_date3, \n\tmodified_date AS modified_date3, \n\tOne_in AS One_in3, \n\tOne_primary AS One_primary3, \n\tOne_secondary AS One_secondary3, \n\tTwo_in AS Two_in3, \n\tTwo_primary AS Two_primary3, \n\tTwo_secondary AS Two_secondary3, \n\tThree_in AS Three_in3, \n\tThree_primary AS Three_primary3, \n\tThree_secondary AS Three_secondary3, \n\tFour_in AS Four_in3, \n\tFour_primary AS Four_primary3, \n\tFour_secondary AS Four_secondary3, \n\tFive_in AS Five_in3, \n\tFive_primary AS Five_primary3, \n\tFive_secondary AS Five_secondary3, \n\tSix_in AS Six_in3, \n\tSix_primary AS Six_primary3, \n\tSix_secondary AS Six_secondary3\n\tFROM RTRTRANS_INSERT\n),\nprimary_payee_name_mp_dim_INSERT AS (\n\tINSERT INTO primary_payee_name_mp_dim\n\t(claim_pay_dim_id, crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, created_date, modified_date, one, two, three, four, five, six, mpOnePrim, mpOneSec, mpTwoPrim, mpTwoSec, mpThreePrim, mpThreeSec, mpFourPrim, mpFourSec, mpFivePrim, mpFiveSec, mpSixPrim, mpSixSec)\n\tSELECT \n\tclaim_pay_dim_id3 AS CLAIM_PAY_DIM_ID, \n\tcrrnt_snpsht_flag3 AS CRRNT_SNPSHT_FLAG, \n\taudit_id3 AS AUDIT_ID, \n\teff_from_date3 AS EFF_FROM_DATE, \n\teff_to_date3 AS EFF_TO_DATE, \n\tcreated_date3 AS CREATED_DATE, \n\tmodified_date3 AS MODIFIED_DATE, \n\tOne_in3 AS ONE, \n\tTwo_in3 AS TWO, \n\tThree_in3 AS THREE, \n\tFour_in3 AS FOUR, \n\tFive_in3 AS FIVE, \n\tSix_in3 AS SIX, \n\tOne_primary3 AS MPONEPRIM, \n\tOne_secondary3 AS MPONESEC, \n\tTwo_primary3 AS MPTWOPRIM, \n\tTwo_secondary3 AS MPTWOSEC, \n\tThree_primary3 AS MPTHREEPRIM, \n\tThree_secondary3 AS MPTHREESEC, \n\tFour_primary3 AS MPFOURPRIM, \n\tFour_secondary3 AS MPFOURSEC, \n\tFive_primary3 AS MPFIVEPRIM, \n\tFive_secondary3 AS MPFIVESEC, \n\tSix_primary3 AS MPSIXPRIM, \n\tSix_secondary3 AS MPSIXSEC\n\tFROM UPD_INSERT\n),\nUPD_UPDATE AS (\n\tSELECT\n\tlkp_claim_pay_dim_id AS lkp_claim_pay_dim_id1, \n\tcrrnt_snpsht_flag AS crrnt_snpsht_flag1, \n\taudit_id AS audit_id1, \n\teff_from_date AS eff_from_date1, \n\teff_to_date AS eff_to_date1, \n\tcreated_date AS created_date1, \n\tmodified_date AS modified_date1, \n\tOne_in AS One_in1, \n\tOne_primary AS One_primary1, \n\tOne_secondary AS One_secondary1, \n\tTwo_in AS Two_in1, \n\tTwo_primary AS Two_primary1, \n\tTwo_secondary AS Two_secondary1, \n\tThree_in AS Three_in1, \n\tThree_primary AS Three_primary1, \n\tThree_secondary AS Three_secondary1, \n\tFour_in AS Four_in1, \n\tFour_primary AS Four_primary1, \n\tFour_secondary AS Four_secondary1, \n\tFive_in AS Five_in1, \n\tFive_primary AS Five_primary1, \n\tFive_secondary AS Five_secondary1, \n\tSix_in AS Six_in1, \n\tSix_primary AS Six_primary1, \n\tSix_secondary AS Six_secondary1\n\tFROM RTRTRANS_UPDATE\n),\nprimary_payee_name_mp_dim_UPDATE AS (\n\tMERGE INTO primary_payee_name_mp_dim AS T\n\tUSING UPD_UPDATE AS S\n\tON T.claim_pay_dim_id = S.lkp_claim_pay_dim_id1\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.crrnt_snpsht_flag = S.crrnt_snpsht_flag1, T.audit_id = S.audit_id1, T.eff_from_date = S.eff_from_date1, T.eff_to_date = S.eff_to_date1, T.created_date = S.created_date1, T.modified_date = S.modified_date1, T.one = S.One_in1, T.two = S.Two_in1, T.three = S.Three_in1, T.four = S.Four_in1, T.five = S.Five_in1, T.six = S.Six_in1, T.mpOnePrim = S.One_primary1, T.mpOneSec = S.One_secondary1, T.mpTwoPrim = S.Two_primary1, T.mpTwoSec = S.Two_secondary1, T.mpThreePrim = S.Three_primary1, T.mpThreeSec = S.Three_secondary1, T.mpFourPrim = S.Four_primary1, T.mpFourSec = S.Four_secondary1, T.mpFivePrim = S.Five_primary1, T.mpFiveSec = S.Five_secondary1, T.mpSixPrim = S.Six_primary1, T.mpSixSec = S.Six_secondary1\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "ClaimsDataMart/"
        },
        "annotations": []
    }
}