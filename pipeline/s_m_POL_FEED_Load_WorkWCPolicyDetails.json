{
    "name": "s_m_POL_FEED_Load_WorkWCPolicyDetails",
    "properties": {
        "activities": [
            {
                "name": "m_POL_FEED_Load_WorkWCPolicyDetails",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_Policy_Tables AS (\n\tWITH CTE_PolicyDetail as \r\n\t(\r\n\tSELECT distinct DT.HistoryID,DT.SessionId,DS.Purpose,WP.PolicyNumber, WP.PolicyVersionFormatted,WP.PolicyID,WCP.WB_WC_PolicyId\r\n\tFROM dbo.wb_wc_policy WCP with (nolock)\r\n\tinner join dbo.wb_cl_Policy CLP with (nolock)\r\n\ton CLP.WB_CL_PolicyId = WCP.WB_CL_PolicyId\r\n\tinner join dbo.wb_policy WP with(nolock)\r\n\ton WP.WB_PolicyId = CLP.WB_PolicyId\r\n\tinner join dbo.DC_Transaction DT with (NOLOCK)\r\n\ton DT.SessionId=WP.SessionId\r\n\tinner join dbo.DC_Session DS with (NOLOCK)\r\n\ton DS.SessionId=DT.SessionId\r\n\tinner join dbo.DC_Line DL with(nolock)\r\n\ton DT.SessionId=DL.SessionId\r\n\twhere DL.Type='WorkersCompensation'\r\n\tand DS.Purpose='Onset'\r\n\tand DS.CreateDateTime between '@{pipeline().parameters.SELECTION_START_TS}' and '@{pipeline().parameters.SELECTION_END_TS}'\r\n\tand DT.State='Committed'\r\n\t\r\n\t)\r\n\t\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,WD.WB_WC_WorkDescriptionId ProcessID,'ExcludedWorkplace' Attribute , WD.ExcludedWorkplace Value \r\n\tfrom dbo.WB_WC_WorkDescription WD with(nolock) \r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = WD.WB_WC_PolicyId\r\n\tand WD.ExcludedWorkplace is NOT NULL\r\n\t\r\n\tUNION ALL\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,WD.WB_WC_WorkDescriptionId ProcessID,'VesselName' Attribute , WD.VesselName Value \r\n\tfrom dbo.WB_WC_WorkDescription WD with(nolock) \r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = WD.WB_WC_PolicyId\r\n\t\r\n\tUNION ALL\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,WD.WB_WC_WorkDescriptionId ProcessID,'WorkersCompensationLaw' Attribute , WD.WorkersCompensationLaw Value \r\n\tfrom dbo.WB_WC_WorkDescription WD with(nolock) \r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = WD.WB_WC_PolicyId\r\n\t\r\n\tUNION ALL\r\n\t\r\n\tselect DT.HistoryID,DT.SessionId,DS.Purpose,WP.PolicyNumber, WP.PolicyVersionFormatted,WP.PolicyID,WD.WB_WC_WorkDescriptionId ProcessID,'MaritimeWorkDescriptionWC0002030484' Attribute , WCP.MaritimeWorkDescriptionWC0002030484 Value \r\n\tfrom dbo.WB_WC_WorkDescription WD with(nolock) \r\n\tinner join dbo.wb_wc_policy WCP with (nolock)\r\n\ton WCP.WB_WC_PolicyId = WD.WB_WC_PolicyId\r\n\tinner join dbo.wb_cl_Policy CLP with (nolock)\r\n\ton CLP.WB_CL_PolicyId = WCP.WB_CL_PolicyId\r\n\tinner join dbo.wb_policy WP with(nolock)\r\n\ton WP.WB_PolicyId = CLP.WB_PolicyId\r\n\tinner join dbo.DC_Transaction DT with (NOLOCK)\r\n\ton DT.SessionId=WP.SessionId\r\n\tinner join dbo.DC_Session DS with (NOLOCK)\r\n\ton DS.SessionId=DT.SessionId\r\n\tinner join dbo.DC_Line DL with(nolock)\r\n\ton DT.SessionId=DL.SessionId\r\n\twhere DL.Type='WorkersCompensation'\r\n\tand DS.Purpose='Onset'\r\n\tand DS.CreateDateTime between '@{pipeline().parameters.SELECTION_START_TS}' and '@{pipeline().parameters.SELECTION_END_TS}'\r\n\tand DT.State='Committed'\r\n\t\r\n\t\r\n\tUNION ALL\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,WE.WB_WC_EmployeeId ProcessID,'NameOfEmployeeGroup' Attribute , WE.NameOfEmployeeGroup Value \r\n\tfrom dbo.WB_WC_Employee WE with(nolock)\r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = WE.WB_WC_PolicyId\r\n\t\r\n\t\r\n\tUNION ALL\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,WE.WB_WC_EmployeeId ProcessID,'EmployeeGroupStateList' Attribute , WE.EmployeeGroupStateList Value \r\n\tfrom dbo.WB_WC_Employee WE with(nolock)\r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = WE.WB_WC_PolicyId\r\n\t\r\n\t\r\n\tUNION ALL\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,WE.WB_WC_EmployeeId ProcessID,'EmployeeDesgWCLaw' Attribute , WE.EmployeeDesgWCLaw Value \r\n\tfrom dbo.WB_WC_Employee WE with(nolock)\r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = WE.WB_WC_PolicyId\r\n\t\r\n\t\r\n\tUNION ALL\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,AE.WB_WC_AlternateEmployerId ProcessID,'AlternateEmployerName' Attribute , AE.AlternateEmployerName Value \r\n\tfrom dbo.WB_WC_AlternateEmployer AE with(nolock)\r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = AE.WB_WC_PolicyId\r\n\t\r\n\t\r\n\tUNION ALL\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,AE.WB_WC_AlternateEmployerId ProcessID,'AlternateEmployerStateOfEmployment' Attribute , AE.AlternateEmployerStateOfEmployment Value \r\n\tfrom dbo.WB_WC_AlternateEmployer AE with(nolock)\r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = AE.WB_WC_PolicyId\r\n\t\r\n\t\r\n\tUNION ALL\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,AE.WB_WC_AlternateEmployerId ProcessID,'AlternateEmployerContractOrProject' Attribute , AE.AlternateEmployerContractOrProject Value \r\n\tfrom dbo.WB_WC_AlternateEmployer AE with(nolock)\r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = AE.WB_WC_PolicyId\r\n\t\r\n\t\r\n\tUNION ALL\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,AE.WB_WC_AlternateEmployerId ProcessID,'AddressOfAlternateEmployer' Attribute , \r\n\tCONCAT(AE.AlternateEmployerAddress,',',AE.AlternateEmployerCity,',',AE.AlternateEmployerState,',',AE.AlternateEmployerZip) Value \r\n\tfrom dbo.WB_WC_AlternateEmployer AE with(nolock)\r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = AE.WB_WC_PolicyId\r\n\t\r\n\tUNION ALL\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,CTE.WB_WC_PolicyId ProcessID,'EmployeeLeasingCompanyNameWC480316' Attribute , P.EmployeeLeasingCompanyNameWC480316 Value \r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = P.WB_WC_PolicyId\r\n\t\r\n\tunion all \r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,CTE.WB_WC_PolicyId ProcessID,'ClientNameWC480316' Attribute , P.ClientNameWC480316 Value \r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = P.WB_WC_PolicyId\r\n\t\r\n\tunion all \r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,CTE.WB_WC_PolicyId ProcessID,'TerminatedEffectiveDateWC480316' Attribute , convert(varchar(20),P.TerminatedEffectiveDateWC480316,112) Value \r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = P.WB_WC_PolicyId\r\n\t\r\n\tunion all \r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,CTE.WB_WC_PolicyId ProcessID,'EntitiesWC480316' Attribute , P.EntitiesWC480316 Value \r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = P.WB_WC_PolicyId\r\n\t\r\n\tunion all \r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,CTE.WB_WC_PolicyId ProcessID,'DateSentWC480316' Attribute, convert(varchar(20),P.DateSentWC480316,112) Value \r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = P.WB_WC_PolicyId\r\n\t\r\n\tunion all \r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,CTE.WB_WC_PolicyId ProcessID,'MaritimeWorkDescription201A' Attribute , P.MaritimeWorkDescription201A Value \r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = P.WB_WC_PolicyId\r\n\t\r\n\tunion all\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,AEW.WB_WC_AlternateEmployerWaiverId ProcessID,'AlternateEmployerWaiverDescription' Attribute , AEW.Description Value \r\n\tfrom dbo.WB_WC_AlternateEmployerWaiver AEW with(nolock) \r\n\tinner join CTE_PolicyDetail CTE\r\n\ton CTE.WB_WC_PolicyId = AEW.WB_WC_PolicyId\r\n\t\r\n\tunion all\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,WBSP.WB_WC_SoleProprietorsId ProcessID,WBSP.Attribute , WBSP.Value \r\n\tfrom CTE_PolicyDetail CTE\r\n\tinner join (\r\n\tSelect A.WB_WC_PolicyId,'SoleProprietorExcluded' Attribute , A.SoleProprietorExcluded Value,A.WB_WC_SoleProprietorsId\r\n\tfrom dbo.WB_WC_SoleProprietors A with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect B.WB_WC_PolicyId,'IncludedSolePropState' Attribute , B.IncludedSolePropState Value,B.WB_WC_SoleProprietorsId\r\n\tfrom dbo.WB_WC_SoleProprietors B with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'NameOfSoleProprietorIncluded' Attribute , C.NameOfSoleProprietorIncluded Value,C.WB_WC_SoleProprietorsId\r\n\tfrom dbo.WB_WC_SoleProprietors C with(nolock) \r\n\t) WBSP\r\n\ton CTE.WB_WC_PolicyId = WBSP.WB_WC_PolicyId\r\n\t\r\n\tunion all\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,WBP.WB_WC_PartnersId ProcessID,WBP.Attribute , WBP.Value \r\n\tfrom CTE_PolicyDetail CTE\r\n\tinner join (\r\n\tSelect A.WB_WC_PolicyId,'NameOfPartnerExcluded' Attribute , A.NameOfPartnerExcluded Value,A.WB_WC_PartnersId\r\n\tfrom dbo.WB_WC_Partners A with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect B.WB_WC_PolicyId,'IncludedPartnersState' Attribute , B.IncludedPartnersState Value,B.WB_WC_PartnersId\r\n\tfrom dbo.WB_WC_Partners B with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'NameOfPartnersIncluded' Attribute , C.NameOfPartnersIncluded Value,C.WB_WC_PartnersId\r\n\tfrom dbo.WB_WC_Partners C with(nolock) \r\n\t) WBP\r\n\ton CTE.WB_WC_PolicyId = WBP.WB_WC_PolicyId\r\n\t\r\n\tunion all\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,WBOFF.WB_WC_OfficersId ProcessID,WBOFF.Attribute , WBOFF.Value \r\n\tfrom CTE_PolicyDetail CTE\r\n\tinner join (\r\n\tSelect A.WB_WC_PolicyId,'NameOfOfficersExcluded' Attribute , A.NameOfOfficersExcluded Value,A.WB_WC_OfficersId\r\n\tfrom dbo.WB_WC_Officers A with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect B.WB_WC_PolicyId,'IncludedOfficersState' Attribute , B.IncludedOfficersState Value,B.WB_WC_OfficersId\r\n\tfrom dbo.WB_WC_Officers B with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'NameOfOfficersIncluded' Attribute , C.NameOfOfficersIncluded Value,C.WB_WC_OfficersId\r\n\tfrom dbo.WB_WC_Officers C with(nolock) \r\n\t) WBOFF\r\n\ton CTE.WB_WC_PolicyId = WBOFF.WB_WC_PolicyId\r\n\t\r\n\tunion all\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,WBOTH.WB_WC_OthersId ProcessID,WBOTH.Attribute , WBOTH.Value \r\n\tfrom CTE_PolicyDetail CTE\r\n\tinner join (\r\n\tSelect A.WB_WC_PolicyId,'NameOfOthersExcluded' Attribute , A.NameOfOthersExcluded Value,A.WB_WC_OthersId \r\n\tfrom dbo.WB_WC_Others A with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect B.WB_WC_PolicyId,'IncludedOthersState' Attribute , B.IncludedOthersState Value,B.WB_WC_OthersId \r\n\tfrom dbo.WB_WC_Others B with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'NameOfOthersIncluded' Attribute , C.NameOfOthersIncluded Value,C.WB_WC_OthersId \r\n\tfrom dbo.WB_WC_Others C with(nolock) \r\n\t) WBOTH\r\n\ton CTE.WB_WC_PolicyId = WBOTH.WB_WC_PolicyId\r\n\t\r\n\tunion ALL\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,Client.WB_WC_ClientsId ProcessID,Client.Attribute , client.Value \r\n\tfrom CTE_PolicyDetail CTE\r\n\tinner join (\r\n\tSelect WB_WC_PolicyId, WB_WC_ClientsId, SessionId,'IncludedClientName' Attribute, wc.includedclientname Value from WB_WC_Clients wc with (nolock)\r\n\tunion all\r\n\tSelect WB_WC_PolicyId, WB_WC_ClientsId, SessionId,'IncludedClientAddress' Attribute, wc.IncludedClientAddress Value from WB_WC_Clients wc with (nolock)\r\n\tunion all\r\n\tSelect WB_WC_PolicyId, WB_WC_ClientsId, SessionId,'ClientFEINNumber' Attribute, wc.ClientFEINNumber Value from WB_WC_Clients wc with (nolock)\r\n\tunion all\r\n\tSelect WB_WC_PolicyId, WB_WC_ClientsId, SessionId,'EstimatedPremium' Attribute, CAST(wc.EstimatedPremium as varchar(120)) as Value from WB_WC_Clients wc with (nolock)\r\n\tunion all\r\n\tSelect WB_WC_PolicyId, WB_WC_ClientsId, SessionId,'ClientNameEmployeeLeasing' Attribute, wc.ClientNameEmployeeLeasing Value from WB_WC_Clients wc with (nolock)\r\n\tunion all\r\n\tSelect WB_WC_PolicyId, WB_WC_ClientsId, SessionId,'ClientFEINNumberEmployeeLeasing' Attribute, wc.ClientFEINNumberEmployeeLeasing Value from WB_WC_Clients wc with (nolock)\r\n\tunion all\r\n\tSelect WB_WC_PolicyId, WB_WC_ClientsId, SessionId,'ClientAddressEmployeeLeasing' Attribute, wc.ClientAddressEmployeeLeasing Value from WB_WC_Clients wc with (nolock)\r\n\tunion all\r\n\tSelect WB_WC_PolicyId, WB_WC_ClientsId, SessionId,'LaborContractorAddress' Attribute, wc.LaborContractorAddress Value from WB_WC_Clients wc with (nolock)\r\n\tunion all\r\n\tSelect WB_WC_PolicyId, WB_WC_ClientsId, SessionId,'LaborContractor' Attribute, wc.LaborContractor Value from WB_WC_Clients wc with (nolock)\r\n\tunion all\r\n\tSelect WB_WC_PolicyId, WB_WC_ClientsId, SessionId,'LaborContractorPolicyNumber' Attribute, wc.LaborContractorPolicyNumber Value from WB_WC_Clients wc with (nolock)\r\n\tunion all\r\n\tSelect WB_WC_PolicyId, WB_WC_ClientsId, SessionId,'LaborContractorFEIN' Attribute, wc.LaborContractorFEIN Value from WB_WC_Clients wc with (nolock)\r\n\t)  Client on CTE.WB_WC_PolicyId=Client.WB_WC_PolicyId and CTE.SessionId=client.SessionId\r\n\t\r\n\tunion ALL\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,WBCON.WB_WC_ContractorsId ProcessID,WBCON.Attribute , WBCON.Value \r\n\tfrom CTE_PolicyDetail CTE\r\n\tinner join(\r\n\tSelect C.WB_WC_PolicyId,'DesignatedContractor' Attribute , C.DesignatedContractor Value,C.WB_WC_ContractorsId \r\n\tfrom dbo.WB_WC_Contractors C with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'ClassCode' Attribute , C.ClassCode Value,C.WB_WC_ContractorsId \r\n\tfrom dbo.WB_WC_Contractors C with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'ClassCodeDescription' Attribute , C.ClassCodeDescription Value,C.WB_WC_ContractorsId \r\n\tfrom dbo.WB_WC_Contractors C with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'PremiumBasis' Attribute , C.PremiumBasis Value,C.WB_WC_ContractorsId \r\n\tfrom dbo.WB_WC_Contractors C with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'Rate' Attribute , C.Rate Value,C.WB_WC_ContractorsId \r\n\tfrom dbo.WB_WC_Contractors C with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'MinimumPremium' Attribute , C.MinimumPremium Value,C.WB_WC_ContractorsId \r\n\tfrom dbo.WB_WC_Contractors C with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'EstimatedAnnualPremium' Attribute , C.EstimatedAnnualPremium Value,C.WB_WC_ContractorsId \r\n\tfrom dbo.WB_WC_Contractors C with(nolock) \r\n\t) WBCON\r\n\ton CTE.WB_WC_PolicyId = WBCON.WB_WC_PolicyId\r\n\t\r\n\tunion ALL\r\n\t\r\n\tselect CTE.HistoryID,CTE.SessionId,CTE.Purpose,CTE.PolicyNumber, CTE.PolicyVersionFormatted,CTE.PolicyID,WBClient.ProcessID,WBClient.Attribute,WBClient.Value \r\n\tfrom CTE_PolicyDetail CTE\r\n\tinner join(\r\n\tselect P.WB_WC_PolicyId,'ClientNameWC220304' Attribute , P.ClientNameWC220304 Value,P.WB_WC_PolicyId ProcessID\r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tselect P.WB_WC_PolicyId,'ClientAddressWC220304' Attribute , P.ClientAddressWC220304 Value,P.WB_WC_PolicyId ProcessID\r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tselect P.WB_WC_PolicyId,'ClientCityWC220304' Attribute , P.ClientCityWC220304 Value,P.WB_WC_PolicyId ProcessID\r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'IncludedClientCity' Attribute , C.IncludedClientCity Value,C.WB_WC_ClientsId ProcessID\r\n\tfrom dbo.WB_WC_Clients C with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tselect P.WB_WC_PolicyId,'ClientStateWC220304' Attribute , P.ClientStateWC220304 Value,P.WB_WC_PolicyId ProcessID\r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'IncludedClientState' Attribute , C.IncludedClientState Value,C.WB_WC_ClientsId ProcessID\r\n\tfrom dbo.WB_WC_Clients C with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tselect P.WB_WC_PolicyId,'ClientZipWC220304' Attribute , P.ClientZipWC220304 Value,P.WB_WC_PolicyId ProcessID\r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tSelect C.WB_WC_PolicyId,'IncludedClientZipcode' Attribute , C.IncludedClientZipcode Value,C.WB_WC_ClientsId ProcessID\r\n\tfrom dbo.WB_WC_Clients C with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tselect P.WB_WC_PolicyId,'ClientFEINNumberWC220304' Attribute , P.ClientFEINNumberWC220304 Value,P.WB_WC_PolicyId ProcessID\r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\t\r\n\tunion ALL\r\n\t\r\n\tselect P.WB_WC_PolicyId,'ClientUINumberwC220304' Attribute , P.ClientUINumberwC220304 Value,P.WB_WC_PolicyId ProcessID\r\n\tfrom dbo.WB_WC_Policy P with(nolock) \r\n\t\r\n\t) WBClient\r\n\ton CTE.WB_WC_PolicyId = WBClient.WB_WC_PolicyId\n),\nEXP_SRC_DataCollect AS (\n\tSELECT\n\tHistoryID,\n\tSessionId,\n\tPurpose,\n\tPolicyNumber,\n\tPolicyVersionFormatted,\n\tPolicyId,\n\tProcessID,\n\tAttribute,\n\tValue AS i_Value,\n\t-- *INF*: REG_REPLACE(i_Value, '[^\\x21-\\x7E]', ' ')\r\n\t-- \r\n\t-- --IIF(NOT ISNULL(i_Value),REPLACECHR(0, REPLACECHR(0,i_Value,CHR(10),''),CHR(13),''),i_Value)\r\n\t-- -- filtering out anything outside of the most basic ascii set\n\tREGEXP_REPLACE(i_Value, '[^\\x21-\\x7E]', ' ') AS o_Value\n\tFROM SQ_Policy_Tables\n),\nLKP_LatestSessionID AS (\n\tSELECT\n\tSessionId,\n\tIN_HistoryID,\n\tIN_SessionId,\n\tIN_Purpose,\n\tPurpose,\n\tHistoryID\n\tFROM (\n\t\tSelect distinct DT.HistoryID AS HistoryID,\r\n\t\tDS.Purpose AS Purpose,\r\n\t\tMax(DS.Sessionid) AS Sessionid\r\n\t\tfrom @{pipeline().parameters.SOURCE_TABLE_OWNER}.DC_Transaction DT with(nolock)\r\n\t\tinner join @{pipeline().parameters.SOURCE_TABLE_OWNER}.DC_Session DS with(nolock)\r\n\t\ton DT.Sessionid=DS.Sessionid\r\n\t\tinner join @{pipeline().parameters.SOURCE_TABLE_OWNER}.DC_Line DL with(nolock)\r\n\t\ton DT.Sessionid=DL.Sessionid\r\n\t\twhere DL.Type='WorkersCompensation'\r\n\t\tand DS.Purpose='Onset'\r\n\t\tand DT.State='Committed'\r\n\t\tand DS.CreateDateTime between '@{pipeline().parameters.SELECTION_START_TS}' and '@{pipeline().parameters.SELECTION_END_TS}'\r\n\t\tgroup by DT.HistoryID,DS.Purpose\r\n\t\t--\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY SessionId,Purpose,HistoryID ORDER BY SessionId) = 1\n),\nLKP_WorkWCTrackHistory AS (\n\tSELECT\n\tWCTrackHistoryID,\n\tAuditid,\n\tIN_HistoryID,\n\tIN_Purpose,\n\tHistoryID,\n\tPurpose\n\tFROM (\n\t\tSELECT \r\n\t\tWorkWCTrackHistory.WCTrackHistoryID as WCTrackHistoryID, \r\n\t\tWorkWCTrackHistory.Auditid as Auditid, \r\n\t\tWorkWCTrackHistory.HistoryID as HistoryID, \r\n\t\tWorkWCTrackHistory.Purpose as Purpose \r\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkWCTrackHistory\r\n\t\torder by WorkWCTrackHistory.HistoryID,WorkWCTrackHistory.Purpose,WorkWCTrackHistory.Auditid ASC\r\n\t\t--\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY HistoryID,Purpose ORDER BY WCTrackHistoryID) = 1\n),\nEXP_RecordFlagging AS (\n\tSELECT\n\tLKP_WorkWCTrackHistory.WCTrackHistoryID AS lkp_WCTrackHistoryID,\n\tLKP_WorkWCTrackHistory.Auditid AS lkp_Auditid,\n\tCURRENT_TIMESTAMP AS ExtractDate,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditID,\n\t-- *INF*: IIF(lkp_Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AND NOT ISNULL(lkp_SessionId),'1','0')\n\tIFF(lkp_Auditid = @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AND lkp_SessionId IS NOT NULL, '1', '0') AS FilterFlag,\n\tEXP_SRC_DataCollect.PolicyId,\n\tEXP_SRC_DataCollect.ProcessID,\n\tEXP_SRC_DataCollect.Attribute,\n\tEXP_SRC_DataCollect.o_Value AS Value,\n\tLKP_LatestSessionID.SessionId AS lkp_SessionId\n\tFROM EXP_SRC_DataCollect\n\tLEFT JOIN LKP_LatestSessionID\n\tON LKP_LatestSessionID.SessionId = EXP_SRC_DataCollect.SessionId AND LKP_LatestSessionID.Purpose = EXP_SRC_DataCollect.Purpose AND LKP_LatestSessionID.HistoryID = EXP_SRC_DataCollect.HistoryID\n\tLEFT JOIN LKP_WorkWCTrackHistory\n\tON LKP_WorkWCTrackHistory.HistoryID = EXP_SRC_DataCollect.HistoryID AND LKP_WorkWCTrackHistory.Purpose = EXP_SRC_DataCollect.Purpose\n),\nFIL_ExcludeSubmittedRecords AS (\n\tSELECT\n\tlkp_WCTrackHistoryID AS WCTrackHistoryID, \n\tExtractDate, \n\tAuditID, \n\tFilterFlag, \n\tPolicyId, \n\tProcessID, \n\tAttribute, \n\tValue\n\tFROM EXP_RecordFlagging\n\tWHERE FilterFlag='1'\n),\nWorkWCPolicyDetails AS (\n\tTRUNCATE TABLE WorkWCPolicyDetails;\n\tINSERT INTO WorkWCPolicyDetails\n\t(Auditid, ExtractDate, WCTrackHistoryID, PolicyID, ProcessID, Attribute, Value)\n\tSELECT \n\tAuditID AS AUDITID, \n\tEXTRACTDATE, \n\tWCTRACKHISTORYID, \n\tPolicyId AS POLICYID, \n\tPROCESSID, \n\tATTRIBUTE, \n\tVALUE\n\tFROM FIL_ExcludeSubmittedRecords\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "DataFeed -Informatica/PolicyDataServices/"
        },
        "annotations": []
    }
}