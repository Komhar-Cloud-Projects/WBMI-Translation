{
    "name": "s_m_POL_FEED_Load_WCPOLS_40_Record",
    "properties": {
        "activities": [
            {
                "name": "m_POL_FEED_Load_WCPOLS_40_Record",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_SupWCPols_StateCode AS (\n\tSELECT\n\tWCPOLSCode,\n\tSourcesystemID,\n\tSourceCode,\n\tTableName,\n\tProcessName\n\tFROM (\n\t\tSELECT \n\t\t\tWCPOLSCode,\n\t\t\tSourcesystemID,\n\t\t\tSourceCode,\n\t\t\tTableName,\n\t\t\tProcessName\n\t\tFROM SupWCPOLS\n\t\tWHERE Tablename='WCPOLS40Record' AND ProcessName='StateCodeRecord40' and SourceSystemId='DCT' and CurrentSnapshotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY SourceCode ORDER BY WCPOLSCode) = 1\n),\nSQ_WCPols00Record AS (\n\tSELECT\r\n\t\tWCTrackHistoryID,\r\n\t\tLinkData,\r\n\t      AuditId\r\n\tFROM dbo.WCPols00Record\r\n\tWHERE \r\n\t AuditId = @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tORDER BY WCTrackHistoryID\n),\nSQ_WorkWCTrackHistory AS (\n\tSELECT \r\n\tDISTINCT\r\n\tTrack.WCTrackHistoryID as WCTrackHistoryID, \r\n\t'WC000303' as ParsedFormName,\r\n\tForms.FormName as FormName, \r\n\tST.EmployersLiabilityCoverageEndorsementStateListExcludingOH as EmployersLiabilityCoverageEndorsementStateListExcludingOH,\r\n\tParty.Name as Name,\r\n\tPolicy.TransactionEffectiveDate as TransactionEffectiveDate  \r\n\tFROM\r\n\tWorkWCForms Forms\r\n\tinner join WorkWCTrackHistory Track \ton \r\n\t\tForms.WCTrackHistoryID=Track.WCTrackHistoryID and \r\n\t\tForms.FormName like 'WC000303%' and \r\n\t\t((Forms.OnPolicy=1 OR Forms.[Add] = 1) AND (Forms.Remove is null OR Forms.Remove = 0))\r\n\tinner join WorkWCParty Party on \r\n\t\tParty.WCTrackHistoryID=Track.WCTrackHistoryID AND \r\n\t\tParty.PartyAssociationType='Account'\r\n\tinner join WorkWCPolicy Policy on \r\n\t\tPolicy.WCTrackHistoryID=Track.WCTrackHistoryID\r\n\tinner join WorkWCStateTerm ST on\r\n\t\tST.WCTrackHistoryID=Track.WCTrackHistoryID AND ST.EmployersLiabilityCoverageEndorsementStateListExcludingOH is not null\r\n\tWHERE\r\n\tForms.Auditid = @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\t@{pipeline().parameters.WHERE_CLAUSE_40}\r\n\torder by 1\n),\nJNR_DataCollect AS (SELECT\n\tSQ_WCPols00Record.WCTrackHistoryID, \n\tSQ_WCPols00Record.LinkData, \n\tSQ_WCPols00Record.AuditId, \n\tSQ_WorkWCTrackHistory.WCTrackHistoryID AS WCTrackHistoryID1, \n\tSQ_WorkWCTrackHistory.ParsedFormName, \n\tSQ_WorkWCTrackHistory.FormName, \n\tSQ_WorkWCTrackHistory.EmployersLiabilityCoverageEndorsementStateListExcludingOH, \n\tSQ_WorkWCTrackHistory.Name, \n\tSQ_WorkWCTrackHistory.TransactionEffectiveDate\n\tFROM SQ_WCPols00Record\n\tINNER JOIN SQ_WorkWCTrackHistory\n\tON SQ_WorkWCTrackHistory.WCTrackHistoryID = SQ_WCPols00Record.WCTrackHistoryID\n),\nEXP_PrepSplit AS (\n\tSELECT\n\tEmployersLiabilityCoverageEndorsementStateListExcludingOH,\n\t',' AS Delimiter\n\tFROM JNR_DataCollect\n),\njtx_split_string AS (-- jtx_split_string\n\n\t##############################################\n\n\t# TODO: Place holder for Custom transformation\n\n\t##############################################\n),\nmplt_Parse_FormNameField AS (WITH\n\tINPUT_FormName AS (\n\t\t\n\t),\n\tEXPTRANS AS (\n\t\tSELECT\n\t\tParsedNameOfForm,\n\t\tFormNameFromSource,\n\t\t-- *INF*: REVERSE(FormNameFromSource)\n\t\tREVERSE(FormNameFromSource) AS vReversedFromNameFromSource,\n\t\t-- *INF*: REVERSE(substr(vReversedFromNameFromSource,1,4))\n\t\tREVERSE(substr(vReversedFromNameFromSource, 1, 4)) AS vFormEdition,\n\t\t-- *INF*: DECODE(TRUE,\r\n\t\t-- substr(vReversedFromNameFromSource,5,1) >='A' and substr(vReversedFromNameFromSource,5,1) <='Z', substr(vReversedFromNameFromSource,5,1),\r\n\t\t-- ' '\r\n\t\t-- )\r\n\t\t-- \r\n\t\t-- -- check if within A and Z, if not then space\n\t\tDECODE(\n\t\t    TRUE,\n\t\t    substr(vReversedFromNameFromSource, 5, 1) >= 'A' and substr(vReversedFromNameFromSource, 5, 1) <= 'Z', substr(vReversedFromNameFromSource, 5, 1),\n\t\t    ' '\n\t\t) AS vBureauCode,\n\t\tvFormEdition AS oFormEdition,\n\t\tvBureauCode AS oBureauCode\n\t\tFROM INPUT_FormName\n\t),\n\tOUTPUT_FormName AS (\n\t\tSELECT\n\t\tParsedNameOfForm, \n\t\tFormNameFromSource, \n\t\toFormEdition AS FormEdition, \n\t\toBureauCode AS BureauCode\n\t\tFROM EXPTRANS\n\t),\n),\nEXP_DataCollect AS (\n\tSELECT\n\tJNR_DataCollect.WCTrackHistoryID,\n\tJNR_DataCollect.AuditId,\n\tCURRENT_TIMESTAMP AS ExtractDate,\n\tJNR_DataCollect.LinkData,\n\t'40' AS RecordTypeCode,\n\tmplt_Parse_FormNameField.ParsedNameOfForm1 AS ParsedNameOfForm,\n\tmplt_Parse_FormNameField.FormEdition,\n\tmplt_Parse_FormNameField.BureauCode,\n\tJNR_DataCollect.Name,\n\tJNR_DataCollect.TransactionEffectiveDate AS i_TransactionEffectiveDate,\n\t-- *INF*: TO_CHAR(i_TransactionEffectiveDate,'YYMMDD')\n\tTO_CHAR(i_TransactionEffectiveDate, 'YYMMDD') AS o_TransactionEffectiveDate,\n\tjtx_split_string.OUTPUT_Field1 AS i_EmployersLiabilityCoverageEndorsementStateListExcludingOH,\n\t-- *INF*: IIF(isnull(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH),'',:LKP.LKP_SUPWCPOLS_STATECODE(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH))\n\tIFF(\n\t    i_EmployersLiabilityCoverageEndorsementStateListExcludingOH IS NULL, '',\n\t    LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH.WCPOLSCode\n\t) AS o_EmployersLiabilityCoverageEndorsementStateListExcludingOH,\n\tjtx_split_string.OUTPUT_Field2 AS i_EmployersLiabilityCoverageEndorsementStateListExcludingOH2,\n\t-- *INF*: IIF(ISNULL(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH2),'',:LKP.LKP_SUPWCPOLS_STATECODE(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH2))\n\tIFF(\n\t    i_EmployersLiabilityCoverageEndorsementStateListExcludingOH2 IS NULL, '',\n\t    LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH2.WCPOLSCode\n\t) AS o_EmployersLiabilityCoverageEndorsementStateListExcludingOH2,\n\tjtx_split_string.OUTPUT_Field3 AS i_EmployersLiabilityCoverageEndorsementStateListExcludingOH3,\n\t-- *INF*: IIF(ISNULL(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH3),'',:LKP.LKP_SUPWCPOLS_STATECODE(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH3))\n\tIFF(\n\t    i_EmployersLiabilityCoverageEndorsementStateListExcludingOH3 IS NULL, '',\n\t    LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH3.WCPOLSCode\n\t) AS o_EmployersLiabilityCoverageEndorsementStateListExcludingOH3,\n\tjtx_split_string.OUTPUT_Field4 AS i_EmployersLiabilityCoverageEndorsementStateListExcludingOH4,\n\t-- *INF*: IIF(ISNULL(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH4),'',:LKP.LKP_SUPWCPOLS_STATECODE(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH4))\n\tIFF(\n\t    i_EmployersLiabilityCoverageEndorsementStateListExcludingOH4 IS NULL, '',\n\t    LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH4.WCPOLSCode\n\t) AS o_EmployersLiabilityCoverageEndorsementStateListExcludingOH4,\n\tjtx_split_string.OUTPUT_Field5 AS i_EmployersLiabilityCoverageEndorsementStateListExcludingOH5,\n\t-- *INF*: IIF(ISNULL(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH5),'',:LKP.LKP_SUPWCPOLS_STATECODE(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH5))\n\tIFF(\n\t    i_EmployersLiabilityCoverageEndorsementStateListExcludingOH5 IS NULL, '',\n\t    LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH5.WCPOLSCode\n\t) AS o_EmployersLiabilityCoverageEndorsementStateListExcludingOH5,\n\tjtx_split_string.OUTPUT_Field6 AS i_EmployersLiabilityCoverageEndorsementStateListExcludingOH6,\n\t-- *INF*: IIF(ISNULL(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH6),'',:LKP.LKP_SUPWCPOLS_STATECODE(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH6))\n\tIFF(\n\t    i_EmployersLiabilityCoverageEndorsementStateListExcludingOH6 IS NULL, '',\n\t    LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH6.WCPOLSCode\n\t) AS o_EmployersLiabilityCoverageEndorsementStateListExcludingOH6,\n\tjtx_split_string.OUTPUT_Field7 AS i_EmployersLiabilityCoverageEndorsementStateListExcludingOH7,\n\t-- *INF*: IIF(ISNULL(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH7),'',:LKP.LKP_SUPWCPOLS_STATECODE(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH7))\n\tIFF(\n\t    i_EmployersLiabilityCoverageEndorsementStateListExcludingOH7 IS NULL, '',\n\t    LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH7.WCPOLSCode\n\t) AS o_EmployersLiabilityCoverageEndorsementStateListExcludingOH7,\n\tjtx_split_string.OUTPUT_Field8 AS i_EmployersLiabilityCoverageEndorsementStateListExcludingOH8,\n\t-- *INF*: IIF(ISNULL(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH8),'',:LKP.LKP_SUPWCPOLS_STATECODE(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH8))\n\tIFF(\n\t    i_EmployersLiabilityCoverageEndorsementStateListExcludingOH8 IS NULL, '',\n\t    LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH8.WCPOLSCode\n\t) AS o_EmployersLiabilityCoverageEndorsementStateListExcludingOH8,\n\tjtx_split_string.OUTPUT_Field9 AS i_EmployersLiabilityCoverageEndorsementStateListExcludingOH9,\n\t-- *INF*: IIF(ISNULL(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH9),'',:LKP.LKP_SUPWCPOLS_STATECODE(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH9))\n\tIFF(\n\t    i_EmployersLiabilityCoverageEndorsementStateListExcludingOH9 IS NULL, '',\n\t    LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH9.WCPOLSCode\n\t) AS o_EmployersLiabilityCoverageEndorsementStateListExcludingOH9,\n\tjtx_split_string.OUTPUT_Field10 AS i_EmployersLiabilityCoverageEndorsementStateListExcludingOH10,\n\t-- *INF*: IIF(ISNULL(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH10),'',:LKP.LKP_SUPWCPOLS_STATECODE(i_EmployersLiabilityCoverageEndorsementStateListExcludingOH10))\n\tIFF(\n\t    i_EmployersLiabilityCoverageEndorsementStateListExcludingOH10 IS NULL, '',\n\t    LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH10.WCPOLSCode\n\t) AS o_EmployersLiabilityCoverageEndorsementStateListExcludingOH10\n\tFROM JNR_DataCollect\n\t -- Manually join with jtx_split_string\n\t -- Manually join with mplt_Parse_FormNameField\n\tLEFT JOIN LKP_SUPWCPOLS_STATECODE LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH\n\tON LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH.SourceCode = i_EmployersLiabilityCoverageEndorsementStateListExcludingOH\n\n\tLEFT JOIN LKP_SUPWCPOLS_STATECODE LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH2\n\tON LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH2.SourceCode = i_EmployersLiabilityCoverageEndorsementStateListExcludingOH2\n\n\tLEFT JOIN LKP_SUPWCPOLS_STATECODE LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH3\n\tON LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH3.SourceCode = i_EmployersLiabilityCoverageEndorsementStateListExcludingOH3\n\n\tLEFT JOIN LKP_SUPWCPOLS_STATECODE LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH4\n\tON LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH4.SourceCode = i_EmployersLiabilityCoverageEndorsementStateListExcludingOH4\n\n\tLEFT JOIN LKP_SUPWCPOLS_STATECODE LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH5\n\tON LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH5.SourceCode = i_EmployersLiabilityCoverageEndorsementStateListExcludingOH5\n\n\tLEFT JOIN LKP_SUPWCPOLS_STATECODE LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH6\n\tON LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH6.SourceCode = i_EmployersLiabilityCoverageEndorsementStateListExcludingOH6\n\n\tLEFT JOIN LKP_SUPWCPOLS_STATECODE LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH7\n\tON LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH7.SourceCode = i_EmployersLiabilityCoverageEndorsementStateListExcludingOH7\n\n\tLEFT JOIN LKP_SUPWCPOLS_STATECODE LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH8\n\tON LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH8.SourceCode = i_EmployersLiabilityCoverageEndorsementStateListExcludingOH8\n\n\tLEFT JOIN LKP_SUPWCPOLS_STATECODE LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH9\n\tON LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH9.SourceCode = i_EmployersLiabilityCoverageEndorsementStateListExcludingOH9\n\n\tLEFT JOIN LKP_SUPWCPOLS_STATECODE LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH10\n\tON LKP_SUPWCPOLS_STATECODE_i_EmployersLiabilityCoverageEndorsementStateListExcludingOH10.SourceCode = i_EmployersLiabilityCoverageEndorsementStateListExcludingOH10\n\n),\nWCPols40Record AS (\n\tINSERT INTO WCPols40Record\n\t(ExtractDate, AuditId, WCTrackHistoryID, LinkData, RecordTypeCode, EndorsementNumber, BureauVersionIdentifierEditionIdentifier, CarrierVersionIdentifier, StateCode, StateCode2, StateCode3, StateCode4, StateCode5, StateCode6, StateCode7, StateCode8, StateCode9, StateCode10, NameOfInsured, EndorsementEffectiveDate)\n\tSELECT \n\tEXTRACTDATE, \n\tAUDITID, \n\tWCTRACKHISTORYID, \n\tLINKDATA, \n\tRECORDTYPECODE, \n\tParsedNameOfForm AS ENDORSEMENTNUMBER, \n\tBureauCode AS BUREAUVERSIONIDENTIFIEREDITIONIDENTIFIER, \n\tFormEdition AS CARRIERVERSIONIDENTIFIER, \n\to_EmployersLiabilityCoverageEndorsementStateListExcludingOH AS STATECODE, \n\to_EmployersLiabilityCoverageEndorsementStateListExcludingOH2 AS STATECODE2, \n\to_EmployersLiabilityCoverageEndorsementStateListExcludingOH3 AS STATECODE3, \n\to_EmployersLiabilityCoverageEndorsementStateListExcludingOH4 AS STATECODE4, \n\to_EmployersLiabilityCoverageEndorsementStateListExcludingOH5 AS STATECODE5, \n\to_EmployersLiabilityCoverageEndorsementStateListExcludingOH6 AS STATECODE6, \n\to_EmployersLiabilityCoverageEndorsementStateListExcludingOH7 AS STATECODE7, \n\to_EmployersLiabilityCoverageEndorsementStateListExcludingOH8 AS STATECODE8, \n\to_EmployersLiabilityCoverageEndorsementStateListExcludingOH9 AS STATECODE9, \n\to_EmployersLiabilityCoverageEndorsementStateListExcludingOH10 AS STATECODE10, \n\tName AS NAMEOFINSURED, \n\to_TransactionEffectiveDate AS ENDORSEMENTEFFECTIVEDATE\n\tFROM EXP_DataCollect\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_CLAUSE_40": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "DataFeed -Informatica/PolicyDataServices/"
        },
        "annotations": []
    }
}