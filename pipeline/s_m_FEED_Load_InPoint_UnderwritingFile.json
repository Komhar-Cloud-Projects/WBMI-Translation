{
    "name": "s_m_FEED_Load_InPoint_UnderwritingFile",
    "properties": {
        "activities": [
            {
                "name": "m_FEED_Load_InPoint_UnderwritingFile",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_CommercialProductManagementExtract AS (\n\tSELECT\n\t\tCommercialProductManagementExtractId AS WorkCommericalProductManagementExtractId,\n\t\tAuditId,\n\t\tModifiedDate,\n\t\tCustomerNumber,\n\t\tPolicyNumber,\n\t\tPolicyOfferingDescription,\n\t\tFirstNamedInsured,\n\t\tPolicyEffectiveDate,\n\t\tDirectWrittenPremium,\n\t\tDirectLossIncurred,\n\t\tDirectLossIncurredRatio,\n\t\tDirectLossIncurred3Yrs,\n\t\tDirectLossIncurredRatio3Yrs,\n\t\tPrimaryBusinessClassCode AS PrimaryBusinessClassificationCode,\n\t\tPrimaryBusinessClassDescription AS PrimaryBusinessClassificationDescript,\n\t\tStrategicProfitCenterDescription,\n\t\tProgramCode,\n\t\tProgramDescription,\n\t\tIndustryRiskGradeCode,\n\t\tAgencyCode,\n\t\tAbbreviatedAgencyName,\n\t\tUnderwritingRegionCodeDescription,\n\t\tPolicyIssueCode,\n\t\tRunDate AS PreviousMonthDate,\n\t\tAccountOver150KFlag AS AccountOver150K,\n\t\tInsuranceReferenceLineOfBusinessDescription,\n\t\tUnderWriterName,\n\t\tUnderWriterManagerName,\n\t\tStrategicBusinessGroupDescription,\n\t\tSalesTerritoryDescription,\n\t\tUnderwriterManagerEmailAddress,\n\t\tUnderwriterManagerCode,\n\t\tUnderwriterEmailAddress,\n\t\tUnderwriterCode,\n\t\tAccountSize\n\tFROM CommercialProductManagementExtract\n),\nEXP_WorkCommericalProductManagementExtract AS (\n\tSELECT\n\t-- *INF*: GET_DATE_PART ( SYSDATE, 'YYYY' )\n\tDATE_PART(CURRENT_TIMESTAMP, 'YYYY') AS v_Curr_Year,\n\t-- *INF*: GET_DATE_PART ( SYSDATE, 'YYYY' ) - 1\n\tDATE_PART(CURRENT_TIMESTAMP, 'YYYY') - 1 AS v_Prev_Year,\n\t-- *INF*: IIF(GET_DATE_PART ( SYSDATE, 'MM' )=1,\r\n\t-- v_Prev_Year||12,v_Curr_Year)\n\tIFF(DATE_PART(CURRENT_TIMESTAMP, 'MM') = 1, v_Prev_Year || 12, v_Curr_Year) AS v_Year,\n\t-- *INF*: IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =1,'01',\r\n\t-- IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =2,'02',\r\n\t-- IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =3,'03',\r\n\t-- IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =4,'04',\r\n\t--  IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =5,'05',\r\n\t--  IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =6,'06',\r\n\t--  IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =7,'07',\r\n\t--  IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =8,'08',\r\n\t--  IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =9,'09',\r\n\t--  IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =10,'10',\r\n\t--  IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =11,'11',\r\n\t--  IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =12,'12'))))))))))))\n\tIFF(\n\t    DATE_PART(CURRENT_TIMESTAMP, 'MM') - 1 = 1, '01',\n\t    IFF(\n\t        DATE_PART(CURRENT_TIMESTAMP, 'MM') - 1 = 2, '02',\n\t        IFF(\n\t            DATE_PART(CURRENT_TIMESTAMP, 'MM') - 1 = 3, '03',\n\t            IFF(\n\t                DATE_PART(CURRENT_TIMESTAMP, 'MM') - 1 = 4, '04',\n\t                IFF(\n\t                    DATE_PART(CURRENT_TIMESTAMP, 'MM') - 1 = 5, '05',\n\t                    IFF(\n\t                        DATE_PART(CURRENT_TIMESTAMP, 'MM') - 1 = 6, '06',\n\t                        IFF(\n\t                            DATE_PART(CURRENT_TIMESTAMP, 'MM') - 1 = 7,\n\t                            '07',\n\t                            IFF(\n\t                                DATE_PART(CURRENT_TIMESTAMP, 'MM') - 1 = 8,\n\t                                '08',\n\t                                IFF(\n\t                                    DATE_PART(CURRENT_TIMESTAMP, 'MM') - 1 = 9,\n\t                                    '09',\n\t                                    IFF(\n\t                                        DATE_PART(CURRENT_TIMESTAMP, 'MM') - 1 = 10,\n\t                                        '10',\n\t                                        IFF(\n\t                                            DATE_PART(CURRENT_TIMESTAMP, 'MM') - 1 = 11,\n\t                                            '11',\n\t                                            IFF(\n\t                                                DATE_PART(CURRENT_TIMESTAMP, 'MM') - 1 = 12,\n\t                                                '12'\n\t                                            )\n\t                                        )\n\t                                    )\n\t                                )\n\t                            )\n\t                        )\n\t                    )\n\t                )\n\t            )\n\t        )\n\t    )\n\t) AS v_Month,\n\t-- *INF*: --IIF(GET_DATE_PART ( SYSDATE, 'MM' )-1 =0,31,\r\n\t-- GET_DATE_PART(LAST_DAY(ADD_TO_DATE(SYSDATE,'MM',-1)),'DD')\r\n\t-- --)\n\tDATE_PART(LAST_DAY(DATEADD(MONTH,- 1,CURRENT_TIMESTAMP)), 'DD') AS v_Day,\n\t'us_ftp_westbend-uw_'||v_Year||v_Month||v_Day||'.csv' AS FileName,\n\tWorkCommericalProductManagementExtractId,\n\tAuditId,\n\tModifiedDate,\n\tCustomerNumber,\n\tPolicyNumber,\n\tPolicyOfferingDescription AS PolicyOffering,\n\tFirstNamedInsured,\n\t-- *INF*:  REPLACESTR(1,'\"'||FirstNamedInsured||'\"','\"','')\r\n\t-- \n\tREGEXP_REPLACE('\"' || FirstNamedInsured || '\"','\"','') AS o_FirstNamedInsured,\n\tPolicyEffectiveDate,\n\t-- *INF*: TO_Date (TO_CHAR (PolicyEffectiveDate, 'MON DD YYYY' ), 'MON DD YYYY' ) \n\tTO_TIMESTAMP(TO_CHAR(PolicyEffectiveDate, 'MON DD YYYY'), 'MON DD YYYY') AS o_PolicyEffectiveDate,\n\tDirectWrittenPremium,\n\t-- *INF*: IIF(ISNULL(DirectWrittenPremium),'0.00',\r\n\t-- iif(DirectWrittenPremium<0.00 ,'('||DirectWrittenPremium||')',\r\n\t-- to_char(DirectWrittenPremium)))\n\tIFF(\n\t    DirectWrittenPremium IS NULL, '0.00',\n\t    IFF(\n\t        DirectWrittenPremium < 0.00, '(' || DirectWrittenPremium || ')',\n\t        to_char(DirectWrittenPremium)\n\t    )\n\t) AS o_DirectWrittenPremium,\n\tDirectLossIncurred,\n\t-- *INF*: IIF(ISNULL(DirectLossIncurred),'0.00',\r\n\t-- iif(DirectLossIncurred<0.00 ,'('||DirectLossIncurred||')',\r\n\t-- to_char(DirectLossIncurred)))\n\tIFF(\n\t    DirectLossIncurred IS NULL, '0.00',\n\t    IFF(\n\t        DirectLossIncurred < 0.00, '(' || DirectLossIncurred || ')',\n\t        to_char(DirectLossIncurred)\n\t    )\n\t) AS o_DirectLossIncurred,\n\tDirectLossIncurredRatio,\n\t-- *INF*: IIF(ISNULL(DirectLossIncurredRatio),0,DirectLossIncurredRatio)\n\tIFF(DirectLossIncurredRatio IS NULL, 0, DirectLossIncurredRatio) AS o_DirectLossIncurredRatio,\n\tDirectLossIncurred3Yrs,\n\t-- *INF*: IIF(ISNULL(DirectLossIncurred3Yrs),'0.00',\r\n\t-- iif(DirectLossIncurred3Yrs<0.00 ,'('||DirectLossIncurred3Yrs||')',\r\n\t-- to_char(DirectLossIncurred3Yrs)))\n\tIFF(\n\t    DirectLossIncurred3Yrs IS NULL, '0.00',\n\t    IFF(\n\t        DirectLossIncurred3Yrs < 0.00, '(' || DirectLossIncurred3Yrs || ')',\n\t        to_char(DirectLossIncurred3Yrs)\n\t    )\n\t) AS o_DirectLossIncurred3Yr,\n\tDirectLossIncurredRatio3Yrs,\n\t-- *INF*: IIF(ISNULL(DirectLossIncurredRatio3Yrs),'0.0',TO_CHAR(DirectLossIncurredRatio3Yrs))\r\n\t-- \r\n\t-- \n\tIFF(DirectLossIncurredRatio3Yrs IS NULL, '0.0', TO_CHAR(DirectLossIncurredRatio3Yrs)) AS o_DirectLossIncurredRatio3Yrs,\n\tPrimaryBusinessClassificationCode,\n\tPrimaryBusinessClassificationDescript,\n\tStrategicProfitCenterDescription,\n\tProgramCode,\n\tProgramDescription,\n\tIndustryRiskGradeCode,\n\tAgencyCode,\n\tAbbreviatedAgencyName,\n\tUnderwritingRegionCodeDescription,\n\tPolicyIssueCode,\n\tPreviousMonthDate,\n\t-- *INF*: TO_CHAR(to_date(PreviousMonthDate,'MM/DD/YYYY'),'YYYY MON')\n\tTO_CHAR(TO_TIMESTAMP(PreviousMonthDate, 'MM/DD/YYYY'), 'YYYY MON') AS o_PreviousMonthDate,\n\tAccountOver150K,\n\t-- *INF*: iif(AccountOver150K='True','Yes','No')\n\tIFF(AccountOver150K = 'True', 'Yes', 'No') AS o_AccountOver150K,\n\tInsuranceReferenceLineOfBusinessDescription AS i_InsuranceReferenceLineOfBusinessDescription,\n\ti_InsuranceReferenceLineOfBusinessDescription AS o_InsuranceReferenceLineOfBusinessDescription,\n\tUnderWriterName AS i_UnderWriterName,\n\t'' AS o_UnderWriterName,\n\tUnderWriterManagerName AS i_UnderWriterManagerName,\n\t'' AS o_UnderWriterManagerName,\n\tStrategicBusinessGroupDescription,\n\tSalesTerritoryDescription,\n\tUnderwriterManagerEmailAddress AS i_UnderwriterManagerEmailAddress,\n\t'' AS o_UnderwriterManagerEmailAddress,\n\tUnderwriterManagerCode AS i_UnderwriterManagerCode,\n\t'' AS o_UnderwriterManagerCode,\n\tUnderwriterEmailAddress AS i_UnderwriterEmailAddress,\n\t'' AS o_UnderwriterEmailAddress,\n\tUnderwriterCode AS i_UnderwriterCode,\n\t'' AS o_UnderwriterCode,\n\tAccountSize\n\tFROM SQ_CommercialProductManagementExtract\n),\nCommericalProductManagementExtractFile AS (\n\tINSERT INTO CommericalProductManagementExtractFile\n\t(FileName, CustomerNumber, PolicyNumber, PolicyOffering, FirstNamedInsured, PolicyEffectiveDate, DirectWrittenPremium, DirectLossIncurred, DirectLossIncurredRatio, DirectLossIncurred3Yr, DirectLossIncurredRatio3Yr, PrimaryBusinessClassificationCode, PrimaryBusinessClassificationDescript, StrategicBusinessGroupDescription, ProgramCode, ProgramDescription, IndustryRiskGradeCode, AgencyCode, AgencyName, UWRegion, PolicyIssueCode, AsofDate, AccountOver150K, InsuranceReferenceLineOfBusinessDescription, StrategicProfitCenterDescription, SalesTerritoryDescription, UnderWriterName, UnderWriterManagerName, UnderwriterManagerEmailAddress, UnderwriterEmailAddress, UnderwriterManagerWestBendAssociateID, UnderwriterWestBendAssociateID, AccountSize)\n\tSELECT \n\tFILENAME, \n\tCUSTOMERNUMBER, \n\tPOLICYNUMBER, \n\tPOLICYOFFERING, \n\to_FirstNamedInsured AS FIRSTNAMEDINSURED, \n\to_PolicyEffectiveDate AS POLICYEFFECTIVEDATE, \n\to_DirectWrittenPremium AS DIRECTWRITTENPREMIUM, \n\to_DirectLossIncurred AS DIRECTLOSSINCURRED, \n\to_DirectLossIncurredRatio AS DIRECTLOSSINCURREDRATIO, \n\to_DirectLossIncurred3Yr AS DIRECTLOSSINCURRED3YR, \n\to_DirectLossIncurredRatio3Yrs AS DIRECTLOSSINCURREDRATIO3YR, \n\tPRIMARYBUSINESSCLASSIFICATIONCODE, \n\tPRIMARYBUSINESSCLASSIFICATIONDESCRIPT, \n\tSTRATEGICBUSINESSGROUPDESCRIPTION, \n\tPROGRAMCODE, \n\tPROGRAMDESCRIPTION, \n\tINDUSTRYRISKGRADECODE, \n\tAGENCYCODE, \n\tAbbreviatedAgencyName AS AGENCYNAME, \n\tUnderwritingRegionCodeDescription AS UWREGION, \n\tPOLICYISSUECODE, \n\to_PreviousMonthDate AS ASOFDATE, \n\to_AccountOver150K AS ACCOUNTOVER150K, \n\to_InsuranceReferenceLineOfBusinessDescription AS INSURANCEREFERENCELINEOFBUSINESSDESCRIPTION, \n\tSTRATEGICPROFITCENTERDESCRIPTION, \n\tSALESTERRITORYDESCRIPTION, \n\to_UnderWriterName AS UNDERWRITERNAME, \n\to_UnderWriterManagerName AS UNDERWRITERMANAGERNAME, \n\to_UnderwriterManagerEmailAddress AS UNDERWRITERMANAGEREMAILADDRESS, \n\to_UnderwriterEmailAddress AS UNDERWRITEREMAILADDRESS, \n\to_UnderwriterManagerCode AS UNDERWRITERMANAGERWESTBENDASSOCIATEID, \n\to_UnderwriterCode AS UNDERWRITERWESTBENDASSOCIATEID, \n\tACCOUNTSIZE\n\tFROM EXP_WorkCommericalProductManagementExtract\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {},
        "folder": {
            "name": "DataFeed -Informatica/PolicyDataServices/"
        },
        "annotations": []
    }
}