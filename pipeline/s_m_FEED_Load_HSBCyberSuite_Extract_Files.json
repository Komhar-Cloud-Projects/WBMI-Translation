{
    "name": "s_m_FEED_Load_HSBCyberSuite_Extract_Files",
    "properties": {
        "activities": [
            {
                "name": "m_FEED_Load_HSBCyberSuite_Extract_Files",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_HSBCyberPolicyExtract AS (\n\tSELECT\n\t\tHSBCyberSuitePolicyExtractId AS HSBCyberPolicyExtractId,\n\t\tAuditId AS AuditID,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tRunDate,\n\t\tCompany,\n\t\tProductCode,\n\t\tContractNumber,\n\t\tPolicyNumber,\n\t\tCBSCoverageEffectiveDate AS PolicyEffectiveDate,\n\t\tCBSCoverageExpirationDate AS PolicyExpirationDate,\n\t\tNameOfInsured,\n\t\tMailingAddressStreetName,\n\t\tMailingAddressCity,\n\t\tMailingAddressState,\n\t\tMailingAddressZipCode,\n\t\tTotalPackageGrossPremium,\n\t\tTotalPropertyGrossPremium,\n\t\tCBSGrossPremium AS GrossPremium,\n\t\tCBSNetPremium AS NetPremium,\n\t\tLimitAmount AS FirstPartyLimit,\n\t\tLimitType,\n\t\tDeductibleAmount AS FirstPartyDeductible,\n\t\tOccupancyCode,\n\t\tPolicyTotalInsuredValue,\n\t\tPreviousPolicyNumber,\n\t\tAgentCode AS AgencyCode,\n\t\tBranchCode,\n\t\tCBSPricingTier\n\tFROM HSBCyberSuitePolicyExtract_Source\n\tWHERE convert(date,CBSCoverageEffectiveDate)<=@{pipeline().parameters.RUNDATE}\r\n\tAND \r\n\tconvert(date,CBSCoverageExpirationDate)>=@{pipeline().parameters.RUNDATE}\n),\nEXP_PolicyExtract AS (\n\tSELECT\n\tCompany,\n\tProductCode,\n\tContractNumber,\n\tPolicyNumber,\n\tPolicyEffectiveDate,\n\t-- *INF*: TO_CHAR(PolicyEffectiveDate, 'YYYYMMDD')\n\tTO_CHAR(PolicyEffectiveDate, 'YYYYMMDD') AS PolicyEffectiveDateYYYYMMDD,\n\tPolicyExpirationDate,\n\t-- *INF*: TO_CHAR(PolicyExpirationDate, 'YYYYMMDD')\n\tTO_CHAR(PolicyExpirationDate, 'YYYYMMDD') AS PolicyExpirationDateYYYYMMDD,\n\tNameOfInsured,\n\tMailingAddressStreetName,\n\tMailingAddressCity,\n\tMailingAddressState,\n\tMailingAddressZipCode,\n\tTotalPackageGrossPremium,\n\tTotalPropertyGrossPremium,\n\tGrossPremium,\n\tNetPremium,\n\tFirstPartyLimit AS CyberOneFirstPartyLimit,\n\tLimitType,\n\tFirstPartyDeductible,\n\tOccupancyCode,\n\tPolicyTotalInsuredValue,\n\tPreviousPolicyNumber,\n\tAgencyCode,\n\tBranchCode,\n\tCBSPricingTier\n\tFROM SQ_HSBCyberPolicyExtract\n),\nHSBCyberSuitePolicyRecordFile AS (\n\tINSERT INTO HSBCyberSuitePolicyRecordFile\n\t(Company, ProductCode, ContractNumber, PolicyNumber, CBSCoverageEffectiveDate, CBSCoverageExpirationDate, NameOfInsured, MailingAddressStreetName, MailingAddressCity, MailingAddressState, MailingAddressZipCode, TotalPackageGrossPremium, TotalPropertyGrossPremium, CBSGrossPremium, CBSNetPremium, LimitAmount, LimitType, DeductibleAmount, OccupancyCode, PolicyTotalInsuredValue, PreviousPolicyNumber, AgencyCode, BranchCode, WebSite, EmailAddress, CBSPricingTier)\n\tSELECT \n\tCOMPANY, \n\tPRODUCTCODE, \n\tCONTRACTNUMBER, \n\tPOLICYNUMBER, \n\tPolicyEffectiveDateYYYYMMDD AS CBSCOVERAGEEFFECTIVEDATE, \n\tPolicyExpirationDateYYYYMMDD AS CBSCOVERAGEEXPIRATIONDATE, \n\tNAMEOFINSURED, \n\tMAILINGADDRESSSTREETNAME, \n\tMAILINGADDRESSCITY, \n\tMAILINGADDRESSSTATE, \n\tMAILINGADDRESSZIPCODE, \n\tTOTALPACKAGEGROSSPREMIUM, \n\tTOTALPROPERTYGROSSPREMIUM, \n\tGrossPremium AS CBSGROSSPREMIUM, \n\tNetPremium AS CBSNETPREMIUM, \n\tCyberOneFirstPartyLimit AS LIMITAMOUNT, \n\tLIMITTYPE, \n\tFirstPartyDeductible AS DEDUCTIBLEAMOUNT, \n\tOCCUPANCYCODE, \n\tPOLICYTOTALINSUREDVALUE, \n\tPREVIOUSPOLICYNUMBER, \n\tAGENCYCODE, \n\tBRANCHCODE, \n\tWEBSITE, \n\tEMAILADDRESS, \n\tCBSPRICINGTIER\n\tFROM EXP_PolicyExtract\n),\nSQ_HSBCyberPaymentBordereauExtract AS (\n\tSELECT\n\t\tHSBCyberSuiteBordereauExtractId AS HSBCyberPaymentBordereauExtractId,\n\t\tAuditId AS AuditID,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tRunDate,\n\t\tProductCode,\n\t\tCompany,\n\t\tPolicyNumber,\n\t\tTransactionCode,\n\t\tTransactionEffectiveDate,\n\t\tCoverageEffectiveDate,\n\t\tCoverageExpirationDate,\n\t\tCoverageGrossPremium,\n\t\tCoverageNetPremium,\n\t\tPreviousPolicyNumber,\n\t\tProgramID,\n\t\tNameOfInsured,\n\t\tContractNumber\n\tFROM HSBCyberSuiteBordereauExtract1\n\tWHERE AuditId=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\n),\nEXP_BordereauExtract AS (\n\tSELECT\n\tProductCode,\n\tCompany,\n\tPolicyNumber,\n\tTransactionCode,\n\tTransactionEffectiveDate,\n\tCoverageEffectiveDate,\n\tCoverageExpirationDate,\n\t-- *INF*: TO_CHAR(TransactionEffectiveDate,'YYYYMMDD')\r\n\t-- \n\tTO_CHAR(TransactionEffectiveDate, 'YYYYMMDD') AS TransactionEffectiveDateYYYYMMDD,\n\t-- *INF*: TO_CHAR(CoverageEffectiveDate,'YYYYMMDD')\n\tTO_CHAR(CoverageEffectiveDate, 'YYYYMMDD') AS CoverageEffectiveDateYYYYMMDD,\n\t-- *INF*: TO_CHAR(CoverageExpirationDate,'YYYYMMDD')\n\tTO_CHAR(CoverageExpirationDate, 'YYYYMMDD') AS CoverageExpirationDateYYYYMMDD,\n\tCoverageGrossPremium,\n\tCoverageNetPremium,\n\tPreviousPolicyNumber,\n\tProgramID,\n\tNameOfInsured,\n\tContractNumber\n\tFROM SQ_HSBCyberPaymentBordereauExtract\n),\nHSBCyberSuiteBordereauxRecordFile AS (\n\tINSERT INTO HSBCyberSuiteBordereauxRecordFile\n\t(ProductCode, Company, PolicyNumber, TransactionCode, TransactionEffectiveDate, CoverageEffectiveDate, CoverageExpirationDate, CoverageGrossPremium, CoverageNetPremium, PreviousPolicyNumber, ProgramID, NameOfInsured, ContractNumber)\n\tSELECT \n\tPRODUCTCODE, \n\tCOMPANY, \n\tPOLICYNUMBER, \n\tTRANSACTIONCODE, \n\tTransactionEffectiveDateYYYYMMDD AS TRANSACTIONEFFECTIVEDATE, \n\tCoverageEffectiveDateYYYYMMDD AS COVERAGEEFFECTIVEDATE, \n\tCoverageExpirationDateYYYYMMDD AS COVERAGEEXPIRATIONDATE, \n\tCOVERAGEGROSSPREMIUM, \n\tCOVERAGENETPREMIUM, \n\tPREVIOUSPOLICYNUMBER, \n\tPROGRAMID, \n\tNAMEOFINSURED, \n\tCONTRACTNUMBER\n\tFROM EXP_BordereauExtract\n),\nSQ_HSBCyberPolicyExtractCntl AS (\n\tSELECT\n\t\tHSBCyberSuitePolicyExtractId AS HSBCyberPolicyExtractId,\n\t\tAuditId AS AuditID,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tRunDate,\n\t\tCompany,\n\t\tProductCode,\n\t\tContractNumber,\n\t\tPolicyNumber,\n\t\tCBSCoverageEffectiveDate AS PolicyEffectiveDate,\n\t\tCBSCoverageExpirationDate AS PolicyExpirationDate,\n\t\tNameOfInsured,\n\t\tMailingAddressStreetName,\n\t\tMailingAddressCity,\n\t\tMailingAddressState,\n\t\tMailingAddressZipCode,\n\t\tTotalPackageGrossPremium,\n\t\tTotalPropertyGrossPremium,\n\t\tCBSGrossPremium AS GrossPremium,\n\t\tCBSNetPremium AS NetPremium,\n\t\tLimitAmount AS FirstPartyLimit,\n\t\tDeductibleAmount AS FirstPartyDeductible,\n\t\tOccupancyCode,\n\t\tPolicyTotalInsuredValue,\n\t\tPreviousPolicyNumber,\n\t\tAgentCode AS AgencyCode,\n\t\tBranchCode,\n\t\tLimitType AS FirstPartyCoverage,\n\t\tWebSite,\n\t\tEmailAddress,\n\t\tCBSPricingTier\n\tFROM HSBCyberSuitePolicyExtract\n\tWHERE convert(date,CBSCoverageEffectiveDate)<=@{pipeline().parameters.RUNDATE}\r\n\tAND \r\n\tconvert(date,CBSCoverageExpirationDate)>=@{pipeline().parameters.RUNDATE}\n),\nAGG_Policy_Extract AS (\n\tSELECT\n\tRunDate,\n\tCompany,\n\tProductCode AS ProductName,\n\t'CONTROL' AS Record_Type,\n\t-- *INF*: COUNT(1)\n\tCOUNT(1) AS Number_of_Records,\n\t-- *INF*: TO_CHAR(RunDate, 'YYYYMMDD')\n\tTO_CHAR(RunDate, 'YYYYMMDD') AS Inforce_Date,\n\t'01.01' AS Version_Number,\n\t'' AS Filler\n\tFROM SQ_HSBCyberPolicyExtractCntl\n\tGROUP BY \n),\nHSBCyberSuitePolicyRecordControlFile AS (\n\tINSERT INTO HSBCyberSuitePolicyRecordControlFile\n\t(Company, ProductCode, Control, RecordCount, RunDateYYYYMMDD, HardCodeString, HardCodeString2)\n\tSELECT \n\tCOMPANY, \n\tProductName AS PRODUCTCODE, \n\tRecord_Type AS CONTROL, \n\tNumber_of_Records AS RECORDCOUNT, \n\tInforce_Date AS RUNDATEYYYYMMDD, \n\tVersion_Number AS HARDCODESTRING, \n\tFiller AS HARDCODESTRING2\n\tFROM AGG_Policy_Extract\n),\nSQ_HSBCyberSuiteBordereauExtractCntl AS (\n\tSELECT\n\t\tHSBCyberSuiteBordereauExtractId AS HSBCyberPaymentBordereauExtractId,\n\t\tAuditId AS AuditID,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tRunDate,\n\t\tProductCode,\n\t\tCompany,\n\t\tPolicyNumber,\n\t\tTransactionCode,\n\t\tTransactionEffectiveDate,\n\t\tCoverageEffectiveDate,\n\t\tCoverageExpirationDate,\n\t\tCoverageGrossPremium,\n\t\tCoverageNetPremium,\n\t\tPreviousPolicyNumber,\n\t\tProgramID,\n\t\tNameOfInsured,\n\t\tContractNumber\n\tFROM HSBCyberSuiteBordereauExtract\n\tWHERE AuditId=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\n),\nAGG_PaymentBordereauxRecord AS (\n\tSELECT\n\t'CONTROL' AS Record_Type,\n\tRunDate,\n\tCompany,\n\tCoverageGrossPremium,\n\tCoverageNetPremium,\n\t-- *INF*: Count(1)\n\tCount(1) AS RecordCount,\n\t-- *INF*: Sum(CoverageGrossPremium)\n\tSum(CoverageGrossPremium) AS SumCoverageGrossPremium,\n\t-- *INF*: Sum(CoverageNetPremium)\n\tSum(CoverageNetPremium) AS SumCoverageNetPremium,\n\t-- *INF*: to_char(RunDate, 'YYYYMM')\n\tto_char(RunDate, 'YYYYMM') AS Reporting_Period,\n\t'08.07' AS Version_Number,\n\t'' AS Filler\n\tFROM SQ_HSBCyberSuiteBordereauExtractCntl\n\tGROUP BY Company, Reporting_Period\n),\nHSBCyberSuiteBordereauxRecordControlFile AS (\n\tINSERT INTO HSBCyberSuiteBordereauxRecordControlFile\n\t(Control, Company, RecordCount, SumCoverageGrossPremium, SumCoverageNetPremium, RunDateYYYYMMDD, HardCodeString, HardCodeString2)\n\tSELECT \n\tRecord_Type AS CONTROL, \n\tCOMPANY, \n\tRECORDCOUNT, \n\tSUMCOVERAGEGROSSPREMIUM, \n\tSUMCOVERAGENETPREMIUM, \n\tReporting_Period AS RUNDATEYYYYMMDD, \n\tVersion_Number AS HARDCODESTRING, \n\tFiller AS HARDCODESTRING2\n\tFROM AGG_PaymentBordereauxRecord\n),\nSQ_HSBCyberSuiteReferralExtract AS (\n\tSELECT\n\t\tHSBCyberSuiteReferralExtractId,\n\t\tAuditId,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tRunDate,\n\t\tCreationDate,\n\t\tPolicyRequestDate,\n\t\tNameOfInsured,\n\t\tCustomerNumber,\n\t\tPolicyNumber,\n\t\tAgencyName,\n\t\tAgentCode,\n\t\tLimitAmount,\n\t\tOccupancyCode,\n\t\tQuestion1,\n\t\tQuestion2,\n\t\tQuestion3,\n\t\tQuestion4,\n\t\tQuestion5,\n\t\tQuestion6\n\tFROM HSBCyberSuiteReferralExtract\n\tWHERE AuditId=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\n),\nEXP_referral_record AS (\n\tSELECT\n\tRunDate,\n\tCreationDate,\n\tPolicyRequestDate,\n\tNameOfInsured,\n\tCustomerNumber,\n\tPolicyNumber,\n\tAgencyName,\n\tAgentCode AS AgencyCode,\n\tLimitAmount,\n\tOccupancyCode,\n\tQuestion1,\n\tQuestion2,\n\tQuestion3,\n\tQuestion4,\n\tQuestion5,\n\tQuestion6\n\tFROM SQ_HSBCyberSuiteReferralExtract\n),\nHSBCyberSuiteReferralRecordFile AS (\n\tINSERT INTO HSBCyberSuiteReferralRecordFile\n\t(RunDate, CreationDate, PolicyRequestDate, NameOfInsured, CustomerNumber, PolicyNumber, AgencyName, AgencyCode, LimitAmount, OccupancyCode, Question1, Question2, Question3, Question4, Question5, Question6)\n\tSELECT \n\tRUNDATE, \n\tCREATIONDATE, \n\tPOLICYREQUESTDATE, \n\tNAMEOFINSURED, \n\tCUSTOMERNUMBER, \n\tPOLICYNUMBER, \n\tAGENCYNAME, \n\tAGENCYCODE, \n\tLIMITAMOUNT, \n\tOCCUPANCYCODE, \n\tQUESTION1, \n\tQUESTION2, \n\tQUESTION3, \n\tQUESTION4, \n\tQUESTION5, \n\tQUESTION6\n\tFROM EXP_referral_record\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "RUNDATE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "DataFeed -Informatica/PolicyDataServices/"
        },
        "annotations": []
    }
}