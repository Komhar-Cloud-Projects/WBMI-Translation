{
    "name": "m_POL_DM_LOAD_InsuranceReferenceDim",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DM_LOAD_InsuranceReferenceDim",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_Association AS (\n\tWITH T as (\r\n\tSELECT C.EnterpriseGroupId,\r\n\tD.InsuranceReferenceLegalEntityId,\r\n\tB.StrategicProfitCenterId,\r\n\tA.InsuranceSegmentId,\r\n\tA.PolicyOfferingId,\r\n\tA.ProductId,\r\n\tInsuranceReferenceLineOfBusinessId,\r\n\tRP.RatingPlanId\r\n\tFROM DBO.InsuranceReferenceBridge A\r\n\tLEFT JOIN DBO.StrategicProfitCenter B\r\n\tON A.StrategicProfitCenterId=B.StrategicProfitCenterId\r\n\tLEFT JOIN DBO.EnterpriseGroup C\r\n\tON B.EnterpriseGroupId=C.EnterpriseGroupId\r\n\tLEFT JOIN DBO.InsuranceReferenceLegalEntity D\r\n\tON D.InsuranceReferenceLegalEntityId=B.InsuranceReferenceLegalEntityId\r\n\tLEFT JOIN dbo.RatingPlanProduct RP\r\n\ton A.ProductId=RP.ProductId\r\n\t),\r\n\tt_id as (\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tNULL as InsuranceReferenceLegalEntityId,\r\n\tNULL as StrategicProfitCenterId,\r\n\tNULL as InsuranceSegmentId,\r\n\tNULL as PolicyOfferingId,\r\n\tNULL as ProductId,\r\n\tNULL as InsuranceReferenceLineOfBusinessId,\r\n\tNULL as RatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tNULL as StrategicProfitCenterId,\r\n\tNULL as InsuranceSegmentId,\r\n\tNULL as PolicyOfferingId,\r\n\tNULL as ProductId,\r\n\tNULL as InsuranceReferenceLineOfBusinessId,\r\n\tNULL as RatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tNULL as InsuranceSegmentId,\r\n\tNULL as PolicyOfferingId,\r\n\tNULL as ProductId,\r\n\tNULL as InsuranceReferenceLineOfBusinessId,\r\n\tNULL as RatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\t5 as StrategicProfitCenterId,\r\n\tNULL as InsuranceSegmentId,\r\n\tNULL as PolicyOfferingId,\r\n\tNULL as ProductId,\r\n\tNULL as InsuranceReferenceLineOfBusinessId,\r\n\tNULL as RatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tInsuranceSegmentId,\r\n\tNULL as PolicyOfferingId,\r\n\tNULL as ProductId,\r\n\tNULL as InsuranceReferenceLineOfBusinessId,\r\n\tNULL as RatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tInsuranceSegmentId,\r\n\tPolicyOfferingId,\r\n\tNULL as ProductId,\r\n\tNULL as InsuranceReferenceLineOfBusinessId,\r\n\tNULL as RatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tInsuranceSegmentId,\r\n\t26 as PolicyOfferingId,\r\n\tNULL as ProductId,\r\n\tNULL as InsuranceReferenceLineOfBusinessId,\r\n\tNULL as RatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tInsuranceSegmentId,\r\n\tPolicyOfferingId,\r\n\tNULL as ProductId,\r\n\tNULL as InsuranceReferenceLineOfBusinessId,\r\n\tRatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tInsuranceSegmentId,\r\n\tPolicyOfferingId,\r\n\tProductId,\r\n\tNULL as InsuranceReferenceLineOfBusinessId,\r\n\tRatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tInsuranceSegmentId,\r\n\tPolicyOfferingId,\r\n\t34 as ProductId,\r\n\tNULL as InsuranceReferenceLineOfBusinessId,\r\n\tRatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tInsuranceSegmentId,\r\n\tPolicyOfferingId,\r\n\t34 as ProductId,\r\n\t33 as InsuranceReferenceLineOfBusinessId,\r\n\tRatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tInsuranceSegmentId,\r\n\tPolicyOfferingId,\r\n\tProductId,\r\n\tInsuranceReferenceLineOfBusinessId,\r\n\tRatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tInsuranceSegmentId,\r\n\tPolicyOfferingId,\r\n\tProductId,\r\n\t33 as InsuranceReferenceLineOfBusinessId,\r\n\tRatingPlanId\r\n\tFROM T\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tInsuranceSegmentId,\r\n\tPolicyOfferingId,\r\n\tProductId,\r\n\tInsuranceReferenceLineOfBusinessId,\r\n\t2 as RatingPlanId\r\n\tFROM T\r\n\twhere PolicyOfferingId=1 and ProductId=34\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tInsuranceSegmentId,\r\n\tPolicyOfferingId,\r\n\tProductId,\r\n\tInsuranceReferenceLineOfBusinessId,\r\n\t3 as RatingPlanId\r\n\tFROM T\r\n\twhere PolicyOfferingId=1 and ProductId=34\r\n\tUNION ALL\r\n\tSELECT DISTINCT EnterpriseGroupId,\r\n\tInsuranceReferenceLegalEntityId,\r\n\tStrategicProfitCenterId,\r\n\tInsuranceSegmentId,\r\n\tPolicyOfferingId,\r\n\tProductId,\r\n\tInsuranceReferenceLineOfBusinessId,\r\n\t5 as RatingPlanId\r\n\tFROM T\r\n\twhere PolicyOfferingId=1 and ProductId=34)\r\n\tselect distinct ISNULL(EnterpriseGroupCode,'N/A'),\r\n\tISNULL(EnterpriseGroupDescription,'N/A'),\r\n\tISNULL(EnterpriseGroupAbbreviation,'N/A'),\r\n\tISNULL(InsuranceReferenceLegalEntityCode,'N/A'),\r\n\tISNULL(InsuranceReferenceLegalEntityDescription,'N/A'),\r\n\tISNULL(InsuranceReferenceLegalEntityAbbreviation,'N/A'),\r\n\tISNULL(StrategicProfitCenterCode,'N/A'),\r\n\tISNULL(StrategicProfitCenterAbbreviation,'N/A'),\r\n\tISNULL(StrategicProfitCenterDescription,'N/A'),\r\n\tISNULL(InsuranceSegmentCode,'N/A'),\r\n\tISNULL(InsuranceSegmentAbbreviation,'N/A'),\r\n\tISNULL(InsuranceSegmentDescription,'N/A'),\r\n\tISNULL(PolicyOfferingCode,'N/A'),\r\n\tISNULL(PolicyOfferingAbbreviation,'N/A'),\r\n\tISNULL(PolicyOfferingDescription,'N/A'),\r\n\tISNULL(ProductCode,'N/A'),\r\n\tISNULL(ProductAbbreviation,'N/A'),\r\n\tISNULL(ProductDescription,'N/A'),\r\n\tISNULL(InsuranceReferenceLineOfBusinessCode,'N/A'),\r\n\tISNULL(InsuranceReferenceLineOfBusinessAbbreviation,'N/A'),\r\n\tISNULL(InsuranceReferenceLineOfBusinessDescription,'N/A'),\r\n\tISNULL(RP.RatingPlanCode, 'N/A'),\r\n\tISNULL(RP.RatingPlanAbbreviation, 'N/A'),\r\n\tISNULL(RP.RatingPlanDescription, 'N/A')\r\n\tfrom t_id \r\n\tLEFT JOIN DBO.EnterpriseGroup EG\r\n\tON t_id.EnterpriseGroupId=EG.EnterpriseGroupId\r\n\tLEFT JOIN DBO.InsuranceReferenceLegalEntity IRLE\r\n\tON t_id.InsuranceReferenceLegalEntityId=IRLE.InsuranceReferenceLegalEntityId\r\n\tLEFT JOIN DBO.StrategicProfitCenter SP\r\n\tON t_id.StrategicProfitCenterId=SP.StrategicProfitCenterId\r\n\tLEFT JOIN DBO.InsuranceSegment IST\r\n\tON t_id.InsuranceSegmentId=IST.InsuranceSegmentId\r\n\tLEFT JOIN DBO.PolicyOffering PO\r\n\tON t_id.PolicyOfferingId=PO.PolicyOfferingId\r\n\tLEFT JOIN DBO.Product P\r\n\tON t_id.ProductId=P.ProductId\r\n\tLEFT JOIN DBO.InsuranceReferenceLineOfBusiness IRLB\r\n\tON t_id.InsuranceReferenceLineOfBusinessId=IRLB.InsuranceReferenceLineOfBusinessId\r\n\tLEFT JOIN dbo.RatingPlan RP\r\n\ton t_id.RatingPlanId=RP.RatingPlanId\n),\nLKP_InsuranceReferenceDim AS (\n\tSELECT\n\tInsuranceReferenceDimID,\n\tEnterpriseGroupDescription,\n\tInsuranceReferenceLegalEntityDescription,\n\tStrategicProfitCenterAbbreviation,\n\tStrategicProfitCenterDescription,\n\tInsuranceSegmentDescription,\n\tPolicyOfferingAbbreviation,\n\tPolicyOfferingDescription,\n\tProductAbbreviation,\n\tProductDescription,\n\tInsuranceReferenceLineOfBusinessAbbreviation,\n\tInsuranceReferenceLineOfBusinessDescription,\n\tInsuranceReferenceCoverageTypeCode,\n\tInsuranceReferenceCoverageTypeDescription,\n\tEnterpriseGroupAbbreviation,\n\tInsuranceReferenceLegalEntityAbbreviation,\n\tInsuranceSegmentAbbreviation,\n\tRatingPlanAbbreviation,\n\tRatingPlanDescription,\n\tAccountingProductCode,\n\tAccountingProductAbbreviation,\n\tAccountingProductDescription,\n\tEnterpriseGroupCode,\n\tInsuranceReferenceLegalEntityCode,\n\tStrategicProfitCenterCode,\n\tInsuranceSegmentCode,\n\tPolicyOfferingCode,\n\tProductCode,\n\tInsuranceReferenceLineOfBusinessCode,\n\tRatingPlanCode\n\tFROM (\n\t\tSELECT \n\t\t\tInsuranceReferenceDimID,\n\t\t\tEnterpriseGroupDescription,\n\t\t\tInsuranceReferenceLegalEntityDescription,\n\t\t\tStrategicProfitCenterAbbreviation,\n\t\t\tStrategicProfitCenterDescription,\n\t\t\tInsuranceSegmentDescription,\n\t\t\tPolicyOfferingAbbreviation,\n\t\t\tPolicyOfferingDescription,\n\t\t\tProductAbbreviation,\n\t\t\tProductDescription,\n\t\t\tInsuranceReferenceLineOfBusinessAbbreviation,\n\t\t\tInsuranceReferenceLineOfBusinessDescription,\n\t\t\tInsuranceReferenceCoverageTypeCode,\n\t\t\tInsuranceReferenceCoverageTypeDescription,\n\t\t\tEnterpriseGroupAbbreviation,\n\t\t\tInsuranceReferenceLegalEntityAbbreviation,\n\t\t\tInsuranceSegmentAbbreviation,\n\t\t\tRatingPlanAbbreviation,\n\t\t\tRatingPlanDescription,\n\t\t\tAccountingProductCode,\n\t\t\tAccountingProductAbbreviation,\n\t\t\tAccountingProductDescription,\n\t\t\tEnterpriseGroupCode,\n\t\t\tInsuranceReferenceLegalEntityCode,\n\t\t\tStrategicProfitCenterCode,\n\t\t\tInsuranceSegmentCode,\n\t\t\tPolicyOfferingCode,\n\t\t\tProductCode,\n\t\t\tInsuranceReferenceLineOfBusinessCode,\n\t\t\tRatingPlanCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceDim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EnterpriseGroupCode,InsuranceReferenceLegalEntityCode,StrategicProfitCenterCode,InsuranceSegmentCode,PolicyOfferingCode,ProductCode,InsuranceReferenceLineOfBusinessCode,RatingPlanCode ORDER BY InsuranceReferenceDimID) = 1\n),\nEXP_inputToLookup AS (\n\tSELECT\n\tStrategicProfitCenterCode,\n\tInsuranceSegmentCode,\n\tPolicyOfferingCode,\n\tInsuranceReferenceLineOfBusinessCode,\n\tRatingPlanCode,\n\tProductCode\n\tFROM SQ_Association\n),\nLKP_SupAccountingProduct AS (\n\tSELECT\n\tAccountingProductCode,\n\tAccountingProductAbbreviation,\n\tAccountingProductDescription,\n\tStrategicProfitCenterCode,\n\tInsuranceSegmentCode,\n\tPolicyOfferingCode,\n\tLineOfBusinessCode,\n\tRatingPlanCode,\n\tProductCode\n\tFROM (\n\t\tSELECT distinct\r\n\t\tAP.AccountingProductCode as AccountingProductCode, \r\n\t\tAP.AccountingProductAbbreviation as AccountingProductAbbreviation, \r\n\t\tAP.AccountingProductDescription as AccountingProductDescription,\r\n\t\tSupAP.StrategicProfitCenterCode as StrategicProfitCenterCode,\r\n\t\tSupAP.InsuranceSegmentCode as InsuranceSegmentCode,\r\n\t\tSupAP.PolicyOfferingCode as PolicyOfferingCode,\r\n\t\tSupAP.LineOfBusinessCode as LineOfBusinessCode,\r\n\t\tSupAP.RatingPlanCode as RatingPlanCode,\r\n\t\tSupAP.ProductCode as ProductCode\r\n\t\tFROM\r\n\t\tAccountingProduct AP \r\n\t\tINNER JOIN SupAccountingProductRules SupAP ON \r\n\t\tAP.AccountingProductCode=SupAP.AccountingProductCode\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY StrategicProfitCenterCode,InsuranceSegmentCode,PolicyOfferingCode,LineOfBusinessCode,RatingPlanCode,ProductCode ORDER BY AccountingProductCode) = 1\n),\nEXP_Detect_Changes_Add_MetaData AS (\n\tSELECT\n\tLKP_InsuranceReferenceDim.InsuranceReferenceDimID AS lkp_InsuranceReferenceDimID,\n\tLKP_InsuranceReferenceDim.EnterpriseGroupDescription AS lkp_EnterpriseGroupDescription,\n\tLKP_InsuranceReferenceDim.InsuranceReferenceLegalEntityDescription AS lkp_InsuranceReferenceLegalEntityDescription,\n\tLKP_InsuranceReferenceDim.StrategicProfitCenterAbbreviation AS lkp_StrategicProfitCenterAbbreviation,\n\tLKP_InsuranceReferenceDim.StrategicProfitCenterDescription AS lkp_StrategicProfitCenterDescription,\n\tLKP_InsuranceReferenceDim.InsuranceSegmentDescription AS lkp_InsuranceSegmentDescription,\n\tLKP_InsuranceReferenceDim.PolicyOfferingAbbreviation AS lkp_PolicyOfferingAbbreviation,\n\tLKP_InsuranceReferenceDim.PolicyOfferingDescription AS lkp_PolicyOfferingDescription,\n\tLKP_InsuranceReferenceDim.ProductAbbreviation AS lkp_ProductAbbreviation,\n\tLKP_InsuranceReferenceDim.ProductDescription AS lkp_ProductDescription,\n\tLKP_InsuranceReferenceDim.InsuranceReferenceLineOfBusinessAbbreviation AS lkp_InsuranceReferenceLineOfBusinessAbbreviation,\n\tLKP_InsuranceReferenceDim.InsuranceReferenceLineOfBusinessDescription AS lkp_InsuranceReferenceLineOfBusinessDescription,\n\tLKP_InsuranceReferenceDim.InsuranceReferenceCoverageTypeCode AS lkp_InsuranceReferenceCoverageTypeCode,\n\tLKP_InsuranceReferenceDim.InsuranceReferenceCoverageTypeDescription AS lkp_InsuranceReferenceCoverageTypeDescription,\n\tLKP_InsuranceReferenceDim.EnterpriseGroupAbbreviation AS lkp_EnterpriseGroupAbbreviation,\n\tLKP_InsuranceReferenceDim.InsuranceReferenceLegalEntityAbbreviation AS lkp_InsuranceReferenceLegalEntityAbbreviation,\n\tLKP_InsuranceReferenceDim.InsuranceSegmentAbbreviation AS lkp_InsuranceSegmentAbbreviation,\n\tLKP_InsuranceReferenceDim.RatingPlanAbbreviation AS lkp_RatingPlanAbbreviation,\n\tLKP_InsuranceReferenceDim.RatingPlanDescription AS lkp_RatingPlanDescription,\n\tLKP_InsuranceReferenceDim.AccountingProductCode AS lkp_AccountingProductCode,\n\tLKP_InsuranceReferenceDim.AccountingProductAbbreviation AS lkp_AccountingProductAbbreviation,\n\tLKP_InsuranceReferenceDim.AccountingProductDescription AS lkp_AccountingProductDescription,\n\tLKP_SupAccountingProduct.AccountingProductCode AS lkp_SupAP_AccountingProductCode,\n\tLKP_SupAccountingProduct.AccountingProductAbbreviation AS lkp_SupAP_AccountingProductAbbreviation,\n\tLKP_SupAccountingProduct.AccountingProductDescription AS lkp_SupAP_AccountingProductDescription,\n\tSQ_Association.EnterpriseGroupCode AS i_EnterpriseGroupCode,\n\tSQ_Association.EnterpriseGroupDescription AS i_EnterpriseGroupDescription,\n\tSQ_Association.EnterpriseGroupAbbreviation AS i_EnterpriseGroupAbbreviation,\n\tSQ_Association.InsuranceReferenceLegalEntityCode AS i_InsuranceReferenceLegalEntityCode,\n\tSQ_Association.InsuranceReferenceLegalEntityDescription AS i_InsuranceReferenceLegalEntityDescription,\n\tSQ_Association.InsuranceReferenceLegalEntityAbbreviation AS i_InsuranceReferenceLegalEntityAbbreviation,\n\tSQ_Association.StrategicProfitCenterCode AS i_StrategicProfitCenterCode,\n\tSQ_Association.StrategicProfitCenterAbbreviation AS i_StrategicProfitCenterAbbreviation,\n\tSQ_Association.StrategicProfitCenterDescription AS i_StrategicProfitCenterDescription,\n\tSQ_Association.InsuranceSegmentCode AS i_InsuranceSegmentCode,\n\tSQ_Association.InsuranceSegmentAbbreviation AS i_InsuranceSegmentAbbreviation,\n\tSQ_Association.InsuranceSegmentDescription AS i_InsuranceSegmentDescription,\n\tSQ_Association.PolicyOfferingCode AS i_PolicyOfferingCode,\n\tSQ_Association.PolicyOfferingAbbreviation AS i_PolicyOfferingAbbreviation,\n\tSQ_Association.PolicyOfferingDescription AS i_PolicyOfferingDescription,\n\tSQ_Association.ProductCode AS i_ProductCode,\n\tSQ_Association.ProductAbbreviation AS i_ProductAbbreviation,\n\tSQ_Association.ProductDescription AS i_ProductDescription,\n\tSQ_Association.InsuranceReferenceLineOfBusinessCode AS i_InsuranceReferenceLineOfBusinessCode,\n\tSQ_Association.InsuranceReferenceLineOfBusinessAbbreviation AS i_InsuranceReferenceLineOfBusinessAbbreviation,\n\tSQ_Association.InsuranceReferenceLineOfBusinessDescription AS i_InsuranceReferenceLineOfBusinessDescription,\n\tSQ_Association.RatingPlanCode AS i_RatingPlanCode,\n\tSQ_Association.RatingPlanAbbreviation AS i_RatingPlanAbbreviation,\n\tSQ_Association.RatingPlanDescription AS i_RatingPlanDescription,\n\t-- *INF*: IIF(ISNULL(lkp_SupAP_AccountingProductCode),'N/A',lkp_SupAP_AccountingProductCode)\r\n\t-- --Decode(TRUE, \r\n\t-- --IN(i_ProductCode,'200','340','341') AND i_InsuranceSegmentCode='3','700',\r\n\t-- --i_ProductCode='200','200',\r\n\t-- --IN(i_ProductCode,'300','310','320','321','360','365','370','380','381'),'300',\r\n\t--  --IN(i_ProductCode,'311','400','420','440') AND NOT IN(i_InsuranceReferenceLineOfBusinessCode,'530','590'),'320',\r\n\t-- --i_ProductCode='330','330',\r\n\t-- --(IN(i_ProductCode,'500','520') AND NOT IN(i_InsuranceReferenceLineOfBusinessCode,'530','590','505','506','507')) OR i_ProductCode  ='510' and IN( i_PolicyOfferingCode,'500','600') AND IN(i_StrategicProfitCenterCode,'2','3'),'500',\r\n\t-- --IN(i_ProductCode,'510','620','630','640','650','660') AND i_StrategicProfitCenterCode='3','620',\r\n\t-- --i_ProductCode='100' AND  i_InsuranceSegmentAbbreviation='Pool','130',\r\n\t-- --i_ProductCode='100' AND i_InsuranceSegmentAbbreviation <>'Pool' AND IN(i_RatingPlanCode, '2', '5'),\r\n\t-- --'120',\r\n\t-- --i_ProductCode='100' AND i_InsuranceSegmentAbbreviation <>'Pool','100',\r\n\t-- --i_PolicyOfferingCode='800' AND i_InsuranceReferenceLineOfBusinessCode <>'812','800',\r\n\t-- --i_PolicyOfferingCode='801' AND i_InsuranceReferenceLineOfBusinessCode <>'812','801',\r\n\t-- --i_PolicyOfferingCode='810' AND i_InsuranceReferenceLineOfBusinessCode<>'812','810',\r\n\t-- --IN(i_InsuranceReferenceLineOfBusinessCode,'506','505','507','530','590','812'),'700',\r\n\t-- --i_ProductCode='312' AND i_StrategicProfitCenterAbbreviation <>'NSI' ,'320',\r\n\t-- --i_ProductCode='312' AND i_StrategicProfitCenterAbbreviation='NSI','310',\r\n\t-- --i_ProductCode='340','340',\r\n\t-- --i_ProductCode='341','341',\r\n\t-- --i_ProductCode='410','410',\r\n\t-- --i_ProductCode='430','430',\r\n\t-- --i_ProductCode='450','450',\r\n\t-- --i_ProductCode='550','550',\r\n\t-- --i_ProductCode='553','550',\r\n\t-- --i_ProductCode='610','610',\r\n\t-- --IN(i_ProductCode,'390','900'),'900','N/A')\n\tIFF(lkp_SupAP_AccountingProductCode IS NULL, 'N/A', lkp_SupAP_AccountingProductCode) AS v_AccountingProductCode,\n\t-- *INF*: IIF(ISNULL(lkp_SupAP_AccountingProductAbbreviation),'N/A',lkp_SupAP_AccountingProductAbbreviation)\r\n\t-- \r\n\t-- --Decode(TRUE, \r\n\t-- --IN(i_ProductCode,'200','340','341') AND i_InsuranceSegmentCode='3','Fully Ceded',\r\n\t-- --i_ProductCode='200','CL Auto',\r\n\t-- --IN(i_ProductCode,'300','310','320','321','360','365','370','380','381'),'GL',\r\n\t--  --IN(i_ProductCode,'311','400','420','440') AND NOT IN(i_InsuranceReferenceLineOfBusinessCode,'530','590'),'Disc',\r\n\t-- --i_ProductCode='330','EPLI Monoline',\r\n\t-- --(IN(i_ProductCode,'500','520') AND NOT IN(i_InsuranceReferenceLineOfBusinessCode,'530','590','505','506','507')) OR i_ProductCode  ='510' and IN( i_PolicyOfferingCode,'500','600') AND IN(i_StrategicProfitCenterCode,'2','3'),'CL Prop',\r\n\t-- --IN(i_ProductCode,'510','620','630','640','650','660') AND i_StrategicProfitCenterCode='3','Bonds-Non Contract',\r\n\t-- --i_ProductCode='100' AND  i_InsuranceSegmentAbbreviation='Pool','Pool',\r\n\t-- --i_ProductCode='100' AND i_InsuranceSegmentAbbreviation <>'Pool' AND IN(i_RatingPlanCode, '2', '5'),\r\n\t-- --'Work Comp - Retro',\r\n\t-- --i_ProductCode='100' AND i_InsuranceSegmentAbbreviation <>'Pool','Work Comp - Guaranteed Cost',\r\n\t-- --i_PolicyOfferingCode='800' AND i_InsuranceReferenceLineOfBusinessCode <>'812','H&H',\r\n\t-- --i_PolicyOfferingCode='801' AND i_InsuranceReferenceLineOfBusinessCode <>'812','Choice',\r\n\t-- --i_PolicyOfferingCode='810' AND i_InsuranceReferenceLineOfBusinessCode<>'812','Mono PL Prod',\r\n\t-- --IN(i_InsuranceReferenceLineOfBusinessCode,'506','505','507','530','590','812'),'Fully Ceded',\r\n\t-- --i_ProductCode='312' AND i_StrategicProfitCenterAbbreviation <>'NSI' ,'Disc',\r\n\t-- --i_ProductCode='312' AND i_StrategicProfitCenterAbbreviation='NSI','NFP D&O',\r\n\t-- --i_ProductCode='340','Garage Liab',\r\n\t-- --i_ProductCode='341','Auto Dlrs',\r\n\t-- --i_ProductCode='410','CBOP',\r\n\t-- --i_ProductCode='430','SBOP',\r\n\t-- --i_ProductCode='450','SMART',\r\n\t-- --i_ProductCode='550','CL IM',\r\n\t-- --i_ProductCode='553','CL IM',\r\n\t-- --i_ProductCode='610','Bonds-Contract',\r\n\t-- --IN(i_ProductCode,'390','900'),'CL Umb','N/A')\n\tIFF(lkp_SupAP_AccountingProductAbbreviation IS NULL, 'N/A', lkp_SupAP_AccountingProductAbbreviation) AS v_AccountingProductAbbreviation,\n\t-- *INF*: IIF(ISNULL(lkp_SupAP_AccountingProductDescription),'N/A',lkp_SupAP_AccountingProductDescription)\r\n\t-- \r\n\t-- --Decode(TRUE, \r\n\t-- --IN(i_ProductCode,'200','340','341') AND i_InsuranceSegmentCode='3','Fully Ceded',\r\n\t-- --i_ProductCode='200','Commercial Auto',\r\n\t-- --IN(i_ProductCode,'300','310','320','321','360','365','370','380','381'),'General Liability',\r\n\t-- -- IN(i_ProductCode,'311','400','420','440') AND NOT IN(i_InsuranceReferenceLineOfBusinessCode,'530','590'),'Discontinued Products',\r\n\t-- --i_ProductCode='330','Employment Practices Liability Insurance',\r\n\t-- --(IN(i_ProductCode,'500','520') AND NOT IN(i_InsuranceReferenceLineOfBusinessCode,'530','590','505','506','507')) OR i_ProductCode  ='510' and IN( -i_PolicyOfferingCode,'500','600') AND IN(i_StrategicProfitCenterCode,'2','3'),'Commercial Property',\r\n\t-- --IN(i_ProductCode,'510','620','630','640','650','660') AND i_StrategicProfitCenterCode='3','Bonds-Non Contract',\r\n\t-- --i_ProductCode='100' AND  i_InsuranceSegmentAbbreviation='Pool','Pool',\r\n\t-- --i_ProductCode='100' AND i_InsuranceSegmentAbbreviation <>'Pool' AND IN(i_RatingPlanCode, '2', '5'),\r\n\t-- --'Work Comp - Retro',\r\n\t-- --i_ProductCode='100' AND i_InsuranceSegmentAbbreviation <>'Pool','Work Comp - Guaranteed Cost',\r\n\t-- --i_PolicyOfferingCode='800' AND i_InsuranceReferenceLineOfBusinessCode <>'812','Home & Highway',\r\n\t-- --i_PolicyOfferingCode='801' AND i_InsuranceReferenceLineOfBusinessCode <>'812','West Bend Choice',\r\n\t-- --i_PolicyOfferingCode='810' AND i_InsuranceReferenceLineOfBusinessCode<>'812','Mono PL Products',\r\n\t-- --IN(i_InsuranceReferenceLineOfBusinessCode,'506','505','507','530','590','812'),'Fully Ceded',\r\n\t-- --i_ProductCode='312' AND i_StrategicProfitCenterAbbreviation <>'NSI' ,'Discontinued Products',\r\n\t-- --i_ProductCode='312' AND i_StrategicProfitCenterAbbreviation='NSI','Not-for-Profit D&O',\r\n\t-- --i_ProductCode='340','Garage Liability',\r\n\t-- --i_ProductCode='341','Auto Dealers',\r\n\t-- --i_ProductCode='410','CBOP',\r\n\t-- --i_ProductCode='430','SBOP',\r\n\t-- --i_ProductCode='450','SMARTbusiness',\r\n\t-- --i_ProductCode='550','Commercial Inland Marine',\r\n\t-- --i_ProductCode='553','Commercial Inland Marine',\r\n\t-- --i_ProductCode='610','Bonds-Contract',\r\n\t-- --IN(i_ProductCode,'390','900'),'Commercial Umbrella','N/A')\n\tIFF(lkp_SupAP_AccountingProductDescription IS NULL, 'N/A', lkp_SupAP_AccountingProductDescription) AS v_AccountingProductDescription,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- ISNULL(lkp_InsuranceReferenceDimID), 'Insert',\r\n\t-- lkp_EnterpriseGroupDescription<>i_EnterpriseGroupDescription\r\n\t-- OR lkp_InsuranceReferenceLegalEntityDescription<>i_InsuranceReferenceLegalEntityDescription\r\n\t-- OR lkp_StrategicProfitCenterAbbreviation<>i_StrategicProfitCenterAbbreviation\r\n\t-- OR lkp_StrategicProfitCenterDescription<>i_StrategicProfitCenterDescription\r\n\t-- OR lkp_InsuranceSegmentDescription<>i_InsuranceSegmentDescription\r\n\t-- OR lkp_PolicyOfferingAbbreviation<>i_PolicyOfferingAbbreviation\r\n\t-- OR lkp_PolicyOfferingDescription<>i_PolicyOfferingDescription\r\n\t-- OR lkp_ProductAbbreviation<>i_ProductAbbreviation\r\n\t-- OR lkp_ProductDescription<>i_ProductDescription\r\n\t-- OR lkp_InsuranceReferenceLineOfBusinessAbbreviation<>i_InsuranceReferenceLineOfBusinessAbbreviation\r\n\t-- OR lkp_InsuranceReferenceLineOfBusinessDescription<>i_InsuranceReferenceLineOfBusinessDescription\r\n\t-- OR lkp_EnterpriseGroupAbbreviation<>i_EnterpriseGroupAbbreviation\r\n\t-- OR lkp_InsuranceReferenceLegalEntityAbbreviation<>i_InsuranceReferenceLegalEntityAbbreviation\r\n\t-- OR lkp_InsuranceSegmentAbbreviation<>i_InsuranceSegmentAbbreviation OR lkp_RatingPlanAbbreviation<>i_RatingPlanAbbreviation OR lkp_RatingPlanDescription<>i_RatingPlanDescription OR lkp_AccountingProductCode<>v_AccountingProductCode OR lkp_AccountingProductAbbreviation<>v_AccountingProductAbbreviation OR lkp_AccountingProductDescription<>v_AccountingProductDescription, 'Update',\r\n\t--  'NoChange')\n\tDECODE(TRUE,\n\tlkp_InsuranceReferenceDimID IS NULL, 'Insert',\n\tlkp_EnterpriseGroupDescription <> i_EnterpriseGroupDescription OR lkp_InsuranceReferenceLegalEntityDescription <> i_InsuranceReferenceLegalEntityDescription OR lkp_StrategicProfitCenterAbbreviation <> i_StrategicProfitCenterAbbreviation OR lkp_StrategicProfitCenterDescription <> i_StrategicProfitCenterDescription OR lkp_InsuranceSegmentDescription <> i_InsuranceSegmentDescription OR lkp_PolicyOfferingAbbreviation <> i_PolicyOfferingAbbreviation OR lkp_PolicyOfferingDescription <> i_PolicyOfferingDescription OR lkp_ProductAbbreviation <> i_ProductAbbreviation OR lkp_ProductDescription <> i_ProductDescription OR lkp_InsuranceReferenceLineOfBusinessAbbreviation <> i_InsuranceReferenceLineOfBusinessAbbreviation OR lkp_InsuranceReferenceLineOfBusinessDescription <> i_InsuranceReferenceLineOfBusinessDescription OR lkp_EnterpriseGroupAbbreviation <> i_EnterpriseGroupAbbreviation OR lkp_InsuranceReferenceLegalEntityAbbreviation <> i_InsuranceReferenceLegalEntityAbbreviation OR lkp_InsuranceSegmentAbbreviation <> i_InsuranceSegmentAbbreviation OR lkp_RatingPlanAbbreviation <> i_RatingPlanAbbreviation OR lkp_RatingPlanDescription <> i_RatingPlanDescription OR lkp_AccountingProductCode <> v_AccountingProductCode OR lkp_AccountingProductAbbreviation <> v_AccountingProductAbbreviation OR lkp_AccountingProductDescription <> v_AccountingProductDescription, 'Update',\n\t'NoChange') AS v_ChangeFlag,\n\tv_ChangeFlag AS o_ChangeFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AudutId,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\t-- *INF*: IIF(ISNULL(i_EnterpriseGroupCode),'N/A',i_EnterpriseGroupCode)\n\tIFF(i_EnterpriseGroupCode IS NULL, 'N/A', i_EnterpriseGroupCode) AS o_EnterpriseGroupCode,\n\t-- *INF*: IIF(ISNULL(i_EnterpriseGroupDescription),'N/A',i_EnterpriseGroupDescription)\r\n\t-- \n\tIFF(i_EnterpriseGroupDescription IS NULL, 'N/A', i_EnterpriseGroupDescription) AS o_EnterpriseGroupDescription,\n\t-- *INF*: IIF(ISNULL(i_InsuranceReferenceLegalEntityCode),'N/A',i_InsuranceReferenceLegalEntityCode)\n\tIFF(i_InsuranceReferenceLegalEntityCode IS NULL, 'N/A', i_InsuranceReferenceLegalEntityCode) AS o_InsuranceReferenceLegalEntityCode,\n\t-- *INF*: IIF(ISNULL(i_InsuranceReferenceLegalEntityDescription),'N/A',i_InsuranceReferenceLegalEntityDescription)\n\tIFF(i_InsuranceReferenceLegalEntityDescription IS NULL, 'N/A', i_InsuranceReferenceLegalEntityDescription) AS o_InsuranceReferenceLegalEntityDescription,\n\t-- *INF*: IIF(ISNULL(i_StrategicProfitCenterCode),'N/A',i_StrategicProfitCenterCode)\n\tIFF(i_StrategicProfitCenterCode IS NULL, 'N/A', i_StrategicProfitCenterCode) AS o_StrategicProfitCenterCode,\n\t-- *INF*: IIF(ISNULL(i_StrategicProfitCenterAbbreviation),'N/A',i_StrategicProfitCenterAbbreviation)\n\tIFF(i_StrategicProfitCenterAbbreviation IS NULL, 'N/A', i_StrategicProfitCenterAbbreviation) AS o_StrategicProfitCenterAbbreviation,\n\t-- *INF*: IIF(ISNULL(i_StrategicProfitCenterDescription),'N/A',i_StrategicProfitCenterDescription)\n\tIFF(i_StrategicProfitCenterDescription IS NULL, 'N/A', i_StrategicProfitCenterDescription) AS o_StrategicProfitCenterDescription,\n\t-- *INF*: IIF(ISNULL(i_InsuranceSegmentCode),'N/A',i_InsuranceSegmentCode)\n\tIFF(i_InsuranceSegmentCode IS NULL, 'N/A', i_InsuranceSegmentCode) AS o_InsuranceSegmentCode,\n\t-- *INF*: IIF(ISNULL(i_InsuranceSegmentDescription),'N/A',i_InsuranceSegmentDescription)\n\tIFF(i_InsuranceSegmentDescription IS NULL, 'N/A', i_InsuranceSegmentDescription) AS o_InsuranceSegmentDescription,\n\t-- *INF*: IIF(ISNULL(i_PolicyOfferingCode),'N/A',i_PolicyOfferingCode)\n\tIFF(i_PolicyOfferingCode IS NULL, 'N/A', i_PolicyOfferingCode) AS o_PolicyOfferingCode,\n\t-- *INF*: IIF(ISNULL(i_PolicyOfferingAbbreviation),'N/A',i_PolicyOfferingAbbreviation)\n\tIFF(i_PolicyOfferingAbbreviation IS NULL, 'N/A', i_PolicyOfferingAbbreviation) AS o_PolicyOfferingAbbreviation,\n\t-- *INF*: IIF(ISNULL(i_PolicyOfferingDescription),'N/A',i_PolicyOfferingDescription)\n\tIFF(i_PolicyOfferingDescription IS NULL, 'N/A', i_PolicyOfferingDescription) AS o_PolicyOfferingDescription,\n\t-- *INF*: IIF(ISNULL(i_ProductCode),'N/A',i_ProductCode)\n\tIFF(i_ProductCode IS NULL, 'N/A', i_ProductCode) AS o_ProductCode,\n\t-- *INF*: IIF(ISNULL(i_ProductAbbreviation),'N/A',i_ProductAbbreviation)\n\tIFF(i_ProductAbbreviation IS NULL, 'N/A', i_ProductAbbreviation) AS o_ProductAbbreviation,\n\t-- *INF*: IIF(ISNULL(i_ProductDescription),'N/A',i_ProductDescription)\n\tIFF(i_ProductDescription IS NULL, 'N/A', i_ProductDescription) AS o_ProductDescription,\n\t-- *INF*: IIF(ISNULL(i_InsuranceReferenceLineOfBusinessCode),'N/A',i_InsuranceReferenceLineOfBusinessCode)\n\tIFF(i_InsuranceReferenceLineOfBusinessCode IS NULL, 'N/A', i_InsuranceReferenceLineOfBusinessCode) AS o_InsuranceReferenceLineOfBusinessCode,\n\t-- *INF*: IIF(ISNULL(i_InsuranceReferenceLineOfBusinessAbbreviation),'N/A',i_InsuranceReferenceLineOfBusinessAbbreviation)\n\tIFF(i_InsuranceReferenceLineOfBusinessAbbreviation IS NULL, 'N/A', i_InsuranceReferenceLineOfBusinessAbbreviation) AS o_InsuranceReferenceLineOfBusinessAbbreviation,\n\t-- *INF*: IIF(ISNULL(i_InsuranceReferenceLineOfBusinessDescription),'N/A',i_InsuranceReferenceLineOfBusinessDescription)\n\tIFF(i_InsuranceReferenceLineOfBusinessDescription IS NULL, 'N/A', i_InsuranceReferenceLineOfBusinessDescription) AS o_InsuranceReferenceLineOfBusinessDescription,\n\t'N/A' AS o_InsuranceReferenceCoverageTypeCode,\n\t'N/A' AS o_InsuranceReferenceCoverageTypeDescription,\n\t-- *INF*: IIF(ISNULL(i_EnterpriseGroupAbbreviation),'N/A',i_EnterpriseGroupAbbreviation)\n\tIFF(i_EnterpriseGroupAbbreviation IS NULL, 'N/A', i_EnterpriseGroupAbbreviation) AS o_EnterpriseGroupAbbreviation,\n\t-- *INF*: IIF(ISNULL(i_InsuranceReferenceLegalEntityAbbreviation),'N/A',i_InsuranceReferenceLegalEntityAbbreviation)\n\tIFF(i_InsuranceReferenceLegalEntityAbbreviation IS NULL, 'N/A', i_InsuranceReferenceLegalEntityAbbreviation) AS o_InsuranceReferenceLegalEntityAbbreviation,\n\t-- *INF*: IIF(ISNULL(i_InsuranceSegmentAbbreviation),'N/A',i_InsuranceSegmentAbbreviation)\n\tIFF(i_InsuranceSegmentAbbreviation IS NULL, 'N/A', i_InsuranceSegmentAbbreviation) AS o_InsuranceSegmentAbbreviation,\n\tv_AccountingProductCode AS o_AccountingProductCode,\n\tv_AccountingProductAbbreviation AS o_AccountingProductAbbreviation,\n\tv_AccountingProductDescription AS o_AccountingProductDescription,\n\ti_RatingPlanCode AS o_RatingPlanCode,\n\ti_RatingPlanAbbreviation AS o_RatingPlanAbbreviation,\n\ti_RatingPlanDescription AS o_RatingPlanDescription\n\tFROM SQ_Association\n\tLEFT JOIN LKP_InsuranceReferenceDim\n\tON LKP_InsuranceReferenceDim.EnterpriseGroupCode = SQ_Association.EnterpriseGroupCode AND LKP_InsuranceReferenceDim.InsuranceReferenceLegalEntityCode = SQ_Association.InsuranceReferenceLegalEntityCode AND LKP_InsuranceReferenceDim.StrategicProfitCenterCode = SQ_Association.StrategicProfitCenterCode AND LKP_InsuranceReferenceDim.InsuranceSegmentCode = SQ_Association.InsuranceSegmentCode AND LKP_InsuranceReferenceDim.PolicyOfferingCode = SQ_Association.PolicyOfferingCode AND LKP_InsuranceReferenceDim.ProductCode = SQ_Association.ProductCode AND LKP_InsuranceReferenceDim.InsuranceReferenceLineOfBusinessCode = SQ_Association.InsuranceReferenceLineOfBusinessCode AND LKP_InsuranceReferenceDim.RatingPlanCode = SQ_Association.RatingPlanCode\n\tLEFT JOIN LKP_SupAccountingProduct\n\tON LKP_SupAccountingProduct.StrategicProfitCenterCode = EXP_inputToLookup.StrategicProfitCenterCode AND LKP_SupAccountingProduct.InsuranceSegmentCode = EXP_inputToLookup.InsuranceSegmentCode AND LKP_SupAccountingProduct.PolicyOfferingCode = EXP_inputToLookup.PolicyOfferingCode AND LKP_SupAccountingProduct.LineOfBusinessCode = EXP_inputToLookup.InsuranceReferenceLineOfBusinessCode AND LKP_SupAccountingProduct.RatingPlanCode = EXP_inputToLookup.RatingPlanCode AND LKP_SupAccountingProduct.ProductCode = EXP_inputToLookup.ProductCode\n),\nRTR_InsertAndUpdate AS (\n\tSELECT\n\tlkp_InsuranceReferenceDimID,\n\to_ChangeFlag AS ChangeFlag,\n\to_AudutId AS AudutId,\n\to_CreatedDate AS CreatedDate,\n\to_ModifiedDate AS ModifiedDate,\n\to_EnterpriseGroupCode AS EnterpriseGroupCode,\n\to_EnterpriseGroupDescription AS EnterpriseGroupDescription,\n\to_InsuranceReferenceLegalEntityCode AS InsuranceReferenceLegalEntityCode,\n\to_InsuranceReferenceLegalEntityDescription AS InsuranceReferenceLegalEntityDescription,\n\to_StrategicProfitCenterCode AS StrategicProfitCenterCode,\n\to_StrategicProfitCenterAbbreviation AS StrategicProfitCenterAbbreviation,\n\to_StrategicProfitCenterDescription AS StrategicProfitCenterDescription,\n\to_InsuranceSegmentCode AS InsuranceSegmentCode,\n\to_InsuranceSegmentDescription AS InsuranceSegmentDescription,\n\to_PolicyOfferingCode AS PolicyOfferingCode,\n\to_PolicyOfferingAbbreviation AS PolicyOfferingAbbreviation,\n\to_PolicyOfferingDescription AS PolicyOfferingDescription,\n\to_ProductCode AS ProductCode,\n\to_ProductAbbreviation AS ProductAbbreviation,\n\to_ProductDescription AS ProductDescription,\n\to_InsuranceReferenceLineOfBusinessCode AS InsuranceReferenceLineOfBusinessCode,\n\to_InsuranceReferenceLineOfBusinessAbbreviation AS InsuranceReferenceLineOfBusinessAbbreviation,\n\to_InsuranceReferenceLineOfBusinessDescription AS InsuranceReferenceLineOfBusinessDescription,\n\to_InsuranceReferenceCoverageTypeCode AS InsuranceReferenceCoverageTypeCode,\n\to_InsuranceReferenceCoverageTypeDescription AS InsuranceReferenceCoverageTypeDescription,\n\to_EnterpriseGroupAbbreviation AS EnterpriseGroupAbbreviation,\n\to_InsuranceReferenceLegalEntityAbbreviation AS InsuranceReferenceLegalEntityAbbreviation,\n\to_InsuranceSegmentAbbreviation AS InsuranceSegmentAbbreviation,\n\to_AccountingProductCode AS AccountingProductCode,\n\to_AccountingProductAbbreviation AS AccountingProductAbbreviation,\n\to_AccountingProductDescription AS AccountingProductDescription,\n\to_RatingPlanCode AS RatingPlanCode,\n\to_RatingPlanAbbreviation AS RatingPlanAbbreviation,\n\to_RatingPlanDescription AS RatingPlanDescription\n\tFROM EXP_Detect_Changes_Add_MetaData\n),\nRTR_InsertAndUpdate_Insert AS (SELECT * FROM RTR_InsertAndUpdate WHERE ChangeFlag='Insert' AND IIF(InsuranceSegmentAbbreviation='Pool' AND ProductAbbreviation='WC' AND RatingPlanAbbreviation<>'Guar Cost', FALSE, TRUE)),\nRTR_InsertAndUpdate_Update AS (SELECT * FROM RTR_InsertAndUpdate WHERE ChangeFlag='Update'),\nUPD_Insert AS (\n\tSELECT\n\tAudutId, \n\tCreatedDate, \n\tModifiedDate, \n\tEnterpriseGroupCode, \n\tEnterpriseGroupDescription, \n\tInsuranceReferenceLegalEntityCode, \n\tInsuranceReferenceLegalEntityDescription, \n\tStrategicProfitCenterCode, \n\tStrategicProfitCenterAbbreviation, \n\tStrategicProfitCenterDescription, \n\tInsuranceSegmentCode, \n\tInsuranceSegmentDescription, \n\tPolicyOfferingCode, \n\tPolicyOfferingAbbreviation, \n\tPolicyOfferingDescription, \n\tProductCode, \n\tProductAbbreviation, \n\tProductDescription, \n\tInsuranceReferenceLineOfBusinessCode, \n\tInsuranceReferenceLineOfBusinessAbbreviation, \n\tInsuranceReferenceLineOfBusinessDescription, \n\tInsuranceReferenceCoverageTypeCode, \n\tInsuranceReferenceCoverageTypeDescription, \n\tEnterpriseGroupAbbreviation, \n\tInsuranceReferenceLegalEntityAbbreviation, \n\tInsuranceSegmentAbbreviation, \n\tAccountingProductCode AS AccountingProductCode1, \n\tAccountingProductAbbreviation AS AccountingProductAbbreviation1, \n\tAccountingProductDescription AS AccountingProductDescription1, \n\tRatingPlanCode AS RatingPlanCode1, \n\tRatingPlanAbbreviation AS RatingPlanAbbreviation1, \n\tRatingPlanDescription AS RatingPlanDescription1\n\tFROM RTR_InsertAndUpdate_Insert\n),\nTGT_InsuranceReferenceDim_Insert AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceDim\n\t(AuditId, CreatedDate, ModifiedDate, EnterpriseGroupCode, EnterpriseGroupDescription, InsuranceReferenceLegalEntityCode, InsuranceReferenceLegalEntityDescription, StrategicProfitCenterCode, StrategicProfitCenterAbbreviation, StrategicProfitCenterDescription, InsuranceSegmentCode, InsuranceSegmentDescription, PolicyOfferingCode, PolicyOfferingAbbreviation, PolicyOfferingDescription, ProductCode, ProductAbbreviation, ProductDescription, InsuranceReferenceLineOfBusinessCode, InsuranceReferenceLineOfBusinessAbbreviation, InsuranceReferenceLineOfBusinessDescription, InsuranceReferenceCoverageTypeCode, InsuranceReferenceCoverageTypeDescription, EnterpriseGroupAbbreviation, InsuranceReferenceLegalEntityAbbreviation, InsuranceSegmentAbbreviation, AccountingProductCode, AccountingProductAbbreviation, AccountingProductDescription, RatingPlanCode, RatingPlanAbbreviation, RatingPlanDescription)\n\tSELECT \n\tAudutId AS AUDITID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tENTERPRISEGROUPCODE, \n\tENTERPRISEGROUPDESCRIPTION, \n\tINSURANCEREFERENCELEGALENTITYCODE, \n\tINSURANCEREFERENCELEGALENTITYDESCRIPTION, \n\tSTRATEGICPROFITCENTERCODE, \n\tSTRATEGICPROFITCENTERABBREVIATION, \n\tSTRATEGICPROFITCENTERDESCRIPTION, \n\tINSURANCESEGMENTCODE, \n\tINSURANCESEGMENTDESCRIPTION, \n\tPOLICYOFFERINGCODE, \n\tPOLICYOFFERINGABBREVIATION, \n\tPOLICYOFFERINGDESCRIPTION, \n\tPRODUCTCODE, \n\tPRODUCTABBREVIATION, \n\tPRODUCTDESCRIPTION, \n\tINSURANCEREFERENCELINEOFBUSINESSCODE, \n\tINSURANCEREFERENCELINEOFBUSINESSABBREVIATION, \n\tINSURANCEREFERENCELINEOFBUSINESSDESCRIPTION, \n\tINSURANCEREFERENCECOVERAGETYPECODE, \n\tINSURANCEREFERENCECOVERAGETYPEDESCRIPTION, \n\tENTERPRISEGROUPABBREVIATION, \n\tINSURANCEREFERENCELEGALENTITYABBREVIATION, \n\tINSURANCESEGMENTABBREVIATION, \n\tAccountingProductCode1 AS ACCOUNTINGPRODUCTCODE, \n\tAccountingProductAbbreviation1 AS ACCOUNTINGPRODUCTABBREVIATION, \n\tAccountingProductDescription1 AS ACCOUNTINGPRODUCTDESCRIPTION, \n\tRatingPlanCode1 AS RATINGPLANCODE, \n\tRatingPlanAbbreviation1 AS RATINGPLANABBREVIATION, \n\tRatingPlanDescription1 AS RATINGPLANDESCRIPTION\n\tFROM UPD_Insert\n),\nUPD_Update AS (\n\tSELECT\n\tlkp_InsuranceReferenceDimID, \n\tAudutId, \n\tModifiedDate, \n\tEnterpriseGroupDescription, \n\tInsuranceReferenceLegalEntityDescription, \n\tStrategicProfitCenterAbbreviation, \n\tStrategicProfitCenterDescription, \n\tInsuranceSegmentDescription, \n\tPolicyOfferingAbbreviation, \n\tPolicyOfferingDescription, \n\tProductAbbreviation, \n\tProductDescription, \n\tInsuranceReferenceLineOfBusinessAbbreviation, \n\tInsuranceReferenceLineOfBusinessDescription, \n\tInsuranceReferenceCoverageTypeCode, \n\tInsuranceReferenceCoverageTypeDescription, \n\tEnterpriseGroupAbbreviation, \n\tInsuranceReferenceLegalEntityAbbreviation, \n\tInsuranceSegmentAbbreviation, \n\tAccountingProductCode AS AccountingProductCode3, \n\tAccountingProductAbbreviation AS AccountingProductAbbreviation3, \n\tAccountingProductDescription AS AccountingProductDescription3, \n\tRatingPlanAbbreviation AS RatingPlanAbbreviation3, \n\tRatingPlanDescription AS RatingPlanDescription3\n\tFROM RTR_InsertAndUpdate_Update\n),\nTGT_InsuranceReferenceDim_Update AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceDim AS T\n\tUSING UPD_Update AS S\n\tON T.InsuranceReferenceDimId = S.lkp_InsuranceReferenceDimID\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.AuditId = S.AudutId, T.ModifiedDate = S.ModifiedDate, T.EnterpriseGroupDescription = S.EnterpriseGroupDescription, T.InsuranceReferenceLegalEntityDescription = S.InsuranceReferenceLegalEntityDescription, T.StrategicProfitCenterAbbreviation = S.StrategicProfitCenterAbbreviation, T.StrategicProfitCenterDescription = S.StrategicProfitCenterDescription, T.InsuranceSegmentDescription = S.InsuranceSegmentDescription, T.PolicyOfferingAbbreviation = S.PolicyOfferingAbbreviation, T.PolicyOfferingDescription = S.PolicyOfferingDescription, T.ProductAbbreviation = S.ProductAbbreviation, T.ProductDescription = S.ProductDescription, T.InsuranceReferenceLineOfBusinessAbbreviation = S.InsuranceReferenceLineOfBusinessAbbreviation, T.InsuranceReferenceLineOfBusinessDescription = S.InsuranceReferenceLineOfBusinessDescription, T.InsuranceReferenceCoverageTypeCode = S.InsuranceReferenceCoverageTypeCode, T.InsuranceReferenceCoverageTypeDescription = S.InsuranceReferenceCoverageTypeDescription, T.EnterpriseGroupAbbreviation = S.EnterpriseGroupAbbreviation, T.InsuranceReferenceLegalEntityAbbreviation = S.InsuranceReferenceLegalEntityAbbreviation, T.InsuranceSegmentAbbreviation = S.InsuranceSegmentAbbreviation, T.AccountingProductCode = S.AccountingProductCode3, T.AccountingProductAbbreviation = S.AccountingProductAbbreviation3, T.AccountingProductDescription = S.AccountingProductDescription3, T.RatingPlanAbbreviation = S.RatingPlanAbbreviation3, T.RatingPlanDescription = S.RatingPlanDescription3\n),"
                        }
                    ]
                }
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246483"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905453"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7603028"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/29/2023 22:01:56"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 22:01:50"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Data_Mart_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "InsRef"
            }
        },
        "folder": {
            "name": "Policy DataMart/"
        },
        "annotations": []
    }
}