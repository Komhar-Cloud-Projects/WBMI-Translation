{
    "name": "s_m_CLM_DW_LOAD_Claim_Medical_EXD_PMS",
    "properties": {
        "activities": [
            {
                "name": "m_CLM_DW_LOAD_Claim_Medical_EXD_PMS",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_claim_medical_stage AS (\n\tSELECT\n\t\tclaim_medical_stage_id,\n\t\tinjured_party_id,\n\t\tmedicare_hicn,\n\t\tmedicare_elig,\n\t\tcms_date_of_incid,\n\t\tcause_code,\n\t\tdiag_code1,\n\t\tdiag_code2,\n\t\tdiag_code3,\n\t\tdiag_code4,\n\t\tdiag_code5,\n\t\tdiag_code6,\n\t\tdiag_code7,\n\t\tdiag_code8,\n\t\tdiag_code9,\n\t\tdiag_code10,\n\t\tdiag_code11,\n\t\tdiag_code12,\n\t\tdiag_code13,\n\t\tdiag_code14,\n\t\tdiag_code15,\n\t\tdiag_code16,\n\t\tdiag_code17,\n\t\tdiag_code18,\n\t\tdiag_code19,\n\t\tself_insd_ind,\n\t\tself_insd_type,\n\t\tself_insd_fst_nm,\n\t\tself_insd_last_nm,\n\t\tself_insd_dba_nm,\n\t\tself_insd_lgl_nm,\n\t\tproduct_liab_ind,\n\t\tprod_generic_nm,\n\t\tprod_brand_nm,\n\t\tprod_manufacturer,\n\t\tprod_allege_harm,\n\t\tinj_par_rep_firm,\n\t\texceed_claim_key,\n\t\texceed_claimnt_key,\n\t\tpms_policy_sym,\n\t\tpms_policy_num,\n\t\tpms_policy_mod,\n\t\tpms_date_of_loss,\n\t\tpms_loss_occurence,\n\t\tpms_loss_claimant,\n\t\tcms_source_system_id,\n\t\tclmt1_rep_firm,\n\t\tclmt2_rep_firm,\n\t\tclmt3_rep_firm,\n\t\tclmt4_rep_firm,\n\t\tcreated_ts,\n\t\tcreated_user_id,\n\t\tmodified_ts,\n\t\tmodified_user_id,\n\t\textract_date,\n\t\tas_of_date,\n\t\trecord_count,\n\t\tsource_system_id,\n\t\tquery_requested,\n\t\tquery_request_date,\n\t\tlast_cms_hicn,\n\t\ticd_code_version\n\tFROM claim_medical_stage\n),\nEXP_Values AS (\n\tSELECT\n\tclaim_medical_stage_id,\n\tinjured_party_id,\n\tmedicare_hicn,\n\tmedicare_elig,\n\tcms_date_of_incid,\n\tcause_code,\n\tdiag_code1 AS diag_code,\n\tself_insd_ind,\n\tself_insd_type,\n\tself_insd_fst_nm,\n\tself_insd_last_nm,\n\tself_insd_dba_nm,\n\tself_insd_lgl_nm,\n\tproduct_liab_ind,\n\tprod_generic_nm,\n\tprod_brand_nm,\n\tprod_manufacturer,\n\tprod_allege_harm,\n\tinj_par_rep_firm,\n\texceed_claim_key,\n\texceed_claimnt_key,\n\tpms_policy_sym,\n\tpms_policy_num,\n\tpms_policy_mod,\n\tpms_date_of_loss,\n\tpms_loss_occurence,\n\tpms_loss_claimant,\n\tcms_source_system_id,\n\tclmt1_rep_firm,\n\tclmt2_rep_firm,\n\tclmt3_rep_firm,\n\tclmt4_rep_firm,\n\tcreated_ts,\n\tcreated_user_id,\n\tmodified_ts,\n\tmodified_user_id,\n\textract_date,\n\tas_of_date,\n\trecord_count,\n\tsource_system_id,\n\tquery_requested,\n\tquery_request_date,\n\tlast_cms_hicn,\n\ticd_code_version,\n\tclaim_medical_stage_id AS claim_medical_stage_id1,\n\tinjured_party_id AS injured_party_id1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(medicare_hicn)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(medicare_hicn) AS medicare_hicn1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(medicare_elig)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(medicare_elig) AS medicare_elig1,\n\t-- *INF*: IIF(ISNULL(cms_date_of_incid), TO_DATE('1/1/1800','MM/DD/YYYY'), cms_date_of_incid)\n\tIFF(cms_date_of_incid IS NULL, TO_DATE('1/1/1800', 'MM/DD/YYYY'), cms_date_of_incid) AS cms_date_of_incid1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(cause_code)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(cause_code) AS cause_code1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(diag_code)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(diag_code) AS diag_code1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(self_insd_ind)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(self_insd_ind) AS self_insd_ind1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(self_insd_type)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(self_insd_type) AS self_insd_type1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(self_insd_fst_nm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(self_insd_fst_nm) AS self_insd_fst_nm1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(self_insd_last_nm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(self_insd_last_nm) AS self_insd_last_nm1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(self_insd_dba_nm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(self_insd_dba_nm) AS self_insd_dba_nm1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(self_insd_lgl_nm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(self_insd_lgl_nm) AS self_insd_lgl_nm1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(product_liab_ind)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(product_liab_ind) AS product_liab_ind1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(prod_generic_nm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(prod_generic_nm) AS prod_generic_nm1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(prod_brand_nm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(prod_brand_nm) AS prod_brand_nm1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(prod_manufacturer)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(prod_manufacturer) AS prod_manufacturer1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(prod_allege_harm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(prod_allege_harm) AS prod_allege_harm1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(inj_par_rep_firm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(inj_par_rep_firm) AS inj_par_rep_firm1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(cms_source_system_id)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(cms_source_system_id) AS cms_source_system_id1,\n\t-- *INF*: replaceChr(0,to_char(pms_date_of_loss),'/','')\n\treplaceChr(0, to_char(pms_date_of_loss), '/', '') AS v_pms_date_of_loss,\n\t-- *INF*: IIF(length(exceed_claim_key)>0 ,ltrim(rtrim(exceed_claim_key)),\r\n\t-- IIF(length(pms_policy_sym)>0,ltrim(rtrim(pms_policy_sym || pms_policy_num || pms_policy_mod || v_pms_date_of_loss || pms_loss_occurence)),\r\n\t-- 'N/A'))\n\tIFF(length(exceed_claim_key) > 0, ltrim(rtrim(exceed_claim_key)), IFF(length(pms_policy_sym) > 0, ltrim(rtrim(pms_policy_sym || pms_policy_num || pms_policy_mod || v_pms_date_of_loss || pms_loss_occurence)), 'N/A')) AS claim_key1,\n\t-- *INF*: IIF(length(exceed_claim_key)>0,ltrim(rtrim(exceed_claimnt_key)),\r\n\t-- IIF(length(pms_policy_sym)>0,ltrim(rtrim(pms_policy_sym || pms_policy_num || pms_policy_mod || v_pms_date_of_loss || pms_loss_occurence || pms_loss_claimant || 'CMT')),\r\n\t-- 'N/A'))\n\tIFF(length(exceed_claim_key) > 0, ltrim(rtrim(exceed_claimnt_key)), IFF(length(pms_policy_sym) > 0, ltrim(rtrim(pms_policy_sym || pms_policy_num || pms_policy_mod || v_pms_date_of_loss || pms_loss_occurence || pms_loss_claimant || 'CMT')), 'N/A')) AS claimnt_key1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(clmt1_rep_firm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(clmt1_rep_firm) AS clmt1_rep_firm1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(clmt2_rep_firm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(clmt2_rep_firm) AS clmt2_rep_firm1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(clmt3_rep_firm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(clmt3_rep_firm) AS clmt3_rep_firm1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(clmt4_rep_firm)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(clmt4_rep_firm) AS clmt4_rep_firm1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(query_requested)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(query_requested) AS query_requested1,\n\t-- *INF*: IIF(ISNULL(query_request_date), TO_DATE('1/1/1800','MM/DD/YYYY'), query_request_date)\n\tIFF(query_request_date IS NULL, TO_DATE('1/1/1800', 'MM/DD/YYYY'), query_request_date) AS query_request_date1,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(last_cms_hicn)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(last_cms_hicn) AS last_cms_hicn1,\n\t-- *INF*: iif(icd_code_version = '0','10',icd_code_version)\n\tIFF(icd_code_version = '0', '10', icd_code_version) AS v_icd_code_version,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(v_icd_code_version)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(v_icd_code_version) AS icd_code_version1\n\tFROM SQ_claim_medical_stage\n),\nLKP_Claim_Party_Occurrence_AK_ID AS (\n\tSELECT\n\tclaim_party_occurrence_ak_id,\n\tclaimant_num,\n\tclaim_party_role_code\n\tFROM (\n\t\tSELECT \r\n\t\tCPO.claim_party_occurrence_ak_id as claim_party_occurrence_ak_id, \r\n\t\tLTRIM(RTRIM(CO.claim_occurrence_key)) as claimant_num, \r\n\t\tLTRIM(RTRIM(CP.claim_party_key)) as claim_party_role_code\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_party_occurrence CPO,\r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_party CP, \r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_occurrence CO \r\n\t\tWHERE \r\n\t\tCO.claim_occurrence_ak_id = CPO.claim_occurrence_ak_id  \r\n\t\tAND CP.claim_party_ak_id = CPO.claim_party_ak_id \r\n\t\tAND CPO.claim_party_role_code IN ('CMT' , 'CLMT')\r\n\t\tAND CO.crrnt_snpsht_flag = 1\r\n\t\tAND CP.crrnt_snpsht_flag = 1\r\n\t\tAND CPO.crrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claimant_num,claim_party_role_code ORDER BY claim_party_occurrence_ak_id) = 1\n),\nLKP_Target AS (\n\tSELECT\n\tclaim_med_id,\n\tclaim_med_ak_id,\n\tclaim_party_occurrence_ak_id,\n\tinjured_party_id,\n\tmedicare_hicn,\n\tmedicare_eligibility,\n\tcms_incdnt_date,\n\tpatient_cause_code,\n\tpatient_diag_code,\n\tself_insd_ind,\n\tself_insd_type,\n\tself_insd_first_name,\n\tself_insd_last_name,\n\tself_insd_dba_name,\n\tself_insd_lgl_name,\n\tprdct_liab_ind,\n\tprdct_generic_name,\n\tprdct_brand_name,\n\tprdct_mfr,\n\tprdct_alleged_harm,\n\tinjured_party_rep_firm,\n\tclaimant1_rep_firm,\n\tclaimant2_rep_firm,\n\tclaimant3_rep_firm,\n\tclaimant4_rep_firm,\n\tquery_requested_date,\n\tquery_requested_ind,\n\tlast_cms_hicn,\n\tICDCodeVersion\n\tFROM (\n\t\tSELECT CM.claim_med_id as claim_med_id, \r\n\t\tCM.claim_med_ak_id as claim_med_ak_id, \r\n\t\tCM.injured_party_id as injured_party_id, \r\n\t\tCM.medicare_hicn as medicare_hicn, \r\n\t\tCM.medicare_eligibility as medicare_eligibility, \r\n\t\tCM.cms_incdnt_date as cms_incdnt_date, \r\n\t\tCM.patient_cause_code as patient_cause_code, \r\n\t\tpatient_diag_code as patient_diag_code,\r\n\t\tCM.self_insd_ind as self_insd_ind, \r\n\t\tCM.self_insd_type as self_insd_type, \r\n\t\tCM.self_insd_first_name as self_insd_first_name, \r\n\t\tCM.self_insd_last_name as self_insd_last_name, \r\n\t\tCM.self_insd_dba_name as self_insd_dba_name, \r\n\t\tCM.self_insd_lgl_name as self_insd_lgl_name, \r\n\t\tCM.prdct_liab_ind as prdct_liab_ind, \r\n\t\tCM.prdct_generic_name as prdct_generic_name, \r\n\t\tCM.prdct_brand_name as prdct_brand_name, \r\n\t\tCM.prdct_mfr as prdct_mfr, \r\n\t\tCM.prdct_alleged_harm as prdct_alleged_harm, \r\n\t\tCM.injured_party_rep_firm as injured_party_rep_firm, \r\n\t\tCM.claimant1_rep_firm as claimant1_rep_firm, \r\n\t\tCM.claimant2_rep_firm as claimant2_rep_firm, \r\n\t\tCM.claimant3_rep_firm as claimant3_rep_firm, \r\n\t\tCM.claimant4_rep_firm as claimant4_rep_firm, \r\n\t\tCM.query_requested_date as query_requested_date, \r\n\t\tCM.query_requested_ind as query_requested_ind, \r\n\t\tCM.last_cms_hicn as last_cms_hicn,\r\n\t\tCM.ICDCodeVersion as ICDCodeVersion ,\r\n\t\tCM.claim_party_occurrence_ak_id as claim_party_occurrence_ak_id\r\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_medical CM\r\n\t\tWHERE CM.crrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_party_occurrence_ak_id ORDER BY claim_med_id) = 1\n),\nEXP_Detect_Changes AS (\n\tSELECT\n\tEXP_Values.claim_medical_stage_id1,\n\tLKP_Claim_Party_Occurrence_AK_ID.claim_party_occurrence_ak_id AS claim_party_occurrence_ak_id1,\n\tEXP_Values.injured_party_id1,\n\tEXP_Values.medicare_hicn1,\n\tEXP_Values.medicare_elig1,\n\tEXP_Values.cms_date_of_incid1,\n\tEXP_Values.cause_code1,\n\tEXP_Values.diag_code1,\n\tEXP_Values.self_insd_ind1,\n\tEXP_Values.self_insd_type1,\n\tEXP_Values.self_insd_fst_nm1,\n\tEXP_Values.self_insd_last_nm1,\n\tEXP_Values.self_insd_dba_nm1,\n\tEXP_Values.self_insd_lgl_nm1,\n\tEXP_Values.product_liab_ind1,\n\tEXP_Values.prod_generic_nm1,\n\tEXP_Values.prod_brand_nm1,\n\tEXP_Values.prod_manufacturer1,\n\tEXP_Values.prod_allege_harm1,\n\tEXP_Values.inj_par_rep_firm1,\n\tEXP_Values.clmt1_rep_firm1,\n\tEXP_Values.clmt2_rep_firm1,\n\tEXP_Values.clmt3_rep_firm1,\n\tEXP_Values.clmt4_rep_firm1,\n\tEXP_Values.query_requested1,\n\tEXP_Values.query_request_date1,\n\tEXP_Values.last_cms_hicn1,\n\tEXP_Values.icd_code_version1,\n\tLKP_Target.claim_med_id,\n\tLKP_Target.claim_med_ak_id,\n\tLKP_Target.claim_party_occurrence_ak_id,\n\tLKP_Target.injured_party_id AS cms_document_cntl_num,\n\tLKP_Target.medicare_hicn,\n\tLKP_Target.medicare_eligibility,\n\tLKP_Target.cms_incdnt_date,\n\tLKP_Target.patient_cause_code,\n\tLKP_Target.patient_diag_code,\n\tLKP_Target.self_insd_ind,\n\tLKP_Target.self_insd_type,\n\tLKP_Target.self_insd_first_name,\n\tLKP_Target.self_insd_last_name,\n\tLKP_Target.self_insd_dba_name,\n\tLKP_Target.self_insd_lgl_name,\n\tLKP_Target.prdct_liab_ind,\n\tLKP_Target.prdct_generic_name,\n\tLKP_Target.prdct_brand_name,\n\tLKP_Target.prdct_mfr,\n\tLKP_Target.prdct_alleged_harm,\n\tLKP_Target.injured_party_rep_firm,\n\tLKP_Target.claimant1_rep_firm,\n\tLKP_Target.claimant2_rep_firm,\n\tLKP_Target.claimant3_rep_firm,\n\tLKP_Target.claimant4_rep_firm,\n\tLKP_Target.query_requested_date AS query_request_date,\n\tLKP_Target.query_requested_ind,\n\tLKP_Target.last_cms_hicn,\n\tLKP_Target.ICDCodeVersion,\n\t-- *INF*: iif(isnull(claim_med_id),'NEW',\t\r\n\t-- \tiif (\r\n\t-- injured_party_id1 <> cms_document_cntl_num OR\r\n\t-- medicare_hicn1 <> medicare_hicn OR\r\n\t-- medicare_elig1 <> medicare_eligibility OR\r\n\t-- cms_date_of_incid1 <> cms_incdnt_date OR\r\n\t-- cause_code1 <> patient_cause_code OR\r\n\t-- diag_code1 <> patient_diag_code OR\r\n\t-- self_insd_ind1 <> self_insd_ind OR\r\n\t-- self_insd_type1 <> self_insd_type OR\r\n\t-- self_insd_fst_nm1 <> self_insd_first_name OR\r\n\t-- self_insd_last_nm1 <> self_insd_last_name OR\r\n\t-- self_insd_dba_nm1 <> self_insd_dba_name OR\r\n\t-- self_insd_lgl_nm1 <> self_insd_lgl_name OR\r\n\t-- product_liab_ind1 <> prdct_liab_ind OR\r\n\t-- prod_generic_nm1 <> prdct_generic_name OR\r\n\t-- prod_brand_nm1 <> prdct_brand_name OR\r\n\t-- prod_manufacturer1 <> prdct_mfr OR\r\n\t-- prod_allege_harm1 <> prdct_alleged_harm OR\r\n\t-- inj_par_rep_firm1 <> injured_party_rep_firm OR\r\n\t-- clmt1_rep_firm1 <> claimant1_rep_firm OR\r\n\t-- clmt2_rep_firm1 <> claimant2_rep_firm OR\r\n\t-- clmt3_rep_firm1 <> claimant3_rep_firm OR\r\n\t-- clmt4_rep_firm1 <> claimant4_rep_firm OR\r\n\t-- query_requested1 <> query_requested_ind OR\r\n\t-- query_request_date1 <> query_request_date OR\r\n\t-- last_cms_hicn1 <> last_cms_hicn  OR \r\n\t-- icd_code_version1 <> ICDCodeVersion\r\n\t-- , 'UPDATE','NOCHANGE'))\n\tIFF(claim_med_id IS NULL, 'NEW', IFF(injured_party_id1 <> cms_document_cntl_num OR medicare_hicn1 <> medicare_hicn OR medicare_elig1 <> medicare_eligibility OR cms_date_of_incid1 <> cms_incdnt_date OR cause_code1 <> patient_cause_code OR diag_code1 <> patient_diag_code OR self_insd_ind1 <> self_insd_ind OR self_insd_type1 <> self_insd_type OR self_insd_fst_nm1 <> self_insd_first_name OR self_insd_last_nm1 <> self_insd_last_name OR self_insd_dba_nm1 <> self_insd_dba_name OR self_insd_lgl_nm1 <> self_insd_lgl_name OR product_liab_ind1 <> prdct_liab_ind OR prod_generic_nm1 <> prdct_generic_name OR prod_brand_nm1 <> prdct_brand_name OR prod_manufacturer1 <> prdct_mfr OR prod_allege_harm1 <> prdct_alleged_harm OR inj_par_rep_firm1 <> injured_party_rep_firm OR clmt1_rep_firm1 <> claimant1_rep_firm OR clmt2_rep_firm1 <> claimant2_rep_firm OR clmt3_rep_firm1 <> claimant3_rep_firm OR clmt4_rep_firm1 <> claimant4_rep_firm OR query_requested1 <> query_requested_ind OR query_request_date1 <> query_request_date OR last_cms_hicn1 <> last_cms_hicn OR icd_code_version1 <> ICDCodeVersion, 'UPDATE', 'NOCHANGE')) AS v_Changed_Flag,\n\t1 AS Crrnt_Snpsht_Flag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS Audit_Id,\n\t-- *INF*: IIF(v_Changed_Flag='NEW',\r\n\t-- \tTO_DATE('01/01/1800 01:00:00','MM/DD/YYYY HH24:MI:SS'),\r\n\t-- \tSYSDATE)\n\tIFF(v_Changed_Flag = 'NEW', TO_DATE('01/01/1800 01:00:00', 'MM/DD/YYYY HH24:MI:SS'), SYSDATE) AS Eff_From_Date,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS Eff_To_Date,\n\tv_Changed_Flag AS Changed_Flag,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS SOURCE_SYSTEM_ID,\n\tSYSDATE AS Created_Date,\n\tSYSDATE AS Modified_Date\n\tFROM EXP_Values\n\tLEFT JOIN LKP_Claim_Party_Occurrence_AK_ID\n\tON LKP_Claim_Party_Occurrence_AK_ID.claimant_num = EXP_Values.claim_key1 AND LKP_Claim_Party_Occurrence_AK_ID.claim_party_role_code = EXP_Values.claimnt_key1\n\tLEFT JOIN LKP_Target\n\tON LKP_Target.claim_party_occurrence_ak_id = LKP_Claim_Party_Occurrence_AK_ID.claim_party_occurrence_ak_id\n),\nFIL_Insert AS (\n\tSELECT\n\tclaim_party_occurrence_ak_id1, \n\tinjured_party_id1, \n\tmedicare_hicn1, \n\tmedicare_elig1, \n\tcms_date_of_incid1, \n\tcause_code1, \n\tdiag_code1, \n\tself_insd_ind1, \n\tself_insd_type1, \n\tself_insd_fst_nm1, \n\tself_insd_last_nm1, \n\tself_insd_dba_nm1, \n\tself_insd_lgl_nm1, \n\tproduct_liab_ind1, \n\tprod_generic_nm1, \n\tprod_brand_nm1, \n\tprod_manufacturer1, \n\tprod_allege_harm1, \n\tinj_par_rep_firm1, \n\tclmt1_rep_firm1, \n\tclmt2_rep_firm1, \n\tclmt3_rep_firm1, \n\tclmt4_rep_firm1, \n\tquery_requested1 AS query_requested_ind1, \n\tquery_request_date1, \n\tclaim_med_ak_id, \n\tCrrnt_Snpsht_Flag, \n\tAudit_Id, \n\tEff_From_Date, \n\tEff_To_Date, \n\tChanged_Flag, \n\tSOURCE_SYSTEM_ID, \n\tCreated_Date, \n\tModified_Date, \n\tlast_cms_hicn1, \n\ticd_code_version1\n\tFROM EXP_Detect_Changes\n\tWHERE Changed_Flag='NEW'  OR Changed_Flag='UPDATE'\n),\nSEQ_claim_medical AS (\n\tCREATE SEQUENCE SEQ_claim_medical\n\tSTART = 0\n\tINCREMENT = 1;\n),\nEXP_Insert AS (\n\tSELECT\n\tclaim_party_occurrence_ak_id1,\n\tinjured_party_id1,\n\tmedicare_hicn1,\n\tmedicare_elig1,\n\tcms_date_of_incid1,\n\tcause_code1,\n\tdiag_code1,\n\tself_insd_ind1,\n\tself_insd_type1,\n\tself_insd_fst_nm1,\n\tself_insd_last_nm1,\n\tself_insd_dba_nm1,\n\tself_insd_lgl_nm1,\n\tproduct_liab_ind1,\n\tprod_generic_nm1,\n\tprod_brand_nm1,\n\tprod_manufacturer1,\n\tprod_allege_harm1,\n\tinj_par_rep_firm1,\n\tclmt1_rep_firm1,\n\tclmt2_rep_firm1,\n\tclmt3_rep_firm1,\n\tclmt4_rep_firm1,\n\tquery_requested_ind1,\n\tquery_request_date1,\n\tclaim_med_ak_id,\n\tCrrnt_Snpsht_Flag,\n\tAudit_Id,\n\tEff_From_Date,\n\tEff_To_Date,\n\tChanged_Flag,\n\tSOURCE_SYSTEM_ID,\n\tCreated_Date,\n\tModified_Date,\n\tSEQ_claim_medical.NEXTVAL,\n\t-- *INF*: IIF(Changed_Flag='NEW', NEXTVAL, claim_med_ak_id)\n\tIFF(Changed_Flag = 'NEW', NEXTVAL, claim_med_ak_id) AS claim_med_ak_id_out,\n\tlast_cms_hicn1,\n\ticd_code_version1\n\tFROM FIL_Insert\n),\nclaim_medical_INSERT AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_medical\n\t(crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date, claim_med_ak_id, claim_party_occurrence_ak_id, injured_party_id, medicare_hicn, medicare_eligibility, cms_incdnt_date, patient_cause_code, patient_diag_code, self_insd_ind, self_insd_type, self_insd_first_name, self_insd_last_name, self_insd_dba_name, self_insd_lgl_name, prdct_liab_ind, prdct_generic_name, prdct_brand_name, prdct_mfr, prdct_alleged_harm, injured_party_rep_firm, claimant1_rep_firm, claimant2_rep_firm, claimant3_rep_firm, claimant4_rep_firm, query_requested_date, query_requested_ind, last_cms_hicn, ICDCodeVersion)\n\tSELECT \n\tCrrnt_Snpsht_Flag AS CRRNT_SNPSHT_FLAG, \n\tAudit_Id AS AUDIT_ID, \n\tEff_From_Date AS EFF_FROM_DATE, \n\tEff_To_Date AS EFF_TO_DATE, \n\tSOURCE_SYSTEM_ID AS SOURCE_SYS_ID, \n\tCreated_Date AS CREATED_DATE, \n\tModified_Date AS MODIFIED_DATE, \n\tclaim_med_ak_id_out AS CLAIM_MED_AK_ID, \n\tclaim_party_occurrence_ak_id1 AS CLAIM_PARTY_OCCURRENCE_AK_ID, \n\tinjured_party_id1 AS INJURED_PARTY_ID, \n\tmedicare_hicn1 AS MEDICARE_HICN, \n\tmedicare_elig1 AS MEDICARE_ELIGIBILITY, \n\tcms_date_of_incid1 AS CMS_INCDNT_DATE, \n\tcause_code1 AS PATIENT_CAUSE_CODE, \n\tdiag_code1 AS PATIENT_DIAG_CODE, \n\tself_insd_ind1 AS SELF_INSD_IND, \n\tself_insd_type1 AS SELF_INSD_TYPE, \n\tself_insd_fst_nm1 AS SELF_INSD_FIRST_NAME, \n\tself_insd_last_nm1 AS SELF_INSD_LAST_NAME, \n\tself_insd_dba_nm1 AS SELF_INSD_DBA_NAME, \n\tself_insd_lgl_nm1 AS SELF_INSD_LGL_NAME, \n\tproduct_liab_ind1 AS PRDCT_LIAB_IND, \n\tprod_generic_nm1 AS PRDCT_GENERIC_NAME, \n\tprod_brand_nm1 AS PRDCT_BRAND_NAME, \n\tprod_manufacturer1 AS PRDCT_MFR, \n\tprod_allege_harm1 AS PRDCT_ALLEGED_HARM, \n\tinj_par_rep_firm1 AS INJURED_PARTY_REP_FIRM, \n\tclmt1_rep_firm1 AS CLAIMANT1_REP_FIRM, \n\tclmt2_rep_firm1 AS CLAIMANT2_REP_FIRM, \n\tclmt3_rep_firm1 AS CLAIMANT3_REP_FIRM, \n\tclmt4_rep_firm1 AS CLAIMANT4_REP_FIRM, \n\tquery_request_date1 AS QUERY_REQUESTED_DATE, \n\tquery_requested_ind1 AS QUERY_REQUESTED_IND, \n\tlast_cms_hicn1 AS LAST_CMS_HICN, \n\ticd_code_version1 AS ICDCODEVERSION\n\tFROM EXP_Insert\n),\nSQ_claim_medical AS (\n\tSELECT \r\n\ta.claim_med_id, \r\n\ta.eff_from_date, \r\n\ta.eff_to_date, \r\n\ta.claim_med_ak_id \r\n\tFROM\r\n\t \t@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_medical a\r\n\tWHERE \r\n\t a.source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}' AND  \r\n\t EXISTS (SELECT 1\t\t\t\r\n\t\t\tFROM  @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_medical b\r\n\t\t\tWHERE source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'  AND crrnt_snpsht_flag = 1\r\n\t\t\tAND a.claim_med_ak_id  = b.claim_med_ak_id \r\n\t\t\tGROUP BY claim_med_ak_id\r\n\t\t\tHAVING COUNT(*) > 1)\r\n\tORDER BY claim_med_ak_id, eff_from_date  DESC\n),\nEXP_Lag_eff_from_date AS (\n\tSELECT\n\tclaim_med_id,\n\tclaim_med_ak_id,\n\teff_from_date,\n\teff_to_date AS orig_eff_to_date,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- \tclaim_med_ak_id = v_PREV_ROW_claim_med_ak_id, ADD_TO_DATE(v_PREV_ROW_eff_from_date,'SS',-1),\r\n\t-- \torig_eff_to_date)\n\tDECODE(TRUE,\n\tclaim_med_ak_id = v_PREV_ROW_claim_med_ak_id, ADD_TO_DATE(v_PREV_ROW_eff_from_date, 'SS', - 1),\n\torig_eff_to_date) AS v_eff_to_date,\n\tv_eff_to_date AS eff_to_date,\n\teff_from_date AS v_PREV_ROW_eff_from_date,\n\tclaim_med_ak_id AS v_PREV_ROW_claim_med_ak_id,\n\tSYSDATE AS modified_date,\n\t0 AS crrnt_snpsht_flag\n\tFROM SQ_claim_medical\n),\nFIL_FirstRowInAKGroup AS (\n\tSELECT\n\tclaim_med_id, \n\torig_eff_to_date, \n\teff_to_date, \n\tmodified_date, \n\tcrrnt_snpsht_flag\n\tFROM EXP_Lag_eff_from_date\n\tWHERE orig_eff_to_date <> eff_to_date\r\n\r\n--If these two dates equal each other we are dealing with the first row in an AK group.  This row\r\n--does not need to be expired or updated for any reason thus it can be filtered out\r\n-- but we must source it to capture the eff_from_date of this row \r\n--so that we can properly expire the subsequent row\n),\nUPD_Claim_Occurrence AS (\n\tSELECT\n\tclaim_med_id, \n\teff_to_date, \n\tmodified_date, \n\tcrrnt_snpsht_flag\n\tFROM FIL_FirstRowInAKGroup\n),\nclaim_medical_UPDATE AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_medical AS T\n\tUSING UPD_Claim_Occurrence AS S\n\tON T.claim_med_id = S.claim_med_id\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.crrnt_snpsht_flag = S.crrnt_snpsht_flag, T.eff_to_date = S.eff_to_date, T.modified_date = S.modified_date\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246504"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905521"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604335"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 02:13:41"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 02:19:56"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Stage_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "EXCEED"
            }
        },
        "folder": {
            "name": "Claims DataWarehouse/"
        },
        "annotations": []
    }
}