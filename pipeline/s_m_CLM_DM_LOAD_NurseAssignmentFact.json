{
    "name": "s_m_CLM_DM_LOAD_NurseAssignmentFact",
    "properties": {
        "activities": [
            {
                "name": "m_CLM_DM_LOAD_NurseAssignmentFact",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_NurseAssignment AS (\n\tSELECT \r\n\tN.NurseAssignmentId, \r\n\tN.NurseAssignmentAkId, \r\n\tN.NurseCaseAkId, \r\n\tN.claim_party_ak_id, \r\n\tN.TimeSavedWeeks, \r\n\tN.TimeSavedDays \r\n\t\r\n\tFROM\r\n\t @{pipeline().parameters.SOURCE_TABLE_OWNER}.NurseAssignment N\r\n\t\r\n\twhere\r\n\tN.CurrentSnapshotFlag = 1\n),\nEXP_Scr_Values AS (\n\tSELECT\n\tNurseAssignmentId,\n\tNurseAssignmentAkId,\n\tNurseCaseAkId,\n\tclaim_party_ak_id,\n\tTimeSavedWeeks,\n\tTimeSavedDays\n\tFROM SQ_NurseAssignment\n),\nLKP_NurseAssignmentDim AS (\n\tSELECT\n\tNurseAssignmentDimId,\n\tEdwNurseAssignmentAkId\n\tFROM (\n\t\tSELECT \r\n\t\tN.NurseAssignmentDimId as NurseAssignmentDimId, N.EdwNurseAssignmentAkId as EdwNurseAssignmentAkId \r\n\t\t\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.NurseAssignmentDim N\r\n\t\t\r\n\t\twhere\r\n\t\tN.CurrentSnapshotFlag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EdwNurseAssignmentAkId ORDER BY NurseAssignmentDimId) = 1\n),\nLKP_NurseAssignmentImpact AS (\n\tSELECT\n\tTimeSavedWeeks,\n\tTimeSavedDays,\n\tNurseAssignmentAkId\n\tFROM (\n\t\tSELECT \r\n\t\tdistinct\r\n\t\tNAI.NurseAssignmentAkID as NurseAssignmentAkID,\r\n\t\tNA.TimeSavedWeeks as TimeSavedWeeks,\r\n\t\tNA.TimeSavedDays as TimeSavedDays\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.SupNurseImpact SI,\r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.NurseAssignmentImpact NAI,\r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.NurseAssignment NA\r\n\t\t\r\n\t\twhere\r\n\t\tSI.NurseImpactId = NAI.NurseImpactId\r\n\t\tAND\r\n\t\tNAI.NurseAssignmentAkId = NA.NurseAssignmentAkID\r\n\t\tAND\r\n\t\tSI.ImpactType = 'I'\r\n\t\tAND\r\n\t\tSI.CurrentSnapshotFlag = 1\r\n\t\tAND\r\n\t\tNAI.CurrentSnapshotFlag = 1\r\n\t\tAND\r\n\t\tNA.CurrentSnapshotFlag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY NurseAssignmentAkId ORDER BY TimeSavedWeeks) = 1\n),\nLKP_NurseAssignmentImpact_Indemnity AS (\n\tSELECT\n\tTotalIndemnityVocationalCategorySavings,\n\tNurseAssignmentAkId\n\tFROM (\n\t\tSELECT\r\n\t\tCOUNT(*) as Total_Count,\r\n\t\tNA.NurseAssignmentAkId as NurseAssignmentAkId,\r\n\t\tSUM(NI.SavingsAmount) as TotalIndemnityVocationalCategorySavings\r\n\t\t\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.SupNurseImpact SI,\r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.NurseAssignmentImpact NI,\r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.NurseAssignment NA\r\n\t\t\r\n\t\twhere\r\n\t\tSI.NurseImpactId = NI.NurseImpactId\r\n\t\tAND\r\n\t\tNI.NurseAssignmentAkId = NA.NurseAssignmentAkId\r\n\t\tAND\r\n\t\tSI.ImpactType = 'I'\r\n\t\tAND\r\n\t\tSI.CurrentSnapshotFlag = 1\r\n\t\tAND\r\n\t\tNI.CurrentSnapshotFlag = 1\r\n\t\tAND\r\n\t\tNA.CurrentSnapshotFlag = 1\r\n\t\t\r\n\t\tGroup by\r\n\t\tNA.NurseAssignmentAkId\r\n\t\t\r\n\t\thaving\r\n\t\tCOUNT(*) >= 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY NurseAssignmentAkId ORDER BY TotalIndemnityVocationalCategorySavings) = 1\n),\nLKP_NurseAssignmentImpact_Medical AS (\n\tSELECT\n\tTotalMedicalCostSavings,\n\tNurseAssignmentAkId\n\tFROM (\n\t\tSELECT\r\n\t\tCOUNT(*) as Total_Count,\r\n\t\tNA.NurseAssignmentAkId as NurseAssignmentAkId,\r\n\t\tSUM(NI.SavingsAmount) as TotalMedicalCostSavings\r\n\t\t\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.SupNurseImpact SI,\r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.NurseAssignmentImpact NI,\r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.NurseAssignment NA\r\n\t\t\r\n\t\twhere\r\n\t\tSI.NurseImpactId = NI.NurseImpactId\r\n\t\tAND\r\n\t\tNI.NurseAssignmentAkId = NA.NurseAssignmentAkId\r\n\t\tAND\r\n\t\tSI.ImpactType = 'M'\r\n\t\tAND\r\n\t\tSI.CurrentSnapshotFlag = 1\r\n\t\tAND\r\n\t\tNI.CurrentSnapshotFlag = 1\r\n\t\tAND\r\n\t\tNA.CurrentSnapshotFlag = 1\r\n\t\t\r\n\t\tGroup by\r\n\t\tNA.NurseAssignmentAkId\r\n\t\t\r\n\t\thaving\r\n\t\tCOUNT(*) >= 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY NurseAssignmentAkId ORDER BY TotalMedicalCostSavings) = 1\n),\nLKP_NurseAssignmentTimeWorked AS (\n\tSELECT\n\tTotalAssignmentTimeWorked,\n\tNurseAssignmentAkId\n\tFROM (\n\t\tSELECT \r\n\t\tCOUNT(*) as Total_Count,\r\n\t\tN.NurseAssignmentAkId as NurseAssignmentAkId,\r\n\t\tSUM(N.TimeWorkedHours) as TotalAssignmentTimeWorked\r\n\t\t  \r\n\t\tFROM \r\n\t\t @{pipeline().parameters.SOURCE_TABLE_OWNER}.NurseAssignmentTimeWorked N\r\n\t\t\r\n\t\twhere\r\n\t\tN.CurrentSnapshotFlag = 1\r\n\t\t\r\n\t\tGroup by\r\n\t\tNurseAssignmentAkId\r\n\t\t\r\n\t\thaving\r\n\t\tCOUNT(*) >= 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY NurseAssignmentAkId ORDER BY TotalAssignmentTimeWorked) = 1\n),\nLKP_NurseCase AS (\n\tSELECT\n\tclaim_party_occurrence_ak_id,\n\tNurseCaseAkId\n\tFROM (\n\t\tSELECT \r\n\t\tN.claim_party_occurrence_ak_id as claim_party_occurrence_ak_id,\r\n\t\tN.NurseCaseAkId as NurseCaseAkId \r\n\t\t\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.NurseCase N\r\n\t\t\r\n\t\twhere\r\n\t\tN.CurrentSnapshotFlag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY NurseCaseAkId ORDER BY claim_party_occurrence_ak_id) = 1\n),\nLKP_workers_comp_claimant_detail AS (\n\tSELECT\n\tttd_rate,\n\tdtd_rate,\n\tclaim_party_occurrence_ak_id\n\tFROM (\n\t\tSELECT\r\n\t\tWC.ttd_rate as ttd_rate, \r\n\t\tWC.dtd_rate as dtd_rate, \r\n\t\tWC.claim_party_occurrence_ak_id as claim_party_occurrence_ak_id\r\n\t\t\r\n\t\t FROM \r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.workers_comp_claimant_detail WC\r\n\t\t\r\n\t\twhere\r\n\t\tWC.crrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_party_occurrence_ak_id ORDER BY ttd_rate) = 1\n),\nmplt_Claimant_Occurrence_dim_ids AS (WITH\n\tINPUT AS (\n\t\t\n\t),\n\tLKP_NurseCase_EDW_Scr AS (\n\t\tSELECT\n\t\tclaim_party_occurrence_ak_id,\n\t\tNurseCaseAkId\n\t\tFROM (\n\t\t\tSELECT \r\n\t\t\tN.claim_party_occurrence_ak_id as claim_party_occurrence_ak_id, \r\n\t\t\tN.NurseCaseAkId as NurseCaseAkId\r\n\t\t\t\r\n\t\t\t FROM \r\n\t\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.NurseCase N\r\n\t\t\t\r\n\t\t\twhere\r\n\t\t\tCurrentSnapshotFlag = 1\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY NurseCaseAkId ORDER BY claim_party_occurrence_ak_id) = 1\n\t),\n\tLKP_claimant_dim_DM_Tgt AS (\n\t\tSELECT\n\t\tclaimant_dim_id,\n\t\tedw_claim_party_occurrence_ak_id\n\t\tFROM (\n\t\t\tSELECT \r\n\t\t\tC.claimant_dim_id as claimant_dim_id, C.edw_claim_party_occurrence_ak_id as edw_claim_party_occurrence_ak_id\r\n\t\t\t\r\n\t\t\t FROM\r\n\t\t\t @{pipeline().parameters.TARGET_TABLE_OWNER}.claimant_dim C\r\n\t\t\t\r\n\t\t\twhere\r\n\t\t\tcrrnt_snpsht_flag = 1\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_claim_party_occurrence_ak_id ORDER BY claimant_dim_id) = 1\n\t),\n\tLKP_claim_party_occurrence_EDW_Scr AS (\n\t\tSELECT\n\t\tclaim_occurrence_ak_id,\n\t\tclaim_party_occurrence_ak_id\n\t\tFROM (\n\t\t\tSELECT \r\n\t\t\tC.claim_occurrence_ak_id as claim_occurrence_ak_id, C.claim_party_occurrence_ak_id as claim_party_occurrence_ak_id\r\n\t\t\t\r\n\t\t\t FROM \r\n\t\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.claim_party_occurrence C\r\n\t\t\t\r\n\t\t\twhere\r\n\t\t\tcrrnt_snpsht_flag = 1\r\n\t\t\tAND\r\n\t\t\tclaim_party_role_code in ('CLMT','CMT')\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_party_occurrence_ak_id ORDER BY claim_occurrence_ak_id) = 1\n\t),\n\tLKP_claim_occurrence_dim_DM_Tgt AS (\n\t\tSELECT\n\t\tclaim_occurrence_dim_id,\n\t\tedw_claim_occurrence_ak_id\n\t\tFROM (\n\t\t\tSELECT\r\n\t\t\tC.claim_occurrence_dim_id as claim_occurrence_dim_id, C.edw_claim_occurrence_ak_id as edw_claim_occurrence_ak_id \r\n\t\t\t\r\n\t\t\tFROM \r\n\t\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_occurrence_dim C\r\n\t\t\t\r\n\t\t\twhere\r\n\t\t\tcrrnt_snpsht_flag = 1\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_claim_occurrence_ak_id ORDER BY claim_occurrence_dim_id) = 1\n\t),\n\tOUTPUT AS (\n\t\tSELECT\n\t\tLKP_claimant_dim_DM_Tgt.claimant_dim_id, \n\t\tLKP_claim_occurrence_dim_DM_Tgt.claim_occurrence_dim_id\n\t\tFROM \n\t\tLEFT JOIN LKP_claim_occurrence_dim_DM_Tgt\n\t\tON LKP_claim_occurrence_dim_DM_Tgt.edw_claim_occurrence_ak_id = LKP_claim_party_occurrence_EDW_Scr.claim_occurrence_ak_id\n\t\tLEFT JOIN LKP_claimant_dim_DM_Tgt\n\t\tON LKP_claimant_dim_DM_Tgt.edw_claim_party_occurrence_ak_id = LKP_NurseCase_EDW_Scr.claim_party_occurrence_ak_id\n\t),\n),\nEXP_Default_Values AS (\n\tSELECT\n\tEXP_Scr_Values.NurseAssignmentId,\n\tLKP_NurseAssignmentDim.NurseAssignmentDimId AS IN_NurseAssignmentDimId,\n\t-- *INF*: iif(isnull(IN_NurseAssignmentDimId),-1,IN_NurseAssignmentDimId)\n\tIFF(IN_NurseAssignmentDimId IS NULL, - 1, IN_NurseAssignmentDimId) AS v_NurseAssignmentDimId,\n\tv_NurseAssignmentDimId AS NurseAssignmentDimId,\n\tmplt_Claimant_Occurrence_dim_ids.claimant_dim_id AS IN_claimant_dim_id,\n\t-- *INF*: iif(isnull(IN_claimant_dim_id),-1,IN_claimant_dim_id)\n\tIFF(IN_claimant_dim_id IS NULL, - 1, IN_claimant_dim_id) AS v_claimant_dim_id,\n\tv_claimant_dim_id AS claimant_dim_id,\n\tmplt_Claimant_Occurrence_dim_ids.claim_occurrence_dim_id AS IN_claim_occurrence_dim_id,\n\t-- *INF*: iif(isnull(IN_claim_occurrence_dim_id),-1,IN_claim_occurrence_dim_id)\n\tIFF(IN_claim_occurrence_dim_id IS NULL, - 1, IN_claim_occurrence_dim_id) AS v_claim_occurrence_dim_id,\n\tv_claim_occurrence_dim_id AS claim_occurrence_dim_id,\n\tLKP_NurseAssignmentImpact.TimeSavedWeeks AS IN_TimeSavedWeeks,\n\t-- *INF*: iif(isnull(IN_TimeSavedWeeks),0,IN_TimeSavedWeeks)\n\tIFF(IN_TimeSavedWeeks IS NULL, 0, IN_TimeSavedWeeks) AS v_TimeSavedWeeks,\n\tv_TimeSavedWeeks AS TimeSavedWeeks,\n\tLKP_NurseAssignmentImpact.TimeSavedDays AS IN_TimeSavedDays,\n\t-- *INF*: iif(isnull(IN_TimeSavedDays),0,IN_TimeSavedDays)\n\tIFF(IN_TimeSavedDays IS NULL, 0, IN_TimeSavedDays) AS v_TimeSavedDays,\n\tv_TimeSavedDays AS TimeSavedDays,\n\tLKP_workers_comp_claimant_detail.ttd_rate AS IN_ttd_rate,\n\t-- *INF*: iif(isnull(IN_ttd_rate),0,IN_ttd_rate)\n\tIFF(IN_ttd_rate IS NULL, 0, IN_ttd_rate) AS v_ttd_rate,\n\tv_ttd_rate AS ttd_rate,\n\tLKP_workers_comp_claimant_detail.dtd_rate AS IN_dtd_rate,\n\t-- *INF*: iif(isnull(IN_dtd_rate),0,IN_dtd_rate)\n\tIFF(IN_dtd_rate IS NULL, 0, IN_dtd_rate) AS v_dtd_rate,\n\tv_dtd_rate AS dtd_rate,\n\t-- *INF*:  ( v_TimeSavedWeeks * v_ttd_rate )  +  ( v_TimeSavedDays * v_dtd_rate ) \n\t(v_TimeSavedWeeks * v_ttd_rate) + (v_TimeSavedDays * v_dtd_rate) AS v_EarlyReturnToWorkSavings,\n\tv_EarlyReturnToWorkSavings AS EarlyReturnToWorkSavings,\n\tLKP_NurseAssignmentTimeWorked.TotalAssignmentTimeWorked AS IN_TotalAssignmentTimeWorked,\n\t-- *INF*: iif(isnull(IN_TotalAssignmentTimeWorked),0,IN_TotalAssignmentTimeWorked)\n\tIFF(IN_TotalAssignmentTimeWorked IS NULL, 0, IN_TotalAssignmentTimeWorked) AS v_TotalAssignmentTimeWorked,\n\tv_TotalAssignmentTimeWorked AS TotalAssignmentTimeWorked,\n\tLKP_NurseAssignmentImpact_Medical.TotalMedicalCostSavings AS IN_TotalMedicalCostSavings,\n\t-- *INF*: iif(isnull(IN_TotalMedicalCostSavings),0,IN_TotalMedicalCostSavings)\n\tIFF(IN_TotalMedicalCostSavings IS NULL, 0, IN_TotalMedicalCostSavings) AS v_TotalMedicalCostSavings,\n\tv_TotalMedicalCostSavings AS TotalMedicalCostSavings,\n\tLKP_NurseAssignmentImpact_Indemnity.TotalIndemnityVocationalCategorySavings AS IN_TotalIndemnityVocationalCategorySavings,\n\t-- *INF*: iif(isnull(IN_TotalIndemnityVocationalCategorySavings),0,IN_TotalIndemnityVocationalCategorySavings)\n\tIFF(\n\t    IN_TotalIndemnityVocationalCategorySavings IS NULL, 0,\n\t    IN_TotalIndemnityVocationalCategorySavings\n\t) AS v_TotalIndemnityVocationalCategorySavings,\n\tv_TotalIndemnityVocationalCategorySavings AS TotalIndemnityVocationalCategorySavings,\n\tv_EarlyReturnToWorkSavings + v_TotalIndemnityVocationalCategorySavings AS v_TotalIndemnityVocationalSavings,\n\tv_TotalIndemnityVocationalSavings AS TotalIndemnityVocationalSavings,\n\tv_TotalMedicalCostSavings + v_TotalIndemnityVocationalSavings AS v_TotalCostImpact,\n\tv_TotalCostImpact AS TotalCostImpact\n\tFROM EXP_Scr_Values\n\t -- Manually join with mplt_Claimant_Occurrence_dim_ids\n\tLEFT JOIN LKP_NurseAssignmentDim\n\tON LKP_NurseAssignmentDim.EdwNurseAssignmentAkId = EXP_Scr_Values.NurseAssignmentAkId\n\tLEFT JOIN LKP_NurseAssignmentImpact\n\tON LKP_NurseAssignmentImpact.NurseAssignmentAkId = EXP_Scr_Values.NurseAssignmentAkId\n\tLEFT JOIN LKP_NurseAssignmentImpact_Indemnity\n\tON LKP_NurseAssignmentImpact_Indemnity.NurseAssignmentAkId = EXP_Scr_Values.NurseAssignmentAkId\n\tLEFT JOIN LKP_NurseAssignmentImpact_Medical\n\tON LKP_NurseAssignmentImpact_Medical.NurseAssignmentAkId = EXP_Scr_Values.NurseAssignmentAkId\n\tLEFT JOIN LKP_NurseAssignmentTimeWorked\n\tON LKP_NurseAssignmentTimeWorked.NurseAssignmentAkId = EXP_Scr_Values.NurseAssignmentAkId\n\tLEFT JOIN LKP_workers_comp_claimant_detail\n\tON LKP_workers_comp_claimant_detail.claim_party_occurrence_ak_id = LKP_NurseCase.claim_party_occurrence_ak_id\n),\nLKP_NurseAssignmentFact AS (\n\tSELECT\n\tNurseAssignmentFactId,\n\tEdwNurseAssignmentPkId,\n\tclaimant_dim_id,\n\tclaim_occurrence_dim_id,\n\tNurseAssignmentDimId,\n\tTimeSavedWeeks,\n\tTimeSavedDays,\n\tEarlyReturnToWorkSavings,\n\tTotalAssignmentTimeWorkedHours,\n\tTotalMedicalCostSavings,\n\tTotalIndemnityVocationalCategorySavings,\n\tTotalIndemnityVocationalSavings,\n\tTotalCostImpact\n\tFROM (\n\t\tSELECT \n\t\t\tNurseAssignmentFactId,\n\t\t\tEdwNurseAssignmentPkId,\n\t\t\tclaimant_dim_id,\n\t\t\tclaim_occurrence_dim_id,\n\t\t\tNurseAssignmentDimId,\n\t\t\tTimeSavedWeeks,\n\t\t\tTimeSavedDays,\n\t\t\tEarlyReturnToWorkSavings,\n\t\t\tTotalAssignmentTimeWorkedHours,\n\t\t\tTotalMedicalCostSavings,\n\t\t\tTotalIndemnityVocationalCategorySavings,\n\t\t\tTotalIndemnityVocationalSavings,\n\t\t\tTotalCostImpact\n\t\tFROM NurseAssignmentFact\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EdwNurseAssignmentPkId ORDER BY NurseAssignmentFactId) = 1\n),\nEXP_Detect_Changes AS (\n\tSELECT\n\tLKP_NurseAssignmentFact.NurseAssignmentFactId AS Lkp_NurseAssignmentFactId,\n\tLKP_NurseAssignmentFact.EdwNurseAssignmentPkId AS Lkp_EdwNurseAssignmentPkId,\n\tLKP_NurseAssignmentFact.claimant_dim_id AS Lkp_claimant_dim_id,\n\tLKP_NurseAssignmentFact.claim_occurrence_dim_id AS Lkp_claim_occurrence_dim_id,\n\tLKP_NurseAssignmentFact.NurseAssignmentDimId AS Lkp_NurseAssignmentDimId,\n\tLKP_NurseAssignmentFact.TimeSavedWeeks AS Lkp_TimeSavedWeeks,\n\tLKP_NurseAssignmentFact.TimeSavedDays AS Lkp_TimeSavedDays,\n\tLKP_NurseAssignmentFact.EarlyReturnToWorkSavings AS Lkp_EarlyReturnToWorkSavings,\n\tLKP_NurseAssignmentFact.TotalAssignmentTimeWorkedHours AS Lkp_TotalAssignmentTimeWorkedHours,\n\tLKP_NurseAssignmentFact.TotalMedicalCostSavings AS Lkp_TotalMedicalCostSavings,\n\tLKP_NurseAssignmentFact.TotalIndemnityVocationalCategorySavings AS Lkp_TotalIndemnityVocationalCategorySavings,\n\tLKP_NurseAssignmentFact.TotalIndemnityVocationalSavings AS Lkp_TotalIndemnityVocationalSavings,\n\tLKP_NurseAssignmentFact.TotalCostImpact AS Lkp_TotalCostImpact,\n\t-- *INF*: iif(isnull(Lkp_NurseAssignmentFactId),'NEW',\r\n\t-- \r\n\t-- iif (\r\n\t-- \r\n\t-- Lkp_EdwNurseAssignmentPkId != NurseAssignmentId\r\n\t--  OR \r\n\t-- Lkp_claimant_dim_id != claimant_dim_id\r\n\t--  OR \r\n\t-- Lkp_claim_occurrence_dim_id != claim_occurrence_dim_id\r\n\t--  OR \r\n\t-- Lkp_NurseAssignmentDimId != NurseAssignmentDimId\r\n\t--  OR \r\n\t-- Lkp_TimeSavedWeeks != TimeSavedWeeks\r\n\t--  OR \r\n\t-- Lkp_TimeSavedDays != TimeSavedDays\r\n\t--  OR \r\n\t-- Lkp_EarlyReturnToWorkSavings != EarlyReturnToWorkSavings\r\n\t--  OR \r\n\t-- Lkp_TotalAssignmentTimeWorkedHours != TotalAssignmentTimeWorked\r\n\t--  OR \r\n\t-- Lkp_TotalMedicalCostSavings != TotalMedicalCostSavings\r\n\t--  OR \r\n\t-- Lkp_TotalIndemnityVocationalCategorySavings != TotalIndemnityVocationalCategorySavings\r\n\t--  OR \r\n\t-- Lkp_TotalIndemnityVocationalSavings != TotalIndemnityVocationalSavings\r\n\t--  OR \r\n\t-- Lkp_TotalCostImpact != TotalCostImpact,\r\n\t-- \r\n\t--  'UPDATE','NOCHANGE' )\r\n\t-- \r\n\t--   )\r\n\t-- \r\n\t-- \n\tIFF(\n\t    Lkp_NurseAssignmentFactId IS NULL, 'NEW',\n\t    IFF(\n\t        Lkp_EdwNurseAssignmentPkId != NurseAssignmentId\n\t        or Lkp_claimant_dim_id != claimant_dim_id\n\t        or Lkp_claim_occurrence_dim_id != claim_occurrence_dim_id\n\t        or Lkp_NurseAssignmentDimId != NurseAssignmentDimId\n\t        or Lkp_TimeSavedWeeks != TimeSavedWeeks\n\t        or Lkp_TimeSavedDays != TimeSavedDays\n\t        or Lkp_EarlyReturnToWorkSavings != EarlyReturnToWorkSavings\n\t        or Lkp_TotalAssignmentTimeWorkedHours != TotalAssignmentTimeWorked\n\t        or Lkp_TotalMedicalCostSavings != TotalMedicalCostSavings\n\t        or Lkp_TotalIndemnityVocationalCategorySavings != TotalIndemnityVocationalCategorySavings\n\t        or Lkp_TotalIndemnityVocationalSavings != TotalIndemnityVocationalSavings\n\t        or Lkp_TotalCostImpact != TotalCostImpact,\n\t        'UPDATE',\n\t        'NOCHANGE'\n\t    )\n\t) AS v_ChangedFlag,\n\tv_ChangedFlag AS ChangedFlag,\n\tEXP_Default_Values.NurseAssignmentId,\n\tEXP_Default_Values.NurseAssignmentDimId,\n\tEXP_Default_Values.claimant_dim_id,\n\tEXP_Default_Values.claim_occurrence_dim_id,\n\tEXP_Default_Values.TimeSavedWeeks,\n\tEXP_Default_Values.TimeSavedDays,\n\tEXP_Default_Values.ttd_rate,\n\tEXP_Default_Values.dtd_rate,\n\tEXP_Default_Values.EarlyReturnToWorkSavings,\n\tEXP_Default_Values.TotalAssignmentTimeWorked,\n\tEXP_Default_Values.TotalMedicalCostSavings,\n\tEXP_Default_Values.TotalIndemnityVocationalCategorySavings,\n\tEXP_Default_Values.TotalIndemnityVocationalSavings,\n\tEXP_Default_Values.TotalCostImpact,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditId\n\tFROM EXP_Default_Values\n\tLEFT JOIN LKP_NurseAssignmentFact\n\tON LKP_NurseAssignmentFact.EdwNurseAssignmentPkId = EXP_Default_Values.NurseAssignmentId\n),\nRTR_Insert_Update AS (\n\tSELECT\n\tLkp_NurseAssignmentFactId,\n\tChangedFlag,\n\tNurseAssignmentId,\n\tNurseAssignmentDimId,\n\tclaimant_dim_id,\n\tclaim_occurrence_dim_id,\n\tTimeSavedWeeks,\n\tTimeSavedDays,\n\tEarlyReturnToWorkSavings,\n\tTotalAssignmentTimeWorked,\n\tTotalMedicalCostSavings,\n\tTotalIndemnityVocationalCategorySavings,\n\tTotalIndemnityVocationalSavings,\n\tTotalCostImpact,\n\to_AuditId\n\tFROM EXP_Detect_Changes\n),\nRTR_Insert_Update_Insert AS (SELECT * FROM RTR_Insert_Update WHERE ChangedFlag = 'NEW'),\nRTR_Insert_Update_DEFAULT1 AS (SELECT * FROM RTR_Insert_Update WHERE NOT ( (ChangedFlag = 'NEW') )),\nUPD_Insert AS (\n\tSELECT\n\tNurseAssignmentId AS NurseAssignmentId1, \n\tNurseAssignmentDimId AS NurseAssignmentDimId1, \n\tclaimant_dim_id AS claimant_dim_id1, \n\tclaim_occurrence_dim_id AS claim_occurrence_dim_id1, \n\tTimeSavedWeeks AS TimeSavedWeeks1, \n\tTimeSavedDays AS TimeSavedDays1, \n\tEarlyReturnToWorkSavings AS EarlyReturnToWorkSavings1, \n\tTotalAssignmentTimeWorked AS TotalAssignmentTimeWorked1, \n\tTotalMedicalCostSavings AS TotalMedicalCostSavings1, \n\tTotalIndemnityVocationalCategorySavings AS TotalIndemnityVocationalCategorySavings1, \n\tTotalIndemnityVocationalSavings AS TotalIndemnityVocationalSavings1, \n\tTotalCostImpact AS TotalCostImpact1, \n\to_AuditId AS o_AuditId1\n\tFROM RTR_Insert_Update_Insert\n),\nNurseAssignmentFact_Insert AS (\n\tTRUNCATE TABLE NurseAssignmentFact;\n\tINSERT INTO NurseAssignmentFact\n\t(AuditId, EdwNurseAssignmentPkId, claimant_dim_id, claim_occurrence_dim_id, NurseAssignmentDimId, TimeSavedWeeks, TimeSavedDays, EarlyReturnToWorkSavings, TotalAssignmentTimeWorkedHours, TotalMedicalCostSavings, TotalIndemnityVocationalCategorySavings, TotalIndemnityVocationalSavings, TotalCostImpact)\n\tSELECT \n\to_AuditId1 AS AUDITID, \n\tNurseAssignmentId1 AS EDWNURSEASSIGNMENTPKID, \n\tclaimant_dim_id1 AS CLAIMANT_DIM_ID, \n\tclaim_occurrence_dim_id1 AS CLAIM_OCCURRENCE_DIM_ID, \n\tNurseAssignmentDimId1 AS NURSEASSIGNMENTDIMID, \n\tTimeSavedWeeks1 AS TIMESAVEDWEEKS, \n\tTimeSavedDays1 AS TIMESAVEDDAYS, \n\tEarlyReturnToWorkSavings1 AS EARLYRETURNTOWORKSAVINGS, \n\tTotalAssignmentTimeWorked1 AS TOTALASSIGNMENTTIMEWORKEDHOURS, \n\tTotalMedicalCostSavings1 AS TOTALMEDICALCOSTSAVINGS, \n\tTotalIndemnityVocationalCategorySavings1 AS TOTALINDEMNITYVOCATIONALCATEGORYSAVINGS, \n\tTotalIndemnityVocationalSavings1 AS TOTALINDEMNITYVOCATIONALSAVINGS, \n\tTotalCostImpact1 AS TOTALCOSTIMPACT\n\tFROM UPD_Insert\n),\nUPD_Update AS (\n\tSELECT\n\tLkp_NurseAssignmentFactId AS Lkp_NurseAssignmentFactId2, \n\tNurseAssignmentId AS NurseAssignmentId2, \n\tNurseAssignmentDimId AS NurseAssignmentDimId2, \n\tclaimant_dim_id AS claimant_dim_id2, \n\tclaim_occurrence_dim_id AS claim_occurrence_dim_id2, \n\tTimeSavedWeeks AS TimeSavedWeeks2, \n\tTimeSavedDays AS TimeSavedDays2, \n\tEarlyReturnToWorkSavings AS EarlyReturnToWorkSavings2, \n\tTotalAssignmentTimeWorked AS TotalAssignmentTimeWorked2, \n\tTotalMedicalCostSavings AS TotalMedicalCostSavings2, \n\tTotalIndemnityVocationalCategorySavings AS TotalIndemnityVocationalCategorySavings2, \n\tTotalIndemnityVocationalSavings AS TotalIndemnityVocationalSavings2, \n\tTotalCostImpact AS TotalCostImpact2, \n\to_AuditId AS o_AuditId2\n\tFROM RTR_Insert_Update_DEFAULT1\n),\nNurseAssignmentFact_Update AS (\n\tMERGE INTO NurseAssignmentFact AS T\n\tUSING UPD_Update AS S\n\tON T.NurseAssignmentFactId = S.Lkp_NurseAssignmentFactId2\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.AuditId = S.o_AuditId2, T.EdwNurseAssignmentPkId = S.NurseAssignmentId2, T.claimant_dim_id = S.claimant_dim_id2, T.claim_occurrence_dim_id = S.claim_occurrence_dim_id2, T.NurseAssignmentDimId = S.NurseAssignmentDimId2, T.TimeSavedWeeks = S.TimeSavedWeeks2, T.TimeSavedDays = S.TimeSavedDays2, T.EarlyReturnToWorkSavings = S.EarlyReturnToWorkSavings2, T.TotalAssignmentTimeWorkedHours = S.TotalAssignmentTimeWorked2, T.TotalMedicalCostSavings = S.TotalMedicalCostSavings2, T.TotalIndemnityVocationalCategorySavings = S.TotalIndemnityVocationalCategorySavings2, T.TotalIndemnityVocationalSavings = S.TotalIndemnityVocationalSavings2, T.TotalCostImpact = S.TotalCostImpact2\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "ClaimsDataMart/"
        },
        "annotations": []
    }
}