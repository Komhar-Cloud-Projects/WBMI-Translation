{
    "name": "m_POL_DW_LOAD_PremiumTransactionRatingModifier_DCT",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DW_LOAD_PremiumTransactionRatingModifier_DCT",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_PremiumTransaction AS (\n\tSELECT PremiumTransaction.PremiumTransactionID\r\n\t\t,PremiumTransaction.PremiumTransactionAKID\r\n\t\t,WorkPremiumTransaction.PremiumTransactionStageId\r\n\t\t,RatingCoverage.CoverageGUID\r\n\t\t,RatingCoverage.CoverageType\r\n\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkPremiumTransaction ON PremiumTransaction.PremiumTransactionAKID = WorkPremiumTransaction.PremiumTransactionAKID\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage ON PremiumTransaction.RatingcoverageAKID = RatingCoverage.RatingcoverageAKID\r\n\t\tAND PremiumTransaction.EffectiveDate = RatingCoverage.EffectiveDate\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product  ON RatingCoverage.ProductAKId = Product.ProductAKId\r\n\t\tAND Product.CurrentSnapshotFlag = 1\r\n\t\tAND Product.ProductAbbreviation <> 'WC'\r\n\tWHERE PremiumTransaction.PremiumTransactionID NOT IN (\r\n\t\t\tSELECT WPTOL.PremiumTransactionID\r\n\t\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkPremiumTransactionOffsetLineage WPTOL\r\n\t\t\twith (nolock) WHERE WPTOL.UpdateAttributeFlag = 1) \r\n\t\tAND PremiumTransaction.ReasonAmendedCode NOT IN (\r\n\t\t\t'CWO'\r\n\t\t\t,'Claw Back'\r\n\t\t\t) and PremiumTransaction.PremiumType='D'\n),\nEXP_Extract_IL AS (\n\tSELECT\n\tPremiumTransactionID,\n\tPremiumTransactionAKID,\n\tPremiumTransactionStageId,\n\tCoverageGUID,\n\tCoverageType\n\tFROM SQ_PremiumTransaction\n),\nFilter_CoverageType_BuiltUp AS (\n\tSELECT\n\tPremiumTransactionID, \n\tPremiumTransactionAKID, \n\tCoverageGUID, \n\tPremiumTransactionStageId, \n\tCoverageType\n\tFROM EXP_Extract_IL\n\tWHERE CoverageType = 'BuiltUp'\n),\nEXP_BuitUp AS (\n\tSELECT\n\tPremiumTransactionID,\n\tPremiumTransactionAKID,\n\tCoverageGUID,\n\tPremiumTransactionStageId\n\tFROM Filter_CoverageType_BuiltUp\n),\nSQ_WBCUPremiumDetailStage_Umbrella AS (\n\tselect \r\n\tCov.CoverageId,\r\n\tCov.Id as CoverageGUID,\r\n\tCov.SessionId\r\n\tfrom @{pipeline().parameters.SOURCE_TABLE_OWNER}.DCCoverageStaging Cov\r\n\tinner join @{pipeline().parameters.SOURCE_TABLE_OWNER}.WBCUPremiumDetailStage CU on CU.SessionId=Cov.SessionId\r\n\tand CU.WBCUPremiumDetailId=Cov.ObjectId\r\n\tand CU.Type='Treaty'\r\n\twhere\r\n\tCov.Type = 'BuiltUp'\r\n\tand Cov.ObjectName='WB_CU_PremiumDetail'\n),\nlkp_DCTUmbrella AS (\n\tSELECT\n\tModifier,\n\tSessionId\n\tFROM (\n\t\tselect SessionId as SessionId,\r\n\t\t       case when sum(FirstMillionModifiedPremium)<>0 and sum(FirstMillionBasePremium)<>0\r\n\t\t       then sum(FirstMillionModifiedPremium)/sum(FirstMillionBasePremium) else 1 end as Modifier\r\n\t\t       from (\r\n\t\t              select SessionId,FirstMillionBasePremium,FirstMillionModifiedPremium from @{pipeline().parameters.SOURCE_TABLE_OWNER}.WBCUUmbrellaCommercialAutoStaging\r\n\t\t\t\t\t  union all\r\n\t\t              select SessionId,FirstMillionBasePremium,FirstMillionModifiedPremium from @{pipeline().parameters.SOURCE_TABLE_OWNER}.WBCUUmbrellaGeneralLiabilityStaging\r\n\t\t              union all\r\n\t\t              select SessionId,FirstMillionBasePremium,FirstMillionModifiedPremium from @{pipeline().parameters.SOURCE_TABLE_OWNER}.WBCUUmbrellaSMARTBusinessStage\r\n\t\t\t\t\t  union all\r\n\t\t              select SessionId,FirstMillionBasePremium,FirstMillionModifiedPremium from @{pipeline().parameters.SOURCE_TABLE_OWNER}.WBCUUmbrellaSBOPStage\r\n\t\t\t\t\t  union all\r\n\t\t              select SessionId,FirstMillionBasePremium,FirstMillionModifiedPremium from @{pipeline().parameters.SOURCE_TABLE_OWNER}.WBCUUmbrellaBusinessOwnersStaging\r\n\t\t\t\t\t  ) a\r\n\t\tgroup by SessionId\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY SessionId ORDER BY Modifier) = 1\n),\nEXP_DCTUmbrella AS (\n\tSELECT\n\tSQ_WBCUPremiumDetailStage_Umbrella.CoverageId,\n\tSQ_WBCUPremiumDetailStage_Umbrella.CoverageGUID,\n\t'DCTUmbrella' AS Type,\n\tlkp_DCTUmbrella.Modifier AS Value,\n\t'DCTUmbrellaScheduled' AS Scope\n\tFROM SQ_WBCUPremiumDetailStage_Umbrella\n\tLEFT JOIN lkp_DCTUmbrella\n\tON lkp_DCTUmbrella.SessionId = SQ_WBCUPremiumDetailStage_Umbrella.SessionId\n),\nJNR_BuiltUP_DCTUmbrella AS (SELECT\n\tEXP_BuitUp.PremiumTransactionID, \n\tEXP_BuitUp.PremiumTransactionAKID, \n\tEXP_BuitUp.CoverageGUID, \n\tEXP_BuitUp.PremiumTransactionStageId, \n\tEXP_DCTUmbrella.CoverageId, \n\tEXP_DCTUmbrella.CoverageGUID AS CoverageGUID_Stage, \n\tEXP_DCTUmbrella.Type, \n\tEXP_DCTUmbrella.Value, \n\tEXP_DCTUmbrella.Scope\n\tFROM EXP_BuitUp\n\tINNER JOIN EXP_DCTUmbrella\n\tON EXP_DCTUmbrella.CoverageId = EXP_BuitUp.PremiumTransactionStageId AND EXP_DCTUmbrella.CoverageGUID = EXP_BuitUp.CoverageGUID\n),\nEXP_BuitUp_DCTUmbrella AS (\n\tSELECT\n\tPremiumTransactionID,\n\tPremiumTransactionAKID,\n\tType,\n\tValue,\n\tScope,\n\t'CommercialUmbrella' AS InsuranceLine_stg\n\tFROM JNR_BuiltUP_DCTUmbrella\n),\nSQ_DCCoverageStaging_NonUmbrella AS (\n\tWITH PCoverage\t\t\t\t\t\t\t\t\r\n\tAS (\t\t\t\t\t\t\t\t\r\n\t\tSELECT parent.SessionId, \t\t\t\t\t\t\t\r\n\t\t\tparent.ObjectId AS ObjectId, \t\t\t\t\t\t\r\n\t\t\tparent.ObjectName AS ObjectName, \t\t\t\t\t\t\r\n\t\t\tparent.CoverageId, \t\t\t\t\t\t\r\n\t\t\tparent.Id AS CoverageGUID, \t\t\t\t\t\t\r\n\t\t\tparent.Type AS CoverageType, \t\t\t\t\t\t\r\n\t\t\tCASE substring(parent.ObjectName, 4, 3) \t\t\t\t\t\t\r\n\t\t\t\tWHEN 'CF_' THEN 'Property' \t\t\t\t\t\r\n\t\t\t\tWHEN 'GL_' THEN 'GeneralLiability' \t\t\t\t\t\r\n\t\t\t\tWHEN 'WC_' THEN 'WorkersCompensation' \t\t\t\t\t\r\n\t\t\t\tWHEN 'BP_' THEN 'BusinessOwners' \t\t\t\t\t\r\n\t\t\t\tWHEN 'CR_' THEN 'Crime' \t\t\t\t\t\r\n\t\t\t\tWHEN 'IM_' THEN 'InlandMarine' \t\t\t\t\t\r\n\t\t\t\tWHEN 'EXL' THEN 'ExcessLiability' \t\t\t\t\t\r\n\t\t\t\tWHEN 'CU_' THEN 'CommercialUmbrella' \t\t\t\t\t\r\n\t\t\t\tWHEN 'CA_' THEN 'CommercialAuto' \t\t\t\t\t\r\n\t\t\t\tWHEN 'CDO' THEN 'DirectorsAndOffsCondos' \t\t\t\t\t\r\n\t\t\t\tWHEN 'EPL' THEN 'EmploymentPracticesLiab' \t\t\t\t\t\r\n\t\t\t\tWHEN 'HIO' THEN 'HoleInOne' \t\t\t\t\t\r\n\t\t\t\tWHEN 'GOC' THEN 'GamesOfChance' \t\t\t\t\t\r\n\t\t\t\tELSE 'N/A' \t\t\t\t\t\r\n\t\t\tEND InsuranceLine\t\t\t\t\t\t\r\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.DCCoverageStaging parent\t\t\t\t\t\t\t\r\n\t\tWHERE parent.ObjectName <> 'DC_Coverage'\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\tUNION ALL\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\tSELECT parent.SessionId, \t\t\t\t\t\t\t\r\n\t\t\tparent.ObjectId AS ObjectId, \t\t\t\t\t\t\r\n\t\t\tparent.ObjectName AS ObjectName, \t\t\t\t\t\t\r\n\t\t\tchild.CoverageId, \t\t\t\t\t\t\r\n\t\t\tchild.Id AS CoverageGUID, \t\t\t\t\t\t\r\n\t\t\tchild.Type AS CoverageType, \t\t\t\t\t\t\r\n\t\t\tCASE substring(parent.ObjectName, 4, 3) \t\t\t\t\t\t\r\n\t\t\t\tWHEN 'CF_' THEN 'Property' \t\t\t\t\t\r\n\t\t\t\tWHEN 'GL_' THEN 'GeneralLiability' \t\t\t\t\t\r\n\t\t\t\tWHEN 'WC_' THEN 'WorkersCompensation' \t\t\t\t\t\r\n\t\t\t\tWHEN 'BP_' THEN 'BusinessOwners' \t\t\t\t\t\r\n\t\t\t\tWHEN 'CR_' THEN 'Crime' \t\t\t\t\t\r\n\t\t\t\tWHEN 'IM_' THEN 'InlandMarine' \t\t\t\t\t\r\n\t\t\t\tWHEN 'EXL' THEN 'ExcessLiability' \t\t\t\t\t\r\n\t\t\t\tWHEN 'CU_' THEN 'CommercialUmbrella' \t\t\t\t\t\r\n\t\t\t\tWHEN 'CA_' THEN 'CommercialAuto' \t\t\t\t\t\r\n\t\t\t\tWHEN 'CDO' THEN 'DirectorsAndOffsCondos' \t\t\t\t\t\r\n\t\t\t\tWHEN 'EPL' THEN 'EmploymentPracticesLiab' \t\t\t\t\t\r\n\t\t\t\tWHEN 'HIO' THEN 'HoleInOne' \t\t\t\t\t\r\n\t\t\t\tWHEN 'GOC' THEN 'GamesOfChance' \t\t\t\t\t\r\n\t\t\t\tELSE 'N/A' \t\t\t\t\t\r\n\t\t\tEND InsuranceLine\t\t\t\t\t\t\r\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.DCCoverageStaging child\t\t\t\t\t\t\t\r\n\t\tJOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.DCCoverageStaging parent ON child.SessionId = parent.SessionId\t\t\t\t\t\t\t\r\n\t\t\tAND child.ObjectId = parent.CoverageId\t\t\t\t\t\t\r\n\t\t\tAND parent.ObjectName <> 'DC_Coverage'\t\t\t\t\t\t\r\n\t\tWHERE child.ObjectName = 'DC_Coverage'\t\t\t\t\t\t\t\r\n\t\t)\r\n\tselect a.CoverageGuid,a.CoverageId,a.ModifierType,a.ModifierValue,a.ModifierScope,a.InsuranceLine from \r\n\t(SELECT C.CoverageGuid,\t\t\t\t\t\t\t\t\r\n\t\tC.CoverageId,\t\t\t\t\t\t\t\r\n\t\tm.Type AS ModifierType,\t\t\t\t\t\t\t\r\n\t\tm.Value AS ModifierValue,\t\t\t\t\t\t\t\r\n\t\tm.Scope as ModifierScope,\t\t\t\t\t\t\t\r\n\t\tisnull(L.Type, C.InsuranceLine) AS InsuranceLine\t\t\t\t\t\t\t\r\n\tFROM PCoverage C \t\t\t\t\t\t\t\t\r\n\tJOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.DCModifierStaging m ON m.ObjectId = C.CoverageId AND m.SessionId = C.SessionId\t\t\t\t\t\t\t\t\r\n\t\tAND m.ObjectName = 'DC_Coverage'\t\t\t\t\t\t\t\r\n\t\tAND m.Type IS NOT NULL\t\t\t\t\t\t\t\r\n\t\tAND m.Value IS NOT NULL\t\t\t\t\t\t\t\r\n\t\tAND m.Value <> '0'\t\t\r\n\t     \t\t\t\t\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.DCLineStaging L ON L.SessionId = C.SessionId\t\t\t\t\t\t\t\t\r\n\t\tAND (\t\t\t\t\t\t\t\r\n\t\t\t\t(L.LineId = C.ObjectId AND C.ObjectName = 'DC_Line')\t\t\t\t\t\r\n\t\t\t\tOR L.Type = C.InsuranceLine\t\t\t\t\t\r\n\t\t\t)) a\r\n\twhere a.InsuranceLine <> 'CommercialUmbrella'\n),\nEXP_Stage AS (\n\tSELECT\n\tId AS CoverageGUID,\n\tCoverageId,\n\tType,\n\tValue,\n\tScope,\n\tObjectName AS InsuranceLine_stg\n\tFROM SQ_DCCoverageStaging_NonUmbrella\n),\nJNR_IL_Stage AS (SELECT\n\tEXP_Extract_IL.PremiumTransactionID, \n\tEXP_Extract_IL.PremiumTransactionAKID, \n\tEXP_Extract_IL.PremiumTransactionStageId, \n\tEXP_Extract_IL.CoverageGUID, \n\tEXP_Stage.CoverageGUID AS CoverageGUID_Stage, \n\tEXP_Stage.CoverageId, \n\tEXP_Stage.Type, \n\tEXP_Stage.Value, \n\tEXP_Stage.Scope, \n\tEXP_Stage.InsuranceLine_stg\n\tFROM EXP_Extract_IL\n\tINNER JOIN EXP_Stage\n\tON EXP_Stage.CoverageGUID = EXP_Extract_IL.CoverageGUID AND EXP_Stage.CoverageId = EXP_Extract_IL.PremiumTransactionStageId\n),\nEXP_IL_Stage AS (\n\tSELECT\n\tPremiumTransactionID,\n\tPremiumTransactionAKID,\n\tType,\n\tValue,\n\tScope,\n\tInsuranceLine_stg\n\tFROM JNR_IL_Stage\n),\nUnion_All_lines AS (\n\tSELECT PremiumTransactionID, PremiumTransactionAKID, Type, Value, Scope, InsuranceLine_stg\n\tFROM EXP_BuitUp_DCTUmbrella\n\tUNION\n\tSELECT PremiumTransactionID, PremiumTransactionAKID, Type, Value, Scope, InsuranceLine_stg\n\tFROM EXP_IL_Stage\n),\nmplt_PremiumTransactionRatingModifier AS (WITH\n\tSource_RatingModifier AS (\n\t\t\n\t),\n\tExp_GetValues AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue AS i_Value,\n\t\tScope,\n\t\tInsuranceLine_stg AS InsuranceLine,\n\t\t-- *INF*: TO_DECIMAL(i_Value,8)\n\t\tTO_DECIMAL(i_Value, 8) AS v_Value,\n\t\t-- *INF*: ROUND(v_Value,4)\n\t\tROUND(v_Value, 4) AS o_Value\n\t\tFROM Source_RatingModifier\n\t),\n\tRTR_InsuranceLine AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\to_Value AS Value,\n\t\tScope,\n\t\tInsuranceLine\n\t\tFROM Exp_GetValues\n\t),\n\tRTR_InsuranceLine_Property AS (SELECT * FROM RTR_InsuranceLine WHERE InsuranceLine='Property'),\n\tRTR_InsuranceLine_GeneralLiability AS (SELECT * FROM RTR_InsuranceLine WHERE InsuranceLine='GeneralLiability'),\n\tRTR_InsuranceLine_BusinessOwners AS (SELECT * FROM RTR_InsuranceLine WHERE InsuranceLine='BusinessOwners'),\n\tRTR_InsuranceLine_CommercialAuto AS (SELECT * FROM RTR_InsuranceLine WHERE InsuranceLine='CommercialAuto'),\n\tRTR_InsuranceLine_Crime AS (SELECT * FROM RTR_InsuranceLine WHERE InsuranceLine='Crime'),\n\tRTR_InsuranceLine_EmploymentPracticesLiab AS (SELECT * FROM RTR_InsuranceLine WHERE InsuranceLine='EmploymentPracticesLiab'),\n\tRTR_InsuranceLine_InlandMarine AS (SELECT * FROM RTR_InsuranceLine WHERE InsuranceLine='InlandMarine'),\n\tRTR_InsuranceLine_SBOPGeneralLiability AS (SELECT * FROM RTR_InsuranceLine WHERE InsuranceLine='SBOPGeneralLiability'),\n\tRTR_InsuranceLine_SBOPProperty AS (SELECT * FROM RTR_InsuranceLine WHERE InsuranceLine='SBOPProperty'),\n\tRTR_InsuranceLine_CommercialUmbrella AS (SELECT * FROM RTR_InsuranceLine WHERE InsuranceLine='CommercialUmbrella'),\n\tRTR_InsuranceLine_DEFAULT1 AS (SELECT * FROM RTR_InsuranceLine WHERE NOT ( (InsuranceLine='Property') OR (InsuranceLine='GeneralLiability') OR (InsuranceLine='BusinessOwners') OR (InsuranceLine='CommercialAuto') OR (InsuranceLine='Crime') OR (InsuranceLine='EmploymentPracticesLiab') OR (InsuranceLine='InlandMarine') OR (InsuranceLine='SBOPGeneralLiability') OR (InsuranceLine='SBOPProperty') OR (InsuranceLine='CommercialUmbrella') )),\n\tEXP_InalandMarine AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope,\n\t\t-- *INF*: IIF(Type='IRPM' AND Scope='IRPMFactor',Value,0)\n\t\tIFF(Type = 'IRPM' AND Scope = 'IRPMFactor', Value, 0) AS IRPM_Irpmfactor_IM\n\t\tFROM RTR_InsuranceLine_InlandMarine\n\t),\n\tEXP_Other_lines AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID\n\t\tFROM RTR_InsuranceLine_DEFAULT1\n\t),\n\tEXP_EmploymentPracticesLiab AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope,\n\t\t-- *INF*: IIF(Type='ScheduledMod' AND Scope='Liability',Value,0)\n\t\tIFF(Type = 'ScheduledMod' AND Scope = 'Liability', Value, 0) AS Scheduledmod_Liability_EMP\n\t\tFROM RTR_InsuranceLine_EmploymentPracticesLiab\n\t),\n\tEXP_SBOPGeneralLiability AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope\n\t\tFROM RTR_InsuranceLine_SBOPGeneralLiability\n\t),\n\tEXP_Property AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope\n\t\tFROM RTR_InsuranceLine_Property\n\t),\n\tEXP_CommercialAuto AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope\n\t\tFROM RTR_InsuranceLine_CommercialAuto\n\t),\n\tEXP_Crime AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope,\n\t\t-- *INF*: IIF(Type='ScheduledMod' AND Scope='Liability',Value,0)\n\t\tIFF(Type = 'ScheduledMod' AND Scope = 'Liability', Value, 0) AS Scheduledmod_Liability_Crime\n\t\tFROM RTR_InsuranceLine_Crime\n\t),\n\tEXP_CommercialUmbrella AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope,\n\t\t-- *INF*: IIF(Type='DCTUmbrella' AND Scope='DCTUmbrellaScheduled',Value,0)\n\t\tIFF(Type = 'DCTUmbrella' AND Scope = 'DCTUmbrellaScheduled', Value, 0) AS Scheduledmod_DCTUmbrella\n\t\tFROM RTR_InsuranceLine_CommercialUmbrella\n\t),\n\tEXP_BusinessOwners AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope,\n\t\t-- *INF*: IIF(Type='IRPM' AND Scope='IRPMFactor',Value,0)\n\t\tIFF(Type = 'IRPM' AND Scope = 'IRPMFactor', Value, 0) AS o_ScheduledMod_IRPM_BO,\n\t\t-- *INF*: IIF(Type = 'TransitionMod' AND ISNULL(Scope),Value,0)\n\t\tIFF(Type = 'TransitionMod' AND Scope IS NULL, Value, 0) AS o_TransitionMod_BO_7x,\n\t\t-- *INF*: IIF(Type = 'TransitionMod' AND Scope='IRPM',Value,0)\n\t\tIFF(Type = 'TransitionMod' AND Scope = 'IRPM', Value, 0) AS o_TransitionMod_BO_9x\n\t\tFROM RTR_InsuranceLine_BusinessOwners\n\t),\n\tEXP_SBOPProperty AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope\n\t\tFROM RTR_InsuranceLine_SBOPProperty\n\t),\n\tEXP_GeneralLiability AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope\n\t\tFROM RTR_InsuranceLine_GeneralLiability\n\t),\n\tAGG_RowsToColumns_EmploymentPracticesLiab AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\tScheduledmod_Liability_EMP AS i_Scheduledmod_Liability_EMP, \n\t\tMax(i_Scheduledmod_Liability_EMP) AS o_Scheduledmod_Liability_EMP\n\t\tFROM EXP_EmploymentPracticesLiab\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColuns_BusinessOwners AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_ScheduledMod_IRPM_BO AS i_ScheduledMod_IRPM_BO, \n\t\to_TransitionMod_BO_7x AS i_TransitionMod_BO_7x, \n\t\to_TransitionMod_BO_9x AS i_TransitionMod_BO_9x, \n\t\tMax(i_ScheduledMod_IRPM_BO) AS o_ScheduledMod_IRPM_BO, \n\t\tMax(i_TransitionMod_BO_7x) AS o_TransitionMod_BO_7x, \n\t\tMax(i_TransitionMod_BO_9x) AS o_TransitionMod_BO_9x\n\t\tFROM EXP_BusinessOwners\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_Crime AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\tScheduledmod_Liability_Crime AS i_Scheduledmod_Liability_Crime, \n\t\tMax(i_Scheduledmod_Liability_Crime) AS o_Scheduledmod_Liability_Crime\n\t\tFROM EXP_Crime\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsTocolumns_Otherlines AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID\n\t\tFROM EXP_Other_lines\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionID ORDER BY NULL) = 1\n\t),\n\tRTE_CommercialAuto AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope\n\t\tFROM EXP_CommercialAuto\n\t),\n\tRTE_CommercialAuto_ScheduledModifier_PhysicalDamage AS (SELECT * FROM RTE_CommercialAuto WHERE Type='ScheduledMod' AND Scope='PhysicalDamage'),\n\tRTE_CommercialAuto_ScheduledModifier_Liability AS (SELECT * FROM RTE_CommercialAuto WHERE Type='ScheduledMod' AND Scope='Liability'),\n\tRTE_CommercialAuto_ExperienceModifier_PhysicalDamage AS (SELECT * FROM RTE_CommercialAuto WHERE Type='ExperienceMod' AND Scope='PhysicalDamage'),\n\tRTE_CommercialAuto_ExperienceModifier_Liability AS (SELECT * FROM RTE_CommercialAuto WHERE Type='ExperienceMod' AND Scope='Liability'),\n\tRTE_Property AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope\n\t\tFROM EXP_Property\n\t),\n\tRTE_Property_OtherMod_PreferredPropertyCreditFactor AS (SELECT * FROM RTE_Property WHERE Type='Other' AND Scope='PreferredProperty'),\n\tRTE_Property_OtherMod_MultiLocationCreditFactor AS (SELECT * FROM RTE_Property WHERE Type='Other' AND Scope='MultiLocation'),\n\tRTE_Property_Scheduled_Modifier AS (SELECT * FROM RTE_Property WHERE Type='IRPM' AND Scope='IRPMFactor'),\n\tRTE_Property_Transition_Modifier AS (SELECT * FROM RTE_Property WHERE Type='TransitionMod' AND (ISNULL(Scope) OR Scope = 'IRPM')),\n\tRTE_Property_OtherMod_MLPDC AS (SELECT * FROM RTE_Property WHERE Type='Other' AND Scope='MLPDC'),\n\tRTE_Property_OtherMod_StateOwnedPropertyCredit AS (SELECT * FROM RTE_Property WHERE Type='Other' AND Scope='StateOwned'),\n\tRTE_SBOPProperty AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope\n\t\tFROM EXP_SBOPProperty\n\t),\n\tRTE_SBOPProperty_OtherMod_PreferredProperty AS (SELECT * FROM RTE_SBOPProperty WHERE Type='Other' AND Scope='PreferredProperty'),\n\tRTE_SBOPProperty_OtherMod_Multilocation AS (SELECT * FROM RTE_SBOPProperty WHERE Type='Other' AND Scope='MultiLocation'),\n\tRTE_SBOPProperty_ScheduledMod AS (SELECT * FROM RTE_SBOPProperty WHERE Type = 'IRPM' AND  Scope = 'IRPMFactor'),\n\tRTE_SBOPProperty_TransitionMod AS (SELECT * FROM RTE_SBOPProperty WHERE Type='TransitionMod' AND ISNULL(Scope)),\n\tAGG_RowsToColumns_InlandMarine AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\tIRPM_Irpmfactor_IM, \n\t\tMax(IRPM_Irpmfactor_IM) AS o_IRPM_Irpmfactor_IM\n\t\tFROM EXP_InalandMarine\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tRTE_GeneralLiabilty AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope\n\t\tFROM EXP_GeneralLiability\n\t),\n\tRTE_GeneralLiabilty_ScheduledModifier AS (SELECT * FROM RTE_GeneralLiabilty WHERE Type='ScheduledMod' AND Scope='Liability'),\n\tRTE_GeneralLiabilty_ExperienceModifier AS (SELECT * FROM RTE_GeneralLiabilty WHERE Type='ExperienceMod' AND Scope='Liability'),\n\tRTE_GeneralLiabilty_TransitionModifier AS (SELECT * FROM RTE_GeneralLiabilty WHERE Type='TransitionMod' AND Scope='IRPM'),\n\tRTE_SBOPGeneralLiabilty AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tType,\n\t\tValue,\n\t\tScope\n\t\tFROM EXP_SBOPGeneralLiability\n\t),\n\tRTE_SBOPGeneralLiabilty_ScheduledModifier AS (SELECT * FROM RTE_SBOPGeneralLiabilty WHERE Type='ScheduledMod' AND Scope='Liability'),\n\tRTE_SBOPGeneralLiabilty_ExperienceModifier AS (SELECT * FROM RTE_SBOPGeneralLiabilty WHERE Type='ExperienceMod' AND Scope='Liability'),\n\tAGG_RowsToColumns_CommercialUmbrella AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\tScheduledmod_DCTUmbrella AS i_Scheduledmod_DCTUmbrella, \n\t\tmax(i_Scheduledmod_DCTUmbrella) AS o_Scheduledmod_DCTUmbrella\n\t\tFROM EXP_CommercialUmbrella\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tEXP_StandardizeModifier_EmploymentPracticesLiab AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\to_Scheduledmod_Liability_EMP AS i_Scheduledmod_Liability_EMP,\n\t\t1.0 AS OtherModifiedFactor_EMP,\n\t\ti_Scheduledmod_Liability_EMP AS ScheduleModifiedFactor_EMP,\n\t\t1.0 AS ExperienceModifiedFactor_EMP,\n\t\t1.0 AS TransitionFactor_EMP\n\t\tFROM AGG_RowsToColumns_EmploymentPracticesLiab\n\t),\n\tEXP_Standardizemodifier_Otherlines AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\t1.0 AS OtherModifiedFactor,\n\t\t1.0 AS ScheduleModifiedFactor,\n\t\t1.0 AS ExperienceModifiedFactor,\n\t\t1.0 AS TransitionFactor\n\t\tFROM AGG_RowsTocolumns_Otherlines\n\t),\n\tEXP_StandardizeModifier_Crime AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\to_Scheduledmod_Liability_Crime AS i_Scheduledmod_Liability_Crime,\n\t\t1.0 AS OtherModifiedFactor_crime,\n\t\ti_Scheduledmod_Liability_Crime AS ScheduleModifiedFactor_crime,\n\t\t1.0 AS ExperienceModifiedFactor_crime,\n\t\t1.0 AS TransitionFactor_crime\n\t\tFROM AGG_RowsToColumns_Crime\n\t),\n\tEXP_TransitionMod_Property AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_TransitionMod\n\t\tFROM RTE_Property_Transition_Modifier\n\t),\n\tEXP_SBOP_Property_TransitionMod AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_TransitionMod\n\t\tFROM RTE_SBOPProperty_TransitionMod\n\t),\n\tEXP_OtherMod_MLPDC AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_OtherMod_MLPDC\n\t\tFROM RTE_Property_OtherMod_MLPDC\n\t),\n\tEXP_OtherMod_StateOwnedPropertyCredit AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_OtherMod_StateOwnedPropertyCredit\n\t\tFROM RTE_Property_OtherMod_StateOwnedPropertyCredit\n\t),\n\tEXP_SBOPGL_ScheduledModifier AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_ScheduledModifier\n\t\tFROM RTE_SBOPGeneralLiabilty_ScheduledModifier\n\t),\n\tEXP_SBOPGL_ExperienceModifier AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_ExperienceModifier\n\t\tFROM RTE_SBOPGeneralLiabilty_ExperienceModifier\n\t),\n\tEXP_CA_SchMod_PhysicalDamage AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_Scheduledmod_PhyicalDamage\n\t\tFROM RTE_CommercialAuto_ScheduledModifier_PhysicalDamage\n\t),\n\tEXP_StandardizeModifier_CommercialUmbrella AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\to_Scheduledmod_DCTUmbrella AS i_Scheduledmod_DCTUmbrella,\n\t\t1.0 AS OtherModifiedFactor_CU,\n\t\ti_Scheduledmod_DCTUmbrella AS ScheduleModifiedFactor_CU,\n\t\t1.0 AS ExperienceModifiedFactor_CU,\n\t\t1.0 AS TransitionFactor_CU\n\t\tFROM AGG_RowsToColumns_CommercialUmbrella\n\t),\n\tEXP_GL_ScheduleModifer AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: iif(isnull(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_ScheduledModifer\n\t\tFROM RTE_GeneralLiabilty_ScheduledModifier\n\t),\n\tEXP_GL_ExperienceModifier AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_ExperienceModifier\n\t\tFROM RTE_GeneralLiabilty_ExperienceModifier\n\t),\n\tEXP_CA_SchMod_Liability AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_Scheduledmod_Liability\n\t\tFROM RTE_CommercialAuto_ScheduledModifier_Liability\n\t),\n\tEXP_StandardizeModifier_BusinessOwners AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\to_ScheduledMod_IRPM_BO AS i_ScheduledMod_IRPM_BO,\n\t\to_TransitionMod_BO_7x AS i_TransitionMod_BO_7x,\n\t\to_TransitionMod_BO_9x AS i_TransitionMod_BO_9x,\n\t\t1.0 AS OtherModifiedFactor_BO,\n\t\ti_ScheduledMod_IRPM_BO AS ScheduleModifiedFactor_BO,\n\t\t1.0 AS ExperienceModifiedFactor_BO,\n\t\t-- *INF*: IIF(i_TransitionMod_BO_9x=0 OR ISNULL(i_TransitionMod_BO_9x) OR i_TransitionMod_BO_9x=1,i_TransitionMod_BO_7x, i_TransitionMod_BO_9x\r\n\t\t-- )\r\n\t\t-- \r\n\t\t-- --Pick the 9x Template Transition factor if available else grab the 7.x. If either are not present then it is defaulted to 1.0 in EXP_Modifier_Null_Handle\n\t\tIFF(i_TransitionMod_BO_9x = 0 OR i_TransitionMod_BO_9x IS NULL OR i_TransitionMod_BO_9x = 1, i_TransitionMod_BO_7x, i_TransitionMod_BO_9x) AS TransitionFactor_BO\n\t\tFROM AGG_RowsToColuns_BusinessOwners\n\t),\n\tEXP_StandardizeModifier_InlandMrine AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\to_IRPM_Irpmfactor_IM AS i_IRPM_Irpmfactor_IM,\n\t\t1.0 AS OtherModifiedFactor_IM,\n\t\ti_IRPM_Irpmfactor_IM AS ScheduleModifiedFactor_IM,\n\t\t1.0 AS ExperienceModifiedFactor_IM,\n\t\t1.0 AS TransitionFactor_IM\n\t\tFROM AGG_RowsToColumns_InlandMarine\n\t),\n\tEXP_CA_ExpMod_PhysicalDamage AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_Experiencemod_PhysicalDamage\n\t\tFROM RTE_CommercialAuto_ExperienceModifier_PhysicalDamage\n\t),\n\tEXP_CA_ExpMod_Liability AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_ExperienceModifier_Liability\n\t\tFROM RTE_CommercialAuto_ExperienceModifier_Liability\n\t),\n\tEXP_OtherMod_PreferredPropertyCreditFactor AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_OtherMod_PreferredPropertyCreditFactor\n\t\tFROM RTE_Property_OtherMod_PreferredPropertyCreditFactor\n\t),\n\tEXP_OtherMod_MultiLocationCreditFactor AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_OtherMod_MultiLocationCreditFactor\n\t\tFROM RTE_Property_OtherMod_MultiLocationCreditFactor\n\t),\n\tEXP_GL_TransitionModifier AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_ExperienceModifier\n\t\tFROM RTE_GeneralLiabilty_TransitionModifier\n\t),\n\tEXP_ScheduledMod AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_Scheduledmod\n\t\tFROM RTE_Property_Scheduled_Modifier\n\t),\n\tEXP_OtherMod_PreferredProperty AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),i_Value)\n\t\tIFF(i_Value IS NULL, i_Value) AS o_OtherMod_PreferredProperty\n\t\tFROM RTE_SBOPProperty_OtherMod_PreferredProperty\n\t),\n\tEXP_OtherMod_Multilocation AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_OtherMod_Multilocation\n\t\tFROM RTE_SBOPProperty_OtherMod_Multilocation\n\t),\n\tEXP_SBOP_Property_ScheduledMod AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tValue AS i_Value,\n\t\t-- *INF*: IIF(ISNULL(i_Value),0,i_Value)\n\t\tIFF(i_Value IS NULL, 0, i_Value) AS o_ScheduledMod\n\t\tFROM RTE_SBOPProperty_ScheduledMod\n\t),\n\tAGG_RowsToColumns_TransitionMod AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_TransitionMod AS i_TransitionMod, \n\t\tMax(i_TransitionMod) AS o_TransitionMod, \n\t\t0 AS o_ScheduledMod, \n\t\t0 AS o_OtherModPreferredPropertyCreditFactor, \n\t\t0 AS o_OtherModMultiLocationCredit, \n\t\t0 AS o_OtherModMLPDC, \n\t\t0 AS o_OtherModStateOwnedPropertyCredit\n\t\tFROM EXP_TransitionMod_Property\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_TransitionMod_SBOPProperty AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_TransitionMod AS i_TransitionMod, \n\t\tMax(i_TransitionMod) AS o_TransitionMod, \n\t\t0 AS o_ScheduledMod, \n\t\t0 AS o_OtherMod_PreferredProperty, \n\t\t0 AS o_OtherMod_Multilocation\n\t\tFROM EXP_SBOP_Property_TransitionMod\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_OtherMod_MLPDC AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_OtherMod_MLPDC AS i_OtherMod_MLPDC, \n\t\tMax(i_OtherMod_MLPDC) AS o_OtherMod_MLPDC, \n\t\t0 AS o_OtherModPreferredPropertyCreditFactor, \n\t\t0 AS o_OtherMod_MultiLocationCreditFactor, \n\t\t0 AS o_ScheduledMod, \n\t\t0 AS o_TransitionMod, \n\t\t0 AS o_OtherModStateOwnedPropertyCredit\n\t\tFROM EXP_OtherMod_MLPDC\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_SBOPGL_ScheduleModifier AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_ScheduledModifier AS i_ScheduledModifier, \n\t\tMAX(i_ScheduledModifier) AS o_ScheduledModifier, \n\t\t0 AS o_ExperienceModifier\n\t\tFROM EXP_SBOPGL_ScheduledModifier\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_SBOPGL_ExperienceModifier AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_ExperienceModifier AS i_ExperienceModifier, \n\t\tMax(i_ExperienceModifier) AS o_ExperienceModifier, \n\t\t0 AS o_ScheduledModifier\n\t\tFROM EXP_SBOPGL_ExperienceModifier\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColuns_CA_SchMod_PhysicalDamage AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_Scheduledmod_PhyicalDamage AS i_Scheduledmod_PhyicalDamage, \n\t\tMAX(i_Scheduledmod_PhyicalDamage) AS o_Scheduledmod_PhyicalDamage, \n\t\t0 AS o_Scheduledmod_Liability, \n\t\t0 AS o_Experiencemod_PhysicalDamage, \n\t\t0 AS o_Experiencemod_Liability\n\t\tFROM EXP_CA_SchMod_PhysicalDamage\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColuns_CA_SchMod_Liability AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_Scheduledmod_Liability AS i_Scheduledmod_Liability, \n\t\tMax(i_Scheduledmod_Liability) AS o_Scheduledmod_Liability, \n\t\t0 AS o_Scheduledmod_PhysicalDamage, \n\t\t0 AS o_Experiencemod_PhysicalDamage, \n\t\t0 AS o_Experiencemod_Liability\n\t\tFROM EXP_CA_SchMod_Liability\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColuns_CA_ExpMod_PhysicalDamage AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_Experiencemod_PhysicalDamage AS i_Experiencemod_PhysicalDamage, \n\t\tMax(i_Experiencemod_PhysicalDamage) AS o_Experiencemod_PhysicalDamage, \n\t\t0 AS o_Scheduledmod_PhysicalDamage, \n\t\t0 AS o_Scheduledmod_Liability, \n\t\t0 AS o_Experiencemod_Liability\n\t\tFROM EXP_CA_ExpMod_PhysicalDamage\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColuns_CA_ExpMod_Liability AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_ExperienceModifier_Liability AS i_ExperienceModifier_Liability, \n\t\tMax(i_ExperienceModifier_Liability) AS o_ExperienceModifier_Liability, \n\t\t0 AS o_Scheduledmod_PhysicalDamage, \n\t\t0 AS o_Scheduledmod_Liability, \n\t\t0 AS o_Experiencemod_PhysicalDamage\n\t\tFROM EXP_CA_ExpMod_Liability\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_OtherMod_PreferredProperty AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_OtherMod_PreferredPropertyCreditFactor AS i_OtherMod_PreferredPropertyCreditFactor, \n\t\tMax(i_OtherMod_PreferredPropertyCreditFactor) AS o_OtherMod_PreferredPropertyCreditFactor, \n\t\t0 AS o_OtherModMultiLocationCredit, \n\t\t0 AS o_OtherModMLPDC, \n\t\t0 AS o_ScheduledMod, \n\t\t0 AS o_TransitionMod, \n\t\t0 AS o_OtherModStateOwnedPropertyCredit\n\t\tFROM EXP_OtherMod_PreferredPropertyCreditFactor\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_OtherMod_MultiLocationCredit AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_OtherMod_MultiLocationCreditFactor AS i_OtherMod_MultiLocationCreditFactor, \n\t\tMax(i_OtherMod_MultiLocationCreditFactor) AS o_OtherMod_MultiLocationCreditFactor, \n\t\t0 AS o_OtherModPreferredPropertyCreditFactor, \n\t\t0 AS o_OtherModMLPDC, \n\t\t0 AS o_ScheduledMod, \n\t\t0 AS o_TransitionMod, \n\t\t0 AS o_OtherModStateOwnedPropertyCredit\n\t\tFROM EXP_OtherMod_MultiLocationCreditFactor\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_ScheduledMod AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_Scheduledmod AS i_ScheduledMod, \n\t\tMax(i_ScheduledMod) AS o_ScheduledMod, \n\t\t0 AS o_OtherModPreferredPropertyCreditFactor, \n\t\t0 AS o_OtherModMultiLocationCredit, \n\t\t0 AS o_OtherModMLPDC, \n\t\t0 AS o_TransitionMod, \n\t\t0 AS o_OtherModStateOwnedPropertyCredit\n\t\tFROM EXP_ScheduledMod\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_OtherMod_StateOwnedPropertyCredit AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_OtherMod_StateOwnedPropertyCredit AS i_OtherMod_StateOwnedPropertyCredit, \n\t\tMax(i_OtherMod_StateOwnedPropertyCredit) AS o_OtherMod_StateOwnedPropertyCredit, \n\t\t0 AS o_OtherModPreferredPropertCredit, \n\t\t0 AS o_OtherModMultiLocationCredit, \n\t\t0 AS o_OtherModMLPDC, \n\t\t0 AS o_ScheduledMod, \n\t\t0 AS o_TransitionMod\n\t\tFROM EXP_OtherMod_StateOwnedPropertyCredit\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_OtherMod_PreferredProperty_SBOPProperty AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_OtherMod_PreferredProperty AS i_OtherMod_PreferredProperty, \n\t\tMax(i_OtherMod_PreferredProperty) AS o_OtherMod_PreferredProperty, \n\t\t0 AS o_OtherMod_Multilocation, \n\t\t0 AS o_ScheduledMod, \n\t\t0 AS o_TransitionMod\n\t\tFROM EXP_OtherMod_PreferredProperty\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_OtherMod_Multilocation_SBOPProperty AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_OtherMod_Multilocation AS i_OtherMod_Multilocation, \n\t\tMax(i_OtherMod_Multilocation) AS o_OtherMod_Multilocation, \n\t\t0 AS o_OtherMod_PreferredProperty, \n\t\t0 AS o_ScheduledMod, \n\t\t0 AS o_TransitionMod\n\t\tFROM EXP_OtherMod_Multilocation\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_ScheduledMod_SBOPProperty AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_ScheduledMod AS i_ScheduledMod, \n\t\tMax(i_ScheduledMod) AS o_ScheduledMod, \n\t\t0 AS o_OtherMod_PreferredProperty, \n\t\t0 AS o_OtherMod_Multilocation, \n\t\t0 AS o_TransitionMod\n\t\tFROM EXP_SBOP_Property_ScheduledMod\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_GL_TransitionModifier AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_ExperienceModifier AS i_TransitionModifier, \n\t\tMax(i_TransitionModifier) AS o_TransitionModifier, \n\t\t0 AS o_ExperienceModifier, \n\t\t0 AS o_ScheduledModifier\n\t\tFROM EXP_GL_TransitionModifier\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_GL_ScheduleModifier AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_ScheduledModifer AS i_Scheduledmod_Liability_GL, \n\t\t0 AS o_TransitionModifier, \n\t\t0 AS o_ExperienceModifier, \n\t\tmax(i_Scheduledmod_Liability_GL) AS o_Scheduledmod_Liability_GL\n\t\tFROM EXP_GL_ScheduleModifer\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAGG_RowsToColumns_GL_ExperienceModifier AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_ExperienceModifier AS i_ExperienceModifier, \n\t\t0 AS o_TransitionModifier, \n\t\tMax(i_ExperienceModifier) AS o_ExperienceModifier, \n\t\t0 AS o_ScheduledModifier\n\t\tFROM EXP_GL_ExperienceModifier\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tUN_GL_Modifier AS (\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, o_Scheduledmod_Liability_GL AS ScheduledModifier, o_ExperienceModifier AS ExperienceModifier, o_TransitionModifier AS TransitionModifier\n\t\tFROM AGG_RowsToColumns_GL_ScheduleModifier\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, o_ScheduledModifier AS ScheduledModifier, o_ExperienceModifier AS ExperienceModifier, o_TransitionModifier AS TransitionModifier\n\t\tFROM AGG_RowsToColumns_GL_ExperienceModifier\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, o_ScheduledModifier AS ScheduledModifier, o_ExperienceModifier AS ExperienceModifier, o_TransitionModifier AS TransitionModifier\n\t\tFROM AGG_RowsToColumns_GL_TransitionModifier\n\t),\n\tUN_SBOPGL_Modifier AS (\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, o_ScheduledModifier AS ScheduledModifier, o_ExperienceModifier AS ExperienceModifier\n\t\tFROM AGG_RowsToColumns_SBOPGL_ScheduleModifier\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, o_ScheduledModifier AS ScheduledModifier, o_ExperienceModifier AS ExperienceModifier\n\t\tFROM AGG_RowsToColumns_SBOPGL_ExperienceModifier\n\t),\n\tUN_CommercialAuto AS (\n\t\tSELECT PremiumTransactionID AS PremiumTransactionId, PremiumTransactionAKID AS PremiumTransactionAKId, o_Scheduledmod_PhyicalDamage AS Scheduledmod_PhysicalDamage, o_Scheduledmod_Liability AS Scheduledmod_Liability, o_Experiencemod_PhysicalDamage AS Experiencemod_PhysicalDamage, o_Experiencemod_Liability AS Experiencemod_Liability\n\t\tFROM AGG_RowsToColuns_CA_SchMod_PhysicalDamage\n\t\tUNION\n\t\tSELECT PremiumTransactionID AS PremiumTransactionId, PremiumTransactionAKID AS PremiumTransactionAKId, o_Scheduledmod_PhysicalDamage AS Scheduledmod_PhysicalDamage, o_Scheduledmod_Liability AS Scheduledmod_Liability, o_Experiencemod_PhysicalDamage AS Experiencemod_PhysicalDamage, o_Experiencemod_Liability AS Experiencemod_Liability\n\t\tFROM AGG_RowsToColuns_CA_SchMod_Liability\n\t\tUNION\n\t\tSELECT PremiumTransactionID AS PremiumTransactionId, PremiumTransactionAKID AS PremiumTransactionAKId, o_Scheduledmod_PhysicalDamage AS Scheduledmod_PhysicalDamage, o_Scheduledmod_Liability AS Scheduledmod_Liability, o_Experiencemod_PhysicalDamage AS Experiencemod_PhysicalDamage, o_Experiencemod_Liability AS Experiencemod_Liability\n\t\tFROM AGG_RowsToColuns_CA_ExpMod_PhysicalDamage\n\t\tUNION\n\t\tSELECT PremiumTransactionID AS PremiumTransactionId, PremiumTransactionAKID AS PremiumTransactionAKId, o_Scheduledmod_PhysicalDamage AS Scheduledmod_PhysicalDamage, o_Scheduledmod_Liability AS Scheduledmod_Liability, o_Experiencemod_PhysicalDamage AS Experiencemod_PhysicalDamage, o_ExperienceModifier_Liability AS Experiencemod_Liability\n\t\tFROM AGG_RowsToColuns_CA_ExpMod_Liability\n\t),\n\tUN_SBOPProperty AS (\n\t\tSELECT PremiumTransactionID AS PremiumTransactionId, PremiumTransactionAKID AS PremiumTransactionAKId, o_OtherMod_PreferredProperty AS OtherMod_PreferredProperty, o_OtherMod_Multilocation AS OtherMod_Multilocation, o_ScheduledMod AS ScheduledMod, o_TransitionMod AS TransitionMod\n\t\tFROM AGG_RowsToColumns_OtherMod_PreferredProperty_SBOPProperty\n\t\tUNION\n\t\tSELECT PremiumTransactionID AS PremiumTransactionId, PremiumTransactionAKID AS PremiumTransactionAKId, o_OtherMod_PreferredProperty AS OtherMod_PreferredProperty, o_OtherMod_Multilocation AS OtherMod_Multilocation, o_ScheduledMod AS ScheduledMod, o_TransitionMod AS TransitionMod\n\t\tFROM AGG_RowsToColumns_OtherMod_Multilocation_SBOPProperty\n\t\tUNION\n\t\tSELECT PremiumTransactionID AS PremiumTransactionId, PremiumTransactionAKID AS PremiumTransactionAKId, o_OtherMod_PreferredProperty AS OtherMod_PreferredProperty, o_OtherMod_Multilocation AS OtherMod_Multilocation, o_ScheduledMod AS ScheduledMod, o_TransitionMod AS TransitionMod\n\t\tFROM AGG_RowsToColumns_ScheduledMod_SBOPProperty\n\t\tUNION\n\t\tSELECT PremiumTransactionID AS PremiumTransactionId, PremiumTransactionAKID AS PremiumTransactionAKId, o_OtherMod_PreferredProperty AS OtherMod_PreferredProperty, o_OtherMod_Multilocation AS OtherMod_Multilocation, o_ScheduledMod AS ScheduledMod, o_TransitionMod AS TransitionMod\n\t\tFROM AGG_RowsToColumns_TransitionMod_SBOPProperty\n\t),\n\tUnion_Property AS (\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, o_OtherMod_PreferredPropertyCreditFactor AS OtherMod_PreferredProperyCredit, o_OtherModMultiLocationCredit AS OtherMod_MultiLocationCredit, o_OtherModMLPDC AS OtherMod_MLPDC, o_ScheduledMod AS ScheduledMod, o_TransitionMod AS TransitionMod, o_OtherModStateOwnedPropertyCredit AS OtherMod_StateOwnedPropertyCredit\n\t\tFROM AGG_RowsToColumns_OtherMod_PreferredProperty\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, o_OtherModPreferredPropertyCreditFactor AS OtherMod_PreferredProperyCredit, o_OtherMod_MultiLocationCreditFactor AS OtherMod_MultiLocationCredit, o_OtherModMLPDC AS OtherMod_MLPDC, o_ScheduledMod AS ScheduledMod, o_TransitionMod AS TransitionMod, o_OtherModStateOwnedPropertyCredit AS OtherMod_StateOwnedPropertyCredit\n\t\tFROM AGG_RowsToColumns_OtherMod_MultiLocationCredit\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, o_OtherModPreferredPropertyCreditFactor AS OtherMod_PreferredProperyCredit, o_OtherMod_MultiLocationCreditFactor AS OtherMod_MultiLocationCredit, o_OtherMod_MLPDC AS OtherMod_MLPDC, o_ScheduledMod AS ScheduledMod, o_TransitionMod AS TransitionMod, o_OtherModStateOwnedPropertyCredit AS OtherMod_StateOwnedPropertyCredit\n\t\tFROM AGG_RowsToColumns_OtherMod_MLPDC\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, o_OtherModPreferredPropertyCreditFactor AS OtherMod_PreferredProperyCredit, o_OtherModMultiLocationCredit AS OtherMod_MultiLocationCredit, o_OtherModMLPDC AS OtherMod_MLPDC, o_ScheduledMod AS ScheduledMod, o_TransitionMod AS TransitionMod, o_OtherModStateOwnedPropertyCredit AS OtherMod_StateOwnedPropertyCredit\n\t\tFROM AGG_RowsToColumns_ScheduledMod\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, o_OtherModPreferredPropertyCreditFactor AS OtherMod_PreferredProperyCredit, o_OtherModMultiLocationCredit AS OtherMod_MultiLocationCredit, o_OtherModMLPDC AS OtherMod_MLPDC, o_ScheduledMod AS ScheduledMod, o_TransitionMod AS TransitionMod, o_OtherModStateOwnedPropertyCredit AS OtherMod_StateOwnedPropertyCredit\n\t\tFROM AGG_RowsToColumns_TransitionMod\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, o_OtherModPreferredPropertCredit AS OtherMod_PreferredProperyCredit, o_OtherModMultiLocationCredit AS OtherMod_MultiLocationCredit, o_OtherModMLPDC AS OtherMod_MLPDC, o_ScheduledMod AS ScheduledMod, o_TransitionMod AS TransitionMod, o_OtherMod_StateOwnedPropertyCredit AS OtherMod_StateOwnedPropertyCredit\n\t\tFROM AGG_RowsToColumns_OtherMod_StateOwnedPropertyCredit\n\t),\n\tAgg_RowToColumn_CommercialAuto AS (\n\t\tSELECT\n\t\tPremiumTransactionId, \n\t\tPremiumTransactionAKId, \n\t\tScheduledmod_PhysicalDamage AS i_Scheduledmod_PhysicalDamage, \n\t\tMax(i_Scheduledmod_PhysicalDamage) AS o_Scheduledmod_PhysicalDamage, \n\t\tScheduledmod_Liability AS i_Scheduledmod_Liability, \n\t\tMax(i_Scheduledmod_Liability) AS o_Scheduledmod_Liability, \n\t\tExperiencemod_PhysicalDamage AS i_Experiencemod_PhysicalDamage, \n\t\tMax(i_Experiencemod_PhysicalDamage) AS o_Experiencemod_PhysicalDamage, \n\t\tExperiencemod_Liability AS i_Experiencemod_Liability, \n\t\tMax(i_Experiencemod_Liability) AS o_Experiencemod_Liability\n\t\tFROM UN_CommercialAuto\n\t\tGROUP BY PremiumTransactionId\n\t),\n\tAgg_RowtoColumn_Property AS (\n\t\tSELECT\n\t\tPremiumTransactionID AS PremiumTransactionId, \n\t\tPremiumTransactionAKID AS PremiumTransactionAKId, \n\t\tOtherMod_PreferredProperyCredit AS i_OtherModPreferredPropertyCreditFactor, \n\t\tMax(i_OtherModPreferredPropertyCreditFactor) AS o_OtherModPreferredPropertyCreditFactor, \n\t\tOtherMod_MultiLocationCredit AS i_OtherModMultiLocationCredit, \n\t\tMax(i_OtherModMultiLocationCredit) AS o_OtherModMultiLocationCredit, \n\t\tOtherMod_MLPDC AS i_OtherMod_MLPDC, \n\t\tMax(i_OtherMod_MLPDC) AS o_OtherMod_MLPDC, \n\t\tScheduledMod AS i_ScheduledMod, \n\t\tMax(i_ScheduledMod) AS o_ScheduledMod, \n\t\tTransitionMod AS i_TransitionMod, \n\t\tMax(i_TransitionMod) AS o_TransitionMod, \n\t\tOtherMod_StateOwnedPropertyCredit AS i_OtherMod_StateOwnedPropertyCredit, \n\t\tMax(i_OtherMod_StateOwnedPropertyCredit) AS o_OtherModStateOwnedPropertyCredit\n\t\tFROM Union_Property\n\t\tGROUP BY PremiumTransactionId\n\t),\n\tAgg_RowToColumn_GeneralLiability AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\tScheduledModifier AS i_ScheduledModifier, \n\t\tMax(i_ScheduledModifier) AS o_ScheduledModifier, \n\t\tExperienceModifier AS i_ExperienceModifier, \n\t\tMax(i_ExperienceModifier) AS o_ExperienceModifier, \n\t\tTransitionModifier AS i_TransitionModifier, \n\t\tMax(i_TransitionModifier) AS o_TransitionModifier\n\t\tFROM UN_GL_Modifier\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAgg_RowToColumn_SBOPGeneralLiability AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\tScheduledModifier AS i_ScheduledModifier, \n\t\tMax(i_ScheduledModifier) AS o_ScheduledModifier, \n\t\tExperienceModifier AS i_ExperienceModifier, \n\t\tMax(i_ExperienceModifier) AS o_ExperienceModifier\n\t\tFROM UN_SBOPGL_Modifier\n\t\tGROUP BY PremiumTransactionID\n\t),\n\tAgg_RowToColumn_SBOPProperty AS (\n\t\tSELECT\n\t\tPremiumTransactionId, \n\t\tPremiumTransactionAKId, \n\t\tOtherMod_PreferredProperty AS i_OtherMod_PreferredProperty, \n\t\tMax(i_OtherMod_PreferredProperty) AS o_OtherMod_PreferredProperty, \n\t\tOtherMod_Multilocation AS i_OtherMod_Multilocation, \n\t\tMax(i_OtherMod_Multilocation) AS o_OtherMod_Multilocation, \n\t\tScheduledMod AS i_ScheduledMod, \n\t\tMax(i_ScheduledMod) AS o_ScheduledMod, \n\t\tTransitionMod AS i_TransitionMod, \n\t\tMax(i_TransitionMod) AS o_TransitionMod\n\t\tFROM UN_SBOPProperty\n\t\tGROUP BY PremiumTransactionId\n\t),\n\tEXP_StandardizeModifier_SBOPProperty AS (\n\t\tSELECT\n\t\tPremiumTransactionId AS PremiumTransactionID,\n\t\tPremiumTransactionAKId AS PremiumTransactionAKID,\n\t\to_OtherMod_PreferredProperty AS i_PreferredPropertyCreditFactor,\n\t\to_OtherMod_Multilocation AS i_MultiLocationCreditFactor,\n\t\to_ScheduledMod AS i_ScheduledMod,\n\t\to_TransitionMod AS i_TransitionMod,\n\t\ti_PreferredPropertyCreditFactor AS v_PreferredPropertyCreditFactor,\n\t\ti_MultiLocationCreditFactor AS v_MultiLocationCreditFactor,\n\t\t-- *INF*: DECODE(TRUE,ISNULL(v_PreferredPropertyCreditFactor) OR v_PreferredPropertyCreditFactor=0.0,1.0,\r\n\t\t--                                     ISNULL(v_MultiLocationCreditFactor) OR v_MultiLocationCreditFactor=0.0,1.0,\r\n\t\t--                                      1 - (1 - v_PreferredPropertyCreditFactor) - (1 - v_MultiLocationCreditFactor))\r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \n\t\tDECODE(TRUE,\n\t\tv_PreferredPropertyCreditFactor IS NULL OR v_PreferredPropertyCreditFactor = 0.0, 1.0,\n\t\tv_MultiLocationCreditFactor IS NULL OR v_MultiLocationCreditFactor = 0.0, 1.0,\n\t\t1 - ( 1 - v_PreferredPropertyCreditFactor ) - ( 1 - v_MultiLocationCreditFactor )) AS OtherModifiedFactor,\n\t\ti_ScheduledMod AS ScheduleModifiedFactor,\n\t\t1.0 AS ExperienceModifiedFactor,\n\t\ti_TransitionMod AS TransitionFactor\n\t\tFROM Agg_RowToColumn_SBOPProperty\n\t),\n\tEXP_StandardizeModifier_SBOPGeneralLiability AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\to_ScheduledModifier AS i_Scheduledmod_Liability_SBOPGL,\n\t\to_ExperienceModifier AS i_Experiencemod_Liability_SBOPGL,\n\t\t1.0 AS OtherModifiedFactor_SGL,\n\t\ti_Scheduledmod_Liability_SBOPGL AS ScheduleModifiedFactor_SGL,\n\t\ti_Experiencemod_Liability_SBOPGL AS ExperienceModifiedFactor_SGL,\n\t\t1.0 AS TransitionFactor_SGL\n\t\tFROM Agg_RowToColumn_SBOPGeneralLiability\n\t),\n\tEXP_StandardizeModifier_GeneralLiability AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\to_ScheduledModifier AS i_Scheduledmod_Liability_GL,\n\t\to_ExperienceModifier AS i_Experiencemod_Liability_GL,\n\t\to_TransitionModifier AS i_TransitionMod_Liability_GL,\n\t\t1.0 AS OtherModifiedFactor_GL,\n\t\ti_Scheduledmod_Liability_GL AS ScheduleModifiedFactor_GL,\n\t\ti_Experiencemod_Liability_GL AS ExperienceModifiedFactor_GL,\n\t\ti_TransitionMod_Liability_GL AS TransitionModifierFactor_GL\n\t\tFROM Agg_RowToColumn_GeneralLiability\n\t),\n\tEXP_StandardizeModifier_CommercialAuto AS (\n\t\tSELECT\n\t\tPremiumTransactionId AS PremiumTransactionID,\n\t\tPremiumTransactionAKId AS PremiumTransactionAKID,\n\t\to_Scheduledmod_PhysicalDamage AS i_Scheduledmod_PhysicalDamage,\n\t\to_Scheduledmod_Liability AS i_Scheduledmod_Liability,\n\t\to_Experiencemod_PhysicalDamage AS i_Experiencemod_PhysicalDamage,\n\t\to_Experiencemod_Liability AS i_Experiencemod_Liability,\n\t\t1.0 AS o_OtherModifiedFactor,\n\t\t-- *INF*: IIF(ISNULL(i_Scheduledmod_PhysicalDamage)  or  i_Scheduledmod_PhysicalDamage=0,(IIF(ISNULL(i_Scheduledmod_Liability) or\r\n\t\t-- i_Scheduledmod_Liability=0 , 1.0,i_Scheduledmod_Liability)), i_Scheduledmod_PhysicalDamage)\r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \n\t\tIFF(i_Scheduledmod_PhysicalDamage IS NULL OR i_Scheduledmod_PhysicalDamage = 0, ( IFF(i_Scheduledmod_Liability IS NULL OR i_Scheduledmod_Liability = 0, 1.0, i_Scheduledmod_Liability) ), i_Scheduledmod_PhysicalDamage) AS o_ScheduleModifiedFactor,\n\t\t-- *INF*: IIF(ISNULL(i_Experiencemod_PhysicalDamage)  or  i_Experiencemod_PhysicalDamage=0,(IIF(ISNULL(i_Experiencemod_Liability) or\r\n\t\t-- i_Experiencemod_Liability=0 , 1.0,i_Experiencemod_Liability)), i_Experiencemod_PhysicalDamage)\n\t\tIFF(i_Experiencemod_PhysicalDamage IS NULL OR i_Experiencemod_PhysicalDamage = 0, ( IFF(i_Experiencemod_Liability IS NULL OR i_Experiencemod_Liability = 0, 1.0, i_Experiencemod_Liability) ), i_Experiencemod_PhysicalDamage) AS o_ExperienceModifiedFactor,\n\t\t1.0 AS o_TransitionFactor\n\t\tFROM Agg_RowToColumn_CommercialAuto\n\t),\n\tEXP_StandardizeModifier_Property AS (\n\t\tSELECT\n\t\tPremiumTransactionId AS PremiumTransactionID,\n\t\tPremiumTransactionAKId AS PremiumTransactionAKID,\n\t\to_OtherModPreferredPropertyCreditFactor AS i_OtherMod_PreferredPropertyCreditFactor,\n\t\to_OtherModMultiLocationCredit AS i_OtherModMultiLocationCreditFactor,\n\t\to_OtherMod_MLPDC AS i_OtherMod_MLPDC,\n\t\to_OtherModStateOwnedPropertyCredit AS i_OtherModStateOwnedPropertyCredit,\n\t\to_ScheduledMod AS i_ScheduledMod,\n\t\to_TransitionMod AS i_TransitionMod,\n\t\ti_OtherMod_PreferredPropertyCreditFactor AS v_PreferredPropertyCreditFactor,\n\t\ti_OtherModMultiLocationCreditFactor AS v_MultiLocationCreditFactor,\n\t\ti_OtherMod_MLPDC AS v_MLPDC,\n\t\t-- *INF*: DECODE(TRUE,\r\n\t\t-- ISNULL(i_OtherModStateOwnedPropertyCredit),1.0,\r\n\t\t-- i_OtherModStateOwnedPropertyCredit = 0.0, 1.0,\r\n\t\t-- i_OtherModStateOwnedPropertyCredit)\r\n\t\t-- --default value to 1.0 when null or absent to ensure that OtherModifier doesn't evaluate to 1 and miss other contributors\n\t\tDECODE(TRUE,\n\t\ti_OtherModStateOwnedPropertyCredit IS NULL, 1.0,\n\t\ti_OtherModStateOwnedPropertyCredit = 0.0, 1.0,\n\t\ti_OtherModStateOwnedPropertyCredit) AS v_OtherModStateOwnedPropertyCredit,\n\t\t-- *INF*: DECODE(TRUE, ISNULL(v_PreferredPropertyCreditFactor) OR   v_PreferredPropertyCreditFactor=0.0 ,1.0,                                                                                                       \r\n\t\t--                                       ISNULL(v_MultiLocationCreditFactor) OR  v_MultiLocationCreditFactor=0.0,1.0,\r\n\t\t-- \t                                 ISNULL(v_MLPDC) OR  v_MLPDC=0.0,1.0,\r\n\t\t--                                        1 - ( 1 - v_PreferredPropertyCreditFactor) -  (1 - v_MultiLocationCreditFactor) - (1-v_MLPDC)- (1-v_OtherModStateOwnedPropertyCredit))       \r\n\t\t-- -- we do not default null SPOC to 1 because it is not present except on BLDG1 leading to other modifier not being calculated for the presence of other modifiers                               \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \r\n\t\t-- \n\t\tDECODE(TRUE,\n\t\tv_PreferredPropertyCreditFactor IS NULL OR v_PreferredPropertyCreditFactor = 0.0, 1.0,\n\t\tv_MultiLocationCreditFactor IS NULL OR v_MultiLocationCreditFactor = 0.0, 1.0,\n\t\tv_MLPDC IS NULL OR v_MLPDC = 0.0, 1.0,\n\t\t1 - ( 1 - v_PreferredPropertyCreditFactor ) - ( 1 - v_MultiLocationCreditFactor ) - ( 1 - v_MLPDC ) - ( 1 - v_OtherModStateOwnedPropertyCredit )) AS OtherModifiedFactor,\n\t\ti_ScheduledMod AS ScheduleModifiedFactor,\n\t\t1.0 AS ExperienceModifiedFactor,\n\t\ti_TransitionMod AS TransitionFactor\n\t\tFROM Agg_RowtoColumn_Property\n\t),\n\tUN_all_InsuranceLines_new AS (\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, OtherModifiedFactor_BO AS OtherModifiedFactor, ScheduleModifiedFactor_BO AS ScheduleModifiedFactor, ExperienceModifiedFactor_BO AS ExperienceModifiedFactor, TransitionFactor_BO AS TransitionFactor\n\t\tFROM EXP_StandardizeModifier_BusinessOwners\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, o_OtherModifiedFactor AS OtherModifiedFactor, o_ScheduleModifiedFactor AS ScheduleModifiedFactor, o_ExperienceModifiedFactor AS ExperienceModifiedFactor, o_TransitionFactor AS TransitionFactor\n\t\tFROM EXP_StandardizeModifier_CommercialAuto\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, OtherModifiedFactor_crime AS OtherModifiedFactor, ScheduleModifiedFactor_crime AS ScheduleModifiedFactor, ExperienceModifiedFactor_crime AS ExperienceModifiedFactor, TransitionFactor_crime AS TransitionFactor\n\t\tFROM EXP_StandardizeModifier_Crime\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, OtherModifiedFactor, ScheduleModifiedFactor, ExperienceModifiedFactor, TransitionFactor\n\t\tFROM EXP_StandardizeModifier_Property\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, OtherModifiedFactor_GL AS OtherModifiedFactor, ScheduleModifiedFactor_GL AS ScheduleModifiedFactor, ExperienceModifiedFactor_GL AS ExperienceModifiedFactor, TransitionModifierFactor_GL AS TransitionFactor\n\t\tFROM EXP_StandardizeModifier_GeneralLiability\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, OtherModifiedFactor_EMP AS OtherModifiedFactor, ScheduleModifiedFactor_EMP AS ScheduleModifiedFactor, ExperienceModifiedFactor_EMP AS ExperienceModifiedFactor, TransitionFactor_EMP AS TransitionFactor\n\t\tFROM EXP_StandardizeModifier_EmploymentPracticesLiab\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, OtherModifiedFactor_IM AS OtherModifiedFactor, ScheduleModifiedFactor_IM AS ScheduleModifiedFactor, ExperienceModifiedFactor_IM AS ExperienceModifiedFactor, TransitionFactor_IM AS TransitionFactor\n\t\tFROM EXP_StandardizeModifier_InlandMrine\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, OtherModifiedFactor_SGL AS OtherModifiedFactor, ScheduleModifiedFactor_SGL AS ScheduleModifiedFactor, ExperienceModifiedFactor_SGL AS ExperienceModifiedFactor, TransitionFactor_SGL AS TransitionFactor\n\t\tFROM EXP_StandardizeModifier_SBOPGeneralLiability\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, OtherModifiedFactor, ScheduleModifiedFactor, ExperienceModifiedFactor, TransitionFactor\n\t\tFROM EXP_StandardizeModifier_SBOPProperty\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, OtherModifiedFactor, ScheduleModifiedFactor, ExperienceModifiedFactor, TransitionFactor\n\t\tFROM EXP_Standardizemodifier_Otherlines\n\t\tUNION\n\t\tSELECT PremiumTransactionID, PremiumTransactionAKID, OtherModifiedFactor_CU AS OtherModifiedFactor, ScheduleModifiedFactor_CU AS ScheduleModifiedFactor, ExperienceModifiedFactor_CU AS ExperienceModifiedFactor, TransitionFactor_CU AS TransitionFactor\n\t\tFROM EXP_StandardizeModifier_CommercialUmbrella\n\t),\n\tEXP_Modifier_Null_Handle AS (\n\t\tSELECT\n\t\tPremiumTransactionID,\n\t\tPremiumTransactionAKID,\n\t\tOtherModifiedFactor AS i_OtherModifiedFactor,\n\t\t-- *INF*: iif(isnull(i_OtherModifiedFactor) or i_OtherModifiedFactor=0.0,1.0,i_OtherModifiedFactor)\n\t\tIFF(i_OtherModifiedFactor IS NULL OR i_OtherModifiedFactor = 0.0, 1.0, i_OtherModifiedFactor) AS o_OtherModifiedFactor,\n\t\tScheduleModifiedFactor AS i_ScheduleModifiedFactor,\n\t\t-- *INF*: iif(isnull(i_ScheduleModifiedFactor) or i_ScheduleModifiedFactor=0.0,1.0,i_ScheduleModifiedFactor)\n\t\tIFF(i_ScheduleModifiedFactor IS NULL OR i_ScheduleModifiedFactor = 0.0, 1.0, i_ScheduleModifiedFactor) AS o_ScheduleModifiedFactor,\n\t\tExperienceModifiedFactor AS i_ExperienceModifiedFactor,\n\t\t-- *INF*: iif(isnull(i_ExperienceModifiedFactor) or i_ExperienceModifiedFactor=0.0,1.0,i_ExperienceModifiedFactor)\n\t\tIFF(i_ExperienceModifiedFactor IS NULL OR i_ExperienceModifiedFactor = 0.0, 1.0, i_ExperienceModifiedFactor) AS o_ExperienceModifiedFactor,\n\t\tTransitionFactor AS i_TransitionFactor,\n\t\t-- *INF*: iif(isnull(i_TransitionFactor) or i_TransitionFactor=0.0,1.0,i_TransitionFactor)\n\t\tIFF(i_TransitionFactor IS NULL OR i_TransitionFactor = 0.0, 1.0, i_TransitionFactor) AS o_TransitionFactor\n\t\tFROM UN_all_InsuranceLines_new\n\t),\n\tMplt_RatingModifer_Target AS (\n\t\tSELECT\n\t\tPremiumTransactionID, \n\t\tPremiumTransactionAKID, \n\t\to_OtherModifiedFactor AS OtherModifiedFactor, \n\t\to_ScheduleModifiedFactor AS ScheduleModifiedFactor, \n\t\to_ExperienceModifiedFactor AS ExperienceModifiedFactor, \n\t\to_TransitionFactor AS TransitionFactor\n\t\tFROM EXP_Modifier_Null_Handle\n\t),\n),\nEXP_all_Insurancelines AS (\n\tSELECT\n\tPremiumTransactionID1 AS PremiumTransactionID,\n\tPremiumTransactionAKID1 AS PremiumTransactionAKID,\n\tOtherModifiedFactor,\n\tScheduleModifiedFactor,\n\tExperienceModifiedFactor,\n\tTransitionFactor\n\tFROM mplt_PremiumTransactionRatingModifier\n),\nLKP_PremiumTransactionRatingModifier AS (\n\tSELECT\n\tPremiumTransactionID\n\tFROM (\n\t\tSELECT PremiumTransactionRatingModifier.PremiumTransactionID as PremiumTransactionID FROM @{pipeline().parameters.SOURCE_TABLE_OWNER} .PremiumTransactionRatingModifier\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionID ORDER BY PremiumTransactionID) = 1\n),\nFilter_insert_new_records AS (\n\tSELECT\n\tLKP_PremiumTransactionRatingModifier.PremiumTransactionID AS lkp_PremiumTransactionID, \n\tEXP_all_Insurancelines.PremiumTransactionID, \n\tEXP_all_Insurancelines.PremiumTransactionAKID, \n\tEXP_all_Insurancelines.OtherModifiedFactor, \n\tEXP_all_Insurancelines.ScheduleModifiedFactor, \n\tEXP_all_Insurancelines.ExperienceModifiedFactor, \n\tEXP_all_Insurancelines.TransitionFactor\n\tFROM EXP_all_Insurancelines\n\tLEFT JOIN LKP_PremiumTransactionRatingModifier\n\tON LKP_PremiumTransactionRatingModifier.PremiumTransactionID = EXP_all_Insurancelines.PremiumTransactionID\n\tWHERE ISNULL(lkp_PremiumTransactionID)\n),\nEXP_Target_Columns AS (\n\tSELECT\n\tPremiumTransactionID,\n\tPremiumTransactionAKID,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemID,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\tOtherModifiedFactor,\n\tScheduleModifiedFactor,\n\tExperienceModifiedFactor,\n\tTransitionFactor\n\tFROM Filter_insert_new_records\n),\nPremiumTransactionRatingModifier_insert AS (\n\tINSERT INTO PremiumTransactionRatingModifier\n\t(PremiumTransactionID, PremiumTransactionAKID, AuditID, SourceSystemID, CreatedDate, ModifiedDate, OtherModifiedFactor, ScheduleModifiedFactor, ExperienceModifiedFactor, TransitionFactor)\n\tSELECT \n\tPREMIUMTRANSACTIONID, \n\tPREMIUMTRANSACTIONAKID, \n\to_AuditID AS AUDITID, \n\to_SourceSystemID AS SOURCESYSTEMID, \n\to_CreatedDate AS CREATEDDATE, \n\to_ModifiedDate AS MODIFIEDDATE, \n\tOTHERMODIFIEDFACTOR, \n\tSCHEDULEMODIFIEDFACTOR, \n\tEXPERIENCEMODIFIEDFACTOR, \n\tTRANSITIONFACTOR\n\tFROM EXP_Target_Columns\n),\nSQ_PremiumTransactionRatingModifier_offset_records AS (\n\tSELECT DISTINCT WorkPremiumTransactionOffsetLineage.PremiumTransactionID\r\n\t\t,WorkPremiumTransactionOffsetLineage.PremiumTransactionAKID\r\n\t\t,PremiumTransactionRatingModifier.OtherModifiedFactor\r\n\t\t,PremiumTransactionRatingModifier.ScheduleModifiedFactor\r\n\t\t,PremiumTransactionRatingModifier.ExperienceModifiedFactor\r\n\t\t,PremiumTransactionRatingModifier.TransitionFactor\r\n\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkPremiumTransactionOffsetLineage\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransactionRatingModifier\r\n\t ON PremiumTransactionRatingModifier.PremiumTransactionID = WorkPremiumTransactionOffsetLineage.PreviousPremiumTransactionID\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction \r\n\tON WorkPremiumTransactionOffsetLineage.PremiumTransactionID = PremiumTransaction.PremiumTransactionID and PremiumTransaction.OffsetOnsetCode='Offset' \r\n\t\tAND PremiumTransaction.ReasonAmendedCode NOT IN (\r\n\t\t\t'CWO'\r\n\t\t\t,'Claw Back'\r\n\t\t\t)\r\n\t\tAND PremiumTransaction.PremiumType = 'D'\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage ON RatingCoverage.RatingCoverageAKID = PremiumTransaction.RatingCoverageAKId\r\n\t\tAND RatingCoverage.EffectiveDate = PremiumTransaction.EffectiveDate\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product ON RatingCoverage.ProductAKId = Product.ProductAKId\r\n\t\tAND Product.CurrentSnapshotFlag = 1\r\n\t\tAND Product.ProductAbbreviation <> 'WC'\r\n\t\twhere WorkPremiumTransactionOffsetLineage. UpdateAttributeFlag = 1\n),\nEXP_Extract_offset AS (\n\tSELECT\n\tPremiumTransactionID,\n\tPremiumTransactionAKID,\n\tOtherModifiedFactor,\n\tScheduleModifiedFactor,\n\tExperienceModifiedFactor,\n\tTransitionFactor,\n\t-- *INF*: IIF(ISNULL(OtherModifiedFactor),1.0,OtherModifiedFactor)\n\tIFF(OtherModifiedFactor IS NULL, 1.0, OtherModifiedFactor) AS o_OtherModifiedFactor,\n\t-- *INF*: IIF(ISNULL(ScheduleModifiedFactor),1.0,ScheduleModifiedFactor)\n\tIFF(ScheduleModifiedFactor IS NULL, 1.0, ScheduleModifiedFactor) AS o_ScheduleModifiedFactor,\n\t-- *INF*: IIF(ISNULL(ExperienceModifiedFactor),1.0,ExperienceModifiedFactor)\n\tIFF(ExperienceModifiedFactor IS NULL, 1.0, ExperienceModifiedFactor) AS o_ExperienceModifiedFactor,\n\t-- *INF*: IIF(ISNULL(TransitionFactor),1.0,TransitionFactor)\n\tIFF(TransitionFactor IS NULL, 1.0, TransitionFactor) AS o_TransitionFactor\n\tFROM SQ_PremiumTransactionRatingModifier_offset_records\n),\nLKP_PremiumtransactionRatingmodifier_offset AS (\n\tSELECT\n\tPremiumTransactionID\n\tFROM (\n\t\tSELECT PremiumTransactionRatingModifier.PremiumTransactionID as PremiumTransactionID FROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransactionRatingModifier\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionID ORDER BY PremiumTransactionID) = 1\n),\nFilter_offset_records AS (\n\tSELECT\n\tLKP_PremiumtransactionRatingmodifier_offset.PremiumTransactionID AS lkp_PremiumTransactionID, \n\tEXP_Extract_offset.PremiumTransactionID, \n\tEXP_Extract_offset.PremiumTransactionAKID, \n\tEXP_Extract_offset.o_OtherModifiedFactor AS OtherModifiedFactor, \n\tEXP_Extract_offset.o_ScheduleModifiedFactor AS ScheduleModifiedFactor, \n\tEXP_Extract_offset.o_ExperienceModifiedFactor AS ExperienceModifiedFactor, \n\tEXP_Extract_offset.o_TransitionFactor AS TransitionFactor\n\tFROM EXP_Extract_offset\n\tLEFT JOIN LKP_PremiumtransactionRatingmodifier_offset\n\tON LKP_PremiumtransactionRatingmodifier_offset.PremiumTransactionID = EXP_Extract_offset.PremiumTransactionID\n\tWHERE ISNULL(lkp_PremiumTransactionID)\n),\nEXP_Target_columns_offset AS (\n\tSELECT\n\tPremiumTransactionID,\n\tPremiumTransactionAKID,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditID,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS SourceSystemID,\n\tSYSDATE AS CreatedDate,\n\tSYSDATE AS ModifiedDate,\n\tOtherModifiedFactor,\n\tScheduleModifiedFactor,\n\tExperienceModifiedFactor,\n\tTransitionFactor\n\tFROM Filter_offset_records\n),\nPremiumTransactionRatingModifier_offset_insert AS (\n\tINSERT INTO PremiumTransactionRatingModifier\n\t(PremiumTransactionID, PremiumTransactionAKID, AuditID, SourceSystemID, CreatedDate, ModifiedDate, OtherModifiedFactor, ScheduleModifiedFactor, ExperienceModifiedFactor, TransitionFactor)\n\tSELECT \n\tPREMIUMTRANSACTIONID, \n\tPREMIUMTRANSACTIONAKID, \n\tAUDITID, \n\tSOURCESYSTEMID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tOTHERMODIFIEDFACTOR, \n\tSCHEDULEMODIFIEDFACTOR, \n\tEXPERIENCEMODIFIEDFACTOR, \n\tTRANSITIONFACTOR\n\tFROM EXP_Target_columns_offset\n),\nSQ_PremiumTransactionRatingModifier_Deprecated_records AS (\n\tSELECT DISTINCT WorkPremiumTransactionOffsetLineage.PremiumTransactionID\r\n\t\t,WorkPremiumTransactionOffsetLineage.PremiumTransactionAKID\r\n\t\t,PremiumTransactionRatingModifier.OtherModifiedFactor\r\n\t\t,PremiumTransactionRatingModifier.ScheduleModifiedFactor\r\n\t\t,PremiumTransactionRatingModifier.ExperienceModifiedFactor\r\n\t\t,PremiumTransactionRatingModifier.TransitionFactor\r\n\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkPremiumTransactionOffsetLineage\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransactionRatingModifier\r\n\t ON PremiumTransactionRatingModifier.PremiumTransactionID = WorkPremiumTransactionOffsetLineage.PreviousPremiumTransactionID\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction \r\n\tON WorkPremiumTransactionOffsetLineage.PremiumTransactionID = PremiumTransaction.PremiumTransactionID and PremiumTransaction.OffsetOnsetCode='Deprecated' \r\n\t\tAND PremiumTransaction.ReasonAmendedCode NOT IN (\r\n\t\t\t'CWO'\r\n\t\t\t,'Claw Back'\r\n\t\t\t)\r\n\t\tAND PremiumTransaction.PremiumType = 'D'\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage ON RatingCoverage.RatingCoverageAKID = PremiumTransaction.RatingCoverageAKId\r\n\t\tAND RatingCoverage.EffectiveDate = PremiumTransaction.EffectiveDate\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product ON RatingCoverage.ProductAKId = Product.ProductAKId\r\n\t\tAND Product.CurrentSnapshotFlag = 1\r\n\t\tAND Product.ProductAbbreviation <> 'WC'\r\n\t\twhere WorkPremiumTransactionOffsetLineage. UpdateAttributeFlag = 1\n),\nEXP_Extract_Deprecated AS (\n\tSELECT\n\tPremiumTransactionID,\n\tPremiumTransactionAKID,\n\tOtherModifiedFactor,\n\tScheduleModifiedFactor,\n\tExperienceModifiedFactor,\n\tTransitionFactor,\n\t-- *INF*: IIF(ISNULL(OtherModifiedFactor),1.0,OtherModifiedFactor)\n\tIFF(OtherModifiedFactor IS NULL, 1.0, OtherModifiedFactor) AS o_OtherModifiedFactor,\n\t-- *INF*: IIF(ISNULL(ScheduleModifiedFactor),1.0,ScheduleModifiedFactor)\n\tIFF(ScheduleModifiedFactor IS NULL, 1.0, ScheduleModifiedFactor) AS o_ScheduleModifiedFactor,\n\t-- *INF*: IIF(ISNULL(ExperienceModifiedFactor),1.0,ExperienceModifiedFactor)\n\tIFF(ExperienceModifiedFactor IS NULL, 1.0, ExperienceModifiedFactor) AS o_ExperienceModifiedFactor,\n\t-- *INF*: IIF(ISNULL(TransitionFactor),1.0,TransitionFactor)\n\tIFF(TransitionFactor IS NULL, 1.0, TransitionFactor) AS o_TransitionFactor\n\tFROM SQ_PremiumTransactionRatingModifier_Deprecated_records\n),\nLKP_PremiumtransactionRatingmodifier_Deprecated AS (\n\tSELECT\n\tPremiumTransactionID\n\tFROM (\n\t\tSELECT PremiumTransactionRatingModifier.PremiumTransactionID as PremiumTransactionID FROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransactionRatingModifier\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionID ORDER BY PremiumTransactionID) = 1\n),\nFilter_offset_Deprecated AS (\n\tSELECT\n\tLKP_PremiumtransactionRatingmodifier_Deprecated.PremiumTransactionID AS lkp_PremiumTransactionID, \n\tEXP_Extract_Deprecated.PremiumTransactionID, \n\tEXP_Extract_Deprecated.PremiumTransactionAKID, \n\tEXP_Extract_Deprecated.o_OtherModifiedFactor AS OtherModifiedFactor, \n\tEXP_Extract_Deprecated.o_ScheduleModifiedFactor AS ScheduleModifiedFactor, \n\tEXP_Extract_Deprecated.o_ExperienceModifiedFactor AS ExperienceModifiedFactor, \n\tEXP_Extract_Deprecated.o_TransitionFactor AS TransitionFactor\n\tFROM EXP_Extract_Deprecated\n\tLEFT JOIN LKP_PremiumtransactionRatingmodifier_Deprecated\n\tON LKP_PremiumtransactionRatingmodifier_Deprecated.PremiumTransactionID = EXP_Extract_Deprecated.PremiumTransactionID\n\tWHERE ISNULL(lkp_PremiumTransactionID)\n),\nEXP_Target_columns_Deprecated AS (\n\tSELECT\n\tPremiumTransactionID,\n\tPremiumTransactionAKID,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditID,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS SourceSystemID,\n\tSYSDATE AS CreatedDate,\n\tSYSDATE AS ModifiedDate,\n\tOtherModifiedFactor,\n\tScheduleModifiedFactor,\n\tExperienceModifiedFactor,\n\tTransitionFactor\n\tFROM Filter_offset_Deprecated\n),\nPremiumTransactionRatingModifier_Deprecated_insert AS (\n\tINSERT INTO PremiumTransactionRatingModifier\n\t(PremiumTransactionID, PremiumTransactionAKID, AuditID, SourceSystemID, CreatedDate, ModifiedDate, OtherModifiedFactor, ScheduleModifiedFactor, ExperienceModifiedFactor, TransitionFactor)\n\tSELECT \n\tPREMIUMTRANSACTIONID, \n\tPREMIUMTRANSACTIONAKID, \n\tAUDITID, \n\tSOURCESYSTEMID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tOTHERMODIFIEDFACTOR, \n\tSCHEDULEMODIFIEDFACTOR, \n\tEXPERIENCEMODIFIEDFACTOR, \n\tTRANSITIONFACTOR\n\tFROM EXP_Target_columns_Deprecated\n),\nSQ_PremiumTransactionRatingModifier_backfill AS (\n\tSELECT DISTINCT PT.PremiumTransactionID AS PremiumTransactionRatingModifierId\r\n\t\t,PT.PremiumTransactionID\r\n\t\t,WPT.PremiumTransactionAKID\r\n\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkPremiumTransaction WPT\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction PT ON WPT.PremiumTransactionAKId = PT.PremiumTransactionAKId\r\n\t and PT.ReasonAmendedCode not in ('CWO','Claw Back') and PT.PremiumType='D'\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage RC ON PT.RatingCoverageAKId = RC.RatingCoverageAKID\r\n\t\tAND PT.EffectiveDate = RC.EffectiveDate\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product PRD ON RC.ProductAKId = PRD.ProductAKId\r\n\t\tAND PRD.CurrentSnapshotFlag = 1\r\n\t\tAND PRD.ProductAbbreviation <> 'WC'\r\n\tWHERE NOT EXISTS (\r\n\t\t\tSELECT 1\r\n\t\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransactionRatingModifier PTRM WITH (NOLOCK)\r\n\t\t\tWHERE WPT.PremiumTransactionAKId = PTRM.PremiumTransactionAKID\r\n\t\t\t)\r\n\tand WPT.SourceSystemID = 'DCT'\n),\nEXP_Extract_Othetransactions AS (\n\tSELECT\n\tPremiumTransactionRatingModifierId,\n\tPremiumTransactionID,\n\tPremiumTransactionAKID,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditID,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS SourceSystemID,\n\tSYSDATE AS CreatedDate,\n\tSYSDATE AS ModifiedDate,\n\t1.0 AS OtherModifiedFactor,\n\t1.0 AS ScheduleModifiedFactor,\n\t1.0 AS ExperienceModifiedFactor,\n\t1.0 AS TransitionFactor\n\tFROM SQ_PremiumTransactionRatingModifier_backfill\n),\nPremiumTransactionRatingModifier_insert_othertrnsactions AS (\n\tINSERT INTO PremiumTransactionRatingModifier\n\t(PremiumTransactionID, PremiumTransactionAKID, AuditID, SourceSystemID, CreatedDate, ModifiedDate, OtherModifiedFactor, ScheduleModifiedFactor, ExperienceModifiedFactor, TransitionFactor)\n\tSELECT \n\tPREMIUMTRANSACTIONID, \n\tPREMIUMTRANSACTIONAKID, \n\tAUDITID, \n\tSOURCESYSTEMID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tOTHERMODIFIEDFACTOR, \n\tSCHEDULEMODIFIEDFACTOR, \n\tEXPERIENCEMODIFIEDFACTOR, \n\tTRANSITIONFACTOR\n\tFROM EXP_Extract_Othetransactions\n),"
                        }
                    ]
                }
            }
        ],
        "parameters": {
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "Policy DataWarehouse/"
        },
        "annotations": []
    }
}