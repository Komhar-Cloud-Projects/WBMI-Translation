{
    "name": "s_m_CLM_DM_LOAD_Reinsurance_Coverage_Dim",
    "properties": {
        "activities": [
            {
                "name": "m_CLM_DM_LOAD_Reinsurance_Coverage_Dim",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_reinsurance_coverage AS (\n\tSELECT\n\t\treins_cov_id,\n\t\teff_from_date,\n\t\tsource_sys_id,\n\t\tcreated_date,\n\t\treins_cov_ak_id,\n\t\treins_loc_unit_num,\n\t\treins_sub_loc_unit_num,\n\t\treins_risk_unit_grp_seq_num,\n\t\treins_risk_unit_seq_num,\n\t\treins_section_code,\n\t\treins_co_num,\n\t\treins_co_name,\n\t\treins_eff_date,\n\t\treins_exp_date,\n\t\treins_enter_date,\n\t\treins_type,\n\t\treins_prcnt_prem_ceded,\n\t\treins_prcnt_loss_ceded,\n\t\treins_prcnt_facultative_commssn,\n\t\treins_excess_amt,\n\t\treins_occurrence_lmt,\n\t\treins_agg_lmt,\n\t\tSupInsuranceLineId,\n\t\tSupRiskUnitId,\n\t\tSupRiskUnitGroupId,\n\t\tReinsuranceMethod\n\tFROM reinsurance_coverage\n\tWHERE created_date >= '@{pipeline().parameters.SELECTION_START_TS}'\n),\nLKP_Reinsurance_Coverage_Dim AS (\n\tSELECT\n\treins_cov_dim_id,\n\tedw_reins_cov_ak_id,\n\teff_from_date\n\tFROM (\n\t\tSELECT \n\t\t\treins_cov_dim_id,\n\t\t\tedw_reins_cov_ak_id,\n\t\t\teff_from_date\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.reinsurance_coverage_dim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_reins_cov_ak_id,eff_from_date ORDER BY reins_cov_dim_id) = 1\n),\nLKP_Sup_Insurance_Line AS (\n\tSELECT\n\tStandardInsuranceLineCode,\n\tsup_ins_line_id\n\tFROM (\n\t\tSELECT \n\t\t\tStandardInsuranceLineCode,\n\t\t\tsup_ins_line_id\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY sup_ins_line_id ORDER BY StandardInsuranceLineCode) = 1\n),\nLKP_Sup_Risk_Unit AS (\n\tSELECT\n\tStandardRiskUnitCode,\n\tsup_risk_unit_id\n\tFROM (\n\t\tSELECT \n\t\t\tStandardRiskUnitCode,\n\t\t\tsup_risk_unit_id\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_risk_unit\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY sup_risk_unit_id ORDER BY StandardRiskUnitCode) = 1\n),\nLKP_Sup_Risk_Unit_Group AS (\n\tSELECT\n\trisk_unit_grp_code,\n\tsup_risk_unit_grp_id\n\tFROM (\n\t\tSELECT \n\t\t\trisk_unit_grp_code,\n\t\t\tsup_risk_unit_grp_id\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_risk_unit_group\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY sup_risk_unit_grp_id ORDER BY risk_unit_grp_code) = 1\n),\nEXP_Get_Values AS (\n\tSELECT\n\tSQ_reinsurance_coverage.reins_cov_id,\n\tSQ_reinsurance_coverage.eff_from_date,\n\tSQ_reinsurance_coverage.source_sys_id,\n\tSQ_reinsurance_coverage.reins_cov_ak_id,\n\tSQ_reinsurance_coverage.reins_loc_unit_num,\n\tSQ_reinsurance_coverage.reins_sub_loc_unit_num,\n\tSQ_reinsurance_coverage.reins_risk_unit_grp_seq_num,\n\tSQ_reinsurance_coverage.reins_risk_unit_seq_num,\n\tSQ_reinsurance_coverage.reins_section_code,\n\tSQ_reinsurance_coverage.reins_co_num,\n\tSQ_reinsurance_coverage.reins_co_name,\n\tSQ_reinsurance_coverage.reins_eff_date,\n\tSQ_reinsurance_coverage.reins_exp_date,\n\tSQ_reinsurance_coverage.reins_enter_date,\n\tSQ_reinsurance_coverage.reins_type,\n\tSQ_reinsurance_coverage.reins_prcnt_prem_ceded,\n\tSQ_reinsurance_coverage.reins_prcnt_loss_ceded,\n\tSQ_reinsurance_coverage.reins_prcnt_facultative_commssn,\n\tSQ_reinsurance_coverage.reins_excess_amt,\n\tSQ_reinsurance_coverage.reins_occurrence_lmt,\n\tSQ_reinsurance_coverage.reins_agg_lmt,\n\tSQ_reinsurance_coverage.ReinsuranceMethod,\n\tLKP_Reinsurance_Coverage_Dim.reins_cov_dim_id AS lkp_reins_cov_dim_id,\n\tLKP_Sup_Insurance_Line.StandardInsuranceLineCode AS lkp_StandardInsuranceLineCode,\n\tLKP_Sup_Risk_Unit_Group.risk_unit_grp_code AS lkp_StandardRiskUnitGroupCode,\n\tLKP_Sup_Risk_Unit.StandardRiskUnitCode AS lkp_StandardRiskUnitCode,\n\t-- *INF*: DECODE(source_sys_id,'DCT', reins_type, 'N/A')\n\tDECODE(\n\t    source_sys_id,\n\t    'DCT', reins_type,\n\t    'N/A'\n\t) AS o_ReinsuranceType,\n\tReinsuranceMethod AS o_ReinsuranceMethod,\n\t-- *INF*: IIF(ISNULL(lkp_StandardInsuranceLineCode) OR IS_SPACES(lkp_StandardInsuranceLineCode) OR LENGTH(lkp_StandardInsuranceLineCode)=0,'N/A',LTRIM(RTRIM(lkp_StandardInsuranceLineCode)))\n\tIFF(\n\t    lkp_StandardInsuranceLineCode IS NULL\n\t    or LENGTH(lkp_StandardInsuranceLineCode)>0\n\t    and TRIM(lkp_StandardInsuranceLineCode)=''\n\t    or LENGTH(lkp_StandardInsuranceLineCode) = 0,\n\t    'N/A',\n\t    LTRIM(RTRIM(lkp_StandardInsuranceLineCode))\n\t) AS o_reins_ins_line,\n\t-- *INF*: IIF(ISNULL(lkp_StandardRiskUnitGroupCode) OR IS_SPACES(lkp_StandardRiskUnitGroupCode) OR LENGTH(lkp_StandardRiskUnitGroupCode)=0,'N/A',LTRIM(RTRIM(lkp_StandardRiskUnitGroupCode)))\n\tIFF(\n\t    lkp_StandardRiskUnitGroupCode IS NULL\n\t    or LENGTH(lkp_StandardRiskUnitGroupCode)>0\n\t    and TRIM(lkp_StandardRiskUnitGroupCode)=''\n\t    or LENGTH(lkp_StandardRiskUnitGroupCode) = 0,\n\t    'N/A',\n\t    LTRIM(RTRIM(lkp_StandardRiskUnitGroupCode))\n\t) AS o_reins_risk_unit_grp,\n\t-- *INF*: IIF(ISNULL(lkp_StandardRiskUnitCode) OR IS_SPACES(lkp_StandardRiskUnitCode) OR LENGTH(lkp_StandardRiskUnitCode)=0,'N/A',LTRIM(RTRIM(lkp_StandardRiskUnitCode)))\n\tIFF(\n\t    lkp_StandardRiskUnitCode IS NULL\n\t    or LENGTH(lkp_StandardRiskUnitCode)>0\n\t    and TRIM(lkp_StandardRiskUnitCode)=''\n\t    or LENGTH(lkp_StandardRiskUnitCode) = 0,\n\t    'N/A',\n\t    LTRIM(RTRIM(lkp_StandardRiskUnitCode))\n\t) AS o_reins_risk_unit,\n\t-- *INF*: DECODE(LTRIM(RTRIM(reins_co_num)),\r\n\t-- '0005','N',\r\n\t-- '0007','N',\r\n\t-- '0009','N',\r\n\t-- '0015','N',\r\n\t-- '0016','N',\r\n\t-- '0031','N',\r\n\t-- '0032','N',\r\n\t-- '0033','N',\r\n\t-- '0034','N',\r\n\t-- '0035','N',\r\n\t-- '0039','N',\r\n\t-- '0055','N',\r\n\t-- 'F')\n\tDECODE(\n\t    LTRIM(RTRIM(reins_co_num)),\n\t    '0005', 'N',\n\t    '0007', 'N',\n\t    '0009', 'N',\n\t    '0015', 'N',\n\t    '0016', 'N',\n\t    '0031', 'N',\n\t    '0032', 'N',\n\t    '0033', 'N',\n\t    '0034', 'N',\n\t    '0035', 'N',\n\t    '0039', 'N',\n\t    '0055', 'N',\n\t    'F'\n\t) AS o_facultative_ind,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_TIMESTAMP('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS o_eff_to_Date,\n\t1 AS o_crrnt_snpsht_flag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_Audit_id,\n\tSYSDATE AS o_Created_date\n\tFROM SQ_reinsurance_coverage\n\tLEFT JOIN LKP_Reinsurance_Coverage_Dim\n\tON LKP_Reinsurance_Coverage_Dim.edw_reins_cov_ak_id = SQ_reinsurance_coverage.reins_cov_ak_id AND LKP_Reinsurance_Coverage_Dim.eff_from_date = SQ_reinsurance_coverage.eff_from_date\n\tLEFT JOIN LKP_Sup_Insurance_Line\n\tON LKP_Sup_Insurance_Line.sup_ins_line_id = SQ_reinsurance_coverage.SupInsuranceLineId\n\tLEFT JOIN LKP_Sup_Risk_Unit\n\tON LKP_Sup_Risk_Unit.sup_risk_unit_id = SQ_reinsurance_coverage.SupRiskUnitId\n\tLEFT JOIN LKP_Sup_Risk_Unit_Group\n\tON LKP_Sup_Risk_Unit_Group.sup_risk_unit_grp_id = SQ_reinsurance_coverage.SupRiskUnitGroupId\n),\nRTR_Reinsurance_Coverage_Dim AS (\n\tSELECT\n\tlkp_reins_cov_dim_id AS reins_cov_dim_id,\n\treins_cov_id,\n\teff_from_date,\n\treins_cov_ak_id,\n\to_reins_ins_line AS reins_ins_line,\n\treins_loc_unit_num,\n\treins_sub_loc_unit_num,\n\to_reins_risk_unit_grp AS reins_risk_unit_grp,\n\treins_risk_unit_grp_seq_num,\n\to_reins_risk_unit AS reins_risk_unit,\n\treins_risk_unit_seq_num,\n\treins_section_code,\n\treins_co_num,\n\treins_co_name,\n\treins_eff_date,\n\treins_exp_date,\n\treins_enter_date,\n\treins_type,\n\treins_prcnt_prem_ceded,\n\treins_prcnt_loss_ceded,\n\treins_prcnt_facultative_commssn,\n\treins_excess_amt,\n\treins_occurrence_lmt,\n\treins_agg_lmt,\n\to_facultative_ind AS facultative_ind,\n\to_ReinsuranceType AS ReinsuranceType,\n\tReinsuranceMethod,\n\to_eff_to_Date AS eff_to_Date,\n\to_Audit_id AS Audit_id,\n\to_Created_date AS Created_date,\n\to_crrnt_snpsht_flag AS crrnt_snpsht_flag\n\tFROM EXP_Get_Values\n),\nRTR_Reinsurance_Coverage_Dim_INSERT AS (SELECT * FROM RTR_Reinsurance_Coverage_Dim WHERE ISNULL(reins_cov_dim_id)),\nRTR_Reinsurance_Coverage_Dim_DEFAULT1 AS (SELECT * FROM RTR_Reinsurance_Coverage_Dim WHERE NOT ( (ISNULL(reins_cov_dim_id)) )),\nUPD_Reins_Coverage_Dim AS (\n\tSELECT\n\treins_cov_dim_id AS reins_cov_dim_id2, \n\treins_cov_id AS reins_cov_id2, \n\teff_from_date AS eff_from_date2, \n\treins_cov_ak_id AS reins_cov_ak_id2, \n\treins_ins_line AS reins_ins_line2, \n\treins_loc_unit_num AS reins_loc_unit_num2, \n\treins_sub_loc_unit_num AS reins_sub_loc_unit_num2, \n\treins_risk_unit_grp AS reins_risk_unit_grp2, \n\treins_risk_unit_grp_seq_num AS reins_risk_unit_grp_seq_num2, \n\treins_risk_unit AS reins_risk_unit2, \n\treins_risk_unit_seq_num AS reins_risk_unit_seq_num2, \n\treins_section_code AS reins_section_code2, \n\treins_co_num AS reins_co_num2, \n\treins_co_name AS reins_co_name2, \n\treins_eff_date AS reins_eff_date2, \n\treins_exp_date AS reins_exp_date2, \n\treins_enter_date AS reins_enter_date2, \n\treins_type AS reins_type2, \n\treins_prcnt_prem_ceded AS reins_prcnt_prem_ceded2, \n\treins_prcnt_loss_ceded AS reins_prcnt_loss_ceded2, \n\treins_prcnt_facultative_commssn AS reins_prcnt_facultative_commssn2, \n\treins_excess_amt AS reins_excess_amt2, \n\treins_occurrence_lmt AS reins_occurrence_lmt2, \n\treins_agg_lmt AS reins_agg_lmt2, \n\teff_to_Date AS eff_to_Date2, \n\tAudit_id AS Audit_id2, \n\tCreated_date AS Created_date2, \n\tfacultative_ind AS facultative_ind2, \n\tReinsuranceType, \n\tReinsuranceMethod AS ReinsuranceMethod2\n\tFROM RTR_Reinsurance_Coverage_Dim_DEFAULT1\n),\nreinsurance_coverage_dim_UPDATE AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.reinsurance_coverage_dim AS T\n\tUSING UPD_Reins_Coverage_Dim AS S\n\tON T.reins_cov_dim_id = S.reins_cov_dim_id2\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.audit_id = S.Audit_id2, T.eff_from_date = S.eff_from_date2, T.eff_to_date = S.eff_to_Date2, T.modified_date = S.Created_date2, T.edw_reins_cov_pk_id = S.reins_cov_id2, T.edw_reins_cov_ak_id = S.reins_cov_ak_id2, T.reins_ins_line = S.reins_ins_line2, T.reins_loc_unit_num = S.reins_loc_unit_num2, T.reins_sub_loc_unit_num = S.reins_sub_loc_unit_num2, T.reins_risk_unit_grp = S.reins_risk_unit_grp2, T.reins_risk_unit_grp_seq_num = S.reins_risk_unit_grp_seq_num2, T.reins_risk_unit = S.reins_risk_unit2, T.reins_risk_unit_seq_num = S.reins_risk_unit_seq_num2, T.reins_section_code = S.reins_section_code2, T.reins_co_num = S.reins_co_num2, T.reins_co_name = S.reins_co_name2, T.reins_eff_date = S.reins_eff_date2, T.reins_exp_date = S.reins_exp_date2, T.reins_enter_date = S.reins_enter_date2, T.reins_type = S.reins_type2, T.reins_prcnt_prem_ceded = S.reins_prcnt_prem_ceded2, T.reins_prcnt_loss_ceded = S.reins_prcnt_loss_ceded2, T.reins_prcnt_facultative_commssn = S.reins_prcnt_facultative_commssn2, T.reins_excess_amt = S.reins_excess_amt2, T.reins_occurrence_lmt = S.reins_occurrence_lmt2, T.reins_agg_lmt = S.reins_agg_lmt2, T.facultative_ind = S.facultative_ind2, T.ReinsuranceType = S.ReinsuranceType, T.ReinsuranceMethod = S.ReinsuranceMethod2\n),\nreinsurance_coverage_dim_INSERT AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.reinsurance_coverage_dim\n\t(crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, created_date, modified_date, edw_reins_cov_pk_id, edw_reins_cov_ak_id, reins_ins_line, reins_loc_unit_num, reins_sub_loc_unit_num, reins_risk_unit_grp, reins_risk_unit_grp_seq_num, reins_risk_unit, reins_risk_unit_seq_num, reins_section_code, reins_co_num, reins_co_name, reins_eff_date, reins_exp_date, reins_enter_date, reins_type, reins_prcnt_prem_ceded, reins_prcnt_loss_ceded, reins_prcnt_facultative_commssn, reins_excess_amt, reins_occurrence_lmt, reins_agg_lmt, facultative_ind, ReinsuranceType, ReinsuranceMethod)\n\tSELECT \n\tCRRNT_SNPSHT_FLAG, \n\tAudit_id AS AUDIT_ID, \n\tEFF_FROM_DATE, \n\teff_to_Date AS EFF_TO_DATE, \n\tCreated_date AS CREATED_DATE, \n\tCreated_date AS MODIFIED_DATE, \n\treins_cov_id AS EDW_REINS_COV_PK_ID, \n\treins_cov_ak_id AS EDW_REINS_COV_AK_ID, \n\tREINS_INS_LINE, \n\tREINS_LOC_UNIT_NUM, \n\tREINS_SUB_LOC_UNIT_NUM, \n\tREINS_RISK_UNIT_GRP, \n\tREINS_RISK_UNIT_GRP_SEQ_NUM, \n\tREINS_RISK_UNIT, \n\tREINS_RISK_UNIT_SEQ_NUM, \n\tREINS_SECTION_CODE, \n\tREINS_CO_NUM, \n\tREINS_CO_NAME, \n\tREINS_EFF_DATE, \n\tREINS_EXP_DATE, \n\tREINS_ENTER_DATE, \n\tREINS_TYPE, \n\tREINS_PRCNT_PREM_CEDED, \n\tREINS_PRCNT_LOSS_CEDED, \n\tREINS_PRCNT_FACULTATIVE_COMMSSN, \n\tREINS_EXCESS_AMT, \n\tREINS_OCCURRENCE_LMT, \n\tREINS_AGG_LMT, \n\tFACULTATIVE_IND, \n\tREINSURANCETYPE, \n\tREINSURANCEMETHOD\n\tFROM RTR_Reinsurance_Coverage_Dim_INSERT\n),\nSQ_reinsurance_coverage_dim AS (\n\tSELECT reinsurance_coverage_dim.reins_cov_dim_id,\r\n\t       reinsurance_coverage_dim.eff_from_date,\r\n\t       reinsurance_coverage_dim.eff_to_date,\r\n\t       reinsurance_coverage_dim.edw_reins_cov_ak_id\r\n\tFROM   @{pipeline().parameters.TARGET_TABLE_OWNER}.reinsurance_coverage_dim reinsurance_coverage_dim\r\n\tWHERE EXISTS\r\n\t(\r\n\tSELECT 1 FROM @{pipeline().parameters.TARGET_TABLE_OWNER}.reinsurance_coverage_dim  reinsurance_coverage_dim2\r\n\tWHERE crrnt_snpsht_flag =1 AND reinsurance_coverage_dim.edw_reins_cov_ak_id = reinsurance_coverage_dim2.edw_reins_cov_ak_id\r\n\tGROUP BY reinsurance_coverage_dim2.edw_reins_cov_ak_id HAVING COUNT(*) > 1\r\n\t)\r\n\tORDER BY reinsurance_coverage_dim.edw_reins_cov_ak_id , reinsurance_coverage_dim.eff_from_date DESC\n),\nEXP_Lag_eff_from_date AS (\n\tSELECT\n\treins_cov_dim_id,\n\tedw_reins_cov_ak_id,\n\teff_from_date,\n\teff_to_date AS orig_eff_to_date,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- \tedw_reins_cov_ak_id = v_PREV_ROW_occurrence_key, ADD_TO_DATE(v_PREV_ROW_eff_from_date,'SS',-1),\r\n\t-- \torig_eff_to_date)\n\tDECODE(\n\t    TRUE,\n\t    edw_reins_cov_ak_id = v_PREV_ROW_occurrence_key, DATEADD(SECOND,- 1,v_PREV_ROW_eff_from_date),\n\t    orig_eff_to_date\n\t) AS v_eff_to_date,\n\teff_from_date AS v_PREV_ROW_eff_from_date,\n\tedw_reins_cov_ak_id AS v_PREV_ROW_occurrence_key,\n\tv_eff_to_date AS eff_to_date,\n\tSYSDATE AS modified_date,\n\t0 AS crrnt_snpsht_flag\n\tFROM SQ_reinsurance_coverage_dim\n),\nFIL_reinsurance_coverage_dim_update AS (\n\tSELECT\n\treins_cov_dim_id, \n\torig_eff_to_date, \n\teff_to_date, \n\tcrrnt_snpsht_flag, \n\tmodified_date\n\tFROM EXP_Lag_eff_from_date\n\tWHERE orig_eff_to_date != eff_to_date\n),\nUPD_reinsurance_coverage_dim AS (\n\tSELECT\n\treins_cov_dim_id, \n\teff_to_date, \n\tcrrnt_snpsht_flag, \n\tmodified_date\n\tFROM FIL_reinsurance_coverage_dim_update\n),\nreinsurance_coverage_dim_eff_date_UPDATE AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.reinsurance_coverage_dim AS T\n\tUSING UPD_reinsurance_coverage_dim AS S\n\tON T.reins_cov_dim_id = S.reins_cov_dim_id\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.crrnt_snpsht_flag = S.crrnt_snpsht_flag, T.eff_to_date = S.eff_to_date, T.modified_date = S.modified_date\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "RPT_EDM and EDW/Claims DataMart/"
        },
        "annotations": []
    }
}