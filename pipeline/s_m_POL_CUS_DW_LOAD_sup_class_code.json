{
    "name": "s_m_POL_CUS_DW_LOAD_sup_class_code",
    "properties": {
        "activities": [
            {
                "name": "m_POL_CUS_DW_LOAD_sup_class_code",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_gtam_wbimcls_stage AS (\n\tSelect inland_marine_class_code\r\n\t       ,inland_marine_class_description\r\n\t FROM gtam_wbimcls_stage\n),\nEXP_values_wbimcls AS (\n\tSELECT\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS v_default_end_date,\n\t'N/A' AS v_default_str,\n\tinland_marine_class_code AS IN_inland_marine_class_code,\n\t-- *INF*: IIF(ISNULL(IN_inland_marine_class_code) OR IS_SPACES(IN_inland_marine_class_code) OR LENGTH(IN_inland_marine_class_code)=0\r\n\t-- ,'N/A'\r\n\t-- ,ltrim(rtrim(IN_inland_marine_class_code)))\n\tIFF(IN_inland_marine_class_code IS NULL OR IS_SPACES(IN_inland_marine_class_code) OR LENGTH(IN_inland_marine_class_code) = 0, 'N/A', ltrim(rtrim(IN_inland_marine_class_code))) AS class_code,\n\tinland_marine_class_description AS IN_inland_marine_class_description,\n\t-- *INF*: IIF(ISNULL(IN_inland_marine_class_description) OR IS_SPACES(IN_inland_marine_class_description) OR\r\n\t-- LENGTH(IN_inland_marine_class_description)=0,'N/A',ltrim(rtrim(IN_inland_marine_class_description)))\n\tIFF(IN_inland_marine_class_description IS NULL OR IS_SPACES(IN_inland_marine_class_description) OR LENGTH(IN_inland_marine_class_description) = 0, 'N/A', ltrim(rtrim(IN_inland_marine_class_description))) AS OUT_inland_marine_class_description,\n\tv_default_str AS OUT_class_loc_code,\n\tv_default_str AS OUT_class_descript_ind,\n\tv_default_str AS OUT_mco,\n\tv_default_str AS OUT_class_loc_state,\n\tv_default_str AS OUT_subline,\n\tv_default_end_date AS OUT_gtam_exp_date,\n\tv_default_str AS OUT_class_descript_num_seq,\n\tv_default_str AS OUT_crime_ind\n\tFROM SQ_gtam_wbimcls_stage\n),\nLKP_sup_class_code_wbimcls AS (\n\tSELECT\n\tsup_class_code_id,\n\tclass_code_descript,\n\tclass_code,\n\tclass_loc_code,\n\tclass_descript_ind,\n\tmco,\n\tclass_loc_state,\n\tsubline,\n\tgtam_exp_date,\n\tclass_descript_num_seq,\n\tcrime_ind\n\tFROM (\n\t\tSELECT \r\n\t\t\ttl.sup_class_code_id as sup_class_code_id, \t\r\n\t\t     RTRIM(LTRIM(\ttl.class_code_descript)) as class_code_descript, \t\r\n\t\t RTRIM(LTRIM(\ttl.crime_ind)) as crime_ind,\r\n\t\t       RTRIM(LTRIM( tl.class_code  )) as class_code,\r\n\t\t\t  RTRIM(LTRIM(tl.class_loc_code )) as class_loc_code ,\r\n\t\t\t  RTRIM(LTRIM(tl.class_descript_ind))  as class_descript_ind,\r\n\t\t  RTRIM(LTRIM(\ttl.mco))  as mco,\r\n\t\t\t  RTRIM(LTRIM(tl.class_loc_state))  as class_loc_state,\r\n\t\t  RTRIM(LTRIM(\ttl.subline))  as subline,\r\n\t\t\ttl.gtam_exp_date  as gtam_exp_date ,\r\n\t\t\t  RTRIM(LTRIM(tl.class_descript_num_seq))  as class_descript_num_seq\t\t\r\n\t\tFROM  \r\n\t\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code tl\r\n\t\tWHERE \r\n\t\t\ttl.crrnt_snpsht_flag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY class_code,class_loc_code,class_descript_ind,mco,class_loc_state,subline,gtam_exp_date,class_descript_num_seq,crime_ind ORDER BY sup_class_code_id) = 1\n),\nEXP_Detect_Changes_wbimcls AS (\n\tSELECT\n\tEXP_values_wbimcls.OUT_inland_marine_class_description AS inland_marine_class_description,\n\tLKP_sup_class_code_wbimcls.sup_class_code_id AS LKP_sup_class_code_id,\n\tLKP_sup_class_code_wbimcls.class_code_descript AS LKP_class_code_descript,\n\t1 AS crrnt_snapshot_flag,\n\t-- *INF*: IIF(ISNULL(LKP_sup_class_code_id),'NEW',\r\n\t-- \tIIF(\r\n\t-- \t(ltrim(rtrim(inland_marine_class_description)) <> ltrim(rtrim(LKP_class_code_descript))),\r\n\t-- \t'UPDATE',\r\n\t-- \t'NOCHANGE'))\n\tIFF(LKP_sup_class_code_id IS NULL, 'NEW', IFF(( ltrim(rtrim(inland_marine_class_description)) <> ltrim(rtrim(LKP_class_code_descript)) ), 'UPDATE', 'NOCHANGE')) AS v_Changed_Flag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS Audit_ID,\n\t-- *INF*: IIF(v_Changed_Flag='NEW',\r\n\t-- \tTO_DATE('01/01/1800 01:00:00','MM/DD/YYYY HH24:MI:SS'),\r\n\t-- \tTO_DATE(TO_CHAR(SYSDATE,'MM/DD/YYYY HH24:MI:SS'),'MM/DD/YYYY HH24:MI:SS'))\n\tIFF(v_Changed_Flag = 'NEW', TO_DATE('01/01/1800 01:00:00', 'MM/DD/YYYY HH24:MI:SS'), TO_DATE(TO_CHAR(SYSDATE, 'MM/DD/YYYY HH24:MI:SS'), 'MM/DD/YYYY HH24:MI:SS')) AS Eff_From_Date,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS Eff_To_Date,\n\tv_Changed_Flag AS Changed_Flag,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS Source_System_ID,\n\tSYSDATE AS Created_Date,\n\tSYSDATE AS Modified_Date,\n\tEXP_values_wbimcls.class_code,\n\tEXP_values_wbimcls.OUT_class_loc_code AS class_loc_code,\n\tEXP_values_wbimcls.OUT_class_descript_ind AS class_descript_ind,\n\tEXP_values_wbimcls.OUT_mco AS mco,\n\tEXP_values_wbimcls.OUT_class_loc_state AS class_loc_state,\n\tEXP_values_wbimcls.OUT_subline AS subline,\n\tEXP_values_wbimcls.OUT_gtam_exp_date AS gtam_exp_date,\n\tEXP_values_wbimcls.OUT_class_descript_num_seq AS class_descript_num_seq,\n\tEXP_values_wbimcls.OUT_crime_ind AS crime_ind\n\tFROM EXP_values_wbimcls\n\tLEFT JOIN LKP_sup_class_code_wbimcls\n\tON LKP_sup_class_code_wbimcls.class_code = EXP_values_wbimcls.class_code AND LKP_sup_class_code_wbimcls.class_loc_code = EXP_values_wbimcls.OUT_class_loc_code AND LKP_sup_class_code_wbimcls.class_descript_ind = EXP_values_wbimcls.OUT_class_descript_ind AND LKP_sup_class_code_wbimcls.mco = EXP_values_wbimcls.OUT_mco AND LKP_sup_class_code_wbimcls.class_loc_state = EXP_values_wbimcls.OUT_class_loc_state AND LKP_sup_class_code_wbimcls.subline = EXP_values_wbimcls.OUT_subline AND LKP_sup_class_code_wbimcls.gtam_exp_date = EXP_values_wbimcls.OUT_gtam_exp_date AND LKP_sup_class_code_wbimcls.class_descript_num_seq = EXP_values_wbimcls.OUT_class_descript_num_seq AND LKP_sup_class_code_wbimcls.crime_ind = EXP_values_wbimcls.OUT_crime_ind\n),\nFIL_insert_wbimcls AS (\n\tSELECT\n\tcrrnt_snapshot_flag, \n\tAudit_ID, \n\tEff_From_Date, \n\tEff_To_Date, \n\tChanged_Flag, \n\tSource_System_ID, \n\tCreated_Date, \n\tModified_Date, \n\tclass_code, \n\tclass_loc_code, \n\tclass_descript_ind, \n\tmco, \n\tclass_loc_state, \n\tsubline, \n\tgtam_exp_date, \n\tclass_descript_num_seq, \n\tinland_marine_class_description AS class_code_descript, \n\tcrime_ind\n\tFROM EXP_Detect_Changes_wbimcls\n\tWHERE Changed_Flag='NEW'  OR Changed_Flag='UPDATE'\n),\nINS_sup_class_code_wbimcls AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code\n\t(crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date, class_code, class_loc_code, class_descript_ind, mco, class_loc_state, subline, gtam_exp_date, class_descript_num_seq, crime_ind, class_code_descript)\n\tSELECT \n\tcrrnt_snapshot_flag AS CRRNT_SNPSHT_FLAG, \n\tAudit_ID AS AUDIT_ID, \n\tEff_From_Date AS EFF_FROM_DATE, \n\tEff_To_Date AS EFF_TO_DATE, \n\tSource_System_ID AS SOURCE_SYS_ID, \n\tCreated_Date AS CREATED_DATE, \n\tModified_Date AS MODIFIED_DATE, \n\tCLASS_CODE, \n\tCLASS_LOC_CODE, \n\tCLASS_DESCRIPT_IND, \n\tMCO, \n\tCLASS_LOC_STATE, \n\tSUBLINE, \n\tGTAM_EXP_DATE, \n\tCLASS_DESCRIPT_NUM_SEQ, \n\tCRIME_IND, \n\tCLASS_CODE_DESCRIPT\n\tFROM FIL_insert_wbimcls\n),\nSQ_gtam_tl07rx_stage1 AS (\n\tSELECT\r\n\t class_code\r\n\t,class_description_indicator\r\n\t,state\r\n\t,class_description_sequence      \r\n\t ,class_description\r\n\tFROM gtam_tl07rx_stage\n),\nEXP_values_tl07rx AS (\n\tSELECT\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS v_default_end_date,\n\t'N/A' AS v_default_str,\n\tclass_code AS IN_class_code,\n\tclass_description_indicator AS IN_class_description_indicator,\n\tstate AS IN_location_state,\n\tclass_description_sequence AS IN_class_description_seq,\n\tclass_description AS IN_class_description,\n\t-- *INF*: IIF(ISNULL(IN_class_code) OR IS_SPACES(IN_class_code) OR LENGTH(IN_class_code)=0\r\n\t-- ,'N/A'\r\n\t-- ,ltrim(rtrim(IN_class_code)))\n\tIFF(IN_class_code IS NULL OR IS_SPACES(IN_class_code) OR LENGTH(IN_class_code) = 0, 'N/A', ltrim(rtrim(IN_class_code))) AS OUT_class_code,\n\tv_default_str AS OUT_class_loc_code,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_description_indicator )))  ,v_default_str,ltrim(rtrim(IN_class_description_indicator)))\n\tIFF(RTRIM(LTRIM(IN_class_description_indicator)) IS NULL, v_default_str, ltrim(rtrim(IN_class_description_indicator))) AS OUT_class_descript_ind,\n\tv_default_str AS OUT_mco,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_location_state  )))  ,v_default_str,ltrim(rtrim(IN_location_state)))\n\tIFF(RTRIM(LTRIM(IN_location_state)) IS NULL, v_default_str, ltrim(rtrim(IN_location_state))) AS OUT_class_loc_state,\n\tv_default_str AS OUT_subline,\n\tv_default_end_date AS OUT_gtam_exp_date,\n\t-- *INF*: IIF(ISNULL(IN_class_description_seq) OR IS_SPACES(IN_class_description_seq) OR\r\n\t-- LENGTH(IN_class_description_seq)=0,v_default_str,ltrim(rtrim(IN_class_description_seq)))\n\tIFF(IN_class_description_seq IS NULL OR IS_SPACES(IN_class_description_seq) OR LENGTH(IN_class_description_seq) = 0, v_default_str, ltrim(rtrim(IN_class_description_seq))) AS OUT_class_descript_num_seq,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_description  )))  ,v_default_str,ltrim(rtrim(IN_class_description)))\n\tIFF(RTRIM(LTRIM(IN_class_description)) IS NULL, v_default_str, ltrim(rtrim(IN_class_description))) AS OUT_class_description,\n\tv_default_str AS OUT_crime_ind\n\tFROM SQ_gtam_tl07rx_stage1\n),\nLKP_sup_class_code_tl07rx AS (\n\tSELECT\n\tsup_class_code_id,\n\tclass_code_descript,\n\tclass_code,\n\tclass_loc_code,\n\tclass_descript_ind,\n\tmco,\n\tclass_loc_state,\n\tsubline,\n\tgtam_exp_date,\n\tclass_descript_num_seq,\n\tcrime_ind\n\tFROM (\n\t\tSELECT \r\n\t\t\ttl.sup_class_code_id as sup_class_code_id, \t\r\n\t\t     RTRIM(LTRIM(\ttl.class_code_descript)) as class_code_descript, \t\r\n\t\t RTRIM(LTRIM(\ttl.crime_ind)) as crime_ind,\r\n\t\t       RTRIM(LTRIM( tl.class_code  )) as class_code,\r\n\t\t\t  RTRIM(LTRIM(tl.class_loc_code )) as class_loc_code ,\r\n\t\t\t  RTRIM(LTRIM(tl.class_descript_ind))  as class_descript_ind,\r\n\t\t  RTRIM(LTRIM(\ttl.mco))  as mco,\r\n\t\t\t  RTRIM(LTRIM(tl.class_loc_state))  as class_loc_state,\r\n\t\t  RTRIM(LTRIM(\ttl.subline))  as subline,\r\n\t\t\ttl.gtam_exp_date  as gtam_exp_date ,\r\n\t\t\t  RTRIM(LTRIM(tl.class_descript_num_seq))  as class_descript_num_seq\t\t\r\n\t\tFROM  \r\n\t\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code tl\r\n\t\tWHERE \r\n\t\t\ttl.crrnt_snpsht_flag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY class_code,class_loc_code,class_descript_ind,mco,class_loc_state,subline,gtam_exp_date,class_descript_num_seq,crime_ind ORDER BY sup_class_code_id) = 1\n),\nEXP_Detect_Changes_tl07rx AS (\n\tSELECT\n\tEXP_values_tl07rx.OUT_class_description AS class_description,\n\tLKP_sup_class_code_tl07rx.sup_class_code_id AS LKP_sup_class_code_id,\n\tLKP_sup_class_code_tl07rx.class_code_descript AS LKP_class_code_descript,\n\t1 AS crrnt_snapshot_flag,\n\t-- *INF*: IIF(ISNULL(LKP_sup_class_code_id),'NEW',\r\n\t-- \tIIF(\r\n\t-- \t(ltrim(rtrim(class_description)) <> ltrim(rtrim(LKP_class_code_descript))),\r\n\t-- \t'UPDATE',\r\n\t-- \t'NOCHANGE'))\n\tIFF(LKP_sup_class_code_id IS NULL, 'NEW', IFF(( ltrim(rtrim(class_description)) <> ltrim(rtrim(LKP_class_code_descript)) ), 'UPDATE', 'NOCHANGE')) AS v_Changed_Flag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS Audit_ID,\n\t-- *INF*: IIF(v_Changed_Flag='NEW',\r\n\t-- \tTO_DATE('01/01/1800 01:00:00','MM/DD/YYYY HH24:MI:SS'),\r\n\t-- \tTO_DATE(TO_CHAR(SYSDATE,'MM/DD/YYYY HH24:MI:SS'),'MM/DD/YYYY HH24:MI:SS'))\n\tIFF(v_Changed_Flag = 'NEW', TO_DATE('01/01/1800 01:00:00', 'MM/DD/YYYY HH24:MI:SS'), TO_DATE(TO_CHAR(SYSDATE, 'MM/DD/YYYY HH24:MI:SS'), 'MM/DD/YYYY HH24:MI:SS')) AS Eff_From_Date,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS Eff_To_Date,\n\tv_Changed_Flag AS Changed_Flag,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS Source_System_ID,\n\tSYSDATE AS Created_Date,\n\tSYSDATE AS Modified_Date,\n\tEXP_values_tl07rx.OUT_class_code AS class_code,\n\tEXP_values_tl07rx.OUT_class_loc_code AS class_loc_code,\n\tEXP_values_tl07rx.OUT_class_descript_ind AS class_descript_ind,\n\tEXP_values_tl07rx.OUT_mco AS mco,\n\tEXP_values_tl07rx.OUT_class_loc_state AS class_loc_state,\n\tEXP_values_tl07rx.OUT_subline AS subline,\n\tEXP_values_tl07rx.OUT_gtam_exp_date AS gtam_exp_date,\n\tEXP_values_tl07rx.OUT_class_descript_num_seq AS class_descript_num_seq,\n\tEXP_values_tl07rx.OUT_crime_ind AS crime_ind\n\tFROM EXP_values_tl07rx\n\tLEFT JOIN LKP_sup_class_code_tl07rx\n\tON LKP_sup_class_code_tl07rx.class_code = EXP_values_tl07rx.OUT_class_code AND LKP_sup_class_code_tl07rx.class_loc_code = EXP_values_tl07rx.OUT_class_loc_code AND LKP_sup_class_code_tl07rx.class_descript_ind = EXP_values_tl07rx.OUT_class_descript_ind AND LKP_sup_class_code_tl07rx.mco = EXP_values_tl07rx.OUT_mco AND LKP_sup_class_code_tl07rx.class_loc_state = EXP_values_tl07rx.OUT_class_loc_state AND LKP_sup_class_code_tl07rx.subline = EXP_values_tl07rx.OUT_subline AND LKP_sup_class_code_tl07rx.gtam_exp_date = EXP_values_tl07rx.OUT_gtam_exp_date AND LKP_sup_class_code_tl07rx.class_descript_num_seq = EXP_values_tl07rx.OUT_class_descript_num_seq AND LKP_sup_class_code_tl07rx.crime_ind = EXP_values_tl07rx.OUT_crime_ind\n),\nFIL_insert_tl07rx AS (\n\tSELECT\n\tcrrnt_snapshot_flag, \n\tAudit_ID, \n\tEff_From_Date, \n\tEff_To_Date, \n\tChanged_Flag, \n\tSource_System_ID, \n\tCreated_Date, \n\tModified_Date, \n\tclass_code, \n\tclass_loc_code, \n\tclass_descript_ind, \n\tmco, \n\tclass_loc_state, \n\tsubline, \n\tgtam_exp_date, \n\tclass_descript_num_seq, \n\tclass_description AS class_code_descript, \n\tcrime_ind\n\tFROM EXP_Detect_Changes_tl07rx\n\tWHERE Changed_Flag='NEW'  OR Changed_Flag='UPDATE'\n),\nINS_sup_class_code_tl07rx AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code\n\t(crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date, class_code, class_loc_code, class_descript_ind, mco, class_loc_state, subline, gtam_exp_date, class_descript_num_seq, crime_ind, class_code_descript)\n\tSELECT \n\tcrrnt_snapshot_flag AS CRRNT_SNPSHT_FLAG, \n\tAudit_ID AS AUDIT_ID, \n\tEff_From_Date AS EFF_FROM_DATE, \n\tEff_To_Date AS EFF_TO_DATE, \n\tSource_System_ID AS SOURCE_SYS_ID, \n\tCreated_Date AS CREATED_DATE, \n\tModified_Date AS MODIFIED_DATE, \n\tCLASS_CODE, \n\tCLASS_LOC_CODE, \n\tCLASS_DESCRIPT_IND, \n\tMCO, \n\tCLASS_LOC_STATE, \n\tSUBLINE, \n\tGTAM_EXP_DATE, \n\tCLASS_DESCRIPT_NUM_SEQ, \n\tCRIME_IND, \n\tCLASS_CODE_DESCRIPT\n\tFROM FIL_insert_tl07rx\n),\nSQ_gtam_tl63y_stage AS (\n\tSELECT location\r\n\t      ,master_company_number\r\n\t      ,location_state\r\n\t      ,subline\r\n\t      ,class_description_code       \r\n\t      ,crime_ind\r\n\t      ,eff_date\r\n\t      ,class_desc_num_seq\r\n\t      ,one_line_of_class_desc\r\n\tFROM gtam_tl63y_stage\n),\nEXP_values_tl63y AS (\n\tSELECT\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS v_default_end_date,\n\t'N/A' AS v_default_str,\n\tlocation AS IN_class_loc_code,\n\tmaster_company_number AS IN_mco_code,\n\tlocation_state AS IN_location_state,\n\tsubline AS IN_subline,\n\tclass_description_code AS IN_class_description_indicator,\n\tcrime_ind AS IN_crime_ind,\n\teff_date AS IN_exp_date,\n\tclass_desc_num_seq AS IN_class_description_seq,\n\tone_line_of_class_desc AS IN_class_description,\n\tv_default_str AS OUT_class_code,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_loc_code )))  ,v_default_str,ltrim(rtrim(IN_class_loc_code)))\n\tIFF(RTRIM(LTRIM(IN_class_loc_code)) IS NULL, v_default_str, ltrim(rtrim(IN_class_loc_code))) AS OUT_class_loc_code,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_description_indicator )))  ,v_default_str,ltrim(rtrim(IN_class_description_indicator)))\n\tIFF(RTRIM(LTRIM(IN_class_description_indicator)) IS NULL, v_default_str, ltrim(rtrim(IN_class_description_indicator))) AS OUT_class_descript_ind,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_mco_code )))  ,v_default_str,ltrim(rtrim(IN_mco_code)))\n\tIFF(RTRIM(LTRIM(IN_mco_code)) IS NULL, v_default_str, ltrim(rtrim(IN_mco_code))) AS OUT_mco,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_location_state  )))  ,v_default_str,ltrim(rtrim(IN_location_state)))\n\tIFF(RTRIM(LTRIM(IN_location_state)) IS NULL, v_default_str, ltrim(rtrim(IN_location_state))) AS OUT_class_loc_state,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_subline  )))  ,v_default_str,ltrim(rtrim(IN_subline)))\n\tIFF(RTRIM(LTRIM(IN_subline)) IS NULL, v_default_str, ltrim(rtrim(IN_subline))) AS OUT_subline,\n\t-- *INF*: DECODE(  RTRIM(LTRIM( IN_exp_date )),\r\n\t--     NULL , v_default_end_date,      \r\n\t--     '99999999', v_default_end_date ,\r\n\t--     \r\n\t-- IIF(IS_DATE(IN_exp_date,'YYYYMMDD') = 1, \r\n\t-- ADD_TO_DATE(\r\n\t-- TO_DATE(IN_exp_date,'YYYYMMDD') ,'DD',1) ,\r\n\t-- \r\n\t-- ---\r\n\t-- ADD_TO_DATE(LAST_DAY(\r\n\t-- TO_DATE(\r\n\t-- CONCAT(     SUBSTR(IN_exp_date,1,6)  ,'01')\r\n\t-- \r\n\t-- ,'YYYYMMDD')),'DD',1) \r\n\t-- \r\n\t-- ))\r\n\t--          \n\tDECODE(RTRIM(LTRIM(IN_exp_date)),\n\t\tNULL, v_default_end_date,\n\t\t'99999999', v_default_end_date,\n\t\tIFF(IS_DATE(IN_exp_date, 'YYYYMMDD') = 1, ADD_TO_DATE(TO_DATE(IN_exp_date, 'YYYYMMDD'), 'DD', 1), ADD_TO_DATE(LAST_DAY(TO_DATE(CONCAT(SUBSTR(IN_exp_date, 1, 6), '01'), 'YYYYMMDD')), 'DD', 1))) AS v_exp_date,\n\tv_exp_date AS OUT_exp_date,\n\t-- *INF*: IIF(ISNULL(IN_class_description_seq) OR IS_SPACES(IN_class_description_seq) OR\r\n\t-- LENGTH(IN_class_description_seq)=0,v_default_str,ltrim(rtrim(IN_class_description_seq)))\n\tIFF(IN_class_description_seq IS NULL OR IS_SPACES(IN_class_description_seq) OR LENGTH(IN_class_description_seq) = 0, v_default_str, ltrim(rtrim(IN_class_description_seq))) AS OUT_class_descript_num_seq,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_description  )))  ,v_default_str,ltrim(rtrim(IN_class_description)))\n\tIFF(RTRIM(LTRIM(IN_class_description)) IS NULL, v_default_str, ltrim(rtrim(IN_class_description))) AS OUT_class_description,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_crime_ind  ))) OR IS_SPACES(IN_crime_ind)\r\n\t-- OR LENGTH( IN_crime_ind) = 0\r\n\t-- \r\n\t--   ,v_default_str,ltrim(rtrim(IN_crime_ind)))\n\tIFF(RTRIM(LTRIM(IN_crime_ind)) IS NULL OR IS_SPACES(IN_crime_ind) OR LENGTH(IN_crime_ind) = 0, v_default_str, ltrim(rtrim(IN_crime_ind))) AS OUT_crime_ind\n\tFROM SQ_gtam_tl63y_stage\n),\nLKP_sup_class_code_tl63y AS (\n\tSELECT\n\tsup_class_code_id,\n\tclass_code_descript,\n\tclass_code,\n\tclass_loc_code,\n\tclass_descript_ind,\n\tmco,\n\tclass_loc_state,\n\tsubline,\n\tgtam_exp_date,\n\tclass_descript_num_seq,\n\tcrime_ind\n\tFROM (\n\t\tSELECT \r\n\t\t\ttl.sup_class_code_id as sup_class_code_id, \t\r\n\t\t     RTRIM(LTRIM(\ttl.class_code_descript)) as class_code_descript, \t\r\n\t\t RTRIM(LTRIM(\ttl.crime_ind)) as crime_ind,\r\n\t\t       RTRIM(LTRIM( tl.class_code  )) as class_code,\r\n\t\t\t  RTRIM(LTRIM(tl.class_loc_code )) as class_loc_code ,\r\n\t\t\t  RTRIM(LTRIM(tl.class_descript_ind))  as class_descript_ind,\r\n\t\t  RTRIM(LTRIM(\ttl.mco))  as mco,\r\n\t\t\t  RTRIM(LTRIM(tl.class_loc_state))  as class_loc_state,\r\n\t\t  RTRIM(LTRIM(\ttl.subline))  as subline,\r\n\t\t\ttl.gtam_exp_date  as gtam_exp_date ,\r\n\t\t\t  RTRIM(LTRIM(tl.class_descript_num_seq))  as class_descript_num_seq\t\t\r\n\t\tFROM  \r\n\t\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code tl\r\n\t\tWHERE \r\n\t\t\ttl.crrnt_snpsht_flag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY class_code,class_loc_code,class_descript_ind,mco,class_loc_state,subline,gtam_exp_date,class_descript_num_seq,crime_ind ORDER BY sup_class_code_id) = 1\n),\nEXP_Detect_Changes_tl63y AS (\n\tSELECT\n\tEXP_values_tl63y.OUT_class_description AS class_description,\n\tLKP_sup_class_code_tl63y.sup_class_code_id AS LKP_sup_class_code_id,\n\tLKP_sup_class_code_tl63y.class_code_descript AS LKP_class_code_descript,\n\t1 AS crrnt_snapshot_flag,\n\t-- *INF*: IIF(ISNULL(LKP_sup_class_code_id),'NEW',\r\n\t-- \tIIF(\r\n\t-- \t(ltrim(rtrim(class_description)) <> ltrim(rtrim(LKP_class_code_descript))),\r\n\t-- \t'UPDATE',\r\n\t-- \t'NOCHANGE'))\n\tIFF(LKP_sup_class_code_id IS NULL, 'NEW', IFF(( ltrim(rtrim(class_description)) <> ltrim(rtrim(LKP_class_code_descript)) ), 'UPDATE', 'NOCHANGE')) AS v_Changed_Flag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS Audit_ID,\n\t-- *INF*: IIF(v_Changed_Flag='NEW',\r\n\t-- \tTO_DATE('01/01/1800 01:00:00','MM/DD/YYYY HH24:MI:SS'),\r\n\t-- \tTO_DATE(TO_CHAR(SYSDATE,'MM/DD/YYYY HH24:MI:SS'),'MM/DD/YYYY HH24:MI:SS'))\n\tIFF(v_Changed_Flag = 'NEW', TO_DATE('01/01/1800 01:00:00', 'MM/DD/YYYY HH24:MI:SS'), TO_DATE(TO_CHAR(SYSDATE, 'MM/DD/YYYY HH24:MI:SS'), 'MM/DD/YYYY HH24:MI:SS')) AS Eff_From_Date,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS Eff_To_Date,\n\tv_Changed_Flag AS Changed_Flag,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS Source_System_ID,\n\tSYSDATE AS Created_Date,\n\tSYSDATE AS Modified_Date,\n\tEXP_values_tl63y.OUT_class_code AS class_code,\n\tEXP_values_tl63y.OUT_class_loc_code AS class_loc_code,\n\tEXP_values_tl63y.OUT_class_descript_ind AS class_descript_ind,\n\tEXP_values_tl63y.OUT_mco AS mco,\n\tEXP_values_tl63y.OUT_class_loc_state AS class_loc_state,\n\tEXP_values_tl63y.OUT_subline AS subline,\n\tEXP_values_tl63y.OUT_exp_date AS gtam_exp_date,\n\tEXP_values_tl63y.OUT_class_descript_num_seq AS class_descript_num_seq,\n\tEXP_values_tl63y.OUT_crime_ind AS crime_ind\n\tFROM EXP_values_tl63y\n\tLEFT JOIN LKP_sup_class_code_tl63y\n\tON LKP_sup_class_code_tl63y.class_code = EXP_values_tl63y.OUT_class_code AND LKP_sup_class_code_tl63y.class_loc_code = EXP_values_tl63y.OUT_class_loc_code AND LKP_sup_class_code_tl63y.class_descript_ind = EXP_values_tl63y.OUT_class_descript_ind AND LKP_sup_class_code_tl63y.mco = EXP_values_tl63y.OUT_mco AND LKP_sup_class_code_tl63y.class_loc_state = EXP_values_tl63y.OUT_class_loc_state AND LKP_sup_class_code_tl63y.subline = EXP_values_tl63y.OUT_subline AND LKP_sup_class_code_tl63y.gtam_exp_date = EXP_values_tl63y.OUT_exp_date AND LKP_sup_class_code_tl63y.class_descript_num_seq = EXP_values_tl63y.OUT_class_descript_num_seq AND LKP_sup_class_code_tl63y.crime_ind = EXP_values_tl63y.OUT_crime_ind\n),\nFIL_insert_tl63y AS (\n\tSELECT\n\tcrrnt_snapshot_flag, \n\tAudit_ID, \n\tEff_From_Date, \n\tEff_To_Date, \n\tChanged_Flag, \n\tSource_System_ID, \n\tCreated_Date, \n\tModified_Date, \n\tclass_code, \n\tclass_loc_code, \n\tclass_descript_ind, \n\tmco, \n\tclass_loc_state, \n\tsubline, \n\tgtam_exp_date, \n\tclass_descript_num_seq, \n\tclass_description AS class_code_descript, \n\tcrime_ind\n\tFROM EXP_Detect_Changes_tl63y\n\tWHERE Changed_Flag='NEW'  OR Changed_Flag='UPDATE'\n),\nINS_sup_class_code_tl63y AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code\n\t(crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date, class_code, class_loc_code, class_descript_ind, mco, class_loc_state, subline, gtam_exp_date, class_descript_num_seq, crime_ind, class_code_descript)\n\tSELECT \n\tcrrnt_snapshot_flag AS CRRNT_SNPSHT_FLAG, \n\tAudit_ID AS AUDIT_ID, \n\tEff_From_Date AS EFF_FROM_DATE, \n\tEff_To_Date AS EFF_TO_DATE, \n\tSource_System_ID AS SOURCE_SYS_ID, \n\tCreated_Date AS CREATED_DATE, \n\tModified_Date AS MODIFIED_DATE, \n\tCLASS_CODE, \n\tCLASS_LOC_CODE, \n\tCLASS_DESCRIPT_IND, \n\tMCO, \n\tCLASS_LOC_STATE, \n\tSUBLINE, \n\tGTAM_EXP_DATE, \n\tCLASS_DESCRIPT_NUM_SEQ, \n\tCRIME_IND, \n\tCLASS_CODE_DESCRIPT\n\tFROM FIL_insert_tl63y\n),\nSQ_gtam_tl63x_stage AS (\n\tSELECT  \r\n\t      location\r\n\t      ,master_company_number\r\n\t      ,location_state\r\n\t      ,class_description_code   \r\n\t      ,crime_ind\r\n\t      ,eff_date\r\n\t      ,class_desc_num_seq       \r\n\t      ,one_line_of_class_desc      \r\n\t  FROM  gtam_tl63x_stage\n),\nEXP_values_tl63x AS (\n\tSELECT\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS v_default_end_date,\n\t'N/A' AS v_default_str,\n\tlocation AS IN_class_loc_code,\n\tmaster_company_number AS IN_mco_code,\n\tlocation_state AS IN_location_state,\n\tclass_description_code AS IN_class_description_indicator,\n\tcrime_ind AS IN_crime_ind,\n\teff_date AS IN_exp_date,\n\tclass_desc_num_seq AS IN_class_description_seq,\n\tone_line_of_class_desc AS IN_class_description,\n\tv_default_str AS OUT_class_code,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_loc_code )))  ,v_default_str,ltrim(rtrim(IN_class_loc_code)))\n\tIFF(RTRIM(LTRIM(IN_class_loc_code)) IS NULL, v_default_str, ltrim(rtrim(IN_class_loc_code))) AS OUT_class_loc_code,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_description_indicator )))  ,v_default_str,ltrim(rtrim(IN_class_description_indicator)))\n\tIFF(RTRIM(LTRIM(IN_class_description_indicator)) IS NULL, v_default_str, ltrim(rtrim(IN_class_description_indicator))) AS OUT_class_descript_ind,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_mco_code )))  ,v_default_str,ltrim(rtrim(IN_mco_code)))\n\tIFF(RTRIM(LTRIM(IN_mco_code)) IS NULL, v_default_str, ltrim(rtrim(IN_mco_code))) AS OUT_mco,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_location_state  )))  ,v_default_str,ltrim(rtrim(IN_location_state)))\n\tIFF(RTRIM(LTRIM(IN_location_state)) IS NULL, v_default_str, ltrim(rtrim(IN_location_state))) AS OUT_class_loc_state,\n\tv_default_str AS OUT_subline,\n\t-- *INF*: DECODE(  RTRIM(LTRIM( IN_exp_date )),\r\n\t--     NULL , v_default_end_date,      \r\n\t--     '99999999', v_default_end_date ,\r\n\t--     \r\n\t-- IIF(IS_DATE(IN_exp_date,'YYYYMMDD') = 1, \r\n\t-- ADD_TO_DATE(\r\n\t-- TO_DATE(IN_exp_date,'YYYYMMDD') ,'DD',1) ,\r\n\t-- \r\n\t-- ---\r\n\t-- ADD_TO_DATE(LAST_DAY(\r\n\t-- TO_DATE(\r\n\t-- CONCAT(     SUBSTR(IN_exp_date,1,6)  ,'01')\r\n\t-- \r\n\t-- ,'YYYYMMDD')),'DD',1) \r\n\t-- \r\n\t-- ))\r\n\t--          \n\tDECODE(RTRIM(LTRIM(IN_exp_date)),\n\t\tNULL, v_default_end_date,\n\t\t'99999999', v_default_end_date,\n\t\tIFF(IS_DATE(IN_exp_date, 'YYYYMMDD') = 1, ADD_TO_DATE(TO_DATE(IN_exp_date, 'YYYYMMDD'), 'DD', 1), ADD_TO_DATE(LAST_DAY(TO_DATE(CONCAT(SUBSTR(IN_exp_date, 1, 6), '01'), 'YYYYMMDD')), 'DD', 1))) AS v_exp_date,\n\tv_exp_date AS OUT_exp_date,\n\t-- *INF*: IIF(ISNULL(IN_class_description_seq) OR IS_SPACES(IN_class_description_seq) OR\r\n\t-- LENGTH(IN_class_description_seq)=0,v_default_str,ltrim(rtrim(IN_class_description_seq)))\n\tIFF(IN_class_description_seq IS NULL OR IS_SPACES(IN_class_description_seq) OR LENGTH(IN_class_description_seq) = 0, v_default_str, ltrim(rtrim(IN_class_description_seq))) AS OUT_class_descript_num_seq,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_description  )))  ,v_default_str,ltrim(rtrim(IN_class_description)))\n\tIFF(RTRIM(LTRIM(IN_class_description)) IS NULL, v_default_str, ltrim(rtrim(IN_class_description))) AS OUT_class_description,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_crime_ind  ))) OR IS_SPACES(IN_crime_ind)\r\n\t-- OR LENGTH( IN_crime_ind) = 0\r\n\t-- \r\n\t--   ,v_default_str,ltrim(rtrim(IN_crime_ind)))\r\n\t-- \r\n\t-- \r\n\t--  \n\tIFF(RTRIM(LTRIM(IN_crime_ind)) IS NULL OR IS_SPACES(IN_crime_ind) OR LENGTH(IN_crime_ind) = 0, v_default_str, ltrim(rtrim(IN_crime_ind))) AS OUT_crime_ind\n\tFROM SQ_gtam_tl63x_stage\n),\nLKP_sup_class_code_tl63x AS (\n\tSELECT\n\tsup_class_code_id,\n\tclass_code_descript,\n\tclass_code,\n\tclass_loc_code,\n\tclass_descript_ind,\n\tmco,\n\tclass_loc_state,\n\tsubline,\n\tgtam_exp_date,\n\tclass_descript_num_seq,\n\tcrime_ind\n\tFROM (\n\t\tSELECT \r\n\t\t\ttl.sup_class_code_id as sup_class_code_id, \t\r\n\t\t     RTRIM(LTRIM(\ttl.class_code_descript)) as class_code_descript, \t\r\n\t\t RTRIM(LTRIM(\ttl.crime_ind)) as crime_ind,\r\n\t\t       RTRIM(LTRIM( tl.class_code  )) as class_code,\r\n\t\t\t  RTRIM(LTRIM(tl.class_loc_code )) as class_loc_code ,\r\n\t\t\t  RTRIM(LTRIM(tl.class_descript_ind))  as class_descript_ind,\r\n\t\t  RTRIM(LTRIM(\ttl.mco))  as mco,\r\n\t\t\t  RTRIM(LTRIM(tl.class_loc_state))  as class_loc_state,\r\n\t\t  RTRIM(LTRIM(\ttl.subline))  as subline,\r\n\t\t\ttl.gtam_exp_date  as gtam_exp_date ,\r\n\t\t\t  RTRIM(LTRIM(tl.class_descript_num_seq))  as class_descript_num_seq\t\t\r\n\t\tFROM  \r\n\t\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code tl\r\n\t\tWHERE \r\n\t\t\ttl.crrnt_snpsht_flag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY class_code,class_loc_code,class_descript_ind,mco,class_loc_state,subline,gtam_exp_date,class_descript_num_seq,crime_ind ORDER BY sup_class_code_id) = 1\n),\nEXP_Detect_Changes_tl63x AS (\n\tSELECT\n\tEXP_values_tl63x.OUT_class_description AS class_description,\n\tLKP_sup_class_code_tl63x.sup_class_code_id AS LKP_sup_class_code_id,\n\tLKP_sup_class_code_tl63x.class_code_descript AS LKP_class_code_descript,\n\t1 AS crrnt_snapshot_flag,\n\t-- *INF*: IIF(ISNULL(LKP_sup_class_code_id),'NEW',\r\n\t-- \tIIF(\r\n\t-- \t(ltrim(rtrim(class_description)) <> ltrim(rtrim(LKP_class_code_descript))),\r\n\t-- \t'UPDATE',\r\n\t-- \t'NOCHANGE'))\n\tIFF(LKP_sup_class_code_id IS NULL, 'NEW', IFF(( ltrim(rtrim(class_description)) <> ltrim(rtrim(LKP_class_code_descript)) ), 'UPDATE', 'NOCHANGE')) AS v_Changed_Flag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS Audit_ID,\n\t-- *INF*: IIF(v_Changed_Flag='NEW',\r\n\t-- \tTO_DATE('01/01/1800 01:00:00','MM/DD/YYYY HH24:MI:SS'),\r\n\t-- \tTO_DATE(TO_CHAR(SYSDATE,'MM/DD/YYYY HH24:MI:SS'),'MM/DD/YYYY HH24:MI:SS'))\n\tIFF(v_Changed_Flag = 'NEW', TO_DATE('01/01/1800 01:00:00', 'MM/DD/YYYY HH24:MI:SS'), TO_DATE(TO_CHAR(SYSDATE, 'MM/DD/YYYY HH24:MI:SS'), 'MM/DD/YYYY HH24:MI:SS')) AS Eff_From_Date,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS Eff_To_Date,\n\tv_Changed_Flag AS Changed_Flag,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS Source_System_ID,\n\tSYSDATE AS Created_Date,\n\tSYSDATE AS Modified_Date,\n\tEXP_values_tl63x.OUT_class_code AS class_code,\n\tEXP_values_tl63x.OUT_class_loc_code AS class_loc_code,\n\tEXP_values_tl63x.OUT_class_descript_ind AS class_descript_ind,\n\tEXP_values_tl63x.OUT_mco AS mco,\n\tEXP_values_tl63x.OUT_class_loc_state AS class_loc_state,\n\tEXP_values_tl63x.OUT_subline AS subline,\n\tEXP_values_tl63x.OUT_exp_date AS gtam_exp_date,\n\tEXP_values_tl63x.OUT_class_descript_num_seq AS class_descript_num_seq,\n\tEXP_values_tl63x.OUT_crime_ind AS crime_ind\n\tFROM EXP_values_tl63x\n\tLEFT JOIN LKP_sup_class_code_tl63x\n\tON LKP_sup_class_code_tl63x.class_code = EXP_values_tl63x.OUT_class_code AND LKP_sup_class_code_tl63x.class_loc_code = EXP_values_tl63x.OUT_class_loc_code AND LKP_sup_class_code_tl63x.class_descript_ind = EXP_values_tl63x.OUT_class_descript_ind AND LKP_sup_class_code_tl63x.mco = EXP_values_tl63x.OUT_mco AND LKP_sup_class_code_tl63x.class_loc_state = EXP_values_tl63x.OUT_class_loc_state AND LKP_sup_class_code_tl63x.subline = EXP_values_tl63x.OUT_subline AND LKP_sup_class_code_tl63x.gtam_exp_date = EXP_values_tl63x.OUT_exp_date AND LKP_sup_class_code_tl63x.class_descript_num_seq = EXP_values_tl63x.OUT_class_descript_num_seq AND LKP_sup_class_code_tl63x.crime_ind = EXP_values_tl63x.OUT_crime_ind\n),\nFIL_insert_tl63x AS (\n\tSELECT\n\tcrrnt_snapshot_flag, \n\tAudit_ID, \n\tEff_From_Date, \n\tEff_To_Date, \n\tChanged_Flag, \n\tSource_System_ID, \n\tCreated_Date, \n\tModified_Date, \n\tclass_code, \n\tclass_loc_code, \n\tclass_descript_ind, \n\tmco, \n\tclass_loc_state, \n\tsubline, \n\tgtam_exp_date, \n\tclass_descript_num_seq, \n\tclass_description AS class_code_descript, \n\tcrime_ind\n\tFROM EXP_Detect_Changes_tl63x\n\tWHERE Changed_Flag='NEW'  OR Changed_Flag='UPDATE'\n),\nINS_sup_class_code_tl63x AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code\n\t(crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date, class_code, class_loc_code, class_descript_ind, mco, class_loc_state, subline, gtam_exp_date, class_descript_num_seq, crime_ind, class_code_descript)\n\tSELECT \n\tcrrnt_snapshot_flag AS CRRNT_SNPSHT_FLAG, \n\tAudit_ID AS AUDIT_ID, \n\tEff_From_Date AS EFF_FROM_DATE, \n\tEff_To_Date AS EFF_TO_DATE, \n\tSource_System_ID AS SOURCE_SYS_ID, \n\tCreated_Date AS CREATED_DATE, \n\tModified_Date AS MODIFIED_DATE, \n\tCLASS_CODE, \n\tCLASS_LOC_CODE, \n\tCLASS_DESCRIPT_IND, \n\tMCO, \n\tCLASS_LOC_STATE, \n\tSUBLINE, \n\tGTAM_EXP_DATE, \n\tCLASS_DESCRIPT_NUM_SEQ, \n\tCRIME_IND, \n\tCLASS_CODE_DESCRIPT\n\tFROM FIL_insert_tl63x\n),\nSQ_gtam_tm530x_stage AS (\n\tSELECT a.location\r\n\t      ,a.master_company_number\r\n\t      ,a.state\r\n\t      ,a.class_description_code\r\n\t      ,a.crime_indicator\r\n\t      ,a.expiration_date\r\n\t     ,a.screen_class_descr \r\n\tFROM gtam_tm530x_stage a\n),\nEXP_values_tm530x AS (\n\tSELECT\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS v_default_end_date,\n\t'N/A' AS v_default_str,\n\tlocation AS IN_class_loc_code,\n\tmaster_company_number AS IN_mco_code,\n\tstate AS IN_location_state,\n\tclass_description_code AS IN_class_description_indicator,\n\tcrime_indicator AS IN_crime_ind,\n\texpiration_date AS IN_exp_date,\n\tscreen_class_descr AS IN_class_description,\n\tv_default_str AS OUT_class_code,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_loc_code )))  ,v_default_str,ltrim(rtrim(IN_class_loc_code)))\n\tIFF(RTRIM(LTRIM(IN_class_loc_code)) IS NULL, v_default_str, ltrim(rtrim(IN_class_loc_code))) AS OUT_class_loc_code,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_description_indicator )))  ,v_default_str,ltrim(rtrim(IN_class_description_indicator)))\n\tIFF(RTRIM(LTRIM(IN_class_description_indicator)) IS NULL, v_default_str, ltrim(rtrim(IN_class_description_indicator))) AS OUT_class_descript_ind,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_mco_code )))  ,v_default_str,ltrim(rtrim(IN_mco_code)))\n\tIFF(RTRIM(LTRIM(IN_mco_code)) IS NULL, v_default_str, ltrim(rtrim(IN_mco_code))) AS OUT_mco,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_location_state  )))  ,v_default_str,ltrim(rtrim(IN_location_state)))\n\tIFF(RTRIM(LTRIM(IN_location_state)) IS NULL, v_default_str, ltrim(rtrim(IN_location_state))) AS OUT_class_loc_state,\n\tv_default_str AS OUT_subline,\n\t-- *INF*: DECODE(  RTRIM(LTRIM( IN_exp_date )),\r\n\t--     NULL , v_default_end_date,      \r\n\t--     '99999999', v_default_end_date ,\r\n\t--     \r\n\t-- IIF(IS_DATE(IN_exp_date,'YYYYMMDD') = 1, \r\n\t-- ADD_TO_DATE(\r\n\t-- TO_DATE(IN_exp_date,'YYYYMMDD') ,'DD',1) ,\r\n\t-- \r\n\t-- ---\r\n\t-- ADD_TO_DATE(LAST_DAY(\r\n\t-- TO_DATE(\r\n\t-- CONCAT(     SUBSTR(IN_exp_date,1,6)  ,'01')\r\n\t-- \r\n\t-- ,'YYYYMMDD')),'DD',1) \r\n\t-- \r\n\t-- ))\r\n\t--          \n\tDECODE(RTRIM(LTRIM(IN_exp_date)),\n\t\tNULL, v_default_end_date,\n\t\t'99999999', v_default_end_date,\n\t\tIFF(IS_DATE(IN_exp_date, 'YYYYMMDD') = 1, ADD_TO_DATE(TO_DATE(IN_exp_date, 'YYYYMMDD'), 'DD', 1), ADD_TO_DATE(LAST_DAY(TO_DATE(CONCAT(SUBSTR(IN_exp_date, 1, 6), '01'), 'YYYYMMDD')), 'DD', 1))) AS v_exp_date,\n\tv_exp_date AS OUT_exp_date,\n\tv_default_str AS OUT_class_descript_num_seq,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_description  )))  ,v_default_str,ltrim(rtrim(IN_class_description)))\n\tIFF(RTRIM(LTRIM(IN_class_description)) IS NULL, v_default_str, ltrim(rtrim(IN_class_description))) AS OUT_class_description,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_crime_ind  ))) OR IS_SPACES(IN_crime_ind)\r\n\t-- OR LENGTH( IN_crime_ind) = 0\r\n\t-- \r\n\t--   ,v_default_str,ltrim(rtrim(IN_crime_ind)))\n\tIFF(RTRIM(LTRIM(IN_crime_ind)) IS NULL OR IS_SPACES(IN_crime_ind) OR LENGTH(IN_crime_ind) = 0, v_default_str, ltrim(rtrim(IN_crime_ind))) AS OUT_crime_ind\n\tFROM SQ_gtam_tm530x_stage\n),\nLKP_sup_class_code_tm530x AS (\n\tSELECT\n\tsup_class_code_id,\n\tclass_code_descript,\n\tclass_code,\n\tclass_loc_code,\n\tclass_descript_ind,\n\tmco,\n\tclass_loc_state,\n\tsubline,\n\tgtam_exp_date,\n\tclass_descript_num_seq,\n\tcrime_ind\n\tFROM (\n\t\tSELECT \r\n\t\t\ttl.sup_class_code_id as sup_class_code_id, \t\r\n\t\t     RTRIM(LTRIM(\ttl.class_code_descript)) as class_code_descript, \t\r\n\t\t RTRIM(LTRIM(\ttl.crime_ind)) as crime_ind,\r\n\t\t       RTRIM(LTRIM( tl.class_code  )) as class_code,\r\n\t\t\t  RTRIM(LTRIM(tl.class_loc_code )) as class_loc_code ,\r\n\t\t\t  RTRIM(LTRIM(tl.class_descript_ind))  as class_descript_ind,\r\n\t\t  RTRIM(LTRIM(\ttl.mco))  as mco,\r\n\t\t\t  RTRIM(LTRIM(tl.class_loc_state))  as class_loc_state,\r\n\t\t  RTRIM(LTRIM(\ttl.subline))  as subline,\r\n\t\t\ttl.gtam_exp_date  as gtam_exp_date ,\r\n\t\t\t  RTRIM(LTRIM(tl.class_descript_num_seq))  as class_descript_num_seq\t\t\r\n\t\tFROM  \r\n\t\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code tl\r\n\t\tWHERE \r\n\t\t\ttl.crrnt_snpsht_flag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY class_code,class_loc_code,class_descript_ind,mco,class_loc_state,subline,gtam_exp_date,class_descript_num_seq,crime_ind ORDER BY sup_class_code_id) = 1\n),\nEXP_Detect_Changes_tm530x AS (\n\tSELECT\n\tEXP_values_tm530x.OUT_class_description AS class_description,\n\tLKP_sup_class_code_tm530x.sup_class_code_id AS LKP_sup_class_code_id,\n\tLKP_sup_class_code_tm530x.class_code_descript AS LKP_class_code_descript,\n\t1 AS crrnt_snapshot_flag,\n\t-- *INF*: IIF(ISNULL(LKP_sup_class_code_id),'NEW',\r\n\t-- \tIIF(\r\n\t-- \t(ltrim(rtrim(class_description)) <> ltrim(rtrim(LKP_class_code_descript))),\r\n\t-- \t'UPDATE',\r\n\t-- \t'NOCHANGE'))\n\tIFF(LKP_sup_class_code_id IS NULL, 'NEW', IFF(( ltrim(rtrim(class_description)) <> ltrim(rtrim(LKP_class_code_descript)) ), 'UPDATE', 'NOCHANGE')) AS v_Changed_Flag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS Audit_ID,\n\t-- *INF*: IIF(v_Changed_Flag='NEW',\r\n\t-- \tTO_DATE('01/01/1800 01:00:00','MM/DD/YYYY HH24:MI:SS'),\r\n\t-- \tTO_DATE(TO_CHAR(SYSDATE,'MM/DD/YYYY HH24:MI:SS'),'MM/DD/YYYY HH24:MI:SS'))\n\tIFF(v_Changed_Flag = 'NEW', TO_DATE('01/01/1800 01:00:00', 'MM/DD/YYYY HH24:MI:SS'), TO_DATE(TO_CHAR(SYSDATE, 'MM/DD/YYYY HH24:MI:SS'), 'MM/DD/YYYY HH24:MI:SS')) AS Eff_From_Date,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS Eff_To_Date,\n\tv_Changed_Flag AS Changed_Flag,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS Source_System_ID,\n\tSYSDATE AS Created_Date,\n\tSYSDATE AS Modified_Date,\n\tEXP_values_tm530x.OUT_class_code AS class_code,\n\tEXP_values_tm530x.OUT_class_loc_code AS class_loc_code,\n\tEXP_values_tm530x.OUT_class_descript_ind AS class_descript_ind,\n\tEXP_values_tm530x.OUT_mco AS mco,\n\tEXP_values_tm530x.OUT_class_loc_state AS class_loc_state,\n\tEXP_values_tm530x.OUT_subline AS subline,\n\tEXP_values_tm530x.OUT_exp_date AS gtam_exp_date,\n\tEXP_values_tm530x.OUT_class_descript_num_seq AS class_descript_num_seq,\n\tEXP_values_tm530x.OUT_crime_ind AS crime_ind\n\tFROM EXP_values_tm530x\n\tLEFT JOIN LKP_sup_class_code_tm530x\n\tON LKP_sup_class_code_tm530x.class_code = EXP_values_tm530x.OUT_class_code AND LKP_sup_class_code_tm530x.class_loc_code = EXP_values_tm530x.OUT_class_loc_code AND LKP_sup_class_code_tm530x.class_descript_ind = EXP_values_tm530x.OUT_class_descript_ind AND LKP_sup_class_code_tm530x.mco = EXP_values_tm530x.OUT_mco AND LKP_sup_class_code_tm530x.class_loc_state = EXP_values_tm530x.OUT_class_loc_state AND LKP_sup_class_code_tm530x.subline = EXP_values_tm530x.OUT_subline AND LKP_sup_class_code_tm530x.gtam_exp_date = EXP_values_tm530x.OUT_exp_date AND LKP_sup_class_code_tm530x.class_descript_num_seq = EXP_values_tm530x.OUT_class_descript_num_seq AND LKP_sup_class_code_tm530x.crime_ind = EXP_values_tm530x.OUT_crime_ind\n),\nFIL_insert_tm530x AS (\n\tSELECT\n\tcrrnt_snapshot_flag, \n\tAudit_ID, \n\tEff_From_Date, \n\tEff_To_Date, \n\tChanged_Flag, \n\tSource_System_ID, \n\tCreated_Date, \n\tModified_Date, \n\tclass_code, \n\tclass_loc_code, \n\tclass_descript_ind, \n\tmco, \n\tclass_loc_state, \n\tsubline, \n\tgtam_exp_date, \n\tclass_descript_num_seq, \n\tcrime_ind, \n\tclass_description AS class_code_descript\n\tFROM EXP_Detect_Changes_tm530x\n\tWHERE Changed_Flag='NEW'  OR Changed_Flag='UPDATE'\n),\nINS_sup_class_code_tm530x AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code\n\t(crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date, class_code, class_loc_code, class_descript_ind, mco, class_loc_state, subline, gtam_exp_date, class_descript_num_seq, crime_ind, class_code_descript)\n\tSELECT \n\tcrrnt_snapshot_flag AS CRRNT_SNPSHT_FLAG, \n\tAudit_ID AS AUDIT_ID, \n\tEff_From_Date AS EFF_FROM_DATE, \n\tEff_To_Date AS EFF_TO_DATE, \n\tSource_System_ID AS SOURCE_SYS_ID, \n\tCreated_Date AS CREATED_DATE, \n\tModified_Date AS MODIFIED_DATE, \n\tCLASS_CODE, \n\tCLASS_LOC_CODE, \n\tCLASS_DESCRIPT_IND, \n\tMCO, \n\tCLASS_LOC_STATE, \n\tSUBLINE, \n\tGTAM_EXP_DATE, \n\tCLASS_DESCRIPT_NUM_SEQ, \n\tCRIME_IND, \n\tCLASS_CODE_DESCRIPT\n\tFROM FIL_insert_tm530x\n),\nSQ_gtam_tm530xe_seq1_stage AS (\n\tSELECT location\r\n\t      ,policy_company\r\n\t      ,state\r\n\t      ,business_classification_code    \r\n\t      ,expiration_date    \r\n\t      ,long_desc  \r\n\t FROM gtam_tm530xe_seq1_stage\n),\nEXP_values_tm530xe_seq1 AS (\n\tSELECT\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS v_default_end_date,\n\t'N/A' AS v_default_str,\n\tlocation AS IN_class_loc_code,\n\tpolicy_company AS IN_mco_code,\n\tstate AS IN_location_state,\n\tbusiness_classification_code AS IN_class_code,\n\texpiration_date AS IN_exp_date,\n\tlong_desc AS IN_class_description,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_code )))  ,v_default_str,ltrim(rtrim(IN_class_code)))\n\tIFF(RTRIM(LTRIM(IN_class_code)) IS NULL, v_default_str, ltrim(rtrim(IN_class_code))) AS OUT_class_code,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_loc_code )))  ,v_default_str,ltrim(rtrim(IN_class_loc_code)))\n\tIFF(RTRIM(LTRIM(IN_class_loc_code)) IS NULL, v_default_str, ltrim(rtrim(IN_class_loc_code))) AS OUT_class_loc_code,\n\tv_default_str AS OUT_class_descript_ind,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_mco_code )))  ,v_default_str,ltrim(rtrim(IN_mco_code)))\n\tIFF(RTRIM(LTRIM(IN_mco_code)) IS NULL, v_default_str, ltrim(rtrim(IN_mco_code))) AS OUT_mco,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_location_state  )))  ,v_default_str,ltrim(rtrim(IN_location_state)))\n\tIFF(RTRIM(LTRIM(IN_location_state)) IS NULL, v_default_str, ltrim(rtrim(IN_location_state))) AS OUT_class_loc_state,\n\tv_default_str AS OUT_subline,\n\t-- *INF*: DECODE(  RTRIM(LTRIM( IN_exp_date )),\r\n\t--     NULL , v_default_end_date,      \r\n\t--     '99999999', v_default_end_date ,\r\n\t--     \r\n\t-- IIF(IS_DATE(IN_exp_date,'YYYYMMDD') = 1, \r\n\t-- ADD_TO_DATE(\r\n\t-- TO_DATE(IN_exp_date,'YYYYMMDD') ,'DD',1) ,\r\n\t-- \r\n\t-- ---\r\n\t-- ADD_TO_DATE(LAST_DAY(\r\n\t-- TO_DATE(\r\n\t-- CONCAT(     SUBSTR(IN_exp_date,1,6)  ,'01')\r\n\t-- \r\n\t-- ,'YYYYMMDD')),'DD',1) \r\n\t-- \r\n\t-- ))\r\n\t--          \n\tDECODE(RTRIM(LTRIM(IN_exp_date)),\n\t\tNULL, v_default_end_date,\n\t\t'99999999', v_default_end_date,\n\t\tIFF(IS_DATE(IN_exp_date, 'YYYYMMDD') = 1, ADD_TO_DATE(TO_DATE(IN_exp_date, 'YYYYMMDD'), 'DD', 1), ADD_TO_DATE(LAST_DAY(TO_DATE(CONCAT(SUBSTR(IN_exp_date, 1, 6), '01'), 'YYYYMMDD')), 'DD', 1))) AS v_exp_date,\n\tv_exp_date AS OUT_exp_date,\n\tv_default_str AS OUT_class_descript_num_seq,\n\t-- *INF*: IIF(ISNULL( RTRIM(LTRIM( IN_class_description  )))  ,v_default_str,ltrim(rtrim(IN_class_description)))\n\tIFF(RTRIM(LTRIM(IN_class_description)) IS NULL, v_default_str, ltrim(rtrim(IN_class_description))) AS OUT_class_description,\n\tv_default_str AS OUT_crime_ind\n\tFROM SQ_gtam_tm530xe_seq1_stage\n),\nLKP_sup_class_code_tm530xe_seq1 AS (\n\tSELECT\n\tsup_class_code_id,\n\tclass_code_descript,\n\tclass_code,\n\tclass_loc_code,\n\tclass_descript_ind,\n\tmco,\n\tclass_loc_state,\n\tsubline,\n\tgtam_exp_date,\n\tclass_descript_num_seq,\n\tcrime_ind\n\tFROM (\n\t\tSELECT \r\n\t\t\ttl.sup_class_code_id as sup_class_code_id, \t\r\n\t\t     RTRIM(LTRIM(\ttl.class_code_descript)) as class_code_descript, \t\r\n\t\t RTRIM(LTRIM(\ttl.crime_ind)) as crime_ind,\r\n\t\t       RTRIM(LTRIM( tl.class_code  )) as class_code,\r\n\t\t\t  RTRIM(LTRIM(tl.class_loc_code )) as class_loc_code ,\r\n\t\t\t  RTRIM(LTRIM(tl.class_descript_ind))  as class_descript_ind,\r\n\t\t  RTRIM(LTRIM(\ttl.mco))  as mco,\r\n\t\t\t  RTRIM(LTRIM(tl.class_loc_state))  as class_loc_state,\r\n\t\t  RTRIM(LTRIM(\ttl.subline))  as subline,\r\n\t\t\ttl.gtam_exp_date  as gtam_exp_date ,\r\n\t\t\t  RTRIM(LTRIM(tl.class_descript_num_seq))  as class_descript_num_seq\t\t\r\n\t\tFROM  \r\n\t\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code tl\r\n\t\tWHERE \r\n\t\t\ttl.crrnt_snpsht_flag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY class_code,class_loc_code,class_descript_ind,mco,class_loc_state,subline,gtam_exp_date,class_descript_num_seq,crime_ind ORDER BY sup_class_code_id) = 1\n),\nEXP_Detect_Changes_tm530xe_seq1 AS (\n\tSELECT\n\tEXP_values_tm530xe_seq1.OUT_class_description AS class_description,\n\tLKP_sup_class_code_tm530xe_seq1.sup_class_code_id AS LKP_sup_class_code_id,\n\tLKP_sup_class_code_tm530xe_seq1.class_code_descript AS LKP_class_code_descript,\n\t1 AS crrnt_snapshot_flag,\n\t-- *INF*: IIF(ISNULL(LKP_sup_class_code_id),'NEW',\r\n\t-- \tIIF(\r\n\t-- \t(ltrim(rtrim(class_description)) <> ltrim(rtrim(LKP_class_code_descript))),\r\n\t-- \t'UPDATE',\r\n\t-- \t'NOCHANGE'))\n\tIFF(LKP_sup_class_code_id IS NULL, 'NEW', IFF(( ltrim(rtrim(class_description)) <> ltrim(rtrim(LKP_class_code_descript)) ), 'UPDATE', 'NOCHANGE')) AS v_Changed_Flag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS Audit_ID,\n\t-- *INF*: IIF(v_Changed_Flag='NEW',\r\n\t-- \tTO_DATE('01/01/1800 01:00:00','MM/DD/YYYY HH24:MI:SS'),\r\n\t-- \tTO_DATE(TO_CHAR(SYSDATE,'MM/DD/YYYY HH24:MI:SS'),'MM/DD/YYYY HH24:MI:SS'))\n\tIFF(v_Changed_Flag = 'NEW', TO_DATE('01/01/1800 01:00:00', 'MM/DD/YYYY HH24:MI:SS'), TO_DATE(TO_CHAR(SYSDATE, 'MM/DD/YYYY HH24:MI:SS'), 'MM/DD/YYYY HH24:MI:SS')) AS Eff_From_Date,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS Eff_To_Date,\n\tv_Changed_Flag AS Changed_Flag,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS Source_System_ID,\n\tSYSDATE AS Created_Date,\n\tSYSDATE AS Modified_Date,\n\tEXP_values_tm530xe_seq1.OUT_class_code AS class_code,\n\tEXP_values_tm530xe_seq1.OUT_class_loc_code AS class_loc_code,\n\tEXP_values_tm530xe_seq1.OUT_class_descript_ind AS class_descript_ind,\n\tEXP_values_tm530xe_seq1.OUT_mco AS mco,\n\tEXP_values_tm530xe_seq1.OUT_class_loc_state AS class_loc_state,\n\tEXP_values_tm530xe_seq1.OUT_subline AS subline,\n\tEXP_values_tm530xe_seq1.OUT_exp_date AS gtam_exp_date,\n\tEXP_values_tm530xe_seq1.OUT_class_descript_num_seq AS class_descript_num_seq,\n\tEXP_values_tm530xe_seq1.OUT_crime_ind AS crime_ind\n\tFROM EXP_values_tm530xe_seq1\n\tLEFT JOIN LKP_sup_class_code_tm530xe_seq1\n\tON LKP_sup_class_code_tm530xe_seq1.class_code = EXP_values_tm530xe_seq1.OUT_class_code AND LKP_sup_class_code_tm530xe_seq1.class_loc_code = EXP_values_tm530xe_seq1.OUT_class_loc_code AND LKP_sup_class_code_tm530xe_seq1.class_descript_ind = EXP_values_tm530xe_seq1.OUT_class_descript_ind AND LKP_sup_class_code_tm530xe_seq1.mco = EXP_values_tm530xe_seq1.OUT_mco AND LKP_sup_class_code_tm530xe_seq1.class_loc_state = EXP_values_tm530xe_seq1.OUT_class_loc_state AND LKP_sup_class_code_tm530xe_seq1.subline = EXP_values_tm530xe_seq1.OUT_subline AND LKP_sup_class_code_tm530xe_seq1.gtam_exp_date = EXP_values_tm530xe_seq1.OUT_exp_date AND LKP_sup_class_code_tm530xe_seq1.class_descript_num_seq = EXP_values_tm530xe_seq1.OUT_class_descript_num_seq AND LKP_sup_class_code_tm530xe_seq1.crime_ind = EXP_values_tm530xe_seq1.OUT_crime_ind\n),\nFIL_insert_tm530xe_seq1 AS (\n\tSELECT\n\tcrrnt_snapshot_flag, \n\tAudit_ID, \n\tEff_From_Date, \n\tEff_To_Date, \n\tChanged_Flag, \n\tSource_System_ID, \n\tCreated_Date, \n\tModified_Date, \n\tclass_code, \n\tclass_loc_code, \n\tclass_descript_ind, \n\tmco, \n\tclass_loc_state, \n\tsubline, \n\tgtam_exp_date, \n\tclass_descript_num_seq, \n\tcrime_ind, \n\tclass_description AS class_code_descript\n\tFROM EXP_Detect_Changes_tm530xe_seq1\n\tWHERE Changed_Flag='NEW'  OR Changed_Flag='UPDATE'\n),\nINS_sup_class_code_tm530xe_seq1 AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code\n\t(crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date, class_code, class_loc_code, class_descript_ind, mco, class_loc_state, subline, gtam_exp_date, class_descript_num_seq, crime_ind, class_code_descript)\n\tSELECT \n\tcrrnt_snapshot_flag AS CRRNT_SNPSHT_FLAG, \n\tAudit_ID AS AUDIT_ID, \n\tEff_From_Date AS EFF_FROM_DATE, \n\tEff_To_Date AS EFF_TO_DATE, \n\tSource_System_ID AS SOURCE_SYS_ID, \n\tCreated_Date AS CREATED_DATE, \n\tModified_Date AS MODIFIED_DATE, \n\tCLASS_CODE, \n\tCLASS_LOC_CODE, \n\tCLASS_DESCRIPT_IND, \n\tMCO, \n\tCLASS_LOC_STATE, \n\tSUBLINE, \n\tGTAM_EXP_DATE, \n\tCLASS_DESCRIPT_NUM_SEQ, \n\tCRIME_IND, \n\tCLASS_CODE_DESCRIPT\n\tFROM FIL_insert_tm530xe_seq1\n),\nSQ_sup_class_code_UPD AS (\n\tSELECT \r\n\t\ttl.sup_class_code_id, \r\n\t\ttl.eff_from_date, \r\n\t\ttl.eff_to_date, \r\n\t\ttl.source_sys_id,\r\n\t\ttl.class_code,\r\n\t\ttl.class_loc_code,\r\n\t\ttl.class_descript_ind,\r\n\t\ttl.mco,\r\n\t\ttl.class_loc_state,\r\n\t\ttl.subline,\r\n\t\ttl.gtam_exp_date,\r\n\t\ttl.class_descript_num_seq,\r\n\t      tl.crime_ind\r\n\tFROM\r\n\t \t@{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code tl\r\n\tWHERE EXISTS \r\n\t\t   (SELECT 'X' FROM @{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code tll\r\n\t           WHERE tll.crrnt_snpsht_flag = 1 \r\n\t           and tll.class_code = tl.class_code\r\n\t\t       and tll.class_loc_code = tl.class_loc_code\r\n\t\t and tll.class_descript_ind = tl.class_descript_ind\r\n\t\t and tll.mco = tl.mco \r\n\t\t and tll.class_loc_state = tl.class_loc_state\r\n\t\t and tll.subline = tl.subline\r\n\t\t and tll.gtam_exp_date = tl.gtam_exp_date \r\n\t\t and tll.class_descript_num_seq   = tl.class_descript_num_seq           \r\n\t   and    tll.crime_ind =  tl.crime_ind\r\n\t           GROUP BY tll.source_sys_id,\r\n\t\ttll.class_code,\r\n\t\ttll.class_loc_code,\r\n\t\ttll.class_descript_ind,\r\n\t\ttll.mco,\r\n\t\ttll.class_loc_state,\r\n\t\ttll.subline,\r\n\t\ttll.gtam_exp_date,\r\n\t\ttll.class_descript_num_seq ,\r\n\t      tll.crime_ind\r\n\t           HAVING count(*) > 1)\r\n\tORDER BY  \r\n\ttl.source_sys_id,\r\n\t\ttl.class_code,\r\n\t\ttl.class_loc_code,\r\n\t\ttl.class_descript_ind,\r\n\t\ttl.mco,\r\n\t\ttl.class_loc_state,\r\n\t\ttl.subline,\r\n\t\ttl.gtam_exp_date,\r\n\t\ttl.class_descript_num_seq,\r\n\t      tl.crime_ind,\r\n\t    tl.eff_from_date  DESC\n),\nEXP_Lag_Eff_dates AS (\n\tSELECT\n\tsup_class_code_id,\n\tsource_sys_id,\n\tclass_code,\n\tclass_loc_code,\n\tclass_descript_ind,\n\tmco,\n\tclass_loc_state,\n\tsubline,\n\tgtam_exp_date,\n\tclass_descript_num_seq,\n\tcrime_ind,\n\teff_from_date,\n\teff_to_date AS orig_eff_to_date,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- \tsource_sys_id = v_PREV_ROW_source_sys_id AND\r\n\t--     class_code = v_PREV_ROW_class_code AND\r\n\t--   class_loc_code  =  v_PREV_ROW_class_loc_code AND\r\n\t--    class_descript_ind  =  v_PREV_ROW_class_descript_ind AND\r\n\t--    mco =   v_PREV_ROW_mco AND\r\n\t--    class_loc_state =   v_PREV_ROW_class_loc_state AND\r\n\t--    subline  =   v_PREV_ROW_subline AND\r\n\t--    gtam_exp_date  =  v_PREV_ROW_gtam_exp_date AND\r\n\t-- class_descript_num_seq = v_PREV_ROW_class_descript_num_seq AND\r\n\t-- crime_ind = v_PREV_ROW_crime_ind\r\n\t-- , ADD_TO_DATE(v_PREV_ROW_eff_from_date,'SS',-1),\r\n\t-- \torig_eff_to_date)\n\tDECODE(TRUE,\n\t\tsource_sys_id = v_PREV_ROW_source_sys_id AND class_code = v_PREV_ROW_class_code AND class_loc_code = v_PREV_ROW_class_loc_code AND class_descript_ind = v_PREV_ROW_class_descript_ind AND mco = v_PREV_ROW_mco AND class_loc_state = v_PREV_ROW_class_loc_state AND subline = v_PREV_ROW_subline AND gtam_exp_date = v_PREV_ROW_gtam_exp_date AND class_descript_num_seq = v_PREV_ROW_class_descript_num_seq AND crime_ind = v_PREV_ROW_crime_ind, ADD_TO_DATE(v_PREV_ROW_eff_from_date, 'SS', - 1),\n\t\torig_eff_to_date) AS v_eff_to_date,\n\tv_eff_to_date AS eff_to_date,\n\teff_from_date AS v_PREV_ROW_eff_from_date,\n\tsource_sys_id AS v_PREV_ROW_source_sys_id,\n\tclass_code AS v_PREV_ROW_class_code,\n\tclass_loc_code AS v_PREV_ROW_class_loc_code,\n\tclass_descript_ind AS v_PREV_ROW_class_descript_ind,\n\tmco AS v_PREV_ROW_mco,\n\tclass_loc_state AS v_PREV_ROW_class_loc_state,\n\tsubline AS v_PREV_ROW_subline,\n\tgtam_exp_date AS v_PREV_ROW_gtam_exp_date,\n\tclass_descript_num_seq AS v_PREV_ROW_class_descript_num_seq,\n\tcrime_ind AS v_PREV_ROW_crime_ind,\n\tSYSDATE AS modified_date,\n\t0 AS crrnt_snapshot_flag\n\tFROM SQ_sup_class_code_UPD\n),\nFIL_FirstRowInAKGroup AS (\n\tSELECT\n\tsup_class_code_id, \n\torig_eff_to_date, \n\teff_to_date, \n\tmodified_date, \n\tcrrnt_snapshot_flag\n\tFROM EXP_Lag_Eff_dates\n\tWHERE orig_eff_to_date <> eff_to_date\n),\nUPD_Sup_Class_Code AS (\n\tSELECT\n\tsup_class_code_id, \n\teff_to_date, \n\tmodified_date, \n\tcrrnt_snapshot_flag\n\tFROM FIL_FirstRowInAKGroup\n),\nUPD_sup_class_code AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.sup_class_code AS T\n\tUSING UPD_Sup_Class_Code AS S\n\tON T.sup_class_code_id = S.sup_class_code_id\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.crrnt_snpsht_flag = S.crrnt_snapshot_flag, T.eff_to_date = S.eff_to_date, T.modified_date = S.modified_date\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246483"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905515"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604177"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 01:20:53"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 01:53:42"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Stage_Policy"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Policy"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "PMS"
            }
        },
        "folder": {
            "name": "Policy DataWarehouse/"
        },
        "annotations": []
    }
}