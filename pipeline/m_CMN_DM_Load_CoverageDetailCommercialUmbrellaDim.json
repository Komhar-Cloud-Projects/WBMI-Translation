{
    "name": "m_CMN_DM_Load_CoverageDetailCommercialUmbrellaDim",
    "properties": {
        "activities": [
            {
                "name": "m_CMN_DM_Load_CoverageDetailCommercialUmbrellaDim",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_CoveraeLimitValue AS (\n\tSELECT\n\tCoverageLimitValue,\n\tPremiumTransactionAKId,\n\tCoverageLimitType\n\tFROM (\n\t\tSELECT CL.CoverageLimitValue as CoverageLimitValue, \r\n\t\tCLB.PremiumTransactionAKId as PremiumTransactionAKId, \r\n\t\tCL.CoverageLimitType as CoverageLimitType \r\n\t\tFROM @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.CoverageLimitBridge CLB\r\n\t\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.CoverageLimit CL ON CL.CoverageLimitId=CLB.CoverageLimitId\r\n\t\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction PT ON CLB.PremiumtransactionAKID = PT.PremiumtransactionAKID\r\n\t\tWHERE PT.modifieddate> '@{pipeline().parameters.SELECTION_START_TS}'\r\n\t\torder by CLB.PremiumTransactionAKId,CL.CoverageLimitType,CLB.CreatedDate desc\r\n\t\t--\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionAKId,CoverageLimitType ORDER BY CoverageLimitValue) = 1\n),\nSQ_CoverageDetailCommercialUmbrella AS (\n\tselect CDD.CoverageDetailDimId AS CoverageDetailDimId,\r\n\tCDD.EffectiveDate AS EffectiveDate,\r\n\tCDD.ExpirationDate AS ExpirationDate,\r\n\tCDD.CoverageGuid AS CoverageGuid,\r\n\tRC.CoverageType AS CoverageType,\r\n\tPT.SourceSystemID AS SourceSystemID,\r\n\tCDCU.UmbrellaCoverageScope,\r\n\tCDCU.RetroactiveDate,\r\n\tPT.PremiumTransactionAKID,\r\n\tCDCU.UmbrellaLayer,\r\n\tPL.PolicyPerOccurenceLimit,\r\n\tPL.PolicyAggregateLimit,\r\n\tPT.PremiumTransactionEnteredDate,\r\n\tISNULL(RC.PolicyCoverageAKID,-1) PolicyCoverageAKID,\r\n\tISNULL(PT.RatingCoverageAKID,-1) RatingCoverageAKID,\r\n\tCount(1) OVER (partition BY PremiumTransactionAKID) Num_Records\r\n\tfrom @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction PT\r\n\tJOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailDim CDD\r\n\tON CDD.EDWPremiumTransactionPKId=PT.PremiumTransactionID\r\n\tJOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.CoverageDetailCommercialUmbrella CDCU\r\n\tON CDCU.PremiumTransactionID=CDD.EDWPremiumTransactionPKId\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage RC\r\n\ton PT.RatingCoverageAKId=RC.RatingCoverageAKId and RC.EffectiveDate=PT.EffectiveDate\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\ton RC.PolicyCoverageAKID=PC.PolicyCoverageAKID and PC.CurrentSnapshotFlag=1\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyLimit PL\r\n\ton PC.PolicyLimitAKID=PL.PolicyLimitAKId --and PL.CurrentSnapshotFlag=1 \r\n\tand PL.InsuranceLine='CommercialUmbrella'\r\n\tand PL.EffectiveDate <= PT.PremiumTransactionEnteredDate \r\n\tand PL.ExpirationDate >= PT.PremiumTransactionEnteredDate\r\n\twhere CDD.ModifedDate>='@{pipeline().parameters.SELECTION_START_TS}' @{pipeline().parameters.WHERE_CLAUSE}\n),\nEXP_MetaData AS (\n\tSELECT\n\tCoverageDetailDimId AS i_CoverageDetailDimId,\n\tEffectiveDate AS i_EffectiveDate,\n\tExpirationDate AS i_ExpirationDate,\n\tCoverageGuid AS i_CoverageGuid,\n\tCoverageType AS i_CoverageType,\n\tSourceSystemID AS i_SourceSystemID,\n\ti_CoverageDetailDimId AS o_CoverageDetailDimId,\n\ti_EffectiveDate AS o_EffectiveDate,\n\ti_ExpirationDate AS o_ExpirationDate,\n\t-- *INF*: RTRIM(LTRIM(i_CoverageGuid))\n\tRTRIM(LTRIM(i_CoverageGuid)) AS o_CoverageGuid,\n\t-- *INF*: RTRIM(LTRIM(i_CoverageType))\n\tRTRIM(LTRIM(i_CoverageType)) AS o_CoverageType,\n\t-- *INF*: RTRIM(LTRIM(i_SourceSystemID))\n\tRTRIM(LTRIM(i_SourceSystemID)) AS o_SourceSystemID,\n\tUmbrellaCoverageScope AS i_UmbrellaCoverageScope,\n\t-- *INF*: RTRIM(LTRIM(i_UmbrellaCoverageScope))\n\tRTRIM(LTRIM(i_UmbrellaCoverageScope)) AS o_UmbrellaCoverageScope,\n\tRetroactiveDate AS i_RetroactiveDate,\n\ti_RetroactiveDate AS o_RetroactiveDate,\n\tPremiumTransactionAKID AS i_PremiumTransactionAKID,\n\ti_PremiumTransactionAKID AS o_PremiumTransactionAKID,\n\tUmbrellaLayer,\n\tPolicyPerOccurenceLimit,\n\tPolicyAggregateLimit,\n\tPolicyCoverageAKID,\n\tRatingCoverageAKID,\n\tNum_Records,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- Num_Records>1, IIF((PolicyCoverageAKID=-1) OR (RatingCoverageAKID=-1),'FAIL','PASS'),\r\n\t-- 'PASS')\n\tDECODE(TRUE,\n\tNum_Records > 1, IFF(( PolicyCoverageAKID = - 1 ) OR ( RatingCoverageAKID = - 1 ), 'FAIL', 'PASS'),\n\t'PASS') AS CheckFlag\n\tFROM SQ_CoverageDetailCommercialUmbrella\n),\nEXP_Business_Rules AS (\n\tSELECT\n\to_CoverageDetailDimId AS CoverageDetailDimId,\n\to_EffectiveDate AS EffectiveDate,\n\to_ExpirationDate AS ExpirationDate,\n\to_CoverageGuid AS CoverageGuid,\n\to_CoverageType AS i_CoverageType,\n\to_SourceSystemID AS i_SourceSystemID,\n\to_PremiumTransactionAKID AS i_PremiumTransactionAKID,\n\tPolicyPerOccurenceLimit AS i_PolicyPerOccurenceLimit,\n\tPolicyAggregateLimit AS i_PolicyAggregateLimit,\n\t-- *INF*: :LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Umbrella AGGREGATE LIMIT')\n\tLKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_AGGREGATE_LIMIT.CoverageLimitValue AS v_AggregateLimit,\n\t-- *INF*: :LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Umbrella GENERAL AGGREGATE LIMIT')\n\tLKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_GENERAL_AGGREGATE_LIMIT.CoverageLimitValue AS v_GeneralAggregateLimit,\n\t-- *INF*: :LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Umbrella EACH OCCURRENCE LIMIT')\n\tLKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_EACH_OCCURRENCE_LIMIT.CoverageLimitValue AS v_EachOccuranceLimit,\n\t-- *INF*: IIF(ISNULL(v_AggregateLimit),v_GeneralAggregateLimit,v_AggregateLimit)\n\tIFF(v_AggregateLimit IS NULL, v_GeneralAggregateLimit, v_AggregateLimit) AS v_UmbrellaLimit_Agg,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS', v_UmbrellaLimit_Agg,\r\n\t-- i_SourceSystemID='DCT', i_PolicyPerOccurenceLimit,\r\n\t-- 'N/A'\r\n\t-- )\r\n\t-- \r\n\t-- \r\n\t-- --i_SourceSystemID='DCT',:LKP.LKP_POLICYLIMIT(i_PremiumTransactionAKID),\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', v_UmbrellaLimit_Agg,\n\ti_SourceSystemID = 'DCT', i_PolicyPerOccurenceLimit,\n\t'N/A') AS v_UmbrellaLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Umbrella PERSONAL INJURY AND ADVERTISING INJURY LIMIT'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_PERSONAL_INJURY_AND_ADVERTISING_INJURY_LIMIT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UmbrellaPersonalInjuryLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'UNDERINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_UNDERINSURED_MOTORISTS_COVERAGE_EACH_ACCIDENT_LIMIT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UmbrellaUnderInsuredLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'UNINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_UNINSURED_MOTORISTS_COVERAGE_EACH_ACCIDENT_LIMIT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UmbrellaUninsuredLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS','N/A',\r\n\t-- i_SourceSystemID='DCT',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'RetentionLimit'),\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', 'N/A',\n\ti_SourceSystemID = 'DCT', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_RetentionLimit.CoverageLimitValue,\n\t'N/A') AS v_UmbrellaRetentionLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - EACH OCCURRENCE LIMIT'),\r\n\t-- i_SourceSystemID='DCT',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'OccurrenceLimit'),\r\n\t-- 'N/A'\r\n\t-- )\r\n\t-- \r\n\t-- \r\n\t-- \n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_OCCURRENCE_LIMIT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_OccurrenceLimit.CoverageLimitValue,\n\t'N/A') AS v_UnderlyingPerOccurrenceLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - EACH OCCURRENCE LIMIT'),\r\n\t-- i_SourceSystemID='DCT','N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_OCCURRENCE_LIMIT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'N/A') AS v_UnderlyingPerOccurrenceClaimLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS' ,:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - GENERAL AGGREGATE LIMIT'),\r\n\t-- i_SourceSystemID='DCT' AND i_CoverageType='CGLUnderlying',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'AggregateLimit'),\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_GENERAL_AGGREGATE_LIMIT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT' AND i_CoverageType = 'CGLUnderlying', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_AggregateLimit.CoverageLimitValue,\n\t'N/A') AS v_UnderlyingAggregateLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - GENERAL AGGREGATE LIMIT'),i_SourceSystemID='DCT','N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_GENERAL_AGGREGATE_LIMIT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'N/A') AS v_UnderlyingPolicyAggregateLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - PRODUCTS-COMPLETED OPERATIONS AGGREGATE LIMIT'),\r\n\t-- i_SourceSystemID='DCT'  AND i_CoverageType='CGLUnderlying',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'ProductsAggregateLimit'),\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_PRODUCTS_COMPLETED_OPERATIONS_AGGREGATE_LIMIT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT' AND i_CoverageType = 'CGLUnderlying', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_ProductsAggregateLimit.CoverageLimitValue,\n\t'N/A') AS v_UnderlyingProductAggregateLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - PRODUCTS-COMPLETED OPERATIONS AGGREGATE LIMIT'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_PRODUCTS_COMPLETED_OPERATIONS_AGGREGATE_LIMIT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UnderlyingProductCompletedOperationAggregateLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - BODILY INJURY BY ACCIDENT:  EACH ACCIDENT'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_BODILY_INJURY_BY_ACCIDENT_EACH_ACCIDENT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UnderlyingAccidentLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - BODILY INJURY BY DISEASE:   POLICY LIMIT'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_BODILY_INJURY_BY_DISEASE_POLICY_LIMIT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UnderlyingDiseaseLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - CommonCauseLimit'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_CommonCauseLimit.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UnderlyingCommonCauseLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - BODILY INJURY - EACH PERSON'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_BODILY_INJURY_EACH_PERSON.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UnderlyingEachPersonBodilyInjuryLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS' ,:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - PROPERTY DAMAGE - EACH ACCIDENT'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_PROPERTY_DAMAGE_EACH_ACCIDENT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UnderlyingEachPersonPropertyDamageLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - LossOfMeansSupportLimit'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_LossOfMeansSupportLimit.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UnderlyingLossOfMeansSupportLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS',:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - EACH ACCIDENT'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_ACCIDENT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UnderlyingCombinedSingleLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS' ,:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - EACH ACCIDENT - GARAGE OPERATIONS AUTO ONLY'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_ACCIDENT_GARAGE_OPERATIONS_AUTO_ONLY.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UnderlyingAccidentGarageOperationsAutoOnlyLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS' ,:LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Underlying - EACH ACCIDENT - GARAGE OPERATIONS OTHER THAN AUTO ONLY'),\r\n\t-- i_SourceSystemID='DCT','TBD',\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_ACCIDENT_GARAGE_OPERATIONS_OTHER_THAN_AUTO_ONLY.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', 'TBD',\n\t'N/A') AS v_UnderlyingAccidentGarageOperationsOtherThanAutoLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS' ,\r\n\t-- :LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Umbrella EACH OCCURRENCE LIMIT'),\r\n\t-- i_SourceSystemID='DCT', i_PolicyPerOccurenceLimit,\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_EACH_OCCURRENCE_LIMIT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', i_PolicyPerOccurenceLimit,\n\t'N/A') AS v_UmbrellaPerOccurrenceLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_SourceSystemID='PMS' ,\r\n\t-- :LKP.LKP_COVERAELIMITVALUE(i_PremiumTransactionAKID,'Umbrella AGGREGATE LIMIT'),\r\n\t-- i_SourceSystemID='DCT', i_PolicyAggregateLimit,\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(TRUE,\n\ti_SourceSystemID = 'PMS', LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_AGGREGATE_LIMIT.CoverageLimitValue,\n\ti_SourceSystemID = 'DCT', i_PolicyAggregateLimit,\n\t'N/A') AS v_UmbrellaAggregateLimit,\n\t-- *INF*: IIF(ISNULL(v_UmbrellaPerOccurrenceLimit), 'N/A', v_UmbrellaPerOccurrenceLimit)\n\tIFF(v_UmbrellaPerOccurrenceLimit IS NULL, 'N/A', v_UmbrellaPerOccurrenceLimit) AS o_UmbrellaPerOccurrenceLimit,\n\t-- *INF*: IIF(ISNULL(v_UmbrellaAggregateLimit), 'N/A', v_UmbrellaAggregateLimit)\n\tIFF(v_UmbrellaAggregateLimit IS NULL, 'N/A', v_UmbrellaAggregateLimit) AS o_UmbrellaAggregateLimit,\n\t-- *INF*: IIF(ISNULL(v_UmbrellaLimit),'N/A',v_UmbrellaLimit)\n\tIFF(v_UmbrellaLimit IS NULL, 'N/A', v_UmbrellaLimit) AS o_UmbrellaLimit,\n\t-- *INF*: IIF(ISNULL(v_UmbrellaPersonalInjuryLimit),'N/A',v_UmbrellaPersonalInjuryLimit)\n\tIFF(v_UmbrellaPersonalInjuryLimit IS NULL, 'N/A', v_UmbrellaPersonalInjuryLimit) AS o_UmbrellaPersonalInjuryLimit,\n\t-- *INF*: IIF(ISNULL(v_UmbrellaUnderInsuredLimit),'N/A',v_UmbrellaUnderInsuredLimit)\n\tIFF(v_UmbrellaUnderInsuredLimit IS NULL, 'N/A', v_UmbrellaUnderInsuredLimit) AS o_UmbrellaUnderInsuredLimit,\n\t-- *INF*: IIF(ISNULL(v_UmbrellaUninsuredLimit),'N/A',v_UmbrellaUninsuredLimit)\n\tIFF(v_UmbrellaUninsuredLimit IS NULL, 'N/A', v_UmbrellaUninsuredLimit) AS o_UmbrellaUninsuredLimit,\n\t-- *INF*: IIF(ISNULL(v_UmbrellaRetentionLimit),'N/A',v_UmbrellaRetentionLimit)\n\tIFF(v_UmbrellaRetentionLimit IS NULL, 'N/A', v_UmbrellaRetentionLimit) AS o_UmbrellaRetentionLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingPerOccurrenceLimit),'N/A',v_UnderlyingPerOccurrenceLimit)\n\tIFF(v_UnderlyingPerOccurrenceLimit IS NULL, 'N/A', v_UnderlyingPerOccurrenceLimit) AS o_UnderlyingPerOccurrenceLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingPerOccurrenceClaimLimit),'N/A',v_UnderlyingPerOccurrenceClaimLimit)\n\tIFF(v_UnderlyingPerOccurrenceClaimLimit IS NULL, 'N/A', v_UnderlyingPerOccurrenceClaimLimit) AS o_UnderlyingPerOccurrenceClaimLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingAggregateLimit),'N/A',v_UnderlyingAggregateLimit)\n\tIFF(v_UnderlyingAggregateLimit IS NULL, 'N/A', v_UnderlyingAggregateLimit) AS o_UnderlyingAggregateLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingPolicyAggregateLimit),'N/A',v_UnderlyingPolicyAggregateLimit)\n\tIFF(v_UnderlyingPolicyAggregateLimit IS NULL, 'N/A', v_UnderlyingPolicyAggregateLimit) AS o_UnderlyingPolicyAggregateLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingProductAggregateLimit),'N/A',v_UnderlyingProductAggregateLimit)\n\tIFF(v_UnderlyingProductAggregateLimit IS NULL, 'N/A', v_UnderlyingProductAggregateLimit) AS o_UnderlyingProductAggregateLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingProductCompletedOperationAggregateLimit),'N/A',v_UnderlyingProductCompletedOperationAggregateLimit)\n\tIFF(v_UnderlyingProductCompletedOperationAggregateLimit IS NULL, 'N/A', v_UnderlyingProductCompletedOperationAggregateLimit) AS o_UnderlyingProductCompletedOperationAggregateLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingAccidentLimit),'N/A',v_UnderlyingAccidentLimit)\n\tIFF(v_UnderlyingAccidentLimit IS NULL, 'N/A', v_UnderlyingAccidentLimit) AS o_UnderlyingAccidentLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingDiseaseLimit),'N/A',v_UnderlyingDiseaseLimit)\n\tIFF(v_UnderlyingDiseaseLimit IS NULL, 'N/A', v_UnderlyingDiseaseLimit) AS o_UnderlyingDiseaseLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingCommonCauseLimit),'N/A',v_UnderlyingCommonCauseLimit)\n\tIFF(v_UnderlyingCommonCauseLimit IS NULL, 'N/A', v_UnderlyingCommonCauseLimit) AS o_UnderlyingCommonCauseLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingEachPersonBodilyInjuryLimit),'N/A',v_UnderlyingEachPersonBodilyInjuryLimit)\n\tIFF(v_UnderlyingEachPersonBodilyInjuryLimit IS NULL, 'N/A', v_UnderlyingEachPersonBodilyInjuryLimit) AS o_UnderlyingEachPersonBodilyInjuryLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingEachPersonPropertyDamageLimit),'N/A',v_UnderlyingEachPersonPropertyDamageLimit)\n\tIFF(v_UnderlyingEachPersonPropertyDamageLimit IS NULL, 'N/A', v_UnderlyingEachPersonPropertyDamageLimit) AS o_UnderlyingEachPersonPropertyDamageLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingLossOfMeansSupportLimit),'N/A',v_UnderlyingLossOfMeansSupportLimit)\n\tIFF(v_UnderlyingLossOfMeansSupportLimit IS NULL, 'N/A', v_UnderlyingLossOfMeansSupportLimit) AS o_UnderlyingLossOfMeansSupportLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingCombinedSingleLimit),'N/A',v_UnderlyingCombinedSingleLimit)\n\tIFF(v_UnderlyingCombinedSingleLimit IS NULL, 'N/A', v_UnderlyingCombinedSingleLimit) AS o_UnderlyingCombinedSingleLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingAccidentGarageOperationsAutoOnlyLimit),'N/A',v_UnderlyingAccidentGarageOperationsAutoOnlyLimit)\n\tIFF(v_UnderlyingAccidentGarageOperationsAutoOnlyLimit IS NULL, 'N/A', v_UnderlyingAccidentGarageOperationsAutoOnlyLimit) AS UnderlyingAccidentGarageOperationsAutoOnlyLimit,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingAccidentGarageOperationsOtherThanAutoLimit),'N/A',v_UnderlyingAccidentGarageOperationsOtherThanAutoLimit)\n\tIFF(v_UnderlyingAccidentGarageOperationsOtherThanAutoLimit IS NULL, 'N/A', v_UnderlyingAccidentGarageOperationsOtherThanAutoLimit) AS UnderlyingAccidentGarageOperationsOtherThanAutoLimit,\n\to_UmbrellaCoverageScope AS UmbrellaCoverageScope,\n\to_RetroactiveDate AS RetroactiveDate,\n\tUmbrellaLayer,\n\tCheckFlag\n\tFROM EXP_MetaData\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_AGGREGATE_LIMIT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_AGGREGATE_LIMIT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_AGGREGATE_LIMIT.CoverageLimitType = 'Umbrella AGGREGATE LIMIT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_GENERAL_AGGREGATE_LIMIT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_GENERAL_AGGREGATE_LIMIT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_GENERAL_AGGREGATE_LIMIT.CoverageLimitType = 'Umbrella GENERAL AGGREGATE LIMIT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_EACH_OCCURRENCE_LIMIT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_EACH_OCCURRENCE_LIMIT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_EACH_OCCURRENCE_LIMIT.CoverageLimitType = 'Umbrella EACH OCCURRENCE LIMIT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_PERSONAL_INJURY_AND_ADVERTISING_INJURY_LIMIT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_PERSONAL_INJURY_AND_ADVERTISING_INJURY_LIMIT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Umbrella_PERSONAL_INJURY_AND_ADVERTISING_INJURY_LIMIT.CoverageLimitType = 'Umbrella PERSONAL INJURY AND ADVERTISING INJURY LIMIT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_UNDERINSURED_MOTORISTS_COVERAGE_EACH_ACCIDENT_LIMIT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_UNDERINSURED_MOTORISTS_COVERAGE_EACH_ACCIDENT_LIMIT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_UNDERINSURED_MOTORISTS_COVERAGE_EACH_ACCIDENT_LIMIT.CoverageLimitType = 'UNDERINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_UNINSURED_MOTORISTS_COVERAGE_EACH_ACCIDENT_LIMIT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_UNINSURED_MOTORISTS_COVERAGE_EACH_ACCIDENT_LIMIT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_UNINSURED_MOTORISTS_COVERAGE_EACH_ACCIDENT_LIMIT.CoverageLimitType = 'UNINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_RetentionLimit\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_RetentionLimit.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_RetentionLimit.CoverageLimitType = 'RetentionLimit'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_OCCURRENCE_LIMIT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_OCCURRENCE_LIMIT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_OCCURRENCE_LIMIT.CoverageLimitType = 'Underlying - EACH OCCURRENCE LIMIT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_OccurrenceLimit\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_OccurrenceLimit.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_OccurrenceLimit.CoverageLimitType = 'OccurrenceLimit'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_GENERAL_AGGREGATE_LIMIT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_GENERAL_AGGREGATE_LIMIT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_GENERAL_AGGREGATE_LIMIT.CoverageLimitType = 'Underlying - GENERAL AGGREGATE LIMIT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_AggregateLimit\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_AggregateLimit.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_AggregateLimit.CoverageLimitType = 'AggregateLimit'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_PRODUCTS_COMPLETED_OPERATIONS_AGGREGATE_LIMIT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_PRODUCTS_COMPLETED_OPERATIONS_AGGREGATE_LIMIT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_PRODUCTS_COMPLETED_OPERATIONS_AGGREGATE_LIMIT.CoverageLimitType = 'Underlying - PRODUCTS-COMPLETED OPERATIONS AGGREGATE LIMIT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_ProductsAggregateLimit\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_ProductsAggregateLimit.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_ProductsAggregateLimit.CoverageLimitType = 'ProductsAggregateLimit'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_BODILY_INJURY_BY_ACCIDENT_EACH_ACCIDENT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_BODILY_INJURY_BY_ACCIDENT_EACH_ACCIDENT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_BODILY_INJURY_BY_ACCIDENT_EACH_ACCIDENT.CoverageLimitType = 'Underlying - BODILY INJURY BY ACCIDENT:  EACH ACCIDENT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_BODILY_INJURY_BY_DISEASE_POLICY_LIMIT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_BODILY_INJURY_BY_DISEASE_POLICY_LIMIT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_BODILY_INJURY_BY_DISEASE_POLICY_LIMIT.CoverageLimitType = 'Underlying - BODILY INJURY BY DISEASE:   POLICY LIMIT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_CommonCauseLimit\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_CommonCauseLimit.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_CommonCauseLimit.CoverageLimitType = 'Underlying - CommonCauseLimit'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_BODILY_INJURY_EACH_PERSON\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_BODILY_INJURY_EACH_PERSON.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_BODILY_INJURY_EACH_PERSON.CoverageLimitType = 'Underlying - BODILY INJURY - EACH PERSON'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_PROPERTY_DAMAGE_EACH_ACCIDENT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_PROPERTY_DAMAGE_EACH_ACCIDENT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_PROPERTY_DAMAGE_EACH_ACCIDENT.CoverageLimitType = 'Underlying - PROPERTY DAMAGE - EACH ACCIDENT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_LossOfMeansSupportLimit\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_LossOfMeansSupportLimit.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_LossOfMeansSupportLimit.CoverageLimitType = 'Underlying - LossOfMeansSupportLimit'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_ACCIDENT\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_ACCIDENT.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_ACCIDENT.CoverageLimitType = 'Underlying - EACH ACCIDENT'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_ACCIDENT_GARAGE_OPERATIONS_AUTO_ONLY\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_ACCIDENT_GARAGE_OPERATIONS_AUTO_ONLY.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_ACCIDENT_GARAGE_OPERATIONS_AUTO_ONLY.CoverageLimitType = 'Underlying - EACH ACCIDENT - GARAGE OPERATIONS AUTO ONLY'\n\n\tLEFT JOIN LKP_COVERAELIMITVALUE LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_ACCIDENT_GARAGE_OPERATIONS_OTHER_THAN_AUTO_ONLY\n\tON LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_ACCIDENT_GARAGE_OPERATIONS_OTHER_THAN_AUTO_ONLY.PremiumTransactionAKId = i_PremiumTransactionAKID\n\tAND LKP_COVERAELIMITVALUE_i_PremiumTransactionAKID_Underlying_EACH_ACCIDENT_GARAGE_OPERATIONS_OTHER_THAN_AUTO_ONLY.CoverageLimitType = 'Underlying - EACH ACCIDENT - GARAGE OPERATIONS OTHER THAN AUTO ONLY'\n\n),\nLKP_CoverageDetailCommercialUmbrellaDim AS (\n\tSELECT\n\tCoverageDetailDimId\n\tFROM (\n\t\tSELECT CDCUD.CoverageDetailDimId as CoverageDetailDimId \r\n\t\tFROM \r\n\t\t@{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialUmbrellaDim CDCUD\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailDim CDD\r\n\t\tON CDCUD.CoverageDetailDimId = CDD.CoverageDetailDimId\r\n\t\tINNER JOIN @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.CoverageDetailCommercialUmbrella CDCU\r\n\t\tON CDCU.PremiumTransactionID=CDD.EDWPremiumTransactionPKId\r\n\t\tWHERE CDD.modifeddate > '@{pipeline().parameters.SELECTION_START_TS}'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY CoverageDetailDimId ORDER BY CoverageDetailDimId DESC) = 1\n),\nEXP_Tgt AS (\n\tSELECT\n\tEXP_Business_Rules.CoverageDetailDimId,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditID,\n\tEXP_Business_Rules.EffectiveDate,\n\tEXP_Business_Rules.ExpirationDate,\n\tSYSDATE AS CreatedDate,\n\tSYSDATE AS ModifiedDate,\n\tEXP_Business_Rules.CoverageGuid,\n\tEXP_Business_Rules.o_UmbrellaLimit AS UmbrellaLimit,\n\tEXP_Business_Rules.o_UmbrellaPersonalInjuryLimit AS UmbrellaPersonalInjuryLimit,\n\tEXP_Business_Rules.o_UmbrellaUnderInsuredLimit AS UmbrellaUnderInsuredLimit,\n\tEXP_Business_Rules.o_UmbrellaUninsuredLimit AS UmbrellaUninsuredLimit,\n\tEXP_Business_Rules.o_UmbrellaRetentionLimit AS UmbrellaRetentionLimit,\n\tEXP_Business_Rules.o_UnderlyingPerOccurrenceLimit AS UnderlyingPerOccurrenceLimit,\n\tEXP_Business_Rules.o_UnderlyingPerOccurrenceClaimLimit AS UnderlyingPerOccurrenceClaimLimit,\n\tEXP_Business_Rules.o_UnderlyingAggregateLimit AS UnderlyingAggregateLimit,\n\tEXP_Business_Rules.o_UnderlyingPolicyAggregateLimit AS UnderlyingPolicyAggregateLimit,\n\tEXP_Business_Rules.o_UnderlyingProductAggregateLimit AS UnderlyingProductAggregateLimit,\n\tEXP_Business_Rules.o_UnderlyingProductCompletedOperationAggregateLimit AS UnderlyingProductCompletedOperationAggregateLimit,\n\tEXP_Business_Rules.o_UnderlyingAccidentLimit AS UnderlyingAccidentLimit,\n\tEXP_Business_Rules.o_UnderlyingDiseaseLimit AS UnderlyingDiseaseLimit,\n\tEXP_Business_Rules.o_UnderlyingCommonCauseLimit AS UnderlyingCommonCauseLimit,\n\tEXP_Business_Rules.o_UnderlyingEachPersonBodilyInjuryLimit AS UnderlyingEachPersonBodilyInjuryLimit,\n\tEXP_Business_Rules.o_UnderlyingEachPersonPropertyDamageLimit AS UnderlyingEachPersonPropertyDamageLimit,\n\tEXP_Business_Rules.o_UnderlyingLossOfMeansSupportLimit AS UnderlyingLossOfMeansSupportLimit,\n\tEXP_Business_Rules.o_UnderlyingCombinedSingleLimit AS UnderlyingCombinedSingleLimit,\n\tEXP_Business_Rules.UnderlyingAccidentGarageOperationsAutoOnlyLimit,\n\tEXP_Business_Rules.UnderlyingAccidentGarageOperationsOtherThanAutoLimit,\n\tEXP_Business_Rules.UmbrellaCoverageScope,\n\tEXP_Business_Rules.RetroactiveDate,\n\tLKP_CoverageDetailCommercialUmbrellaDim.CoverageDetailDimId AS LKP_CoverageDetailDimId,\n\t-- *INF*: IIF(ISNULL(LKP_CoverageDetailDimId),'NEW','UPDATE')\n\tIFF(LKP_CoverageDetailDimId IS NULL, 'NEW', 'UPDATE') AS ChangeFlag,\n\tEXP_Business_Rules.UmbrellaLayer,\n\tEXP_Business_Rules.o_UmbrellaPerOccurrenceLimit AS UmbrellaPerOccurrenceLimit,\n\tEXP_Business_Rules.o_UmbrellaAggregateLimit AS UmbrellaAggregateLimit,\n\tEXP_Business_Rules.CheckFlag\n\tFROM EXP_Business_Rules\n\tLEFT JOIN LKP_CoverageDetailCommercialUmbrellaDim\n\tON LKP_CoverageDetailCommercialUmbrellaDim.CoverageDetailDimId = EXP_Business_Rules.CoverageDetailDimId\n),\nRTR_INSERT_UPDATE AS (\n\tSELECT\n\tCoverageDetailDimId,\n\tAuditID,\n\tEffectiveDate,\n\tExpirationDate,\n\tCreatedDate,\n\tModifiedDate,\n\tCoverageGuid,\n\tUmbrellaLimit,\n\tUmbrellaPersonalInjuryLimit,\n\tUmbrellaUnderInsuredLimit,\n\tUmbrellaUninsuredLimit,\n\tUmbrellaRetentionLimit,\n\tUnderlyingPerOccurrenceLimit,\n\tUnderlyingPerOccurrenceClaimLimit,\n\tUnderlyingAggregateLimit,\n\tUnderlyingPolicyAggregateLimit,\n\tUnderlyingProductAggregateLimit,\n\tUnderlyingProductCompletedOperationAggregateLimit,\n\tUnderlyingAccidentLimit,\n\tUnderlyingDiseaseLimit,\n\tUnderlyingCommonCauseLimit,\n\tUnderlyingEachPersonBodilyInjuryLimit,\n\tUnderlyingEachPersonPropertyDamageLimit,\n\tUnderlyingLossOfMeansSupportLimit,\n\tUnderlyingCombinedSingleLimit,\n\tUnderlyingAccidentGarageOperationsAutoOnlyLimit,\n\tUnderlyingAccidentGarageOperationsOtherThanAutoLimit,\n\tUmbrellaCoverageScope,\n\tRetroactiveDate,\n\tChangeFlag,\n\tUmbrellaLayer,\n\tUmbrellaPerOccurrenceLimit,\n\tUmbrellaAggregateLimit,\n\tCheckFlag\n\tFROM EXP_Tgt\n),\nRTR_INSERT_UPDATE_INSERT AS (SELECT * FROM RTR_INSERT_UPDATE WHERE ChangeFlag='NEW'  AND CheckFlag='PASS'),\nRTR_INSERT_UPDATE_UPDATE AS (SELECT * FROM RTR_INSERT_UPDATE WHERE ChangeFlag='UPDATE'  AND CheckFlag='PASS'),\nCoverageDetailCommercialUmbrellaDim_Insert AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialUmbrellaDim\n\t(CoverageDetailDimId, AuditID, EffectiveDate, ExpirationDate, CreatedDate, ModifiedDate, CoverageGuid, UmbrellaLimit, UmbrellaPersonalInjuryLimit, UmbrellaUnderInsuredLimit, UmbrellaUninsuredLimit, UmbrellaRetentionLimit, UmbrellaCoverageScope, RetroactiveDate, UmbrellaLayer, UmbrellaPerOccurrenceLimit, UmbrellaAggregateLimit)\n\tSELECT \n\tCOVERAGEDETAILDIMID, \n\tAUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tCOVERAGEGUID, \n\tUMBRELLALIMIT, \n\tUMBRELLAPERSONALINJURYLIMIT, \n\tUMBRELLAUNDERINSUREDLIMIT, \n\tUMBRELLAUNINSUREDLIMIT, \n\tUMBRELLARETENTIONLIMIT, \n\tUMBRELLACOVERAGESCOPE, \n\tRETROACTIVEDATE, \n\tUMBRELLALAYER, \n\tUMBRELLAPEROCCURRENCELIMIT, \n\tUMBRELLAAGGREGATELIMIT\n\tFROM RTR_INSERT_UPDATE_INSERT\n),\nUPD_Exists AS (\n\tSELECT\n\tCoverageDetailDimId AS CoverageDetailDimId3, \n\tAuditID AS AuditID3, \n\tEffectiveDate AS EffectiveDate3, \n\tExpirationDate AS ExpirationDate3, \n\tModifiedDate AS ModifiedDate3, \n\tCoverageGuid AS CoverageGuid3, \n\tUmbrellaLimit AS UmbrellaLimit3, \n\tUmbrellaPersonalInjuryLimit AS UmbrellaPersonalInjuryLimit3, \n\tUmbrellaUnderInsuredLimit AS UmbrellaUnderInsuredLimit3, \n\tUmbrellaUninsuredLimit AS UmbrellaUninsuredLimit3, \n\tUmbrellaRetentionLimit AS UmbrellaRetentionLimit3, \n\tUnderlyingPerOccurrenceLimit AS UnderlyingPerOccurrenceLimit3, \n\tUnderlyingPerOccurrenceClaimLimit AS UnderlyingPerOccurrenceClaimLimit3, \n\tUnderlyingAggregateLimit AS UnderlyingAggregateLimit3, \n\tUnderlyingPolicyAggregateLimit AS UnderlyingPolicyAggregateLimit3, \n\tUnderlyingProductAggregateLimit AS UnderlyingProductAggregateLimit3, \n\tUnderlyingProductCompletedOperationAggregateLimit AS UnderlyingProductCompletedOperationAggregateLimit3, \n\tUnderlyingAccidentLimit AS UnderlyingAccidentLimit3, \n\tUnderlyingDiseaseLimit AS UnderlyingDiseaseLimit3, \n\tUnderlyingCommonCauseLimit AS UnderlyingCommonCauseLimit3, \n\tUnderlyingEachPersonBodilyInjuryLimit AS UnderlyingEachPersonBodilyInjuryLimit3, \n\tUnderlyingEachPersonPropertyDamageLimit AS UnderlyingEachPersonPropertyDamageLimit3, \n\tUnderlyingLossOfMeansSupportLimit AS UnderlyingLossOfMeansSupportLimit3, \n\tUnderlyingCombinedSingleLimit AS UnderlyingCombinedSingleLimit3, \n\tUnderlyingAccidentGarageOperationsAutoOnlyLimit AS UnderlyingAccidentGarageOperationsAutoOnlyLimit3, \n\tUnderlyingAccidentGarageOperationsOtherThanAutoLimit AS UnderlyingAccidentGarageOperationsOtherThanAutoLimit3, \n\tUmbrellaCoverageScope AS UmbrellaCoverageScope3, \n\tRetroactiveDate AS RetroactiveDate3, \n\tUmbrellaLayer, \n\tUmbrellaPerOccurrenceLimit AS UmbrellaPerOccurrenceLimit3, \n\tUmbrellaAggregateLimit AS UmbrellaAggregateLimit3\n\tFROM RTR_INSERT_UPDATE_UPDATE\n),\nCoverageDetailCommercialUmbrellaDim_Update AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialUmbrellaDim AS T\n\tUSING UPD_Exists AS S\n\tON T.CoverageDetailDimId = S.CoverageDetailDimId3\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.AuditID = S.AuditID3, T.EffectiveDate = S.EffectiveDate3, T.ExpirationDate = S.ExpirationDate3, T.ModifiedDate = S.ModifiedDate3, T.CoverageGuid = S.CoverageGuid3, T.UmbrellaLimit = S.UmbrellaLimit3, T.UmbrellaPersonalInjuryLimit = S.UmbrellaPersonalInjuryLimit3, T.UmbrellaUnderInsuredLimit = S.UmbrellaUnderInsuredLimit3, T.UmbrellaUninsuredLimit = S.UmbrellaUninsuredLimit3, T.UmbrellaRetentionLimit = S.UmbrellaRetentionLimit3, T.UmbrellaCoverageScope = S.UmbrellaCoverageScope3, T.RetroactiveDate = S.RetroactiveDate3, T.UmbrellaLayer = S.UmbrellaLayer, T.UmbrellaPerOccurrenceLimit = S.UmbrellaPerOccurrenceLimit3, T.UmbrellaAggregateLimit = S.UmbrellaAggregateLimit3\n),"
                        }
                    ]
                }
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246503"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905513"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604121"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 01:14:33"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 01:30:27"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_WC_DATA_MART_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "RPT_EDM"
            },
            "TARGET_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "WC_Data_Mart"
            },
            "WHERE_CLAUSE_DCT": {
                "type": "string",
                "defaultValue": ""
            },
            "WHERE_CLAUSE_PMS": {
                "type": "string",
                "defaultValue": ""
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "Common DataMart/"
        },
        "annotations": []
    }
}