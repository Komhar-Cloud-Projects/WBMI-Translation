{
    "name": "s_m_POL_FEED_WorkCatastropheExposureLocation_DCT",
    "properties": {
        "activities": [
            {
                "name": "m_POL_FEED_WorkCatastropheExposureLocation_DCT",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_WorkCatastropheExposureTransaction AS (\n\tselect WCET.SourceSystemID,\r\n\tPOL.pol_key,\r\n\tWCET.LocationNumber,\r\n\tWCET.BusinessType,\r\n\tIRLE.InsuranceReferenceLegalEntityDescription,\r\n\tRL.StreetAddress,\r\n\tRL.RatingCity,\r\n\tSS.state_code,\r\n\tRL.ZipPostalCode,\r\n\tRL.RatingCounty,\r\n\tPT.PremiumTransactionAmount,\r\n\tAGY.AgencyCode,\r\n\tSPC.StrategicProfitCenterDescription, \r\n\tISG.InsuranceSegmentDescription,\r\n\tCC.name,\r\n\tCC.cust_num ,\r\n\tPOL.pol_eff_date,\r\n\tPOL.pol_exp_date,\r\n\tRTRIM(SUBSTRING(SBCC.StandardBusinessClassCode, 1, 5)) OccupancyCode,\r\n\tCC.sic_code,\r\n\t@{pipeline().parameters.PROCESS_DATE} ProcessDate, \r\n\tWCET.AddToLocationPremiumFlag, \r\n\tWCET.TerrorismRiskIndicator \r\n\tfrom @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureTransaction WCET\r\n\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction PT\r\n\ton WCET.PremiumTransactionAKId=PT.PremiumTransactionAKID\r\n\tand PT.CurrentSnapshotFlag=1\r\n\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage RC\r\n\ton PT.RatingCoverageAKID=RC.RatingCoverageAKID\r\n\tand RC.EffectiveDate=PT.EffectiveDate \r\n\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\ton PC.PolicyCoverageAKID=RC.PolicyCoverageAKID\r\n\tand PC.CurrentSnapshotFlag=1\r\n\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation RL\r\n\ton PC.RiskLocationAKID=RL.RiskLocationAKID\r\n\tand RL.CurrentSnapshotFlag=1\r\n\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy POL\r\n\ton POL.pol_ak_id=RL.PolicyAKID\r\n\tand POL.crrnt_snpsht_flag=1\r\n\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.contract_customer CC\r\n\ton CC.contract_cust_ak_id=POL.contract_cust_ak_id\r\n\tand CC.crrnt_snpsht_flag=1\r\n\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.Agency AGY\r\n\ton AGY.AgencyAKID=POL.AgencyAKId\r\n\tand AGY.CurrentSnapshotFlag=1\r\n\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_business_classification_code SBCC\r\n\ton SBCC.sup_bus_class_code_id=POL.sup_bus_class_code_id \r\n\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_state SS\r\n\ton (CASE WHEN len(SS.state_abbrev) = 1 THEN '0' + SS.state_abbrev ELSE SS.state_abbrev END) = (CASE WHEN len(RL.StateProvinceCode) = 1 THEN '0' + RL.StateProvinceCode ELSE RL.StateProvinceCode END)\r\n\tand SS.crrnt_snpsht_flag = 1\r\n\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment ISG\r\n\ton POL.InsuranceSegmentAKId=ISG.InsuranceSegmentAKId\r\n\tand ISG.CurrentSnapshotFlag=1\r\n\tand ISG.InsuranceSegmentAbbreviation = 'CL'\r\n\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter SPC\r\n\ton POL.StrategicProfitCenterAKId=SPC.StrategicProfitCenterAKId\r\n\tand SPC.CurrentSnapshotFlag=1 \r\n\tand SPC.StrategicProfitCenterDescription IN ('West Bend Commercial Lines', 'NSI')\r\n\tinner join @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLegalEntity IRLE\r\n\ton SPC.InsuranceReferenceLegalEntityId = IRLE.InsuranceReferenceLegalEntityId \r\n\tand IRLE.CurrentSnapshotFlag = 1\r\n\twhere WCET.BusinessType in ('Commercial Inland Marine', 'Dealers Physical Damage' , 'Garagekeepers Liability') \r\n\tAND WCET.LocationNumber <> '0000' \r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n),\nEXP_Cal AS (\n\tSELECT\n\tSourceSystemId,\n\tpol_key,\n\tLocationNumber,\n\tBusinessType,\n\tInsuranceReferenceLegalEntityDescription,\n\tStreetAddress,\n\tRatingCity,\n\tstate_code,\n\tZipPostalCode,\n\tRatingCounty,\n\tPremiumTransactionAmount,\n\tAgencyCode,\n\tStrategicProfitCenterDescription,\n\tInsuranceSegmentDescription,\n\tname,\n\tcust_num,\n\tpol_eff_date,\n\tpol_exp_date,\n\tOccupancyCode,\n\tsic_code,\n\tProcessDate,\n\tAddToLocationPremiumFlag,\n\tTerrorismRiskIndicator,\n\tpol_key AS o_PolicyKey,\n\t-- *INF*: IIF(state_code='N/A', '', RTRIM(state_code))\n\tIFF(state_code = 'N/A', '', RTRIM(state_code)) AS o_RatingStateProvinceAbbreviation,\n\t-- *INF*: SUBSTR(LTRIM(ZipPostalCode), 0, 5)\n\tSUBSTR(LTRIM(ZipPostalCode), 0, 5) AS o_RatingPostalCode,\n\tAgencyCode AS o_AgencyCode,\n\tname AS o_InsuredName,\n\t-- *INF*: RTRIM(SUBSTR(cust_num, 1, 12))\n\tRTRIM(SUBSTR(cust_num, 1, 12)) AS o_CustomerNumber,\n\tpol_eff_date AS o_PolicyEffectiveDate,\n\tpol_exp_date AS o_PolicyExpirationDate,\n\t-- *INF*: RTRIM(SUBSTR(sic_code, 1, 4))\n\tRTRIM(SUBSTR(sic_code, 1, 4)) AS o_SicCode\n\tFROM SQ_WorkCatastropheExposureTransaction\n),\nAGG_LocationPremium AS (\n\tSELECT\n\tSourceSystemId,\n\to_PolicyKey AS PolicyKey,\n\tLocationNumber,\n\tBusinessType,\n\tInsuranceReferenceLegalEntityDescription,\n\tStreetAddress,\n\tRatingCity,\n\to_RatingStateProvinceAbbreviation AS RatingStateProvinceAbbreviation,\n\to_RatingPostalCode AS RatingPostalCode,\n\tRatingCounty,\n\tPremiumTransactionAmount,\n\to_AgencyCode AS AgencyCode,\n\tStrategicProfitCenterDescription,\n\tInsuranceSegmentDescription,\n\to_InsuredName AS InsuredName,\n\to_CustomerNumber AS CustomerNumber,\n\to_PolicyEffectiveDate AS PolicyEffectiveDate,\n\to_PolicyExpirationDate AS PolicyExpirationDate,\n\tOccupancyCode,\n\to_SicCode AS SicCode,\n\tProcessDate,\n\tAddToLocationPremiumFlag,\n\tTerrorismRiskIndicator,\n\t-- *INF*: SUM(PremiumTransactionAmount, AddToLocationPremiumFlag='T')\n\tSUM(PremiumTransactionAmount, AddToLocationPremiumFlag = 'T') AS o_LocationPremium\n\tFROM EXP_Cal\n\tGROUP BY PolicyKey, LocationNumber, BusinessType\n),\nLKP_WorkCatastropheExposureDeductible AS (\n\tSELECT\n\tDeductibleValue,\n\tPolicyKey,\n\tLocationNumber,\n\tBusinessType\n\tFROM (\n\t\tSELECT D.PolicyKey AS PolicyKey, D.LocationNumber AS LocationNumber, D.BusinessType AS BusinessType,\r\n\t\t RelevantDeductibles.TargetColumn AS TargetColumn,\r\n\t\t (CASE WHEN RelevantDeductibles.CalculationRule = 'MAX' THEN MAX(CONVERT(BIGINT, D.DeductibleValue)) \r\n\t\t  WHEN RelevantDeductibles.CalculationRule = 'MIN' THEN MIN(CONVERT(BIGINT, D.DeductibleValue)) \r\n\t\t  WHEN RelevantDeductibles.CalculationRule = 'SUM' THEN SUM(CONVERT(BIGINT, D.DeductibleValue)) \r\n\t\t  ELSE 0 \r\n\t\t END) AS DeductibleValue\r\n\t\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureDeductible D\r\n\t\tINNER JOIN (SELECT DISTINCT BusinessType, DeductibleType, CalculationRule, TargetColumn \r\n\t\t  FROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.SupCatastropheExposureDeductibleRule \r\n\t\t  WHERE TargetColumn = 'Loc Dedctbl' \r\n\t\t  AND SourceSystemId = 'DCT') RelevantDeductibles ON D.BusinessType = RelevantDeductibles.BusinessType AND D.DeductibleType = RelevantDeductibles.DeductibleType\r\n\t\tWHERE D.BusinessType IN ('Commercial Inland Marine', 'Dealers Physical Damage', 'Garagekeepers Liability')\r\n\t\tGROUP BY D.PolicyKey, D.LocationNumber, D.BusinessType, RelevantDeductibles.TargetColumn, RelevantDeductibles.CalculationRule\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey,LocationNumber,BusinessType ORDER BY DeductibleValue) = 1\n),\nLKP_WorkCatastropheExposureLimit AS (\n\tSELECT\n\tLimitValue,\n\tPolicyKey,\n\tLocationNumber,\n\tBusinessType\n\tFROM (\n\t\tSELECT L.PolicyKey AS PolicyKey, L.LocationNumber AS LocationNumber, L.BusinessType AS BusinessType,\r\n\t\t RelevantLimits.TargetColumn AS TargetColumn,\r\n\t\t (CASE WHEN RelevantLimits.CalculationRule = 'MAX' THEN MAX(CONVERT(BIGINT, L.LimitValue)) \r\n\t\t  WHEN RelevantLimits.CalculationRule = 'MIN' THEN MIN(CONVERT(BIGINT, L.LimitValue)) \r\n\t\t  WHEN RelevantLimits.CalculationRule = 'SUM' THEN SUM(CONVERT(BIGINT, L.LimitValue)) \r\n\t\t  ELSE 0 \r\n\t\t END) AS LimitValue\r\n\t\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureLimit L\r\n\t\tINNER JOIN (SELECT DISTINCT BusinessType, LimitType, CalculationRule, TargetColumn \r\n\t\t  FROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.SupCatastropheExposureLimitRule \r\n\t\t  WHERE TargetColumn = 'Loc Limit' \r\n\t\t  AND SourceSystemId = 'DCT') RelevantLimits ON L.BusinessType = RelevantLimits.BusinessType AND L.LimitType = RelevantLimits.LimitType\r\n\t\tWHERE L.BusinessType IN ('Commercial Inland Marine', 'Dealers Physical Damage', 'Garagekeepers Liability')\r\n\t\tGROUP BY L.PolicyKey, L.LocationNumber, L.BusinessType, RelevantLimits.TargetColumn, RelevantLimits.CalculationRule\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey,LocationNumber,BusinessType ORDER BY LimitValue) = 1\n),\nLKP_WorkCatastropheExposureTransaction_ALS AS (\n\tSELECT\n\tDCTCoverageTypeCode,\n\tPolicyKey,\n\tLocationNumber,\n\tBusinessType\n\tFROM (\n\t\tSELECT \n\t\t\tDCTCoverageTypeCode,\n\t\t\tPolicyKey,\n\t\t\tLocationNumber,\n\t\t\tBusinessType\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureTransaction\n\t\tWHERE DctCoverageTypeCode = 'ALS'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey,LocationNumber,BusinessType ORDER BY DCTCoverageTypeCode) = 1\n),\nLKP_WorkCatastropheExposureTransaction_CLM AS (\n\tSELECT\n\tCoverageGroupDescription,\n\tPolicyKey,\n\tLocationNumber,\n\tBusinessType\n\tFROM (\n\t\tSELECT \n\t\t\tCoverageGroupDescription,\n\t\t\tPolicyKey,\n\t\t\tLocationNumber,\n\t\t\tBusinessType\n\t\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureTransaction\n\t\tWHERE (TerrorismRiskIndicator = 1   or (CoverageGroupDescription = 'Terrorism' and PremiumTransactionAmount > 0.0)   )\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey,LocationNumber,BusinessType ORDER BY CoverageGroupDescription) = 1\n),\nLKP_WorkCatastropheExposureTransaction_DPD AS (\n\tSELECT\n\tTerrorismRiskIndicator,\n\tPolicyKey,\n\tBusinessType\n\tFROM (\n\t\tSELECT \n\t\t\tTerrorismRiskIndicator,\n\t\t\tPolicyKey,\n\t\t\tBusinessType\n\t\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureTransaction\n\t\tWHERE TerrorismRiskIndicator=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey,BusinessType ORDER BY TerrorismRiskIndicator) = 1\n),\nLKP_WorkCatastropheExposureTransaction_PlusPak AS (\n\tSELECT\n\tCoverageDescription,\n\tPolicyKey\n\tFROM (\n\t\tSELECT \n\t\t\tCoverageDescription,\n\t\t\tPolicyKey\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureTransaction\n\t\tWHERE DctCoverageTypeCode in ('PlusPakGarage','PlusPakAuto')\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey ORDER BY CoverageDescription) = 1\n),\nLKP_WorkCatastropheExposureTransaction_PlusPak_CIM AS (\n\tSELECT\n\tPolicyKey,\n\ti_PolicyKey\n\tFROM (\n\t\tSELECT \n\t\t\tPolicyKey,\n\t\t\ti_PolicyKey\n\t\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureTransaction\n\t\tWHERE BusinessType = 'SBOP' or \r\n\t\t(BusinessType in ('SMARTbusiness','Commercial Property') and\r\n\t\tCoverageDescription = 'Plus Pak')\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey ORDER BY PolicyKey) = 1\n),\nLKP_WorkCatastropheExposureTransaction_SMART AS (\n\tSELECT\n\tPolicyKey,\n\tLocationNumber,\n\tin_PolicyKey,\n\tin_LocationNumber\n\tFROM (\n\t\tSELECT \n\t\t\tPolicyKey,\n\t\t\tLocationNumber,\n\t\t\tin_PolicyKey,\n\t\t\tin_LocationNumber\n\t\tFROM WorkCatastropheExposureTransaction\n\t\tWHERE BusinessType = 'SMARTbusiness' and PolicyOfferingDescription = 'SMARTbusiness' and CoverageGroupDescription = 'Terrorism'  and (TerrorismRiskIndicator = 1\r\n\t\t  or (CoverageGroupDescription = 'Terrorism' and PremiumTransactionAmount > 0.0)\r\n\t\t  )\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey,LocationNumber ORDER BY PolicyKey) = 1\n),\nLKP_WorkCatastropheExposureTransaction_TerrorismCoverage AS (\n\tSELECT\n\tCoverageGroupDescription,\n\tPolicyKey,\n\tBusinessType\n\tFROM (\n\t\tSELECT \n\t\t\tCoverageGroupDescription,\n\t\t\tPolicyKey,\n\t\t\tBusinessType\n\t\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureTransaction\n\t\tWHERE CoverageGroupDescription='Terrorism'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey,BusinessType ORDER BY CoverageGroupDescription) = 1\n),\nLKP_WorkCatastropheExposureTransaction_WindCoverageFlag AS (\n\tSELECT\n\tWindCoverageFlag,\n\tPolicyKey,\n\tLocationNumber,\n\tBusinessType\n\tFROM (\n\t\tSELECT \n\t\t\tWindCoverageFlag,\n\t\t\tPolicyKey,\n\t\t\tLocationNumber,\n\t\t\tBusinessType\n\t\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureTransaction\n\t\tWHERE WindCoverageFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PolicyKey,LocationNumber,BusinessType ORDER BY WindCoverageFlag) = 1\n),\nEXP_MetaData AS (\n\tSELECT\n\tAGG_LocationPremium.SourceSystemId,\n\tAGG_LocationPremium.PolicyKey,\n\tAGG_LocationPremium.LocationNumber,\n\tAGG_LocationPremium.BusinessType,\n\tAGG_LocationPremium.InsuranceReferenceLegalEntityDescription,\n\tAGG_LocationPremium.StreetAddress,\n\tAGG_LocationPremium.RatingCity,\n\tAGG_LocationPremium.RatingStateProvinceAbbreviation,\n\tAGG_LocationPremium.RatingPostalCode,\n\tAGG_LocationPremium.RatingCounty,\n\tAGG_LocationPremium.o_LocationPremium AS i_LocationPremium,\n\t-- *INF*: IIF(ISNULL(i_LocationPremium),0,i_LocationPremium)\n\tIFF(i_LocationPremium IS NULL, 0, i_LocationPremium) AS o_LocationPremium,\n\tLKP_WorkCatastropheExposureLimit.LimitValue AS LocationLimit,\n\tLKP_WorkCatastropheExposureDeductible.DeductibleValue AS LocationDeductible,\n\tAGG_LocationPremium.AgencyCode,\n\tAGG_LocationPremium.StrategicProfitCenterDescription,\n\tAGG_LocationPremium.InsuranceSegmentDescription,\n\tAGG_LocationPremium.InsuredName,\n\tAGG_LocationPremium.CustomerNumber,\n\tAGG_LocationPremium.PolicyEffectiveDate,\n\tAGG_LocationPremium.PolicyExpirationDate,\n\tAGG_LocationPremium.OccupancyCode,\n\tAGG_LocationPremium.SicCode,\n\tAGG_LocationPremium.ProcessDate,\n\tAGG_LocationPremium.TerrorismRiskIndicator,\n\tLKP_WorkCatastropheExposureTransaction_PlusPak.CoverageDescription AS lkp_CoverageDescription,\n\tLKP_WorkCatastropheExposureTransaction_ALS.DCTCoverageTypeCode AS lkp_DCTCoverageTypeCode,\n\tLKP_WorkCatastropheExposureTransaction_WindCoverageFlag.WindCoverageFlag AS lkp_WindCoverageFlag,\n\tLKP_WorkCatastropheExposureTransaction_TerrorismCoverage.CoverageGroupDescription AS lkp_CoverageGroupDescription,\n\tLKP_WorkCatastropheExposureTransaction_CLM.CoverageGroupDescription AS lkp_Coverage_Terrorism,\n\tLKP_WorkCatastropheExposureTransaction_PlusPak_CIM.PolicyKey AS lkp_PolicyKey_CIM,\n\tLKP_WorkCatastropheExposureTransaction_SMART.PolicyKey AS lkp_PolicyKey_SMART,\n\tLKP_WorkCatastropheExposureTransaction_DPD.TerrorismRiskIndicator AS lkp_TerrorismRiskIndicator,\n\t-- *INF*: IIF( in(BusinessType,'Dealers Physical Damage','Garagekeepers Liability') and NOT ISNULL(lkp_CoverageDescription), '1', \r\n\t-- IIF( BusinessType='Commercial Inland Marine' and NOT ISNULL(lkp_PolicyKey_CIM), \r\n\t-- '1','0'))\n\tIFF(\n\t    BusinessType IN ('Dealers Physical Damage','Garagekeepers Liability')\n\t    and lkp_CoverageDescription IS NOT NULL,\n\t    '1',\n\t    IFF(\n\t        BusinessType = 'Commercial Inland Marine'\n\t    and lkp_PolicyKey_CIM IS NOT NULL, '1',\n\t        '0'\n\t    )\n\t) AS v_PlusPakFlag,\n\t-- *INF*: IIF(v_PlusPakFlag ='1' , ROUND(LocationLimit*1.05, 0),LocationLimit)\n\tIFF(v_PlusPakFlag = '1', ROUND(LocationLimit * 1.05, 0), LocationLimit) AS v_AdjustedTotalInsuredValue,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- IN(BusinessType, 'Dealers Physical Damage', 'Garagekeepers Liability') AND lkp_WindCoverageFlag='T', '1',\r\n\t-- BusinessType='Commercial Inland Marine', '0',\r\n\t-- '0')\n\tDECODE(\n\t    TRUE,\n\t    BusinessType IN ('Dealers Physical Damage','Garagekeepers Liability') AND lkp_WindCoverageFlag = 'T', '1',\n\t    BusinessType = 'Commercial Inland Marine', '0',\n\t    '0'\n\t) AS v_LocationWindCoverageFlag,\n\t-- *INF*: IIF(lkp_DCTCoverageTypeCode = 'ALS', '1', '0')\n\tIFF(lkp_DCTCoverageTypeCode = 'ALS', '1', '0') AS v_ActualLossSustainedCoverageFlag,\n\t-- *INF*: IIF( in(BusinessType,'Dealers Physical Damage','Garagekeepers Liability') AND NOT ISNULL(lkp_TerrorismRiskIndicator),'1',\r\n\t-- IIF( BusinessType='Commercial Inland Marine' AND  NOT ISNULL(lkp_Coverage_Terrorism),'1',\r\n\t-- IIF(BusinessType='Commercial Inland Marine'  AND  NOT  ISNULL(lkp_PolicyKey_SMART),'1','0')))\r\n\t-- \r\n\t--  \n\tIFF(\n\t    BusinessType IN ('Dealers Physical Damage','Garagekeepers Liability')\n\t    and lkp_TerrorismRiskIndicator IS NOT NULL,\n\t    '1',\n\t    IFF(\n\t        BusinessType = 'Commercial Inland Marine'\n\t    and lkp_Coverage_Terrorism IS NOT NULL,\n\t        '1',\n\t        IFF(\n\t            BusinessType = 'Commercial Inland Marine'\n\t        and lkp_PolicyKey_SMART IS NOT NULL,\n\t            '1',\n\t            '0'\n\t        )\n\t    )\n\t) AS v_TerrorismFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditId,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\tv_AdjustedTotalInsuredValue AS o_AdjustedTotalInsuredValue,\n\tv_LocationWindCoverageFlag AS o_LocationWindCoverageFlag,\n\tv_PlusPakFlag AS o_PlusPakFlag,\n\tv_ActualLossSustainedCoverageFlag AS o_ActualLossSustainedCoverageFlag,\n\tv_TerrorismFlag AS o_TerrorismFlag\n\tFROM AGG_LocationPremium\n\tLEFT JOIN LKP_WorkCatastropheExposureDeductible\n\tON LKP_WorkCatastropheExposureDeductible.PolicyKey = AGG_LocationPremium.PolicyKey AND LKP_WorkCatastropheExposureDeductible.LocationNumber = AGG_LocationPremium.LocationNumber AND LKP_WorkCatastropheExposureDeductible.BusinessType = AGG_LocationPremium.BusinessType\n\tLEFT JOIN LKP_WorkCatastropheExposureLimit\n\tON LKP_WorkCatastropheExposureLimit.PolicyKey = AGG_LocationPremium.PolicyKey AND LKP_WorkCatastropheExposureLimit.LocationNumber = AGG_LocationPremium.LocationNumber AND LKP_WorkCatastropheExposureLimit.BusinessType = AGG_LocationPremium.BusinessType\n\tLEFT JOIN LKP_WorkCatastropheExposureTransaction_ALS\n\tON LKP_WorkCatastropheExposureTransaction_ALS.PolicyKey = AGG_LocationPremium.PolicyKey AND LKP_WorkCatastropheExposureTransaction_ALS.LocationNumber = AGG_LocationPremium.LocationNumber AND LKP_WorkCatastropheExposureTransaction_ALS.BusinessType = AGG_LocationPremium.BusinessType\n\tLEFT JOIN LKP_WorkCatastropheExposureTransaction_CLM\n\tON LKP_WorkCatastropheExposureTransaction_CLM.PolicyKey = AGG_LocationPremium.PolicyKey AND LKP_WorkCatastropheExposureTransaction_CLM.LocationNumber = AGG_LocationPremium.LocationNumber AND LKP_WorkCatastropheExposureTransaction_CLM.BusinessType = AGG_LocationPremium.BusinessType\n\tLEFT JOIN LKP_WorkCatastropheExposureTransaction_DPD\n\tON LKP_WorkCatastropheExposureTransaction_DPD.PolicyKey = AGG_LocationPremium.PolicyKey AND LKP_WorkCatastropheExposureTransaction_DPD.BusinessType = AGG_LocationPremium.BusinessType\n\tLEFT JOIN LKP_WorkCatastropheExposureTransaction_PlusPak\n\tON LKP_WorkCatastropheExposureTransaction_PlusPak.PolicyKey = AGG_LocationPremium.PolicyKey\n\tLEFT JOIN LKP_WorkCatastropheExposureTransaction_PlusPak_CIM\n\tON LKP_WorkCatastropheExposureTransaction_PlusPak_CIM.PolicyKey = AGG_LocationPremium.PolicyKey\n\tLEFT JOIN LKP_WorkCatastropheExposureTransaction_SMART\n\tON LKP_WorkCatastropheExposureTransaction_SMART.PolicyKey = AGG_LocationPremium.PolicyKey AND LKP_WorkCatastropheExposureTransaction_SMART.LocationNumber = AGG_LocationPremium.LocationNumber\n\tLEFT JOIN LKP_WorkCatastropheExposureTransaction_TerrorismCoverage\n\tON LKP_WorkCatastropheExposureTransaction_TerrorismCoverage.PolicyKey = AGG_LocationPremium.PolicyKey AND LKP_WorkCatastropheExposureTransaction_TerrorismCoverage.BusinessType = AGG_LocationPremium.BusinessType\n\tLEFT JOIN LKP_WorkCatastropheExposureTransaction_WindCoverageFlag\n\tON LKP_WorkCatastropheExposureTransaction_WindCoverageFlag.PolicyKey = AGG_LocationPremium.PolicyKey AND LKP_WorkCatastropheExposureTransaction_WindCoverageFlag.LocationNumber = AGG_LocationPremium.LocationNumber AND LKP_WorkCatastropheExposureTransaction_WindCoverageFlag.BusinessType = AGG_LocationPremium.BusinessType\n),\nFil_Null_Values AS (\n\tSELECT\n\tSourceSystemId, \n\tPolicyKey, \n\tLocationNumber, \n\tBusinessType, \n\tInsuranceReferenceLegalEntityDescription, \n\tStreetAddress, \n\tRatingCity, \n\tRatingStateProvinceAbbreviation, \n\tRatingPostalCode, \n\tRatingCounty, \n\to_LocationPremium AS LocationPremium, \n\tLocationLimit, \n\tLocationDeductible, \n\tAgencyCode, \n\tStrategicProfitCenterDescription, \n\tInsuranceSegmentDescription, \n\tInsuredName, \n\tCustomerNumber, \n\tPolicyEffectiveDate, \n\tPolicyExpirationDate, \n\tOccupancyCode, \n\tSicCode, \n\tProcessDate, \n\to_AuditId, \n\to_CreatedDate, \n\to_ModifiedDate, \n\to_AdjustedTotalInsuredValue, \n\to_LocationWindCoverageFlag, \n\to_PlusPakFlag, \n\to_ActualLossSustainedCoverageFlag, \n\to_TerrorismFlag\n\tFROM EXP_MetaData\n\tWHERE IIF(ISNULL(LocationPremium),0, LocationPremium)!=0\r\nOR\r\nIIF(ISNULL(LocationLimit),0, LocationLimit)!=0 \r\nOR\r\nIIF(ISNULL(LocationDeductible),0, LocationDeductible)!=0\n),\nWorkCatastropheExposureLocation AS (\n\tTRUNCATE TABLE @{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureLocation;\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.WorkCatastropheExposureLocation\n\t(AuditId, CreatedDate, ModifiedDate, SourceSystemId, PolicyKey, LocationNumber, BusinessType, InsuranceReferenceLegalEntityDescription, RatingAddress, RatingCity, RatingStateProvinceAbbreviation, RatingPostalCode, RatingCounty, LocationPremium, LocationLimit, LocationDeductible, AdjustedTotalInsuredValue, LocationWindCoverageFlag, AgencyCode, StrategicProfitCenterDescription, InsuranceSegmentDescription, PlusPakFlag, ActualLossSustainedCoverageFlag, InsuredName, CustomerNumber, PolicyEffectiveDate, PolicyExpirationDate, OccupancyCode, SicCode, TerrorismFlag, ProcessDate)\n\tSELECT \n\to_AuditId AS AUDITID, \n\to_CreatedDate AS CREATEDDATE, \n\to_ModifiedDate AS MODIFIEDDATE, \n\tSOURCESYSTEMID, \n\tPOLICYKEY, \n\tLOCATIONNUMBER, \n\tBUSINESSTYPE, \n\tINSURANCEREFERENCELEGALENTITYDESCRIPTION, \n\tStreetAddress AS RATINGADDRESS, \n\tRATINGCITY, \n\tRATINGSTATEPROVINCEABBREVIATION, \n\tRATINGPOSTALCODE, \n\tRATINGCOUNTY, \n\tLOCATIONPREMIUM, \n\tLOCATIONLIMIT, \n\tLOCATIONDEDUCTIBLE, \n\to_AdjustedTotalInsuredValue AS ADJUSTEDTOTALINSUREDVALUE, \n\to_LocationWindCoverageFlag AS LOCATIONWINDCOVERAGEFLAG, \n\tAGENCYCODE, \n\tSTRATEGICPROFITCENTERDESCRIPTION, \n\tINSURANCESEGMENTDESCRIPTION, \n\to_PlusPakFlag AS PLUSPAKFLAG, \n\to_ActualLossSustainedCoverageFlag AS ACTUALLOSSSUSTAINEDCOVERAGEFLAG, \n\tINSUREDNAME, \n\tCUSTOMERNUMBER, \n\tPOLICYEFFECTIVEDATE, \n\tPOLICYEXPIRATIONDATE, \n\tOCCUPANCYCODE, \n\tSICCODE, \n\to_TerrorismFlag AS TERRORISMFLAG, \n\tPROCESSDATE\n\tFROM Fil_Null_Values\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "PROCESS_DATE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_TABLE_OWNER_V2": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "DataFeed -Informatica/PolicyDataServices/"
        },
        "annotations": []
    }
}