{
    "name": "m_POL_DW_LOAD_CoverageDetailBusinessOwners_DCT",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DW_LOAD_CoverageDetailBusinessOwners_DCT",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_DCTWorkTable AS (\n\tSELECT\n\t\tWorkDCTPolicy.BCCCode,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.CoverageId,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.OccupancyType,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.PredominantPersonalPropertyRateNumber,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.PredominantLiabilityLiabClassGroup,\n\t\tWorkDCTCoverageTransaction.CoverageGUID,\n\t\tWorkDCTCoverageTransaction.CoverageType,\n\t\tWorkDCTInsuranceLine.LineId,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.ISOOccupancyType,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.PredominantBuildingBCCCode\n\tFROM WorkDCTTransactionInsuranceLineLocationBridge\n\tINNER JOIN WorkDCTCoverageTransaction\n\tINNER JOIN WorkDCTInsuranceLine\n\tINNER JOIN WorkDCTPolicy\n\tON WorkDCTPolicy.PolicyId=WorkDCTInsuranceLine.PolicyId\r\n\tand\r\n\tWorkDCTInsuranceLine.LineId=WorkDCTTransactionInsuranceLineLocationBridge.LineId\r\n\tand\r\n\tWorkDCTInsuranceLine.LineType in ('BusinessOwners')\r\n\tand\r\n\tWorkDCTCoverageTransaction.CoverageId=WorkDCTTransactionInsuranceLineLocationBridge.CoverageId\n),\nEXP_Stage AS (\n\tSELECT\n\tBCCCode AS i_BCCCode,\n\tCoverageId,\n\tOccupancyType AS i_OccupancyType,\n\tPredominantPersonalPropertyRateNumber AS i_PropertyRateNumber,\n\tPredominantLiabilityLiabClassGroup AS i_LiabilityClassGroup,\n\tCoverageGUID,\n\tCoverageType AS i_CoverageType,\n\tISOOccupancyType AS i_ISOOccupancyType,\n\tPredominantBuildingBCCCode AS i_PredominantBuildingBCCCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_ISOOccupancyType)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(i_ISOOccupancyType) AS o_ISOOccupancyType,\n\t-- *INF*: IIF(IN(i_LiabilityClassGroup,'51','52','53','54','55','56','57','58','59')=1 AND i_ISOOccupancyType='Lessors Liability' ,1,0)\n\tIFF(IN(i_LiabilityClassGroup, '51', '52', '53', '54', '55', '56', '57', '58', '59') = 1 AND i_ISOOccupancyType = 'Lessors Liability', 1, 0) AS v_LiabilityClassGroup_51_59_Flag,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- NOT ISNULL(i_PropertyRateNumber),i_PropertyRateNumber,\r\n\t-- REG_MATCH(i_CoverageType,'.*PlusPak.*')=1,'Plus Pak',\r\n\t-- 'Policy Level')\n\tDECODE(TRUE,\n\tNOT i_PropertyRateNumber IS NULL, i_PropertyRateNumber,\n\tREG_MATCH(i_CoverageType, '.*PlusPak.*') = 1, 'Plus Pak',\n\t'Policy Level') AS o_PropertyRateNumber,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_LiabilityClassGroup_51_59_Flag=1 AND i_BCCCode='1328','51-59  Office',\r\n\t-- v_LiabilityClassGroup_51_59_Flag=1 AND IN(i_BCCCode,'1326','189','1098','1330','1408','692','907')=1,'51-59  Shop/Storage',\r\n\t-- NOT ISNULL(i_LiabilityClassGroup),i_LiabilityClassGroup,\r\n\t-- REG_MATCH(i_CoverageType,'.*PlusPak.*')=1,'Plus Pak',\r\n\t-- 'Policy Level')\n\tDECODE(TRUE,\n\tv_LiabilityClassGroup_51_59_Flag = 1 AND i_BCCCode = '1328', '51-59  Office',\n\tv_LiabilityClassGroup_51_59_Flag = 1 AND IN(i_BCCCode, '1326', '189', '1098', '1330', '1408', '692', '907') = 1, '51-59  Shop/Storage',\n\tNOT i_LiabilityClassGroup IS NULL, i_LiabilityClassGroup,\n\tREG_MATCH(i_CoverageType, '.*PlusPak.*') = 1, 'Plus Pak',\n\t'Policy Level') AS o_LiabilityClassGroup,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_PredominantBuildingBCCCode)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(i_PredominantBuildingBCCCode) AS o_PredominantBuildingBCCCode\n\tFROM SQ_DCTWorkTable\n),\nSQ_EDW_DCT AS (\n\tSELECT DISTINCT PT.PremiumTransactionID, WPT.PremiumTransactionStageId \r\n\tFROM   @{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkPremiumTransaction WPT \r\n\t       INNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Premiumtransaction PT ON PT.PremiumTransactionAKID = WPT.PremiumTransactionAKID \r\n\t       INNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Ratingcoverage RC ON RC.RatingCoverageAKID = PT.RatingCoverageAKID AND RC.Effectivedate = PT.Effectivedate \r\n\t       INNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Policycoverage PC ON RC.PolicyCoverageAKID = PC.PolicyCoverageAKID AND PC.Currentsnapshotflag =1 \r\n\tWHERE  PT.Sourcesystemid = '@{pipeline().parameters.SOURCE_SYSTEM_ID}' AND WPT.Sourcesystemid = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\r\n\tAND PC.InsuranceLine in ('BusinessOwners')\n),\nJNR_IL_Stage AS (SELECT\n\tSQ_EDW_DCT.PremiumTransactionID, \n\tSQ_EDW_DCT.PremiumTransactionStageId, \n\tEXP_Stage.CoverageId, \n\tEXP_Stage.CoverageGUID, \n\tEXP_Stage.o_PropertyRateNumber AS PropertyRateNumber, \n\tEXP_Stage.o_LiabilityClassGroup AS LiabilityClassGroup, \n\tEXP_Stage.o_ISOOccupancyType AS ISOOccupancyType, \n\tEXP_Stage.o_PredominantBuildingBCCCode AS PredominantBuildingBCCCode\n\tFROM SQ_EDW_DCT\n\tINNER JOIN EXP_Stage\n\tON EXP_Stage.CoverageId = SQ_EDW_DCT.PremiumTransactionStageId\n),\nAGG_DuplicateRemove AS (\n\tSELECT\n\tPremiumTransactionID, \n\tCoverageGUID, \n\tPropertyRateNumber AS ISOBusinessOwnersPropertyRateNumber, \n\tLiabilityClassGroup AS ISOBusinessOwnersLiabilityClassGroup, \n\tISOOccupancyType, \n\tPredominantBuildingBCCCode\n\tFROM JNR_IL_Stage\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionID ORDER BY NULL) = 1\n),\nEXP_Metadata AS (\n\tSELECT\n\tPremiumTransactionID AS i_PremiumTransactionID,\n\tCoverageGUID AS i_CoverageGUID,\n\tISOBusinessOwnersPropertyRateNumber AS i_ISOBusinessOwnersPropertyRateNumber,\n\tISOBusinessOwnersLiabilityClassGroup AS i_ISOBusinessOwnersLiabilityClassGroup,\n\tISOOccupancyType AS i_ISOOccupancyType,\n\tPredominantBuildingBCCCode AS i_PredominantBuildingBCCCode,\n\ti_PremiumTransactionID AS o_PremiumTransactionID,\n\t-- *INF*: RTRIM(LTRIM(i_CoverageGUID))\n\tRTRIM(LTRIM(i_CoverageGUID)) AS o_CoverageGUID,\n\t-- *INF*: IIF(NOT ISNULL(i_ISOBusinessOwnersPropertyRateNumber),i_ISOBusinessOwnersPropertyRateNumber,'N/A')\n\tIFF(NOT i_ISOBusinessOwnersPropertyRateNumber IS NULL, i_ISOBusinessOwnersPropertyRateNumber, 'N/A') AS o_ISOBusinessOwnersPropertyRateNumber,\n\t-- *INF*: IIF(NOT ISNULL(i_ISOBusinessOwnersLiabilityClassGroup),i_ISOBusinessOwnersLiabilityClassGroup,'N/A')\n\tIFF(NOT i_ISOBusinessOwnersLiabilityClassGroup IS NULL, i_ISOBusinessOwnersLiabilityClassGroup, 'N/A') AS o_ISOBusinessOwnersLiabilityClassGroup,\n\ti_ISOOccupancyType AS o_ISOOccupancyType,\n\t-- *INF*: IIF(i_PredominantBuildingBCCCode != 'N/A',LPAD(i_PredominantBuildingBCCCode,5,'0'),i_PredominantBuildingBCCCode)\r\n\t-- \r\n\t-- -- pad a 4 char code to 5 with a leading zero if valid, else N/A\n\tIFF(i_PredominantBuildingBCCCode != 'N/A', LPAD(i_PredominantBuildingBCCCode, 5, '0'), i_PredominantBuildingBCCCode) AS o_PredominantBuildingBCCCode_padded\n\tFROM AGG_DuplicateRemove\n),\nLKP_CoverageDetailBusinessOwners AS (\n\tSELECT\n\tPremiumTransactionID,\n\tCoverageGuid,\n\tISOBusinessOwnersPropertyRateNumber,\n\tISOBusinessOwnersLiabilityClassGroup,\n\tISOOccupancyType,\n\tBuildingBCCCode,\n\tBuildingClassCodeDescription\n\tFROM (\n\t\tSELECT \n\t\t\tPremiumTransactionID,\n\t\t\tCoverageGuid,\n\t\t\tISOBusinessOwnersPropertyRateNumber,\n\t\t\tISOBusinessOwnersLiabilityClassGroup,\n\t\t\tISOOccupancyType,\n\t\t\tBuildingBCCCode,\n\t\t\tBuildingClassCodeDescription\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailBusinessOwners\n\t\tWHERE SourceSystemId='@{pipeline().parameters.SOURCE_SYSTEM_ID}'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionID ORDER BY PremiumTransactionID) = 1\n),\nLKP_Sup_Bus_Class_Code AS (\n\tSELECT\n\tStandardBusinessClassCode,\n\tStandardBusinessClassCodeDescription,\n\tbus_class_code\n\tFROM (\n\t\tSELECT \n\t\t\tStandardBusinessClassCode,\n\t\t\tStandardBusinessClassCodeDescription,\n\t\t\tbus_class_code\n\t\tFROM sup_business_classification_code\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY bus_class_code ORDER BY StandardBusinessClassCode) = 1\n),\nEXP_Metadata1 AS (\n\tSELECT\n\tLKP_CoverageDetailBusinessOwners.PremiumTransactionID AS lkp_PremiumTransactionID,\n\tLKP_CoverageDetailBusinessOwners.CoverageGuid AS lkp_CoverageGuid,\n\tLKP_CoverageDetailBusinessOwners.ISOBusinessOwnersPropertyRateNumber AS lkp_ISOBusinessOwnersPropertyRateNumber,\n\tLKP_CoverageDetailBusinessOwners.ISOBusinessOwnersLiabilityClassGroup AS lkp_ISOBusinessOwnersLiabilityClassGroup,\n\tLKP_CoverageDetailBusinessOwners.ISOOccupancyType AS lkp_ISOOccupancyType,\n\tLKP_CoverageDetailBusinessOwners.BuildingBCCCode AS lkp_BuildingBCCCode,\n\tLKP_CoverageDetailBusinessOwners.BuildingClassCodeDescription AS lkp_BuildingClassCodeDescription,\n\tLKP_Sup_Bus_Class_Code.StandardBusinessClassCode AS lkp_sup_StandardBusinessClassCode,\n\tLKP_Sup_Bus_Class_Code.StandardBusinessClassCodeDescription AS lkp_sup_StandardBusinessClassCodeDescription,\n\tEXP_Metadata.o_PremiumTransactionID AS i_PremiumTransactionID,\n\tEXP_Metadata.o_CoverageGUID AS i_CoverageGUID,\n\tEXP_Metadata.o_ISOBusinessOwnersPropertyRateNumber AS i_ISOBusinessOwnersPropertyRateNumber,\n\tEXP_Metadata.o_ISOBusinessOwnersLiabilityClassGroup AS i_ISOBusinessOwnersLiabilityClassGroup,\n\tEXP_Metadata.o_ISOOccupancyType AS i_ISOOccupancyType,\n\t-- *INF*: RTRIM(LTRIM(lkp_CoverageGuid))\n\tRTRIM(LTRIM(lkp_CoverageGuid)) AS v_lkp_CoverageGuid,\n\ti_PremiumTransactionID AS o_PremiumTransactionID,\n\t'1' AS o_CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t-- *INF*: TO_DATE('1800-01-01 00:00:00.000', 'YYYY-MM-DD HH24:MI:SS.US')\n\tTO_DATE('1800-01-01 00:00:00.000', 'YYYY-MM-DD HH24:MI:SS.US') AS o_EffectiveDate,\n\t-- *INF*: TO_DATE('2100-12-31 23:59:59.000', 'YYYY-MM-DD HH24:MI:SS.US')\n\tTO_DATE('2100-12-31 23:59:59.000', 'YYYY-MM-DD HH24:MI:SS.US') AS o_ExpirationDate,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemID,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\ti_CoverageGUID AS o_CoverageGUID,\n\ti_ISOBusinessOwnersPropertyRateNumber AS o_ISOBusinessOwnersPropertyRateNumber,\n\ti_ISOBusinessOwnersLiabilityClassGroup AS o_ISOBusinessOwnersLiabilityClassGroup,\n\ti_ISOOccupancyType AS o_ISOOccupancyType,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(lkp_sup_StandardBusinessClassCode)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(lkp_sup_StandardBusinessClassCode) AS o_StandardBusinessClassCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(lkp_sup_StandardBusinessClassCodeDescription)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(lkp_sup_StandardBusinessClassCodeDescription) AS o_StandardBusinessClassCodeDescription,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- ISNULL(lkp_PremiumTransactionID),'NEW',\r\n\t-- v_lkp_CoverageGuid != i_CoverageGUID\r\n\t-- OR lkp_ISOBusinessOwnersPropertyRateNumber != i_ISOBusinessOwnersPropertyRateNumber \r\n\t-- OR lkp_ISOBusinessOwnersLiabilityClassGroup !=i_ISOBusinessOwnersLiabilityClassGroup \r\n\t-- OR lkp_ISOOccupancyType != i_ISOOccupancyType\r\n\t-- OR lkp_BuildingBCCCode != lkp_sup_StandardBusinessClassCode\r\n\t-- OR lkp_BuildingClassCodeDescription != lkp_sup_StandardBusinessClassCodeDescription\r\n\t-- ,'UPDATE',\r\n\t-- 'NOCHANGE'\r\n\t-- )\n\tDECODE(TRUE,\n\tlkp_PremiumTransactionID IS NULL, 'NEW',\n\tv_lkp_CoverageGuid != i_CoverageGUID OR lkp_ISOBusinessOwnersPropertyRateNumber != i_ISOBusinessOwnersPropertyRateNumber OR lkp_ISOBusinessOwnersLiabilityClassGroup != i_ISOBusinessOwnersLiabilityClassGroup OR lkp_ISOOccupancyType != i_ISOOccupancyType OR lkp_BuildingBCCCode != lkp_sup_StandardBusinessClassCode OR lkp_BuildingClassCodeDescription != lkp_sup_StandardBusinessClassCodeDescription, 'UPDATE',\n\t'NOCHANGE') AS o_ChangeFlag\n\tFROM EXP_Metadata\n\tLEFT JOIN LKP_CoverageDetailBusinessOwners\n\tON LKP_CoverageDetailBusinessOwners.PremiumTransactionID = EXP_Metadata.o_PremiumTransactionID\n\tLEFT JOIN LKP_Sup_Bus_Class_Code\n\tON LKP_Sup_Bus_Class_Code.bus_class_code = EXP_Metadata.o_PredominantBuildingBCCCode_padded\n),\nRTR_INSERT_UPDATE AS (\n\tSELECT\n\to_PremiumTransactionID AS PremiumTransactionID,\n\to_CurrentSnapshotFlag AS CurrentSnapshotFlag,\n\to_AuditID AS AuditID,\n\to_EffectiveDate AS EffectiveDate,\n\to_ExpirationDate AS ExpirationDate,\n\to_SourceSystemID AS SourceSystemID,\n\to_CreatedDate AS CreatedDate,\n\to_ModifiedDate AS ModifiedDate,\n\to_CoverageGUID AS CoverageGuid,\n\to_ISOBusinessOwnersPropertyRateNumber AS ISOBusinessOwnersPropertyRateNumber,\n\to_ISOBusinessOwnersLiabilityClassGroup AS ISOBusinessOwnersLiabilityClassGroup,\n\to_ISOOccupancyType AS ISOOccupancyType,\n\to_StandardBusinessClassCode AS StandardBusinessClassCode,\n\to_StandardBusinessClassCodeDescription AS StandardBusinessClassCodeDescription,\n\to_ChangeFlag AS ChangeFlag\n\tFROM EXP_Metadata1\n),\nRTR_INSERT_UPDATE_INSERT AS (SELECT * FROM RTR_INSERT_UPDATE WHERE ChangeFlag='NEW'),\nTGT_CoverageDetailBusinessOwners_Insert AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailBusinessOwners\n\t(PremiumTransactionID, CurrentSnapshotFlag, AuditID, EffectiveDate, ExpirationDate, SourceSystemID, CreatedDate, ModifiedDate, CoverageGuid, ISOBusinessOwnersPropertyRateNumber, ISOBusinessOwnersLiabilityClassGroup, ISOOccupancyType, BuildingBCCCode, BuildingClassCodeDescription)\n\tSELECT \n\tPREMIUMTRANSACTIONID, \n\tCURRENTSNAPSHOTFLAG, \n\tAUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tSOURCESYSTEMID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tCOVERAGEGUID, \n\tISOBUSINESSOWNERSPROPERTYRATENUMBER, \n\tISOBUSINESSOWNERSLIABILITYCLASSGROUP, \n\tISOOCCUPANCYTYPE, \n\tStandardBusinessClassCode AS BUILDINGBCCCODE, \n\tStandardBusinessClassCodeDescription AS BUILDINGCLASSCODEDESCRIPTION\n\tFROM RTR_INSERT_UPDATE_INSERT\n),\nSQ_CoverageDetailBusinessOwners AS (\n\tSELECT\r\n\tCDBOPrevious.ISOBusinessOwnersPropertyRateNumber,  \r\n\tCDBOPrevious.ISOBusinessOwnersLiabilityClassGroup, \r\n\tCDBOPrevious.ISOOccupancyType, \r\n\tWPTOL.PremiumTransactionID AS Wrk_PremiumTransactionID,\r\n\tCDBOPrevious.BuildingBCCCode AS BuildingBCCCode,\r\n\tCDBOPrevious.BuildingClassCodeDescription AS BuildingClassCodeDescription\r\n\tFROM\r\n\tWorkPremiumTransactionOffsetLineage WPTOL \r\n\tinner join CoverageDetailBusinessOwners CDBOPrevious on ( CDBOPrevious.PremiumTransactionID= WPTOL.previouspremiumtransactionid)\r\n\tinner join CoverageDetailBusinessOwners CDBOToUpdate on ( CDBOToUpdate.PremiumTransactionID= WPTOL.PremiumTransactionid)\r\n\tINNER JOIN premiumtransaction pt WITH (NOLOCK) on\r\n\tWPTOL .premiumtransactionID=pt.premiumtransactionID and PT.OffsetOnsetCode='Offset'\r\n\tWHERE\r\n\tWPTOL.UpdateAttributeFlag = 1 \r\n\tAND (\r\n\tCDBOPrevious.ISOBusinessOwnersLiabilityClassGroup <> CDBOToUpdate.ISOBusinessOwnersLiabilityClassGroup\r\n\t  OR CDBOPrevious.ISOBusinessOwnersPropertyRateNumber <> CDBOToUpdate.ISOBusinessOwnersPropertyRateNumber\r\n\t  OR CDBOPrevious.ISOOccupancyType <> CDBOToUpdate.ISOOccupancyType\r\n\t  OR CDBOPrevious.BuildingBCCCode <>  CDBOToUpdate.BuildingBCCCode\r\n\t  OR CDBOPrevious.BuildingClassCodeDescription <> CDBOToUpdate.BuildingClassCodeDescription\r\n\t  )\n),\nEXP_Coveragedetailbussinessowners AS (\n\tSELECT\n\tISOBusinessOwnersPropertyRateNumber,\n\tISOBusinessOwnersLiabilityClassGroup,\n\tISOOccupancyType,\n\twrk_PremiumTransactionID,\n\tSYSDATE AS o_ModifiedDate,\n\tBuildingBCCCode,\n\tBuildingClassCodeDescription\n\tFROM SQ_CoverageDetailBusinessOwners\n),\nUPD_Coveragedetailbussinessowners AS (\n\tSELECT\n\tISOBusinessOwnersPropertyRateNumber, \n\tISOBusinessOwnersLiabilityClassGroup, \n\tISOOccupancyType, \n\twrk_PremiumTransactionID, \n\to_ModifiedDate AS ModifiedDate, \n\tBuildingBCCCode, \n\tBuildingClassCodeDescription\n\tFROM EXP_Coveragedetailbussinessowners\n),\nTGT_CoverageDetailBusinessOwners_Offsets AS (\n\tMERGE INTO CoverageDetailBusinessOwners AS T\n\tUSING UPD_Coveragedetailbussinessowners AS S\n\tON T.PremiumTransactionID = S.wrk_PremiumTransactionID\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.ModifiedDate = S.ModifiedDate, T.ISOBusinessOwnersPropertyRateNumber = S.ISOBusinessOwnersPropertyRateNumber, T.ISOBusinessOwnersLiabilityClassGroup = S.ISOBusinessOwnersLiabilityClassGroup, T.ISOOccupancyType = S.ISOOccupancyType, T.BuildingBCCCode = S.BuildingBCCCode, T.BuildingClassCodeDescription = S.BuildingClassCodeDescription\n),\nSQ_CoverageDetailBusinessOwners_Deprecated AS (\n\tSELECT\r\n\tCDBOPrevious.ISOBusinessOwnersPropertyRateNumber,  \r\n\tCDBOPrevious.ISOBusinessOwnersLiabilityClassGroup, \r\n\tCDBOPrevious.ISOOccupancyType, \r\n\tWPTOL.PremiumTransactionID AS Wrk_PremiumTransactionID,\r\n\tCDBOPrevious.BuildingBCCCode AS BuildingBCCCode,\r\n\tCDBOPrevious.BuildingClassCodeDescription AS BuildingClassCodeDescription\r\n\tFROM\r\n\tWorkPremiumTransactionOffsetLineage WPTOL \r\n\tinner join CoverageDetailBusinessOwners CDBOPrevious on ( CDBOPrevious.PremiumTransactionID= WPTOL.previouspremiumtransactionid)\r\n\tinner join CoverageDetailBusinessOwners CDBOToUpdate on ( CDBOToUpdate.PremiumTransactionID= WPTOL.PremiumTransactionid)\r\n\tINNER JOIN premiumtransaction pt WITH (NOLOCK) on\r\n\tWPTOL .premiumtransactionID=pt.premiumtransactionID and PT.OffsetOnsetCode='Deprecated'\r\n\tWHERE\r\n\tWPTOL.UpdateAttributeFlag = 1 \r\n\tAND (\r\n\tCDBOPrevious.ISOBusinessOwnersLiabilityClassGroup <> CDBOToUpdate.ISOBusinessOwnersLiabilityClassGroup\r\n\t  OR CDBOPrevious.ISOBusinessOwnersPropertyRateNumber <> CDBOToUpdate.ISOBusinessOwnersPropertyRateNumber\r\n\t  OR CDBOPrevious.ISOOccupancyType <> CDBOToUpdate.ISOOccupancyType\r\n\t  OR CDBOPrevious.BuildingBCCCode <>  CDBOToUpdate.BuildingBCCCode\r\n\t  OR CDBOPrevious.BuildingClassCodeDescription <> CDBOToUpdate.BuildingClassCodeDescription\r\n\t  )\n),\nEXP_Coveragedetailbussinessowners_Deprecated AS (\n\tSELECT\n\tISOBusinessOwnersPropertyRateNumber,\n\tISOBusinessOwnersLiabilityClassGroup,\n\tISOOccupancyType,\n\twrk_PremiumTransactionID,\n\tSYSDATE AS o_ModifiedDate,\n\tBuildingBCCCode,\n\tBuildingClassCodeDescription\n\tFROM SQ_CoverageDetailBusinessOwners_Deprecated\n),\nUPD_Coveragedetailbussinessowners_Deprecated AS (\n\tSELECT\n\tISOBusinessOwnersPropertyRateNumber, \n\tISOBusinessOwnersLiabilityClassGroup, \n\tISOOccupancyType, \n\twrk_PremiumTransactionID, \n\to_ModifiedDate AS ModifiedDate, \n\tBuildingBCCCode, \n\tBuildingClassCodeDescription\n\tFROM EXP_Coveragedetailbussinessowners_Deprecated\n),\nTGT_CoverageDetailBusinessOwners_Deprecated AS (\n\tMERGE INTO CoverageDetailBusinessOwners AS T\n\tUSING UPD_Coveragedetailbussinessowners_Deprecated AS S\n\tON T.PremiumTransactionID = S.wrk_PremiumTransactionID\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.ModifiedDate = S.ModifiedDate, T.ISOBusinessOwnersPropertyRateNumber = S.ISOBusinessOwnersPropertyRateNumber, T.ISOBusinessOwnersLiabilityClassGroup = S.ISOBusinessOwnersLiabilityClassGroup, T.ISOOccupancyType = S.ISOOccupancyType, T.BuildingBCCCode = S.BuildingBCCCode, T.BuildingClassCodeDescription = S.BuildingClassCodeDescription\n),"
                        }
                    ]
                }
            }
        ],
        "parameters": {
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "Policy DataWarehouse/"
        },
        "annotations": []
    }
}