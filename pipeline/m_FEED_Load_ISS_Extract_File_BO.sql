WITH
SQ_ISSBusinessOwnersExtract AS (
	SELECT
		ISSBusinessOwnersExtractId,
		AuditId,
		CreatedDate,
		EDWPremiumMasterCalculationPKId,
		EDWLossMasterCalculationPKId,
		TypeBureauCode,
		BureauLineOfInsurance,
		BureauCompanyNumber,
		StateProvinceCode,
		PremiumMasterRunDate,
		LossMasterRunDate,
		PolicyKey,
		PremiumMasterClassCode,
		LossMasterClassCode,
		ClaimNumber,
		ClaimantNumber,
		RiskTerritoryCode,
		PolicyEffectiveDate,
		CauseOfLoss,
		CoverageCode,
		ISOFireProtectionCode,
		TypeOfPolicyForm,
		PremiumMasterDirectWrittenPremiumAmount,
		PaidLossAmount,
		OutstandingLossAmount,
		PolicyExpirationDate,
		InceptionToDatePaidLossAmount,
		ClaimantCoverageDetailId,
		AnnualStatementLineNumber,
		PolicyLimit,
		ExposureBasis,
		ConstructionCode,
		SprinklerFlag,
		LimitOfInsurance,
		WrittenExposure,
		PaidAllocatedLossAdjustmentExpenseAmount,
		OutstandingAllocatedLossAdjustmentExpenseAmount,
		ClaimLossDate,
		ZipPostalCode,
		TransactionEffectiveDate,
		BusinessClassificationCode
	FROM ISSBusinessOwnersExtract
	WHERE @{pipeline().parameters.WHERE_CLAUSE}
),
EXP_Set_FileName AS (
	SELECT
	-- *INF*: TRUNC(SYSDATE,'DD')
	CAST(TRUNC(CURRENT_TIMESTAMP, 'DAY') AS TIMESTAMP_NTZ(0)) AS v_RunDate,
	-- *INF*: 'ISS_BO_CL_'||TO_CHAR(v_RunDate,'YYYYMMDD')||'.CSV'
	'ISS_BO_CL_' || TO_CHAR(v_RunDate, 'YYYYMMDD') || '.CSV' AS FileName,
	ISSBusinessOwnersExtractId AS WorkISSExtractId,
	AuditId,
	CreatedDate,
	EDWPremiumMasterCalculationPKId,
	EDWLossMasterCalculationPKId,
	TypeBureauCode,
	BureauLineOfInsurance,
	BureauCompanyNumber,
	StateProvinceCode,
	PremiumMasterRunDate,
	LossMasterRunDate,
	PolicyKey,
	PremiumMasterClassCode,
	LossMasterClassCode,
	ClaimNumber,
	ClaimantNumber,
	RiskTerritoryCode,
	PolicyEffectiveDate,
	CauseOfLoss,
	CoverageCode,
	ISOFireProtectionCode,
	TypeOfPolicyForm,
	PremiumMasterDirectWrittenPremiumAmount,
	PaidLossAmount,
	OutstandingLossAmount,
	PolicyExpirationDate,
	InceptionToDatePaidLossAmount,
	ClaimantCoverageDetailId,
	AnnualStatementLineNumber,
	PolicyLimit,
	ExposureBasis,
	ConstructionCode,
	SprinklerFlag,
	LimitOfInsurance,
	WrittenExposure,
	PaidAllocatedLossAdjustmentExpenseAmount,
	OutstandingAllocatedLossAdjustmentExpenseAmount,
	ClaimLossDate,
	ZipPostalCode,
	TransactionEffectiveDate,
	BusinessClassificationCode
	FROM SQ_ISSBusinessOwnersExtract
),
SRT_ISS_FlatFile_BO AS (
	SELECT
	FileName, 
	WorkISSExtractId, 
	AuditId, 
	CreatedDate, 
	EDWPremiumMasterCalculationPKId, 
	EDWLossMasterCalculationPKId, 
	TypeBureauCode, 
	BureauLineOfInsurance, 
	BureauCompanyNumber, 
	StateProvinceCode, 
	PremiumMasterRunDate, 
	LossMasterRunDate, 
	PolicyKey, 
	PremiumMasterClassCode, 
	LossMasterClassCode, 
	ClaimNumber, 
	ClaimantNumber, 
	RiskTerritoryCode, 
	PolicyEffectiveDate, 
	CauseOfLoss, 
	CoverageCode, 
	ISOFireProtectionCode, 
	TypeOfPolicyForm, 
	PremiumMasterDirectWrittenPremiumAmount, 
	PaidLossAmount, 
	OutstandingLossAmount, 
	PolicyExpirationDate, 
	InceptionToDatePaidLossAmount, 
	ClaimantCoverageDetailId, 
	AnnualStatementLineNumber, 
	PolicyLimit, 
	ExposureBasis, 
	ConstructionCode, 
	SprinklerFlag, 
	LimitOfInsurance, 
	WrittenExposure, 
	PaidAllocatedLossAdjustmentExpenseAmount, 
	OutstandingAllocatedLossAdjustmentExpenseAmount, 
	ClaimLossDate, 
	ZipPostalCode, 
	TransactionEffectiveDate, 
	BusinessClassificationCode
	FROM EXP_Set_FileName
	ORDER BY PolicyKey ASC, PremiumMasterClassCode ASC, CoverageCode ASC, AnnualStatementLineNumber ASC, ZipPostalCode ASC
),
ISSFlatFile_BO AS (
	INSERT INTO ISSFlatFile_BO
	(FileName, WorkISSExtractId, AuditId, CreatedDate, EDWPremiumMasterCalculationPKId, EDWLossMasterCalculationPKId, TypeBureauCode, BureauLineOfInsurance, BureauCompanyNumber, StateProvinceCode, PremiumMasterRunDate, LossMasterRunDate, PolicyKey, PremiumMasterClassCode, LossMasterClassCode, ClaimNumber, ClaimantNumber, RiskTerritoryCode, PolicyEffectiveDate, CauseOfLoss, CoverageCode, ISOFireProtectionCode, TypeOfPolicyForm, PremiumMasterDirectWrittenPremiumAmount, PaidLossAmount, OutstandingLossAmount, PolicyExpirationDate, InceptionToDatePaidLossAmount, ClaimantCoverageDetailId, AnnualStatementLineNumber, PolicyLimit, ExposureBasis, ConstructionCode, SprinklerFlag, LimitOfInsurance, WrittenExposure, PaidAllocatedLossAdjustmentExpenseAmount, OutstandingAllocatedLossAdjustmentExpenseAmount, ClaimLossDate, ZipPostalCode, TransactionEffectiveDate, BusinessClassificationCode)
	SELECT 
	FILENAME, 
	WORKISSEXTRACTID, 
	AUDITID, 
	CREATEDDATE, 
	EDWPREMIUMMASTERCALCULATIONPKID, 
	EDWLOSSMASTERCALCULATIONPKID, 
	TYPEBUREAUCODE, 
	BUREAULINEOFINSURANCE, 
	BUREAUCOMPANYNUMBER, 
	STATEPROVINCECODE, 
	PREMIUMMASTERRUNDATE, 
	LOSSMASTERRUNDATE, 
	POLICYKEY, 
	PREMIUMMASTERCLASSCODE, 
	LOSSMASTERCLASSCODE, 
	CLAIMNUMBER, 
	CLAIMANTNUMBER, 
	RISKTERRITORYCODE, 
	POLICYEFFECTIVEDATE, 
	CAUSEOFLOSS, 
	COVERAGECODE, 
	ISOFIREPROTECTIONCODE, 
	TYPEOFPOLICYFORM, 
	PREMIUMMASTERDIRECTWRITTENPREMIUMAMOUNT, 
	PAIDLOSSAMOUNT, 
	OUTSTANDINGLOSSAMOUNT, 
	POLICYEXPIRATIONDATE, 
	INCEPTIONTODATEPAIDLOSSAMOUNT, 
	CLAIMANTCOVERAGEDETAILID, 
	ANNUALSTATEMENTLINENUMBER, 
	POLICYLIMIT, 
	EXPOSUREBASIS, 
	CONSTRUCTIONCODE, 
	SPRINKLERFLAG, 
	LIMITOFINSURANCE, 
	WRITTENEXPOSURE, 
	PAIDALLOCATEDLOSSADJUSTMENTEXPENSEAMOUNT, 
	OUTSTANDINGALLOCATEDLOSSADJUSTMENTEXPENSEAMOUNT, 
	CLAIMLOSSDATE, 
	ZIPPOSTALCODE, 
	TRANSACTIONEFFECTIVEDATE, 
	BUSINESSCLASSIFICATIONCODE
	FROM SRT_ISS_FlatFile_BO
),