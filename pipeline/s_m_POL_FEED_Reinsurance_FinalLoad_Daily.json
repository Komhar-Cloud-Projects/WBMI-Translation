{
    "name": "s_m_POL_FEED_Reinsurance_FinalLoad_Daily",
    "properties": {
        "activities": [
            {
                "name": "m_POL_FEED_Reinsurance_FinalLoad_Daily",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_SapiensReinsurancePolicy AS (\n\tSELECT\n\t\tSapiensReinsurancePolicyId,\n\t\tAuditId,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tPolicyKey,\n\t\tDocumntType,\n\t\tAccountingDate,\n\t\tMonthlyTotalDirectWrittenPremium,\n\t\tProductCode,\n\t\tStrategicProfitCenterAbbreviation,\n\t\tAccountingProductCode,\n\t\tInsuranceReferenceLineOfBusinessCode,\n\t\tASLCode,\n\t\tSubASLCode,\n\t\tPrimaryStateCode,\n\t\tCoverageEffectiveDate,\n\t\tCoverageExpirationDate,\n\t\tEndorsementStartDate,\n\t\tEndorsementIssueDate,\n\t\tPolicyIssueDate,\n\t\tSourceSequenceNumber,\n\t\tTransactionNumber,\n\t\tEndorsementNumber,\n\t\tASLCoversKey,\n\t\tDateKey,\n\t\tPremiumMasterCalculationPKId,\n\t\tReinsuranceUmbrellaLayer,\n\t\tOSECode,\n\t\tPremiumTransactionPKID,\n\t\tEntryProcess,\n\t\tRatingPlanAbbreviation,\n\t\tFirstNameIsured\n\tFROM SapiensReinsurancePolicy\n\tWHERE SapiensReinsurancePolicy.DocumntType='P'\r\n\t@{pipeline().parameters.WHERE}\n),\nEXP_SRC_DataCollect AS (\n\tSELECT\n\tPolicyKey AS pol_key,\n\tDocumntType,\n\tAccountingDate AS Accounting_Date,\n\tMonthlyTotalDirectWrittenPremium,\n\tProductCode,\n\tStrategicProfitCenterAbbreviation,\n\tAccountingProductCode,\n\tInsuranceReferenceLineOfBusinessCode,\n\tASLCode AS asl_code,\n\tSubASLCode AS sub_asl_code,\n\tPrimaryStateCode AS state_of_domicile_code,\n\tCoverageEffectiveDate,\n\tCoverageExpirationDate,\n\tEndorsementStartDate AS Endorsement_Start_Date,\n\tEndorsementIssueDate AS Endorsement_Issue_Date,\n\tPolicyIssueDate AS Policy_Issue_Date,\n\tSourceSequenceNumber AS Source_Seq_Num,\n\tTransactionNumber AS Tran_No,\n\tEndorsementNumber AS Endorsement_No,\n\tASLCoversKey,\n\tDateKey,\n\tReinsuranceUmbrellaLayer AS ReinsuranceUmbrellalayer,\n\tOSECode AS OSE_Flag,\n\tRatingPlanAbbreviation,\n\tFirstNameIsured,\n\tEntryProcess\n\tFROM SQ_SapiensReinsurancePolicy\n),\nAGG_Data_DuplicateEliminate AS (\n\tSELECT\n\tpol_key,\n\tDocumntType,\n\tAccounting_Date,\n\tMonthlyTotalDirectWrittenPremium,\n\t-- *INF*: SUM(MonthlyTotalDirectWrittenPremium)\n\tSUM(MonthlyTotalDirectWrittenPremium) AS O_MonthlyTotalDirectWrittenPremium,\n\tProductCode,\n\tStrategicProfitCenterAbbreviation,\n\tAccountingProductCode,\n\tInsuranceReferenceLineOfBusinessCode,\n\tasl_code,\n\tsub_asl_code,\n\tstate_of_domicile_code,\n\tCoverageEffectiveDate,\n\tCoverageExpirationDate,\n\tEndorsement_Start_Date,\n\tEndorsement_Issue_Date,\n\tPolicy_Issue_Date,\n\tSource_Seq_Num,\n\tTran_No,\n\tEndorsement_No,\n\tReinsuranceUmbrellalayer,\n\tOSE_Flag,\n\t-- *INF*: MAX(OSE_Flag)\n\tMAX(OSE_Flag) AS O_OSE_Flag,\n\tRatingPlanAbbreviation,\n\tFirstNameIsured,\n\tEntryProcess\n\tFROM EXP_SRC_DataCollect\n\tGROUP BY pol_key, DocumntType, Accounting_Date, ProductCode, StrategicProfitCenterAbbreviation, AccountingProductCode, InsuranceReferenceLineOfBusinessCode, asl_code, sub_asl_code, state_of_domicile_code, CoverageEffectiveDate, CoverageExpirationDate, Endorsement_Start_Date, Endorsement_Issue_Date, Policy_Issue_Date, Source_Seq_Num, Tran_No, Endorsement_No, ReinsuranceUmbrellalayer\n),\nEXP_Pol_Header AS (\n\tSELECT\n\tSource_Seq_Num AS Header_Source_Seq_Num,\n\t'SRP' AS Data_Source,\n\t'WBMI' AS Company_Code,\n\tpol_key,\n\t'' AS Object_ID,\n\tEndorsement_No AS Header_Endorsement_No,\n\tTran_No AS Header_Trans_No,\n\tDocumntType AS Header_Document_Type,\n\t'' AS Claim_Id,\n\t'' AS Sub_Claim_Id,\n\t'' AS Is_Borderaeu,\n\t'CED' AS Business_Ind,\n\tO_OSE_Flag AS Exception_Ind,\n\t-- *INF*: IIF(ISNULL(@{pipeline().parameters.NUMBEROFPOLICYQUEUES}) or @{pipeline().parameters.NUMBEROFPOLICYQUEUES}=0,\r\n\t-- 1,\r\n\t-- MOD(TO_INTEGER(REVERSE(SUBSTR(REVERSE(pol_key),3,2))), @{pipeline().parameters.NUMBEROFPOLICYQUEUES}) + 1\r\n\t-- )\n\tIFF(\n\t    @{pipeline().parameters.NUMBEROFPOLICYQUEUES} IS NULL or @{pipeline().parameters.NUMBEROFPOLICYQUEUES} = 0, 1,\n\t    MOD(CAST(REVERSE(SUBSTR(REVERSE(pol_key), 3, 2)) AS INTEGER), @{pipeline().parameters.NUMBEROFPOLICYQUEUES}) + 1\n\t) AS Queue_No,\n\t'P&C' AS Business_Deprtmt,\n\t'' AS XOL_Allocation,\n\t'' AS Assumed_Company,\n\t'1' AS Subsystem_Id,\n\tAccounting_Date,\n\t-- *INF*: TO_INTEGER(TO_CHAR(Accounting_Date,'YYYYMM'))\n\tCAST(TO_CHAR(Accounting_Date, 'YYYYMM') AS INTEGER) AS AccountingMonth,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditId,\n\tSYSDATE AS CurrentDateTime\n\tFROM AGG_Data_DuplicateEliminate\n),\nSapiensReinsuranceHeaderExtract AS (\n\tTRUNCATE TABLE SapiensReinsuranceHeaderExtract;\n\tINSERT INTO SapiensReinsuranceHeaderExtract\n\t(SOURCE_SEQ_NUM, DATA_SOURCE, COMPANY_CODE, POLICY_NO, OBJECT_ID, ENDORSEMENT_NO, TRAN_NO, DOCUMENT_TYPE, CLAIM_ID, SUB_CLAIM_ID, IS_BORDERAEU, BUSINESS_IND, EXCEPTION_IND, QUEUE_NO, BUSINESS_DEPRTMT, XOL_ALLOCATION, ASSUMED_COMPANY, ACCOUNTING_MONTH, SUBSYSTEM_ID, AuditId, CreatedDate, ModifiedDate)\n\tSELECT \n\tHeader_Source_Seq_Num AS SOURCE_SEQ_NUM, \n\tData_Source AS DATA_SOURCE, \n\tCompany_Code AS COMPANY_CODE, \n\tpol_key AS POLICY_NO, \n\tObject_ID AS OBJECT_ID, \n\tHeader_Endorsement_No AS ENDORSEMENT_NO, \n\tHeader_Trans_No AS TRAN_NO, \n\tHeader_Document_Type AS DOCUMENT_TYPE, \n\tClaim_Id AS CLAIM_ID, \n\tSub_Claim_Id AS SUB_CLAIM_ID, \n\tIs_Borderaeu AS IS_BORDERAEU, \n\tBusiness_Ind AS BUSINESS_IND, \n\tException_Ind AS EXCEPTION_IND, \n\tQueue_No AS QUEUE_NO, \n\tBusiness_Deprtmt AS BUSINESS_DEPRTMT, \n\tXOL_Allocation AS XOL_ALLOCATION, \n\tAssumed_Company AS ASSUMED_COMPANY, \n\tAccountingMonth AS ACCOUNTING_MONTH, \n\tSubsystem_Id AS SUBSYSTEM_ID, \n\tAUDITID, \n\tCurrentDateTime AS CREATEDDATE, \n\tCurrentDateTime AS MODIFIEDDATE\n\tFROM EXP_Pol_Header\n),\nSRT_Dates AS (\n\tSELECT\n\tSource_Seq_Num, \n\tCoverageEffectiveDate AS Policy_Start_date, \n\tCoverageExpirationDate AS Policy_End_Date, \n\tPolicy_Issue_Date, \n\tEndorsement_Start_Date, \n\tEndorsement_Issue_Date, \n\tAccounting_Date\n\tFROM AGG_Data_DuplicateEliminate\n\tORDER BY Source_Seq_Num ASC, Policy_Start_date ASC, Policy_End_Date ASC, Policy_Issue_Date ASC, Endorsement_Start_Date ASC, Endorsement_Issue_Date ASC, Accounting_Date ASC\n),\nEXP_Pol_Dates AS (\n\tSELECT\n\tSource_Seq_Num AS Header_Source_Seq_Num,\n\t'PLS' AS pol_eff_date_code,\n\tPolicy_Start_date AS pol_eff_date_value,\n\t-- *INF*: TO_CHAR(pol_eff_date_value,'YYYYMMDD')\n\tTO_CHAR(pol_eff_date_value, 'YYYYMMDD') AS O_pol_eff_date_value,\n\t'PLE' AS pol_exp_date_code,\n\tPolicy_End_Date AS pol_exp_date_value,\n\t-- *INF*: TO_CHAR(pol_exp_date_value,'YYYYMMDD')\n\tTO_CHAR(pol_exp_date_value, 'YYYYMMDD') AS O_pol_exp_date_value,\n\t'PIS' AS pol_incp_date_code,\n\tPolicy_Issue_Date AS orig_incptn_date_value,\n\t-- *INF*: TO_CHAR(orig_incptn_date_value,'YYYYMMDD')\n\tTO_CHAR(orig_incptn_date_value, 'YYYYMMDD') AS O_orig_incptn_date_value,\n\t'ENS' AS endorsement_start_date_code,\n\tEndorsement_Start_Date AS endorsement_start_date_value,\n\t-- *INF*: TO_CHAR(endorsement_start_date_value,'YYYYMMDD')\n\tTO_CHAR(endorsement_start_date_value, 'YYYYMMDD') AS O_endorsement_start_date_value,\n\t'EIS' AS endorsement_end_date_code,\n\tEndorsement_Issue_Date AS endorsement_end_date_value,\n\t-- *INF*: TO_CHAR(endorsement_end_date_value,'YYYYMMDD')\n\tTO_CHAR(endorsement_end_date_value, 'YYYYMMDD') AS O_endorsement_end_date_value,\n\t'PRC' AS Process_Date,\n\tAccounting_Date,\n\t-- *INF*: TO_CHAR(Accounting_Date,'YYYYMMDD')\n\tTO_CHAR(Accounting_Date, 'YYYYMMDD') AS O_ProcessDate\n\tFROM SRT_Dates\n),\nNRM_Pol_Dates AS (\n),\nAGG_Eliminate_DateDuplicates AS (\n\tSELECT\n\tHeader_Source_Seq_Num,\n\tDate_Code,\n\tDate_Value\n\tFROM NRM_Pol_Dates\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY Header_Source_Seq_Num, Date_Code, Date_Value ORDER BY NULL) = 1\n),\nEXP_Pol_Dates_Tgt_DataCollect AS (\n\tSELECT\n\tHeader_Source_Seq_Num,\n\tDate_Code,\n\tDate_Value,\n\t-- *INF*: to_date(Date_Value,'YYYYMMDD')\n\tTO_TIMESTAMP(Date_Value, 'YYYYMMDD') AS out_Date_Value,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditId,\n\tSYSDATE AS CurrentDateTime\n\tFROM AGG_Eliminate_DateDuplicates\n),\nSapiensReinsuranceDatesExtract AS (\n\tTRUNCATE TABLE SapiensReinsuranceDatesExtract;\n\tINSERT INTO SapiensReinsuranceDatesExtract\n\t(SOURCE_SEQ_NUM, DATE_CODE, DATE_VALUE, AuditId, CreatedDate, ModifiedDate)\n\tSELECT \n\tHeader_Source_Seq_Num AS SOURCE_SEQ_NUM, \n\tDate_Code AS DATE_CODE, \n\tout_Date_Value AS DATE_VALUE, \n\tAUDITID, \n\tCurrentDateTime AS CREATEDDATE, \n\tCurrentDateTime AS MODIFIEDDATE\n\tFROM EXP_Pol_Dates_Tgt_DataCollect\n),\nEXP_Pol_Attributes AS (\n\tSELECT\n\tSource_Seq_Num AS Header_Source_Seq_Num,\n\t'LOB' AS out_LOB_Code,\n\tInsuranceReferenceLineOfBusinessCode AS LOB_Value,\n\t'PDT' AS out_ProductCode_Code,\n\tProductCode AS ProductCode_Value,\n\t'ASL' AS out_asl_code_Code,\n\tasl_code AS asl_code_Value,\n\t'SAS' AS out_sub_asl_code_Code,\n\tsub_asl_code AS sub_asl_code_Value,\n\t'PCN' AS out_StrategicProfitCenter_Code,\n\tStrategicProfitCenterAbbreviation AS StrategicProfitCenter_Value,\n\t-- *INF*: REPLACECHR(false,StrategicProfitCenter_Value, ' ', '')\n\tREGEXP_REPLACE(StrategicProfitCenter_Value,' ','') AS out_StrategicProfitCenter_Value,\n\t'RKS' AS out_RiskState_Code,\n\tstate_of_domicile_code AS RiskState_Value,\n\t-- *INF*: substr(RiskState_Value, 1, 50)\n\tsubstr(RiskState_Value, 1, 50) AS out_RiskState_Value,\n\t'COM' AS out_Company_Code,\n\t'WBMI' AS Company_Value,\n\t0 AS Out_Obj_Val_Seq_no,\n\t'SNA' AS O_UmbrellaLayerCode,\n\tReinsuranceUmbrellalayer,\n\t-- *INF*: TO_CHAR(ReinsuranceUmbrellalayer)\n\tTO_CHAR(ReinsuranceUmbrellalayer) AS O_ReinsuranceUmbrellalayer,\n\t'ACP' AS O_AccountingProductCode,\n\tAccountingProductCode,\n\t'ZRP' AS O_RatingPlanCode,\n\tRatingPlanAbbreviation,\n\t'INM' AS O_FirstNameIsuredCode,\n\tFirstNameIsured,\n\t'HIS' AS HIS_CODE,\n\t@{pipeline().parameters.HISVALUE} AS HIS_VALUE,\n\tEntryProcess,\n\t'ZRS' AS EntryCode,\n\t'POLICY-'||EntryProcess AS EntryValue,\n\tAccounting_Date\n\tFROM AGG_Data_DuplicateEliminate\n),\nNRM_Pol_Attributes AS (\n),\nFIL_Pol_Attributes AS (\n\tSELECT\n\tHeader_Source_Seq_Num, \n\tAttr_Code, \n\tAttr_Value, \n\tObj_Val_Seq_no\n\tFROM NRM_Pol_Attributes\n\tWHERE IIF(Attr_Code<>'SNA',\r\n\tIIF(Attr_Code<>'HIS',\r\n\t\t1,\r\n\t\tIIF(Attr_Value<>'NOACC',\r\n\t\t\t0,\r\n\t\t\t1)\r\n\t\t),\r\n\tIIF(Attr_Value='0',\r\n\t\t0,\r\n\t\t1)\r\n\t)\r\nAND NOT ISNULL(Attr_Value)\r\n\r\n--IIF(Attr_Code<>'SNA',IIF(Attr_Code<>'HIS',1,IIF(Attr_Value<>'NOACC',0,1)),IIF(Attr_Value='0',0,1))=1\r\n\r\n--IIF(Attr_Code<>'SNA',1,IIF(Attr_Value='0',0,1))=1\r\n\r\n--Attr_Code <> 'SAS' and Attr_Value <> 'N/A' OR (Attr_Code='SNA' and Attr_Value<>'0')\n),\nEXP_AddMetadata_Attributes AS (\n\tSELECT\n\tHeader_Source_Seq_Num,\n\tAttr_Code,\n\tAttr_Value,\n\tObj_Val_Seq_no,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditId,\n\tSYSDATE AS CurrentDateTime\n\tFROM FIL_Pol_Attributes\n),\nSapiensReinsuranceAttributesExtract AS (\n\tTRUNCATE TABLE SapiensReinsuranceAttributesExtract;\n\tINSERT INTO SapiensReinsuranceAttributesExtract\n\t(SOURCE_SEQ_NUM, ATTR_CODE, ATTR_VAL, OBJ_VAL_SEQ_NO, AuditId, CreatedDate, ModifiedDate)\n\tSELECT \n\tHeader_Source_Seq_Num AS SOURCE_SEQ_NUM, \n\tAttr_Code AS ATTR_CODE, \n\tAttr_Value AS ATTR_VAL, \n\tObj_Val_Seq_no AS OBJ_VAL_SEQ_NO, \n\tAUDITID, \n\tCurrentDateTime AS CREATEDDATE, \n\tCurrentDateTime AS MODIFIEDDATE\n\tFROM EXP_AddMetadata_Attributes\n),\nEXP_Pol_Accounting AS (\n\tSELECT\n\tSource_Seq_Num AS Header_Source_Seq_Num,\n\t'INS' AS Sum_Insured_Accounting_Item,\n\t1 AS Sum_Insured_Accounting_Amount,\n\t'USD' AS Sum_Insured_Currency_Code,\n\t'NPR' AS Incoming_Premium_Accounting_Item,\n\tO_MonthlyTotalDirectWrittenPremium AS Incoming_Premium_Accounting_Amount,\n\t'USD' AS Incomming_Premium_Currency_Code\n\tFROM AGG_Data_DuplicateEliminate\n),\nNRM_Pol_Accounting AS (\n),\nEXP_AddMetadata_AccountingItems AS (\n\tSELECT\n\tHeader_Source_Seq_Num,\n\tAccounting_Item,\n\tAccounting_Amount,\n\tCurrency_Code,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditId,\n\tSYSDATE AS CurrentDateTime\n\tFROM NRM_Pol_Accounting\n),\nSapiensReinsuranceAccountingItemsExtract AS (\n\tTRUNCATE TABLE SapiensReinsuranceAccountingItemsExtract;\n\tINSERT INTO SapiensReinsuranceAccountingItemsExtract\n\t(SOURCE_SEQ_NUM, ACCOUNTING_ITEM, ACOUNTING_AMOUNT, CURRENCY_CODE, AuditId, CreatedDate, ModifiedDate)\n\tSELECT \n\tHeader_Source_Seq_Num AS SOURCE_SEQ_NUM, \n\tAccounting_Item AS ACCOUNTING_ITEM, \n\tAccounting_Amount AS ACOUNTING_AMOUNT, \n\tCurrency_Code AS CURRENCY_CODE, \n\tAUDITID, \n\tCurrentDateTime AS CREATEDDATE, \n\tCurrentDateTime AS MODIFIEDDATE\n\tFROM EXP_AddMetadata_AccountingItems\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WHERE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "NUMBEROFPOLICYQUEUES": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "HISVALUE": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "DataFeed -Informatica/PolicyDataServices/"
        },
        "annotations": []
    }
}