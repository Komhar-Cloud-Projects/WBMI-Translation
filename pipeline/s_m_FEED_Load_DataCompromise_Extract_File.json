{
    "name": "s_m_FEED_Load_DataCompromise_Extract_File",
    "properties": {
        "activities": [
            {
                "name": "m_FEED_Load_DataCompromise_Extract_File",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_DataCompromisePolicyRecord AS (\n\tSELECT\n\t\tDataCompromisePolicyRecordId,\n\t\tAuditID,\n\t\tSourceSystemID,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tRunDate,\n\t\tCompany,\n\t\tProductCode,\n\t\tContractNumber,\n\t\tPolicyNumber,\n\t\tPolicyEffectiveDate,\n\t\tPolicyExpirationDate,\n\t\tNameOfInsured,\n\t\tMailingAddressStreetName,\n\t\tMailingAddressCity,\n\t\tMailingAddressState,\n\t\tMailingAddressZipCode,\n\t\tTotalPackageGrossPremium,\n\t\tTotalPropertyGrossPremium,\n\t\tGrossPremium,\n\t\tNetPremium,\n\t\tFirstPartyLimit,\n\t\tDeductibleAmount,\n\t\tOccupancyCode,\n\t\tPolicyTotalInsuredValue,\n\t\tPreviousPolicyNumber,\n\t\tAgencyCode,\n\t\tBranchCode,\n\t\tThirdPartyIndicator\n\tFROM DataCompromisePolicyRecord\n\tWHERE convert(date,DataCompromisePolicyRecord.PolicyEffectiveDate)<=@{pipeline().parameters.RUNDATE}\r\n\tAND \r\n\tconvert(date,DataCompromisePolicyRecord.PolicyExpirationDate)>=@{pipeline().parameters.RUNDATE}\n),\nEXP_PolicyRecords AS (\n\tSELECT\n\tCompany,\n\tProductCode,\n\tContractNumber,\n\tPolicyNumber,\n\tPolicyEffectiveDate,\n\t-- *INF*: TO_CHAR(PolicyEffectiveDate, 'YYYYMMDD')\n\tTO_CHAR(PolicyEffectiveDate, 'YYYYMMDD') AS PolicyEffectiveDateYYYYMMDD,\n\tPolicyExpirationDate,\n\t-- *INF*: TO_CHAR(PolicyExpirationDate, 'YYYYMMDD')\n\tTO_CHAR(PolicyExpirationDate, 'YYYYMMDD') AS PolicyExpirationDateYYYYMMDD,\n\tNameOfInsured,\n\tMailingAddressStreetName,\n\tMailingAddressCity,\n\tMailingAddressState,\n\tMailingAddressZipCode,\n\tTotalPackageGrossPremium,\n\tTotalPropertyGrossPremium,\n\tGrossPremium,\n\tNetPremium,\n\tFirstPartyLimit,\n\tDeductibleAmount,\n\tOccupancyCode,\n\tPolicyTotalInsuredValue,\n\tPreviousPolicyNumber,\n\tAgencyCode,\n\tBranchCode,\n\tThirdPartyIndicator\n\tFROM SQ_DataCompromisePolicyRecord\n),\nDataCompromisePolicyRecordFile AS (\n\tINSERT INTO DataCompromisePolicyRecordFile\n\t(Company, ProductCode, ContractNumber, PolicyNumber, CoverageEffectiveDate, CoverageExpirationDate, NameOfInsured, MailingAddressStreetName, MailingAddressCity, MailingAddressState, MailingAddressZipCode, TotalPackageGrossPremium, TotalPropertyGrossPremium, GrossPremium, NetPremium, FirstPartyLimit, DeductibleAmount, OccupancyCode, PolicyTotalInsuredValue, PreviousPolicyNumber, AgencyCode, BranchCode, ThirdPartyIndicator)\n\tSELECT \n\tCOMPANY, \n\tPRODUCTCODE, \n\tCONTRACTNUMBER, \n\tPOLICYNUMBER, \n\tPolicyEffectiveDateYYYYMMDD AS COVERAGEEFFECTIVEDATE, \n\tPolicyExpirationDateYYYYMMDD AS COVERAGEEXPIRATIONDATE, \n\tNAMEOFINSURED, \n\tMAILINGADDRESSSTREETNAME, \n\tMAILINGADDRESSCITY, \n\tMAILINGADDRESSSTATE, \n\tMAILINGADDRESSZIPCODE, \n\tTOTALPACKAGEGROSSPREMIUM, \n\tTOTALPROPERTYGROSSPREMIUM, \n\tGROSSPREMIUM, \n\tNETPREMIUM, \n\tFIRSTPARTYLIMIT, \n\tDEDUCTIBLEAMOUNT, \n\tOCCUPANCYCODE, \n\tPOLICYTOTALINSUREDVALUE, \n\tPREVIOUSPOLICYNUMBER, \n\tAGENCYCODE, \n\tBRANCHCODE, \n\tTHIRDPARTYINDICATOR\n\tFROM EXP_PolicyRecords\n),\nSQ_DataCompromisePolicyRecord1 AS (\n\tSELECT\n\t\tDataCompromisePolicyRecordId,\n\t\tAuditID,\n\t\tSourceSystemID,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tRunDate,\n\t\tCompany,\n\t\tProductCode,\n\t\tContractNumber,\n\t\tPolicyNumber,\n\t\tPolicyEffectiveDate,\n\t\tPolicyExpirationDate,\n\t\tNameOfInsured,\n\t\tMailingAddressStreetName,\n\t\tMailingAddressCity,\n\t\tMailingAddressState,\n\t\tMailingAddressZipCode,\n\t\tTotalPackageGrossPremium,\n\t\tTotalPropertyGrossPremium,\n\t\tGrossPremium,\n\t\tNetPremium,\n\t\tFirstPartyLimit,\n\t\tDeductibleAmount,\n\t\tOccupancyCode,\n\t\tPolicyTotalInsuredValue,\n\t\tPreviousPolicyNumber,\n\t\tAgencyCode,\n\t\tBranchCode,\n\t\tThirdPartyIndicator\n\tFROM DataCompromisePolicyRecord1\n\tWHERE convert(date,DataCompromisePolicyRecord.PolicyEffectiveDate)<=@{pipeline().parameters.RUNDATE}\r\n\tAND \r\n\tconvert(date,DataCompromisePolicyRecord.PolicyExpirationDate)>=@{pipeline().parameters.RUNDATE}\n),\nAGGTRANS AS (\n\tSELECT\n\tRunDate,\n\tCompany,\n\tProductCode,\n\t'CONTROL' AS CONTROL,\n\t-- *INF*: COUNT(1)\n\tCOUNT(1) AS RecordCount,\n\t-- *INF*: TO_CHAR(RunDate, 'YYYYMMDD')\n\tTO_CHAR(RunDate, 'YYYYMMDD') AS RunDateYYYYMMDD,\n\t'02.01' AS HardCodeString,\n\t'' AS HardCodeString2\n\tFROM SQ_DataCompromisePolicyRecord1\n\tGROUP BY \n),\nDataCompromisePolicyRecordControlFile AS (\n\tINSERT INTO DataCompromisePolicyRecordControlFile\n\t(Company, ProductCode, Control, RecordCount, RunDateYYYYMMDD, HardCodeString, HardCodeString2)\n\tSELECT \n\tCOMPANY, \n\tPRODUCTCODE, \n\tCONTROL AS CONTROL, \n\tRECORDCOUNT, \n\tRUNDATEYYYYMMDD, \n\tHARDCODESTRING, \n\tHARDCODESTRING2\n\tFROM AGGTRANS\n),\nSQ_DataCompromisePaymentBordereauxRecord AS (\n\tSELECT\n\t\tDataCompromisePaymentBordereauxRecordId,\n\t\tAuditID,\n\t\tSourceSystemID,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tPremiumMasterCalculationID,\n\t\tRunDate,\n\t\tProductCode,\n\t\tCompany,\n\t\tPolicyNumber,\n\t\tTransactionCode,\n\t\tTransactionEffectiveDate,\n\t\tCoverageEffectiveDate,\n\t\tCoverageExpirationDate,\n\t\tCoverageGrossPremium,\n\t\tCoverageNetPremium,\n\t\tPreviousPolicyNumber,\n\t\tProgramID,\n\t\tNameOfInsured,\n\t\tContractNumber\n\tFROM DataCompromisePaymentBordereauxRecord\n\tWHERE convert(date,DataCompromisePaymentBordereauxRecord.RunDate)=@{pipeline().parameters.RUNDATE}\n),\nEXPTRANS AS (\n\tSELECT\n\tProductCode,\n\tCompany,\n\tPolicyNumber,\n\tTransactionCode,\n\tTransactionEffectiveDate,\n\tCoverageEffectiveDate,\n\tCoverageExpirationDate,\n\t-- *INF*: TO_CHAR(TransactionEffectiveDate,'YYYYMMDD')\r\n\t-- \n\tTO_CHAR(TransactionEffectiveDate, 'YYYYMMDD') AS TransactionEffectiveDateYYYYMMDD,\n\t-- *INF*: TO_CHAR(CoverageEffectiveDate,'YYYYMMDD')\n\tTO_CHAR(CoverageEffectiveDate, 'YYYYMMDD') AS CoverageEffectiveDateYYYYMMDD,\n\t-- *INF*: TO_CHAR(CoverageExpirationDate,'YYYYMMDD')\n\tTO_CHAR(CoverageExpirationDate, 'YYYYMMDD') AS CoverageExpirationDateYYYYMMDD,\n\tCoverageGrossPremium,\n\tCoverageNetPremium,\n\tPreviousPolicyNumber,\n\tProgramID,\n\tNameOfInsured,\n\tContractNumber\n\tFROM SQ_DataCompromisePaymentBordereauxRecord\n),\nDataCompromisePaymentBordereauxRecordFile AS (\n\tINSERT INTO DataCompromisePaymentBordereauxRecordFile\n\t(ProductCode, Company, PolicyNumber, TransactionCode, TransactionEffectiveDate, CoverageEffectiveDate, CoverageExpirationDate, CoverageGrossPremium, CoverageNetPremium, PreviousPolicyNumber, ProgramID, NameOfInsured, ContractNumber)\n\tSELECT \n\tPRODUCTCODE, \n\tCOMPANY, \n\tPOLICYNUMBER, \n\tTRANSACTIONCODE, \n\tTransactionEffectiveDateYYYYMMDD AS TRANSACTIONEFFECTIVEDATE, \n\tCoverageEffectiveDateYYYYMMDD AS COVERAGEEFFECTIVEDATE, \n\tCoverageExpirationDateYYYYMMDD AS COVERAGEEXPIRATIONDATE, \n\tCOVERAGEGROSSPREMIUM, \n\tCOVERAGENETPREMIUM, \n\tPREVIOUSPOLICYNUMBER, \n\tPROGRAMID, \n\tNAMEOFINSURED, \n\tCONTRACTNUMBER\n\tFROM EXPTRANS\n),\nSQ_DataCompromisePaymentBordereauxControlRecord AS (\n\tSELECT\n\t\tDataCompromisePaymentBordereauxRecordId,\n\t\tAuditID,\n\t\tSourceSystemID,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tPremiumMasterCalculationID,\n\t\tRunDate,\n\t\tProductCode,\n\t\tCompany,\n\t\tPolicyNumber,\n\t\tTransactionCode,\n\t\tTransactionEffectiveDate,\n\t\tCoverageEffectiveDate,\n\t\tCoverageExpirationDate,\n\t\tCoverageGrossPremium,\n\t\tCoverageNetPremium,\n\t\tPreviousPolicyNumber,\n\t\tProgramID,\n\t\tNameOfInsured,\n\t\tContractNumber\n\tFROM DataCompromisePaymentBordereauxRecord1\n\tWHERE convert(date,DataCompromisePaymentBordereauxRecord.RunDate)=@{pipeline().parameters.RUNDATE}\n),\nAGG_PaymentBordereauxRecord AS (\n\tSELECT\n\t'CONTROL' AS Control,\n\tRunDate,\n\tCompany,\n\tCoverageGrossPremium,\n\tCoverageNetPremium,\n\t-- *INF*: Count(1)\n\tCount(1) AS RecordCount,\n\t-- *INF*: Sum(CoverageGrossPremium)\n\tSum(CoverageGrossPremium) AS SumCoverageGrossPremium,\n\t-- *INF*: Sum(CoverageNetPremium)\n\tSum(CoverageNetPremium) AS SumCoverageNetPremium,\n\t-- *INF*: to_char(RunDate, 'YYYYMM')\n\tto_char(RunDate, 'YYYYMM') AS RunDateYYYYMM,\n\t'08.02' AS HardcodeString,\n\t'' AS HardCodeString2\n\tFROM SQ_DataCompromisePaymentBordereauxControlRecord\n\tGROUP BY Company, RunDateYYYYMM\n),\nDataCompromisePaymentBordereauxRecordControlFile AS (\n\tINSERT INTO DataCompromisePaymentBordereauxRecordControlFile\n\t(Control, Company, RecordCount, SumCoverageGrossPremium, SumCoverageNetPremium, RunDateYYYYMMDD, HardCodeString, HardCodeString2)\n\tSELECT \n\tCONTROL, \n\tCOMPANY, \n\tRECORDCOUNT, \n\tSUMCOVERAGEGROSSPREMIUM, \n\tSUMCOVERAGENETPREMIUM, \n\tRunDateYYYYMM AS RUNDATEYYYYMMDD, \n\tHardcodeString AS HARDCODESTRING, \n\tHARDCODESTRING2\n\tFROM AGG_PaymentBordereauxRecord\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "RUNDATE": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "DataFeed -Informatica/PolicyDataServices/"
        },
        "annotations": []
    }
}