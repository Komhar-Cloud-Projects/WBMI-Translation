{
    "name": "s_m_POL_DW_LOAD_CoverageDetailCommercialAuto_DCT_Negate",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DW_LOAD_CoverageDetailCommercialAuto_DCT_Negate",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_CoverageDetailCommercialAuto AS (\n\tSELECT CDCA.PremiumTransactionID,\r\n\t       CDCA.CoverageGuid,\r\n\t       CDCA.VehicleGroupCode,\r\n\t       CDCA.RadiusOfOperation,\r\n\t       CDCA.SecondaryVehicleType,\r\n\t       CDCA.UsedInDumpingIndicator,\r\n\t       CDCA.VehicleYear,\r\n\t       CDCA.StatedAmount,\r\n\t       CDCA.CostNew,\r\n\t       CDCA.VehicleDeleteDate,\r\n\t       CDCA.VIN,\r\n\t       CDCA.VehicleMake,\r\n\t       CDCA.VehicleModel,\r\n\t       CDCA.VehicleNumber,\r\n\t       CDCA.CompositeRatedFlag,\r\n\t       CDCA.TerminalZoneCode,\r\n\t       CDCA.VehicleType,\r\n\t       CDCA.PIPBureauCoverageCode,\r\n\t       CDCA.RetroactiveDate,\r\n\t       CDCA.VehicleTypeSize,\r\n\t       CDCA.BusinessUseClass,\r\n\t       CDCA.SecondaryClass,\r\n\t       CDCA.FleetType,\r\n\t       CDCA.SecondaryClassGroup,\r\n\t       CDCA.IncludeUIM,\t\r\n\t       PT.PremiumTransactionID,\r\n\t       CDCA.CoordinationOfBenefits, \r\n\t       CDCA.MedicalExpensesOption, \r\n\t       CDCA.CoveredByWorkersCompensationFlag,\r\n\t       CDCA.SubjectToNoFault,\r\n\t\t CDCA.AdditionalLimitKS,\r\n\t\t CDCA.AdditionalLimitKY,\r\n\t\t CDCA.AdditionalLimitMN,\r\n\t\t CDCA.RatingZoneCode,\r\n\t\t CDCA.ReplacementCost,\r\n\t\t CDCA.FullGlassIndicator,\r\n\t       CDCA.HistoricVehicleIndicator\r\n\tFROM   dbo.CoverageDetailCommercialAuto CDCA\r\n\t       INNER JOIN dbo.WorkPremiumTransactionDataRepairNegate WPTDRN\r\n\t               ON CDCA.PremiumTransactionID = WPTDRN.OriginalPremiumTransactionID\r\n\t       INNER JOIN dbo.PremiumTransaction PT\r\n\t               ON PT.PremiumTransactionAKID = WPTDRN.NewNegatePremiumTransactionAKID\r\n\t                  AND PT.SourceSystemId = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\n),\nExp_CoverageDetailGeneralLiability AS (\n\tSELECT\n\tPremiumTransactionID AS Old_PremiumTransactionID,\n\tCoverageGuid,\n\tVehicleGroupCode,\n\tRadiusOfOperation,\n\tSecondaryVehicleType,\n\tUsedInDumpingIndicator,\n\tVehicleYear,\n\tStatedAmount,\n\tCostNew,\n\tVehicleDeleteDate,\n\tVIN,\n\tVehicleMake,\n\tVehicleModel,\n\tVehicleNumber,\n\tCompositeRatedFlag,\n\tTerminalZoneCode,\n\tVehicleType,\n\tPIPBureauCoverageCode,\n\tRetroactiveDate AS RetroactiveDate1,\n\tVehicleTypeSize,\n\tBusinessUseClass,\n\tSecondaryClass,\n\tFleetType,\n\tSecondaryClassGroup,\n\tIncludeUIM,\n\tNewNegatePremiumTransactionID,\n\tCoordinationOfBenefits,\n\tMedicalExpensesOption,\n\tCoveredByWorkersCompensationFlag AS CoveredByWorkComp,\n\t-- *INF*: IIF(CoveredByWorkComp = 'T',1,0)\n\tIFF(CoveredByWorkComp = 'T', 1, 0) AS o_CoveredByWorkComp,\n\tSubjectToNoFault,\n\tAdditionalLimitKS,\n\tAdditionalLimitKY,\n\tAdditionalLimitMN,\n\tRatingZoneCode,\n\tReplacementCost,\n\t-- *INF*: IIF(ReplacementCost = 'T',1,0)\n\tIFF(ReplacementCost = 'T', 1, 0) AS o_ReplacementCost,\n\tFullGlassIndicator,\n\t-- *INF*: IIF(FullGlassIndicator = 'T',1,0)\n\tIFF(FullGlassIndicator = 'T', 1, 0) AS o_FullGlassIndicator,\n\tHistoricVehicleIndicator,\n\t-- *INF*: IIF(HistoricVehicleIndicator= 'T',1,0)\n\tIFF(HistoricVehicleIndicator = 'T', 1, 0) AS o_HistoricVehicleIndicator\n\tFROM SQ_CoverageDetailCommercialAuto\n),\nEXP_CoverageDetailCommercialAuto AS (\n\tSELECT\n\tNewNegatePremiumTransactionID,\n\tNewNegatePremiumTransactionID AS o_PremiumTransactionID,\n\tCoverageGuid,\n\tVehicleGroupCode,\n\tRadiusOfOperation,\n\tSecondaryVehicleType,\n\tUsedInDumpingIndicator,\n\tVehicleYear,\n\tStatedAmount,\n\tCostNew,\n\tVehicleDeleteDate,\n\tVIN,\n\tVehicleMake,\n\tVehicleModel,\n\tVehicleNumber,\n\tCompositeRatedFlag,\n\tTerminalZoneCode,\n\tVehicleType,\n\tPIPBureauCoverageCode,\n\tRetroactiveDate1,\n\tVehicleTypeSize,\n\tBusinessUseClass,\n\tSecondaryClass,\n\tFleetType,\n\tSecondaryClassGroup,\n\tIncludeUIM,\n\tCoordinationOfBenefits,\n\tMedicalExpensesOption,\n\to_CoveredByWorkComp AS CoveredByWorkComp,\n\tSubjectToNoFault,\n\tAdditionalLimitKS,\n\tAdditionalLimitKY,\n\tAdditionalLimitMN,\n\tRatingZoneCode,\n\to_ReplacementCost AS ReplacementCost,\n\to_FullGlassIndicator AS FullGlassIndicator,\n\to_HistoricVehicleIndicator AS HistoricVehicleIndicator\n\tFROM Exp_CoverageDetailGeneralLiability\n),\nLKP_CoverageDetailCommercialAuto AS (\n\tSELECT\n\tPremiumTransactionID,\n\tVehicleGroupCode,\n\tRadiusOfOperation,\n\tSecondaryVehicleType,\n\tUsedInDumpingIndicator,\n\tVehicleYear,\n\tStatedAmount,\n\tCostNew,\n\tVehicleDeleteDate,\n\tVIN,\n\tVehicleMake,\n\tVehicleModel,\n\tVehicleNumber,\n\tCompositeRatedFlag,\n\tTerminalZoneCode,\n\tVehicleType,\n\tPIPBureaucoverageCode,\n\tVehicleTypeSize,\n\tBusinessUseClass,\n\tSecondaryClass,\n\tFleetType,\n\tSecondaryClassGroup,\n\tIncludeUIM\n\tFROM (\n\t\tSELECT \n\t\t\tPremiumTransactionID,\n\t\t\tVehicleGroupCode,\n\t\t\tRadiusOfOperation,\n\t\t\tSecondaryVehicleType,\n\t\t\tUsedInDumpingIndicator,\n\t\t\tVehicleYear,\n\t\t\tStatedAmount,\n\t\t\tCostNew,\n\t\t\tVehicleDeleteDate,\n\t\t\tVIN,\n\t\t\tVehicleMake,\n\t\t\tVehicleModel,\n\t\t\tVehicleNumber,\n\t\t\tCompositeRatedFlag,\n\t\t\tTerminalZoneCode,\n\t\t\tVehicleType,\n\t\t\tPIPBureaucoverageCode,\n\t\t\tVehicleTypeSize,\n\t\t\tBusinessUseClass,\n\t\t\tSecondaryClass,\n\t\t\tFleetType,\n\t\t\tSecondaryClassGroup,\n\t\t\tIncludeUIM\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialAuto\n\t\tWHERE SourceSystemId='@{pipeline().parameters.SOURCE_SYSTEM_ID}'\r\n\t\tAND\r\n\t\tPremiumTransactionID IN (SELECT pt.PremiumTransactionID FROM\r\n\t\tPremiumTransaction pt INNER JOIN dbo.WorkPremiumTransactionDataRepairNegate wpt\r\n\t\tON pt.PremiumTransactionAKID=wpt.NewNegatePremiumTransactionAKID)\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionID ORDER BY PremiumTransactionID) = 1\n),\nEXP_DetectChanges AS (\n\tSELECT\n\tLKP_CoverageDetailCommercialAuto.PremiumTransactionID AS lkp_PremiumTransactionID,\n\tLKP_CoverageDetailCommercialAuto.VehicleGroupCode AS lkp_VehicleGroupCode,\n\tLKP_CoverageDetailCommercialAuto.RadiusOfOperation AS lkp_RadiusOfOperation,\n\tLKP_CoverageDetailCommercialAuto.SecondaryVehicleType AS lkp_SecondaryVehicleType,\n\tLKP_CoverageDetailCommercialAuto.UsedInDumpingIndicator AS lkp_UsedInDumpingIndicator,\n\t-- *INF*: IIF(lkp_UsedInDumpingIndicator='T',1,0)\n\tIFF(lkp_UsedInDumpingIndicator = 'T', 1, 0) AS v_UsedInDumpingIndicator,\n\tLKP_CoverageDetailCommercialAuto.VehicleYear AS lkp_VehicleYear,\n\tLKP_CoverageDetailCommercialAuto.StatedAmount AS lkp_StatedAmount,\n\tLKP_CoverageDetailCommercialAuto.CostNew AS lkp_CostNew,\n\tLKP_CoverageDetailCommercialAuto.VehicleDeleteDate AS lkp_VehicleDeleteDate,\n\tLKP_CoverageDetailCommercialAuto.VIN AS lkp_VIN,\n\tLKP_CoverageDetailCommercialAuto.VehicleMake AS lkp_VehicleMake,\n\tLKP_CoverageDetailCommercialAuto.VehicleModel AS lkp_VehicleModel,\n\tLKP_CoverageDetailCommercialAuto.VehicleNumber AS lkp_VehicleNumber,\n\tLKP_CoverageDetailCommercialAuto.CompositeRatedFlag AS lkp_CompositeRatedFlag,\n\t-- *INF*: IIF(lkp_CompositeRatedFlag='T',1,0)\n\tIFF(lkp_CompositeRatedFlag = 'T', 1, 0) AS v_CompositeRatedFlag,\n\tLKP_CoverageDetailCommercialAuto.TerminalZoneCode AS lkp_TerminalZoneCode,\n\tLKP_CoverageDetailCommercialAuto.VehicleType AS lkp_VehicleType,\n\tLKP_CoverageDetailCommercialAuto.PIPBureaucoverageCode AS lkp_PIPBureaucoverageCode,\n\tLKP_CoverageDetailCommercialAuto.VehicleTypeSize AS lkp_VehicleTypeSize,\n\tLKP_CoverageDetailCommercialAuto.BusinessUseClass AS lkp_BusinessUseClass,\n\tLKP_CoverageDetailCommercialAuto.SecondaryClass AS lkp_SecondaryClass,\n\tLKP_CoverageDetailCommercialAuto.FleetType AS lkp_FleetType,\n\tLKP_CoverageDetailCommercialAuto.SecondaryClassGroup AS lkp_SecondaryClassGroup,\n\tLKP_CoverageDetailCommercialAuto.IncludeUIM AS lkp_IncludeUIM,\n\tEXP_CoverageDetailCommercialAuto.o_PremiumTransactionID AS i_PremiumTransactionID,\n\ti_PremiumTransactionID AS o_PremiumTransactionID,\n\t'1' AS o_CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t-- *INF*: TO_DATE('1800-01-01 00:00:00.000', 'YYYY-MM-DD HH24:MI:SS.US')\n\tTO_DATE('1800-01-01 00:00:00.000', 'YYYY-MM-DD HH24:MI:SS.US') AS o_EffectiveDate,\n\t-- *INF*: TO_DATE('2100-12-31 23:59:59.000', 'YYYY-MM-DD HH24:MI:SS.US')\n\tTO_DATE('2100-12-31 23:59:59.000', 'YYYY-MM-DD HH24:MI:SS.US') AS o_ExpirationDate,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemID,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\tEXP_CoverageDetailCommercialAuto.CoverageGuid,\n\tEXP_CoverageDetailCommercialAuto.VehicleGroupCode,\n\tEXP_CoverageDetailCommercialAuto.RadiusOfOperation,\n\tEXP_CoverageDetailCommercialAuto.SecondaryVehicleType,\n\tEXP_CoverageDetailCommercialAuto.UsedInDumpingIndicator,\n\tEXP_CoverageDetailCommercialAuto.VehicleYear,\n\tEXP_CoverageDetailCommercialAuto.StatedAmount,\n\tEXP_CoverageDetailCommercialAuto.CostNew,\n\tEXP_CoverageDetailCommercialAuto.VehicleDeleteDate,\n\tEXP_CoverageDetailCommercialAuto.VIN,\n\tEXP_CoverageDetailCommercialAuto.VehicleMake,\n\tEXP_CoverageDetailCommercialAuto.VehicleModel,\n\tEXP_CoverageDetailCommercialAuto.VehicleNumber,\n\tEXP_CoverageDetailCommercialAuto.CompositeRatedFlag,\n\tEXP_CoverageDetailCommercialAuto.TerminalZoneCode,\n\tEXP_CoverageDetailCommercialAuto.VehicleType,\n\tEXP_CoverageDetailCommercialAuto.PIPBureauCoverageCode,\n\tEXP_CoverageDetailCommercialAuto.RetroactiveDate1,\n\tEXP_CoverageDetailCommercialAuto.VehicleTypeSize,\n\tEXP_CoverageDetailCommercialAuto.BusinessUseClass,\n\tEXP_CoverageDetailCommercialAuto.SecondaryClass,\n\tEXP_CoverageDetailCommercialAuto.FleetType,\n\tEXP_CoverageDetailCommercialAuto.SecondaryClassGroup,\n\tEXP_CoverageDetailCommercialAuto.IncludeUIM,\n\t-- *INF*: IIF(ISNULL(lkp_PremiumTransactionID),'NEW','UPDATE')\n\tIFF(lkp_PremiumTransactionID IS NULL, 'NEW', 'UPDATE') AS ChangeFlag,\n\tEXP_CoverageDetailCommercialAuto.CoordinationOfBenefits,\n\tEXP_CoverageDetailCommercialAuto.MedicalExpensesOption,\n\tEXP_CoverageDetailCommercialAuto.CoveredByWorkComp,\n\tEXP_CoverageDetailCommercialAuto.SubjectToNoFault,\n\tEXP_CoverageDetailCommercialAuto.AdditionalLimitKS,\n\tEXP_CoverageDetailCommercialAuto.AdditionalLimitKY,\n\tEXP_CoverageDetailCommercialAuto.AdditionalLimitMN,\n\tEXP_CoverageDetailCommercialAuto.RatingZoneCode,\n\tEXP_CoverageDetailCommercialAuto.ReplacementCost,\n\tEXP_CoverageDetailCommercialAuto.FullGlassIndicator,\n\tEXP_CoverageDetailCommercialAuto.HistoricVehicleIndicator\n\tFROM EXP_CoverageDetailCommercialAuto\n\tLEFT JOIN LKP_CoverageDetailCommercialAuto\n\tON LKP_CoverageDetailCommercialAuto.PremiumTransactionID = EXP_CoverageDetailCommercialAuto.o_PremiumTransactionID\n),\nRTR_INSERT_UPDATE AS (\n\tSELECT\n\to_PremiumTransactionID AS PremiumTransactionID,\n\to_CurrentSnapshotFlag AS CurrentSnapshotFlag,\n\to_AuditID AS AuditID,\n\to_EffectiveDate AS EffectiveDate,\n\to_ExpirationDate AS ExpirationDate,\n\to_SourceSystemID AS SourceSystemID,\n\to_CreatedDate AS CreatedDate,\n\to_ModifiedDate AS ModifiedDate,\n\tCoverageGuid,\n\tVehicleGroupCode,\n\tRadiusOfOperation,\n\tSecondaryVehicleType,\n\tUsedInDumpingIndicator,\n\tVehicleYear AS Year,\n\tStatedAmount,\n\tCostNew,\n\tVehicleDeleteDate,\n\tVIN,\n\tVehicleMake AS Make,\n\tVehicleModel AS Model,\n\tVehicleNumber,\n\tCompositeRatedFlag AS CompositeRating,\n\tTerminalZoneCode,\n\tVehicleType,\n\tChangeFlag,\n\tPIPBureauCoverageCode AS PIPBureaucoverageCode,\n\tRetroactiveDate1 AS RetroactiveDate,\n\tVehicleTypeSize AS CommercialAutoVehicleType,\n\tBusinessUseClass AS CommercialAutoBusinessUseClass,\n\tSecondaryClass,\n\tFleetType,\n\tSecondaryClassGroup,\n\tIncludeUIM,\n\tCoordinationOfBenefits,\n\tMedicalExpensesOption,\n\tCoveredByWorkComp,\n\tSubjectToNoFault,\n\tAdditionalLimitKS,\n\tAdditionalLimitKY,\n\tAdditionalLimitMN,\n\tRatingZoneCode,\n\tReplacementCost,\n\tFullGlassIndicator,\n\tHistoricVehicleIndicator\n\tFROM EXP_DetectChanges\n),\nRTR_INSERT_UPDATE_INSERT AS (SELECT * FROM RTR_INSERT_UPDATE WHERE ChangeFlag = 'NEW'),\nRTR_INSERT_UPDATE_UPDATE AS (SELECT * FROM RTR_INSERT_UPDATE WHERE ChangeFlag = 'UPDATE'),\nCoverageDetailCommercialAuto_INSERT AS (\n\tINSERT INTO CoverageDetailCommercialAuto\n\t(PremiumTransactionID, CurrentSnapshotFlag, AuditID, EffectiveDate, ExpirationDate, SourceSystemID, CreatedDate, ModifiedDate, CoverageGuid, VehicleGroupCode, RadiusOfOperation, SecondaryVehicleType, UsedInDumpingIndicator, VehicleYear, StatedAmount, CostNew, VehicleDeleteDate, VIN, VehicleMake, VehicleModel, VehicleNumber, CompositeRatedFlag, TerminalZoneCode, VehicleType, PIPBureauCoverageCode, RetroactiveDate, VehicleTypeSize, BusinessUseClass, SecondaryClass, FleetType, SecondaryClassGroup, IncludeUIM, CoordinationOfBenefits, MedicalExpensesOption, CoveredByWorkersCompensationFlag, SubjectToNoFault, AdditionalLimitKS, AdditionalLimitKY, AdditionalLimitMN, RatingZoneCode, ReplacementCost, FullGlassIndicator, HistoricVehicleIndicator)\n\tSELECT \n\tPREMIUMTRANSACTIONID, \n\tCURRENTSNAPSHOTFLAG, \n\tAUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tSOURCESYSTEMID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tCOVERAGEGUID, \n\tVEHICLEGROUPCODE, \n\tRADIUSOFOPERATION, \n\tSECONDARYVEHICLETYPE, \n\tUSEDINDUMPINGINDICATOR, \n\tYear AS VEHICLEYEAR, \n\tSTATEDAMOUNT, \n\tCOSTNEW, \n\tVEHICLEDELETEDATE, \n\tVIN, \n\tMake AS VEHICLEMAKE, \n\tModel AS VEHICLEMODEL, \n\tVEHICLENUMBER, \n\tCompositeRating AS COMPOSITERATEDFLAG, \n\tTERMINALZONECODE, \n\tVEHICLETYPE, \n\tPIPBureaucoverageCode AS PIPBUREAUCOVERAGECODE, \n\tRETROACTIVEDATE, \n\tCommercialAutoVehicleType AS VEHICLETYPESIZE, \n\tCommercialAutoBusinessUseClass AS BUSINESSUSECLASS, \n\tSECONDARYCLASS, \n\tFLEETTYPE, \n\tSECONDARYCLASSGROUP, \n\tINCLUDEUIM, \n\tCOORDINATIONOFBENEFITS, \n\tMEDICALEXPENSESOPTION, \n\tCoveredByWorkComp AS COVEREDBYWORKERSCOMPENSATIONFLAG, \n\tSUBJECTTONOFAULT, \n\tADDITIONALLIMITKS, \n\tADDITIONALLIMITKY, \n\tADDITIONALLIMITMN, \n\tRATINGZONECODE, \n\tREPLACEMENTCOST, \n\tFULLGLASSINDICATOR, \n\tHISTORICVEHICLEINDICATOR\n\tFROM RTR_INSERT_UPDATE_INSERT\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "216690"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "881000"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7484958"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "06/27/2023 12:02:14"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "07/04/2023 10:58:56"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "DCT"
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "WC_Stage"
            }
        },
        "folder": {
            "name": "Policy DataWarehouse/"
        },
        "annotations": []
    }
}