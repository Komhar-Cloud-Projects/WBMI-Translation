{
    "name": "s_m_POL_DW_LOAD_CoverageLimit",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DW_LOAD_CoverageLimit",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_PifDept1553Stage_UnderlyingInsuranceLine AS (\n\tSELECT\n\tUnderlyingInsuranceLine,\n\tPifSymbol,\n\tPifPolicyNumber,\n\tPifModule,\n\tDECLPTFormNumber,\n\tDECLPTSeqSameForm,\n\tDECLPTSeq0098\n\tFROM (\n\t\tselect case when ltrim(rtrim(replace(SourceValue,'=','')))='LIMITS OF INSURANCE'\r\n\t\tthen 'Umbrella'\r\n\t\twhen charindex('GENERAL LIABILITY INSURANCE',SourceValue )>0\r\n\t\tand charindex('POLICY NUMBER:@',SourceValue )>0\r\n\t\tand substring(\r\n\t\tREPLACE(SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue))+1,\r\n\t\tCHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue)))-CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue))-1) , ' ', ''),\r\n\t\t1,2) in ('NA', 'NB')\r\n\t\tthen 'SBOPGeneralLiability'\r\n\t\twhen charindex('GENERAL LIABILITY INSURANCE',SourceValue )>0\r\n\t\tand charindex('POLICY NUMBER:@',SourceValue )>0\r\n\t\tand substring(\r\n\t\tREPLACE(SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue))+1,\r\n\t\tCHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue)))-CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue))-1) , ' ', ''),\r\n\t\t1,2) in ('BC', 'BD')\r\n\t\tthen 'CBOPGeneralLiability'\r\n\t\twhen charindex('GENERAL LIABILITY INSURANCE',SourceValue )>0\r\n\t\tand charindex('POLICY NUMBER:@',SourceValue )>0\r\n\t\tand substring(\r\n\t\tREPLACE(SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue))+1,\r\n\t\tCHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue)))-CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue))-1) , ' ', ''),\r\n\t\t1,2) in ('BO')\r\n\t\tthen 'SMARTbusinessLiability'\r\n\t\twhen charindex('GENERAL LIABILITY INSURANCE',SourceValue )>0\r\n\t\tthen 'GeneralLiability'\r\n\t\twhen charindex('EMPLOYERS'' LIABILITY INSURANCE',SourceValue )>0\r\n\t\tthen 'EmployersLiability'\r\n\t\twhen charindex('@BUSINESSOWNERS LIABILITY',SourceValue )>0\r\n\t\tthen 'BusinessownersLiability'\r\n\t\twhen charindex('@BUSSINESSOWNERS LIABILITY',SourceValue )>0\r\n\t\tthen 'BusinessownersLiability'\r\n\t\twhen charindex('GARAGE LIABILITY INSURANCE',SourceValue )>0\r\n\t\tthen 'GarageLiability'\r\n\t\twhen charindex('AUTOMOBILE LIABILITY INSURANCE',SourceValue )>0\r\n\t\tthen 'CommercialAutoLiability'\r\n\t\twhen charindex('@LIQUOR LIABLITY',SourceValue )>0\r\n\t\tthen 'LiquorLiability'\r\n\t\telse 'N/A' end as UnderlyingInsuranceLine,\r\n\t\tPifSymbol as PifSymbol ,\r\n\t\tPifPolicyNumber as PifPolicyNumber,\r\n\t\tPifModule as PifModule,\r\n\t\tDECLPTFormNumber as DECLPTFormNumber,\r\n\t\tDECLPTSeqSameForm as DECLPTSeqSameForm,\r\n\t\tDECLPTSeq0098 as DECLPTSeq0098\r\n\t\tfrom (\r\n\t\tselect PifSymbol,\r\n\t\tPifPolicyNumber,\r\n\t\tPifModule,\r\n\t\tDECLPTFormNumber,\r\n\t\tDECLPTSeqSameForm,\r\n\t\tDECLPTSeq0098,\r\n\t\tltrim(rtrim(DECLPTText1701))+' '+ltrim(rtrim(DECLPTText71791))+' '+ltrim(rtrim(DECLPTText1702))+' '+ltrim(rtrim(DECLPTText71792)) as SourceValue\r\n\t\tfrom @{pipeline().parameters.SOURCE_TABLE_OWNER}.PifDept1553Stage dept1553\r\n\t\twhere LEFT(PifSymbol,2) in ('CU','NU','CP') and LEFT(DECLPTFormNumber,1)='U'\r\n\t\t) Src\r\n\t\twhere  ltrim(rtrim(replace(SourceValue,'=','')))='LIMITS OF INSURANCE' or charindex('GENERAL LIABILITY INSURANCE',SourceValue )>0 or charindex('EMPLOYERS'' LIABILITY INSURANCE',SourceValue )>0 or charindex('@BUSINESSOWNERS LIABILITY',SourceValue )>0  or charindex('@BUSSINESSOWNERS LIABILITY',SourceValue )>0 or charindex('GARAGE LIABILITY INSURANCE',SourceValue )>0 or charindex('AUTOMOBILE LIABILITY INSURANCE',SourceValue )>0 or charindex('@LIQUOR LIABLITY',SourceValue )>0\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PifSymbol,PifPolicyNumber,PifModule,DECLPTFormNumber,DECLPTSeqSameForm,DECLPTSeq0098 ORDER BY UnderlyingInsuranceLine DESC) = 1\n),\nLKP_PifDept1553Stage_UnderlyingCompanyName AS (\n\tSELECT\n\tUnderlyingCompanyName,\n\tPifSymbol,\n\tPifPolicyNumber,\n\tPifModule,\n\tDECLPTFormNumber,\n\tDECLPTSeqSameForm,\n\tDECLPTSeq0098\n\tFROM (\n\t\tselect \r\n\t\tcase when charindex('INSURER:',SourceValue )>0\r\n\t\tthen LTRIM(RTRIM(\r\n\t\tSUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('INSURER:',SourceValue))+1,\r\n\t\tCHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('INSURER:',SourceValue)))-CHARINDEX('@',SourceValue,charindex('INSURER:',SourceValue))-1) \r\n\t\t))\r\n\t\telse\r\n\t\t'N/A'\r\n\t\tend as UnderlyingCompanyName,\r\n\t\tPifSymbol as PifSymbol ,\r\n\t\tPifPolicyNumber as PifPolicyNumber,\r\n\t\tPifModule as PifModule,\r\n\t\tDECLPTFormNumber as DECLPTFormNumber,\r\n\t\tDECLPTSeqSameForm as DECLPTSeqSameForm,\r\n\t\tDECLPTSeq0098 as DECLPTSeq0098\r\n\t\tfrom (\r\n\t\tselect PifSymbol,\r\n\t\tPifPolicyNumber,\r\n\t\tPifModule,\r\n\t\tDECLPTFormNumber,\r\n\t\tDECLPTSeqSameForm,\r\n\t\tDECLPTSeq0098,\r\n\t\tltrim(rtrim(DECLPTText1701))+' '+ltrim(rtrim(DECLPTText71791))+' '+ltrim(rtrim(DECLPTText1702))+' '+ltrim(rtrim(DECLPTText71792)) as SourceValue\r\n\t\tfrom @{pipeline().parameters.SOURCE_TABLE_OWNER}.PifDept1553Stage dept1553\r\n\t\twhere LEFT(PifSymbol,2) in ('CU','NU','CP') and LEFT(DECLPTFormNumber,1)='U'\r\n\t\t) Src\r\n\t\twhere  charindex('INSURER:',SourceValue )>0 and LTRIM(RTRIM(\r\n\t\tSUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('INSURER:',SourceValue))+1,\r\n\t\tCHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('INSURER:',SourceValue)))-CHARINDEX('@',SourceValue,charindex('INSURER:',SourceValue))-1) \r\n\t\t))<>''\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PifSymbol,PifPolicyNumber,PifModule,DECLPTFormNumber,DECLPTSeqSameForm,DECLPTSeq0098 ORDER BY UnderlyingCompanyName DESC) = 1\n),\nLKP_PifDept1553Stage_UnderlyingPolicyKey AS (\n\tSELECT\n\tUnderlyingPolicyKey,\n\tPifSymbol,\n\tPifPolicyNumber,\n\tPifModule,\n\tDECLPTFormNumber,\n\tDECLPTSeqSameForm,\n\tDECLPTSeq0098\n\tFROM (\n\t\tselect \r\n\t\tcase when charindex('POLICY NUMBER:',SourceValue )>0\r\n\t\tthen REPLACE(SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue))+1,\r\n\t\tCHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue)))-CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue))-1) , ' ', '')\r\n\t\telse\r\n\t\t'N/A'\r\n\t\tend as UnderlyingPolicyKey,\r\n\t\tPifSymbol as PifSymbol ,\r\n\t\tPifPolicyNumber as PifPolicyNumber,\r\n\t\tPifModule as PifModule,\r\n\t\tDECLPTFormNumber as DECLPTFormNumber,\r\n\t\tDECLPTSeqSameForm as DECLPTSeqSameForm,\r\n\t\tDECLPTSeq0098 as DECLPTSeq0098\r\n\t\tfrom (\r\n\t\tselect PifSymbol,\r\n\t\tPifPolicyNumber,\r\n\t\tPifModule,\r\n\t\tDECLPTFormNumber,\r\n\t\tDECLPTSeqSameForm,\r\n\t\tDECLPTSeq0098,\r\n\t\tltrim(rtrim(DECLPTText1701))+' '+ltrim(rtrim(DECLPTText71791))+' '+ltrim(rtrim(DECLPTText1702))+' '+ltrim(rtrim(DECLPTText71792)) as SourceValue\r\n\t\tfrom @{pipeline().parameters.SOURCE_TABLE_OWNER}.PifDept1553Stage dept1553\r\n\t\twhere LEFT(PifSymbol,2) in ('CU','NU','CP') and LEFT(DECLPTFormNumber,1)='U'\r\n\t\t) Src\r\n\t\twhere  charindex('POLICY NUMBER:',SourceValue )>0 and REPLACE(SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue))+1, CHARINDEX('^', SourceValue, CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue)))-CHARINDEX('@',SourceValue,charindex('POLICY NUMBER:',SourceValue))-1) , ' ', '')<>''\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PifSymbol,PifPolicyNumber,PifModule,DECLPTFormNumber,DECLPTSeqSameForm,DECLPTSeq0098 ORDER BY UnderlyingPolicyKey DESC) = 1\n),\nSQ_pif_4514_stage AS (\n\tSELECT \r\n\tpif_4514_stage.pif_4514_stage_id as pif_4514_stage_id, \r\n\tpif_4514_stage.pif_symbol as pif_symbol,\r\n\tpif_4514_stage.pif_policy_number as pif_policy_number,\r\n\tpif_4514_stage.pif_module as pif_module,\r\n\tLTRIM(RTRIM(pif_4514_stage.sar_insurance_line)) as sar_insurance_line, \r\n\t(CASE WHEN Pif43RXCPStage.Pif43RXCPStageId IS NOT NULL THEN CONVERT(VARCHAR(3),Pif43RXCPStage.Pmdrxp1PmsDefSubjOfIns)\r\n\tELSE LTRIM(RTRIM(pif_4514_stage.sar_risk_unit_group)) END) as sar_risk_unit_group, \r\n\tLTRIM(RTRIM(pif_4514_stage.sar_unit))+LTRIM(RTRIM(pif_4514_stage.sar_risk_unit_continued)) as sar_unit,\r\n\t(CASE WHEN Pif43RXCPStage.Pif43RXCPStageId IS NOT NULL THEN Pif43RXCPStage.Pmdrxp1AmountOfInsurance\r\n\tELSE pif_4514_stage.sar_exposure*1000 END) as sar_exposure, \r\n\tLTRIM(RTRIM(pif_4514_stage.sar_major_peril)) as sar_major_peril, \r\n\tLTRIM(RTRIM(pif_4514_stage.sar_seq_no)) as sar_seq_no, \r\n\tLTRIM(RTRIM(pif_4514_stage.sar_type_bureau)) as sar_type_bureau, \r\n\tLTRIM(RTRIM(pif_4514_stage.sar_class_1_4)) as sar_class_1_4, \r\n\tLTRIM(RTRIM(pif_4514_stage.sar_code_1)) as sar_code_1, \r\n\tLTRIM(RTRIM(pif_4514_stage.sar_code_2)) as sar_code_2, \r\n\tLTRIM(RTRIM(pif_4514_stage.sar_code_3)) as sar_code_3, \r\n\tLTRIM(RTRIM(pif_4514_stage.sar_code_5)) as sar_code_5, \r\n\tLTRIM(RTRIM(pif_4514_stage.sar_code_6)) as sar_code_6,\r\n\tpif_4514_stage.sar_state as sar_state,\r\n\tPif43RXCPStage.Pif43RXCPStageId as Pif43RXCPStageId\r\n\tFROM\r\n\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.pif_4514_stage pif_4514_stage\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Pif43RXCPStage Pif43RXCPStage\r\n\tON Pif43RXCPStage.PifSymbol=pif_4514_stage.pif_symbol\r\n\tAND Pif43RXCPStage.PifPolicyNumber=pif_4514_stage.pif_policy_number\r\n\tAND Pif43RXCPStage.PifModule=pif_4514_stage.pif_module\r\n\tAND Pif43RXCPStage.Pmdrxp1InsuranceLine=pif_4514_stage.sar_insurance_line\r\n\tAND Pif43RXCPStage.Pmdrxp1LocationNumber=CONVERT(int,pif_4514_stage.sar_location_x)\r\n\tAND Pif43RXCPStage.Pmdrxp1SubLocationNumber=CONVERT(int,pif_4514_stage.sar_sub_location_x)\r\n\tand right('000'+CONVERT(VARCHAR(3),Pif43RXCPStage.Pmdrxp1PmsDefSubjOfIns), 3)=LTRIM(RTRIM(pif_4514_stage.sar_risk_unit_group))\r\n\tWHERE pif_4514_stage.logical_flag IN ('0','1','2','3')\r\n\t@{pipeline().parameters.WHERE_CLAUSE_4514}\n),\nEXP_Set_Lookup_Conditions AS (\n\tSELECT\n\tsar_insurance_line AS i_sar_insurance_line,\n\tsar_major_peril AS i_sar_major_peril,\n\tsar_risk_unit_group AS i_sar_risk_unit_group,\n\tsar_unit AS i_sar_unit,\n\tsar_type_bureau AS i_sar_type_bureau,\n\tsar_class_1_4 AS i_sar_class_1_4,\n\tsar_seq_no AS i_sar_seq_no,\n\tsar_code_1 AS i_sar_code_1,\n\tsar_code_2 AS i_sar_code_2,\n\tsar_code_3 AS i_sar_code_3,\n\tsar_code_5 AS i_sar_code_5,\n\tsar_code_6 AS i_sar_code_6,\n\tPif43RXCPStageId AS i_Pif43RXCPStageId,\n\tpif_4514_stage_id,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- NOT ISNULL(i_Pif43RXCPStageId),'&&'||i_sar_risk_unit_group||'&&&&&&&&&',\r\n\t-- i_sar_insurance_line='CR' and in(i_sar_major_peril,'565','566') and in(i_sar_type_bureau,'CR','FT','BT'),i_sar_insurance_line||'&'||i_sar_major_peril||'&&'||i_sar_type_bureau||'&'||i_sar_unit||'&&&&&&&',\r\n\t-- i_sar_insurance_line = 'IM' and i_sar_major_peril = '551',i_sar_insurance_line||'&'||i_sar_major_peril||'&'||i_sar_risk_unit_group||'&&&'||i_sar_class_1_4||'&&&&&&',\r\n\t-- i_sar_insurance_line = 'GA' and i_sar_major_peril = '100' and in(i_sar_seq_no, '00','01') and i_sar_type_bureau = 'AL',i_sar_insurance_line||'&'||i_sar_major_peril||'&&'||i_sar_type_bureau||'&&&'||i_sar_seq_no||'&&'||i_sar_code_2||'&'||i_sar_code_3||'&&',\r\n\t-- i_sar_insurance_line = 'GA' and i_sar_major_peril='114' and i_sar_type_bureau='AL',i_sar_insurance_line||'&'||i_sar_major_peril||'&&'||i_sar_type_bureau||'&&&&&&&'||SUBSTR(i_sar_code_5,1,1)||'&',\r\n\t-- i_sar_insurance_line = 'GA' and in(i_sar_major_peril,'115','120') and i_sar_type_bureau='AL',i_sar_insurance_line||'&'||i_sar_major_peril||'&&'||i_sar_type_bureau||'&&&&&&&'||IIF(LENGTH(i_sar_code_5)>1,SUBSTR(i_sar_code_5,2,1),i_sar_code_5) ||'&',\r\n\t-- i_sar_insurance_line = 'GA' and i_sar_major_peril = '118' and i_sar_type_bureau='AL',i_sar_insurance_line||'&'||i_sar_major_peril||'&&'||i_sar_type_bureau||'&&&&&&&&'||i_sar_code_6,\r\n\t-- i_sar_insurance_line = 'GA' and i_sar_major_peril = '130' and i_sar_type_bureau='AN',i_sar_insurance_line||'&'||i_sar_major_peril||'&&'||i_sar_type_bureau||'&&&&'||i_sar_code_1||'&'||i_sar_code_2||'&&&',\r\n\t-- i_sar_insurance_line='GA' and i_sar_type_bureau='AP',i_sar_insurance_line||'&&&'||i_sar_type_bureau||'&'||i_sar_unit||'&&&&&&&',\r\n\t-- i_sar_major_peril='100' and i_sar_type_bureau='AL','&'||i_sar_major_peril||'&&'||i_sar_type_bureau||'&&&&&'||i_sar_code_2||'&'||i_sar_code_3||'&&',\r\n\t-- i_sar_major_peril='114' and i_sar_type_bureau='AL','&'||i_sar_major_peril||'&&'||i_sar_type_bureau||'&&&&&&&'||SUBSTR(i_sar_code_5,1,1)||'&',\r\n\t-- in(i_sar_major_peril,'115','116') and i_sar_type_bureau='AL','&'||i_sar_major_peril||'&&'||i_sar_type_bureau||'&&&&&&&'||IIF(LENGTH(i_sar_code_5)>1,SUBSTR(i_sar_code_5,2,1),i_sar_code_5)||'&',\r\n\t-- in(i_sar_major_peril,'118','119') and i_sar_type_bureau='AL','&'||i_sar_major_peril||'&&'||i_sar_type_bureau||'&&&&&&&&'||i_sar_code_6,\r\n\t-- i_sar_major_peril='130' and i_sar_type_bureau='AN','&'||i_sar_major_peril||'&&'||i_sar_type_bureau||'&&&&'||i_sar_code_1||'&'||i_sar_code_2||'&&&',\r\n\t-- NULL\r\n\t-- )\n\tDECODE(\n\t    TRUE,\n\t    i_Pif43RXCPStageId IS NOT NULL, '&&' || i_sar_risk_unit_group || '&&&&&&&&&',\n\t    i_sar_insurance_line = 'CR' and i_sar_major_peril IN ('565','566') and i_sar_type_bureau IN ('CR','FT','BT'), i_sar_insurance_line || '&' || i_sar_major_peril || '&&' || i_sar_type_bureau || '&' || i_sar_unit || '&&&&&&&',\n\t    i_sar_insurance_line = 'IM' and i_sar_major_peril = '551', i_sar_insurance_line || '&' || i_sar_major_peril || '&' || i_sar_risk_unit_group || '&&&' || i_sar_class_1_4 || '&&&&&&',\n\t    i_sar_insurance_line = 'GA' and i_sar_major_peril = '100' and i_sar_seq_no IN ('00','01') and i_sar_type_bureau = 'AL', i_sar_insurance_line || '&' || i_sar_major_peril || '&&' || i_sar_type_bureau || '&&&' || i_sar_seq_no || '&&' || i_sar_code_2 || '&' || i_sar_code_3 || '&&',\n\t    i_sar_insurance_line = 'GA' and i_sar_major_peril = '114' and i_sar_type_bureau = 'AL', i_sar_insurance_line || '&' || i_sar_major_peril || '&&' || i_sar_type_bureau || '&&&&&&&' || SUBSTR(i_sar_code_5, 1, 1) || '&',\n\t    i_sar_insurance_line = 'GA' and i_sar_major_peril IN ('115','120') and i_sar_type_bureau = 'AL', i_sar_insurance_line || '&' || i_sar_major_peril || '&&' || i_sar_type_bureau || '&&&&&&&' || \n\t    IFF(\n\t        LENGTH(i_sar_code_5) > 1, SUBSTR(i_sar_code_5, 2, 1), i_sar_code_5\n\t    ) || '&',\n\t    i_sar_insurance_line = 'GA' and i_sar_major_peril = '118' and i_sar_type_bureau = 'AL', i_sar_insurance_line || '&' || i_sar_major_peril || '&&' || i_sar_type_bureau || '&&&&&&&&' || i_sar_code_6,\n\t    i_sar_insurance_line = 'GA' and i_sar_major_peril = '130' and i_sar_type_bureau = 'AN', i_sar_insurance_line || '&' || i_sar_major_peril || '&&' || i_sar_type_bureau || '&&&&' || i_sar_code_1 || '&' || i_sar_code_2 || '&&&',\n\t    i_sar_insurance_line = 'GA' and i_sar_type_bureau = 'AP', i_sar_insurance_line || '&&&' || i_sar_type_bureau || '&' || i_sar_unit || '&&&&&&&',\n\t    i_sar_major_peril = '100' and i_sar_type_bureau = 'AL', '&' || i_sar_major_peril || '&&' || i_sar_type_bureau || '&&&&&' || i_sar_code_2 || '&' || i_sar_code_3 || '&&',\n\t    i_sar_major_peril = '114' and i_sar_type_bureau = 'AL', '&' || i_sar_major_peril || '&&' || i_sar_type_bureau || '&&&&&&&' || SUBSTR(i_sar_code_5, 1, 1) || '&',\n\t    i_sar_major_peril IN ('115','116') and i_sar_type_bureau = 'AL', '&' || i_sar_major_peril || '&&' || i_sar_type_bureau || '&&&&&&&' || \n\t    IFF(\n\t        LENGTH(i_sar_code_5) > 1, SUBSTR(i_sar_code_5, 2, 1), i_sar_code_5\n\t    ) || '&',\n\t    i_sar_major_peril IN ('118','119') and i_sar_type_bureau = 'AL', '&' || i_sar_major_peril || '&&' || i_sar_type_bureau || '&&&&&&&&' || i_sar_code_6,\n\t    i_sar_major_peril = '130' and i_sar_type_bureau = 'AN', '&' || i_sar_major_peril || '&&' || i_sar_type_bureau || '&&&&' || i_sar_code_1 || '&' || i_sar_code_2 || '&&&',\n\t    NULL\n\t) AS o_lkp_condition\n\tFROM SQ_pif_4514_stage\n),\nLKP_SupCoverageLimtRule AS (\n\tSELECT\n\tCoverageLimitType,\n\tCoverageLimitvalue,\n\ti_lkp_con,\n\tlkp_con\n\tFROM (\n\t\tselect \r\n\t\tCoveragelimittype as  CoverageLimitType,coveragelimitvalue as CoverageLimitvalue,\r\n\t\t(isnull(InsuranceLine,'')+'&'\r\n\t\t+isnull(MajorPerilCode,'')+'&'\r\n\t\t+isnull(RiskUnitGroup,'')+'&'\r\n\t\t+isnull(TypeBureauCode,'')+'&'\r\n\t\t+ISNULL(RiskUnit,'')+'&'\r\n\t\t+isnull(ClassCode,'')+'&'\r\n\t\t+isnull(MajorPerilSequenceNumber,'')+'&'\r\n\t\t+isnull(PMSBureauCode1,'')+'&'\r\n\t\t+isnull(PMSBureauCode2,'')+'&'\r\n\t\t+isnull(PMSBureauCode3,'')+'&'\r\n\t\t+isnull(PMSBureauCode5,'')+'&'\r\n\t\t+isnull(PMSBureauCode6,'')) as lkp_con \r\n\t\tfrom @{pipeline().parameters.TARGET_TABLE_OWNER}.SupCoverageLimtRule\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY lkp_con ORDER BY CoverageLimitType) = 1\n),\nEXP_Assign_Value_4514 AS (\n\tSELECT\n\tLKP_SupCoverageLimtRule.CoverageLimitType AS i_type,\n\tLKP_SupCoverageLimtRule.CoverageLimitvalue AS i_CoverageLimitvalue,\n\tSQ_pif_4514_stage.sar_exposure AS i_sar_exposure,\n\t-- *INF*: IIF(ISNULL(i_CoverageLimitvalue) OR IS_SPACES(i_CoverageLimitvalue) OR LENGTH(i_CoverageLimitvalue)=0,'0',LTRIM(RTRIM(i_CoverageLimitvalue)))\n\tIFF(\n\t    i_CoverageLimitvalue IS NULL\n\t    or LENGTH(i_CoverageLimitvalue)>0\n\t    and TRIM(i_CoverageLimitvalue)=''\n\t    or LENGTH(i_CoverageLimitvalue) = 0,\n\t    '0',\n\t    LTRIM(RTRIM(i_CoverageLimitvalue))\n\t) AS v_CoverageLimitvalue,\n\t-- *INF*: TO_CHAR(i_sar_exposure)\n\tTO_CHAR(i_sar_exposure) AS v_sar_exposure,\n\tEXP_Set_Lookup_Conditions.pif_4514_stage_id,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_type)\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_type) AS o_type,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- NOT ISNULL(i_CoverageLimitvalue) AND NOT ISNULL(i_type),v_CoverageLimitvalue,\r\n\t-- NOT ISNULL(i_type),v_sar_exposure,'0')\n\tDECODE(\n\t    TRUE,\n\t    i_CoverageLimitvalue IS NULL AND i_type IS NOT NOT NULL, v_CoverageLimitvalue,\n\t    i_type IS NOT NULL, v_sar_exposure,\n\t    '0'\n\t) AS o_value\n\tFROM EXP_Set_Lookup_Conditions\n\t -- Manually join with SQ_pif_4514_stage\n\tLEFT JOIN LKP_SupCoverageLimtRule\n\tON LKP_SupCoverageLimtRule.lkp_con = EXP_Set_Lookup_Conditions.o_lkp_condition\n),\nRTR_EPLI AS (\n\tSELECT\n\tpif_4514_stage_id,\n\tpif_symbol AS pol_sym,\n\tpif_policy_number AS pol_num,\n\tpif_module AS pol_mod,\n\tsar_insurance_line,\n\tsar_risk_unit_group,\n\tsar_unit\n\tFROM SQ_pif_4514_stage\n),\nRTR_EPLI_EachRelatedWrongfulEmploymentPractice AS (SELECT * FROM RTR_EPLI WHERE ((sar_insurance_line='GA' and sar_risk_unit_group='417') OR\r\n(sar_insurance_line='GA' and sar_risk_unit_group='418') OR\r\n(sar_insurance_line='GL' and sar_unit = '22222') OR\r\n(sar_insurance_line='GL' and sar_unit = '22250') OR\r\n(sar_insurance_line='BP' and sar_risk_unit_group='366') OR\r\n(sar_insurance_line='BP' and sar_risk_unit_group='367') ) \r\nAND \r\n1=1),\nRTR_EPLI_AggregateLimit AS (SELECT * FROM RTR_EPLI WHERE ((sar_insurance_line='GA' and sar_risk_unit_group='417') OR\r\n(sar_insurance_line='GA' and sar_risk_unit_group='418') OR\r\n(sar_insurance_line='GL' and sar_unit = '22222') OR\r\n(sar_insurance_line='GL' and sar_unit = '22250') OR\r\n(sar_insurance_line='BP' and sar_risk_unit_group='366') OR\r\n(sar_insurance_line='BP' and sar_risk_unit_group='367') ) \r\nAND \r\n2=2),\nEXP_EPLI_AggregateLimit AS (\n\tSELECT\n\tpif_4514_stage_id,\n\tpol_sym,\n\tpol_num,\n\tpol_mod,\n\tsar_insurance_line,\n\tsar_risk_unit_group,\n\tsar_unit,\n\t'AGGREGATE LIMIT' AS o_LimitType,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- (sar_insurance_line='GA' and sar_risk_unit_group='417') , '100000',\r\n\t-- (sar_insurance_line='GA' and sar_risk_unit_group='418') ,'250000',\r\n\t-- (sar_insurance_line='GL' and sar_unit = '22222') , '100000',\r\n\t-- (sar_insurance_line='GL' and sar_unit = '22250'),'250000',\r\n\t-- (sar_insurance_line='BP' and sar_risk_unit_group='366') , '100000',\r\n\t-- (sar_insurance_line='BP' and sar_risk_unit_group='367') ,'250000',\r\n\t-- 'N/A')\r\n\t-- \n\tDECODE(\n\t    TRUE,\n\t    (sar_insurance_line = 'GA' and sar_risk_unit_group = '417'), '100000',\n\t    (sar_insurance_line = 'GA' and sar_risk_unit_group = '418'), '250000',\n\t    (sar_insurance_line = 'GL' and sar_unit = '22222'), '100000',\n\t    (sar_insurance_line = 'GL' and sar_unit = '22250'), '250000',\n\t    (sar_insurance_line = 'BP' and sar_risk_unit_group = '366'), '100000',\n\t    (sar_insurance_line = 'BP' and sar_risk_unit_group = '367'), '250000',\n\t    'N/A'\n\t) AS o_LimitValue\n\tFROM RTR_EPLI_AggregateLimit\n),\nEXP_EPLI_EachRelatedWrongfulEmploymentPractice AS (\n\tSELECT\n\tpif_4514_stage_id AS pif_4514_stage_id1,\n\tpol_sym,\n\tpol_num,\n\tpol_mod,\n\tsar_insurance_line,\n\tsar_risk_unit_group,\n\tsar_unit,\n\t'EachRelatedWrongfulEmploymentPractice' AS o_LimitType,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- (sar_insurance_line='GA' and sar_risk_unit_group='417') , '100000',\r\n\t-- (sar_insurance_line='GA' and sar_risk_unit_group='418') ,'250000',\r\n\t-- (sar_insurance_line='GL' and sar_unit = '22222') , '100000',\r\n\t-- (sar_insurance_line='GL' and sar_unit = '22250'),'250000',\r\n\t-- (sar_insurance_line='BP' and sar_risk_unit_group='366') , '100000',\r\n\t-- (sar_insurance_line='BP' and sar_risk_unit_group='367') ,'250000',\r\n\t-- 'N/A')\r\n\t-- \n\tDECODE(\n\t    TRUE,\n\t    (sar_insurance_line = 'GA' and sar_risk_unit_group = '417'), '100000',\n\t    (sar_insurance_line = 'GA' and sar_risk_unit_group = '418'), '250000',\n\t    (sar_insurance_line = 'GL' and sar_unit = '22222'), '100000',\n\t    (sar_insurance_line = 'GL' and sar_unit = '22250'), '250000',\n\t    (sar_insurance_line = 'BP' and sar_risk_unit_group = '366'), '100000',\n\t    (sar_insurance_line = 'BP' and sar_risk_unit_group = '367'), '250000',\n\t    'N/A'\n\t) AS o_LimitValue\n\tFROM RTR_EPLI_EachRelatedWrongfulEmploymentPractice\n),\nSQ_Pif351Stage AS (\n\tSELECT\n\t\tPifSymbol,\n\t\tPifPolicyNumber,\n\t\tPifModule,\n\t\tUnitNum,\n\t\tVehicleCoverageCode1,\n\t\tVehicleCoverageCode2,\n\t\tVehicleCoverageCode3,\n\t\tVehicleCoverageCode4,\n\t\tVehicleCoverageCode5,\n\t\tVehicleCoverageCode6,\n\t\tVehicleCoverageCode7,\n\t\tVehicleCoverageCode8,\n\t\tVehicleCoverageCode9,\n\t\tVehicleCoverageCode10,\n\t\tVehicleCoverageCode11,\n\t\tVehicleCoverageCode12,\n\t\tVehicleCoverageCode13,\n\t\tVehicleCoverageCode14,\n\t\tVehicleCoverageLimit1,\n\t\tVehicleCoverageLimit2,\n\t\tVehicleCoverageLimit3,\n\t\tVehicleCoverageLimit4,\n\t\tVehicleCoverageLimit5,\n\t\tVehicleCoverageLimit6,\n\t\tVehicleCoverageLimit7,\n\t\tVehicleCoverageLimit8,\n\t\tVehicleCoverageLimit9,\n\t\tVehicleCoverageLimit10,\n\t\tVehicleCoverageLimit11,\n\t\tVehicleCoverageLimit12,\n\t\tVehicleCoverageLimit13,\n\t\tVehicleCoverageLimit14\n\tFROM Pif351Stage\n\tWHERE Pif351Stage.UnitNum>=52\n),\nNRM_CA_Limit AS (\n),\nEXP_CA_DefaultValue AS (\n\tSELECT\n\tPifSymbol,\n\tPifPolicyNumber,\n\tPifModule,\n\tUnitNum AS i_UnitNum,\n\t-- *INF*: LPAD(TO_CHAR(i_UnitNum),3,'0')\n\tLPAD(TO_CHAR(i_UnitNum), 3, '0') AS o_UnitNum,\n\tVehicleCoverageCode,\n\tVehicleCoverageLimit AS i_VehicleCoverageLimit,\n\t-- *INF*: LTRIM(RTRIM(i_VehicleCoverageLimit))\n\tLTRIM(RTRIM(i_VehicleCoverageLimit)) AS o_VehicleCoverageLimit\n\tFROM NRM_CA_Limit\n),\nJNR_CA AS (SELECT\n\tEXP_CA_DefaultValue.PifSymbol, \n\tEXP_CA_DefaultValue.PifPolicyNumber, \n\tEXP_CA_DefaultValue.PifModule, \n\tEXP_CA_DefaultValue.o_UnitNum AS UnitNum, \n\tEXP_CA_DefaultValue.VehicleCoverageCode, \n\tEXP_CA_DefaultValue.o_VehicleCoverageLimit AS VehicleCoverageLimit, \n\tSQ_pif_4514_stage.pif_4514_stage_id, \n\tSQ_pif_4514_stage.pif_symbol AS pol_sym, \n\tSQ_pif_4514_stage.pif_policy_number AS pol_num, \n\tSQ_pif_4514_stage.pif_module AS pol_mod, \n\tSQ_pif_4514_stage.sar_unit, \n\tSQ_pif_4514_stage.sar_seq_no, \n\tSQ_pif_4514_stage.sar_state\n\tFROM SQ_pif_4514_stage\n\tINNER JOIN EXP_CA_DefaultValue\n\tON EXP_CA_DefaultValue.PifSymbol = SQ_pif_4514_stage.pif_symbol AND EXP_CA_DefaultValue.PifPolicyNumber = SQ_pif_4514_stage.pif_policy_number AND EXP_CA_DefaultValue.PifModule = SQ_pif_4514_stage.pif_module AND EXP_CA_DefaultValue.o_UnitNum = SQ_pif_4514_stage.sar_unit AND EXP_CA_DefaultValue.VehicleCoverageCode = SQ_pif_4514_stage.sar_seq_no\n),\nEXP_TRANS_CA AS (\n\tSELECT\n\tVehicleCoverageCode AS i_VehicleCoverageCode,\n\tVehicleCoverageLimit AS i_VehicleCoverageLimit,\n\tpif_4514_stage_id AS i_pif_4514_stage_id,\n\tsar_state AS i_sar_state,\n\t-- *INF*: LTRIM(RTRIM(i_VehicleCoverageLimit))\n\tLTRIM(RTRIM(i_VehicleCoverageLimit)) AS v_VehicleCoverageLimit,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_VehicleCoverageCode='01','CombinedSingleLimit',\r\n\t-- i_VehicleCoverageCode='07','MedicalPaymentLimit',\r\n\t-- i_VehicleCoverageCode='08','UninsuredMotoristSingleLimit',\r\n\t-- i_VehicleCoverageCode='09','UninsuredMotoristSplitLimit',\r\n\t-- i_VehicleCoverageCode='12','UnderinsuredMotoristSingleLimit',\r\n\t-- i_VehicleCoverageCode='13','UnderinsuredMotoristSplitLimit',\r\n\t-- i_VehicleCoverageCode='11','UninsuredMotoristPropertyDamage',\r\n\t-- i_VehicleCoverageCode='14' AND i_sar_state='22' AND IN(i_VehicleCoverageLimit,'Y','AY'),'PersonalInjuryProtectionBasicLimit',\r\n\t-- i_VehicleCoverageCode='14' AND i_sar_state='22' AND IN(i_VehicleCoverageLimit,'50','60','70','75','A50','A60','A70','A75'),'PersonalInjuryProtectionExcessLimit',\r\n\t-- i_VehicleCoverageCode='14' AND i_sar_state='15' AND i_VehicleCoverageLimit='Y','PersonalInjuryProtectionBasicLimit',\r\n\t-- i_VehicleCoverageCode='14' AND i_sar_state='15' AND IN(i_VehicleCoverageLimit,'12','27'),'PersonalInjuryProtectionExcessLimit',\r\n\t-- i_VehicleCoverageCode='14' AND i_sar_state='16' AND i_VehicleCoverageLimit='Y','PersonalInjuryProtectionBasicLimit',\r\n\t-- i_VehicleCoverageCode='14' AND i_sar_state='16' AND IN(i_VehicleCoverageLimit,'10','20','30','40','65','90'),'PersonalInjuryProtectionExcessLimit',\r\n\t-- 'N/A'\r\n\t-- )\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- --DECODE(TRUE,\r\n\t-- --i_VehicleCoverageCode='01','CombinedSingleLimit',\r\n\t-- --i_VehicleCoverageCode='07','MedicalPaymentLimit',\r\n\t-- --i_VehicleCoverageCode='08','UninsuredMotoristSingleLimit',\r\n\t-- --i_VehicleCoverageCode='09','UninsuredMotoristSplitLimit',\r\n\t-- --i_VehicleCoverageCode='12','UnderinsuredMotoristSingleLimit',\r\n\t-- --i_VehicleCoverageCode='13','UnderinsuredMotoristSplitLimit',\r\n\t-- --i_VehicleCoverageCode='11','UninsuredMotoristPropertyDamage',\r\n\t-- --i_VehicleCoverageCode='14' AND i_sar_state='22' AND SUBSTR(i_VehicleCoverageLimit,1,1)='A','PersonalInjuryProtectionLimitWithStacking',\r\n\t-- --i_VehicleCoverageCode='14' AND i_sar_state='22','PersonalInjuryProtectionLimitWithoutStacking',\r\n\t-- --i_VehicleCoverageCode='14' AND i_sar_state='15','PersonalInjuryProtectionLimitWithStacking',\r\n\t-- --i_VehicleCoverageCode='14' AND i_sar_state='16','PersonalInjuryProtectionLimit',\r\n\t-- --i_VehicleCoverageCode='14' AND i_sar_state='21','PersonalInjuryProtectionLimit',\r\n\t-- --'N/A')\n\tDECODE(\n\t    TRUE,\n\t    i_VehicleCoverageCode = '01', 'CombinedSingleLimit',\n\t    i_VehicleCoverageCode = '07', 'MedicalPaymentLimit',\n\t    i_VehicleCoverageCode = '08', 'UninsuredMotoristSingleLimit',\n\t    i_VehicleCoverageCode = '09', 'UninsuredMotoristSplitLimit',\n\t    i_VehicleCoverageCode = '12', 'UnderinsuredMotoristSingleLimit',\n\t    i_VehicleCoverageCode = '13', 'UnderinsuredMotoristSplitLimit',\n\t    i_VehicleCoverageCode = '11', 'UninsuredMotoristPropertyDamage',\n\t    i_VehicleCoverageCode = '14' AND i_sar_state = '22' AND i_VehicleCoverageLimit IN ('Y','AY'), 'PersonalInjuryProtectionBasicLimit',\n\t    i_VehicleCoverageCode = '14' AND i_sar_state = '22' AND i_VehicleCoverageLimit IN ('50','60','70','75','A50','A60','A70','A75'), 'PersonalInjuryProtectionExcessLimit',\n\t    i_VehicleCoverageCode = '14' AND i_sar_state = '15' AND i_VehicleCoverageLimit = 'Y', 'PersonalInjuryProtectionBasicLimit',\n\t    i_VehicleCoverageCode = '14' AND i_sar_state = '15' AND i_VehicleCoverageLimit IN ('12','27'), 'PersonalInjuryProtectionExcessLimit',\n\t    i_VehicleCoverageCode = '14' AND i_sar_state = '16' AND i_VehicleCoverageLimit = 'Y', 'PersonalInjuryProtectionBasicLimit',\n\t    i_VehicleCoverageCode = '14' AND i_sar_state = '16' AND i_VehicleCoverageLimit IN ('10','20','30','40','65','90'), 'PersonalInjuryProtectionExcessLimit',\n\t    'N/A'\n\t) AS o_LimitType,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_VehicleCoverageCode='01',\r\n\t-- DECODE(TRUE,\r\n\t-- v_VehicleCoverageLimit='25','25000',\r\n\t-- v_VehicleCoverageLimit='30','30000',\r\n\t-- v_VehicleCoverageLimit='40','40000',\r\n\t-- v_VehicleCoverageLimit='50','50000',\r\n\t-- v_VehicleCoverageLimit='75','75000',\r\n\t-- v_VehicleCoverageLimit='100','100000',\r\n\t-- v_VehicleCoverageLimit='150','150000',\r\n\t-- v_VehicleCoverageLimit='200','200000',\r\n\t-- v_VehicleCoverageLimit='250','250000',\r\n\t-- v_VehicleCoverageLimit='300','300000',\r\n\t-- v_VehicleCoverageLimit='400','400000',\r\n\t-- v_VehicleCoverageLimit='500','500000',\r\n\t-- v_VehicleCoverageLimit='750','750000',\r\n\t-- v_VehicleCoverageLimit='1M','1000000',\r\n\t-- v_VehicleCoverageLimit='100A','100000 Option A',\r\n\t-- v_VehicleCoverageLimit='100B','100000 Option B',\r\n\t-- v_VehicleCoverageLimit='100C','100000 Option C',\r\n\t-- v_VehicleCoverageLimit='300A','300000 Option A',\r\n\t-- v_VehicleCoverageLimit='300B','300000 Option B',\r\n\t-- v_VehicleCoverageLimit='300C','300000 Option C',\r\n\t-- v_VehicleCoverageLimit='500A','500000 Option A',\r\n\t-- v_VehicleCoverageLimit='500B','500000 Option B',\r\n\t-- v_VehicleCoverageLimit='500C','500000 Option C',\r\n\t-- v_VehicleCoverageLimit='750A','750000 Option A',\r\n\t-- v_VehicleCoverageLimit='750B','750000 Option B',\r\n\t-- v_VehicleCoverageLimit='750C','750000 Option C',\r\n\t-- v_VehicleCoverageLimit='1MA','1000000 Option A',\r\n\t-- v_VehicleCoverageLimit='1MB','1000000 Option B',\r\n\t-- v_VehicleCoverageLimit='1MC','1000000 Option C',\r\n\t-- 'N/A'\r\n\t-- ),\r\n\t-- \r\n\t-- i_VehicleCoverageCode='07',\r\n\t-- DECODE(TRUE,\r\n\t-- v_VehicleCoverageLimit='500','500',\r\n\t-- v_VehicleCoverageLimit='1','1000',\r\n\t-- v_VehicleCoverageLimit='2','2000',\r\n\t-- v_VehicleCoverageLimit='5','5000',\r\n\t-- v_VehicleCoverageLimit='10','10000',\r\n\t-- 'N/A'),\r\n\t-- \r\n\t-- IN(i_VehicleCoverageCode,'08','12'),\r\n\t-- DECODE(TRUE,\r\n\t-- v_VehicleCoverageLimit='30','30000',\r\n\t-- v_VehicleCoverageLimit='40','40000',\r\n\t-- v_VehicleCoverageLimit='50','50000',\r\n\t-- v_VehicleCoverageLimit='55','55000',\r\n\t-- v_VehicleCoverageLimit='60','60000',\r\n\t-- v_VehicleCoverageLimit='75','75000',\r\n\t-- v_VehicleCoverageLimit='100','100000',\r\n\t-- v_VehicleCoverageLimit='200','200000',\r\n\t-- v_VehicleCoverageLimit='250','250000',\r\n\t-- v_VehicleCoverageLimit='300','300000',\r\n\t-- v_VehicleCoverageLimit='350','350000',\r\n\t-- v_VehicleCoverageLimit='500','500000',\r\n\t-- v_VehicleCoverageLimit='600','600000',\r\n\t-- v_VehicleCoverageLimit='750','750000',\r\n\t-- v_VehicleCoverageLimit='1M','1000000',\r\n\t-- 'N/A'\r\n\t-- ),\r\n\t-- \r\n\t-- IN(i_VehicleCoverageCode,'09','13'),\r\n\t-- DECODE(TRUE,\r\n\t-- v_VehicleCoverageLimit='15-30','15000/30000',\r\n\t-- v_VehicleCoverageLimit='20-40','20000/40000',\r\n\t-- v_VehicleCoverageLimit='25-50','25000/50000',\r\n\t-- v_VehicleCoverageLimit='30-60','30000/60000',\r\n\t-- v_VehicleCoverageLimit='50-100','50000/100000',\r\n\t-- v_VehicleCoverageLimit='100-300','100000/300000',\r\n\t-- v_VehicleCoverageLimit='250-500','250000/500000',\r\n\t-- v_VehicleCoverageLimit='300-300','300000/300000',\r\n\t-- v_VehicleCoverageLimit='300-500','300000/500000',\r\n\t-- v_VehicleCoverageLimit='500-500','500000/500000',\r\n\t-- v_VehicleCoverageLimit='500-1M','500000/1000000',\r\n\t-- v_VehicleCoverageLimit='1M-1M','1000000/1000000',\r\n\t-- 'N/A'),\r\n\t-- \r\n\t-- \r\n\t-- i_VehicleCoverageCode='11',\r\n\t-- DECODE(TRUE,\r\n\t-- v_VehicleCoverageLimit='7.5','7500',\r\n\t-- v_VehicleCoverageLimit='15','15000',\r\n\t-- v_VehicleCoverageLimit='60P','60000',\r\n\t-- v_VehicleCoverageLimit='100P','100000',\r\n\t-- v_VehicleCoverageLimit='250P','250000',\r\n\t-- IN(v_VehicleCoverageLimit,'300','300P'),'300000',\r\n\t-- v_VehicleCoverageLimit='350P','350000',\r\n\t-- v_VehicleCoverageLimit='500P','500000',\r\n\t-- v_VehicleCoverageLimit='750P','750000',\r\n\t-- v_VehicleCoverageLimit='1MP','1000000',\r\n\t-- 'N/A'),\r\n\t-- \r\n\t-- i_VehicleCoverageCode='14' AND i_sar_state='22',\r\n\t-- DECODE(TRUE,\r\n\t-- IN(v_VehicleCoverageLimit,'Y','AY'),'40000',\r\n\t-- IN(v_VehicleCoverageLimit,'50','A50'),'50000',\r\n\t-- IN(v_VehicleCoverageLimit,'60','A60'),'60000',\r\n\t-- IN(v_VehicleCoverageLimit,'70','A70'),'70000',\r\n\t-- IN(v_VehicleCoverageLimit,'75','A75'),'75000',\r\n\t-- 'N/A'),\r\n\t-- \r\n\t-- i_VehicleCoverageCode='14' AND i_sar_state='15',\r\n\t-- DECODE(TRUE,\r\n\t-- v_VehicleCoverageLimit='Y','0',\r\n\t-- v_VehicleCoverageLimit='12','12500',\r\n\t-- v_VehicleCoverageLimit='27','27500',\r\n\t-- 'N/A'),\r\n\t-- \r\n\t-- i_VehicleCoverageCode='14' AND i_sar_state='16',\r\n\t-- DECODE(TRUE,\r\n\t-- v_VehicleCoverageLimit='Y','10000',  \r\n\t-- v_VehicleCoverageLimit='10','10000',\r\n\t-- v_VehicleCoverageLimit='20','20000',\r\n\t-- v_VehicleCoverageLimit='30','30000',\r\n\t-- v_VehicleCoverageLimit='40','40000',\r\n\t-- v_VehicleCoverageLimit='65','65000',\r\n\t-- v_VehicleCoverageLimit='90','90000',\r\n\t-- 'N/A'),\r\n\t-- 'N/A'\r\n\t-- )\n\tDECODE(\n\t    TRUE,\n\t    i_VehicleCoverageCode = '01', DECODE(\n\t        TRUE,\n\t        v_VehicleCoverageLimit = '25', '25000',\n\t        v_VehicleCoverageLimit = '30', '30000',\n\t        v_VehicleCoverageLimit = '40', '40000',\n\t        v_VehicleCoverageLimit = '50', '50000',\n\t        v_VehicleCoverageLimit = '75', '75000',\n\t        v_VehicleCoverageLimit = '100', '100000',\n\t        v_VehicleCoverageLimit = '150', '150000',\n\t        v_VehicleCoverageLimit = '200', '200000',\n\t        v_VehicleCoverageLimit = '250', '250000',\n\t        v_VehicleCoverageLimit = '300', '300000',\n\t        v_VehicleCoverageLimit = '400', '400000',\n\t        v_VehicleCoverageLimit = '500', '500000',\n\t        v_VehicleCoverageLimit = '750', '750000',\n\t        v_VehicleCoverageLimit = '1M', '1000000',\n\t        v_VehicleCoverageLimit = '100A', '100000 Option A',\n\t        v_VehicleCoverageLimit = '100B', '100000 Option B',\n\t        v_VehicleCoverageLimit = '100C', '100000 Option C',\n\t        v_VehicleCoverageLimit = '300A', '300000 Option A',\n\t        v_VehicleCoverageLimit = '300B', '300000 Option B',\n\t        v_VehicleCoverageLimit = '300C', '300000 Option C',\n\t        v_VehicleCoverageLimit = '500A', '500000 Option A',\n\t        v_VehicleCoverageLimit = '500B', '500000 Option B',\n\t        v_VehicleCoverageLimit = '500C', '500000 Option C',\n\t        v_VehicleCoverageLimit = '750A', '750000 Option A',\n\t        v_VehicleCoverageLimit = '750B', '750000 Option B',\n\t        v_VehicleCoverageLimit = '750C', '750000 Option C',\n\t        v_VehicleCoverageLimit = '1MA', '1000000 Option A',\n\t        v_VehicleCoverageLimit = '1MB', '1000000 Option B',\n\t        v_VehicleCoverageLimit = '1MC', '1000000 Option C',\n\t        'N/A'\n\t    ),\n\t    i_VehicleCoverageCode = '07', DECODE(\n\t        TRUE,\n\t        v_VehicleCoverageLimit = '500', '500',\n\t        v_VehicleCoverageLimit = '1', '1000',\n\t        v_VehicleCoverageLimit = '2', '2000',\n\t        v_VehicleCoverageLimit = '5', '5000',\n\t        v_VehicleCoverageLimit = '10', '10000',\n\t        'N/A'\n\t    ),\n\t    i_VehicleCoverageCode IN ('08','12'), DECODE(\n\t        TRUE,\n\t        v_VehicleCoverageLimit = '30', '30000',\n\t        v_VehicleCoverageLimit = '40', '40000',\n\t        v_VehicleCoverageLimit = '50', '50000',\n\t        v_VehicleCoverageLimit = '55', '55000',\n\t        v_VehicleCoverageLimit = '60', '60000',\n\t        v_VehicleCoverageLimit = '75', '75000',\n\t        v_VehicleCoverageLimit = '100', '100000',\n\t        v_VehicleCoverageLimit = '200', '200000',\n\t        v_VehicleCoverageLimit = '250', '250000',\n\t        v_VehicleCoverageLimit = '300', '300000',\n\t        v_VehicleCoverageLimit = '350', '350000',\n\t        v_VehicleCoverageLimit = '500', '500000',\n\t        v_VehicleCoverageLimit = '600', '600000',\n\t        v_VehicleCoverageLimit = '750', '750000',\n\t        v_VehicleCoverageLimit = '1M', '1000000',\n\t        'N/A'\n\t    ),\n\t    i_VehicleCoverageCode IN ('09','13'), DECODE(\n\t        TRUE,\n\t        v_VehicleCoverageLimit = '15-30', '15000/30000',\n\t        v_VehicleCoverageLimit = '20-40', '20000/40000',\n\t        v_VehicleCoverageLimit = '25-50', '25000/50000',\n\t        v_VehicleCoverageLimit = '30-60', '30000/60000',\n\t        v_VehicleCoverageLimit = '50-100', '50000/100000',\n\t        v_VehicleCoverageLimit = '100-300', '100000/300000',\n\t        v_VehicleCoverageLimit = '250-500', '250000/500000',\n\t        v_VehicleCoverageLimit = '300-300', '300000/300000',\n\t        v_VehicleCoverageLimit = '300-500', '300000/500000',\n\t        v_VehicleCoverageLimit = '500-500', '500000/500000',\n\t        v_VehicleCoverageLimit = '500-1M', '500000/1000000',\n\t        v_VehicleCoverageLimit = '1M-1M', '1000000/1000000',\n\t        'N/A'\n\t    ),\n\t    i_VehicleCoverageCode = '11', DECODE(\n\t        TRUE,\n\t        v_VehicleCoverageLimit = '7.5', '7500',\n\t        v_VehicleCoverageLimit = '15', '15000',\n\t        v_VehicleCoverageLimit = '60P', '60000',\n\t        v_VehicleCoverageLimit = '100P', '100000',\n\t        v_VehicleCoverageLimit = '250P', '250000',\n\t        v_VehicleCoverageLimit IN ('300','300P'), '300000',\n\t        v_VehicleCoverageLimit = '350P', '350000',\n\t        v_VehicleCoverageLimit = '500P', '500000',\n\t        v_VehicleCoverageLimit = '750P', '750000',\n\t        v_VehicleCoverageLimit = '1MP', '1000000',\n\t        'N/A'\n\t    ),\n\t    i_VehicleCoverageCode = '14' AND i_sar_state = '22', DECODE(\n\t        TRUE,\n\t        v_VehicleCoverageLimit IN ('Y','AY'), '40000',\n\t        v_VehicleCoverageLimit IN ('50','A50'), '50000',\n\t        v_VehicleCoverageLimit IN ('60','A60'), '60000',\n\t        v_VehicleCoverageLimit IN ('70','A70'), '70000',\n\t        v_VehicleCoverageLimit IN ('75','A75'), '75000',\n\t        'N/A'\n\t    ),\n\t    i_VehicleCoverageCode = '14' AND i_sar_state = '15', DECODE(\n\t        TRUE,\n\t        v_VehicleCoverageLimit = 'Y', '0',\n\t        v_VehicleCoverageLimit = '12', '12500',\n\t        v_VehicleCoverageLimit = '27', '27500',\n\t        'N/A'\n\t    ),\n\t    i_VehicleCoverageCode = '14' AND i_sar_state = '16', DECODE(\n\t        TRUE,\n\t        v_VehicleCoverageLimit = 'Y', '10000',\n\t        v_VehicleCoverageLimit = '10', '10000',\n\t        v_VehicleCoverageLimit = '20', '20000',\n\t        v_VehicleCoverageLimit = '30', '30000',\n\t        v_VehicleCoverageLimit = '40', '40000',\n\t        v_VehicleCoverageLimit = '65', '65000',\n\t        v_VehicleCoverageLimit = '90', '90000',\n\t        'N/A'\n\t    ),\n\t    'N/A'\n\t) AS o_LimitValue,\n\ti_pif_4514_stage_id AS o_pif_4514_state_id\n\tFROM JNR_CA\n),\nSQ_Pif43RXGLStage AS (\n\tSELECT\r\n\tPif43RXGLStage.Pmdrxg1FringeLimit1,\r\n\tPif43RXGLStage.Pmdrxg1FringeLimit2,\r\n\tPif43RXGLStage.Pmdrxg1FringeLimit3,\r\n\tPif43RXGLStage.Pmdrxg1VolPdOcc,\r\n\tPif43RXGLStage.Pmdrxg1VolPdAgg,\r\n\tpif_4514_stage.pif_4514_stage_id\r\n\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.pif_4514_stage pif_4514_stage\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Pif43RXGLStage Pif43RXGLStage\r\n\tON pif_4514_stage.pif_symbol=Pif43RXGLStage.PifSymbol\r\n\tand pif_4514_stage.pif_module=Pif43RXGLStage.PifModule\r\n\tand pif_4514_stage.pif_policy_number=Pif43RXGLStage.pifpolicynumber\r\n\tand  Pif43RXGLStage.Pmdrxg1PmsDefGlSubline=pif_4514_stage.sar_risk_unit_group\r\n\tand Pif43RXGLStage.Pmdrxg1RiskTypeInd=substring(pif_4514_stage.sar_seq_rsk_unt_a,2,1)\r\n\tand pif_4514_stage.sar_insurance_line='GL'\r\n\tWHERE pif_4514_stage.logical_flag IN ('0','1','2','3')\r\n\t@{pipeline().parameters.WHERE_CLAUSE_RXGL}\n),\nEXP_Values_RXGL AS (\n\tSELECT\n\tPmdrxg1FringeLimit1 AS i_Pmdrxg1FringeLimit1,\n\tPmdrxg1FringeLimit2 AS i_Pmdrxg1FringeLimit2,\n\tPmdrxg1FringeLimit3 AS i_Pmdrxg1FringeLimit3,\n\tPmdrxg1VolPdOcc AS i_Pmdrxg1VolPdOcc,\n\tPmdrxg1VolPdAgg AS i_Pmdrxg1VolPdAgg,\n\tpif_4514_stage_id,\n\t'MedicalPaymentLimit' AS o_type1,\n\t-- *INF*: IIF(ISNULL(i_Pmdrxg1FringeLimit1) OR LENGTH(i_Pmdrxg1FringeLimit1)=0 OR IS_SPACES(i_Pmdrxg1FringeLimit1) OR NOT IS_NUMBER(i_Pmdrxg1FringeLimit1),'0',TO_CHAR(TO_DECIMAL(i_Pmdrxg1FringeLimit1)))\n\tIFF(\n\t    i_Pmdrxg1FringeLimit1 IS NULL\n\t    or LENGTH(i_Pmdrxg1FringeLimit1) = 0\n\t    or LENGTH(i_Pmdrxg1FringeLimit1)>0\n\t    and TRIM(i_Pmdrxg1FringeLimit1)=''\n\t    or NOT REGEXP_LIKE(i_Pmdrxg1FringeLimit1, '^[0-9]+$'),\n\t    '0',\n\t    TO_CHAR(CAST(i_Pmdrxg1FringeLimit1 AS FLOAT))\n\t) AS o_value1,\n\t'DamageToPremisesRentedToYouLimit' AS o_type2,\n\t-- *INF*: IIF(ISNULL(i_Pmdrxg1FringeLimit2) OR LENGTH(i_Pmdrxg1FringeLimit2)=0 OR IS_SPACES(i_Pmdrxg1FringeLimit2) OR NOT IS_NUMBER(i_Pmdrxg1FringeLimit2),'0',TO_CHAR(TO_DECIMAL(i_Pmdrxg1FringeLimit2)))\n\tIFF(\n\t    i_Pmdrxg1FringeLimit2 IS NULL\n\t    or LENGTH(i_Pmdrxg1FringeLimit2) = 0\n\t    or LENGTH(i_Pmdrxg1FringeLimit2)>0\n\t    and TRIM(i_Pmdrxg1FringeLimit2)=''\n\t    or NOT REGEXP_LIKE(i_Pmdrxg1FringeLimit2, '^[0-9]+$'),\n\t    '0',\n\t    TO_CHAR(CAST(i_Pmdrxg1FringeLimit2 AS FLOAT))\n\t) AS o_value2,\n\t-- *INF*: iif(i_Pmdrxg1FringeLimit3>'0000000000','PersonalInjuryAndAdvertisingLiabilityLimit','PersonalInjuryLiabilityLimit')\n\tIFF(\n\t    i_Pmdrxg1FringeLimit3 > '0000000000', 'PersonalInjuryAndAdvertisingLiabilityLimit',\n\t    'PersonalInjuryLiabilityLimit'\n\t) AS o_type3,\n\t-- *INF*: IIF(ISNULL(i_Pmdrxg1FringeLimit3) OR LENGTH(i_Pmdrxg1FringeLimit3)=0 OR IS_SPACES(i_Pmdrxg1FringeLimit3) OR NOT IS_NUMBER(i_Pmdrxg1FringeLimit3),'0',TO_CHAR(TO_DECIMAL(i_Pmdrxg1FringeLimit3)))\n\tIFF(\n\t    i_Pmdrxg1FringeLimit3 IS NULL\n\t    or LENGTH(i_Pmdrxg1FringeLimit3) = 0\n\t    or LENGTH(i_Pmdrxg1FringeLimit3)>0\n\t    and TRIM(i_Pmdrxg1FringeLimit3)=''\n\t    or NOT REGEXP_LIKE(i_Pmdrxg1FringeLimit3, '^[0-9]+$'),\n\t    '0',\n\t    TO_CHAR(CAST(i_Pmdrxg1FringeLimit3 AS FLOAT))\n\t) AS o_value3,\n\t'VoluntaryPropertyDamageOccurrenceLimit' AS o_type4,\n\t-- *INF*: IIF(ISNULL(i_Pmdrxg1VolPdOcc),'0',TO_CHAR(i_Pmdrxg1VolPdOcc))\n\tIFF(i_Pmdrxg1VolPdOcc IS NULL, '0', TO_CHAR(i_Pmdrxg1VolPdOcc)) AS o_value4,\n\t'VoluntaryPropertyDamageAggregateLimit' AS o_type5,\n\t-- *INF*: IIF(ISNULL(i_Pmdrxg1VolPdAgg),'0',TO_CHAR(i_Pmdrxg1VolPdAgg))\n\tIFF(i_Pmdrxg1VolPdAgg IS NULL, '0', TO_CHAR(i_Pmdrxg1VolPdAgg)) AS o_value5\n\tFROM SQ_Pif43RXGLStage\n),\nNRM_Unpivot_Type_Value AS (\n),\nSQ_PifDept1553Stage AS (\n\twith PifDept1553Stage as (select PifSymbol,\r\n\tPifPolicyNumber,\r\n\tPifModule,\r\n\tDECLPTFormNumber,\r\n\tDECLPTSeqSameForm,\r\n\tDECLPTSeq0098,\r\n\tltrim(rtrim(DECLPTText1701))+' '+ltrim(rtrim(DECLPTText71791))+' '+ltrim(rtrim(DECLPTText1702))+' '+ltrim(rtrim(DECLPTText71792)) as SourceValue\r\n\tfrom @{pipeline().parameters.SOURCE_TABLE_OWNER}.PifDept1553Stage\r\n\tWHERE  LEFT(PifSymbol,2) in ('CU','NU')\r\n\tAND RIGHT(DECLPTFormNumber,2)='01' and DECLPTSeq0098 in (3,4,5,6) \r\n\tunion all\r\n\tselect PifSymbol,\r\n\tPifPolicyNumber,\r\n\tPifModule,\r\n\tDECLPTFormNumber,\r\n\tDECLPTSeqSameForm,\r\n\tDECLPTSeq0098,\r\n\tltrim(rtrim(DECLPTText1701))+' '+ltrim(rtrim(DECLPTText71791)) as SourceValue\r\n\tfrom @{pipeline().parameters.SOURCE_TABLE_OWNER}.PifDept1553Stage\r\n\tWHERE  LEFT(PifSymbol,2) in ('CU','NU') AND RIGHT(DECLPTFormNumber,2) IN ('02','03')\r\n\tunion all\r\n\tselect PifSymbol,\r\n\tPifPolicyNumber,\r\n\tPifModule,\r\n\tDECLPTFormNumber,\r\n\tDECLPTSeqSameForm,\r\n\tDECLPTSeq0098,\r\n\tltrim(rtrim(DECLPTText1702))+' '+ltrim(rtrim(DECLPTText71792))  as SourceValue\r\n\tfrom @{pipeline().parameters.SOURCE_TABLE_OWNER}.PifDept1553Stage\r\n\tWHERE  LEFT(PifSymbol,2) in ('CU','NU') AND RIGHT(DECLPTFormNumber,2) IN ('02','03')\r\n\t)\r\n\t\r\n\tselect b.pif_4514_stage_id as pif_4514_stage_id,\r\n\ta.PifSymbol as PifSymbol,\r\n\ta.PifPolicyNumber as PifPolicyNumber,\r\n\ta.PifModule as PifModule,\r\n\tltrim(rtrim(replace(replace(replace(replace(replace(replace(\r\n\tcase when charindex('EACH OCCURRENCE LIMIT',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('EACH OCCURRENCE LIMIT',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('EACH OCCURRENCE LIMIT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('EACH OCCURRENCE LIMIT',SourceValue))-1)\r\n\t\t when charindex('PER OCCURRENCE LIMIT',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PER OCCURRENCE LIMIT',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PER OCCURRENCE LIMIT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PER OCCURRENCE LIMIT',SourceValue))-1)          \r\n\t     \r\n\t\t when charindex('GENERAL AGGREGATE LIMIT',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('GENERAL AGGREGATE LIMIT',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('GENERAL AGGREGATE LIMIT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('GENERAL AGGREGATE LIMIT',SourceValue))-1)\r\n\t                \r\n\t     when charindex('GENERAL AGGREGATE',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('GENERAL AGGREGATE',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('GENERAL AGGREGATE',SourceValue)))-CHARINDEX('@',SourceValue,charindex('GENERAL AGGREGATE',SourceValue))-1)\r\n\t\r\n\t\t when charindex('UNDERINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('UNDERINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('UNDERINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('UNDERINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT',SourceValue))-1)\r\n\t\r\n\t\t when charindex('UNINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('UNINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('UNINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('UNINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT',SourceValue))-1)\r\n\t\t\t\r\n\t\t when charindex('PRODUCTS-COMPLETED OPERATIONS AGGREGATE LIMIT',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PRODUCTS-COMPLETED OPERATIONS AGGREGATE LIMIT',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PRODUCTS-COMPLETED OPERATIONS AGGREGATE LIMIT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PRODUCTS-COMPLETED OPERATIONS AGGREGATE LIMIT',SourceValue))-1)\r\n\t     \r\n\t\t when charindex('PERSONAL INJURY AND ADVERTISING INJURY LIMIT',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PERSONAL INJURY AND ADVERTISING INJURY LIMIT',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PERSONAL INJURY AND ADVERTISING INJURY LIMIT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PERSONAL INJURY AND ADVERTISING INJURY LIMIT',SourceValue))-1)\r\n\t\r\n\t\t when charindex('PERSONAL AND ADVERTISING INJURY LIMIT',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PERSONAL AND ADVERTISING INJURY LIMIT',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PERSONAL AND ADVERTISING INJURY LIMIT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PERSONAL AND ADVERTISING INJURY LIMIT',SourceValue))-1)\r\n\t\r\n\t\t when charindex('PERSONAL AND ADVERTISING INJURY',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PERSONAL AND ADVERTISING INJURY',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PERSONAL AND ADVERTISING INJURY',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PERSONAL AND ADVERTISING INJURY',SourceValue))-1)\r\n\t\r\n\t\t when charindex('PERSONAL AND ADVERTISING LIMIT',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PERSONAL AND ADVERTISING LIMIT',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PERSONAL AND ADVERTISING LIMIT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PERSONAL AND ADVERTISING LIMIT',SourceValue))-1)\r\n\t\r\n\t     when charindex('ILLINOIS AND OHIO',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('ILLINOIS AND OHIO',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('ILLINOIS AND OHIO',SourceValue)))-CHARINDEX('@',SourceValue,charindex('ILLINOIS AND OHIO',SourceValue))-1)\r\n\t\r\n\t     when charindex('EACH CLAIM LIMIT',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('EACH CLAIM LIMIT',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('EACH CLAIM LIMIT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('EACH CLAIM LIMIT',SourceValue))-1)\r\n\t\r\n\t     when charindex('AGGREGATE - GARAGE OPERATIONS OTHER THAN AUTO ONLY',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('AGGREGATE - GARAGE OPERATIONS OTHER THAN AUTO ONLY',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('AGGREGATE - GARAGE OPERATIONS OTHER THAN AUTO ONLY',SourceValue)))-CHARINDEX('@',SourceValue,charindex('AGGREGATE - GARAGE OPERATIONS OTHER THAN AUTO ONLY',SourceValue))-1)\r\n\t\r\n\t     when charindex('EACH ACCIDENT - GARAGE OPERATIONS AUTO ONLY',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('EACH ACCIDENT - GARAGE OPERATIONS AUTO ONLY',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('EACH ACCIDENT - GARAGE OPERATIONS AUTO ONLY',SourceValue)))-CHARINDEX('@',SourceValue,charindex('EACH ACCIDENT - GARAGE OPERATIONS AUTO ONLY',SourceValue))-1)\r\n\t\r\n\t     when charindex('EACH ACCIDENT - GARAGE OPERATIONS OTHER THAN AUTO ONLY',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('EACH ACCIDENT - GARAGE OPERATIONS OTHER THAN AUTO ONLY',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('EACH ACCIDENT - GARAGE OPERATIONS OTHER THAN AUTO ONLY',SourceValue)))-CHARINDEX('@',SourceValue,charindex('EACH ACCIDENT - GARAGE OPERATIONS OTHER THAN AUTO ONLY',SourceValue))-1)\r\n\t\r\n\t     when charindex('AGGREGATE LIMIT',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('AGGREGATE LIMIT',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('AGGREGATE LIMIT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('AGGREGATE LIMIT',SourceValue))-1)\r\n\t     \r\n\t     when charindex('BODILY INJURY BY ACCIDENT:  EACH ACCIDENT',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('BODILY INJURY BY ACCIDENT:  EACH ACCIDENT',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('BODILY INJURY BY ACCIDENT:  EACH ACCIDENT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('BODILY INJURY BY ACCIDENT:  EACH ACCIDENT',SourceValue))-1)\r\n\t\t \r\n\t\t when charindex('BODILY INJURY BY DISEASE:   POLICY LIMIT',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('BODILY INJURY BY DISEASE:   POLICY LIMIT',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('BODILY INJURY BY DISEASE:   POLICY LIMIT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('BODILY INJURY BY DISEASE:   POLICY LIMIT',SourceValue))-1)\r\n\t\t\r\n\t\t when charindex('BODILY INJURY BY DISEASE:   EACH EMPLOYEE',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('BODILY INJURY BY DISEASE:   EACH EMPLOYEE',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('BODILY INJURY BY DISEASE:   EACH EMPLOYEE',SourceValue)))-CHARINDEX('@',SourceValue,charindex('BODILY INJURY BY DISEASE:   EACH EMPLOYEE',SourceValue))-1)     \r\n\t\r\n\t     when charindex('PROPERTY DAMAGE-EACH ACCIDENT',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE-EACH ACCIDENT',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE-EACH ACCIDENT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE-EACH ACCIDENT',SourceValue))-1)     \r\n\t   \r\n\t     when charindex('PROPERTY DAMAGE -EACH ACCIDENT',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE -EACH ACCIDENT',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE -EACH ACCIDENT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE -EACH ACCIDENT',SourceValue))-1)     \r\n\t     \r\n\t     when charindex('PROPERTY DAMAGE- EACH ACCIDENT',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE- EACH ACCIDENT',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE- EACH ACCIDENT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE- EACH ACCIDENT',SourceValue))-1)     \r\n\t     \r\n\t     when charindex('PROPERTY DAMAGE EACH ACCIDENT',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE EACH ACCIDENT',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE EACH ACCIDENT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE EACH ACCIDENT',SourceValue))-1)     \r\n\t     \r\n\t     when charindex('PROPERTY DAMAGE: EACH ACCIDENT',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE: EACH ACCIDENT',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE: EACH ACCIDENT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE: EACH ACCIDENT',SourceValue))-1)     \r\n\t     \r\n\t     when charindex('PROPERTY DAMAGE/EACH ACCIDENT',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE/EACH ACCIDENT',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE/EACH ACCIDENT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PROPERTY DAMAGE/EACH ACCIDENT',SourceValue))-1)     \r\n\t     \r\n\t     when charindex('PD - EACH ACCIDENT',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PD - EACH ACCIDENT',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PD - EACH ACCIDENT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PD - EACH ACCIDENT',SourceValue))-1)     \r\n\t  \r\n\t     when charindex('EACH ACCIDENT-PROPERTY DAMAGE',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('EACH ACCIDENT-PROPERTY DAMAGE',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('EACH ACCIDENT-PROPERTY DAMAGE',SourceValue)))-CHARINDEX('@',SourceValue,charindex('EACH ACCIDENT-PROPERTY DAMAGE',SourceValue))-1)     \r\n\t\t\r\n\t\t when charindex('PROP DAMAGE LIAB-EACH ACCIDENT',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('PROP DAMAGE LIAB-EACH ACCIDENT',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('PROP DAMAGE LIAB-EACH ACCIDENT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('PROP DAMAGE LIAB-EACH ACCIDENT',SourceValue))-1)     \r\n\t\t\r\n\t\t when charindex('BODILY INJURY - EACH PERSON',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('BODILY INJURY - EACH PERSON',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('BODILY INJURY - EACH PERSON',SourceValue)))-CHARINDEX('@',SourceValue,charindex('BODILY INJURY - EACH PERSON',SourceValue))-1)     \r\n\t     \r\n\t\t when charindex('BODILY INJURY-EACH PERSON',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('BODILY INJURY-EACH PERSON',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('BODILY INJURY-EACH PERSON',SourceValue)))-CHARINDEX('@',SourceValue,charindex('BODILY INJURY-EACH PERSON',SourceValue))-1)     \r\n\t     \t \r\n\t\t when charindex('BODILY INJURY: EACH PERSON',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('BODILY INJURY: EACH PERSON',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('BODILY INJURY: EACH PERSON',SourceValue)))-CHARINDEX('@',SourceValue,charindex('BODILY INJURY: EACH PERSON',SourceValue))-1)     \r\n\t    \r\n\t     when charindex('EACH PERSON',SourceValue )>0 \t\t\t\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('EACH PERSON',SourceValue))+1, \t\t\t\r\n\t\t\t  CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('EACH PERSON',SourceValue)))-CHARINDEX('@',SourceValue,charindex('EACH PERSON',SourceValue))-1)\r\n\t \t  \r\n\t\t when charindex('EACH EMPLOYEE',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('EACH EMPLOYEE',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('EACH EMPLOYEE',SourceValue)))-CHARINDEX('@',SourceValue,charindex('EACH EMPLOYEE',SourceValue))-1)\r\n\t\r\n\t\t when charindex('EACH COMMON CAUSE',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('EACH COMMON CAUSE',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('EACH COMMON CAUSE',SourceValue)))-CHARINDEX('@',SourceValue,charindex('EACH COMMON CAUSE',SourceValue))-1)\r\n\t\r\n\t\t when charindex('EACH ACCIDENT',SourceValue )>0\r\n\t     then SUBSTRING(SourceValue,CHARINDEX('@',SourceValue,charindex('EACH ACCIDENT',SourceValue))+1,\r\n\t          CHARINDEX('^',SourceValue,CHARINDEX('@',SourceValue,charindex('EACH ACCIDENT',SourceValue)))-CHARINDEX('@',SourceValue,charindex('EACH ACCIDENT',SourceValue))-1)\r\n\t\r\n\t\t else 'N/A'\r\n\t\r\n\tend,',',''),' ',''),'.',''),'O','0'),'\\',''),'$','')))\t  as VALUE,\r\n\t\r\n\tcase when charindex('EACH OCCURRENCE LIMIT',SourceValue )>0\r\n\t     OR charindex('PER OCCURRENCE LIMIT',SourceValue )>0\r\n\t     then 'EACH OCCURRENCE LIMIT'\r\n\t     when charindex('UNDERINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT',SourceValue )>0\r\n\t     then 'UNDERINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT'\r\n\t     when charindex('UNINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT',SourceValue )>0\r\n\t     then 'UNINSURED MOTORISTS COVERAGE EACH ACCIDENT LIMIT'\r\n\t     when charindex('PRODUCTS-COMPLETED OPERATIONS AGGREGATE LIMIT',SourceValue )>0\r\n\t     then 'PRODUCTS-COMPLETED OPERATIONS AGGREGATE LIMIT'\r\n\t     when charindex('PERSONAL INJURY AND ADVERTISING INJURY LIMIT',SourceValue )>0\r\n\t     OR charindex('PERSONAL AND ADVERTISING INJURY LIMIT',SourceValue )>0\r\n\t     OR charindex('PERSONAL AND ADVERTISING INJURY',SourceValue )>0\r\n\t     OR charindex('PERSONAL AND ADVERTISING LIMIT',SourceValue )>0\r\n\t     then 'PERSONAL INJURY AND ADVERTISING INJURY LIMIT'\r\n\t     when charindex('ILLINOIS AND OHIO',SourceValue )>0\r\n\t     then 'ILLINOIS AND OHIO'\r\n\t     when charindex('EACH CLAIM LIMIT',SourceValue )>0\r\n\t     then 'EACH CLAIM LIMIT'\r\n\t     when charindex('AGGREGATE - GARAGE OPERATIONS OTHER THAN AUTO ONLY',SourceValue )>0\r\n\t     then 'AGGREGATE - GARAGE OPERATIONS OTHER THAN AUTO ONLY'\r\n\t     when charindex('EACH ACCIDENT - GARAGE OPERATIONS AUTO ONLY',SourceValue )>0\r\n\t     then 'EACH ACCIDENT - GARAGE OPERATIONS AUTO ONLY'\r\n\t     when charindex('EACH ACCIDENT - GARAGE OPERATIONS OTHER THAN AUTO ONLY',SourceValue )>0\r\n\t     then 'EACH ACCIDENT - GARAGE OPERATIONS OTHER THAN AUTO ONLY' \r\n\t     when charindex('AGGREGATE LIMIT',SourceValue )>0 \t\r\n\t     OR charindex('GENERAL AGGREGATE LIMIT',SourceValue )>0\r\n\t     OR charindex('GENERAL AGGREGATE',SourceValue )>0\t\r\n\t\t then 'AGGREGATE LIMIT' \r\n\t\t when CHARINDEX('BODILY INJURY BY ACCIDENT:  EACH ACCIDENT',SourceValue)>0\r\n\t\t then 'BODILY INJURY BY ACCIDENT:  EACH ACCIDENT'\r\n\t\t when CHARINDEX('BODILY INJURY BY DISEASE:   POLICY LIMIT',SourceValue)>0\r\n\t\t then 'BODILY INJURY BY DISEASE:   POLICY LIMIT'\r\n\t\t when CHARINDEX('BODILY INJURY BY DISEASE:   EACH EMPLOYEE',SourceValue)>0\r\n\t\t then 'BODILY INJURY BY DISEASE:   EACH EMPLOYEE'\r\n\t \t when CHARINDEX('PROPERTY DAMAGE-EACH ACCIDENT',SourceValue)>0\r\n\t \t OR CHARINDEX('PROPERTY DAMAGE-EACH ACCIDENT',SourceValue)>0\r\n\t \t OR CHARINDEX('PROPERTY DAMAGE -EACH ACCIDENT',SourceValue)>0\r\n\t \t OR CHARINDEX('PROPERTY DAMAGE- EACH ACCIDENT',SourceValue)>0\r\n\t \t OR CHARINDEX('PROPERTY DAMAGE EACH ACCIDENT',SourceValue)>0\r\n\t \t OR CHARINDEX('PROPERTY DAMAGE: EACH ACCIDENT',SourceValue)>0\r\n\t \t OR CHARINDEX('PROPERTY DAMAGE/EACH ACCIDENT',SourceValue)>0\r\n\t \t OR CHARINDEX('EACH ACCIDENT-PROPERTY DAMAGE',SourceValue)>0\r\n\t \t OR CHARINDEX('PD - EACH ACCIDENT',SourceValue)>0 \r\n\t \t OR CHARINDEX('PROP DAMAGE LIAB-EACH ACCIDENT',SourceValue)>0 \r\n\t       OR CHARINDEX('EACH ACCIDENT',SourceValue)>0\r\n\t\t then 'PROPERTY DAMAGE - EACH ACCIDENT'   \r\n\t\t when charindex('BODILY INJURY - EACH PERSON',SourceValue )>0 \t\t\t\r\n\t\t OR charindex('BODILY INJURY-EACH PERSON',SourceValue )>0 \t\t\t  \t \r\n\t\t OR charindex('BODILY INJURY: EACH PERSON',SourceValue )>0 \t\r\n\t\t OR charindex('EACH PERSON',SourceValue )>0 \t\r\n\t\t THEN 'BODILY INJURY - EACH PERSON'\t\r\n\t\t when charindex('EACH EMPLOYEE',SourceValue )>0\r\n\t       then 'EACH EMPLOYEE'\r\n\t  when charindex('EACH COMMON CAUSE',SourceValue )>0\r\n\t       then 'EACH COMMON CAUSE LIMIT'     \t\r\n\t      ELSE 'N/A'end TYPE,\r\n\t\r\n\tLTRIM(RTRIM(DECLPTFormNumber)) as DECLPTFormNumber,\r\n\ta.DECLPTSeqSameForm as DECLPTSeqSameForm,\r\n\ta.DECLPTSeq0098 as DECLPTSeq0098\r\n\t\r\n\tfrom PifDept1553Stage a\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.pif_4514_stage b\r\n\tON  a.PifModule=b.pif_module\r\n\tand a.PifPolicyNumber=b.pif_policy_number\r\n\tand a.PifSymbol=b.pif_symbol\r\n\tWHERE b.logical_flag IN ('0','1','2','3') and left(b.pif_symbol,2) in ('CU','NU')\r\n\t@{pipeline().parameters.WHERE_CLAUSE_DEPT}\n),\nEXP_Default_Value_Dept1553 AS (\n\tSELECT\n\tPifSymbol AS i_PifSymbol,\n\tPifPolicyNumber AS i_PifPolicyNumber,\n\tPifModule AS i_PifModule,\n\tvalue AS i_value,\n\ttype AS i_type,\n\tDECLPTFormNumber AS i_DECLPTFormNumber,\n\tDECLPTSeqSameForm AS i_DECLPTSeqSameForm,\n\tDECLPTSeq0098 AS i_DECLPTSeq0098,\n\tpif_4514_stage_id,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_type)\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_type) AS v_type,\n\t-- *INF*: :LKP.LKP_PIFDEPT1553STAGE_UNDERLYINGINSURANCELINE(i_PifSymbol, i_PifPolicyNumber, i_PifModule, i_DECLPTFormNumber, i_DECLPTSeqSameForm, i_DECLPTSeq0098)\n\tLKP_PIFDEPT1553STAGE_UNDERLYINGINSURANCELINE_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.UnderlyingInsuranceLine AS v_UnderlyingInsuranceLine,\n\t-- *INF*: :LKP.LKP_PIFDEPT1553STAGE_UNDERLYINGCOMPANYNAME(i_PifSymbol, i_PifPolicyNumber, i_PifModule, i_DECLPTFormNumber, i_DECLPTSeqSameForm, i_DECLPTSeq0098)\n\tLKP_PIFDEPT1553STAGE_UNDERLYINGCOMPANYNAME_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.UnderlyingCompanyName AS v_UnderlyingCompanyName,\n\t-- *INF*: :LKP.LKP_PIFDEPT1553STAGE_UNDERLYINGPOLICYKEY(i_PifSymbol, i_PifPolicyNumber, i_PifModule, i_DECLPTFormNumber, i_DECLPTSeqSameForm, i_DECLPTSeq0098)\n\tLKP_PIFDEPT1553STAGE_UNDERLYINGPOLICYKEY_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.UnderlyingPolicyKey AS v_UnderlyingPolicyKey,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- ISNULL(v_UnderlyingInsuranceLine) OR v_UnderlyingInsuranceLine='N/A',\r\n\t-- v_type,\r\n\t-- v_UnderlyingInsuranceLine='Umbrella'  AND v_type<>'N/A',\r\n\t-- v_UnderlyingInsuranceLine || ' ' || v_type,\r\n\t-- IN(SUBSTR(i_DECLPTFormNumber,LENGTH(i_DECLPTFormNumber)-1,2),'02','03') AND v_type<>'N/A',\r\n\t-- 'Underlying-' || v_UnderlyingInsuranceLine || ' ' || v_type,\r\n\t-- v_type\r\n\t-- )\n\tDECODE(\n\t    TRUE,\n\t    v_UnderlyingInsuranceLine IS NULL OR v_UnderlyingInsuranceLine = 'N/A', v_type,\n\t    v_UnderlyingInsuranceLine = 'Umbrella' AND v_type <> 'N/A', v_UnderlyingInsuranceLine || ' ' || v_type,\n\t    SUBSTR(i_DECLPTFormNumber, LENGTH(i_DECLPTFormNumber) - 1, 2) IN ('02','03') AND v_type <> 'N/A', 'Underlying-' || v_UnderlyingInsuranceLine || ' ' || v_type,\n\t    v_type\n\t) AS v_CoverageLimitType,\n\t-- *INF*: IIF(ISNULL(i_value) OR NOT IS_NUMBER(i_value) OR LENGTH(i_value)=0 OR IS_SPACES(i_value),'0',TO_CHAR(TO_DECIMAL(i_value)))\n\tIFF(\n\t    i_value IS NULL\n\t    or NOT REGEXP_LIKE(i_value, '^[0-9]+$')\n\t    or LENGTH(i_value) = 0\n\t    or LENGTH(i_value)>0\n\t    and TRIM(i_value)='',\n\t    '0',\n\t    TO_CHAR(CAST(i_value AS FLOAT))\n\t) AS v_CoverageLimitValue,\n\t-- *INF*: v_CoverageLimitType\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- --IIF(IN(SUBSTR(i_DECLPTFormNumber,LENGTH(i_DECLPTFormNumber)-1,2),'02','03') AND v_type<>'N/A','Underlying - '||v_type,v_type)\n\tv_CoverageLimitType AS o_type,\n\t-- *INF*: v_CoverageLimitValue\r\n\t-- \r\n\t-- \r\n\t-- \r\n\t-- --IIF(ISNULL(i_value) OR LENGTH(i_value)=0 OR IS_SPACES(i_value) OR NOT IS_NUMBER(i_value),'0',TO_CHAR(TO_DECIMAL(i_value)))\n\tv_CoverageLimitValue AS o_value,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingCompanyName), 'N/A', v_UnderlyingCompanyName)\n\tIFF(v_UnderlyingCompanyName IS NULL, 'N/A', v_UnderlyingCompanyName) AS o_UnderlyingCompanyName,\n\t-- *INF*: IIF(ISNULL(v_UnderlyingPolicyKey), 'N/A', v_UnderlyingPolicyKey)\n\tIFF(v_UnderlyingPolicyKey IS NULL, 'N/A', v_UnderlyingPolicyKey) AS o_UnderlyingPolicyKey,\n\tv_UnderlyingInsuranceLine AS o_UnderlyingPolicyType,\n\t-- *INF*: IIF( NOT ISNULL(v_UnderlyingInsuranceLine) AND v_UnderlyingInsuranceLine<>'Umbrella' AND v_UnderlyingInsuranceLine<>'N/A' AND \r\n\t-- (\r\n\t-- (v_CoverageLimitType<>'N/A' AND v_CoverageLimitValue<>'N/A' AND IS_NUMBER(v_CoverageLimitValue)=0) \r\n\t-- OR \r\n\t-- (IS_NUMBER(v_CoverageLimitValue)=1 AND TO_DECIMAL(v_CoverageLimitValue)>0)\r\n\t-- ), 1, 0)\n\tIFF(\n\t    v_UnderlyingInsuranceLine IS NULL\n\t    and v_UnderlyingInsuranceLine <> 'Umbrella'\n\t    and v_UnderlyingInsuranceLine <> 'N/A'\n\t    and ((v_CoverageLimitType <> 'N/A'\n\t    and v_CoverageLimitValue <> 'N/A'\n\t    and REGEXP_LIKE(v_CoverageLimitValue, '^[0-9]+$') = 0)\n\t    or (REGEXP_LIKE(v_CoverageLimitValue, '^[0-9]+$') = 1\n\t    and CAST(v_CoverageLimitValue AS FLOAT) >NOT  0)),\n\t    1,\n\t    0\n\t) AS o_UnderlyingFlag\n\tFROM SQ_PifDept1553Stage\n\tLEFT JOIN LKP_PIFDEPT1553STAGE_UNDERLYINGINSURANCELINE LKP_PIFDEPT1553STAGE_UNDERLYINGINSURANCELINE_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098\n\tON LKP_PIFDEPT1553STAGE_UNDERLYINGINSURANCELINE_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.PifSymbol = i_PifSymbol\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGINSURANCELINE_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.PifPolicyNumber = i_PifPolicyNumber\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGINSURANCELINE_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.PifModule = i_PifModule\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGINSURANCELINE_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.DECLPTFormNumber = i_DECLPTFormNumber\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGINSURANCELINE_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.DECLPTSeqSameForm = i_DECLPTSeqSameForm\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGINSURANCELINE_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.DECLPTSeq0098 = i_DECLPTSeq0098\n\n\tLEFT JOIN LKP_PIFDEPT1553STAGE_UNDERLYINGCOMPANYNAME LKP_PIFDEPT1553STAGE_UNDERLYINGCOMPANYNAME_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098\n\tON LKP_PIFDEPT1553STAGE_UNDERLYINGCOMPANYNAME_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.PifSymbol = i_PifSymbol\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGCOMPANYNAME_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.PifPolicyNumber = i_PifPolicyNumber\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGCOMPANYNAME_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.PifModule = i_PifModule\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGCOMPANYNAME_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.DECLPTFormNumber = i_DECLPTFormNumber\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGCOMPANYNAME_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.DECLPTSeqSameForm = i_DECLPTSeqSameForm\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGCOMPANYNAME_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.DECLPTSeq0098 = i_DECLPTSeq0098\n\n\tLEFT JOIN LKP_PIFDEPT1553STAGE_UNDERLYINGPOLICYKEY LKP_PIFDEPT1553STAGE_UNDERLYINGPOLICYKEY_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098\n\tON LKP_PIFDEPT1553STAGE_UNDERLYINGPOLICYKEY_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.PifSymbol = i_PifSymbol\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGPOLICYKEY_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.PifPolicyNumber = i_PifPolicyNumber\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGPOLICYKEY_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.PifModule = i_PifModule\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGPOLICYKEY_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.DECLPTFormNumber = i_DECLPTFormNumber\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGPOLICYKEY_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.DECLPTSeqSameForm = i_DECLPTSeqSameForm\n\tAND LKP_PIFDEPT1553STAGE_UNDERLYINGPOLICYKEY_i_PifSymbol_i_PifPolicyNumber_i_PifModule_i_DECLPTFormNumber_i_DECLPTSeqSameForm_i_DECLPTSeq0098.DECLPTSeq0098 = i_DECLPTSeq0098\n\n),\nRTR_Underlying AS (\n\tSELECT\n\tpif_4514_stage_id,\n\to_type AS type,\n\to_value AS value,\n\to_UnderlyingCompanyName AS UnderlyingCompanyName,\n\to_UnderlyingPolicyKey AS UnderLyingPolicyKey,\n\to_UnderlyingPolicyType AS UnderlyingPolicyType,\n\to_UnderlyingFlag AS UnderlyingFlag\n\tFROM EXP_Default_Value_Dept1553\n),\nRTR_Underlying_Underlying AS (SELECT * FROM RTR_Underlying WHERE UnderlyingFlag=1),\nRTR_Underlying_DEFAULT1 AS (SELECT * FROM RTR_Underlying WHERE NOT ( (UnderlyingFlag=1) )),\nUN_Dept_RXGL_4514 AS (\n\tSELECT o_type AS type, o_value AS value, pif_4514_stage_id\n\tFROM EXP_Assign_Value_4514\n\tUNION\n\tSELECT type, value, pif_4514_stage_id\n\tFROM RTR_Underlying_DEFAULT1\n\tUNION\n\tSELECT type, value, pif_4514_stage_id\n\tFROM NRM_Unpivot_Type_Value\n\tUNION\n\tSELECT o_LimitType AS type, o_LimitValue AS value, o_pif_4514_state_id AS pif_4514_stage_id\n\tFROM EXP_TRANS_CA\n\tUNION\n\tSELECT o_LimitType AS type, o_LimitValue AS value, pif_4514_stage_id\n\tFROM EXP_EPLI_AggregateLimit\n\tUNION\n\tSELECT o_LimitType AS type, o_LimitValue AS value, pif_4514_stage_id1 AS pif_4514_stage_id\n\tFROM EXP_EPLI_EachRelatedWrongfulEmploymentPractice\n),\nFIL_Invalid_Type AS (\n\tSELECT\n\ttype, \n\tvalue, \n\tpif_4514_stage_id\n\tFROM UN_Dept_RXGL_4514\n\tWHERE (type<>'N/A' and value<>'N/A' and IS_NUMBER(value)=0) or (IS_NUMBER(value) and TO_DECIMAL(value)>0)\n),\nEXP_Calculate AS (\n\tSELECT\n\ttype AS i_type,\n\tvalue AS i_value,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- INSTR(i_type,'PersonalInjuryProtectionLimit',1,1)!=0 and INSTR(i_value,'Option',1,1)!=0, REVERSE(SUBSTR(REVERSE(i_value), 1, INSTR(REVERSE(i_value),' ', 1,1)-1)),\r\n\t-- INSTR(i_type,'PersonalInjuryProtectionLimit',1,1)!=0 and INSTR(i_value,'Basic',1,1)!=0, 'BasicPIP'\r\n\t-- , i_value)\n\tDECODE(\n\t    TRUE,\n\t    REGEXP_INSTR(i_type, 'PersonalInjuryProtectionLimit', 1, 1) != 0 and REGEXP_INSTR(i_value, 'Option', 1, 1) != 0, REVERSE(SUBSTR(REVERSE(i_value), 1, REGEXP_INSTR(REVERSE(i_value), ' ', 1, 1) - 1)),\n\t    REGEXP_INSTR(i_type, 'PersonalInjuryProtectionLimit', 1, 1) != 0 and REGEXP_INSTR(i_value, 'Basic', 1, 1) != 0, 'BasicPIP',\n\t    i_value\n\t) AS v_value,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- INSTR(i_type,'PersonalInjuryProtectionLimit',1,1)!=0 and v_value='BasicPIP', 'PersonalInjuryProtectionBasicLimit',\r\n\t-- INSTR(i_type,'PersonalInjuryProtectionLimit',1,1)!=0 and v_value!='BasicPIP', 'PersonalInjuryProtectionExcessLimit'\r\n\t-- , i_type)\n\tDECODE(\n\t    TRUE,\n\t    REGEXP_INSTR(i_type, 'PersonalInjuryProtectionLimit', 1, 1) != 0 and v_value = 'BasicPIP', 'PersonalInjuryProtectionBasicLimit',\n\t    REGEXP_INSTR(i_type, 'PersonalInjuryProtectionLimit', 1, 1) != 0 and v_value != 'BasicPIP', 'PersonalInjuryProtectionExcessLimit',\n\t    i_type\n\t) AS v_type,\n\tv_type AS o_type,\n\tv_value AS o_value,\n\tpif_4514_stage_id\n\tFROM FIL_Invalid_Type\n),\nAGG_Type_Value AS (\n\tSELECT\n\to_type AS type,\n\to_value AS value\n\tFROM EXP_Calculate\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY type, value ORDER BY NULL) = 1\n),\nLKP_CoverageLimit_CoverageLimitID AS (\n\tSELECT\n\tCoverageLimitId,\n\tCoverageLimitType,\n\tCoverageLimitValue\n\tFROM (\n\t\tSELECT \n\t\t\tCoverageLimitId,\n\t\t\tCoverageLimitType,\n\t\t\tCoverageLimitValue\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageLimit\n\t\tWHERE SourceSystemID='@{pipeline().parameters.SOURCE_SYSTEM_ID}'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY CoverageLimitType,CoverageLimitValue ORDER BY CoverageLimitId) = 1\n),\nSEQ_CoverageLimitID AS (\n\tCREATE SEQUENCE SEQ_CoverageLimitID\n\tSTART = 0\n\tINCREMENT = 1;\n),\nEXP_Set_CoverageLimitID AS (\n\tSELECT\n\tLKP_CoverageLimit_CoverageLimitID.CoverageLimitId AS lkp_CoverageLimitId,\n\tSEQ_CoverageLimitID.NEXTVAL AS i_NEXTVAL,\n\tAGG_Type_Value.type AS CoverageLimitType,\n\tAGG_Type_Value.value AS CoverageLimitValue,\n\t-- *INF*: IIF(ISNULL(lkp_CoverageLimitId),i_NEXTVAL,lkp_CoverageLimitId)\n\tIFF(lkp_CoverageLimitId IS NULL, i_NEXTVAL, lkp_CoverageLimitId) AS CoverageLimitId\n\tFROM AGG_Type_Value\n\tLEFT JOIN LKP_CoverageLimit_CoverageLimitID\n\tON LKP_CoverageLimit_CoverageLimitID.CoverageLimitType = AGG_Type_Value.type AND LKP_CoverageLimit_CoverageLimitID.CoverageLimitValue = AGG_Type_Value.value\n),\nSRT_by_Type_Value_CoverageLimit AS (\n\tSELECT\n\tCoverageLimitType, \n\tCoverageLimitValue, \n\tCoverageLimitId\n\tFROM EXP_Set_CoverageLimitID\n\tORDER BY CoverageLimitType ASC, CoverageLimitValue ASC\n),\nSRT_by_Type_Value_CoverageLimitBridge AS (\n\tSELECT\n\to_type AS type, \n\to_value AS value, \n\tpif_4514_stage_id\n\tFROM EXP_Calculate\n\tORDER BY type ASC, value ASC\n),\nJNR_CoverageLimit_CoverageLimitBridge AS (SELECT\n\tSRT_by_Type_Value_CoverageLimitBridge.type AS i_type, \n\tSRT_by_Type_Value_CoverageLimitBridge.value AS i_value, \n\tSRT_by_Type_Value_CoverageLimitBridge.pif_4514_stage_id, \n\tSRT_by_Type_Value_CoverageLimit.CoverageLimitType AS i_CoverageLimitType, \n\tSRT_by_Type_Value_CoverageLimit.CoverageLimitValue AS i_CoverageLimitValue, \n\tSRT_by_Type_Value_CoverageLimit.CoverageLimitId\n\tFROM SRT_by_Type_Value_CoverageLimitBridge\n\tINNER JOIN SRT_by_Type_Value_CoverageLimit\n\tON SRT_by_Type_Value_CoverageLimit.CoverageLimitType = SRT_by_Type_Value_CoverageLimitBridge.type AND SRT_by_Type_Value_CoverageLimit.CoverageLimitValue = SRT_by_Type_Value_CoverageLimitBridge.value\n),\nLKP_WorkPremiumTransaction AS (\n\tSELECT\n\tPremiumTransactionAKId,\n\tPremiumTransactionStageId\n\tFROM (\n\t\tSELECT \n\t\t\tPremiumTransactionAKId,\n\t\t\tPremiumTransactionStageId\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.WorkPremiumTransaction\n\t\tWHERE SourceSystemID='@{pipeline().parameters.SOURCE_SYSTEM_ID}'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionStageId ORDER BY PremiumTransactionAKId) = 1\n),\nLKP_CoverageLimitBridge AS (\n\tSELECT\n\tCoverageLimitBridgeId,\n\tPremiumTransactionAKId,\n\tCoverageLimitId\n\tFROM (\n\t\tSELECT CLB.CoverageLimitBridgeId as CoverageLimitBridgeId,\r\n\t\tCLB.PremiumTransactionAKId as PremiumTransactionAKId,\r\n\t\tCLB.CoverageLimitId as CoverageLimitId \r\n\t\tFROM dbo.CoverageLimitBridge CLB\r\n\t\tINNER JOIN WorkPremiumTransaction WPT ON CLB.PremiumTransactionAKId = WPT.PremiumTransactionAKId\r\n\t\tWHERE WPT.SourceSystemID='@{pipeline().parameters.SOURCE_SYSTEM_ID}'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionAKId,CoverageLimitId ORDER BY CoverageLimitBridgeId) = 1\n),\nFIL_Insert_CoverageLimitBridge AS (\n\tSELECT\n\tLKP_CoverageLimitBridge.CoverageLimitBridgeId AS i_CoverageLimitBridgeId, \n\tLKP_WorkPremiumTransaction.PremiumTransactionAKId, \n\tJNR_CoverageLimit_CoverageLimitBridge.CoverageLimitId\n\tFROM JNR_CoverageLimit_CoverageLimitBridge\n\tLEFT JOIN LKP_CoverageLimitBridge\n\tON LKP_CoverageLimitBridge.PremiumTransactionAKId = LKP_WorkPremiumTransaction.PremiumTransactionAKId AND LKP_CoverageLimitBridge.CoverageLimitId = JNR_CoverageLimit_CoverageLimitBridge.CoverageLimitId\n\tLEFT JOIN LKP_WorkPremiumTransaction\n\tON LKP_WorkPremiumTransaction.PremiumTransactionStageId = JNR_CoverageLimit_CoverageLimitBridge.pif_4514_stage_id\n\tWHERE ISNULL(i_CoverageLimitBridgeId) AND PremiumTransactionAKId<>-1\n),\nAGG_Group_Count AS (\n\tSELECT\n\tPremiumTransactionAKId,\n\tCoverageLimitId,\n\t-- *INF*: COUNT(1)\n\tCOUNT(1) AS o_CoverageLimitCount\n\tFROM FIL_Insert_CoverageLimitBridge\n\tGROUP BY PremiumTransactionAKId, CoverageLimitId\n),\nEXP_Set_MetaData_CoverageLimitBridge AS (\n\tSELECT\n\tPremiumTransactionAKId,\n\tCoverageLimitId,\n\to_CoverageLimitCount AS CoverageLimitCount,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemID,\n\tSYSDATE AS o_CreatedDate,\n\t'N/A' AS o_CoverageLimitControl\n\tFROM AGG_Group_Count\n),\nCoverageLimitBridge AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageLimitBridge\n\t(AuditID, SourceSystemID, CreatedDate, PremiumTransactionAKId, CoverageLimitId, CoverageLimitIDCount, CoverageLimitControl)\n\tSELECT \n\to_AuditID AS AUDITID, \n\to_SourceSystemID AS SOURCESYSTEMID, \n\to_CreatedDate AS CREATEDDATE, \n\tPREMIUMTRANSACTIONAKID, \n\tCOVERAGELIMITID, \n\tCoverageLimitCount AS COVERAGELIMITIDCOUNT, \n\to_CoverageLimitControl AS COVERAGELIMITCONTROL\n\tFROM EXP_Set_MetaData_CoverageLimitBridge\n),\nLKP_PremiumTransaction AS (\n\tSELECT\n\tPremiumTransactionId,\n\tPremiumTransactionStageId\n\tFROM (\n\t\tSELECT PT.PremiumTransactionId as PremiumTransactionId,\r\n\t\tWPT.PremiumTransactionStageId as PremiumTransactionStageId\r\n\t\tFROM\r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.WorkPremiumTransaction WPT\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction PT\r\n\t\tON WPT.PremiumTransactionAKID=PT.PremiumTransactionAKID\r\n\t\tAND PT.CurrentSnapshotFlag=1\r\n\t\tWHERE WPT.SourceSystemID='@{pipeline().parameters.SOURCE_SYSTEM_ID}'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionStageId ORDER BY PremiumTransactionId) = 1\n),\nAGG_Underlying AS (\n\tSELECT\n\tLKP_PremiumTransaction.PremiumTransactionId AS PremiumTransactionID,\n\tRTR_Underlying_Underlying.type,\n\tRTR_Underlying_Underlying.value,\n\tRTR_Underlying_Underlying.UnderlyingCompanyName,\n\tRTR_Underlying_Underlying.UnderLyingPolicyKey,\n\tRTR_Underlying_Underlying.UnderlyingPolicyType\n\tFROM RTR_Underlying_Underlying\n\tLEFT JOIN LKP_PremiumTransaction\n\tON LKP_PremiumTransaction.PremiumTransactionStageId = RTR_Underlying.pif_4514_stage_id1\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionID, type, UnderlyingCompanyName, UnderLyingPolicyKey, UnderlyingPolicyType ORDER BY NULL) = 1\n),\nEXP_Underlying AS (\n\tSELECT\n\tPremiumTransactionID AS i_PremiumTransactionID,\n\ttype AS i_type,\n\tvalue AS i_value,\n\tUnderlyingCompanyName AS i_UnderlyingCompanyName,\n\tUnderLyingPolicyKey AS i_UnderLyingPolicyKey,\n\tUnderlyingPolicyType AS i_UnderlyingPolicyType,\n\t'1' AS o_CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t-- *INF*: TO_DATE('1800-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')\n\tTO_TIMESTAMP('1800-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS') AS o_EffectiveDate,\n\t-- *INF*: TO_DATE('2100-12-31 23:59:59', 'YYYY-MM-DD HH24:MI:SS')\n\tTO_TIMESTAMP('2100-12-31 23:59:59', 'YYYY-MM-DD HH24:MI:SS') AS o_ExpirationDate,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemId,\n\tCURRENT_TIMESTAMP AS o_CreatedDate,\n\tCURRENT_TIMESTAMP AS o_ModifiedDate,\n\ti_PremiumTransactionID AS o_PremiumTransactionId,\n\ti_UnderlyingCompanyName AS o_UnderlyingInsuranceCompanyName,\n\ti_UnderLyingPolicyKey AS o_UnderlyingPolicyKey,\n\ti_UnderlyingPolicyType AS o_UnderlyingPolicyType,\n\ti_value AS o_UnderlyingPolicyLimit,\n\ti_type AS o_UnderlyingPolicyLimitType\n\tFROM AGG_Underlying\n),\nLKP_CoverageDetailUnderlyingPolicy AS (\n\tSELECT\n\tCoverageDetailUnderlyingPolicyId,\n\tPremiumTransactionId,\n\tUnderlyingInsuranceCompanyName,\n\tUnderlyingPolicyKey,\n\tUnderlyingPolicyType,\n\tUnderlyingPolicyLimitType\n\tFROM (\n\t\tSELECT CDUP.CoverageDetailUnderlyingPolicyId as CoverageDetailUnderlyingPolicyId,\r\n\t\tCDUP.PremiumTransactionId as PremiumTransactionId, \r\n\t\tCDUP.UnderlyingInsuranceCompanyName as UnderlyingInsuranceCompanyName, \r\n\t\tCDUP.UnderlyingPolicyKey as UnderlyingPolicyKey, \r\n\t\tCDUP.UnderlyingPolicyType as UnderlyingPolicyType, \r\n\t\tCDUP.UnderlyingPolicyLimitType as UnderlyingPolicyLimitType \r\n\t\t FROM dbo.CoverageDetailUnderlyingPolicy CDUP \r\n\t\t INNER JOIN dbo.PremiumTransaction PT ON CDUP.PremiumTransactionId = PT.Premiumtransactionid\r\n\t\t INNER JOIN dbo.WorkPremiumTransaction WPT ON WPT.PremiumtransactionAKID = PT.PremiumtransactionAKID \r\n\t\tAND PT.SourceSystemID = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionId,UnderlyingInsuranceCompanyName,UnderlyingPolicyKey,UnderlyingPolicyType,UnderlyingPolicyLimitType ORDER BY CoverageDetailUnderlyingPolicyId) = 1\n),\nRTR_Underlying_Insert AS (\n\tSELECT\n\tLKP_CoverageDetailUnderlyingPolicy.CoverageDetailUnderlyingPolicyId,\n\tEXP_Underlying.o_CurrentSnapshotFlag AS CurrentSnapshotFlag,\n\tEXP_Underlying.o_AuditID AS AuditID,\n\tEXP_Underlying.o_EffectiveDate AS EffectiveDate,\n\tEXP_Underlying.o_ExpirationDate AS ExpirationDate,\n\tEXP_Underlying.o_SourceSystemId AS SourceSystemId,\n\tEXP_Underlying.o_CreatedDate AS CreatedDate,\n\tEXP_Underlying.o_ModifiedDate AS ModifiedDate,\n\tEXP_Underlying.o_PremiumTransactionId AS PremiumTransactionId,\n\tEXP_Underlying.o_UnderlyingInsuranceCompanyName AS UnderlyingInsuranceCompanyName,\n\tEXP_Underlying.o_UnderlyingPolicyKey AS UnderlyingPolicyKey,\n\tEXP_Underlying.o_UnderlyingPolicyType AS UnderlyingPolicyType,\n\tEXP_Underlying.o_UnderlyingPolicyLimit AS UnderlyingPolicyLimit,\n\tEXP_Underlying.o_UnderlyingPolicyLimitType AS UnderlyingPolicyLimitType\n\tFROM EXP_Underlying\n\tLEFT JOIN LKP_CoverageDetailUnderlyingPolicy\n\tON LKP_CoverageDetailUnderlyingPolicy.PremiumTransactionId = EXP_Underlying.o_PremiumTransactionId AND LKP_CoverageDetailUnderlyingPolicy.UnderlyingInsuranceCompanyName = EXP_Underlying.o_UnderlyingInsuranceCompanyName AND LKP_CoverageDetailUnderlyingPolicy.UnderlyingPolicyKey = EXP_Underlying.o_UnderlyingPolicyKey AND LKP_CoverageDetailUnderlyingPolicy.UnderlyingPolicyType = EXP_Underlying.o_UnderlyingPolicyType AND LKP_CoverageDetailUnderlyingPolicy.UnderlyingPolicyLimitType = EXP_Underlying.o_UnderlyingPolicyLimitType\n),\nRTR_Underlying_Insert_Insert AS (SELECT * FROM RTR_Underlying_Insert WHERE ISNULL(CoverageDetailUnderlyingPolicyId)),\nTGT_CoverageDetailUnderlyingPolicy_Insert AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailUnderlyingPolicy\n\t(CurrentSnapshotFlag, AuditID, EffectiveDate, ExpirationDate, SourceSystemId, CreatedDate, ModifiedDate, PremiumTransactionId, UnderlyingInsuranceCompanyName, UnderlyingPolicyKey, UnderlyingPolicyType, UnderlyingPolicyLimit, UnderlyingPolicyLimitType)\n\tSELECT \n\tCURRENTSNAPSHOTFLAG, \n\tAUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tSOURCESYSTEMID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tPREMIUMTRANSACTIONID, \n\tUNDERLYINGINSURANCECOMPANYNAME, \n\tUNDERLYINGPOLICYKEY, \n\tUNDERLYINGPOLICYTYPE, \n\tUNDERLYINGPOLICYLIMIT, \n\tUNDERLYINGPOLICYLIMITTYPE\n\tFROM RTR_Underlying_Insert_Insert\n),\nFIL_Insert_CoverageLimit AS (\n\tSELECT\n\tlkp_CoverageLimitId, \n\tCoverageLimitType, \n\tCoverageLimitValue, \n\tCoverageLimitId\n\tFROM EXP_Set_CoverageLimitID\n\tWHERE ISNULL(lkp_CoverageLimitId)\n),\nEXP_Set_Metadata_CoverageLimit AS (\n\tSELECT\n\tCoverageLimitType,\n\tCoverageLimitValue,\n\tCoverageLimitId,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemID,\n\tSYSDATE AS o_CreatedDate,\n\tCoverageLimitType AS o_CoverageLimitType,\n\tCoverageLimitValue AS o_CoverageLimitValue\n\tFROM FIL_Insert_CoverageLimit\n),\nUPD_Insert_CoverageLimit AS (\n\tSELECT\n\tCoverageLimitId, \n\to_AuditID AS AuditID, \n\to_SourceSystemID AS SourceSystemID, \n\to_CreatedDate AS CreatedDate, \n\to_CoverageLimitType AS CoverageLimitType, \n\to_CoverageLimitValue AS CoverageLimitValue\n\tFROM EXP_Set_Metadata_CoverageLimit\n),\nCoverageLimit AS (\n\tSET IDENTITY_INSERT @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageLimit  ON\r\n\tINSERT @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageLimit(CoverageLimitId ,AuditID,SourceSystemID,CreatedDate,CoverageLimitType,CoverageLimitValue) \n\tSELECT S.CoverageLimitId,S.AuditID,S.SourceSystemID, S.CreatedDate,S.CoverageLimitType, S.CoverageLimitValue\n\tFROM UPD_Insert_CoverageLimit S\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_CLAUSE_4514": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_CLAUSE_RXGL": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_CLAUSE_DEPT": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "RPT_EDM and EDW/Policy DataWarehouse/"
        },
        "annotations": []
    }
}