{
    "name": "s_m_CMN_DM_Load_CoverageDetailWorkersCompensationDim",
    "properties": {
        "activities": [
            {
                "name": "m_CMN_DM_Load_CoverageDetailWorkersCompensationDim",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_SupClassificationWorkersCompensation AS (\n\tSELECT\n\tRatableClassIndicator,\n\tRatingStateCode,\n\tClassCode\n\tFROM (\n\t\tSELECT \r\n\t\tSupClassificationWorkersCompensation.RatingStateCode as RatingStateCode, \r\n\t\tSupClassificationWorkersCompensation.ClassCode as ClassCode,\r\n\t\tCase when SupClassificationWorkersCompensation.RatableClassIndicator ='N/A' or  SupClassificationWorkersCompensation.RatableClassIndicator is null \r\n\t\t\t\t  then 'X'\r\n\t\t\t\t  Else \tSupClassificationWorkersCompensation.RatableClassIndicator\r\n\t\tEnd + '-'+\r\n\t\tCase when SupClassificationWorkersCompensation.SurchargeClassIndicator='N/A' or SupClassificationWorkersCompensation.SurchargeClassIndicator is null\r\n\t\t\t\t   then 'X'\r\n\t\t\t\t  Else  SupClassificationWorkersCompensation.SurchargeClassIndicator\r\n\t\t\t End + '-'+\r\n\t\tcase when SupClassificationWorkersCompensation.HazardGroupCode='N/A' or SupClassificationWorkersCompensation.HazardGroupCode is null\r\n\t\t\t\t\tthen 'X'\r\n\t\t\t\t\tElse SupClassificationWorkersCompensation.HazardGroupCode\r\n\t\t\tEnd as RatableClassIndicator \r\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.SupClassificationWorkersCompensation\r\n\t\twhere SupClassificationWorkersCompensation.CurrentSnapshotFlag=1\r\n\t\t--\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY RatingStateCode,ClassCode ORDER BY RatableClassIndicator) = 1\n),\nSQ_CoverageDetailWorkersCompensationDim AS (\n\tselect distinct\r\n\t(case when SC.ClassCodeOrganizationCode='ISS' then 'ALL' else SS.state_code end)  as state_code,\r\n\tSIL.StandardInsuranceLineCode AS StandardInsuranceLineCode,\r\n\tPT.ExperienceModificationFactor AS ExperienceModificationFactor,\r\n\tPT.ExperienceModificationEffectiveDate AS ExperienceModificationEffectiveDate,\r\n\tSC.ClassCode AS ClassCode,\r\n\tSC.ClassCodeOrganizationCode AS ClassCodeOrganizationCode,\r\n\tSC.StatisticalCoverageEffectiveDate AS CoverageEffectiveDate,\r\n\tCDD.CoverageDetailDimID AS CoverageDetailDimID,\r\n\tCDD.CoverageGuid AS CoverageGuid,\r\n\tCDD.EffectiveDate AS EffectiveDate,\r\n\tCDD.ExpirationDate AS ExpirationDate,\r\n\tPLT.PolicyPerAccidentLimit AS PolicyPerAccidentLimit,\r\n\tPLT.PolicyPerDiseaseLimit AS PolicyPerDiseaseLimit,\r\n\tPLT.PolicyAggregateLimit AS PolicyAggregateLimit,\r\n\tCDWC.ConsentToRateFlag AS ConsentToRateFlag,\r\n\tCDWC.RateOverride AS RateOverride,\r\n\tCDWC.AdmiraltyActFlag As AdmiraltyActFlag,\r\n\tCDWC.FederalEmployersLiabilityActFlag As FederalEmployersLiabilityActFlag,\r\n\tCDWC.USLongShoreAndHarborWorkersCompensationActFlag As USLongShoreAndHarborWorkersCompensationActFlag\r\n\tfrom @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailDim CDD\r\n\tjoin @{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction PT\r\n\ton CDD.EDWPremiumTransactionPKID = PT.PremiumTransactionID\r\n\tjoin @{pipeline().parameters.SOURCE_TABLE_OWNER}.StatisticalCoverage SC\r\n\ton PT.StatisticalCoverageAKId=SC.StatisticalCoverageAKId\r\n\tjoin @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\ton SC.PolicyCoverageAKId=PC.PolicyCoverageAKId\r\n\tjoin @{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation RL\r\n\ton PC.RiskLocationAKID=RL.RiskLocationAKID\r\n\tleft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyLimit PLT\r\n\ton PC.PolicyLimitAKID=PLT.PolicyLimitAKID \r\n\tand PLT.CurrentSnapshotFlag=1\r\n\tjoin @{pipeline().parameters.SOURCE_TABLE_OWNER}.CoverageDetailWorkersCompensation CDWC\r\n\ton CDWC.PremiumTransactionID=CDD.EDWPremiumTransactionPKID\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line SIL\r\n\ton SIL.ins_line_code=PC.InsuranceLine and SIL.crrnt_snpsht_flag=1\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_state SS\r\n\ton (case when len(SS.state_abbrev)=1 then '0'+SS.state_abbrev else SS.state_abbrev end)=(case when len(RL.StateProvinceCode)=1 then '0'+RL.StateProvinceCode else RL.StateProvinceCode end) and SS.crrnt_snpsht_flag=1\r\n\twhere PT.SourceSystemID='PMS' \r\n\tand PT.CreatedDate>='@{pipeline().parameters.SELECTION_START_TS}' \r\n\t--and PC.InsuranceLine='WC' \r\n\tand PC.TypeBureauCode in ('WC','WP')\r\n\t@{pipeline().parameters.WHERE_CLAUSE_PMS}\r\n\t\r\n\tunion all\r\n\t\r\n\tselect distinct\r\n\t(case when RC.ClassCodeOrganizationCode='ISS' then 'ALL' else SS.state_code end)  as state_code,\r\n\tSIL.StandardInsuranceLineCode AS StandardInsuranceLineCode,\r\n\tPT.ExperienceModificationFactor AS ExperienceModificationFactor,\r\n\tPT.ExperienceModificationEffectiveDate AS ExperienceModificationEffectiveDate,\r\n\tRC.ClassCode AS ClassCode,\r\n\tRC.ClassCodeOrganizationCode AS ClassCodeOrganizationCode,\r\n\tRC.RatingCoverageEffectiveDate AS CoverageEffectiveDate,\r\n\tCDD.CoverageDetailDimID AS CoverageDetailDimID,\r\n\tCDD.CoverageGuid AS CoverageGuid,\r\n\tCDD.EffectiveDate AS EffectiveDate,\r\n\tCDD.ExpirationDate AS ExpirationDate,\r\n\tPLT.PolicyPerAccidentLimit AS PolicyPerAccidentLimit,\r\n\tPLT.PolicyPerDiseaseLimit AS PolicyPerDiseaseLimit,\r\n\tPLT.PolicyAggregateLimit AS PolicyAggregateLimit,\r\n\tCDWC.ConsentToRateFlag AS ConsentToRateFlag,\r\n\tCDWC.RateOVerride AS RateOVerride,\r\n\tCDWC.AdmiraltyActFlag As AdmiraltyActFlag,\r\n\tCDWC.FederalEmployersLiabilityActFlag As FederalEmployersLiabilityActFlag,\r\n\tCDWC.USLongShoreAndHarborWorkersCompensationActFlag As USLongShoreAndHarborWorkersCompensationActFlag\r\n\tfrom @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailDim CDD\r\n\tjoin @{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction PT\r\n\ton CDD.EDWPremiumTransactionPKID = PT.PremiumTransactionID\r\n\tjoin @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage RC\r\n\ton PT.RatingCoverageAKId=RC.RatingCoverageAKID and RC.EffectiveDate=PT.EffectiveDate\r\n\tjoin @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\ton RC.PolicyCoverageAKId=PC.PolicyCoverageAKId AND PC.CurrentSnapshotFlag=1\r\n\tjoin @{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation RL\r\n\ton PC.RiskLocationAKID=RL.RiskLocationAKID\r\n\tand RL.CurrentSnapshotFlag=1 \r\n\tleft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyLimit PLT\r\n\ton PC.PolicyLimitAKID=PLT.PolicyLimitAKID \r\n\tand PLT.EffectiveDate <= PT.PremiumTransactionEnteredDate \r\n\tand PLT.ExpirationDate > PT.PremiumTransactionEnteredDate\r\n\tjoin @{pipeline().parameters.SOURCE_TABLE_OWNER}.CoverageDetailWorkersCompensation CDWC\r\n\ton CDWC.PremiumTransactionID=CDD.EDWPremiumTransactionPKID\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line SIL\r\n\ton SIL.ins_line_code=PC.InsuranceLine and SIL.crrnt_snpsht_flag=1\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_state SS\r\n\ton (case when len(SS.state_abbrev)=1 then '0'+SS.state_abbrev else SS.state_abbrev end)=(case when len(RL.StateProvinceCode)=1 then '0'+RL.StateProvinceCode else RL.StateProvinceCode end) and SS.crrnt_snpsht_flag=1\r\n\twhere PT.SourceSystemID='DCT' \r\n\tand PT.CreatedDate>='@{pipeline().parameters.SELECTION_START_TS}' \r\n\tand PC.InsuranceLine='WorkersCompensation' \r\n\t@{pipeline().parameters.WHERE_CLAUSE_DCT}\n),\nSRTTRANS AS (\n\tSELECT\n\tstate_code, \n\tStandardInsuranceLineCode, \n\tExperienceModificationFactor, \n\tExperienceModificationEffectiveDate, \n\tClassCode, \n\tClassCodeOrganizationCode, \n\tCoverageEffectiveDate, \n\tCoverageDetailDimId, \n\tCoverageGuid, \n\tEffectiveDate, \n\tExpirationDate, \n\tPolicyPerAccidentLimit, \n\tPolicyPerDiseaseLimit, \n\tPolicyAggregateLimit, \n\tConsentToRateFlag, \n\tRateOverride, \n\tAdmiraltyActFlag, \n\tFederalEmployersLiabilityActFlag, \n\tUSLongShoreAndHarborWorkersCompensationActFlag\n\tFROM SQ_CoverageDetailWorkersCompensationDim\n\tORDER BY EffectiveDate ASC\n),\nAGGTRANS AS (\n\tSELECT\n\tstate_code,\n\tStandardInsuranceLineCode,\n\tExperienceModificationFactor,\n\tExperienceModificationEffectiveDate,\n\tClassCode,\n\tClassCodeOrganizationCode,\n\tCoverageEffectiveDate,\n\tCoverageDetailDimId,\n\tCoverageGuid,\n\tEffectiveDate,\n\tExpirationDate,\n\tPolicyPerAccidentLimit,\n\tPolicyPerDiseaseLimit,\n\tPolicyAggregateLimit,\n\tConsentToRateFlag,\n\tRateOverride,\n\tAdmiraltyActFlag,\n\tFederalEmployersLiabilityActFlag,\n\tUSLongShoreAndHarborWorkersCompensationActFlag\n\tFROM SRTTRANS\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY CoverageDetailDimId ORDER BY NULL) = 1\n),\nLKP_ClassificationReference AS (\n\tSELECT\n\tClassDescription,\n\tInsuranceLineCode,\n\tStateCode,\n\tOriginatingOrganizationCode,\n\tClassCode,\n\tClassCodeEffectiveDate,\n\tClassCodeExpirationDate\n\tFROM (\n\t\tselect ClassDescription as ClassDescription, \r\n\t\tInsuranceLineCode as InsuranceLineCode, \r\n\t\tStateCode as StateCode, \r\n\t\tOriginatingOrganizationCode as OriginatingOrganizationCode, \r\n\t\tClassCode as ClassCode, \r\n\t\tClassCodeEffectiveDate as ClassCodeEffectiveDate, \r\n\t\tClassCodeExpirationDate as ClassCodeExpirationDate\r\n\t\tfrom (\r\n\t\tSELECT ltrim(rtrim(ClassDescription)) as ClassDescription, \r\n\t\tltrim(rtrim(InsuranceLineCode)) as InsuranceLineCode, \r\n\t\tltrim(rtrim(StateCode)) as StateCode, \r\n\t\tltrim(rtrim(OriginatingOrganizationCode)) as OriginatingOrganizationCode, \r\n\t\tltrim(rtrim(ClassCode)) as ClassCode, \r\n\t\tClassCodeEffectiveDate as ClassCodeEffectiveDate, \r\n\t\tClassCodeExpirationDate as ClassCodeExpirationDate,\r\n\t\trow_number() over (partition by InsuranceLineCode, StateCode, OriginatingOrganizationCode,ClassCode, \r\n\t\tClassCodeEffectiveDate,\r\n\t\tClassCodeExpirationDate order by ClassificationReferenceId desc) rn\r\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.ClassificationReference\r\n\t\twhere ltrim(rtrim(OriginatingOrganizationCode))='NCCI'\r\n\t\t)Src\r\n\t\twhere rn=1\r\n\t\torder by ClassCodeEffectiveDate --\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY InsuranceLineCode,StateCode,OriginatingOrganizationCode,ClassCode,ClassCodeEffectiveDate,ClassCodeExpirationDate ORDER BY ClassDescription DESC) = 1\n),\nLKP_CoverageDetailWorkersCompensationDim AS (\n\tSELECT\n\tCoverageDetailDimId,\n\tEffectiveDate,\n\tExpirationDate,\n\tCoverageGuid,\n\tNcciClassCode,\n\tNcciClassDescription,\n\tPolicyPerAccidentLimit,\n\tPolicyPerDiseaseLimit,\n\tPolicyAggregateLimit,\n\tExperienceModificationFactor,\n\tExperienceModificationEffectiveDate,\n\tConsentToRateFlag,\n\tRateOverride,\n\tRatableClassIndicator,\n\tSurchargeClassIndicator,\n\tHazardGroupCode,\n\tAdmiraltyActFlag,\n\tFederalEmployersLiabilityActFlag,\n\tUSLongShoreAndHarborWorkersCompensationActFlag\n\tFROM (\n\t\tSELECT \n\t\t\tCoverageDetailDimId,\n\t\t\tEffectiveDate,\n\t\t\tExpirationDate,\n\t\t\tCoverageGuid,\n\t\t\tNcciClassCode,\n\t\t\tNcciClassDescription,\n\t\t\tPolicyPerAccidentLimit,\n\t\t\tPolicyPerDiseaseLimit,\n\t\t\tPolicyAggregateLimit,\n\t\t\tExperienceModificationFactor,\n\t\t\tExperienceModificationEffectiveDate,\n\t\t\tConsentToRateFlag,\n\t\t\tRateOverride,\n\t\t\tRatableClassIndicator,\n\t\t\tSurchargeClassIndicator,\n\t\t\tHazardGroupCode,\n\t\t\tAdmiraltyActFlag,\n\t\t\tFederalEmployersLiabilityActFlag,\n\t\t\tUSLongShoreAndHarborWorkersCompensationActFlag\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailWorkersCompensationDim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY CoverageDetailDimId ORDER BY CoverageDetailDimId) = 1\n),\nLKP_sup_state AS (\n\tSELECT\n\tstate_abbrev,\n\tstate_code\n\tFROM (\n\t\tSELECT \n\t\t\tstate_abbrev,\n\t\t\tstate_code\n\t\tFROM sup_state\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY state_code ORDER BY state_abbrev) = 1\n),\nEXP_AddMetaData AS (\n\tSELECT\n\tLKP_CoverageDetailWorkersCompensationDim.CoverageDetailDimId AS lkp_CoverageDetailDimId,\n\tLKP_CoverageDetailWorkersCompensationDim.EffectiveDate AS lkp_EffectiveDate,\n\tLKP_CoverageDetailWorkersCompensationDim.ExpirationDate AS lkp_ExpirationDate,\n\tLKP_CoverageDetailWorkersCompensationDim.CoverageGuid AS lkp_CoverageGuid,\n\tLKP_CoverageDetailWorkersCompensationDim.NcciClassCode AS lkp_NcciClassCode,\n\tLKP_CoverageDetailWorkersCompensationDim.NcciClassDescription AS lkp_NcciClassDescription,\n\tLKP_CoverageDetailWorkersCompensationDim.PolicyPerAccidentLimit AS lkp_PolicyPerAccidentLimit,\n\tLKP_CoverageDetailWorkersCompensationDim.PolicyPerDiseaseLimit AS lkp_PolicyPerDiseaseLimit,\n\tLKP_CoverageDetailWorkersCompensationDim.PolicyAggregateLimit AS lkp_PolicyAggregateLimit,\n\tLKP_CoverageDetailWorkersCompensationDim.ExperienceModificationFactor AS lkp_ExperienceModificationFactor,\n\tLKP_CoverageDetailWorkersCompensationDim.ExperienceModificationEffectiveDate AS lkp_ExperienceModificationEffectiveDate,\n\tLKP_CoverageDetailWorkersCompensationDim.ConsentToRateFlag AS lkp_ConsentToRateFlag,\n\tLKP_CoverageDetailWorkersCompensationDim.RateOverride AS lkp_RateOverride,\n\tLKP_CoverageDetailWorkersCompensationDim.RatableClassIndicator AS lkp_RatableClassIndicator,\n\tLKP_CoverageDetailWorkersCompensationDim.SurchargeClassIndicator AS lkp_SurchargeClassIndicator,\n\tLKP_CoverageDetailWorkersCompensationDim.HazardGroupCode AS lkp_HazardGroupCode,\n\tLKP_CoverageDetailWorkersCompensationDim.AdmiraltyActFlag AS lkp_AdmiraltyActFlag,\n\tLKP_CoverageDetailWorkersCompensationDim.FederalEmployersLiabilityActFlag AS lkp_FederalEmployersLiabilityActFlag,\n\tLKP_CoverageDetailWorkersCompensationDim.USLongShoreAndHarborWorkersCompensationActFlag AS lkp_USLongShoreAndHarborWorkersCompensationActFlag,\n\tAGGTRANS.ExperienceModificationFactor AS i_ExperienceModificationFactor,\n\tAGGTRANS.ExperienceModificationEffectiveDate AS i_ExperienceModificationEffectiveDate,\n\tAGGTRANS.ClassCode AS i_ClassCode,\n\tAGGTRANS.ClassCodeOrganizationCode AS i_ClassCodeOrganizationCode,\n\tLKP_ClassificationReference.ClassDescription AS i_NcciClassDescription,\n\tAGGTRANS.CoverageDetailDimId AS i_CoverageDetailDimId,\n\tAGGTRANS.CoverageGuid AS i_CoverageGuid,\n\tAGGTRANS.EffectiveDate AS i_EffectiveDate,\n\tAGGTRANS.ExpirationDate AS i_ExpirationDate,\n\tAGGTRANS.PolicyPerAccidentLimit AS i_PolicyPerAccidentLimit,\n\tAGGTRANS.PolicyPerDiseaseLimit AS i_PolicyPerDiseaseLimit,\n\tAGGTRANS.PolicyAggregateLimit AS i_PolicyAggregateLimit,\n\tAGGTRANS.ConsentToRateFlag AS i_ConsentToRateFlag,\n\tAGGTRANS.RateOverride AS i_RateOverride,\n\tLKP_sup_state.state_abbrev AS i_StateCode,\n\tAGGTRANS.AdmiraltyActFlag AS i_AdmiraltyActFlag,\n\tAGGTRANS.FederalEmployersLiabilityActFlag AS i_FederalEmployersLiabilityActFlag,\n\tAGGTRANS.USLongShoreAndHarborWorkersCompensationActFlag AS i_USLongShoreAndHarborWorkersCompensationActFlag,\n\t-- *INF*: IIF(ISNULL(i_EffectiveDate), TO_DATE('1800-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS'), i_EffectiveDate)\n\tIFF(i_EffectiveDate IS NULL, TO_DATE('1800-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), i_EffectiveDate) AS v_EffectiveDate,\n\t-- *INF*: IIF(ISNULL(i_ExpirationDate), TO_DATE('2100-12-31 23:59:59','YYYY-MM-DD HH24:MI:SS'), i_ExpirationDate)\n\tIFF(i_ExpirationDate IS NULL, TO_DATE('2100-12-31 23:59:59', 'YYYY-MM-DD HH24:MI:SS'), i_ExpirationDate) AS v_ExpirationDate,\n\t-- *INF*: IIF(ISNULL(i_CoverageGuid), 'N/A', i_CoverageGuid)\n\tIFF(i_CoverageGuid IS NULL, 'N/A', i_CoverageGuid) AS v_CoverageGuid,\n\t-- *INF*: IIF(i_ClassCodeOrganizationCode='NCCI',i_ClassCode, 'N/A')\n\tIFF(i_ClassCodeOrganizationCode = 'NCCI', i_ClassCode, 'N/A') AS v_NcciClassCode,\n\t-- *INF*: IIF(ISNULL(i_NcciClassDescription), 'N/A', i_NcciClassDescription)\n\tIFF(i_NcciClassDescription IS NULL, 'N/A', i_NcciClassDescription) AS v_NcciClassDescription,\n\t-- *INF*: IIF(ISNULL(i_PolicyPerAccidentLimit), 'N/A', i_PolicyPerAccidentLimit)\n\tIFF(i_PolicyPerAccidentLimit IS NULL, 'N/A', i_PolicyPerAccidentLimit) AS v_PolicyPerAccidentLimit,\n\t-- *INF*: IIF(ISNULL(i_PolicyPerDiseaseLimit), 'N/A', i_PolicyPerDiseaseLimit)\n\tIFF(i_PolicyPerDiseaseLimit IS NULL, 'N/A', i_PolicyPerDiseaseLimit) AS v_PolicyPerDiseaseLimit,\n\t-- *INF*: IIF(ISNULL(i_PolicyAggregateLimit), 'N/A', i_PolicyAggregateLimit)\n\tIFF(i_PolicyAggregateLimit IS NULL, 'N/A', i_PolicyAggregateLimit) AS v_PolicyAggregateLimit,\n\t-- *INF*: IIF(ISNULL(i_ExperienceModificationFactor), 0, i_ExperienceModificationFactor)\n\tIFF(i_ExperienceModificationFactor IS NULL, 0, i_ExperienceModificationFactor) AS v_ExperienceModificationFactor,\n\t-- *INF*: IIF(ISNULL(i_ExperienceModificationEffectiveDate),TO_DATE('1800-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS'),i_ExperienceModificationEffectiveDate)\n\tIFF(i_ExperienceModificationEffectiveDate IS NULL, TO_DATE('1800-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), i_ExperienceModificationEffectiveDate) AS v_ExperienceModificationEffectiveDate,\n\t-- *INF*: DECODE(i_ConsentToRateFlag,'T','1','F','0','0')\n\tDECODE(i_ConsentToRateFlag,\n\t\t'T', '1',\n\t\t'F', '0',\n\t\t'0') AS v_ConsentToRateFlag,\n\t-- *INF*: IIF(ISNULL(i_RateOverride), 0, i_RateOverride)\n\tIFF(i_RateOverride IS NULL, 0, i_RateOverride) AS v_RateOverride,\n\t-- *INF*: SUBSTR(i_ClassCode,0,4)\n\tSUBSTR(i_ClassCode, 0, 4) AS v_ClassCode,\n\t-- *INF*: IIF\t(ISNULL(:LKP.LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION(i_StateCode,v_ClassCode)),:LKP.LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION('99',v_ClassCode),:LKP.LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION(i_StateCode,v_ClassCode))\n\tIFF(LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION_i_StateCode_v_ClassCode.RatableClassIndicator IS NULL, LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION__99_v_ClassCode.RatableClassIndicator, LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION_i_StateCode_v_ClassCode.RatableClassIndicator) AS v_RatableSurchargeCombined,\n\t-- *INF*: Decode(SUBSTR(v_RatableSurchargeCombined,1,1), 'X', 'N/A' , NULL , 'N/A',SUBSTR(v_RatableSurchargeCombined,1,1))\n\tDecode(SUBSTR(v_RatableSurchargeCombined, 1, 1),\n\t\t'X', 'N/A',\n\t\tNULL, 'N/A',\n\t\tSUBSTR(v_RatableSurchargeCombined, 1, 1)) AS v_RatableClassIndicator,\n\t-- *INF*: Decode(SUBSTR(v_RatableSurchargeCombined,3,1),'X','N/A',NULL,'N/A',SUBSTR(v_RatableSurchargeCombined,3,1))\n\tDecode(SUBSTR(v_RatableSurchargeCombined, 3, 1),\n\t\t'X', 'N/A',\n\t\tNULL, 'N/A',\n\t\tSUBSTR(v_RatableSurchargeCombined, 3, 1)) AS v_SurchargeClassIndicator,\n\t-- *INF*: Decode(SUBSTR(v_RatableSurchargeCombined,5,2),'X','N/A',NULL,'N/A',SUBSTR(v_RatableSurchargeCombined,5,2))\n\tDecode(SUBSTR(v_RatableSurchargeCombined, 5, 2),\n\t\t'X', 'N/A',\n\t\tNULL, 'N/A',\n\t\tSUBSTR(v_RatableSurchargeCombined, 5, 2)) AS v_HazardGroupCode,\n\t-- *INF*: DECODE(i_AdmiraltyActFlag,'T','1','F','0','0')\n\tDECODE(i_AdmiraltyActFlag,\n\t\t'T', '1',\n\t\t'F', '0',\n\t\t'0') AS v_AdmiraltyActFlag,\n\t-- *INF*: DECODE(i_FederalEmployersLiabilityActFlag,'T','1','F','0','0')\n\tDECODE(i_FederalEmployersLiabilityActFlag,\n\t\t'T', '1',\n\t\t'F', '0',\n\t\t'0') AS v_FederalEmployersLiabilityActFlag,\n\t-- *INF*: DECODE(i_USLongShoreAndHarborWorkersCompensationActFlag,'T','1','F','0','0')\n\tDECODE(i_USLongShoreAndHarborWorkersCompensationActFlag,\n\t\t'T', '1',\n\t\t'F', '0',\n\t\t'0') AS v_USLongShoreAndHarborWorkersCompensationActFlag,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- ISNULL(lkp_CoverageDetailDimId), 'NEW',\r\n\t-- lkp_EffectiveDate<>v_EffectiveDate\r\n\t-- OR lkp_ExpirationDate<>v_ExpirationDate\r\n\t-- OR lkp_CoverageGuid<>v_CoverageGuid\r\n\t-- OR LTRIM(RTRIM(lkp_NcciClassCode))<>v_NcciClassCode\r\n\t-- OR lkp_NcciClassDescription<>v_NcciClassDescription\r\n\t-- OR lkp_PolicyPerAccidentLimit<>v_PolicyPerAccidentLimit\r\n\t-- OR lkp_PolicyPerDiseaseLimit<>v_PolicyPerDiseaseLimit\r\n\t-- OR lkp_PolicyAggregateLimit<>v_PolicyAggregateLimit\r\n\t-- OR lkp_ExperienceModificationFactor<>v_ExperienceModificationFactor\r\n\t-- OR lkp_ExperienceModificationEffectiveDate<>v_ExperienceModificationEffectiveDate\r\n\t-- OR DECODE(lkp_ConsentToRateFlag,'T','1','F','0','0')<>v_ConsentToRateFlag\r\n\t-- OR lkp_RateOverride<>v_RateOverride\r\n\t-- OR  lkp_RatableClassIndicator <> v_RatableClassIndicator\r\n\t-- OR lkp_SurchargeClassIndicator <> v_SurchargeClassIndicator\r\n\t-- OR lkp_HazardGroupCode <> v_HazardGroupCode\r\n\t-- OR DECODE(lkp_AdmiraltyActFlag,'T','1','F','0','0')<>v_AdmiraltyActFlag\r\n\t-- OR DECODE(lkp_FederalEmployersLiabilityActFlag,'T','1','F','0','0')<>v_FederalEmployersLiabilityActFlag\r\n\t-- OR DECODE(lkp_USLongShoreAndHarborWorkersCompensationActFlag,'T','1','F','0','0')<>v_USLongShoreAndHarborWorkersCompensationActFlag\r\n\t-- , 'UPDATE', 'NOCHANGE')\n\tDECODE(TRUE,\n\t\tlkp_CoverageDetailDimId IS NULL, 'NEW',\n\t\tlkp_EffectiveDate <> v_EffectiveDate OR lkp_ExpirationDate <> v_ExpirationDate OR lkp_CoverageGuid <> v_CoverageGuid OR LTRIM(RTRIM(lkp_NcciClassCode)) <> v_NcciClassCode OR lkp_NcciClassDescription <> v_NcciClassDescription OR lkp_PolicyPerAccidentLimit <> v_PolicyPerAccidentLimit OR lkp_PolicyPerDiseaseLimit <> v_PolicyPerDiseaseLimit OR lkp_PolicyAggregateLimit <> v_PolicyAggregateLimit OR lkp_ExperienceModificationFactor <> v_ExperienceModificationFactor OR lkp_ExperienceModificationEffectiveDate <> v_ExperienceModificationEffectiveDate OR DECODE(lkp_ConsentToRateFlag,\n\t\t'T', '1',\n\t\t'F', '0',\n\t\t'0') <> v_ConsentToRateFlag OR lkp_RateOverride <> v_RateOverride OR lkp_RatableClassIndicator <> v_RatableClassIndicator OR lkp_SurchargeClassIndicator <> v_SurchargeClassIndicator OR lkp_HazardGroupCode <> v_HazardGroupCode OR DECODE(lkp_AdmiraltyActFlag,\n\t\t'T', '1',\n\t\t'F', '0',\n\t\t'0') <> v_AdmiraltyActFlag OR DECODE(lkp_FederalEmployersLiabilityActFlag,\n\t\t'T', '1',\n\t\t'F', '0',\n\t\t'0') <> v_FederalEmployersLiabilityActFlag OR DECODE(lkp_USLongShoreAndHarborWorkersCompensationActFlag,\n\t\t'T', '1',\n\t\t'F', '0',\n\t\t'0') <> v_USLongShoreAndHarborWorkersCompensationActFlag, 'UPDATE',\n\t\t'NOCHANGE') AS o_ChangeFlag,\n\ti_CoverageDetailDimId AS o_CoverageDetailDimId,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\tv_EffectiveDate AS o_EffectiveDate,\n\tv_ExpirationDate AS o_ExpirationDate,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\tv_CoverageGuid AS o_CoverageGuid,\n\tv_NcciClassCode AS o_NcciClassCode,\n\tv_NcciClassDescription AS o_NcciClassDescription,\n\tv_PolicyPerAccidentLimit AS o_PolicyPerAccidentLimit,\n\tv_PolicyPerDiseaseLimit AS o_PolicyPerDiseaseLimit,\n\tv_PolicyAggregateLimit AS o_PolicyAggregateLimit,\n\tv_ExperienceModificationFactor AS o_ExperienceModificationFactor,\n\tv_ExperienceModificationEffectiveDate AS o_ExperienceModificationEffectiveDate,\n\tv_ConsentToRateFlag AS o_ConsentToRateFlag,\n\tv_RateOverride AS o_RateOverride,\n\tv_RatableClassIndicator AS o_RatableClassIndicator,\n\tv_SurchargeClassIndicator AS o_SurchargeClassIndicator,\n\tv_HazardGroupCode AS o_HazardGroupCode,\n\tv_AdmiraltyActFlag AS o_AdmiraltyActFlag,\n\tv_FederalEmployersLiabilityActFlag AS o_FederalEmployersLiabilityActFlag,\n\tv_USLongShoreAndHarborWorkersCompensationActFlag AS o_USLongShoreAndHarborWorkersCompensationActFlag\n\tFROM AGGTRANS\n\tLEFT JOIN LKP_ClassificationReference\n\tON LKP_ClassificationReference.InsuranceLineCode = AGGTRANS.StandardInsuranceLineCode AND LKP_ClassificationReference.StateCode = AGGTRANS.state_code AND LKP_ClassificationReference.OriginatingOrganizationCode = AGGTRANS.ClassCodeOrganizationCode AND LKP_ClassificationReference.ClassCode = AGGTRANS.ClassCode AND LKP_ClassificationReference.ClassCodeEffectiveDate <= AGGTRANS.CoverageEffectiveDate AND LKP_ClassificationReference.ClassCodeExpirationDate >= AGGTRANS.CoverageEffectiveDate\n\tLEFT JOIN LKP_CoverageDetailWorkersCompensationDim\n\tON LKP_CoverageDetailWorkersCompensationDim.CoverageDetailDimId = AGGTRANS.CoverageDetailDimId\n\tLEFT JOIN LKP_sup_state\n\tON LKP_sup_state.state_code = AGGTRANS.state_code\n\tLEFT JOIN LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION_i_StateCode_v_ClassCode\n\tON LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION_i_StateCode_v_ClassCode.RatingStateCode = i_StateCode\n\tAND LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION_i_StateCode_v_ClassCode.ClassCode = v_ClassCode\n\n\tLEFT JOIN LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION__99_v_ClassCode\n\tON LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION__99_v_ClassCode.RatingStateCode = '99'\n\tAND LKP_SUPCLASSIFICATIONWORKERSCOMPENSATION__99_v_ClassCode.ClassCode = v_ClassCode\n\n),\nRTR_CoverageDetailWorkersCompensationDim AS (\n\tSELECT\n\to_ChangeFlag AS ChangeFlag,\n\to_CoverageDetailDimId AS CoverageDetailDimId,\n\to_AuditID AS AuditID,\n\to_EffectiveDate AS EffectiveDate,\n\to_ExpirationDate AS ExpirationDate,\n\to_CreatedDate AS CreatedDate,\n\to_ModifiedDate AS ModifiedDate,\n\to_CoverageGuid AS CoverageGuid,\n\to_NcciClassCode AS NcciClassCode,\n\to_NcciClassDescription AS NcciClassDescription,\n\to_PolicyPerAccidentLimit AS PolicyPerAccidentLimit,\n\to_PolicyPerDiseaseLimit AS PolicyPerDiseaseLimit,\n\to_PolicyAggregateLimit AS PolicyAggregateLimit,\n\to_ExperienceModificationFactor AS ExperienceModificationFactor,\n\to_ExperienceModificationEffectiveDate AS ExperienceModificationEffectiveDate,\n\to_ConsentToRateFlag,\n\to_RateOverride,\n\to_RatableClassIndicator,\n\to_SurchargeClassIndicator,\n\to_HazardGroupCode,\n\to_AdmiraltyActFlag,\n\to_FederalEmployersLiabilityActFlag,\n\to_USLongShoreAndHarborWorkersCompensationActFlag\n\tFROM EXP_AddMetaData\n),\nRTR_CoverageDetailWorkersCompensationDim_Insert AS (SELECT * FROM RTR_CoverageDetailWorkersCompensationDim WHERE ChangeFlag='NEW'),\nRTR_CoverageDetailWorkersCompensationDim_Update AS (SELECT * FROM RTR_CoverageDetailWorkersCompensationDim WHERE ChangeFlag='UPDATE'),\nUPD_Existing AS (\n\tSELECT\n\tCoverageDetailDimId, \n\tAuditID, \n\tEffectiveDate, \n\tExpirationDate, \n\tModifiedDate, \n\tCoverageGuid, \n\tNcciClassCode, \n\tNcciClassDescription, \n\tPolicyPerAccidentLimit, \n\tPolicyPerDiseaseLimit, \n\tPolicyAggregateLimit, \n\tExperienceModificationFactor, \n\tExperienceModificationEffectiveDate, \n\to_ConsentToRateFlag AS o_ConsentToRateFlag3, \n\to_RateOverride AS o_RateOverride3, \n\to_RatableClassIndicator AS o_RatableClassIndicator3, \n\to_SurchargeClassIndicator AS o_SurchargeClassIndicator3, \n\to_HazardGroupCode AS o_HazardGroupCode3, \n\to_AdmiraltyActFlag AS o_AdmiraltyActFlag3, \n\to_FederalEmployersLiabilityActFlag AS o_FederalEmployersLiabilityActFlag3, \n\to_USLongShoreAndHarborWorkersCompensationActFlag AS o_USLongShoreAndHarborWorkersCompensationActFlag3\n\tFROM RTR_CoverageDetailWorkersCompensationDim_Update\n),\nTGT_CoverageDetailWorkersCompensationDim_Update AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailWorkersCompensationDim AS T\n\tUSING UPD_Existing AS S\n\tON \n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.CoverageDetailDimId = S.CoverageDetailDimId, T.AuditId = S.AuditID, T.EffectiveDate = S.EffectiveDate, T.ExpirationDate = S.ExpirationDate, T.ModifiedDate = S.ModifiedDate, T.CoverageGuid = S.CoverageGuid, T.NcciClassCode = S.NcciClassCode, T.NcciClassDescription = S.NcciClassDescription, T.PolicyPerAccidentLimit = S.PolicyPerAccidentLimit, T.PolicyPerDiseaseLimit = S.PolicyPerDiseaseLimit, T.PolicyAggregateLimit = S.PolicyAggregateLimit, T.ExperienceModificationFactor = S.ExperienceModificationFactor, T.ExperienceModificationEffectiveDate = S.ExperienceModificationEffectiveDate, T.ConsentToRateFlag = S.o_ConsentToRateFlag3, T.RateOverride = S.o_RateOverride3, T.RatableClassIndicator = S.o_RatableClassIndicator3, T.SurchargeClassIndicator = S.o_SurchargeClassIndicator3, T.HazardGroupCode = S.o_HazardGroupCode3, T.AdmiraltyActFlag = S.o_AdmiraltyActFlag3, T.FederalEmployersLiabilityActFlag = S.o_FederalEmployersLiabilityActFlag3, T.USLongShoreAndHarborWorkersCompensationActFlag = S.o_USLongShoreAndHarborWorkersCompensationActFlag3\n),\nTGT_CoverageDetailWorkersCompensationDim_Insert AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailWorkersCompensationDim\n\t(CoverageDetailDimId, AuditId, EffectiveDate, ExpirationDate, CreatedDate, ModifiedDate, CoverageGuid, NcciClassCode, NcciClassDescription, PolicyPerAccidentLimit, PolicyPerDiseaseLimit, PolicyAggregateLimit, ExperienceModificationFactor, ExperienceModificationEffectiveDate, ConsentToRateFlag, RateOverride, RatableClassIndicator, SurchargeClassIndicator, HazardGroupCode, AdmiraltyActFlag, FederalEmployersLiabilityActFlag, USLongShoreAndHarborWorkersCompensationActFlag)\n\tSELECT \n\tCOVERAGEDETAILDIMID, \n\tAuditID AS AUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tCOVERAGEGUID, \n\tNCCICLASSCODE, \n\tNCCICLASSDESCRIPTION, \n\tPOLICYPERACCIDENTLIMIT, \n\tPOLICYPERDISEASELIMIT, \n\tPOLICYAGGREGATELIMIT, \n\tEXPERIENCEMODIFICATIONFACTOR, \n\tEXPERIENCEMODIFICATIONEFFECTIVEDATE, \n\to_ConsentToRateFlag AS CONSENTTORATEFLAG, \n\to_RateOverride AS RATEOVERRIDE, \n\to_RatableClassIndicator AS RATABLECLASSINDICATOR, \n\to_SurchargeClassIndicator AS SURCHARGECLASSINDICATOR, \n\to_HazardGroupCode AS HAZARDGROUPCODE, \n\to_AdmiraltyActFlag AS ADMIRALTYACTFLAG, \n\to_FederalEmployersLiabilityActFlag AS FEDERALEMPLOYERSLIABILITYACTFLAG, \n\to_USLongShoreAndHarborWorkersCompensationActFlag AS USLONGSHOREANDHARBORWORKERSCOMPENSATIONACTFLAG\n\tFROM RTR_CoverageDetailWorkersCompensationDim_Insert\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246503"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905513"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604118"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 01:14:33"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 01:30:27"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_WC_DATA_MART_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "WC_DATA_MART"
            },
            "WHERE_CLAUSE_DCT": {
                "type": "string",
                "defaultValue": ""
            },
            "WHERE_CLAUSE_PMS": {
                "type": "string",
                "defaultValue": ""
            }
        },
        "folder": {
            "name": "Common DataMart/"
        },
        "annotations": []
    }
}