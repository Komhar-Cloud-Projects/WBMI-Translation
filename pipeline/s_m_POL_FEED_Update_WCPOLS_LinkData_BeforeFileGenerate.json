{
    "name": "s_m_POL_FEED_Update_WCPOLS_LinkData_BeforeFileGenerate",
    "properties": {
        "activities": [
            {
                "name": "m_POL_FEED_Update_WCPOLS_LinkData_BeforeFileGenerate",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_WorkWCTrackHistoryState AS (\n\tSelect A.WCTrackHistoryID,B.State,A.StateDeletedFlag,C.OriginalLinkData,A.OriginalTransactionType,A.Auditid\r\n\t,'WorkWCTrackHistory' TableName,'TransactionType' ProcessName from WorkWCTrackHistory A\r\n\tinner join WorkWCTrackHistoryState B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID\r\n\tand B.StateDeletedFlag=A.StateDeletedFlag\r\n\tinner join WCPols00Record C\r\n\ton A.WCTrackHistoryID=C.WCTrackHistoryID\r\n\twhere (A.@{pipeline().parameters.FILENAMEREQUIREDFLAG1}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG2}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG3}=1)\r\n\tand A.StateDeletedFlag='1'\r\n\tand B.State in (@{pipeline().parameters.FILENAME})\r\n\tand A.OriginalTransactionType IN (@{pipeline().parameters.TRANSACTION_TYPE})\r\n\tand A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect A.WCTrackHistoryID,B.State,A.StateDeletedFlag,C.OriginalLinkData,A.OriginalTransactionType,A.Auditid\r\n\t,'WCPols00Record' TableName,'LinkData' ProcessName from WorkWCTrackHistory A\r\n\tinner join WorkWCTrackHistoryState B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID\r\n\tand B.StateDeletedFlag=A.StateDeletedFlag\r\n\tinner join WCPols00Record C\r\n\ton A.WCTrackHistoryID=C.WCTrackHistoryID\r\n\twhere (A.@{pipeline().parameters.FILENAMEREQUIREDFLAG1}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG2}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG3}=1)\r\n\tand A.StateDeletedFlag='1'\r\n\tand B.State in (@{pipeline().parameters.FILENAME})\r\n\tand A.OriginalTransactionType IN (@{pipeline().parameters.TRANSACTION_TYPE})\r\n\tand A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect A.WCTrackHistoryID,B.State,A.StateDeletedFlag,C.OriginalLinkData,A.OriginalTransactionType,A.Auditid\r\n\t,'WCPols00Record' TableName,'TransactionCode' ProcessName from WorkWCTrackHistory A\r\n\tinner join WorkWCTrackHistoryState B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID\r\n\tand B.StateDeletedFlag=A.StateDeletedFlag\r\n\tinner join WCPols00Record C\r\n\ton A.WCTrackHistoryID=C.WCTrackHistoryID\r\n\twhere (A.@{pipeline().parameters.FILENAMEREQUIREDFLAG1}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG2}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG3}=1)\r\n\tand A.StateDeletedFlag='1'\r\n\tand B.State in (@{pipeline().parameters.FILENAME})\r\n\tand A.OriginalTransactionType IN (@{pipeline().parameters.TRANSACTION_TYPE})\r\n\tand A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect A.WCTrackHistoryID,B.State,A.StateDeletedFlag,C.OriginalLinkData,\r\n\t'48' OriginalTransactionType ,A.Auditid,'WCPols08RecordWI' TableName,'StateCode' ProcessName \r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WorkWCTrackHistoryState B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID\r\n\tand B.StateDeletedFlag=A.StateDeletedFlag\r\n\tinner join WCPols00Record C\r\n\ton A.WCTrackHistoryID=C.WCTrackHistoryID\r\n\twhere (A.@{pipeline().parameters.FILENAMEREQUIREDFLAG1}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG2}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG3}=1)\r\n\tand A.StateDeletedFlag='1'\r\n\tand B.State in (@{pipeline().parameters.FILENAME})\r\n\tand A.OriginalTransactionType IN (@{pipeline().parameters.TRANSACTION_TYPE})\r\n\tand A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\t@{pipeline().parameters.LOGIC_REQUIRED}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect *\r\n\tfrom (\r\n\t\tSelect A.WCTrackHistoryID,B.State,A.StateDeletedFlag,C.OriginalLinkData,\r\n\t\tcase\r\n\t\t\twhen B.State = 'NC'\r\n\t\t\tand 'NC' in (@{pipeline().parameters.FILENAME})\r\n\t\t\tthen '32'\r\n\t\t\twhen B.State = 'MN'\r\n\t\t\tand 'MN' in (@{pipeline().parameters.FILENAME})\r\n\t\t\tthen '22'\r\n\t\t\telse '99'\r\n\t\tend OriginalTransactionType ,A.Auditid,'WCPols08Record' TableName,'StateCode' ProcessName \r\n\t\tfrom WorkWCTrackHistory A\r\n\t\tinner join WorkWCTrackHistoryState B\r\n\t\ton A.WCTrackHistoryID=B.WCTrackHistoryID\r\n\t\tand B.StateDeletedFlag=A.StateDeletedFlag\r\n\t\tinner join WCPols00Record C\r\n\t\ton A.WCTrackHistoryID=C.WCTrackHistoryID\r\n\t\twhere (A.@{pipeline().parameters.FILENAMEREQUIREDFLAG1}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG2}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG3}=1)\r\n\t\tand A.StateDeletedFlag='1'\r\n\t\tand B.State in (@{pipeline().parameters.FILENAME})\r\n\t\tand A.OriginalTransactionType IN (@{pipeline().parameters.TRANSACTION_TYPE})\r\n\t\tand A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\t\t@{pipeline().parameters.LOGIC_REQUIRED}\r\n\t) A\r\n\twhere A.OriginalTransactionType <> '99'\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect A.WCTrackHistoryID,B.State,A.StateDeletedFlag,C.OriginalLinkData,\r\n\t'03' OriginalTransactionType ,A.Auditid,'WCPols08RecordWI' TableName,'ReasonForCancellationCode' ProcessName \r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WorkWCTrackHistoryState B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID\r\n\tand B.StateDeletedFlag=A.StateDeletedFlag\r\n\tinner join WCPols00Record C\r\n\ton A.WCTrackHistoryID=C.WCTrackHistoryID\r\n\twhere (A.@{pipeline().parameters.FILENAMEREQUIREDFLAG1}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG2}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG3}=1)\r\n\tand A.StateDeletedFlag='1'\r\n\tand B.State in (@{pipeline().parameters.FILENAME})\r\n\tand A.OriginalTransactionType IN (@{pipeline().parameters.TRANSACTION_TYPE})\r\n\tand A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\t@{pipeline().parameters.LOGIC_REQUIRED}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect A.WCTrackHistoryID,B.State,A.StateDeletedFlag,C.OriginalLinkData,\r\n\t'03' OriginalTransactionType ,A.Auditid,'WCPols08Record' TableName,'ReasonForCancellationCode' ProcessName \r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WorkWCTrackHistoryState B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID\r\n\tand B.StateDeletedFlag=A.StateDeletedFlag\r\n\tinner join WCPols00Record C\r\n\ton A.WCTrackHistoryID=C.WCTrackHistoryID\r\n\twhere (A.@{pipeline().parameters.FILENAMEREQUIREDFLAG1}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG2}=1 or A.@{pipeline().parameters.FILENAMEREQUIREDFLAG3}=1)\r\n\tand A.StateDeletedFlag='1'\r\n\tand B.State in (@{pipeline().parameters.FILENAME})\r\n\tand A.OriginalTransactionType IN (@{pipeline().parameters.TRANSACTION_TYPE})\r\n\tand A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\t@{pipeline().parameters.LOGIC_REQUIRED}\n),\nEXP_Source AS (\n\tSELECT\n\tWCTrackHistoryID,\n\t-- *INF*: TO_CHAR(WCTrackHistoryID)\n\tTO_CHAR(WCTrackHistoryID) AS o_WCTrackHistoryID,\n\tState,\n\tStateDeletedFlag,\n\tOriginalLinkData,\n\tOriginalTransactionType,\n\tAuditid,\n\tTableName,\n\tProcessName,\n\t-- *INF*: SUBSTR(OriginalLinkData,1,41)\n\tSUBSTR(OriginalLinkData, 1, 41) AS v_OriginalLinkData,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- LTRIM(RTRIM(OriginalTransactionType))='EndorseAddDeleteState' AND StateDeletedFlag='T','05',\r\n\t-- '15')\n\tDECODE(\n\t    TRUE,\n\t    LTRIM(RTRIM(OriginalTransactionType)) = 'EndorseAddDeleteState' AND StateDeletedFlag = 'T', '05',\n\t    '15'\n\t) AS v_TransactionCode,\n\t-- *INF*: DECODE(Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID},\r\n\t-- LTRIM(RTRIM(TableName))='WorkWCTrackHistory'\r\n\t-- AND @{pipeline().parameters.SET_REVERT}='SET','Cancel',\r\n\t-- LTRIM(RTRIM(TableName))='WorkWCTrackHistory'\r\n\t-- AND @{pipeline().parameters.SET_REVERT}='REVERT',OriginalTransactionType,\r\n\t-- LTRIM(RTRIM(TableName))='WCPols00Record' AND LTRIM(RTRIM(ProcessName))='LinkData' \r\n\t-- AND @{pipeline().parameters.SET_REVERT}='SET',LTRIM(RTRIM(v_OriginalLinkData))||LTRIM(RTRIM(v_TransactionCode)),\r\n\t-- LTRIM(RTRIM(TableName))='WCPols00Record' AND LTRIM(RTRIM(ProcessName))='LinkData' \r\n\t-- AND @{pipeline().parameters.SET_REVERT}='REVERT',OriginalLinkData,\r\n\t-- LTRIM(RTRIM(TableName))='WCPols00Record' AND LTRIM(RTRIM(ProcessName))='TransactionCode' \r\n\t-- AND @{pipeline().parameters.SET_REVERT}='SET','05',\r\n\t-- LTRIM(RTRIM(TableName))='WCPols00Record' AND LTRIM(RTRIM(ProcessName))='TransactionCode' \r\n\t-- AND @{pipeline().parameters.SET_REVERT}='REVERT','15',\r\n\t-- LTRIM(RTRIM(TableName))='WCPols08RecordWI',\r\n\t-- LTRIM(RTRIM(OriginalTransactionType)),\r\n\t-- LTRIM(RTRIM(TableName))='WCPols08Record',\r\n\t-- LTRIM(RTRIM(OriginalTransactionType))\r\n\t-- )\n\tDECODE(\n\t    Auditid = @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID},\n\t    LTRIM(RTRIM(TableName)) = 'WorkWCTrackHistory' AND @{pipeline().parameters.SET_REVERT} = 'SET', 'Cancel',\n\t    LTRIM(RTRIM(TableName)) = 'WorkWCTrackHistory' AND @{pipeline().parameters.SET_REVERT} = 'REVERT', OriginalTransactionType,\n\t    LTRIM(RTRIM(TableName)) = 'WCPols00Record' AND LTRIM(RTRIM(ProcessName)) = 'LinkData' AND @{pipeline().parameters.SET_REVERT} = 'SET', LTRIM(RTRIM(v_OriginalLinkData)) || LTRIM(RTRIM(v_TransactionCode)),\n\t    LTRIM(RTRIM(TableName)) = 'WCPols00Record' AND LTRIM(RTRIM(ProcessName)) = 'LinkData' AND @{pipeline().parameters.SET_REVERT} = 'REVERT', OriginalLinkData,\n\t    LTRIM(RTRIM(TableName)) = 'WCPols00Record' AND LTRIM(RTRIM(ProcessName)) = 'TransactionCode' AND @{pipeline().parameters.SET_REVERT} = 'SET', '05',\n\t    LTRIM(RTRIM(TableName)) = 'WCPols00Record' AND LTRIM(RTRIM(ProcessName)) = 'TransactionCode' AND @{pipeline().parameters.SET_REVERT} = 'REVERT', '15',\n\t    LTRIM(RTRIM(TableName)) = 'WCPols08RecordWI', LTRIM(RTRIM(OriginalTransactionType)),\n\t    LTRIM(RTRIM(TableName)) = 'WCPols08Record', LTRIM(RTRIM(OriginalTransactionType))\n\t) AS v_TableUpdate,\n\tv_TableUpdate AS UpdateValue\n\tFROM SQ_WorkWCTrackHistoryState\n),\nSQL AS (-- SQL\n\n\t##############################################\n\n\t# TODO: Place holder for Custom transformation\n\n\t##############################################\n),\nEXP_SQLOutput AS (\n\tSELECT\n\tSQLError,\n\tNumRowsAffected,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- NOT ISNULL(SQLError),'ErrorFile',\r\n\t-- (ISNULL(SQLError) OR length(rtrim(ltrim(SQLError)))=0) AND NOT ISNULL(UpdateValue),'UpdateList',\r\n\t-- '')\n\tDECODE(\n\t    TRUE,\n\t    SQLError IS NOT NULL, 'ErrorFile',\n\t    (SQLError IS NULL OR length(rtrim(ltrim(SQLError))) = 0) AND UpdateValue IS NOT NULL, 'UpdateList',\n\t    ''\n\t) AS v_FileName,\n\t@{pipeline().parameters.FILENAME}||@{pipeline().parameters.SET_REVERT}||v_FileName||'.txt' AS FileName,\n\to_WCTrackHistoryID AS WCTrackHistoryID,\n\to_State AS State,\n\to_StateDeletedFlag AS StateDeletedFlag,\n\to_OriginalLinkData AS OriginalLinkData,\n\to_OriginalTransactionType AS OriginalTransactionType,\n\to_Auditid AS Auditid,\n\to_TableName AS TableName,\n\to_ProcessName AS ProcessName,\n\to_UpdateValue AS UpdateValue,\n\t-- *INF*: 'Update dbo.'||TableName||' A Set A.'||ProcessName||'='||UpdateValue||' where A.WCTrackHistoryID='||WCTrackHistoryID|| '----- '||@{pipeline().parameters.FILENAME}||' - '||@{pipeline().parameters.SET_REVERT}||' - '||@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}||' NumRowsAffected - '||NumRowsAffected\n\t'Update dbo.' || TableName || ' A Set A.' || ProcessName || '=' || UpdateValue || ' where A.WCTrackHistoryID=' || WCTrackHistoryID || '----- ' || @{pipeline().parameters.FILENAME} || ' - ' || @{pipeline().parameters.SET_REVERT} || ' - ' || @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} || ' NumRowsAffected - ' || NumRowsAffected AS SQLUpdate\n\tFROM SQL\n),\nRTR_SQLError AS (\n\tSELECT\n\tSQLError,\n\tNumRowsAffected,\n\tFileName,\n\tWCTrackHistoryID,\n\tState,\n\tStateDeletedFlag,\n\tOriginalLinkData,\n\tOriginalTransactionType,\n\tAuditid,\n\tTableName,\n\tProcessName,\n\tUpdateValue,\n\tSQLUpdate\n\tFROM EXP_SQLOutput\n),\nRTR_SQLError_Error_Group AS (SELECT * FROM RTR_SQLError WHERE NOT ISNULL(SQLError)),\nRTR_SQLError_Update_Scripts AS (SELECT * FROM RTR_SQLError WHERE (ISNULL(SQLError) OR length(rtrim(ltrim(SQLError)))=0) AND NOT ISNULL(UpdateValue)),\nWCPOLS_UpdateStatements_FlatFile AS (\n\tINSERT INTO WCPOLS_UpdateStatements_FlatFile\n\t(FlatFileComments)\n\tSELECT \n\tSQLUpdate AS FLATFILECOMMENTS\n\tFROM RTR_SQLError_Update_Scripts\n),\nWCPOLS_UpdateStatements_FlatFile_SQLError AS (\n\tINSERT INTO WCPOLS_UpdateStatements_FlatFile\n\t(FlatFileComments)\n\tSELECT \n\tSQLError AS FLATFILECOMMENTS\n\tFROM RTR_SQLError_Error_Group\n),\nSQ_WorkWCTrackHistoryState_DeletedAttributes AS (\n\tSelect B.WCPols02RecordID,NULL UpdatedValue,\r\n\tA.Auditid,'WCPols02Record' TableName,'PolicyChangeEffectiveDate' ProcessName ,'WCPols02RecordID' UpdatedRecord\r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WCPols02Record B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID and A.TransactionType like 'Endorse%'\r\n\twhere A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tand A.TransactionType like 'Endorse%'\r\n\tand B.PolicyChangeEffectiveDate=B.PolicyChangeExpirationDate\r\n\tand '@{pipeline().parameters.SET_REVERT}'='SET'\r\n\t@{pipeline().parameters.DELETED_ATRIBUTES}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect B.WCPols03RecordID,NULL UpdatedValue,\r\n\tA.Auditid,'WCPols03Record' TableName,'PolicyChangeEffectiveDate' ProcessName ,'WCPols03RecordID' UpdatedRecord\r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WCPols03Record B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID and A.TransactionType like 'Endorse%'\r\n\twhere A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tand A.TransactionType like 'Endorse%'\r\n\tand B.PolicyChangeEffectiveDate=B.PolicyChangeExpirationDate\r\n\tand '@{pipeline().parameters.SET_REVERT}'='SET'\r\n\t@{pipeline().parameters.DELETED_ATRIBUTES}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect B.WCPols04RecordID,NULL UpdatedValue,\r\n\tA.Auditid,'WCPols04Record' TableName,'PolicyChangeEffectiveDate' ProcessName ,'WCPols04RecordID' UpdatedRecord\r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WCPols04Record B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID and A.TransactionType like 'Endorse%'\r\n\twhere A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tand A.TransactionType like 'Endorse%'\r\n\tand B.PolicyChangeEffectiveDate=B.PolicyChangeExpirationDate\r\n\tand '@{pipeline().parameters.SET_REVERT}'='SET'\r\n\t@{pipeline().parameters.DELETED_ATRIBUTES}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect B.WCPols05RecordID,NULL UpdatedValue,\r\n\tA.Auditid,'WCPols05Record' TableName,'PolicyChangeEffectiveDate' ProcessName ,'WCPols05RecordID' UpdatedRecord\r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WCPols05Record B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID and A.TransactionType like 'Endorse%'\r\n\twhere A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tand A.TransactionType like 'Endorse%'\r\n\tand B.PolicyChangeEffectiveDate=B.PolicyChangeExpirationDate\r\n\tand '@{pipeline().parameters.SET_REVERT}'='SET'\r\n\t@{pipeline().parameters.DELETED_ATRIBUTES}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect C.WCPols01RecordId,\r\n\t'1' UpdatedValue,\r\n\tA.Auditid,\r\n\t'WCPols01Record' TableName,\r\n\t'ExperienceRatingCode' ProcessName,\r\n\t'WCPols01RecordId' UpdatedRecord\r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WorkWCProcessUpdateTable B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID\r\n\tand A.Auditid = B.Auditid\r\n\tand B.ProcessName='ExpRatingCode-01'\r\n\tinner join WCPols01Record C\r\n\ton A.WCTrackHistoryID=C.WCTrackHistoryID\r\n\tand A.Auditid = C.AuditId\r\n\twhere A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tand 'NC' in (@{pipeline().parameters.FILENAME})\r\n\tand '@{pipeline().parameters.SET_REVERT}'='SET'\r\n\t@{pipeline().parameters.NC_ATTRIBUTES}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect C.WCPols01RecordId,\r\n\t'2' UpdatedValue,\r\n\tA.Auditid,\r\n\t'WCPols01Record' TableName,\r\n\t'ExperienceRatingCode' ProcessName,\r\n\t'WCPols01RecordId' UpdatedRecord\r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WorkWCProcessUpdateTable B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID\r\n\tand B.ProcessName='ExpRatingCode-01'\r\n\tand A.Auditid = B.Auditid\r\n\tinner join WCPols01Record C\r\n\ton A.WCTrackHistoryID=C.WCTrackHistoryID\r\n\tand A.Auditid = C.AuditId\r\n\twhere A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tand 'NC' in (@{pipeline().parameters.FILENAME})\r\n\tand '@{pipeline().parameters.SET_REVERT}'='REVERT'\r\n\t@{pipeline().parameters.NC_ATTRIBUTES}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect C.WCPols04RecordID,\r\n\t'0000' UpdatedValue,\r\n\tA.Auditid,\r\n\t'WCPols04Record' TableName,\r\n\t'ExperienceModificationFactorMeritRatingFactor' ProcessName,\r\n\t'WCPols04RecordID' UpdatedRecord\r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WorkWCProcessUpdateTable B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID\r\n\tand A.Auditid = B.Auditid\r\n\tand B.ProcessName='ExpModFactor-04'\r\n\tinner join WCPols04Record C\r\n\ton A.WCTrackHistoryID=C.WCTrackHistoryID\r\n\tand A.Auditid = C.AuditId\r\n\tand C.ExperienceModificationFactorMeritRatingFactor = '1000'\r\n\twhere A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tand 'WI' in (@{pipeline().parameters.FILENAME})\r\n\tand '@{pipeline().parameters.SET_REVERT}'='SET'\r\n\t@{pipeline().parameters.WI_ATTRIBUTES}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect C.WCPols04RecordID,\r\n\t'1000' UpdatedValue,\r\n\tA.Auditid,\r\n\t'WCPols04Record' TableName,\r\n\t'ExperienceModificationFactorMeritRatingFactor' ProcessName,\r\n\t'WCPols04RecordID' UpdatedRecord\r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WorkWCProcessUpdateTable B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID\r\n\tand B.ProcessName='ExpModFactor-04'\r\n\tand A.Auditid = B.Auditid\r\n\tinner join WCPols04Record C\r\n\ton A.WCTrackHistoryID=C.WCTrackHistoryID\r\n\tand A.Auditid = C.AuditId\r\n\tand C.ExperienceModificationFactorMeritRatingFactor = '0000'\r\n\twhere A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tand 'WI' in (@{pipeline().parameters.FILENAME})\r\n\tand '@{pipeline().parameters.SET_REVERT}'='REVERT'\r\n\t@{pipeline().parameters.WI_ATTRIBUTES}\n),\nEXP_Source_DeletedAttributes AS (\n\tSELECT\n\tWCPolsRecordID,\n\t-- *INF*: TO_CHAR(WCPolsRecordID)\n\tTO_CHAR(WCPolsRecordID) AS o_WCPolsRecordID,\n\tUpdatedValue,\n\tAuditid,\n\tTableName,\n\tProcessName,\n\tUpdatedRecord,\n\t-- *INF*: IIF(Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID},\r\n\t-- UpdatedValue,'')\n\tIFF(Auditid = @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}, UpdatedValue, '') AS v_TableUpdate,\n\tv_TableUpdate AS UpdateValue\n\tFROM SQ_WorkWCTrackHistoryState_DeletedAttributes\n),\nSQL_DeletedAttributes AS (-- SQL_DeletedAttributes\n\n\t##############################################\n\n\t# TODO: Place holder for Custom transformation\n\n\t##############################################\n),\nWCPOLS_UpdateStatements_FlatFile_DeletedError AS (\n\tINSERT INTO WCPOLS_UpdateStatements_FlatFile\n\t(FlatFileComments)\n\tSELECT \n\tSQLError AS FLATFILECOMMENTS\n\tFROM SQL_DeletedAttributes\n),\nSQ_WCPols02Record_DBAName AS (\n\tSelect distinct A.WCTrackHistoryID, REPLACE(NameOfInsured,CHAR(39),'') NameOfInsured, ProcessName,REPLACE(AttributeValue,CHAR(39),'') AttributeValue,\r\n\tA.Auditid,'WCPols02Record' TableName,'NameOfInsured' FieldName ,'WCTrackHistoryID' Condition1,'NameOfInsured' Condition2\r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WorkWCProcessUpdateTable B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID and B.ProcessName='DBA'\r\n\tinner join WCPols02Record C\r\n\ton C.WCTrackHistoryID=A.WCTrackHistoryID and REPLACE(NameOfInsured,CHAR(39),'')=REPLACE(AttributeValue,CHAR(39),'')where A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tand '@{pipeline().parameters.SET_REVERT}'='SET'\r\n\t@{pipeline().parameters.DBA_UPDATE}\r\n\t\r\n\tUNION\r\n\t\r\n\tSelect distinct A.WCTrackHistoryID, REPLACE(NameOfInsured,CHAR(39),'') NameOfInsured, ProcessName,REPLACE(AttributeValue,CHAR(39),'') AttributeValue,\r\n\tA.Auditid,'WCPols02Record' TableName,'NameOfInsured' FieldName ,'WCTrackHistoryID' Condition1,'NameOfInsured' Condition2\r\n\tfrom WorkWCTrackHistory A\r\n\tinner join WorkWCProcessUpdateTable B\r\n\ton A.WCTrackHistoryID=B.WCTrackHistoryID and B.ProcessName='DBA'\r\n\tinner join WCPols02Record C\r\n\ton C.WCTrackHistoryID=A.WCTrackHistoryID and REPLACE(NameOfInsured,CHAR(39),'')=CONCAT('DBA ',REPLACE(AttributeValue,CHAR(39),'')) where A.Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tand '@{pipeline().parameters.SET_REVERT}'='REVERT'\r\n\t@{pipeline().parameters.DBA_UPDATE}\n),\nEXP_DBAName_Update AS (\n\tSELECT\n\tWCPolsRecordID,\n\t-- *INF*: TO_CHAR(WCPolsRecordID)\n\tTO_CHAR(WCPolsRecordID) AS o_WCPolsRecordID,\n\tNameOfInsured,\n\tProcessName,\n\tAttributeValue,\n\tAuditid,\n\tTableName,\n\tFieldName,\n\tCondition1,\n\tCondition2,\n\t-- *INF*: DECODE(Auditid=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID},\r\n\t-- @{pipeline().parameters.SET_REVERT}='SET',\r\n\t-- CONCAT(CONCAT(ProcessName,' ') ,AttributeValue),\r\n\t-- @{pipeline().parameters.SET_REVERT}='REVERT',AttributeValue,\r\n\t-- '')\n\tDECODE(\n\t    Auditid = @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID},\n\t    @{pipeline().parameters.SET_REVERT} = 'SET', CONCAT(CONCAT(ProcessName, ' '), AttributeValue),\n\t    @{pipeline().parameters.SET_REVERT} = 'REVERT', AttributeValue,\n\t    ''\n\t) AS v_TableUpdate,\n\tv_TableUpdate AS UpdateValue\n\tFROM SQ_WCPols02Record_DBAName\n),\nSQL_DBANameUpdate AS (-- SQL_DBANameUpdate\n\n\t##############################################\n\n\t# TODO: Place holder for Custom transformation\n\n\t##############################################\n),\nWCPOLS_UpdateStatements_FlatFile_DBAName AS (\n\tINSERT INTO WCPOLS_UpdateStatements_FlatFile\n\t(FlatFileComments)\n\tSELECT \n\tSQLError AS FLATFILECOMMENTS\n\tFROM SQL_DBANameUpdate\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "FILENAMEREQUIREDFLAG1": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "FILENAMEREQUIREDFLAG2": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "FILENAMEREQUIREDFLAG3": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "FILENAME": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TRANSACTION_TYPE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "LOGIC_REQUIRED": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SET_REVERT": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "DELETED_ATRIBUTES": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "NC_ATTRIBUTES": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WI_ATTRIBUTES": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "DBA_UPDATE": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "PolicyDataServices/"
        },
        "annotations": []
    }
}