{
    "name": "s_m_CLM_DM_LOAD_coverage_dim",
    "properties": {
        "activities": [
            {
                "name": "m_CLM_DM_LOAD_coverage_dim",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_claimant_coverage_detail AS (\n\tSELECT CCD.claimant_cov_det_id,\r\n\t       CCD.claimant_cov_det_ak_id,\r\n\t       CCD.s3p_unit_type_code,\r\n\t       CCD.loc_unit_num,\r\n\t       CCD.sub_loc_unit_num,\r\n\t       CCD.ins_line,\r\n\t       CCD.risk_unit_grp,\r\n\t       CCD.risk_unit_grp_seq_num,\r\n\t       CCD.risk_unit,\r\n\t       CCD.risk_unit_seq_num,\r\n\t       CCD.major_peril_code,\r\n\t       CCD.major_peril_seq,\r\n\t       CCD.reserve_ctgry,\r\n\t       CCD.cause_of_loss,\r\n\t       CCD.pms_type_bureau_code,\r\n\t       CCD.claimant_cov_eff_date,\r\n\t       CCD.risk_type_ind,\r\n\t       CCD.spec_pers_prop_use_code,\r\n\t       CCD.pkg_ded_amt,\r\n\t       CCD.pkg_lmt_amt,\r\n\t       CCD.unit_veh_registration_state_code,\r\n\t       CCD.unit_veh_stated_amt,\r\n\t       CCD.unit_veh_yr,\r\n\t       CCD.unit_veh_make,\r\n\t       CCD.unit_vin_num,\r\n\t       CCD.audit_id,\r\n\t       CCD.eff_from_date\r\n\tFROM   claimant_coverage_detail CCD\r\n\tWHERE  CCD.created_date >= '@{pipeline().parameters.SELECTION_START_TS}'\n),\nEXP_get_values AS (\n\tSELECT\n\tclaimant_cov_det_id,\n\tins_line,\n\t-- *INF*: LTRIM(RTRIM(ins_line))\n\tLTRIM(RTRIM(ins_line)) AS ins_line_OUT,\n\tmajor_peril_code,\n\t-- *INF*: LTRIM(RTRIM(major_peril_code))\n\tLTRIM(RTRIM(major_peril_code)) AS major_peril_code_OUT,\n\treserve_ctgry,\n\t-- *INF*: LTRIM(RTRIM(reserve_ctgry))\n\tLTRIM(RTRIM(reserve_ctgry)) AS reserve_ctgry_OUT,\n\tcause_of_loss,\n\t-- *INF*: LTRIM(RTRIM(cause_of_loss))\n\tLTRIM(RTRIM(cause_of_loss)) AS cause_of_loss_OUT,\n\tmajor_peril_seq,\n\trisk_unit_grp,\n\t-- *INF*: LTRIM(RTRIM(risk_unit_grp))\n\tLTRIM(RTRIM(risk_unit_grp)) AS risk_unit_grp_OUT,\n\trisk_unit_grp_seq_num,\n\trisk_unit,\n\t-- *INF*: LTRIM(RTRIM(risk_unit))\n\tLTRIM(RTRIM(risk_unit)) AS risk_unit_OUT,\n\trisk_unit_seq_num,\n\tunit_veh_registration_state_code,\n\tunit_vin_num,\n\tunit_veh_stated_amt,\n\tunit_veh_yr,\n\tunit_veh_make,\n\ts3p_unit_type_code,\n\tloc_unit_num,\n\tsub_loc_unit_num,\n\trisk_type_ind,\n\t-- *INF*: LTRIM(RTRIM(risk_type_ind))\n\tLTRIM(RTRIM(risk_type_ind)) AS risk_type_ind_OUT,\n\tspec_pers_prop_use_code,\n\tpkg_ded_amt,\n\tpkg_lmt_amt,\n\tpms_type_bureau_code,\n\tclaimant_cov_det_ak_id,\n\teff_from_date,\n\tclaimant_cov_eff_date,\n\taudit_id\n\tFROM SQ_claimant_coverage_detail\n),\nLKP_sup_claim_reserve_category AS (\n\tSELECT\n\tIN_reserve_ctgry,\n\tsup_claim_reserve_ctgry_id,\n\treserve_ctgry_code,\n\treserve_ctgry_descript,\n\tcrrnt_snpsht_flag\n\tFROM (\n\t\tSELECT sup_claim_reserve_category.sup_claim_reserve_ctgry_id as sup_claim_reserve_ctgry_id,\r\n\t\t LTRIM(RTRIM(sup_claim_reserve_category.reserve_ctgry_descript)) as reserve_ctgry_descript,\r\n\t\tsup_claim_reserve_category.crrnt_snpsht_flag as crrnt_snpsht_flag, \r\n\t\t LTRIM(RTRIM(sup_claim_reserve_category.reserve_ctgry_code)) as reserve_ctgry_code\r\n\t\t FROM sup_claim_reserve_category where crrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY reserve_ctgry_code ORDER BY IN_reserve_ctgry) = 1\n),\nLKP_sup_major_peril AS (\n\tSELECT\n\tIN_major_peril_code,\n\tmajor_peril_code,\n\tmajor_peril_descript,\n\tcrrnt_snpsht_flag\n\tFROM (\n\t\tSELECT sup_major_peril.major_peril_descript as major_peril_descript, sup_major_peril.crrnt_snpsht_flag as crrnt_snpsht_flag, sup_major_peril.major_peril_code as major_peril_code FROM sup_major_peril WHERE sup_major_peril.crrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY major_peril_code ORDER BY IN_major_peril_code) = 1\n),\nLKP_sup_risk_unit AS (\n\tSELECT\n\tIN_risk_unit,\n\tIN_ins_line,\n\trisk_unit_code,\n\trisk_unit_descript,\n\tins_line\n\tFROM (\n\t\tSELECT sup_risk_unit.risk_unit_descript as risk_unit_descript,\r\n\t\tLTRIM(RTRIM( sup_risk_unit.risk_unit_code)) as risk_unit_code,\r\n\t\t LTRIM(RTRIM( sup_risk_unit.ins_line)) as ins_line \r\n\t\tFROM sup_risk_unit\r\n\t\twhere sup_risk_unit.crrnt_snpsht_flag='1'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY risk_unit_code,ins_line ORDER BY IN_risk_unit) = 1\n),\nLKP_sup_risk_unit_group AS (\n\tSELECT\n\tIN_risk_unit_grp,\n\tIN_ins_line,\n\tIN_risk_type_ind,\n\trisk_unit_grp_code,\n\trisk_unit_grp_descript,\n\tprdct_type_code,\n\tlob,\n\tins_line,\n\tcrrnt_snpsht_flag\n\tFROM (\n\t\tSELECT  LTRIM(RTRIM(sup_risk_unit_group.risk_unit_grp_descript)) as risk_unit_grp_descript, \r\n\t\tsup_risk_unit_group.lob as lob, \r\n\t\tsup_risk_unit_group.crrnt_snpsht_flag as crrnt_snpsht_flag, \r\n\t\tLTRIM(RTRIM(sup_risk_unit_group.risk_unit_grp_code)) as risk_unit_grp_code, \r\n\t\tLTRIM(RTRIM(sup_risk_unit_group.ins_line)) as ins_line,\r\n\t\t LTRIM(RTRIM(sup_risk_unit_group.prdct_type_code)) as prdct_type_code\r\n\t\t FROM sup_risk_unit_group \r\n\t\twhere sup_risk_unit_group.crrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY risk_unit_grp_code,ins_line,prdct_type_code ORDER BY IN_risk_unit_grp) = 1\n),\nlkp_sup_insurance_line AS (\n\tSELECT\n\tsup_ins_line_id,\n\tins_line_code,\n\tins_line_descript,\n\tIN_ins_line_code\n\tFROM (\n\t\tSELECT sup_insurance_line.sup_ins_line_id as sup_ins_line_id, sup_insurance_line.ins_line_descript as ins_line_descript, sup_insurance_line.ins_line_code as ins_line_code FROM sup_insurance_line where crrnt_snpsht_flag = '1'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ins_line_code ORDER BY sup_ins_line_id) = 1\n),\nEXP_DEFAULT_VALUES AS (\n\tSELECT\n\tEXP_get_values.claimant_cov_det_id,\n\tEXP_get_values.ins_line_OUT AS ins_line,\n\tlkp_sup_insurance_line.ins_line_descript,\n\t-- *INF*: IIF(ISNULL(ins_line_descript), 'N/A', ins_line_descript)\n\tIFF(ins_line_descript IS NULL, 'N/A', ins_line_descript) AS ins_line_descript_out,\n\tEXP_get_values.major_peril_code_OUT AS major_peril_code,\n\tLKP_sup_major_peril.major_peril_descript,\n\t-- *INF*: IIF(ISNULL(major_peril_descript), 'N/A', major_peril_descript )\n\tIFF(major_peril_descript IS NULL, 'N/A', major_peril_descript) AS major_peril_descript_out,\n\tEXP_get_values.major_peril_seq,\n\tEXP_get_values.cause_of_loss_OUT AS cause_of_loss,\n\t-- *INF*: iif(isnull(cause_of_loss_short_descript),'N/A',cause_of_loss_short_descript)\n\tIFF(cause_of_loss_short_descript IS NULL, 'N/A', cause_of_loss_short_descript) AS cause_of_loss_short_descript_out,\n\t-- *INF*: iif(isnull(cause_of_loss_long_descript),'N/A',cause_of_loss_long_descript)\n\tIFF(cause_of_loss_long_descript IS NULL, 'N/A', cause_of_loss_long_descript) AS cause_of_loss_long_descript_out,\n\tEXP_get_values.reserve_ctgry_OUT AS reserve_ctgry,\n\tLKP_sup_claim_reserve_category.reserve_ctgry_descript,\n\t-- *INF*: iif(isnull(reserve_ctgry_descript),'N/A',reserve_ctgry_descript)\n\tIFF(reserve_ctgry_descript IS NULL, 'N/A', reserve_ctgry_descript) AS reserve_ctgry_descript_out,\n\tEXP_get_values.risk_unit_grp_OUT AS risk_unit_grp,\n\tLKP_sup_risk_unit_group.risk_unit_grp_descript,\n\t-- *INF*: IIF(ISNULL(risk_unit_grp_descript), 'N/A', risk_unit_grp_descript)\n\tIFF(risk_unit_grp_descript IS NULL, 'N/A', risk_unit_grp_descript) AS risk_unit_grp_descript_out,\n\tEXP_get_values.risk_unit_grp_seq_num,\n\tEXP_get_values.risk_unit_OUT AS risk_unit,\n\tLKP_sup_risk_unit.risk_unit_descript,\n\t-- *INF*: IIF(ISNULL(risk_unit_descript), 'N/A', risk_unit_descript)\n\tIFF(risk_unit_descript IS NULL, 'N/A', risk_unit_descript) AS risk_unit_descript_out,\n\tEXP_get_values.risk_unit_seq_num,\n\tEXP_get_values.unit_veh_registration_state_code,\n\tEXP_get_values.unit_vin_num,\n\tEXP_get_values.unit_veh_stated_amt,\n\tEXP_get_values.unit_veh_yr,\n\tEXP_get_values.unit_veh_make,\n\tEXP_get_values.s3p_unit_type_code,\n\tEXP_get_values.pms_type_bureau_code,\n\tEXP_get_values.loc_unit_num,\n\tEXP_get_values.spec_pers_prop_use_code,\n\tEXP_get_values.pkg_ded_amt,\n\tEXP_get_values.pkg_lmt_amt,\n\t1 AS crrnt_snpsht_flag,\n\t-- *INF*: IIF(source_audit_id < 0 , source_audit_id , @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID})\r\n\t-- \r\n\t-- --- We want to identify the loss master data inserted into coverage_dim based on the audit_id. In EDW we insert data into claimant_coverage_detail for loss_master_historical_data.\n\tIFF(source_audit_id < 0, source_audit_id, @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}) AS audit_id,\n\tEXP_get_values.eff_from_date,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS eff_to_date,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS source_sys_id,\n\tSYSDATE AS created_date,\n\tSYSDATE AS modified_date,\n\tEXP_get_values.claimant_cov_det_ak_id,\n\tEXP_get_values.sub_loc_unit_num,\n\tEXP_get_values.claimant_cov_eff_date,\n\tEXP_get_values.audit_id AS source_audit_id\n\tFROM EXP_get_values\n\tLEFT JOIN LKP_sup_claim_reserve_category\n\tON LKP_sup_claim_reserve_category.reserve_ctgry_code = EXP_get_values.reserve_ctgry_OUT\n\tLEFT JOIN LKP_sup_major_peril\n\tON LKP_sup_major_peril.major_peril_code = EXP_get_values.major_peril_code_OUT\n\tLEFT JOIN LKP_sup_risk_unit\n\tON LKP_sup_risk_unit.risk_unit_code = EXP_get_values.risk_unit_OUT AND LKP_sup_risk_unit.ins_line = EXP_get_values.ins_line_OUT\n\tLEFT JOIN LKP_sup_risk_unit_group\n\tON LKP_sup_risk_unit_group.risk_unit_grp_code = EXP_get_values.risk_unit_grp_OUT AND LKP_sup_risk_unit_group.ins_line = EXP_get_values.ins_line_OUT AND LKP_sup_risk_unit_group.prdct_type_code = EXP_get_values.risk_type_ind_OUT\n\tLEFT JOIN lkp_sup_insurance_line\n\tON lkp_sup_insurance_line.ins_line_code = EXP_get_values.ins_line_OUT\n),\nLKP_COVERAGE_DIM AS (\n\tSELECT\n\tcov_dim_id,\n\teff_from_date,\n\tin_eff_from_date,\n\tedw_claimant_cov_det_ak_id,\n\tin_edw_claimant_cov_det_ak_id\n\tFROM (\n\t\tSELECT \n\t\t\tcov_dim_id,\n\t\t\teff_from_date,\n\t\t\tin_eff_from_date,\n\t\t\tedw_claimant_cov_det_ak_id,\n\t\t\tin_edw_claimant_cov_det_ak_id\n\t\tFROM coverage_dim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_claimant_cov_det_ak_id,eff_from_date ORDER BY cov_dim_id) = 1\n),\nRTR_claim_coverage_dim AS (\n\tSELECT\n\tLKP_COVERAGE_DIM.cov_dim_id AS claim_cov_dim_id,\n\tEXP_DEFAULT_VALUES.claimant_cov_det_id,\n\tEXP_DEFAULT_VALUES.ins_line,\n\tEXP_DEFAULT_VALUES.ins_line_descript_out,\n\tEXP_DEFAULT_VALUES.major_peril_code,\n\tEXP_DEFAULT_VALUES.major_peril_descript_out,\n\tEXP_DEFAULT_VALUES.major_peril_seq,\n\tEXP_DEFAULT_VALUES.cause_of_loss,\n\tEXP_DEFAULT_VALUES.cause_of_loss_short_descript_out,\n\tEXP_DEFAULT_VALUES.cause_of_loss_long_descript_out,\n\tEXP_DEFAULT_VALUES.reserve_ctgry,\n\tEXP_DEFAULT_VALUES.reserve_ctgry_descript_out,\n\tEXP_DEFAULT_VALUES.risk_unit_grp,\n\tEXP_DEFAULT_VALUES.risk_unit_grp_descript_out,\n\tEXP_DEFAULT_VALUES.risk_unit_grp_seq_num,\n\tEXP_DEFAULT_VALUES.risk_unit,\n\tEXP_DEFAULT_VALUES.risk_unit_descript_out,\n\tEXP_DEFAULT_VALUES.risk_unit_seq_num,\n\tEXP_DEFAULT_VALUES.unit_veh_registration_state_code,\n\tEXP_DEFAULT_VALUES.unit_vin_num,\n\tEXP_DEFAULT_VALUES.unit_veh_stated_amt,\n\tEXP_DEFAULT_VALUES.unit_veh_yr,\n\tEXP_DEFAULT_VALUES.unit_veh_make,\n\tEXP_DEFAULT_VALUES.s3p_unit_type_code,\n\tEXP_DEFAULT_VALUES.pms_type_bureau_code,\n\tEXP_DEFAULT_VALUES.loc_unit_num,\n\tEXP_DEFAULT_VALUES.spec_pers_prop_use_code,\n\tEXP_DEFAULT_VALUES.pkg_ded_amt,\n\tEXP_DEFAULT_VALUES.pkg_lmt_amt,\n\tEXP_DEFAULT_VALUES.crrnt_snpsht_flag,\n\tEXP_DEFAULT_VALUES.audit_id,\n\tEXP_DEFAULT_VALUES.eff_from_date,\n\tEXP_DEFAULT_VALUES.eff_to_date,\n\tEXP_DEFAULT_VALUES.source_sys_id,\n\tEXP_DEFAULT_VALUES.created_date,\n\tEXP_DEFAULT_VALUES.modified_date,\n\tEXP_DEFAULT_VALUES.claimant_cov_det_ak_id,\n\tEXP_DEFAULT_VALUES.claimant_cov_eff_date,\n\tEXP_DEFAULT_VALUES.sub_loc_unit_num\n\tFROM EXP_DEFAULT_VALUES\n\tLEFT JOIN LKP_COVERAGE_DIM\n\tON LKP_COVERAGE_DIM.edw_claimant_cov_det_ak_id = EXP_DEFAULT_VALUES.claimant_cov_det_ak_id AND LKP_COVERAGE_DIM.eff_from_date = EXP_DEFAULT_VALUES.eff_from_date\n),\nRTR_claim_coverage_dim_INSERT AS (SELECT * FROM RTR_claim_coverage_dim WHERE ISNULL(claim_cov_dim_id)),\nRTR_claim_coverage_dim_DEFAULT1 AS (SELECT * FROM RTR_claim_coverage_dim WHERE NOT ( (ISNULL(claim_cov_dim_id)) )),\nUPD_claim_coverage_dim_update AS (\n\tSELECT\n\tclaim_cov_dim_id AS claim_cov_dim_id2, \n\tclaimant_cov_det_id AS claimant_cov_det_id2, \n\tins_line AS ins_line2, \n\tins_line_descript_out AS ins_line_descript_out2, \n\tmajor_peril_code AS major_peril_code2, \n\tmajor_peril_descript_out AS major_peril_descript_out2, \n\tmajor_peril_seq AS major_peril_seq2, \n\tcause_of_loss AS cause_of_loss2, \n\tcause_of_loss_short_descript_out AS cause_of_loss_short_descript_out2, \n\tcause_of_loss_long_descript_out AS cause_of_loss_long_descript_out2, \n\treserve_ctgry AS reserve_ctgry2, \n\treserve_ctgry_descript_out AS reserve_ctgry_descript_out2, \n\tpms_type_bureau_code AS pms_type_bureau_code2, \n\trisk_unit_grp AS risk_unit_grp2, \n\trisk_unit_grp_descript_out AS risk_unit_grp_descript_out2, \n\trisk_unit_grp_seq_num AS risk_unit_grp_seq_num2, \n\trisk_unit AS risk_unit2, \n\trisk_unit_descript_out AS risk_unit_descript_out2, \n\trisk_unit_seq_num AS risk_unit_seq_num2, \n\tunit_veh_registration_state_code AS unit_veh_registration_state_code2, \n\tunit_vin_num AS unit_vin_num2, \n\tunit_veh_stated_amt AS unit_veh_stated_amt2, \n\tunit_veh_yr AS unit_veh_yr2, \n\tunit_veh_make AS unit_veh_make2, \n\ts3p_unit_type_code AS s3p_unit_type_code2, \n\tloc_unit_num AS loc_unit_num2, \n\tspec_pers_prop_use_code AS spec_pers_prop_use_code2, \n\tpkg_ded_amt AS pkg_ded_amt2, \n\tpkg_lmt_amt AS pkg_lmt_amt2, \n\tcrrnt_snpsht_flag AS crrnt_snpsht_flag2, \n\taudit_id AS audit_id2, \n\teff_from_date AS eff_from_date2, \n\teff_to_date AS eff_to_date2, \n\tsource_sys_id AS source_sys_id2, \n\tmodified_date AS modified_date2, \n\tclaimant_cov_det_ak_id AS claimant_cov_det_ak_id2, \n\tclaimant_cov_eff_date AS claimant_cov_eff_date2, \n\tsub_loc_unit_num AS sub_loc_unit_num2\n\tFROM RTR_claim_coverage_dim_DEFAULT1\n),\ncoverage_dim_update AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.coverage_dim AS T\n\tUSING UPD_claim_coverage_dim_update AS S\n\tON T.cov_dim_id = S.claim_cov_dim_id2\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.edw_claimant_cov_det_pk_id = S.claimant_cov_det_id2, T.edw_claimant_cov_det_ak_id = S.claimant_cov_det_ak_id2, T.ins_line = S.ins_line2, T.ins_line_descript = S.ins_line_descript_out2, T.major_peril_code = S.major_peril_code2, T.major_peril_descript = S.major_peril_descript_out2, T.major_peril_seq_num = S.major_peril_seq2, T.type_bureau_code = S.pms_type_bureau_code2, T.risk_unit_grp = S.risk_unit_grp2, T.risk_unit_grp_descript = S.risk_unit_grp_descript_out2, T.risk_unit_grp_seq_num = S.risk_unit_grp_seq_num2, T.risk_unit = S.risk_unit2, T.risk_unit_descript = S.risk_unit_descript_out2, T.risk_unit_seq_num = S.risk_unit_seq_num2, T.unit_veh_registration_state_code = S.unit_veh_registration_state_code2, T.unit_vin_num = S.unit_vin_num2, T.unit_veh_state_amt = S.unit_veh_stated_amt2, T.unit_veh_yr = S.unit_veh_yr2, T.unit_veh_make = S.unit_veh_make2, T.loc_unit_num = S.loc_unit_num2, T.spec_pers_prop_use_code = S.spec_pers_prop_use_code2, T.pkg_deduction_amt = S.pkg_ded_amt2, T.pkg_lmt_amt = S.pkg_lmt_amt2, T.crrnt_snpsht_flag = S.crrnt_snpsht_flag2, T.audit_id = S.audit_id2, T.eff_from_date = S.eff_from_date2, T.eff_to_date = S.eff_to_date2, T.modified_date = S.modified_date2, T.cov_eff_date = S.claimant_cov_eff_date2, T.sub_loc_unit_num = S.sub_loc_unit_num2\n),\nUPD_claim_coverage_dim_insert AS (\n\tSELECT\n\tclaimant_cov_det_id AS claimant_cov_det_id1, \n\tins_line AS ins_line1, \n\tins_line_descript_out AS ins_line_descript_out1, \n\tmajor_peril_code AS major_peril_code1, \n\tmajor_peril_descript_out AS major_peril_descript_out1, \n\tmajor_peril_seq AS major_peril_seq1, \n\tcause_of_loss AS cause_of_loss1, \n\tcause_of_loss_short_descript_out AS cause_of_loss_short_descript_out1, \n\tcause_of_loss_long_descript_out AS cause_of_loss_long_descript_out1, \n\treserve_ctgry AS reserve_ctgry1, \n\treserve_ctgry_descript_out AS reserve_ctgry_descript_out1, \n\trisk_unit_grp AS risk_unit_grp1, \n\trisk_unit_grp_descript_out AS risk_unit_grp_descript_out1, \n\trisk_unit_grp_seq_num AS risk_unit_grp_seq_num1, \n\trisk_unit AS risk_unit1, \n\trisk_unit_descript_out AS risk_unit_descript_out1, \n\trisk_unit_seq_num AS risk_unit_seq_num1, \n\tunit_veh_registration_state_code AS unit_veh_registration_state_code1, \n\tunit_vin_num AS unit_vin_num1, \n\tunit_veh_stated_amt AS unit_veh_stated_amt1, \n\tunit_veh_yr AS unit_veh_yr1, \n\tunit_veh_make AS unit_veh_make1, \n\ts3p_unit_type_code AS s3p_unit_type_code1, \n\tpms_type_bureau_code AS pms_type_bureau_code1, \n\tloc_unit_num AS loc_unit_num1, \n\tspec_pers_prop_use_code AS spec_pers_prop_use_code1, \n\tpkg_ded_amt AS pkg_ded_amt1, \n\tpkg_lmt_amt AS pkg_lmt_amt1, \n\tcrrnt_snpsht_flag AS crrnt_snpsht_flag1, \n\taudit_id AS audit_id1, \n\teff_from_date AS eff_from_date1, \n\teff_to_date AS eff_to_date1, \n\tsource_sys_id AS source_sys_id1, \n\tcreated_date AS created_date1, \n\tmodified_date AS modified_date1, \n\tclaimant_cov_det_ak_id AS claimant_cov_det_ak_id1, \n\tclaimant_cov_eff_date AS claimant_cov_eff_date1, \n\tsub_loc_unit_num AS sub_loc_unit_num1\n\tFROM RTR_claim_coverage_dim_INSERT\n),\ncoverage_dim_insert AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.coverage_dim\n\t(edw_claimant_cov_det_pk_id, edw_claimant_cov_det_ak_id, ins_line, ins_line_descript, major_peril_code, major_peril_descript, major_peril_seq_num, type_bureau_code, risk_unit_grp, risk_unit_grp_descript, risk_unit_grp_seq_num, risk_unit, risk_unit_descript, risk_unit_seq_num, unit_veh_registration_state_code, unit_vin_num, unit_veh_state_amt, unit_veh_yr, unit_veh_make, loc_unit_num, spec_pers_prop_use_code, pkg_deduction_amt, pkg_lmt_amt, crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, created_date, modified_date, cov_eff_date, sub_loc_unit_num)\n\tSELECT \n\tclaimant_cov_det_id1 AS EDW_CLAIMANT_COV_DET_PK_ID, \n\tclaimant_cov_det_ak_id1 AS EDW_CLAIMANT_COV_DET_AK_ID, \n\tins_line1 AS INS_LINE, \n\tins_line_descript_out1 AS INS_LINE_DESCRIPT, \n\tmajor_peril_code1 AS MAJOR_PERIL_CODE, \n\tmajor_peril_descript_out1 AS MAJOR_PERIL_DESCRIPT, \n\tmajor_peril_seq1 AS MAJOR_PERIL_SEQ_NUM, \n\tpms_type_bureau_code1 AS TYPE_BUREAU_CODE, \n\trisk_unit_grp1 AS RISK_UNIT_GRP, \n\trisk_unit_grp_descript_out1 AS RISK_UNIT_GRP_DESCRIPT, \n\trisk_unit_grp_seq_num1 AS RISK_UNIT_GRP_SEQ_NUM, \n\trisk_unit1 AS RISK_UNIT, \n\trisk_unit_descript_out1 AS RISK_UNIT_DESCRIPT, \n\trisk_unit_seq_num1 AS RISK_UNIT_SEQ_NUM, \n\tunit_veh_registration_state_code1 AS UNIT_VEH_REGISTRATION_STATE_CODE, \n\tunit_vin_num1 AS UNIT_VIN_NUM, \n\tunit_veh_stated_amt1 AS UNIT_VEH_STATE_AMT, \n\tunit_veh_yr1 AS UNIT_VEH_YR, \n\tunit_veh_make1 AS UNIT_VEH_MAKE, \n\tloc_unit_num1 AS LOC_UNIT_NUM, \n\tspec_pers_prop_use_code1 AS SPEC_PERS_PROP_USE_CODE, \n\tpkg_ded_amt1 AS PKG_DEDUCTION_AMT, \n\tpkg_lmt_amt1 AS PKG_LMT_AMT, \n\tcrrnt_snpsht_flag1 AS CRRNT_SNPSHT_FLAG, \n\taudit_id1 AS AUDIT_ID, \n\teff_from_date1 AS EFF_FROM_DATE, \n\teff_to_date1 AS EFF_TO_DATE, \n\tcreated_date1 AS CREATED_DATE, \n\tmodified_date1 AS MODIFIED_DATE, \n\tclaimant_cov_eff_date1 AS COV_EFF_DATE, \n\tsub_loc_unit_num1 AS SUB_LOC_UNIT_NUM\n\tFROM UPD_claim_coverage_dim_insert\n),\nSQ_coverage_dim AS (\n\tSELECT \r\n\tCOVERAGE_DIM.COV_DIM_ID, \r\n\tCOVERAGE_DIM.EFF_FROM_DATE, \r\n\tCOVERAGE_DIM.EFF_TO_DATE, \r\n\tCOVERAGE_DIM.EDW_CLAIMANT_COV_DET_AK_ID \r\n\tFROM\r\n\t@{pipeline().parameters.TARGET_TABLE_OWNER}.COVERAGE_DIM COVERAGE_DIM\r\n\tWHERE EXISTS \r\n\t(\r\n\tSELECT 1 FROM @{pipeline().parameters.TARGET_TABLE_OWNER}.COVERAGE_DIM COVERAGE_DIM2\r\n\tWHERE CRRNT_SNPSHT_FLAG = 1 AND COVERAGE_DIM.EDW_CLAIMANT_COV_DET_AK_ID = COVERAGE_DIM2.EDW_CLAIMANT_COV_DET_AK_ID \r\n\tGROUP BY COVERAGE_DIM2.EDW_CLAIMANT_COV_DET_AK_ID HAVING COUNT(*) > 1\r\n\t)\r\n\tORDER BY COVERAGE_DIM.EDW_CLAIMANT_COV_DET_AK_ID , COVERAGE_DIM.EFF_FROM_DATE DESC\n),\nEXP_Lag_eff_from_date111 AS (\n\tSELECT\n\tcov_dim_id,\n\tedw_claimant_cov_det_ak_id,\n\teff_from_date,\n\teff_to_date AS orig_eff_to_date,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- \tedw_claimant_cov_det_ak_id = v_PREV_ROW_occurrence_key, ADD_TO_DATE(v_PREV_ROW_eff_from_date,'SS',-1),\r\n\t-- \torig_eff_to_date)\n\tDECODE(TRUE,\n\tedw_claimant_cov_det_ak_id = v_PREV_ROW_occurrence_key, ADD_TO_DATE(v_PREV_ROW_eff_from_date, 'SS', - 1),\n\torig_eff_to_date) AS v_eff_to_date,\n\tv_eff_to_date AS eff_to_date,\n\teff_from_date AS v_PREV_ROW_eff_from_date,\n\tedw_claimant_cov_det_ak_id AS v_PREV_ROW_occurrence_key,\n\tSYSDATE AS modified_date,\n\t0 AS crrnt_snpsht_flag\n\tFROM SQ_coverage_dim\n),\nFIL_claim_representative_dim_update AS (\n\tSELECT\n\tcov_dim_id, \n\torig_eff_to_date, \n\teff_to_date, \n\tcrrnt_snpsht_flag, \n\tmodified_date\n\tFROM EXP_Lag_eff_from_date111\n\tWHERE orig_eff_to_date != eff_to_date\n),\nUPD_claim_representative_dim AS (\n\tSELECT\n\tcov_dim_id, \n\teff_to_date, \n\tcrrnt_snpsht_flag, \n\tmodified_date\n\tFROM FIL_claim_representative_dim_update\n),\ncoverage_dim_expire AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.coverage_dim AS T\n\tUSING UPD_claim_representative_dim AS S\n\tON T.cov_dim_id = S.cov_dim_id\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.crrnt_snpsht_flag = S.crrnt_snpsht_flag, T.eff_to_date = S.eff_to_date, T.modified_date = S.modified_date\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246509"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905529"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604486"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 02:30:45"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 02:35:48"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Data_Mart_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "EXCEED AND PMS"
            }
        },
        "folder": {
            "name": "Claims DataMart/"
        },
        "annotations": []
    }
}