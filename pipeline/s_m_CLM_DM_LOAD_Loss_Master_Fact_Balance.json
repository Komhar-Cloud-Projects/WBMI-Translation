{
    "name": "s_m_CLM_DM_LOAD_Loss_Master_Fact_Balance",
    "properties": {
        "activities": [
            {
                "name": "m_CLM_DM_LOAD_Loss_Master_Fact_Balance",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_loss_master_fact_CurrentRunMonth AS (\n\tSELECT LMF.loss_master_fact_id,\r\n\tLMF.audit_id,\r\n\tLMF.edw_loss_master_calculation_pk_id,\r\n\tLMF.edw_claim_trans_pk_id,\r\n\tLMF.edw_claim_reins_trans_pk_id,\r\n\tLMF.wc_stage_loss_master_pk_id,\r\n\tLMF.loss_master_dim_id,\r\n\tLMF.claim_occurrence_dim_id,\r\n\tLMF.claimant_dim_id,\r\n\tLMF.claimant_cov_dim_id,\r\n\tLMF.cov_dim_id,\r\n\tLMF.claim_trans_type_dim_id,\r\n\tLMF.reins_cov_dim_id,\r\n\tLMF.claim_rep_dim_prim_claim_rep_id,\r\n\tLMF.claim_rep_dim_examiner_id,\r\n\tLMF.pol_dim_id,\r\n\tLMF.contract_cust_dim_id,\r\n\tLMF.agency_dim_id,\r\n\tLMF.claim_pay_dim_id,\r\n\tLMF.claim_pay_ctgry_type_dim_id,\r\n\tLMF.claim_case_dim_id,\r\n\tLMF.claim_trans_date_id,\r\n\tLMF.pol_eff_date_id,\r\n\tLMF.pol_exp_date_id,\r\n\tLMF.source_claim_rpted_date_id,\r\n\tLMF.claim_rpted_date_id,\r\n\tLMF.claim_loss_date_id,\r\n\tLMF.incptn_date_id,\r\n\tLMF.loss_master_run_date_id,\r\n\tLMF.claim_trans_amt,\r\n\tLMF.claim_trans_hist_amt,\r\n\tLMF.new_claim_count,\r\n\tLMF.outstanding_amt,\r\n\tLMF.paid_loss_amt,\r\n\tLMF.paid_exp_amt,\r\n\tLMF.eom_unpaid_loss_adjust_exp,\r\n\tLMF.orig_reserve,\r\n\tLMF.orig_reserve_extract,\r\n\tLMF.asl_dim_id,\r\n\tLMF.asl_prdct_code_dim_id,\r\n\tLMF.strtgc_bus_dvsn_dim_id,\r\n\tLMF.prdct_code_dim_id,\r\n\tLMF.InsuranceReferenceDimId,\r\n\tLMF.AgencyDimId,\r\n\tLMF.SalesDivisionDimId,\r\n\tLMF.InsuranceReferenceCoverageDimId,\r\n\tLMF.CoverageDetailDimId,\r\n\tCO.edw_claim_occurrence_ak_id,\r\n\tCC.edw_claimant_cov_det_ak_id,\r\n\tRC.edw_reins_cov_ak_id,\r\n\tC.clndr_date AS LossMasterRundate,\r\n\tcase when CTT.pms_trans_code='92' then '90' else CTT.pms_trans_code end pms_trans_code,\r\n\tLMF.claimfinancialtypedimid,\r\n\tCTT.TRANS_KIND_CODE,\r\n\tCO.claim_loss_date,\r\n\tP.pol_key,\r\n\tCO.claim_cat_code\r\n\tFROM\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.loss_master_fact LMF,\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.claim_transaction_type_dim CTT,\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.calendar_dim C,\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.claim_occurrence_dim CO,\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.claimant_coverage_dim CC,\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.reinsurance_coverage_dim RC,\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.Policy_Dim P\r\n\twhere LMF.claim_trans_type_dim_id=CTT.claim_trans_type_dim_id\r\n\tand LMF.loss_master_run_date_id=C.clndr_id\r\n\tand LMF.claim_occurrence_dim_id=CO.claim_occurrence_dim_id\r\n\tand LMF.claimant_cov_dim_id=CC.claimant_cov_dim_id\r\n\tand CTT.pms_trans_code in ('90','92','95','97','98','99')\r\n\tand LMF.reins_cov_dim_id=RC.reins_cov_dim_id\r\n\tand LMF.pol_dim_id=P.pol_dim_id\r\n\tand C.clndr_date=dateadd(DD,-1,dateadd(MM,DATEDIFF(mm,0,getdate())-(@{pipeline().parameters.NO_OF_MONTHS_CR}),0))\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\r\n\torder by CO.edw_claim_occurrence_ak_id,CC.edw_claimant_cov_det_ak_id,RC.edw_reins_cov_ak_id,C.clndr_date,case when CTT.pms_trans_code='92' then '90' else CTT.pms_trans_code end\n),\nSQ_loss_master_fact_PreviousRunMonth AS (\n\tSELECT LMF.loss_master_fact_id,\r\n\tLMF.audit_id,\r\n\tLMF.edw_loss_master_calculation_pk_id,\r\n\tLMF.edw_claim_trans_pk_id,\r\n\tLMF.edw_claim_reins_trans_pk_id,\r\n\tLMF.wc_stage_loss_master_pk_id,\r\n\tLMF.loss_master_dim_id,\r\n\tLMF.claim_occurrence_dim_id,\r\n\tLMF.claimant_dim_id,\r\n\tLMF.claimant_cov_dim_id,\r\n\tLMF.cov_dim_id,\r\n\tLMF.claim_trans_type_dim_id,\r\n\tLMF.reins_cov_dim_id,\r\n\tLMF.claim_rep_dim_prim_claim_rep_id,\r\n\tLMF.claim_rep_dim_examiner_id,\r\n\tLMF.pol_dim_id,\r\n\tLMF.contract_cust_dim_id,\r\n\tLMF.agency_dim_id,\r\n\tLMF.claim_pay_dim_id,\r\n\tLMF.claim_pay_ctgry_type_dim_id,\r\n\tLMF.claim_case_dim_id,\r\n\tLMF.claim_trans_date_id,\r\n\tLMF.pol_eff_date_id,\r\n\tLMF.pol_exp_date_id,\r\n\tLMF.source_claim_rpted_date_id,\r\n\tLMF.claim_rpted_date_id,\r\n\tLMF.claim_loss_date_id,\r\n\tLMF.incptn_date_id,\r\n\tLMF.loss_master_run_date_id,\r\n\tLMF.claim_trans_amt,\r\n\tLMF.claim_trans_hist_amt,\r\n\tLMF.new_claim_count,\r\n\tLMF.outstanding_amt,\r\n\tLMF.paid_loss_amt,\r\n\tLMF.paid_exp_amt,\r\n\tLMF.eom_unpaid_loss_adjust_exp,\r\n\tLMF.orig_reserve,\r\n\tLMF.orig_reserve_extract,\r\n\tLMF.asl_dim_id,\r\n\tLMF.asl_prdct_code_dim_id,\r\n\tLMF.strtgc_bus_dvsn_dim_id,\r\n\tLMF.prdct_code_dim_id,\r\n\tLMF.InsuranceReferenceDimId,\r\n\tLMF.AgencyDimId,\r\n\tLMF.SalesDivisionDimId,\r\n\tLMF.InsuranceReferenceCoverageDimId,\r\n\tLMF.CoverageDetailDimId,\r\n\tCO.edw_claim_occurrence_ak_id,\r\n\tCC.edw_claimant_cov_det_ak_id,\r\n\tRC.edw_reins_cov_ak_id,\r\n\tC.clndr_date AS LossMasterRundate,\r\n\tcase when CTT.pms_trans_code='92' then '90' else CTT.pms_trans_code end pms_trans_code,\r\n\tLMF.claimfinancialtypedimid,\r\n\tCTT.TRANS_KIND_CODE,\r\n\tCO.claim_loss_date,\r\n\tP.pol_key,\r\n\tCO.claim_cat_code\r\n\tFROM\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.loss_master_fact LMF,\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.claim_transaction_type_dim CTT,\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.calendar_dim C,\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.claim_occurrence_dim CO,\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.claimant_coverage_dim CC,\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.reinsurance_coverage_dim RC,\r\n\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.Policy_Dim P\r\n\twhere LMF.claim_trans_type_dim_id=CTT.claim_trans_type_dim_id\r\n\tand LMF.loss_master_run_date_id=C.clndr_id\r\n\tand LMF.claim_occurrence_dim_id=CO.claim_occurrence_dim_id\r\n\tand LMF.claimant_cov_dim_id=CC.claimant_cov_dim_id\r\n\tand CTT.pms_trans_code in ('90','92','95','97','98','99')\r\n\tand LMF.reins_cov_dim_id=RC.reins_cov_dim_id\r\n\tand LMF.pol_dim_id=P.pol_dim_id\r\n\tand C.clndr_date=dateadd(DD,-1,dateadd(MM,DATEDIFF(mm,0,getdate())-(@{pipeline().parameters.NO_OF_MONTHS_PR}),0))\r\n\tand LMF.Audit_Id not in (-1000,-9)\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\r\n\torder by CO.edw_claim_occurrence_ak_id,CC.edw_claimant_cov_det_ak_id,RC.edw_reins_cov_ak_id,C.clndr_date,case when CTT.pms_trans_code='92' then '90' else CTT.pms_trans_code end\n),\nJNR_Current_Previous AS (SELECT\n\tSQ_loss_master_fact_CurrentRunMonth.loss_master_fact_id AS CR_loss_master_fact_id, \n\tSQ_loss_master_fact_CurrentRunMonth.audit_id AS CR_audit_id, \n\tSQ_loss_master_fact_CurrentRunMonth.edw_loss_master_calculation_pk_id AS CR_edw_loss_master_calculation_pk_id, \n\tSQ_loss_master_fact_CurrentRunMonth.edw_claim_trans_pk_id AS CR_edw_claim_trans_pk_id, \n\tSQ_loss_master_fact_CurrentRunMonth.edw_claim_reins_trans_pk_id AS CR_edw_claim_reins_trans_pk_id, \n\tSQ_loss_master_fact_CurrentRunMonth.wc_stage_loss_master_pk_id AS CR_wc_stage_loss_master_pk_id, \n\tSQ_loss_master_fact_CurrentRunMonth.loss_master_dim_id AS CR_loss_master_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_occurrence_dim_id AS CR_claim_occurrence_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claimant_dim_id AS CR_claimant_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claimant_cov_dim_id AS CR_claimant_cov_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.cov_dim_id AS CR_cov_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_trans_type_dim_id AS CR_claim_trans_type_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.reins_cov_dim_id AS CR_reins_cov_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_rep_dim_prim_claim_rep_id AS CR_claim_rep_dim_prim_claim_rep_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_rep_dim_examiner_id AS CR_claim_rep_dim_examiner_id, \n\tSQ_loss_master_fact_CurrentRunMonth.pol_dim_id AS CR_pol_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.contract_cust_dim_id AS CR_contract_cust_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.agency_dim_id AS CR_agency_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_pay_dim_id AS CR_claim_pay_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_pay_ctgry_type_dim_id AS CR_claim_pay_ctgry_type_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_case_dim_id AS CR_claim_case_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_trans_date_id AS CR_claim_trans_date_id, \n\tSQ_loss_master_fact_CurrentRunMonth.pol_eff_date_id AS CR_pol_eff_date_id, \n\tSQ_loss_master_fact_CurrentRunMonth.pol_exp_date_id AS CR_pol_exp_date_id, \n\tSQ_loss_master_fact_CurrentRunMonth.source_claim_rpted_date_id AS CR_source_claim_rpted_date_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_rpted_date_id AS CR_claim_rpted_date_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_loss_date_id AS CR_claim_loss_date_id, \n\tSQ_loss_master_fact_CurrentRunMonth.incptn_date_id AS CR_incptn_date_id, \n\tSQ_loss_master_fact_CurrentRunMonth.loss_master_run_date_id AS CR_loss_master_run_date_id, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_trans_amt AS CR_claim_trans_amt, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_trans_hist_amt AS CR_claim_trans_hist_amt, \n\tSQ_loss_master_fact_CurrentRunMonth.new_claim_count AS CR_new_claim_count, \n\tSQ_loss_master_fact_CurrentRunMonth.outstanding_amt AS CR_outstanding_amt, \n\tSQ_loss_master_fact_CurrentRunMonth.paid_loss_amt AS CR_paid_loss_amt, \n\tSQ_loss_master_fact_CurrentRunMonth.paid_exp_amt AS CR_paid_exp_amt, \n\tSQ_loss_master_fact_CurrentRunMonth.eom_unpaid_loss_adjust_exp AS CR_eom_unpaid_loss_adjust_exp, \n\tSQ_loss_master_fact_CurrentRunMonth.orig_reserve AS CR_orig_reserve, \n\tSQ_loss_master_fact_CurrentRunMonth.orig_reserve_extract AS CR_orig_reserve_extract, \n\tSQ_loss_master_fact_CurrentRunMonth.asl_dim_id AS CR_asl_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.asl_prdct_code_dim_id AS CR_asl_prdct_code_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.strtgc_bus_dvsn_dim_id AS CR_strtgc_bus_dvsn_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.prdct_code_dim_id AS CR_prdct_code_dim_id, \n\tSQ_loss_master_fact_CurrentRunMonth.InsuranceReferenceDimId AS CR_InsuranceReferenceDimId, \n\tSQ_loss_master_fact_CurrentRunMonth.AgencyDimId AS CR_AgencyDimId, \n\tSQ_loss_master_fact_CurrentRunMonth.SalesDivisionDimId AS CR_SalesDivisionDimId, \n\tSQ_loss_master_fact_CurrentRunMonth.InsuranceReferenceCoverageDimId AS CR_InsuranceReferenceCoverageDimId, \n\tSQ_loss_master_fact_CurrentRunMonth.CoverageDetailDimId AS CR_CoverageDetailDimId, \n\tSQ_loss_master_fact_CurrentRunMonth.edw_claim_occurrence_ak_id AS CR_edw_claim_occurrence_ak_id, \n\tSQ_loss_master_fact_CurrentRunMonth.edw_claimant_cov_det_ak_id AS CR_edw_claimant_cov_det_ak_id, \n\tSQ_loss_master_fact_CurrentRunMonth.edw_reins_cov_ak_id AS CR_edw_reins_cov_ak_id, \n\tSQ_loss_master_fact_CurrentRunMonth.LossMasterRundate AS CR_LossMasterRundate, \n\tSQ_loss_master_fact_CurrentRunMonth.pms_trans_code AS CR_pms_trans_code, \n\tSQ_loss_master_fact_CurrentRunMonth.claimfinancialtypedimid AS CR_claimfinancialtypedimid, \n\tSQ_loss_master_fact_CurrentRunMonth.trans_kind_code AS CR_Trans_kind_code, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_loss_date AS CR_Claim_Loss_date, \n\tSQ_loss_master_fact_CurrentRunMonth.pol_key AS CR_Pol_key, \n\tSQ_loss_master_fact_CurrentRunMonth.claim_cat_code AS CR_claim_cat_code, \n\tSQ_loss_master_fact_PreviousRunMonth.loss_master_fact_id AS PR_loss_master_fact_id, \n\tSQ_loss_master_fact_PreviousRunMonth.audit_id AS PR_audit_id, \n\tSQ_loss_master_fact_PreviousRunMonth.edw_loss_master_calculation_pk_id AS PR_edw_loss_master_calculation_pk_id, \n\tSQ_loss_master_fact_PreviousRunMonth.edw_claim_trans_pk_id AS PR_edw_claim_trans_pk_id, \n\tSQ_loss_master_fact_PreviousRunMonth.edw_claim_reins_trans_pk_id AS PR_edw_claim_reins_trans_pk_id, \n\tSQ_loss_master_fact_PreviousRunMonth.wc_stage_loss_master_pk_id AS PR_wc_stage_loss_master_pk_id, \n\tSQ_loss_master_fact_PreviousRunMonth.loss_master_dim_id AS PR_loss_master_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_occurrence_dim_id AS PR_claim_occurrence_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claimant_dim_id AS PR_claimant_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claimant_cov_dim_id AS PR_claimant_cov_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.cov_dim_id AS PR_cov_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_trans_type_dim_id AS PR_claim_trans_type_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.reins_cov_dim_id AS PR_reins_cov_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_rep_dim_prim_claim_rep_id AS PR_claim_rep_dim_prim_claim_rep_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_rep_dim_examiner_id AS PR_claim_rep_dim_examiner_id, \n\tSQ_loss_master_fact_PreviousRunMonth.pol_dim_id AS PR_pol_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.contract_cust_dim_id AS PR_contract_cust_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.agency_dim_id AS PR_agency_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_pay_dim_id AS PR_claim_pay_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_pay_ctgry_type_dim_id AS PR_claim_pay_ctgry_type_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_case_dim_id AS PR_claim_case_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_trans_date_id AS PR_claim_trans_date_id, \n\tSQ_loss_master_fact_PreviousRunMonth.pol_eff_date_id AS PR_pol_eff_date_id, \n\tSQ_loss_master_fact_PreviousRunMonth.pol_exp_date_id AS PR_pol_exp_date_id, \n\tSQ_loss_master_fact_PreviousRunMonth.source_claim_rpted_date_id AS PR_source_claim_rpted_date_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_rpted_date_id AS PR_claim_rpted_date_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_loss_date_id AS PR_claim_loss_date_id, \n\tSQ_loss_master_fact_PreviousRunMonth.incptn_date_id AS PR_incptn_date_id, \n\tSQ_loss_master_fact_PreviousRunMonth.loss_master_run_date_id AS PR_loss_master_run_date_id, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_trans_amt AS PR_claim_trans_amt, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_trans_hist_amt AS PR_claim_trans_hist_amt, \n\tSQ_loss_master_fact_PreviousRunMonth.new_claim_count AS PR_new_claim_count, \n\tSQ_loss_master_fact_PreviousRunMonth.outstanding_amt AS PR_outstanding_amt, \n\tSQ_loss_master_fact_PreviousRunMonth.paid_loss_amt AS PR_paid_loss_amt, \n\tSQ_loss_master_fact_PreviousRunMonth.paid_exp_amt AS PR_paid_exp_amt, \n\tSQ_loss_master_fact_PreviousRunMonth.eom_unpaid_loss_adjust_exp AS PR_eom_unpaid_loss_adjust_exp, \n\tSQ_loss_master_fact_PreviousRunMonth.orig_reserve AS PR_orig_reserve, \n\tSQ_loss_master_fact_PreviousRunMonth.orig_reserve_extract AS PR_orig_reserve_extract, \n\tSQ_loss_master_fact_PreviousRunMonth.asl_dim_id AS PR_asl_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.asl_prdct_code_dim_id AS PR_asl_prdct_code_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.strtgc_bus_dvsn_dim_id AS PR_strtgc_bus_dvsn_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.prdct_code_dim_id AS PR_prdct_code_dim_id, \n\tSQ_loss_master_fact_PreviousRunMonth.InsuranceReferenceDimId AS PR_InsuranceReferenceDimId, \n\tSQ_loss_master_fact_PreviousRunMonth.AgencyDimId AS PR_AgencyDimId, \n\tSQ_loss_master_fact_PreviousRunMonth.SalesDivisionDimId AS PR_SalesDivisionDimId, \n\tSQ_loss_master_fact_PreviousRunMonth.InsuranceReferenceCoverageDimId AS PR_InsuranceReferenceCoverageDimId, \n\tSQ_loss_master_fact_PreviousRunMonth.CoverageDetailDimId AS PR_CoverageDetailDimId, \n\tSQ_loss_master_fact_PreviousRunMonth.edw_claim_occurrence_ak_id AS PR_edw_claim_occurrence_ak_id, \n\tSQ_loss_master_fact_PreviousRunMonth.edw_claimant_cov_det_ak_id AS PR_edw_claimant_cov_det_ak_id, \n\tSQ_loss_master_fact_PreviousRunMonth.edw_reins_cov_ak_id AS PR_edw_reins_cov_ak_id, \n\tSQ_loss_master_fact_PreviousRunMonth.LossMasterRundate AS PR_LossMasterRundate, \n\tSQ_loss_master_fact_PreviousRunMonth.pms_trans_code AS PR_pms_trans_code, \n\tSQ_loss_master_fact_PreviousRunMonth.claimfinancialtypedimid AS PR_claimfinancialtypedimid, \n\tSQ_loss_master_fact_PreviousRunMonth.trans_kind_code AS PR_Trans_Kind_code, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_loss_date AS PR_Claim_Loss_date, \n\tSQ_loss_master_fact_PreviousRunMonth.pol_key AS PR_Pol_key, \n\tSQ_loss_master_fact_PreviousRunMonth.claim_cat_code AS PR_claim_cat_code\n\tFROM SQ_loss_master_fact_CurrentRunMonth\n\tFULL OUTER JOIN SQ_loss_master_fact_PreviousRunMonth\n\tON SQ_loss_master_fact_PreviousRunMonth.edw_claim_occurrence_ak_id = SQ_loss_master_fact_CurrentRunMonth.edw_claim_occurrence_ak_id AND SQ_loss_master_fact_PreviousRunMonth.edw_claimant_cov_det_ak_id = SQ_loss_master_fact_CurrentRunMonth.edw_claimant_cov_det_ak_id AND SQ_loss_master_fact_PreviousRunMonth.edw_reins_cov_ak_id = SQ_loss_master_fact_CurrentRunMonth.edw_reins_cov_ak_id AND SQ_loss_master_fact_PreviousRunMonth.pms_trans_code = SQ_loss_master_fact_CurrentRunMonth.pms_trans_code AND SQ_loss_master_fact_PreviousRunMonth.trans_kind_code = SQ_loss_master_fact_CurrentRunMonth.trans_kind_code AND SQ_loss_master_fact_PreviousRunMonth.claim_loss_date = SQ_loss_master_fact_CurrentRunMonth.claim_loss_date AND SQ_loss_master_fact_PreviousRunMonth.pol_key = SQ_loss_master_fact_CurrentRunMonth.pol_key AND SQ_loss_master_fact_PreviousRunMonth.claim_cat_code = SQ_loss_master_fact_CurrentRunMonth.claim_cat_code\n),\nRTR_Split_Current_Previous AS (\n\tSELECT\n\tCR_loss_master_fact_id,\n\tCR_audit_id,\n\tCR_edw_loss_master_calculation_pk_id,\n\tCR_edw_claim_trans_pk_id,\n\tCR_edw_claim_reins_trans_pk_id,\n\tCR_wc_stage_loss_master_pk_id,\n\tCR_loss_master_dim_id,\n\tCR_claim_occurrence_dim_id,\n\tCR_claimant_dim_id,\n\tCR_claimant_cov_dim_id,\n\tCR_cov_dim_id,\n\tCR_claim_trans_type_dim_id,\n\tCR_reins_cov_dim_id,\n\tCR_claim_rep_dim_prim_claim_rep_id,\n\tCR_claim_rep_dim_examiner_id,\n\tCR_pol_dim_id,\n\tCR_contract_cust_dim_id,\n\tCR_agency_dim_id,\n\tCR_claim_pay_dim_id,\n\tCR_claim_pay_ctgry_type_dim_id,\n\tCR_claim_case_dim_id,\n\tCR_claim_trans_date_id,\n\tCR_pol_eff_date_id,\n\tCR_pol_exp_date_id,\n\tCR_source_claim_rpted_date_id,\n\tCR_claim_rpted_date_id,\n\tCR_claim_loss_date_id,\n\tCR_incptn_date_id,\n\tCR_loss_master_run_date_id,\n\tCR_claim_trans_amt,\n\tCR_claim_trans_hist_amt,\n\tCR_new_claim_count,\n\tCR_outstanding_amt,\n\tCR_paid_loss_amt,\n\tCR_paid_exp_amt,\n\tCR_eom_unpaid_loss_adjust_exp,\n\tCR_orig_reserve,\n\tCR_orig_reserve_extract,\n\tCR_asl_dim_id,\n\tCR_asl_prdct_code_dim_id,\n\tCR_strtgc_bus_dvsn_dim_id,\n\tCR_prdct_code_dim_id,\n\tCR_InsuranceReferenceDimId,\n\tCR_AgencyDimId,\n\tCR_SalesDivisionDimId,\n\tCR_InsuranceReferenceCoverageDimId,\n\tCR_CoverageDetailDimId,\n\tCR_edw_claim_occurrence_ak_id,\n\tCR_edw_claimant_cov_det_ak_id,\n\tCR_edw_reins_cov_ak_id,\n\tCR_LossMasterRundate,\n\tCR_pms_trans_code,\n\tCR_claimfinancialtypedimid,\n\tPR_loss_master_fact_id,\n\tPR_audit_id,\n\tPR_edw_loss_master_calculation_pk_id,\n\tPR_edw_claim_trans_pk_id,\n\tPR_edw_claim_reins_trans_pk_id,\n\tPR_wc_stage_loss_master_pk_id,\n\tPR_loss_master_dim_id,\n\tPR_claim_occurrence_dim_id,\n\tPR_claimant_dim_id,\n\tPR_claimant_cov_dim_id,\n\tPR_cov_dim_id,\n\tPR_claim_trans_type_dim_id,\n\tPR_reins_cov_dim_id,\n\tPR_claim_rep_dim_prim_claim_rep_id,\n\tPR_claim_rep_dim_examiner_id,\n\tPR_pol_dim_id,\n\tPR_contract_cust_dim_id,\n\tPR_agency_dim_id,\n\tPR_claim_pay_dim_id,\n\tPR_claim_pay_ctgry_type_dim_id,\n\tPR_claim_case_dim_id,\n\tPR_claim_trans_date_id,\n\tPR_pol_eff_date_id,\n\tPR_pol_exp_date_id,\n\tPR_source_claim_rpted_date_id,\n\tPR_claim_rpted_date_id,\n\tPR_claim_loss_date_id,\n\tPR_incptn_date_id,\n\tPR_loss_master_run_date_id,\n\tPR_claim_trans_amt,\n\tPR_claim_trans_hist_amt,\n\tPR_new_claim_count,\n\tPR_outstanding_amt,\n\tPR_paid_loss_amt,\n\tPR_paid_exp_amt,\n\tPR_eom_unpaid_loss_adjust_exp,\n\tPR_orig_reserve,\n\tPR_orig_reserve_extract,\n\tPR_asl_dim_id,\n\tPR_asl_prdct_code_dim_id,\n\tPR_strtgc_bus_dvsn_dim_id,\n\tPR_prdct_code_dim_id,\n\tPR_InsuranceReferenceDimId,\n\tPR_AgencyDimId,\n\tPR_SalesDivisionDimId,\n\tPR_InsuranceReferenceCoverageDimId,\n\tPR_CoverageDetailDimId,\n\tPR_edw_claim_occurrence_ak_id,\n\tPR_edw_claimant_cov_det_ak_id,\n\tPR_edw_reins_cov_ak_id,\n\tPR_LossMasterRundate,\n\tPR_pms_trans_code,\n\tPR_claimfinancialtypedimid,\n\tPR_Trans_Kind_code,\n\tPR_Claim_Loss_date,\n\tPR_Pol_key,\n\tPR_claim_cat_code\n\tFROM JNR_Current_Previous\n),\nRTR_Split_Current_Previous_Current_Month AS (SELECT * FROM RTR_Split_Current_Previous WHERE ISNULL(PR_loss_master_fact_id) AND (NOT ISNULL(CR_loss_master_fact_id))),\nRTR_Split_Current_Previous_Previous_Month AS (SELECT * FROM RTR_Split_Current_Previous WHERE ISNULL(CR_loss_master_fact_id) AND (NOT ISNULL(PR_loss_master_fact_id))),\nRTR_Split_Current_Previous_Current_Previous_Month AS (SELECT * FROM RTR_Split_Current_Previous WHERE (NOT ISNULL(CR_loss_master_fact_id)) AND (NOT ISNULL(PR_loss_master_fact_id))),\nExp_CurrentMonth AS (\n\tSELECT\n\tCR_loss_master_fact_id AS CR_loss_master_fact_id1,\n\tCR_outstanding_amt AS CR_outstanding_amt1,\n\tCR_eom_unpaid_loss_adjust_exp AS CR_eom_unpaid_loss_adjust_exp1\n\tFROM RTR_Split_Current_Previous_Current_Month\n),\nUPD_Current_ChangeAmt AS (\n\tSELECT\n\tCR_loss_master_fact_id1, \n\tCR_outstanding_amt1, \n\tCR_eom_unpaid_loss_adjust_exp1\n\tFROM Exp_CurrentMonth\n),\nloss_master_fact_Update_NewReserve AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.loss_master_fact AS T\n\tUSING UPD_Current_ChangeAmt AS S\n\tON T.loss_master_fact_id = S.CR_loss_master_fact_id1\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.ChangeInOutstandingAmount = S.CR_outstanding_amt1, T.ChangeInEOMUnpaidLossAdjustmentExpense = S.CR_eom_unpaid_loss_adjust_exp1\n),\nExp_PreviousMonth AS (\n\tSELECT\n\tPR_audit_id AS PR_audit_id3,\n\tPR_edw_loss_master_calculation_pk_id AS PR_edw_loss_master_calculation_pk_id3,\n\tPR_edw_claim_trans_pk_id AS PR_edw_claim_trans_pk_id3,\n\tPR_edw_claim_reins_trans_pk_id AS PR_edw_claim_reins_trans_pk_id3,\n\tPR_wc_stage_loss_master_pk_id AS PR_wc_stage_loss_master_pk_id3,\n\tPR_loss_master_dim_id AS PR_loss_master_dim_id3,\n\tPR_claim_occurrence_dim_id AS PR_claim_occurrence_dim_id3,\n\tPR_claimant_dim_id AS PR_claimant_dim_id3,\n\tPR_claimant_cov_dim_id AS PR_claimant_cov_dim_id3,\n\tPR_cov_dim_id AS PR_cov_dim_id3,\n\tPR_claim_trans_type_dim_id AS PR_claim_trans_type_dim_id3,\n\tPR_reins_cov_dim_id AS PR_reins_cov_dim_id3,\n\tPR_claim_rep_dim_prim_claim_rep_id AS PR_claim_rep_dim_prim_claim_rep_id3,\n\tPR_claim_rep_dim_examiner_id AS PR_claim_rep_dim_examiner_id3,\n\tPR_pol_dim_id AS PR_pol_dim_id3,\n\tPR_contract_cust_dim_id AS PR_contract_cust_dim_id3,\n\tPR_agency_dim_id AS PR_agency_dim_id3,\n\tPR_claim_pay_dim_id AS PR_claim_pay_dim_id3,\n\tPR_claim_pay_ctgry_type_dim_id AS PR_claim_pay_ctgry_type_dim_id3,\n\tPR_claim_case_dim_id AS PR_claim_case_dim_id3,\n\tPR_claim_trans_date_id AS PR_claim_trans_date_id3,\n\tPR_pol_eff_date_id AS PR_pol_eff_date_id3,\n\tPR_pol_exp_date_id AS PR_pol_exp_date_id3,\n\tPR_source_claim_rpted_date_id AS PR_source_claim_rpted_date_id3,\n\tPR_claim_rpted_date_id AS PR_claim_rpted_date_id3,\n\tPR_claim_loss_date_id AS PR_claim_loss_date_id3,\n\tPR_incptn_date_id AS PR_incptn_date_id3,\n\tPR_loss_master_run_date_id AS PR_loss_master_run_date_id3,\n\tPR_claim_trans_amt AS PR_claim_trans_amt3,\n\tPR_claim_trans_hist_amt AS PR_claim_trans_hist_amt3,\n\tPR_new_claim_count AS PR_new_claim_count3,\n\tPR_outstanding_amt AS PR_outstanding_amt3,\n\tPR_paid_loss_amt AS PR_paid_loss_amt3,\n\tPR_paid_exp_amt AS PR_paid_exp_amt3,\n\tPR_eom_unpaid_loss_adjust_exp AS PR_eom_unpaid_loss_adjust_exp3,\n\tPR_orig_reserve AS PR_orig_reserve3,\n\tPR_orig_reserve_extract AS PR_orig_reserve_extract3,\n\tPR_asl_dim_id AS PR_asl_dim_id3,\n\tPR_asl_prdct_code_dim_id AS PR_asl_prdct_code_dim_id3,\n\tPR_strtgc_bus_dvsn_dim_id AS PR_strtgc_bus_dvsn_dim_id3,\n\tPR_prdct_code_dim_id AS PR_prdct_code_dim_id3,\n\tPR_InsuranceReferenceDimId AS PR_InsuranceReferenceDimId3,\n\tPR_AgencyDimId AS PR_AgencyDimId3,\n\tPR_SalesDivisionDimId AS PR_SalesDivisionDimId3,\n\tPR_InsuranceReferenceCoverageDimId AS PR_InsuranceReferenceCoverageDimId3,\n\tPR_CoverageDetailDimId AS PR_CoverageDetailDimId3,\n\tPR_edw_claim_occurrence_ak_id AS PR_edw_claim_occurrence_ak_id3,\n\tPR_edw_claimant_cov_det_ak_id AS PR_edw_claimant_cov_det_ak_id3,\n\tPR_edw_reins_cov_ak_id AS PR_edw_reins_cov_ak_id3,\n\tPR_LossMasterRundate AS PR_LossMasterRundate3,\n\t-- *INF*: LAST_DAY(ADD_TO_DATE(PR_LossMasterRundate3,'MM',1))\n\tLAST_DAY(DATEADD(MONTH,1,PR_LossMasterRundate3)) AS Out_LossMasterRundate,\n\tPR_pms_trans_code AS PR_pms_trans_code3,\n\t-- *INF*: IIF(PR_pms_trans_code3='92','90',PR_pms_trans_code3)\n\tIFF(PR_pms_trans_code3 = '92', '90', PR_pms_trans_code3) AS Out_PR_pms_trans_code,\n\tPR_claimfinancialtypedimid AS PR_claimfinancialtypedimid3,\n\tPR_Trans_Kind_code AS PR_Trans_Kind_code3,\n\tPR_Claim_Loss_date AS PR_Claim_Loss_date3,\n\tPR_Pol_key AS PR_Pol_key3,\n\tPR_claim_cat_code AS PR_claim_cat_code3\n\tFROM RTR_Split_Current_Previous_Previous_Month\n),\nLKP_calender_dim AS (\n\tSELECT\n\tclndr_id,\n\tclndr_date\n\tFROM (\n\t\tSELECT \n\t\t\tclndr_id,\n\t\t\tclndr_date\n\t\tFROM calendar_dim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY clndr_date ORDER BY clndr_id) = 1\n),\nLkp_Get_FinalAmtForBalance AS (\n\tSELECT\n\tChangeinOutStandingAmount,\n\tChangeInEomUnpaidLossAdjustExp,\n\tPR_Claim_Loss_date,\n\tPR_Pol_key,\n\tPR_claim_cat_code,\n\tedw_claim_occurrence_ak_id,\n\tedw_claimant_cov_det_ak_id,\n\tedw_reins_cov_ak_id,\n\tpms_trans_code,\n\ttrans_kind_code,\n\tclaim_loss_date,\n\tpol_key,\n\tclaim_cat_code\n\tFROM (\n\t\tSELECT sum(ChangeinOutStandingAmount) AS ChangeinOutStandingAmount,\r\n\t\tSUM(ChangeInEOMUnpaidLossAdjustmentExpense) as ChangeInEomUnpaidLossAdjustExp,\r\n\t\tCO.edw_claim_occurrence_ak_id As edw_claim_occurrence_ak_id,\r\n\t\tCC.edw_claimant_cov_det_ak_id AS edw_claimant_cov_det_ak_id,\r\n\t\tRC.edw_reins_cov_ak_id AS edw_reins_cov_ak_id,\r\n\t\tcase when CTT.pms_trans_code='92' then '90' else CTT.pms_trans_code end AS pms_trans_code,\r\n\t\tCTT.trans_kind_code AS trans_kind_code,\r\n\t\tCO.claim_loss_date AS claim_loss_date,\r\n\t\tPOL.pol_key AS pol_key,\r\n\t\tCO.claim_cat_code AS claim_cat_code\r\n\t\tFROM\r\n\t\t@{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.loss_master_fact LMF with(nolock),\r\n\t\t@{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_transaction_type_dim CTT,\r\n\t\t@{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.calendar_dim C,\r\n\t\t@{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_occurrence_dim CO,\r\n\t\t@{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.claimant_coverage_dim CC,\r\n\t\t@{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.reinsurance_coverage_dim RC,\r\n\t\t@{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.policy_dim POL\r\n\t\twhere LMF.claim_trans_type_dim_id=CTT.claim_trans_type_dim_id\r\n\t\tand LMF.loss_master_run_date_id=C.clndr_id\r\n\t\tand LMF.claim_occurrence_dim_id=CO.claim_occurrence_dim_id\r\n\t\tand LMF.claimant_cov_dim_id=CC.claimant_cov_dim_id\r\n\t\tand CTT.pms_trans_code in ('90','92','95','97','98','99')\r\n\t\tand LMF.reins_cov_dim_id=RC.reins_cov_dim_id\r\n\t\tand LMF.pol_dim_id=POL.pol_dim_id\r\n\t\tand C.clndr_date<=dateadd(DD,-1,dateadd(MM,DATEDIFF(mm,0,getdate())-@{pipeline().parameters.NO_OF_MONTHS_PR},0))\r\n\t\tgroup by CO.edw_claim_occurrence_ak_id,CC.edw_claimant_cov_det_ak_id,RC.edw_reins_cov_ak_id,case when CTT.pms_trans_code='92' then '90' else CTT.pms_trans_code end,CTT.trans_kind_code,CO.claim_loss_date,POL.pol_key,CO.claim_cat_code\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_claim_occurrence_ak_id,edw_claimant_cov_det_ak_id,edw_reins_cov_ak_id,pms_trans_code,trans_kind_code,claim_loss_date,pol_key,claim_cat_code ORDER BY ChangeinOutStandingAmount) = 1\n),\nExp_TgtCollect AS (\n\tSELECT\n\t-9 AS PR_audit_id3,\n\tExp_PreviousMonth.PR_edw_loss_master_calculation_pk_id3,\n\tExp_PreviousMonth.PR_edw_claim_trans_pk_id3,\n\tExp_PreviousMonth.PR_edw_claim_reins_trans_pk_id3,\n\tExp_PreviousMonth.PR_wc_stage_loss_master_pk_id3,\n\tExp_PreviousMonth.PR_loss_master_dim_id3,\n\tExp_PreviousMonth.PR_claim_occurrence_dim_id3,\n\tExp_PreviousMonth.PR_claimant_dim_id3,\n\tExp_PreviousMonth.PR_claimant_cov_dim_id3,\n\tExp_PreviousMonth.PR_cov_dim_id3,\n\tExp_PreviousMonth.PR_claim_trans_type_dim_id3,\n\tExp_PreviousMonth.PR_reins_cov_dim_id3,\n\tExp_PreviousMonth.PR_claim_rep_dim_prim_claim_rep_id3,\n\tExp_PreviousMonth.PR_claim_rep_dim_examiner_id3,\n\tExp_PreviousMonth.PR_pol_dim_id3,\n\tExp_PreviousMonth.PR_contract_cust_dim_id3,\n\tExp_PreviousMonth.PR_agency_dim_id3,\n\tExp_PreviousMonth.PR_claim_pay_dim_id3,\n\tExp_PreviousMonth.PR_claim_pay_ctgry_type_dim_id3,\n\tExp_PreviousMonth.PR_claim_case_dim_id3,\n\tExp_PreviousMonth.PR_claim_trans_date_id3,\n\tExp_PreviousMonth.PR_pol_eff_date_id3,\n\tExp_PreviousMonth.PR_pol_exp_date_id3,\n\tExp_PreviousMonth.PR_source_claim_rpted_date_id3,\n\tExp_PreviousMonth.PR_claim_rpted_date_id3,\n\tExp_PreviousMonth.PR_claim_loss_date_id3,\n\tExp_PreviousMonth.PR_incptn_date_id3,\n\tLKP_calender_dim.clndr_id AS PR_loss_master_run_date_id3,\n\t0 AS PR_claim_trans_amt3,\n\t0 AS PR_claim_trans_hist_amt3,\n\t0 AS PR_new_claim_count3,\n\t0 AS PR_outstanding_amt3,\n\t0 AS PR_paid_loss_amt3,\n\t0 AS PR_paid_exp_amt3,\n\t0 AS PR_eom_unpaid_loss_adjust_exp3,\n\t0 AS PR_orig_reserve3,\n\t0 AS PR_orig_reserve_extract3,\n\tExp_PreviousMonth.PR_asl_dim_id3,\n\tExp_PreviousMonth.PR_asl_prdct_code_dim_id3,\n\tExp_PreviousMonth.PR_strtgc_bus_dvsn_dim_id3,\n\tExp_PreviousMonth.PR_prdct_code_dim_id3,\n\tExp_PreviousMonth.PR_InsuranceReferenceDimId3,\n\tExp_PreviousMonth.PR_AgencyDimId3,\n\tExp_PreviousMonth.PR_SalesDivisionDimId3,\n\tExp_PreviousMonth.PR_InsuranceReferenceCoverageDimId3,\n\tExp_PreviousMonth.PR_CoverageDetailDimId3,\n\tLkp_Get_FinalAmtForBalance.ChangeinOutStandingAmount,\n\t0-ChangeinOutStandingAmount AS Out_ChangeinOutStandingAmount3,\n\tLkp_Get_FinalAmtForBalance.ChangeInEomUnpaidLossAdjustExp,\n\t0-ChangeInEomUnpaidLossAdjustExp AS Out_ChangeInEomUnpaidLossAdjustExp3,\n\tExp_PreviousMonth.PR_claimfinancialtypedimid3\n\tFROM Exp_PreviousMonth\n\tLEFT JOIN LKP_calender_dim\n\tON LKP_calender_dim.clndr_date = Exp_PreviousMonth.Out_LossMasterRundate\n\tLEFT JOIN Lkp_Get_FinalAmtForBalance\n\tON Lkp_Get_FinalAmtForBalance.edw_claim_occurrence_ak_id = Exp_PreviousMonth.PR_edw_claim_occurrence_ak_id3 AND Lkp_Get_FinalAmtForBalance.edw_claimant_cov_det_ak_id = Exp_PreviousMonth.PR_edw_claimant_cov_det_ak_id3 AND Lkp_Get_FinalAmtForBalance.edw_reins_cov_ak_id = Exp_PreviousMonth.PR_edw_reins_cov_ak_id3 AND Lkp_Get_FinalAmtForBalance.pms_trans_code = Exp_PreviousMonth.Out_PR_pms_trans_code AND Lkp_Get_FinalAmtForBalance.trans_kind_code = Exp_PreviousMonth.PR_Trans_Kind_code3 AND Lkp_Get_FinalAmtForBalance.claim_loss_date = Exp_PreviousMonth.PR_Claim_Loss_date3 AND Lkp_Get_FinalAmtForBalance.pol_key = Exp_PreviousMonth.PR_Pol_key3 AND Lkp_Get_FinalAmtForBalance.claim_cat_code = Exp_PreviousMonth.PR_claim_cat_code3\n),\nFIL_Exclude_PriorMonth_CloseOutTransactions AS (\n\tSELECT\n\tPR_audit_id3, \n\tPR_edw_loss_master_calculation_pk_id3, \n\tPR_edw_claim_trans_pk_id3, \n\tPR_edw_claim_reins_trans_pk_id3, \n\tPR_wc_stage_loss_master_pk_id3, \n\tPR_loss_master_dim_id3, \n\tPR_claim_occurrence_dim_id3, \n\tPR_claimant_dim_id3, \n\tPR_claimant_cov_dim_id3, \n\tPR_cov_dim_id3, \n\tPR_claim_trans_type_dim_id3, \n\tPR_reins_cov_dim_id3, \n\tPR_claim_rep_dim_prim_claim_rep_id3, \n\tPR_claim_rep_dim_examiner_id3, \n\tPR_pol_dim_id3, \n\tPR_contract_cust_dim_id3, \n\tPR_agency_dim_id3, \n\tPR_claim_pay_dim_id3, \n\tPR_claim_pay_ctgry_type_dim_id3, \n\tPR_claim_case_dim_id3, \n\tPR_claim_trans_date_id3, \n\tPR_pol_eff_date_id3, \n\tPR_pol_exp_date_id3, \n\tPR_source_claim_rpted_date_id3, \n\tPR_claim_rpted_date_id3, \n\tPR_claim_loss_date_id3, \n\tPR_incptn_date_id3, \n\tPR_loss_master_run_date_id3, \n\tPR_claim_trans_amt3, \n\tPR_claim_trans_hist_amt3, \n\tPR_new_claim_count3, \n\tPR_outstanding_amt3, \n\tPR_paid_loss_amt3, \n\tPR_paid_exp_amt3, \n\tPR_eom_unpaid_loss_adjust_exp3, \n\tPR_orig_reserve3, \n\tPR_orig_reserve_extract3, \n\tPR_asl_dim_id3, \n\tPR_asl_prdct_code_dim_id3, \n\tPR_strtgc_bus_dvsn_dim_id3, \n\tPR_prdct_code_dim_id3, \n\tPR_InsuranceReferenceDimId3, \n\tPR_AgencyDimId3, \n\tPR_SalesDivisionDimId3, \n\tPR_InsuranceReferenceCoverageDimId3, \n\tPR_CoverageDetailDimId3, \n\tOut_ChangeinOutStandingAmount3, \n\tOut_ChangeInEomUnpaidLossAdjustExp3, \n\tPR_claimfinancialtypedimid3\n\tFROM Exp_TgtCollect\n\tWHERE IIF(Out_ChangeinOutStandingAmount3=0.00 AND Out_ChangeInEomUnpaidLossAdjustExp3=0.00,'FALSE','TRUE')='TRUE'\n),\nloss_master_fact_ClosedReserve_BalanceEntry AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.loss_master_fact\n\t(audit_id, edw_loss_master_calculation_pk_id, edw_claim_trans_pk_id, edw_claim_reins_trans_pk_id, wc_stage_loss_master_pk_id, loss_master_dim_id, claim_occurrence_dim_id, claimant_dim_id, claimant_cov_dim_id, cov_dim_id, claim_trans_type_dim_id, reins_cov_dim_id, claim_rep_dim_prim_claim_rep_id, claim_rep_dim_examiner_id, pol_dim_id, contract_cust_dim_id, agency_dim_id, claim_pay_dim_id, claim_pay_ctgry_type_dim_id, claim_case_dim_id, claim_trans_date_id, pol_eff_date_id, pol_exp_date_id, source_claim_rpted_date_id, claim_rpted_date_id, claim_loss_date_id, incptn_date_id, loss_master_run_date_id, claim_trans_amt, claim_trans_hist_amt, new_claim_count, outstanding_amt, paid_loss_amt, paid_exp_amt, eom_unpaid_loss_adjust_exp, orig_reserve, orig_reserve_extract, asl_dim_id, asl_prdct_code_dim_id, strtgc_bus_dvsn_dim_id, prdct_code_dim_id, InsuranceReferenceDimId, AgencyDimId, SalesDivisionDimId, InsuranceReferenceCoverageDimId, CoverageDetailDimId, ChangeInOutstandingAmount, ChangeInEOMUnpaidLossAdjustmentExpense, ClaimFinancialTypeDimId)\n\tSELECT \n\tPR_audit_id3 AS AUDIT_ID, \n\tPR_edw_loss_master_calculation_pk_id3 AS EDW_LOSS_MASTER_CALCULATION_PK_ID, \n\tPR_edw_claim_trans_pk_id3 AS EDW_CLAIM_TRANS_PK_ID, \n\tPR_edw_claim_reins_trans_pk_id3 AS EDW_CLAIM_REINS_TRANS_PK_ID, \n\tPR_wc_stage_loss_master_pk_id3 AS WC_STAGE_LOSS_MASTER_PK_ID, \n\tPR_loss_master_dim_id3 AS LOSS_MASTER_DIM_ID, \n\tPR_claim_occurrence_dim_id3 AS CLAIM_OCCURRENCE_DIM_ID, \n\tPR_claimant_dim_id3 AS CLAIMANT_DIM_ID, \n\tPR_claimant_cov_dim_id3 AS CLAIMANT_COV_DIM_ID, \n\tPR_cov_dim_id3 AS COV_DIM_ID, \n\tPR_claim_trans_type_dim_id3 AS CLAIM_TRANS_TYPE_DIM_ID, \n\tPR_reins_cov_dim_id3 AS REINS_COV_DIM_ID, \n\tPR_claim_rep_dim_prim_claim_rep_id3 AS CLAIM_REP_DIM_PRIM_CLAIM_REP_ID, \n\tPR_claim_rep_dim_examiner_id3 AS CLAIM_REP_DIM_EXAMINER_ID, \n\tPR_pol_dim_id3 AS POL_DIM_ID, \n\tPR_contract_cust_dim_id3 AS CONTRACT_CUST_DIM_ID, \n\tPR_agency_dim_id3 AS AGENCY_DIM_ID, \n\tPR_claim_pay_dim_id3 AS CLAIM_PAY_DIM_ID, \n\tPR_claim_pay_ctgry_type_dim_id3 AS CLAIM_PAY_CTGRY_TYPE_DIM_ID, \n\tPR_claim_case_dim_id3 AS CLAIM_CASE_DIM_ID, \n\tPR_claim_trans_date_id3 AS CLAIM_TRANS_DATE_ID, \n\tPR_pol_eff_date_id3 AS POL_EFF_DATE_ID, \n\tPR_pol_exp_date_id3 AS POL_EXP_DATE_ID, \n\tPR_source_claim_rpted_date_id3 AS SOURCE_CLAIM_RPTED_DATE_ID, \n\tPR_claim_rpted_date_id3 AS CLAIM_RPTED_DATE_ID, \n\tPR_claim_loss_date_id3 AS CLAIM_LOSS_DATE_ID, \n\tPR_incptn_date_id3 AS INCPTN_DATE_ID, \n\tPR_loss_master_run_date_id3 AS LOSS_MASTER_RUN_DATE_ID, \n\tPR_claim_trans_amt3 AS CLAIM_TRANS_AMT, \n\tPR_claim_trans_hist_amt3 AS CLAIM_TRANS_HIST_AMT, \n\tPR_new_claim_count3 AS NEW_CLAIM_COUNT, \n\tPR_outstanding_amt3 AS OUTSTANDING_AMT, \n\tPR_paid_loss_amt3 AS PAID_LOSS_AMT, \n\tPR_paid_exp_amt3 AS PAID_EXP_AMT, \n\tPR_eom_unpaid_loss_adjust_exp3 AS EOM_UNPAID_LOSS_ADJUST_EXP, \n\tPR_orig_reserve3 AS ORIG_RESERVE, \n\tPR_orig_reserve_extract3 AS ORIG_RESERVE_EXTRACT, \n\tPR_asl_dim_id3 AS ASL_DIM_ID, \n\tPR_asl_prdct_code_dim_id3 AS ASL_PRDCT_CODE_DIM_ID, \n\tPR_strtgc_bus_dvsn_dim_id3 AS STRTGC_BUS_DVSN_DIM_ID, \n\tPR_prdct_code_dim_id3 AS PRDCT_CODE_DIM_ID, \n\tPR_InsuranceReferenceDimId3 AS INSURANCEREFERENCEDIMID, \n\tPR_AgencyDimId3 AS AGENCYDIMID, \n\tPR_SalesDivisionDimId3 AS SALESDIVISIONDIMID, \n\tPR_InsuranceReferenceCoverageDimId3 AS INSURANCEREFERENCECOVERAGEDIMID, \n\tPR_CoverageDetailDimId3 AS COVERAGEDETAILDIMID, \n\tOut_ChangeinOutStandingAmount3 AS CHANGEINOUTSTANDINGAMOUNT, \n\tOut_ChangeInEomUnpaidLossAdjustExp3 AS CHANGEINEOMUNPAIDLOSSADJUSTMENTEXPENSE, \n\tPR_claimfinancialtypedimid3 AS CLAIMFINANCIALTYPEDIMID\n\tFROM FIL_Exclude_PriorMonth_CloseOutTransactions\n),\nExp_CurrentMonth_ChangeInAmt AS (\n\tSELECT\n\tCR_loss_master_fact_id AS CR_loss_master_fact_id4,\n\tCR_outstanding_amt AS CR_outstanding_amt4,\n\tPR_outstanding_amt AS PR_outstanding_amt4,\n\tCR_outstanding_amt4-PR_outstanding_amt4 AS ChangeInOutstandingAmt,\n\tCR_eom_unpaid_loss_adjust_exp AS CR_eom_unpaid_loss_adjust_exp4,\n\tPR_eom_unpaid_loss_adjust_exp AS PR_eom_unpaid_loss_adjust_exp4,\n\tCR_eom_unpaid_loss_adjust_exp4-PR_eom_unpaid_loss_adjust_exp4 AS ChangeINEomUnpaidLossAdjustExp\n\tFROM RTR_Split_Current_Previous_Current_Previous_Month\n),\nUPD_CurrentPrevious_ChangeAmt AS (\n\tSELECT\n\tCR_loss_master_fact_id4, \n\tChangeInOutstandingAmt, \n\tChangeINEomUnpaidLossAdjustExp\n\tFROM Exp_CurrentMonth_ChangeInAmt\n),\nloss_master_fact_Update_OngoingReserve AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.loss_master_fact AS T\n\tUSING UPD_CurrentPrevious_ChangeAmt AS S\n\tON T.loss_master_fact_id = S.CR_loss_master_fact_id4\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.ChangeInOutstandingAmount = S.ChangeInOutstandingAmt, T.ChangeInEOMUnpaidLossAdjustmentExpense = S.ChangeINEomUnpaidLossAdjustExp\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "NO_OF_MONTHS_CR": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "NO_OF_MONTHS_PR": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "ClaimsDataMart/"
        },
        "annotations": []
    }
}