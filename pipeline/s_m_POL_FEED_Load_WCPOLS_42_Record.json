{
    "name": "s_m_POL_FEED_Load_WCPOLS_42_Record",
    "properties": {
        "activities": [
            {
                "name": "m_POL_FEED_Load_WCPOLS_42_Record",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_SupWCPOLS AS (\n\tSELECT\n\tWCPOLSCode,\n\tSourcesystemID,\n\tSourceCode,\n\tTableName,\n\tProcessName,\n\ti_SourcesystemID,\n\ti_SourceCode,\n\ti_TableName,\n\ti_ProcessName\n\tFROM (\n\t\tSELECT\r\n\t\t     WCPOLSCode as WCPOLSCode\r\n\t\t\t,SourcesystemID as SourcesystemID\r\n\t\t\t,SourceCode as SourceCode\r\n\t\t\t,TableName as TableName\r\n\t\t\t,ProcessName as ProcessName\r\n\t\tFROM SupWCPOLS\r\n\t\tWHERE CurrentSnapshotFlag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY SourcesystemID,SourceCode,TableName,ProcessName ORDER BY WCPOLSCode) = 1\n),\nSQ_WCPols00Record AS (\n\tSELECT\r\n\t\tWCTrackHistoryID,\r\n\t\tLinkData,\r\n\t     AuditId\r\n\tFROM dbo.WCPols00Record\r\n\tWHERE 1=1\r\n\tAND AuditId = @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tORDER BY WCTrackHistoryID\n),\nSQ_WorkWCForms AS (\n\tWITH ValueCnt_CTE\r\n\tAS\r\n\t(SELECT\r\n\t\t\tST1.WCTrackHistoryID\r\n\t\t\t,COUNT(DISTINCT ST1.ModifierValue) ModValueCnt\r\n\t\r\n\t\tFROM dbo.WorkWCStateTerm ST1\r\n\t\r\n\t\tINNER JOIN dbo.WorkWCLine L1\r\n\t\t\tON L1.WCTrackHistoryID = ST1.WCTrackHistoryID\r\n\t\r\n\t\tWHERE 1 = 1\r\n\t\tAND L1.InterstateRiskID > 0\r\n\t\tAND ST1.ExperienceModType = 'Contingent'\r\n\t\tAND ST1.[State] NOT IN ('DE', 'MI', 'NJ', 'NY', 'PA')\r\n\t\tAND ST1.AuditId = @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\t\r\n\t\tGROUP BY ST1.WCTrackHistoryID\r\n\t)\r\n\t\r\n\tSELECT\r\n\t\tST.WCTrackHistoryID\r\n\t\t,F.FormName\r\n\t\t,ST.ModifierValue\r\n\t\t,ST.[State]\r\n\t\t,P.TransactionEffectiveDate\r\n\t\t,PT.Name\r\n\t\t,ISNULL(L.InterstateRiskID, 0) AS InterstateRiskID\r\n\t\t,ST.ExperienceModEffectiveDate\r\n\t\t,ST.PeriodStartDate\r\n\t\t,ST.TermType\r\n\t\t,ISNULL(VAL.ModValueCnt, 0) AS ModValueCnt\r\n\t\r\n\tFROM dbo.WorkWCStateTerm ST\r\n\t\r\n\tINNER JOIN dbo.WorkWCForms F\r\n\t\tON ST.WCTrackHistoryID = F.WCTrackHistoryID\r\n\t\r\n\tINNER JOIN dbo.WorkWCPolicy P\r\n\t\tON P.WCTrackHistoryID = ST.WCTrackHistoryID\r\n\t\r\n\tINNER JOIN dbo.WorkWCParty PT\r\n\t\tON PT.WCTrackHistoryID = ST.WCTrackHistoryID\r\n\t\t\tAND PT.PartyAssociationType = 'Account'\r\n\t\r\n\tINNER JOIN dbo.WorkWCLine L\r\n\t\tON L.WCTrackHistoryID = ST.WCTrackHistoryID\r\n\t\r\n\tLEFT JOIN ValueCnt_CTE VAL\r\n\t\tON VAL.WCTrackHistoryID = ST.WCTrackHistoryID\r\n\t\r\n\tWHERE 1 = 1\r\n\tAND ST.ExperienceModType = 'Contingent'\r\n\tAND ST.[State] NOT IN ('DE', 'MI', 'NJ', 'NY', 'PA')\r\n\tAND ST.AuditId = @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\r\n\tAND FormName LIKE 'WC000412%'\r\n\tAND ST.TermType in ('ORG', 'EMF')\r\n\t@{pipeline().parameters.WHERE_CLAUSE_42}\r\n\t\r\n\tORDER BY ST.WCTrackHistoryID\n),\nJNR_42_Record AS (SELECT\n\tSQ_WCPols00Record.WCTrackHistoryID, \n\tSQ_WCPols00Record.LinkData, \n\tSQ_WCPols00Record.AuditId, \n\tSQ_WorkWCForms.WCTrackHistoryID AS WCTrackHistoryID1, \n\tSQ_WorkWCForms.FormName, \n\tSQ_WorkWCForms.ModifierValue, \n\tSQ_WorkWCForms.State, \n\tSQ_WorkWCForms.TransactionEffectiveDate, \n\tSQ_WorkWCForms.Name, \n\tSQ_WorkWCForms.InterstateRiskID, \n\tSQ_WorkWCForms.ExperienceModEffectiveDate, \n\tSQ_WorkWCForms.PeriodStartDate, \n\tSQ_WorkWCForms.TermType, \n\tSQ_WorkWCForms.ModValueCnt\n\tFROM SQ_WorkWCForms\n\tINNER JOIN SQ_WCPols00Record\n\tON SQ_WCPols00Record.WCTrackHistoryID = SQ_WorkWCForms.WCTrackHistoryID\n),\nRTRTRANS AS (\n\tSELECT\n\tWCTrackHistoryID,\n\tLinkData,\n\tAuditId,\n\tFormName,\n\tModifierValue,\n\tState,\n\tTransactionEffectiveDate,\n\tName,\n\tExperienceModEffectiveDate,\n\tPeriodStartDate,\n\tTermType,\n\tModValueCnt\n\tFROM JNR_42_Record\n),\nRTRTRANS_Build_99_State AS (SELECT * FROM RTRTRANS WHERE ModValueCnt = 1),\nRTRTRANS_Passthrough_State AS (SELECT * FROM RTRTRANS WHERE ModValueCnt <> 1),\nAGGTRANS AS (\n\tSELECT\n\tWCTrackHistoryID AS WCTrackHistoryID1,\n\tLinkData AS LinkData1,\n\tAuditId AS AuditId1,\n\tFormName AS FormName1,\n\tModifierValue AS ModifierValue1,\n\tState AS State1,\n\tTransactionEffectiveDate AS TransactionEffectiveDate1,\n\tName AS Name1,\n\tExperienceModEffectiveDate AS ExperienceModEffectiveDate1,\n\tPeriodStartDate AS PeriodStartDate1,\n\tTermType AS TermType1,\n\tModValueCnt AS ModValueCnt1\n\tFROM RTRTRANS_Build_99_State\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY WCTrackHistoryID1 ORDER BY NULL) = 1\n),\nUnion AS (\n\tSELECT WCTrackHistoryID1, LinkData1, AuditId1, FormName1, ModifierValue1, State1, TransactionEffectiveDate1, Name1, ExperienceModEffectiveDate1, ModValueCnt1, PeriodStartDate1, TermType1\n\tFROM AGGTRANS\n\tUNION\n\tSELECT WCTrackHistoryID AS WCTrackHistoryID1, LinkData AS LinkData1, AuditId AS AuditId1, FormName AS FormName1, ModifierValue AS ModifierValue1, State AS State1, TransactionEffectiveDate AS TransactionEffectiveDate1, Name AS Name1, ExperienceModEffectiveDate AS ExperienceModEffectiveDate1, ModValueCnt AS ModValueCnt1, PeriodStartDate AS PeriodStartDate1, TermType AS TermType1\n\tFROM RTRTRANS_Passthrough_State\n),\nEXP_42_Format_Output AS (\n\tSELECT\n\tCURRENT_TIMESTAMP AS o_ExtractDate,\n\tAuditId1 AS AuditId,\n\tWCTrackHistoryID1 AS WCTrackHistoryID,\n\tLinkData1 AS LinkData,\n\tFormName1 AS FormName,\n\tState1 AS State,\n\t-- *INF*: IIF(ModValueCnt=1,'99',:LKP.LKP_SupWCPOLS('DCT',State,'WCPOLS42Record','StateCodeRecord42'))\n\tIFF(\n\t    ModValueCnt = 1, '99', LKP_SUPWCPOLS__DCT_State_WCPOLS42Record_StateCodeRecord42.WCPOLSCode\n\t) AS o_StateCode,\n\t'42' AS o_RecordTypeCode,\n\t'WC000412' AS o_EndorsementNumber,\n\t-- *INF*: SUBSTR(FormName, Length(FormName)-4, 1)\n\tSUBSTR(FormName, Length(FormName) - 4, 1) AS v_BureauID,\n\t-- *INF*: IIF(v_BureauID >= 'A' and v_BureauID <= 'Z', v_BureauID,' ')\n\tIFF(v_BureauID >= 'A' and v_BureauID <= 'Z', v_BureauID, ' ') AS o_BureauVersionIdentifierEditionIdentifier,\n\t-- *INF*: SUBSTR(FormName, Length(FormName)-3, 4)\n\tSUBSTR(FormName, Length(FormName) - 3, 4) AS o_CarrierVersionIdentifier,\n\tExperienceModEffectiveDate1 AS ExperienceModEffectiveDate,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- LTRIM(RTRIM(TermType))='EMF',To_Char(PeriodStartDate,'YYMMDD'),\r\n\t-- LTRIM(RTRIM(TermType))='ORG',To_Char(PeriodStartDate,'YYMMDD'),\r\n\t-- LPAD('',8,' ')\r\n\t-- )\n\tDECODE(\n\t    TRUE,\n\t    LTRIM(RTRIM(TermType)) = 'EMF', To_Char(PeriodStartDate, 'YYMMDD'),\n\t    LTRIM(RTRIM(TermType)) = 'ORG', To_Char(PeriodStartDate, 'YYMMDD'),\n\t    LPAD('', 8, ' ')\n\t) AS o_ContingentModificationEffectiveDate,\n\tModifierValue1 AS ContingentExperienceModificationFactor,\n\t-- *INF*: TO_CHAR(TO_DECIMAL(ContingentExperienceModificationFactor,3)*1000)\n\tTO_CHAR(CAST(ContingentExperienceModificationFactor AS FLOAT) * 1000) AS v_ContingentExperienceModificationFactor,\n\tv_ContingentExperienceModificationFactor AS o_ContingentExperienceModificationFactor,\n\tTransactionEffectiveDate1 AS TransactionEffectiveDate,\n\t-- *INF*: To_Char(TransactionEffectiveDate, 'YYMMDD')\n\tTo_Char(TransactionEffectiveDate, 'YYMMDD') AS o_EndorsementEffectiveDate,\n\tName1 AS NameOfInsured,\n\tModValueCnt1 AS ModValueCnt,\n\tPeriodStartDate1 AS PeriodStartDate,\n\tTermType1 AS TermType\n\tFROM Union\n\tLEFT JOIN LKP_SUPWCPOLS LKP_SUPWCPOLS__DCT_State_WCPOLS42Record_StateCodeRecord42\n\tON LKP_SUPWCPOLS__DCT_State_WCPOLS42Record_StateCodeRecord42.SourcesystemID = 'DCT'\n\tAND LKP_SUPWCPOLS__DCT_State_WCPOLS42Record_StateCodeRecord42.SourceCode = State\n\tAND LKP_SUPWCPOLS__DCT_State_WCPOLS42Record_StateCodeRecord42.TableName = 'WCPOLS42Record'\n\tAND LKP_SUPWCPOLS__DCT_State_WCPOLS42Record_StateCodeRecord42.ProcessName = 'StateCodeRecord42'\n\n),\nWCPols42Record AS (\n\n\t------------ PRE SQL ----------\n\tDELETE\r\n\t  FROM dbo.WCPols42Record\r\n\t  WHERE 1=1\r\n\t  AND AuditId = @{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\n\t-------------------------------\n\n\n\tINSERT INTO WCPols42Record\n\t(ExtractDate, AuditId, WCTrackHistoryID, LinkData, StateCode, RecordTypeCode, EndorsementNumber, BureauVersionIdentifierEditionIdentifier, CarrierVersionIdentifier, ContingentModificationEffectiveDate, ContingentExperienceModificationFactor, NameOfInsured, EndorsementEffectiveDate)\n\tSELECT \n\to_ExtractDate AS EXTRACTDATE, \n\tAUDITID, \n\tWCTRACKHISTORYID, \n\tLINKDATA, \n\to_StateCode AS STATECODE, \n\to_RecordTypeCode AS RECORDTYPECODE, \n\to_EndorsementNumber AS ENDORSEMENTNUMBER, \n\to_BureauVersionIdentifierEditionIdentifier AS BUREAUVERSIONIDENTIFIEREDITIONIDENTIFIER, \n\to_CarrierVersionIdentifier AS CARRIERVERSIONIDENTIFIER, \n\to_ContingentModificationEffectiveDate AS CONTINGENTMODIFICATIONEFFECTIVEDATE, \n\to_ContingentExperienceModificationFactor AS CONTINGENTEXPERIENCEMODIFICATIONFACTOR, \n\tNAMEOFINSURED, \n\to_EndorsementEffectiveDate AS ENDORSEMENTEFFECTIVEDATE\n\tFROM EXP_42_Format_Output\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_CLAUSE_42": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "DataFeed -Informatica/PolicyDataServices/"
        },
        "annotations": []
    }
}