{
    "name": "s_m_POL_CUS_DW_LOAD_sup_business_classification_code",
    "properties": {
        "activities": [
            {
                "name": "m_POL_CUS_DW_LOAD_sup_business_classification_code",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_BCCBusinessSegmentSBG AS (\n\tSELECT\n\t\tBCCBusinessSegmentSBGId,\n\t\tModifiedUserId,\n\t\tModifiedDate,\n\t\tEffectiveDate,\n\t\tExpirationDate,\n\t\tBusinessClassificationCode,\n\t\tBusinessClassificationDescription,\n\t\tBusinessSegmentCode,\n\t\tBusinessSegmentDescription,\n\t\tStrategicBusinessGroupCode,\n\t\tStrategicBusinessGroupDescription,\n\t\tArgentBusinessSegmentCode,\n\t\tArgentBusinessSegmentDescription\n\tFROM BCCBusinessSegmentSBG\n\tWHERE BCCBusinessSegmentSBG.ModifiedDate>'@{pipeline().parameters.SELECTION_START_TS}'\n),\nExp_BCCBusinessSegmentSBG AS (\n\tSELECT\n\tBCCBusinessSegmentSBGId,\n\tModifiedUserId,\n\tModifiedDate,\n\tEffectiveDate,\n\tExpirationDate,\n\t-- *INF*: to_date(to_char(ExpirationDate, 'YYYY-MM-DD HH:MI:SS'), 'YYYY-MM-DD HH:MI:SS')\n\tTO_TIMESTAMP(to_char(ExpirationDate, 'YYYY-MM-DD HH:MI:SS'), 'YYYY-MM-DD HH:MI:SS') AS o_ExpirationDate,\n\tBusinessClassificationCode,\n\t-- *INF*: LPAD(BusinessClassificationCode,5,'0')\n\tLPAD(BusinessClassificationCode, 5, '0') AS o_BusinessClassificationCode,\n\tBusinessClassificationDescription,\n\tBusinessSegmentCode,\n\tBusinessSegmentDescription,\n\tStrategicBusinessGroupCode,\n\tStrategicBusinessGroupDescription,\n\tArgentBusinessSegmentCode,\n\tArgentBusinessSegmentDescription\n\tFROM SQ_BCCBusinessSegmentSBG\n),\nAGG_RemoveDuplicate AS (\n\tSELECT\n\tBCCBusinessSegmentSBGId,\n\tModifiedUserId,\n\tModifiedDate,\n\tEffectiveDate,\n\to_ExpirationDate AS ExpirationDate,\n\to_BusinessClassificationCode AS BusinessClassificationCode,\n\tBusinessClassificationDescription,\n\tBusinessSegmentCode,\n\tBusinessSegmentDescription,\n\tStrategicBusinessGroupCode,\n\tStrategicBusinessGroupDescription,\n\tArgentBusinessSegmentCode,\n\tArgentBusinessSegmentDescription\n\tFROM Exp_BCCBusinessSegmentSBG\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EffectiveDate, BusinessClassificationCode ORDER BY NULL) = 1\n),\nLKP_Target AS (\n\tSELECT\n\tin_EffectiveDate,\n\tin_BusinessClassificationCode,\n\tsup_bus_class_code_id,\n\tcrrnt_snpsht_flag,\n\taudit_id,\n\teff_from_date,\n\teff_to_date,\n\tsource_sys_id,\n\tcreated_date,\n\tmodified_date,\n\tbus_class_code,\n\tbus_class_code_descript,\n\tStandardBusinessClassCode,\n\tStandardBusinessClassCodeDescription,\n\tBusinessSegmentCode,\n\tBusinessSegmentDescription,\n\tStrategicBusinessGroupCode,\n\tStrategicBusinessGroupDescription,\n\tArgentBusinessSegmentCode,\n\tArgentBusinessSegmentDescription\n\tFROM (\n\t\tSELECT \n\t\t\tin_EffectiveDate,\n\t\t\tin_BusinessClassificationCode,\n\t\t\tsup_bus_class_code_id,\n\t\t\tcrrnt_snpsht_flag,\n\t\t\taudit_id,\n\t\t\teff_from_date,\n\t\t\teff_to_date,\n\t\t\tsource_sys_id,\n\t\t\tcreated_date,\n\t\t\tmodified_date,\n\t\t\tbus_class_code,\n\t\t\tbus_class_code_descript,\n\t\t\tStandardBusinessClassCode,\n\t\t\tStandardBusinessClassCodeDescription,\n\t\t\tBusinessSegmentCode,\n\t\t\tBusinessSegmentDescription,\n\t\t\tStrategicBusinessGroupCode,\n\t\t\tStrategicBusinessGroupDescription,\n\t\t\tArgentBusinessSegmentCode,\n\t\t\tArgentBusinessSegmentDescription\n\t\tFROM sup_business_classification_code\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY eff_from_date,bus_class_code ORDER BY in_EffectiveDate) = 1\n),\nExp_GetValue AS (\n\tSELECT\n\tLKP_Target.sup_bus_class_code_id,\n\t'1' AS o_CurrenctSnapShotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditId,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS Source_sys_id,\n\tLKP_Target.created_date AS i_created_date,\n\t-- *INF*: IIF(ISNULL(i_created_date), SYSDATE, i_created_date)\n\tIFF(i_created_date IS NULL, CURRENT_TIMESTAMP, i_created_date) AS CreatedDate,\n\tSYSDATE AS ModifiedDate,\n\tAGG_RemoveDuplicate.EffectiveDate,\n\tAGG_RemoveDuplicate.ExpirationDate,\n\tAGG_RemoveDuplicate.BusinessClassificationCode,\n\tAGG_RemoveDuplicate.BusinessClassificationDescription AS i_BusinessClassificationDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_BusinessClassificationDescription)\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_BusinessClassificationDescription) AS o_BusinessClassificationDescription,\n\tAGG_RemoveDuplicate.BusinessSegmentCode AS i_BusinessSegmentCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_BusinessSegmentCode)\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_BusinessSegmentCode) AS o_BusinessSegmentCode,\n\tAGG_RemoveDuplicate.BusinessSegmentDescription AS i_BusinessSegmentDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_BusinessSegmentDescription)\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_BusinessSegmentDescription) AS o_BusinessSegmentDescription,\n\tAGG_RemoveDuplicate.StrategicBusinessGroupCode AS i_StrategicBusinessGroupCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_StrategicBusinessGroupCode)\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_StrategicBusinessGroupCode) AS o_StrategicBusinessGroupCode,\n\tAGG_RemoveDuplicate.StrategicBusinessGroupDescription AS i_StrategicBusinessGroupDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_StrategicBusinessGroupDescription)\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_StrategicBusinessGroupDescription) AS o_StrategicBusinessGroupDescription,\n\tAGG_RemoveDuplicate.ArgentBusinessSegmentCode AS i_ArgentBusinessSegmentCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_ArgentBusinessSegmentCode)\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_ArgentBusinessSegmentCode) AS o_ArgentBusinessSegmentCode,\n\tAGG_RemoveDuplicate.ArgentBusinessSegmentDescription AS i_ArgentBusinessSegmentDescription,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_ArgentBusinessSegmentDescription)\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_ArgentBusinessSegmentDescription) AS o_ArgentBusinessSegmentDescription,\n\tLKP_Target.eff_to_date AS lkp_eff_to_date,\n\tLKP_Target.bus_class_code_descript AS lkp_bus_class_code_descript,\n\tLKP_Target.BusinessSegmentCode AS lkp_BusinessSegmentCode,\n\tLKP_Target.BusinessSegmentDescription AS lkp_BusinessSegmentDescription,\n\tLKP_Target.StrategicBusinessGroupCode AS lkp_StrategicBusinessGroupCode,\n\tLKP_Target.StrategicBusinessGroupDescription AS lkp_StrategicBusinessGroupDescription,\n\tLKP_Target.ArgentBusinessSegmentCode AS lkp_ArgentBusinessSegmentCode,\n\tLKP_Target.ArgentBusinessSegmentDescription AS lkp_ArgentBusinessSegmentDescription,\n\t-- *INF*: DECODE(TRUE,ExpirationDate != lkp_eff_to_date OR i_BusinessClassificationDescription != lkp_bus_class_code_descript OR i_BusinessSegmentCode!= lkp_BusinessSegmentCode OR i_BusinessSegmentDescription != lkp_BusinessSegmentDescription OR\r\n\t-- i_StrategicBusinessGroupCode != lkp_StrategicBusinessGroupCode OR i_StrategicBusinessGroupDescription!=lkp_StrategicBusinessGroupDescription OR\r\n\t-- i_ArgentBusinessSegmentCode != lkp_ArgentBusinessSegmentCode OR\r\n\t-- i_ArgentBusinessSegmentDescription != lkp_ArgentBusinessSegmentDescription\r\n\t-- ,'1','0')\n\tDECODE(\n\t    TRUE,\n\t    ExpirationDate != lkp_eff_to_date OR i_BusinessClassificationDescription != lkp_bus_class_code_descript OR i_BusinessSegmentCode != lkp_BusinessSegmentCode OR i_BusinessSegmentDescription != lkp_BusinessSegmentDescription OR i_StrategicBusinessGroupCode != lkp_StrategicBusinessGroupCode OR i_StrategicBusinessGroupDescription != lkp_StrategicBusinessGroupDescription OR i_ArgentBusinessSegmentCode != lkp_ArgentBusinessSegmentCode OR i_ArgentBusinessSegmentDescription != lkp_ArgentBusinessSegmentDescription, '1',\n\t    '0'\n\t) AS v_ChangeForUpdate,\n\t-- *INF*: IIF(ISNULL(sup_bus_class_code_id),'NEW',IIF(v_ChangeForUpdate='1','UPDATE'))\n\tIFF(\n\t    sup_bus_class_code_id IS NULL, 'NEW',\n\t    IFF(\n\t        v_ChangeForUpdate = '1', 'UPDATE'\n\t    )\n\t) AS v_ChangeFlag,\n\tv_ChangeFlag AS o_ChangeFlag\n\tFROM AGG_RemoveDuplicate\n\tLEFT JOIN LKP_Target\n\tON LKP_Target.eff_from_date = AGG_RemoveDuplicate.EffectiveDate AND LKP_Target.bus_class_code = AGG_RemoveDuplicate.BusinessClassificationCode\n),\nRTR_Insert_Update AS (\n\tSELECT\n\tAuditId,\n\tsup_bus_class_code_id,\n\to_CurrenctSnapShotFlag,\n\tSource_sys_id,\n\tCreatedDate AS Created_Date,\n\tModifiedDate AS Modified_Date,\n\tEffectiveDate,\n\tExpirationDate AS ExpriationDate,\n\tBusinessClassificationCode AS bus_class_code,\n\ti_BusinessClassificationDescription AS bus_class_code_descript,\n\tBusinessClassificationCode AS StandardBusinessClassCode,\n\to_BusinessClassificationDescription AS StandardBusinessClassCodeDescription,\n\to_BusinessSegmentCode AS BusinessSegmentCode,\n\to_BusinessSegmentDescription AS BusinessSegmentDescription,\n\to_StrategicBusinessGroupCode AS StrategicBusinessGroupCode,\n\to_StrategicBusinessGroupDescription AS StrategicBusinessGroupDescription,\n\to_ArgentBusinessSegmentCode AS ArgentBusinessSegmentCode,\n\to_ArgentBusinessSegmentDescription AS ArgentBusinessSegmentDescription,\n\to_ChangeFlag\n\tFROM Exp_GetValue\n),\nRTR_Insert_Update_Insert AS (SELECT * FROM RTR_Insert_Update WHERE o_ChangeFlag = 'NEW'),\nRTR_Insert_Update_Update AS (SELECT * FROM RTR_Insert_Update WHERE o_ChangeFlag = 'UPDATE'),\nUPD_INSERT AS (\n\tSELECT\n\to_CurrenctSnapShotFlag AS o_CurrenctSnapShotFlag1, \n\tAuditId AS AuditId1, \n\tEffectiveDate AS eff_from_date1, \n\tExpriationDate AS eff_to_date1, \n\tSource_sys_id AS Source_sys_id1, \n\tCreated_Date AS Created_Date1, \n\tModified_Date AS Modified_Date1, \n\tbus_class_code AS bus_class_code1, \n\tbus_class_code_descript AS bus_class_code_descript1, \n\tStandardBusinessClassCode AS StandardBusinessClassCode1, \n\tStandardBusinessClassCodeDescription AS StandardBusinessClassCodeDescription1, \n\tBusinessSegmentCode AS BusinessSegmentCode1, \n\tBusinessSegmentDescription AS BusinessSegmentDescription1, \n\tStrategicBusinessGroupCode AS StrategicBusinessGroupCode1, \n\tStrategicBusinessGroupDescription AS StrategicBusinessGroupDescription1, \n\tArgentBusinessSegmentCode AS ArgentBusinessSegmentCode1, \n\tArgentBusinessSegmentDescription AS ArgentBusinessSegmentDescription1\n\tFROM RTR_Insert_Update_Insert\n),\nTGT_New_sup_business_classification_code AS (\n\tINSERT INTO sup_business_classification_code\n\t(crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date, bus_class_code, bus_class_code_descript, StandardBusinessClassCode, StandardBusinessClassCodeDescription, BusinessSegmentCode, BusinessSegmentDescription, StrategicBusinessGroupCode, StrategicBusinessGroupDescription, ArgentBusinessSegmentCode, ArgentBusinessSegmentDescription)\n\tSELECT \n\to_CurrenctSnapShotFlag1 AS CRRNT_SNPSHT_FLAG, \n\tAuditId1 AS AUDIT_ID, \n\teff_from_date1 AS EFF_FROM_DATE, \n\teff_to_date1 AS EFF_TO_DATE, \n\tSource_sys_id1 AS SOURCE_SYS_ID, \n\tCreated_Date1 AS CREATED_DATE, \n\tModified_Date1 AS MODIFIED_DATE, \n\tbus_class_code1 AS BUS_CLASS_CODE, \n\tbus_class_code_descript1 AS BUS_CLASS_CODE_DESCRIPT, \n\tStandardBusinessClassCode1 AS STANDARDBUSINESSCLASSCODE, \n\tStandardBusinessClassCodeDescription1 AS STANDARDBUSINESSCLASSCODEDESCRIPTION, \n\tBusinessSegmentCode1 AS BUSINESSSEGMENTCODE, \n\tBusinessSegmentDescription1 AS BUSINESSSEGMENTDESCRIPTION, \n\tStrategicBusinessGroupCode1 AS STRATEGICBUSINESSGROUPCODE, \n\tStrategicBusinessGroupDescription1 AS STRATEGICBUSINESSGROUPDESCRIPTION, \n\tArgentBusinessSegmentCode1 AS ARGENTBUSINESSSEGMENTCODE, \n\tArgentBusinessSegmentDescription1 AS ARGENTBUSINESSSEGMENTDESCRIPTION\n\tFROM UPD_INSERT\n),\nUPD_UPDATE AS (\n\tSELECT\n\tsup_bus_class_code_id AS sup_bus_class_code_id3, \n\tExpriationDate AS eff_to_date3, \n\tbus_class_code_descript AS bus_class_code_descript3, \n\tBusinessSegmentCode AS BusinessSegmentCode3, \n\tBusinessSegmentDescription AS BusinessSegmentDescription3, \n\tStrategicBusinessGroupCode AS StrategicBusinessGroupCode3, \n\tStrategicBusinessGroupDescription AS StrategicBusinessGroupDescription3, \n\tModified_Date, \n\to_CurrenctSnapShotFlag AS CurrentSnapShotFlag, \n\tSource_sys_id, \n\tArgentBusinessSegmentCode, \n\tArgentBusinessSegmentDescription\n\tFROM RTR_Insert_Update_Update\n),\nTGT_Update_sup_business_classification_code AS (\n\tMERGE INTO sup_business_classification_code AS T\n\tUSING UPD_UPDATE AS S\n\tON T.sup_bus_class_code_id = S.sup_bus_class_code_id3\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.crrnt_snpsht_flag = S.CurrentSnapShotFlag, T.eff_to_date = S.eff_to_date3, T.source_sys_id = S.Source_sys_id, T.modified_date = S.Modified_Date, T.bus_class_code_descript = S.bus_class_code_descript3, T.StandardBusinessClassCodeDescription = S.bus_class_code_descript3, T.BusinessSegmentCode = S.BusinessSegmentCode3, T.BusinessSegmentDescription = S.BusinessSegmentDescription3, T.StrategicBusinessGroupCode = S.StrategicBusinessGroupCode3, T.StrategicBusinessGroupDescription = S.StrategicBusinessGroupDescription3, T.ArgentBusinessSegmentCode = S.ArgentBusinessSegmentCode, T.ArgentBusinessSegmentDescription = S.ArgentBusinessSegmentDescription\n),\nSQ_sup_business_classification_code_setflag AS (\n\tSELECT \r\n\t \teff_from_date, \r\n\t      crrnt_snpsht_flag,\r\n\t\tbus_class_code \r\n\tFROM\r\n\t \t@{pipeline().parameters.TARGET_TABLE_OWNER}.sup_business_classification_code\r\n\tWHERE  bus_class_code IN \r\n\t\t(SELECT bus_class_code  FROM @{pipeline().parameters.TARGET_TABLE_OWNER}.sup_business_classification_code\r\n\t       WHERE crrnt_snpsht_flag = 1 GROUP BY bus_class_code HAVING count(*) > 1)\r\n\tORDER BY  bus_class_code, eff_from_date  DESC\n),\nExp_SetValue AS (\n\tSELECT\n\teff_from_date AS in_eff_from_date,\n\tcrrnt_snpsht_flag AS in_crrnt_snpsht_flag,\n\tbus_class_code AS in_bus_class_code,\n\tin_eff_from_date AS v_eff_from_date,\n\tin_bus_class_code AS v_bus_class_code,\n\t-- *INF*: DECODE(TRUE,in_bus_class_code = v_bus_class_code ,'0',in_crrnt_snpsht_flag)\n\tDECODE(\n\t    TRUE,\n\t    in_bus_class_code = v_bus_class_code, '0',\n\t    in_crrnt_snpsht_flag\n\t) AS CurrentSnapShotFlag,\n\tSYSDATE AS Modified_Date,\n\tsup_bus_class_code_id\n\tFROM SQ_sup_business_classification_code_setflag\n),\nUPD_Flag AS (\n\tSELECT\n\tCurrentSnapShotFlag, \n\tModified_Date, \n\tsup_bus_class_code_id\n\tFROM Exp_SetValue\n),\nTGT_Setvalue_sup_business_classification_code AS (\n\tMERGE INTO sup_business_classification_code AS T\n\tUSING UPD_Flag AS S\n\tON T.sup_bus_class_code_id = S.sup_bus_class_code_id\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.crrnt_snpsht_flag = S.CurrentSnapShotFlag, T.modified_date = S.Modified_Date\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "PolicyDataWarehouse/"
        },
        "annotations": []
    }
}