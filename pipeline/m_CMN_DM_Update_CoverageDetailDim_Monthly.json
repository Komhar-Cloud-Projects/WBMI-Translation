{
    "name": "m_CMN_DM_Update_CoverageDetailDim_Monthly",
    "properties": {
        "activities": [
            {
                "name": "m_CMN_DM_Update_CoverageDetailDim_Monthly",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_Supclassification_Lob AS (\n\tSELECT\n\tResult,\n\tLineOfBusinessAbbreviation,\n\tClassCode,\n\tRatingStateCode\n\tFROM (\n\t\tselect ClassCode as ClassCode \r\n\t\t,RatingStateCode as RatingStateCode \r\n\t\t,LineOfBusinessAbbreviation as LineOfBusinessAbbreviation\r\n\t\t, Result as Result  from \r\n\t\t(\r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'CF' as LineOfBusinessAbbreviation, case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end As Result\r\n\t\tfrom dbo.SupClassificationCommercialProperty\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\tUnion \r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'CA' AS LineOfBusinessAbbreviation, case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end As Result\r\n\t\tfrom dbo.SupClassificationCommercialAuto\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\tUnion \r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'CR' as LineOfBusinessAbbreviation, case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end As Result\r\n\t\tfrom dbo.SupClassificationCrime\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\tUnion \r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'WC' as LineOfBusinessAbbreviation, case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end As Result\r\n\t\tfrom dbo.SupClassificationWorkersCompensation\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\tUnion \r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'BND' as LineOfBusinessAbbreviation, case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end As Result\r\n\t\tfrom dbo.SupClassificationBonds\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\tUnion \r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'IM' as LineOfBusinessAbbreviation , case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end  As Result\r\n\t\tfrom dbo.SupClassificationInlandMarine\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\tUnion \r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'UMB' as LineOfBusinessAbbreviation , case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end As Result\r\n\t\tfrom dbo.SupClassificationUmbrella\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\tUnion \r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'DNO' as LineOfBusinessAbbreviation, case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end As Result\r\n\t\tfrom dbo.SupClassificationDirectorsOfficers\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\tUnion \r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'ENO' as LineOfBusinessAbbreviation, case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end As Result\r\n\t\tfrom dbo.SupClassificationErrorsOmissions\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\tUnion \r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'EPLI' as LineOfBusinessAbbreviation, case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end As Result\r\n\t\tfrom dbo.SupClassificationEPLI\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\tUnion \r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'EL' as LineOfBusinessAbbreviation, case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end As Result \r\n\t\tfrom dbo.SupClassificationExcessLiability\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\tUnion \r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'GA' as LineOfBusinessAbbreviation, case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end As Result\r\n\t\tfrom dbo.SupClassificationGarage\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\tUnion\r\n\t\tselect ClassCode as ClassCode ,RatingStateCode as RatingStateCode,'GL' as LineOfBusinessAbbreviation, case when ClassDescription IS NULL then 'N/A'  Else ClassDescription end + '#'+case when OriginatingOrganizationCode IS NULL then 'N/A'  Else OriginatingOrganizationCode end As Result\r\n\t\tfrom dbo.SupClassificationGeneralLiability\r\n\t\twhere CurrentSnapshotFlag=1\r\n\t\t) a\r\n\t\t--\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY LineOfBusinessAbbreviation,ClassCode,RatingStateCode ORDER BY Result) = 1\n),\nSQ_CoverageDetailDim AS (\n\tSELECT CoverageDetailDimId\r\n\t\t,ClassCode\r\n\t\t,RatingStateProvinceCode\r\n\t\t,InsuranceReferenceLineOfBusinessAbbreviation\r\n\t\t,ProductAbbreviation\r\n\tFROM (\r\n\t\tSELECT CDD.CoverageDetailDimId\r\n\t\t\t,Cdd.ClassCode\r\n\t\t\t,Cdd.RatingStateProvinceCode\r\n\t\t\t,IR.InsuranceReferenceLineOfBusinessAbbreviation\r\n\t\t\t,P.ProductAbbreviation\r\n\t\t\t,ISC.InsuranceSegmentCode\r\n\t\t\t,CDD.ClassDescription\r\n\t\tFROM @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.CoverageDetailDim CDD\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction PT ON CDD.EDWPremiumTransactionPKId = PT.PremiumTransactionID\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RatingCoverage RC ON PT.RatingCoverageAKId = RC.RatingCoverageAKID\r\n\t\t\tAND PT.EffectiveDate = RC.EffectiveDate\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage PC ON RC.PolicyCoverageAKID = PC.PolicyCoverageAKID\r\n\t\t\tAND PC.CurrentSnapshotFlag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocation RL ON PC.RiskLocationAKID = RL.RiskLocationAKID\r\n\t\t\tAND RL.CurrentSnapshotFlag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.v2.Policy Pol ON RL.PolicyAKID = Pol.pol_ak_id\r\n\t\t\tAND Pol.crrnt_snpsht_flag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceLineOfBusiness IR ON RC.InsuranceReferenceLineOfBusinessAKId = IR.InsuranceReferenceLineOfBusinessAKId\r\n\t\t\tAND IR.CurrentSnapshotFlag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.Product P ON RC.ProductAKId = P.ProductAKId\r\n\t\t\tAND p.CurrentSnapshotFlag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceSegment ISC ON Pol.InsuranceSegmentAKId = ISC.InsuranceSegmentAKId\r\n\t\t\tAND ISC.CurrentSnapshotFlag = 1\r\n\t\t\r\n\t\tUNION ALL\r\n\t\t\r\n\t\tSELECT CDD.CoverageDetailDimId\r\n\t\t\t,Cdd.ClassCode\r\n\t\t\t,Cdd.RatingStateProvinceCode\r\n\t\t\t,IR.InsuranceReferenceLineOfBusinessAbbreviation\r\n\t\t\t,P.ProductAbbreviation\r\n\t\t\t,ISC.InsuranceSegmentCode\r\n\t\t\t,CDD.ClassDescription\r\n\t\tFROM @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.CoverageDetailDim CDD\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction PT ON CDD.EDWPremiumTransactionPKId = PT.PremiumTransactionID\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.StatisticalCoverage SC ON PT.StatisticalCoverageAKID = SC.StatisticalCoverageAKID\r\n\t\t\tAND SC.CurrentSnapshotFlag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage PC ON SC.PolicyCoverageAKID = PC.PolicyCoverageAKID\r\n\t\t\tAND PC.CurrentSnapshotFlag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocation RL ON PC.RiskLocationAKID = RL.RiskLocationAKID\r\n\t\t\tAND RL.CurrentSnapshotFlag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.v2.Policy Pol ON RL.PolicyAKID = Pol.pol_ak_id\r\n\t\t\tAND Pol.crrnt_snpsht_flag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceLineOfBusiness IR ON SC.InsuranceReferenceLineOfBusinessAKId = IR.InsuranceReferenceLineOfBusinessAKId\r\n\t\t\tAND IR.CurrentSnapshotFlag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.Product P ON SC.ProductAKId = P.ProductAKId\r\n\t\t\tAND p.CurrentSnapshotFlag = 1\r\n\t\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceSegment ISC ON Pol.InsuranceSegmentAKId = ISC.InsuranceSegmentAKId\r\n\t\t\tAND ISC.CurrentSnapshotFlag = 1\r\n\t\t) CoverageDetail\r\n\tWHERE InsuranceSegmentCode != '1' and ClassDescription='N/A'\n),\nEXP_ClassDesc AS (\n\tSELECT\n\tCoverageDetailDimId,\n\tClassCode AS i_ClassCode,\n\tRatingStateProvinceCode AS i_RatingState,\n\tInsuranceReferenceLineOfBusinessAbbreviation AS i_LineOfBusinessAbbreviation,\n\tProductAbbreviation AS i_ProductAbbreviation,\n\t-- *INF*: DECODE(TRUE,IN (i_LineOfBusinessAbbreviation,'Bonds - Fidelity', 'Bonds - Surety') , 'BND' ,\r\n\t-- IN (i_LineOfBusinessAbbreviation,'NFP D&O', 'D&O') , 'DNO' ,\r\n\t-- IN (i_LineOfBusinessAbbreviation,'CL B&M', 'CL Mine Sub','CL Prop','Cyber Security','Data Compromise') , 'CF' ,\r\n\t-- IN (i_LineOfBusinessAbbreviation,'CL IM') , 'IM',\r\n\t-- IN (i_LineOfBusinessAbbreviation,'CL Umb') , 'UMB',\r\n\t-- IN (i_LineOfBusinessAbbreviation,'CL Auto') , 'CA',\r\n\t-- IN (i_LineOfBusinessAbbreviation,'Crime') , 'CR',\r\n\t-- IN (i_LineOfBusinessAbbreviation,'E&O') , 'ENO' ,\r\n\t-- IN (i_LineOfBusinessAbbreviation,'EPLI') , 'EPLI' ,\r\n\t-- IN (i_LineOfBusinessAbbreviation,'Garage') , 'GA' ,\r\n\t-- IN (i_LineOfBusinessAbbreviation,'Excess Liab') , 'EL' ,\r\n\t-- IN (i_LineOfBusinessAbbreviation,'GL') , 'GL' ,\r\n\t-- IN (i_LineOfBusinessAbbreviation,'WC') , 'WC' ,\r\n\t-- 'N/A')\n\tDECODE(TRUE,\n\tIN(i_LineOfBusinessAbbreviation, 'Bonds - Fidelity', 'Bonds - Surety'), 'BND',\n\tIN(i_LineOfBusinessAbbreviation, 'NFP D&O', 'D&O'), 'DNO',\n\tIN(i_LineOfBusinessAbbreviation, 'CL B&M', 'CL Mine Sub', 'CL Prop', 'Cyber Security', 'Data Compromise'), 'CF',\n\tIN(i_LineOfBusinessAbbreviation, 'CL IM'), 'IM',\n\tIN(i_LineOfBusinessAbbreviation, 'CL Umb'), 'UMB',\n\tIN(i_LineOfBusinessAbbreviation, 'CL Auto'), 'CA',\n\tIN(i_LineOfBusinessAbbreviation, 'Crime'), 'CR',\n\tIN(i_LineOfBusinessAbbreviation, 'E&O'), 'ENO',\n\tIN(i_LineOfBusinessAbbreviation, 'EPLI'), 'EPLI',\n\tIN(i_LineOfBusinessAbbreviation, 'Garage'), 'GA',\n\tIN(i_LineOfBusinessAbbreviation, 'Excess Liab'), 'EL',\n\tIN(i_LineOfBusinessAbbreviation, 'GL'), 'GL',\n\tIN(i_LineOfBusinessAbbreviation, 'WC'), 'WC',\n\t'N/A') AS v_LineOfBusinessAbbreviation,\n\t-- *INF*: DECODE(TRUE, v_LineOfBusinessAbbreviation='WC',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,substr(i_ClassCode,1,4),i_RatingState)),\r\n\t-- :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,substr(i_ClassCode,1,4),i_RatingState) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,substr(i_ClassCode,1,4),'99')) \r\n\t-- ,v_LineOfBusinessAbbreviation='CA',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState)), :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState) ,\r\n\t-- IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99')) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99'),\r\n\t-- IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB('GA',i_ClassCode,i_RatingState)), :LKP.LKP_SupClassification_LOB('GA',i_ClassCode,i_RatingState), \r\n\t--  :LKP.LKP_SupClassification_LOB('GA',i_ClassCode,'99'))))\r\n\t-- ,v_LineOfBusinessAbbreviation='CF',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState)),\r\n\t-- :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99'))\r\n\t-- ,v_LineOfBusinessAbbreviation='BND',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState)),\r\n\t-- :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99')) \r\n\t-- ,v_LineOfBusinessAbbreviation='UMB',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState)),\r\n\t-- :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99')) \r\n\t-- ,v_LineOfBusinessAbbreviation='IM',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState)),\r\n\t-- :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99')) \r\n\t-- ,v_LineOfBusinessAbbreviation='CR',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState)),\r\n\t-- :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99')) \r\n\t-- ,v_LineOfBusinessAbbreviation='DNO',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState)),\r\n\t-- :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99')) \r\n\t-- ,v_LineOfBusinessAbbreviation='ENO',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState)),\r\n\t-- :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99')) \r\n\t-- ,v_LineOfBusinessAbbreviation='EPLI',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState)),\r\n\t-- :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99')) \r\n\t-- ,v_LineOfBusinessAbbreviation='EL',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState)),\r\n\t-- :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99'))\r\n\t-- ,v_LineOfBusinessAbbreviation='GA',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState)), :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState) ,\r\n\t-- IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99')) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99'),\r\n\t-- IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB('CA',i_ClassCode,i_RatingState)), :LKP.LKP_SupClassification_LOB('CA',i_ClassCode,i_RatingState), \r\n\t--  :LKP.LKP_SupClassification_LOB('CA',i_ClassCode,'99'))))\r\n\t-- ,v_LineOfBusinessAbbreviation='GL',  IIF( NOT ISNULL( :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState)),\r\n\t-- :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,i_RatingState) , :LKP.LKP_SupClassification_LOB(v_LineOfBusinessAbbreviation,i_ClassCode,'99'))\r\n\t-- )\n\tDECODE(TRUE,\n\tv_LineOfBusinessAbbreviation = 'WC', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_substr_i_ClassCode_1_4_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_substr_i_ClassCode_1_4_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_substr_i_ClassCode_1_4_99.Result),\n\tv_LineOfBusinessAbbreviation = 'CA', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result, IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result, IFF(NOT LKP_SUPCLASSIFICATION_LOB__GA_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB__GA_i_ClassCode_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB__GA_i_ClassCode_99.Result))),\n\tv_LineOfBusinessAbbreviation = 'CF', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result),\n\tv_LineOfBusinessAbbreviation = 'BND', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result),\n\tv_LineOfBusinessAbbreviation = 'UMB', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result),\n\tv_LineOfBusinessAbbreviation = 'IM', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result),\n\tv_LineOfBusinessAbbreviation = 'CR', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result),\n\tv_LineOfBusinessAbbreviation = 'DNO', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result),\n\tv_LineOfBusinessAbbreviation = 'ENO', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result),\n\tv_LineOfBusinessAbbreviation = 'EPLI', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result),\n\tv_LineOfBusinessAbbreviation = 'EL', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result),\n\tv_LineOfBusinessAbbreviation = 'GA', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result, IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result, IFF(NOT LKP_SUPCLASSIFICATION_LOB__CA_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB__CA_i_ClassCode_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB__CA_i_ClassCode_99.Result))),\n\tv_LineOfBusinessAbbreviation = 'GL', IFF(NOT LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result IS NULL, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.Result, LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.Result)) AS v_Result,\n\t-- *INF*: DECODE(TRUE, IN( i_ProductAbbreviation,'SMART','BOP') OR IN(i_LineOfBusinessAbbreviation,'SMP','BOP') , 'Not Assigned',\r\n\t--  ISNULL(v_Result), 'N/A',\r\n\t-- SUBSTR(v_Result,1,INSTR(v_Result,'#')-1))\n\tDECODE(TRUE,\n\tIN(i_ProductAbbreviation, 'SMART', 'BOP') OR IN(i_LineOfBusinessAbbreviation, 'SMP', 'BOP'), 'Not Assigned',\n\tv_Result IS NULL, 'N/A',\n\tSUBSTR(v_Result, 1, INSTR(v_Result, '#') - 1)) AS ClassDescription,\n\t-- *INF*: DECODE(TRUE, IN( i_ProductAbbreviation,'SMART','BOP') OR IN(i_LineOfBusinessAbbreviation,'SMP','BOP'), 'N/A',\r\n\t-- ISNULL(v_Result), 'N/A',\r\n\t-- SUBSTR(v_Result,INSTR(v_Result,'#')+1,length(v_Result)))\r\n\t-- \r\n\t-- \r\n\t-- \n\tDECODE(TRUE,\n\tIN(i_ProductAbbreviation, 'SMART', 'BOP') OR IN(i_LineOfBusinessAbbreviation, 'SMP', 'BOP'), 'N/A',\n\tv_Result IS NULL, 'N/A',\n\tSUBSTR(v_Result, INSTR(v_Result, '#') + 1, length(v_Result))) AS ClassCodeOrganizationCode\n\tFROM SQ_CoverageDetailDim\n\tLEFT JOIN LKP_SUPCLASSIFICATION_LOB LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_substr_i_ClassCode_1_4_i_RatingState\n\tON LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_substr_i_ClassCode_1_4_i_RatingState.LineOfBusinessAbbreviation = v_LineOfBusinessAbbreviation\n\tAND LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_substr_i_ClassCode_1_4_i_RatingState.ClassCode = substr(i_ClassCode, 1, 4)\n\tAND LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_substr_i_ClassCode_1_4_i_RatingState.RatingStateCode = i_RatingState\n\n\tLEFT JOIN LKP_SUPCLASSIFICATION_LOB LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_substr_i_ClassCode_1_4_99\n\tON LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_substr_i_ClassCode_1_4_99.LineOfBusinessAbbreviation = v_LineOfBusinessAbbreviation\n\tAND LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_substr_i_ClassCode_1_4_99.ClassCode = substr(i_ClassCode, 1, 4)\n\tAND LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_substr_i_ClassCode_1_4_99.RatingStateCode = '99'\n\n\tLEFT JOIN LKP_SUPCLASSIFICATION_LOB LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState\n\tON LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.LineOfBusinessAbbreviation = v_LineOfBusinessAbbreviation\n\tAND LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.ClassCode = i_ClassCode\n\tAND LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_i_RatingState.RatingStateCode = i_RatingState\n\n\tLEFT JOIN LKP_SUPCLASSIFICATION_LOB LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99\n\tON LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.LineOfBusinessAbbreviation = v_LineOfBusinessAbbreviation\n\tAND LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.ClassCode = i_ClassCode\n\tAND LKP_SUPCLASSIFICATION_LOB_v_LineOfBusinessAbbreviation_i_ClassCode_99.RatingStateCode = '99'\n\n\tLEFT JOIN LKP_SUPCLASSIFICATION_LOB LKP_SUPCLASSIFICATION_LOB__GA_i_ClassCode_i_RatingState\n\tON LKP_SUPCLASSIFICATION_LOB__GA_i_ClassCode_i_RatingState.LineOfBusinessAbbreviation = 'GA'\n\tAND LKP_SUPCLASSIFICATION_LOB__GA_i_ClassCode_i_RatingState.ClassCode = i_ClassCode\n\tAND LKP_SUPCLASSIFICATION_LOB__GA_i_ClassCode_i_RatingState.RatingStateCode = i_RatingState\n\n\tLEFT JOIN LKP_SUPCLASSIFICATION_LOB LKP_SUPCLASSIFICATION_LOB__GA_i_ClassCode_99\n\tON LKP_SUPCLASSIFICATION_LOB__GA_i_ClassCode_99.LineOfBusinessAbbreviation = 'GA'\n\tAND LKP_SUPCLASSIFICATION_LOB__GA_i_ClassCode_99.ClassCode = i_ClassCode\n\tAND LKP_SUPCLASSIFICATION_LOB__GA_i_ClassCode_99.RatingStateCode = '99'\n\n\tLEFT JOIN LKP_SUPCLASSIFICATION_LOB LKP_SUPCLASSIFICATION_LOB__CA_i_ClassCode_i_RatingState\n\tON LKP_SUPCLASSIFICATION_LOB__CA_i_ClassCode_i_RatingState.LineOfBusinessAbbreviation = 'CA'\n\tAND LKP_SUPCLASSIFICATION_LOB__CA_i_ClassCode_i_RatingState.ClassCode = i_ClassCode\n\tAND LKP_SUPCLASSIFICATION_LOB__CA_i_ClassCode_i_RatingState.RatingStateCode = i_RatingState\n\n\tLEFT JOIN LKP_SUPCLASSIFICATION_LOB LKP_SUPCLASSIFICATION_LOB__CA_i_ClassCode_99\n\tON LKP_SUPCLASSIFICATION_LOB__CA_i_ClassCode_99.LineOfBusinessAbbreviation = 'CA'\n\tAND LKP_SUPCLASSIFICATION_LOB__CA_i_ClassCode_99.ClassCode = i_ClassCode\n\tAND LKP_SUPCLASSIFICATION_LOB__CA_i_ClassCode_99.RatingStateCode = '99'\n\n),\nUPD_CoverageDetailDim AS (\n\tSELECT\n\tCoverageDetailDimId AS o_CoverageDetailDimId, \n\tClassDescription AS o_ClassDescription, \n\tClassCodeOrganizationCode AS o_OriginatingOrganizationCode, \n\tClassDescription AS o_ISOClassDescription\n\tFROM EXP_ClassDesc\n),\nCoverageDetailDim AS (\n\tMERGE INTO CoverageDetailDim AS T\n\tUSING UPD_CoverageDetailDim AS S\n\tON T.CoverageDetailDimId = S.o_CoverageDetailDimId\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.ISOClassDescription = S.o_ISOClassDescription, T.ClassDescription = S.o_ClassDescription, T.ClassCodeOrganizationCode = S.o_OriginatingOrganizationCode\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246244"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "903271"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7594680"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "07/26/2023 05:02:27"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/26/2023 03:40:27"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Policy"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Data_Mart_Policy"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": ""
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "WC_DATA_MART"
            },
            "TARGET_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "RPT_EDM"
            }
        },
        "folder": {
            "name": "Common DataMart/"
        },
        "annotations": []
    }
}