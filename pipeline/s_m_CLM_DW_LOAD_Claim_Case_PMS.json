{
    "name": "s_m_CLM_DW_LOAD_Claim_Case_PMS",
    "properties": {
        "activities": [
            {
                "name": "m_CLM_DW_LOAD_Claim_Case_PMS",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_pif_42gq_lit_stage AS (\n\tSELECT \r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.pif_symbol)) as pif_symbol,\r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.pif_policy_number)) as pif_policy_number, \r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.pif_module)) as pif_module, \r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_year_of_loss)) as loss_year, \r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_month_of_loss)) as loss_month, \r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_day_of_loss)) as loss_day, \r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_loss_occurence)) as loss_occurrence, \r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_loss_claimant)) as loss_claimant, \r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_last_offer_date)) as last_offer_date,\r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_trial_date)) as trail_date,\r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_suit_amount)) as suit_amount,\r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_demand_date_1)) as demand_date_1, \r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_offer_date_1)) as offer_date_1, \r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_docket_number)) as docket_number, \r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_suit_state_county)) as suit_statte_county,\r\n\tLTRIM(RTRIM(pif_42gq_lit_stage.ipfcgq_court)) as court \r\n\tFROM \r\n\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.pif_42gq_lit_stage\r\n\tWHERE pif_42gq_lit_stage.logical_flag  = 0\n),\nEXP_Stage_Validate AS (\n\tSELECT\n\tpif_symbol,\n\tpif_policy_number,\n\tpif_module,\n\tipfcgq_year_of_loss,\n\t-- *INF*: TO_CHAR(ipfcgq_year_of_loss)\n\tTO_CHAR(ipfcgq_year_of_loss) AS v_ipfcgq_year_of_loss,\n\tipfcgq_month_of_loss,\n\t-- *INF*: TO_CHAR(ipfcgq_month_of_loss)\n\tTO_CHAR(ipfcgq_month_of_loss) AS v_ipfcgq_month_of_loss,\n\tipfcgq_day_of_loss,\n\t-- *INF*: TO_CHAR(ipfcgq_day_of_loss)\n\tTO_CHAR(ipfcgq_day_of_loss) AS v_ipfcgq_day_of_loss,\n\tipfcgq_loss_occurence,\n\t-- *INF*: TO_INTEGER(ipfcgq_loss_occurence)\n\tTO_INTEGER(ipfcgq_loss_occurence) AS v_ipfcgq_loss_occurence,\n\tipfcgq_loss_claimant,\n\t-- *INF*: TO_INTEGER(ipfcgq_loss_claimant)\n\tTO_INTEGER(ipfcgq_loss_claimant) AS v_ipfcgq_loss_claimant,\n\tpif_symbol || pif_policy_number || pif_module AS v_sym_num_mod,\n\t-- *INF*: IIF(LENGTH(v_ipfcgq_month_of_loss)=1,'0'||v_ipfcgq_month_of_loss,v_ipfcgq_month_of_loss) \r\n\t-- || \r\n\t-- IIF(LENGTH(v_ipfcgq_day_of_loss)=1,'0' || v_ipfcgq_day_of_loss,v_ipfcgq_day_of_loss) \r\n\t-- || v_ipfcgq_year_of_loss\n\tIFF(LENGTH(v_ipfcgq_month_of_loss) = 1, '0' || v_ipfcgq_month_of_loss, v_ipfcgq_month_of_loss) || IFF(LENGTH(v_ipfcgq_day_of_loss) = 1, '0' || v_ipfcgq_day_of_loss, v_ipfcgq_day_of_loss) || v_ipfcgq_year_of_loss AS v_date_of_loss,\n\tv_sym_num_mod || v_date_of_loss || ipfcgq_loss_occurence || ipfcgq_loss_claimant AS V_Claim_Case_Key,\n\tV_Claim_Case_Key AS Claim_Case_Key,\n\tipfcgq_last_offer_date AS in_ipfcgq_last_offer_date,\n\t-- *INF*: DECODE(TRUE,SUBSTR(in_ipfcgq_last_offer_date,1,2)='00','20'||SUBSTR(in_ipfcgq_last_offer_date,3,6),in_ipfcgq_last_offer_date)\n\tDECODE(TRUE,\n\tSUBSTR(in_ipfcgq_last_offer_date, 1, 2) = '00', '20' || SUBSTR(in_ipfcgq_last_offer_date, 3, 6),\n\tin_ipfcgq_last_offer_date) AS v_ipfcgq_last_offer_date,\n\t-- *INF*: IIF(ISNULL(v_ipfcgq_last_offer_date) or IS_SPACES(LTRIM(RTRIM(v_ipfcgq_last_offer_date))) OR LENGTH(LTRIM(RTRIM(v_ipfcgq_last_offer_date)))  = 0 ,\r\n\t-- TO_DATE('12/31/2100 00:00:00','MM/DD/YYYY HH24:MI:SS'),TO_DATE(v_ipfcgq_last_offer_date,'YYYYMMDD'))\n\tIFF(v_ipfcgq_last_offer_date IS NULL OR IS_SPACES(LTRIM(RTRIM(v_ipfcgq_last_offer_date))) OR LENGTH(LTRIM(RTRIM(v_ipfcgq_last_offer_date))) = 0, TO_DATE('12/31/2100 00:00:00', 'MM/DD/YYYY HH24:MI:SS'), TO_DATE(v_ipfcgq_last_offer_date, 'YYYYMMDD')) AS out_last_offer_date,\n\tipfcgq_trial_date AS in_ipfcgq_trail_date,\n\t-- *INF*: IIF(ISNULL(in_ipfcgq_trail_date) or IS_SPACES(LTRIM(RTRIM(in_ipfcgq_trail_date))) OR LENGTH(LTRIM(RTRIM(in_ipfcgq_trail_date))) = 0,\r\n\t-- TO_DATE('01/01/1800 00:00:00','MM/DD/YYYY HH24:MI:SS'),TO_DATE(in_ipfcgq_trail_date,'YYYYMMDD'))\r\n\t-- \r\n\t-- \n\tIFF(in_ipfcgq_trail_date IS NULL OR IS_SPACES(LTRIM(RTRIM(in_ipfcgq_trail_date))) OR LENGTH(LTRIM(RTRIM(in_ipfcgq_trail_date))) = 0, TO_DATE('01/01/1800 00:00:00', 'MM/DD/YYYY HH24:MI:SS'), TO_DATE(in_ipfcgq_trail_date, 'YYYYMMDD')) AS trail_date,\n\tipfcgq_suit_amount AS in_ipfcgq_suit_amount,\n\t-- *INF*: IIF(ISNULL(in_ipfcgq_suit_amount),0,in_ipfcgq_suit_amount)\n\tIFF(in_ipfcgq_suit_amount IS NULL, 0, in_ipfcgq_suit_amount) AS suit_amount,\n\tipfcgq_demand_date_1 AS in_ipfcgq_demand_date_1,\n\t-- *INF*: DECODE(TRUE,SUBSTR(in_ipfcgq_demand_date_1,1,2)='00','20'||SUBSTR(in_ipfcgq_demand_date_1,3,6),in_ipfcgq_demand_date_1)\n\tDECODE(TRUE,\n\tSUBSTR(in_ipfcgq_demand_date_1, 1, 2) = '00', '20' || SUBSTR(in_ipfcgq_demand_date_1, 3, 6),\n\tin_ipfcgq_demand_date_1) AS v_ipfcgq_demand_date_1,\n\tv_ipfcgq_demand_date_1 AS out_ipfcgq_demand_date_1,\n\tV_Claim_Case_Key||'ATTY' AS v_CLAIM_CASE_KEY_ATTY,\n\t-- *INF*: --:LKP.LKP_PRIM_LIT_HANDLER_AK_ID(v_CLAIM_CASE_KEY_ATTY)\n\t'' AS v_Prim_Lit_Handler_ak_id,\n\t-- *INF*: --IIF(ISNULL(v_Prim_Lit_Handler_ak_id),-1,v_Prim_Lit_Handler_ak_id)\r\n\t-- \r\n\t-- \r\n\t-- --IIF(ISNULL(v_Prim_Lit_Handler_Name),'N/A',v_Prim_Lit_Handler_Name)\r\n\t-- \r\n\t-- --V_PRIM_LIT_HANDLER_NAME\n\t'' AS Prim_Lit_Handler_ak_id,\n\t-- *INF*: IIF(ISNULL(v_ipfcgq_demand_date_1) or IS_SPACES(LTRIM(RTRIM(v_ipfcgq_demand_date_1))) OR LENGTH(LTRIM(RTRIM(v_ipfcgq_demand_date_1))) = 0\r\n\t-- ,TO_DATE('01/01/1800 00:00:00','MM/DD/YYYY HH24:MI:SS'),TO_DATE(v_ipfcgq_demand_date_1,'YYYYMMDD'))\n\tIFF(v_ipfcgq_demand_date_1 IS NULL OR IS_SPACES(LTRIM(RTRIM(v_ipfcgq_demand_date_1))) OR LENGTH(LTRIM(RTRIM(v_ipfcgq_demand_date_1))) = 0, TO_DATE('01/01/1800 00:00:00', 'MM/DD/YYYY HH24:MI:SS'), TO_DATE(v_ipfcgq_demand_date_1, 'YYYYMMDD')) AS suit_open_date,\n\tipfcgq_offer_date_1 AS in_ipfcgq_offer_date_1,\n\t-- *INF*: DECODE(TRUE,SUBSTR(in_ipfcgq_offer_date_1,1,2)='00','20'||SUBSTR(in_ipfcgq_offer_date_1,3,6),in_ipfcgq_offer_date_1)\n\tDECODE(TRUE,\n\tSUBSTR(in_ipfcgq_offer_date_1, 1, 2) = '00', '20' || SUBSTR(in_ipfcgq_offer_date_1, 3, 6),\n\tin_ipfcgq_offer_date_1) AS v_ipfcgq_offer_date_1,\n\t-- *INF*: IIF(ISNULL(v_ipfcgq_offer_date_1)  OR LENGTH(RTRIM(LTRIM(v_ipfcgq_offer_date_1)))  =  0 ,\r\n\t--           IIF(ISNULL(v_ipfcgq_last_offer_date) OR LENGTH(RTRIM(LTRIM(v_ipfcgq_last_offer_date)))  =  0 ,TO_DATE('12/31/2100 00:00:00','MM/DD/YYYY HH24:MI:SS'),\r\n\t-- \t\t\tTO_DATE(v_ipfcgq_last_offer_date,'YYYYMMDD')),TO_DATE(v_ipfcgq_offer_date_1,'YYYYMMDD'))\r\n\t-- \r\n\t-- \r\n\t-- \n\tIFF(v_ipfcgq_offer_date_1 IS NULL OR LENGTH(RTRIM(LTRIM(v_ipfcgq_offer_date_1))) = 0, IFF(v_ipfcgq_last_offer_date IS NULL OR LENGTH(RTRIM(LTRIM(v_ipfcgq_last_offer_date))) = 0, TO_DATE('12/31/2100 00:00:00', 'MM/DD/YYYY HH24:MI:SS'), TO_DATE(v_ipfcgq_last_offer_date, 'YYYYMMDD')), TO_DATE(v_ipfcgq_offer_date_1, 'YYYYMMDD')) AS suit_close_date,\n\tipfcgq_docket_number AS in_ipfcgq_docket_number,\n\t-- *INF*: SUBSTR(in_ipfcgq_docket_number,0,INSTR(in_ipfcgq_docket_number,'\"'))\n\tSUBSTR(in_ipfcgq_docket_number, 0, INSTR(in_ipfcgq_docket_number, '\"')) AS v_ipfcgq_docket_number,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(v_ipfcgq_docket_number))) OR IS_SPACES(LTRIM(RTRIM(v_ipfcgq_docket_number))) OR LENGTH(LTRIM(RTRIM(v_ipfcgq_docket_number))) = 0 OR LTRIM(RTRIM(v_ipfcgq_docket_number)) = '\"' ,'N/A',LTRIM(RTRIM(v_ipfcgq_docket_number)))\n\tIFF(LTRIM(RTRIM(v_ipfcgq_docket_number)) IS NULL OR IS_SPACES(LTRIM(RTRIM(v_ipfcgq_docket_number))) OR LENGTH(LTRIM(RTRIM(v_ipfcgq_docket_number))) = 0 OR LTRIM(RTRIM(v_ipfcgq_docket_number)) = '\"', 'N/A', LTRIM(RTRIM(v_ipfcgq_docket_number))) AS claim_case_num,\n\tipfcgq_suit_state_county AS in_ipfcgq_suit_state_county,\n\t-- *INF*: SUBSTR(in_ipfcgq_suit_state_county,0,2)\n\tSUBSTR(in_ipfcgq_suit_state_county, 0, 2) AS v_ipfcgq_suit_state_county,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(v_ipfcgq_suit_state_county))) OR  IS_SPACES(LTRIM(RTRIM(v_ipfcgq_suit_state_county)))  OR LENGTH(LTRIM(RTRIM(v_ipfcgq_suit_state_county))) = 0 OR LTRIM(RTRIM(v_ipfcgq_suit_state_county)) ='\"', 'N/A',LTRIM(RTRIM(v_ipfcgq_suit_state_county)))\n\tIFF(LTRIM(RTRIM(v_ipfcgq_suit_state_county)) IS NULL OR IS_SPACES(LTRIM(RTRIM(v_ipfcgq_suit_state_county))) OR LENGTH(LTRIM(RTRIM(v_ipfcgq_suit_state_county))) = 0 OR LTRIM(RTRIM(v_ipfcgq_suit_state_county)) = '\"', 'N/A', LTRIM(RTRIM(v_ipfcgq_suit_state_county))) AS suit_state_county,\n\tipfcgq_court AS in_ipfcgq_court,\n\t-- *INF*: SUBSTR(in_ipfcgq_court,0,INSTR(in_ipfcgq_court,'\"'))\n\tSUBSTR(in_ipfcgq_court, 0, INSTR(in_ipfcgq_court, '\"')) AS v_ipfcgq_court,\n\t-- *INF*: IIF(ISNULL(LTRIM(RTRIM(v_ipfcgq_court))) OR  IS_SPACES(LTRIM(RTRIM(v_ipfcgq_court)))  OR LENGTH(LTRIM(RTRIM(v_ipfcgq_court))) = 0 OR v_ipfcgq_court='\"', 'N/A',LTRIM(RTRIM(v_ipfcgq_court)))\n\tIFF(LTRIM(RTRIM(v_ipfcgq_court)) IS NULL OR IS_SPACES(LTRIM(RTRIM(v_ipfcgq_court))) OR LENGTH(LTRIM(RTRIM(v_ipfcgq_court))) = 0 OR v_ipfcgq_court = '\"', 'N/A', LTRIM(RTRIM(v_ipfcgq_court))) AS court\n\tFROM SQ_pif_42gq_lit_stage\n),\nLKP_prim_lit_handler_role_code AS (\n\tSELECT\n\tipfcgq_attorney_type_1,\n\tipfcgq_attorney_seq_1,\n\tpif_symbol,\n\tpif_policy_number,\n\tpif_module,\n\tipfcgq_year_of_loss,\n\tipfcgq_month_of_loss,\n\tipfcgq_day_of_loss,\n\tipfcgq_loss_occurence,\n\tipfcgq_loss_claimant\n\tFROM (\n\t\tSELECT \r\n\t\tA.ipfcgq_attorney_type_1 as ipfcgq_attorney_type_1, \r\n\t\tA.ipfcgq_attorney_seq_1 as ipfcgq_attorney_seq_1, \r\n\t\tA.pif_symbol as pif_symbol, \r\n\t\tA.pif_policy_number as pif_policy_number, \r\n\t\tA.pif_module as pif_module, \r\n\t\tA.ipfcgq_year_of_loss as ipfcgq_year_of_loss, \r\n\t\tA.ipfcgq_month_of_loss as ipfcgq_month_of_loss, \r\n\t\tA.ipfcgq_day_of_loss as ipfcgq_day_of_loss, \r\n\t\tA.ipfcgq_loss_occurence as ipfcgq_loss_occurence, \r\n\t\tA.ipfcgq_loss_claimant as ipfcgq_loss_claimant \r\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.pif_42gq_aty_stage A\r\n\t\tWHERE A.logical_flag = 0\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY pif_symbol,pif_policy_number,pif_module,ipfcgq_year_of_loss,ipfcgq_month_of_loss,ipfcgq_day_of_loss,ipfcgq_loss_occurence,ipfcgq_loss_claimant ORDER BY ipfcgq_attorney_type_1) = 1\n),\nLKP_Prim_Lit_Handler_ak_id AS (\n\tSELECT\n\tclaim_party_ak_id,\n\tclaim_party_key\n\tFROM (\n\t\tSELECT \r\n\t\tCP.claim_party_ak_id as claim_party_ak_id, \r\n\t\tSUBSTRING(CP.claim_party_key,1,3) as claim_party_key \r\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_party CP\r\n\t\tWHERE LEN(CP.claim_party_key) < 5\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_party_key ORDER BY claim_party_ak_id) = 1\n),\nLKP_suit_status_code AS (\n\tSELECT\n\tipfcgq_loss_suit,\n\tpif_symbol,\n\tpif_policy_number,\n\tpif_module,\n\tipfcgq_year_of_loss,\n\tipfcgq_month_of_loss,\n\tipfcgq_day_of_loss,\n\tipfcgq_loss_occurence,\n\tipfcgq_loss_claimant\n\tFROM (\n\t\tSELECT \ta.ipfcgq_loss_suit as ipfcgq_loss_suit, \r\n\t\ta.pif_symbol as pif_symbol, \r\n\t\ta.pif_policy_number as pif_policy_number, \r\n\t\ta.pif_module as pif_module, \r\n\t\ta.ipfcgq_year_of_loss as ipfcgq_year_of_loss, \r\n\t\ta.ipfcgq_month_of_loss as ipfcgq_month_of_loss, \r\n\t\ta.ipfcgq_day_of_loss as ipfcgq_day_of_loss, \r\n\t\ta.ipfcgq_loss_occurence as ipfcgq_loss_occurence, \r\n\t\ta.ipfcgq_loss_claimant as ipfcgq_loss_claimant \r\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.pif_42gq_cmt_stage a\r\n\t\tWHERE \tlogical_flag in (0,1)\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY pif_symbol,pif_policy_number,pif_module,ipfcgq_year_of_loss,ipfcgq_month_of_loss,ipfcgq_day_of_loss,ipfcgq_loss_occurence,ipfcgq_loss_claimant ORDER BY ipfcgq_loss_suit) = 1\n),\nEXP_LKP_Values AS (\n\tSELECT\n\tEXP_Stage_Validate.Claim_Case_Key AS claim_case_key,\n\tEXP_Stage_Validate.trail_date,\n\tLKP_suit_status_code.ipfcgq_loss_suit AS suit_status,\n\t-- *INF*: IIF(ISNULL(suit_status) OR IS_SPACES(suit_status) OR LENGTH(suit_status) = 0,'N/A',suit_status)\n\tIFF(suit_status IS NULL OR IS_SPACES(suit_status) OR LENGTH(suit_status) = 0, 'N/A', suit_status) AS Out_suit_status,\n\tEXP_Stage_Validate.suit_amount,\n\tLKP_Prim_Lit_Handler_ak_id.claim_party_ak_id AS Prim_Lit_Handler_ak_id,\n\t-- *INF*: IIF(ISNULL(Prim_Lit_Handler_ak_id),-1,Prim_Lit_Handler_ak_id)\n\tIFF(Prim_Lit_Handler_ak_id IS NULL, - 1, Prim_Lit_Handler_ak_id) AS Prim_Lit_Handler_ak_id_Out,\n\tLKP_prim_lit_handler_role_code.ipfcgq_attorney_type_1 AS prim_litigation_handler_role_code,\n\t-- *INF*: IIF(ISNULL(prim_litigation_handler_role_code) OR IS_SPACES(prim_litigation_handler_role_code) OR LENGTH(prim_litigation_handler_role_code) = 0,'N/A',prim_litigation_handler_role_code)\n\tIFF(prim_litigation_handler_role_code IS NULL OR IS_SPACES(prim_litigation_handler_role_code) OR LENGTH(prim_litigation_handler_role_code) = 0, 'N/A', prim_litigation_handler_role_code) AS out_prim_litigation_handler_role_code,\n\tEXP_Stage_Validate.suit_open_date,\n\tEXP_Stage_Validate.suit_close_date,\n\tEXP_Stage_Validate.claim_case_num,\n\tEXP_Stage_Validate.suit_state_county,\n\tEXP_Stage_Validate.court,\n\tEXP_Stage_Validate.trail_date AS arbitration_open_date,\n\tEXP_Stage_Validate.out_last_offer_date AS arbitration_close_date\n\tFROM EXP_Stage_Validate\n\tLEFT JOIN LKP_Prim_Lit_Handler_ak_id\n\tON LKP_Prim_Lit_Handler_ak_id.claim_party_key = LKP_prim_lit_handler_role_code.ipfcgq_attorney_seq_1\n\tLEFT JOIN LKP_prim_lit_handler_role_code\n\tON LKP_prim_lit_handler_role_code.pif_symbol = EXP_Stage_Validate.pif_symbol AND LKP_prim_lit_handler_role_code.pif_policy_number = EXP_Stage_Validate.pif_policy_number AND LKP_prim_lit_handler_role_code.pif_module = EXP_Stage_Validate.pif_module AND LKP_prim_lit_handler_role_code.ipfcgq_year_of_loss = EXP_Stage_Validate.ipfcgq_year_of_loss AND LKP_prim_lit_handler_role_code.ipfcgq_month_of_loss = EXP_Stage_Validate.ipfcgq_month_of_loss AND LKP_prim_lit_handler_role_code.ipfcgq_day_of_loss = EXP_Stage_Validate.ipfcgq_day_of_loss AND LKP_prim_lit_handler_role_code.ipfcgq_loss_occurence = EXP_Stage_Validate.ipfcgq_loss_occurence AND LKP_prim_lit_handler_role_code.ipfcgq_loss_claimant = EXP_Stage_Validate.ipfcgq_loss_claimant\n\tLEFT JOIN LKP_suit_status_code\n\tON LKP_suit_status_code.pif_symbol = EXP_Stage_Validate.pif_symbol AND LKP_suit_status_code.pif_policy_number = EXP_Stage_Validate.pif_policy_number AND LKP_suit_status_code.pif_module = EXP_Stage_Validate.pif_module AND LKP_suit_status_code.ipfcgq_year_of_loss = EXP_Stage_Validate.ipfcgq_year_of_loss AND LKP_suit_status_code.ipfcgq_month_of_loss = EXP_Stage_Validate.ipfcgq_month_of_loss AND LKP_suit_status_code.ipfcgq_day_of_loss = EXP_Stage_Validate.ipfcgq_day_of_loss AND LKP_suit_status_code.ipfcgq_loss_occurence = EXP_Stage_Validate.ipfcgq_loss_occurence AND LKP_suit_status_code.ipfcgq_loss_claimant = EXP_Stage_Validate.ipfcgq_loss_claimant\n),\nLKP_Claim_Case_EDW AS (\n\tSELECT\n\tclaim_case_id,\n\tclaim_case_ak_id,\n\tclaim_case_name,\n\tclaim_case_num,\n\tsuit_county,\n\tsuit_state,\n\ttrial_date,\n\tsuit_status_code,\n\tprim_litigation_handler_ak_id,\n\tprim_litigation_handler_role_code,\n\tsuit_open_date,\n\tsuit_close_date,\n\tsuit_pay_amt,\n\tarbitration_open_date,\n\tarbitration_close_date,\n\tclaim_case_key\n\tFROM (\n\t\tSELECT A.claim_case_id as claim_case_id, A.claim_case_ak_id as claim_case_ak_id, A.claim_case_name as claim_case_name, A.claim_case_num as claim_case_num, A.suit_county as suit_county, A.suit_state as suit_state, A.trial_date as trial_date, A.suit_status_code as suit_status_code, A.prim_litigation_handler_ak_id as prim_litigation_handler_ak_id, A.prim_litigation_handler_role_code as prim_litigation_handler_role_code, A.suit_open_date as suit_open_date, A.suit_close_date as suit_close_date, A.suit_pay_amt as suit_pay_amt, A.arbitration_open_date as arbitration_open_date, A.arbitration_close_date as arbitration_close_date, A.claim_case_key as claim_case_key FROM claim_case A\r\n\t\tWHERE A.source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}' and A.crrnt_snpsht_flag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_case_key ORDER BY claim_case_id) = 1\n),\nEXP_Detect_Changes AS (\n\tSELECT\n\tEXP_LKP_Values.claim_case_key,\n\tEXP_LKP_Values.trail_date,\n\tEXP_LKP_Values.Out_suit_status AS suit_status,\n\tEXP_LKP_Values.suit_amount,\n\tEXP_LKP_Values.Prim_Lit_Handler_ak_id_Out AS Prim_Lit_Handler_ak_id,\n\tEXP_LKP_Values.out_prim_litigation_handler_role_code AS prim_litigation_handler_role_code,\n\tEXP_LKP_Values.suit_open_date,\n\tEXP_LKP_Values.suit_close_date,\n\tEXP_LKP_Values.claim_case_num,\n\tEXP_LKP_Values.suit_state_county,\n\tEXP_LKP_Values.court,\n\tEXP_LKP_Values.arbitration_open_date,\n\tEXP_LKP_Values.arbitration_close_date,\n\tLKP_Claim_Case_EDW.claim_case_id AS OLD_claim_case_id,\n\tLKP_Claim_Case_EDW.claim_case_ak_id AS OLD_claim_case_ak_id,\n\tLKP_Claim_Case_EDW.claim_case_name AS OLD_claim_case_key,\n\tLKP_Claim_Case_EDW.claim_case_num AS OLD_claim_case_num,\n\tLKP_Claim_Case_EDW.suit_county AS OLD_suit_county,\n\tLKP_Claim_Case_EDW.suit_state AS OLD_suit_state,\n\tLKP_Claim_Case_EDW.trial_date AS OLD_trial_date,\n\tLKP_Claim_Case_EDW.suit_status_code AS OLD_suit_status_code,\n\tLKP_Claim_Case_EDW.prim_litigation_handler_ak_id AS Old_prim_litigation_handler_ak_id,\n\tLKP_Claim_Case_EDW.prim_litigation_handler_role_code AS Old_prim_litigation_handler_role_code,\n\tLKP_Claim_Case_EDW.suit_open_date AS OLD_suit_open_date,\n\tLKP_Claim_Case_EDW.suit_close_date AS OLD_suit_close_date,\n\tLKP_Claim_Case_EDW.suit_pay_amt AS OLD_suit_pay_amt,\n\tLKP_Claim_Case_EDW.arbitration_open_date AS Old_arbitration_open_date,\n\tLKP_Claim_Case_EDW.arbitration_close_date AS Old_arbitration_close_date,\n\t'N/A' AS DEFAULT_CHAR,\n\t0 AS DEFAULT_INT,\n\t-- *INF*: TO_DATE('01/01/1800 00:00:00','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('01/01/1800 00:00:00', 'MM/DD/YYYY HH24:MI:SS') AS DEFAULT_DATE,\n\t-- *INF*: IIF(ISNULL(OLD_claim_case_id),'NEW',\r\n\t-- IIF(LTRIM(RTRIM(claim_case_num))<>LTRIM(RTRIM(OLD_claim_case_num)) OR \r\n\t--        LTRIM(RTRIM(court))<>LTRIM(RTRIM(OLD_suit_county)) OR\r\n\t--        LTRIM(RTRIM(suit_state_county))<>LTRIM(RTRIM(OLD_suit_state)) OR \r\n\t--        trail_date<>OLD_trial_date OR \r\n\t--        LTRIM(RTRIM(suit_status))<>LTRIM(RTRIM(OLD_suit_status_code)) OR \r\n\t--        suit_open_date<>OLD_suit_open_date OR\r\n\t--        suit_close_date<>OLD_suit_close_date OR  \r\n\t--        suit_amount <> OLD_suit_pay_amt  OR\r\n\t--        Prim_Lit_Handler_ak_id <>Old_prim_litigation_handler_ak_id OR\r\n\t--        LTRIM(RTRIM(prim_litigation_handler_role_code))<>LTRIM(RTRIM(Old_prim_litigation_handler_role_code)) OR\r\n\t--       arbitration_open_date <> Old_arbitration_open_date  OR\r\n\t--       arbitration_close_date <>Old_arbitration_close_date, \r\n\t-- 'UPDATE','NOCHANGE')) \r\n\t-- \n\tIFF(OLD_claim_case_id IS NULL, 'NEW', IFF(LTRIM(RTRIM(claim_case_num)) <> LTRIM(RTRIM(OLD_claim_case_num)) OR LTRIM(RTRIM(court)) <> LTRIM(RTRIM(OLD_suit_county)) OR LTRIM(RTRIM(suit_state_county)) <> LTRIM(RTRIM(OLD_suit_state)) OR trail_date <> OLD_trial_date OR LTRIM(RTRIM(suit_status)) <> LTRIM(RTRIM(OLD_suit_status_code)) OR suit_open_date <> OLD_suit_open_date OR suit_close_date <> OLD_suit_close_date OR suit_amount <> OLD_suit_pay_amt OR Prim_Lit_Handler_ak_id <> Old_prim_litigation_handler_ak_id OR LTRIM(RTRIM(prim_litigation_handler_role_code)) <> LTRIM(RTRIM(Old_prim_litigation_handler_role_code)) OR arbitration_open_date <> Old_arbitration_open_date OR arbitration_close_date <> Old_arbitration_close_date, 'UPDATE', 'NOCHANGE')) AS v_changed_flag,\n\tv_changed_flag AS CHANGED_FLAG,\n\t1 AS CRRNT_SNPSHT_FLAG,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AUDIT_ID,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS SOURCE_SYS_ID,\n\t-- *INF*: IIF(v_changed_flag = 'NEW',TO_DATE('01/01/1800 01:00:00','MM/DD/YYYY HH24:MI:SS'),SYSDATE)\n\tIFF(v_changed_flag = 'NEW', TO_DATE('01/01/1800 01:00:00', 'MM/DD/YYYY HH24:MI:SS'), SYSDATE) AS EFF_FROM_DATE,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS EFF_TO_DATE,\n\tSYSDATE AS CREATED_DATE,\n\tSYSDATE AS MODIFIED_DATE,\n\t0.0 AS Demand_at_initial_Litigation\n\tFROM EXP_LKP_Values\n\tLEFT JOIN LKP_Claim_Case_EDW\n\tON LKP_Claim_Case_EDW.claim_case_key = EXP_LKP_Values.claim_case_key\n),\nFIL_Changes AS (\n\tSELECT\n\tOLD_claim_case_ak_id, \n\tclaim_case_key, \n\tclaim_case_num, \n\tcourt, \n\tsuit_state_county, \n\ttrail_date, \n\tsuit_status, \n\tPrim_Lit_Handler_ak_id, \n\tprim_litigation_handler_role_code, \n\tsuit_open_date, \n\tsuit_close_date, \n\tsuit_amount, \n\tarbitration_open_date, \n\tarbitration_close_date, \n\tDEFAULT_CHAR, \n\tDEFAULT_INT, \n\tDEFAULT_DATE, \n\tCRRNT_SNPSHT_FLAG, \n\tAUDIT_ID, \n\tEFF_FROM_DATE, \n\tEFF_TO_DATE, \n\tSOURCE_SYS_ID, \n\tCREATED_DATE, \n\tMODIFIED_DATE, \n\tCHANGED_FLAG, \n\tDemand_at_initial_Litigation\n\tFROM EXP_Detect_Changes\n\tWHERE CHANGED_FLAG='NEW' OR CHANGED_FLAG='UPDATE'\n),\nSEQ_Claim_Case_AK_ID AS (\n\tCREATE SEQUENCE SEQ_Claim_Case_AK_ID\n\tSTART = 0\n\tINCREMENT = 1;\n),\nEXP_Determine_AK AS (\n\tSELECT\n\tOLD_claim_case_ak_id,\n\t-- *INF*: IIF(Changed_flag = 'NEW',NEXTVAL,OLD_claim_case_ak_id)\n\tIFF(Changed_flag = 'NEW', NEXTVAL, OLD_claim_case_ak_id) AS claim_case_ak_id,\n\tclaim_case_key,\n\tclaim_case_num,\n\tcourt,\n\tsuit_state_county,\n\ttrail_date,\n\tsuit_status,\n\tPrim_Lit_Handler_ak_id,\n\tprim_litigation_handler_role_code,\n\tsuit_open_date,\n\tsuit_close_date,\n\tsuit_amount,\n\tarbitration_open_date,\n\tarbitration_close_date,\n\tDEFAULT_CHAR,\n\tDEFAULT_INT,\n\tDEFAULT_DATE,\n\tCRRNT_SNPSHT_FLAG,\n\tAUDIT_ID,\n\tEFF_FROM_DATE,\n\tEFF_TO_DATE,\n\tSOURCE_SYS_ID,\n\tCREATED_DATE,\n\tMODIFIED_DATE,\n\tCHANGED_FLAG AS Changed_flag,\n\tDemand_at_initial_Litigation,\n\t'N/A' AS SettlementTypeCode,\n\tSEQ_Claim_Case_AK_ID.NEXTVAL\n\tFROM FIL_Changes\n),\nclaim_case_insert AS (\n\tINSERT INTO claim_case\n\t(claim_case_ak_id, prim_litigation_handler_ak_id, claim_case_key, claim_case_name, claim_case_num, suit_county, suit_state, trial_date, first_notice_law_suit_ind, declaratory_action_ind, suit_status_code, suit_denial_date, prim_litigation_handler_role_code, suit_open_date, suit_close_date, suit_how_claim_closed, reins_reported_ind, commercl_umb_reserve, suit_pay_amt, arbitration_open_date, arbitration_close_date, crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date, demand_at_initial_litigation, SettlementTypeCode)\n\tSELECT \n\tCLAIM_CASE_AK_ID, \n\tPrim_Lit_Handler_ak_id AS PRIM_LITIGATION_HANDLER_AK_ID, \n\tCLAIM_CASE_KEY, \n\tDEFAULT_CHAR AS CLAIM_CASE_NAME, \n\tCLAIM_CASE_NUM, \n\tcourt AS SUIT_COUNTY, \n\tsuit_state_county AS SUIT_STATE, \n\ttrail_date AS TRIAL_DATE, \n\tDEFAULT_CHAR AS FIRST_NOTICE_LAW_SUIT_IND, \n\tDEFAULT_CHAR AS DECLARATORY_ACTION_IND, \n\tsuit_status AS SUIT_STATUS_CODE, \n\tDEFAULT_DATE AS SUIT_DENIAL_DATE, \n\tPRIM_LITIGATION_HANDLER_ROLE_CODE, \n\tSUIT_OPEN_DATE, \n\tSUIT_CLOSE_DATE, \n\tDEFAULT_CHAR AS SUIT_HOW_CLAIM_CLOSED, \n\tDEFAULT_CHAR AS REINS_REPORTED_IND, \n\tDEFAULT_INT AS COMMERCL_UMB_RESERVE, \n\tsuit_amount AS SUIT_PAY_AMT, \n\tARBITRATION_OPEN_DATE, \n\tARBITRATION_CLOSE_DATE, \n\tCRRNT_SNPSHT_FLAG AS CRRNT_SNPSHT_FLAG, \n\tAUDIT_ID AS AUDIT_ID, \n\tEFF_FROM_DATE AS EFF_FROM_DATE, \n\tEFF_TO_DATE AS EFF_TO_DATE, \n\tSOURCE_SYS_ID AS SOURCE_SYS_ID, \n\tCREATED_DATE AS CREATED_DATE, \n\tMODIFIED_DATE AS MODIFIED_DATE, \n\tDemand_at_initial_Litigation AS DEMAND_AT_INITIAL_LITIGATION, \n\tSETTLEMENTTYPECODE\n\tFROM EXP_Determine_AK\n),\nSQ_claim_case AS (\n\tSELECT \r\n\ta.claim_case_id, \r\n\ta.claim_case_key,\r\n\ta.eff_from_date, \r\n\ta.eff_to_date \r\n\tFROM\r\n\t @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_case a\r\n\tWHERE \r\n\ta.source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'  AND\r\n\tEXISTS(SELECT 1 \r\n\t                 FROM @{pipeline().parameters.TARGET_TABLE_OWNER}.claim_case b\r\n\t                 WHERE source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}' and crrnt_snpsht_flag = 1\r\n\t                 AND a.claim_case_key = b.claim_case_key\r\n\t \t           GROUP BY b.claim_case_key\r\n\t                 HAVING COUNT(*) >1) \r\n\tORDER BY a.claim_case_key, a.eff_from_date DESC\n),\nEXP_Expire_Row AS (\n\tSELECT\n\tclaim_case_id,\n\tclaim_case_key,\n\teff_from_date,\n\teff_to_date AS orig_eff_to_date,\n\t-- *INF*: DECODE(TRUE,claim_case_key = v_prev_row_claim_case_key,ADD_TO_DATE(v_prev_row_eff_from_date,'SS',-1),orig_eff_to_date)\r\n\t-- \r\n\t-- \r\n\t-- \n\tDECODE(TRUE,\n\tclaim_case_key = v_prev_row_claim_case_key, ADD_TO_DATE(v_prev_row_eff_from_date, 'SS', - 1),\n\torig_eff_to_date) AS v_eff_to_date,\n\tv_eff_to_date AS eff_to_date,\n\teff_from_date AS v_prev_row_eff_from_date,\n\tclaim_case_key AS v_prev_row_claim_case_key,\n\tSYSDATE AS modified_date,\n\t0 AS crrnt_snpsht_flag\n\tFROM SQ_claim_case\n),\nFIL_Claim_Case_FirstRow_In_AKGroup AS (\n\tSELECT\n\tclaim_case_id, \n\torig_eff_to_date, \n\teff_to_date, \n\tmodified_date, \n\tcrrnt_snpsht_flag\n\tFROM EXP_Expire_Row\n\tWHERE orig_eff_to_date <>eff_to_date\n),\nUPD_Crrnt_Snpsht_Flag AS (\n\tSELECT\n\tclaim_case_id, \n\teff_to_date, \n\tmodified_date, \n\tcrrnt_snpsht_flag\n\tFROM FIL_Claim_Case_FirstRow_In_AKGroup\n),\nclaim_case_crrnt_snpsht_flag_update AS (\n\tMERGE INTO claim_case AS T\n\tUSING UPD_Crrnt_Snpsht_Flag AS S\n\tON T.claim_case_id = S.claim_case_id\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.crrnt_snpsht_flag = S.crrnt_snpsht_flag, T.eff_to_date = S.eff_to_date, T.modified_date = S.modified_date\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246504"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905521"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604343"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 02:13:41"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 02:19:56"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Stage_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "PMS"
            }
        },
        "folder": {
            "name": "Claims DataWarehouse/"
        },
        "annotations": []
    }
}