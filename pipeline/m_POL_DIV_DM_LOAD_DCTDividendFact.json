{
    "name": "m_POL_DIV_DM_LOAD_DCTDividendFact",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DIV_DM_LOAD_DCTDividendFact",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_DCTDividend AS (\n\tSELECT\n\t\tDCTDividend.PolicyAKId,\n\t\tDCTDividend.DividendTransactionEnteredDate,\n\t\tDCTDividend.DividendRunDate,\n\t\tDCTDividend.DividendPlan,\n\t\tDCTDividend.DividendType,\n\t\tDCTDividend.SupStateId,\n\t\tDCTDividend.DividendPaidAmount,\n\t\tStrategicProfitCenter.StrategicProfitCenterCode,\n\t\tpolicy.contract_cust_ak_id,\n\t\tpolicy.AgencyAKId,\n\t\tInsuranceSegment.InsuranceSegmentCode,\n\t\tPolicyAudit.PolicyAuditAKId,\n\t\tPolicyAudit.EffectiveDate,\n\t\tDCTDividend.DCTDividendId\n\tFROM policy\n\tINNER JOIN DCTDividend\n\tINNER JOIN InsuranceSegment\n\tINNER JOIN PolicyAudit\n\tINNER JOIN StrategicProfitCenter\n\tON { @{pipeline().parameters.SOURCE_TABLE_OWNER}.DCTDividend\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy\r\n\tON @{pipeline().parameters.SOURCE_TABLE_OWNER}.DCTDividend.PolicyAKId=@{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy.pol_ak_id \r\n\tand @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy.crrnt_snpsht_flag=1\r\n\tand @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy.source_sys_id = 'DCT'\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter\r\n\tON @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy.StrategicProfitCenterAKId=@{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter.StrategicProfitCenterAKId \r\n\tand @{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter.CurrentSnapshotFlag=1\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment\r\n\tON @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy.InsuranceSegmentAKId=@{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment.InsuranceSegmentAKId \r\n\tand @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyAudit\r\n\tON @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy.pol_ak_id=@{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyAudit.PolicyAKId\r\n\tAND @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyAudit.InsuranceLine='WorkersCompensation'\r\n\tAND @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyAudit.CurrentSnapshotFlag=1\r\n\t}\n\tWHERE DCTDividend.CurrentSnapshotFlag=1\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n),\nLKP_PolicyAuditDim AS (\n\tSELECT\n\tPolicyAuditDimId,\n\tEDWPolicyAuditAKId,\n\tEffectiveDate\n\tFROM (\n\t\tSELECT \n\t\t\tPolicyAuditDimId,\n\t\t\tEDWPolicyAuditAKId,\n\t\t\tEffectiveDate\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyAuditDim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EDWPolicyAuditAKId,EffectiveDate ORDER BY PolicyAuditDimId) = 1\n),\nEXP_GetValues AS (\n\tSELECT\n\tLKP_PolicyAuditDim.PolicyAuditDimId AS i_PolicyAuditDimId,\n\tSQ_DCTDividend.PolicyAKId,\n\tSQ_DCTDividend.DividendTransactionEnteredDate,\n\tSQ_DCTDividend.DividendRunDate,\n\tSQ_DCTDividend.DividendPlan,\n\tSQ_DCTDividend.DividendType,\n\tSQ_DCTDividend.SupStateId,\n\tSQ_DCTDividend.DividendPaidAmount,\n\tSQ_DCTDividend.StrategicProfitCenterCode,\n\tSQ_DCTDividend.contract_cust_ak_id,\n\tSQ_DCTDividend.AgencyAKId,\n\tSQ_DCTDividend.InsuranceSegmentCode,\n\t-- *INF*: IIF(ISNULL(i_PolicyAuditDimId),-1,i_PolicyAuditDimId)\n\tIFF(i_PolicyAuditDimId IS NULL, - 1, i_PolicyAuditDimId) AS o_PolicyAuditDimId,\n\tSQ_DCTDividend.DCTDividendId\n\tFROM SQ_DCTDividend\n\tLEFT JOIN LKP_PolicyAuditDim\n\tON LKP_PolicyAuditDim.EDWPolicyAuditAKId = SQ_DCTDividend.PolicyAuditAKId AND LKP_PolicyAuditDim.EffectiveDate = SQ_DCTDividend.EffectiveDate\n),\nLKP_DividendTypeDim AS (\n\tSELECT\n\tDividendTypeDimId,\n\tDividendPlan,\n\tDividendType\n\tFROM (\n\t\tSELECT \n\t\t\tDividendTypeDimId,\n\t\t\tDividendPlan,\n\t\t\tDividendType\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.DividendTypeDim\n\t\tWHERE CurrentSnapshotFlag=1 and DividendCategory <> 'CFA'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY DividendPlan,DividendType ORDER BY DividendTypeDimId DESC) = 1\n),\nLKP_InsuranceReferenceDim AS (\n\tSELECT\n\tInsuranceReferenceDimId,\n\tStrategicProfitCenterCode,\n\tInsuranceSegmentCode\n\tFROM (\n\t\tSELECT \n\t\t\tInsuranceReferenceDimId,\n\t\t\tStrategicProfitCenterCode,\n\t\t\tInsuranceSegmentCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceDim\n\t\tWHERE EnterpriseGroupCode = '1' and InsuranceReferenceCoverageTypeCode = 'N/A' and InsuranceReferenceLegalEntityCode = '1' and InsuranceReferenceLineOfBusinessCode = '100' and PolicyOfferingCode = '100' and ProductCode = '100'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY StrategicProfitCenterCode,InsuranceSegmentCode ORDER BY InsuranceReferenceDimId DESC) = 1\n),\nLKP_SalesDivisionDim AS (\n\tSELECT\n\tSalesDivisionDimID,\n\tAgencyAKID\n\tFROM (\n\t\tSelect A.AgencyAKID AS AgencyAKID, \r\n\t\tSDD.SalesDivisionDimID AS SalesDivisionDimID\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.Agency A,\r\n\t\t@{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.RegionalSalesManager RSM,\r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.SalesDivisionDim SDD\r\n\t\tWHERE A.CurrentSnapshotFlag =1\r\n\t\tAND RSM.RegionalSalesManagerAKID = A.RegionalSalesManagerAKID\r\n\t\tAND RSM.CurrentSnapshotFlag = 1\r\n\t\tAND RSM.SalesDirectorAKID = SDD.EDWSalesDirectorAKID\r\n\t\tAND A.SalesTerritoryAKID = SDD.EDWSalesTerritoryAKID\r\n\t\tAND RSM.RegionalSalesManagerAKID = SDD.EDWRegionalSalesManagerAKID\r\n\t\tAND SDD.CurrentSnapshotFlag =1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY AgencyAKID ORDER BY SalesDivisionDimID DESC) = 1\n),\nLKP_sup_state AS (\n\tSELECT\n\tstate_code,\n\ti_SupStateId,\n\tsup_state_id\n\tFROM (\n\t\tSELECT \n\t\t\tstate_code,\n\t\t\ti_SupStateId,\n\t\t\tsup_state_id\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.sup_state\n\t\tWHERE crrnt_snpsht_flag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY sup_state_id ORDER BY state_code DESC) = 1\n),\nLKP_StateDim AS (\n\tSELECT\n\tStateDimId,\n\tStateAbbreviation\n\tFROM (\n\t\tSELECT @{pipeline().parameters.TARGET_TABLE_OWNER}.StateDim.StateDimId as StateDimId, LTRIM(RTRIM(@{pipeline().parameters.TARGET_TABLE_OWNER}.StateDim.StateAbbreviation)) as StateAbbreviation FROM @{pipeline().parameters.TARGET_TABLE_OWNER}.StateDim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY StateAbbreviation ORDER BY StateDimId DESC) = 1\n),\nLKP_calendar_dim_DividendRunDate AS (\n\tSELECT\n\tclndr_id,\n\tclndr_date\n\tFROM (\n\t\tSELECT \n\t\t\tclndr_id,\n\t\t\tclndr_date\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.calendar_dim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY clndr_date ORDER BY clndr_id DESC) = 1\n),\nLKP_calendar_dim_DividendTransactionEnteredDate AS (\n\tSELECT\n\tclndr_id,\n\tclndr_date\n\tFROM (\n\t\tSELECT \n\t\t\tclndr_id,\n\t\t\tclndr_date\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.calendar_dim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY clndr_date ORDER BY clndr_id DESC) = 1\n),\nmplt_PolicyDimID_PremiumMaster AS (WITH\n\tInput AS (\n\t\t\n\t),\n\tEXP_Default AS (\n\t\tSELECT\n\t\tIN_PolicyAKID AS PolicyAKID,\n\t\tIN_Trans_Date\n\t\tFROM Input\n\t),\n\tLKP_V2_Policy AS (\n\t\tSELECT\n\t\tcontract_cust_ak_id,\n\t\tagencyakid,\n\t\tpol_status_code,\n\t\tstrtgc_bus_dvsn_ak_id,\n\t\tIN_Trans_Date,\n\t\tpol_ak_id,\n\t\teff_from_date,\n\t\teff_to_date\n\t\tFROM (\n\t\t\tSELECT policy.contract_cust_ak_id as contract_cust_ak_id, policy.agencyakid as agencyakid, policy.pol_status_code as pol_status_code, policy.strtgc_bus_dvsn_ak_id as strtgc_bus_dvsn_ak_id, policy.pol_ak_id as pol_ak_id, policy.eff_from_date as eff_from_date, policy.eff_to_date as eff_to_date FROM \r\n\t\t\tV2.policy\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY pol_ak_id,eff_from_date,eff_to_date ORDER BY contract_cust_ak_id DESC) = 1\n\t),\n\tLKP_PolicyDimID AS (\n\t\tSELECT\n\t\tpol_dim_id,\n\t\tpol_key,\n\t\tpol_eff_date,\n\t\tpol_exp_date,\n\t\tpms_pol_lob_code,\n\t\tClassOfBusinessCode,\n\t\tIN_Trans_Date,\n\t\tedw_pol_ak_id,\n\t\teff_from_date,\n\t\teff_to_date\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tpol_dim_id,\n\t\t\t\tpol_key,\n\t\t\t\tpol_eff_date,\n\t\t\t\tpol_exp_date,\n\t\t\t\tpms_pol_lob_code,\n\t\t\t\tClassOfBusinessCode,\n\t\t\t\tIN_Trans_Date,\n\t\t\t\tedw_pol_ak_id,\n\t\t\t\teff_from_date,\n\t\t\t\teff_to_date\n\t\t\tFROM policy_dim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_pol_ak_id,eff_from_date,eff_to_date ORDER BY pol_dim_id DESC) = 1\n\t),\n\tLKP_V3_AgencyDimID AS (\n\t\tSELECT\n\t\tagency_dim_id,\n\t\tedw_agency_ak_id,\n\t\teff_from_date,\n\t\teff_to_date\n\t\tFROM (\n\t\t\tSELECT AgencyDim.AgencyDimID as agency_dim_id, AgencyDim.EDWAgencyAKID as edw_agency_ak_id, AgencyDim.EffectiveDate as eff_from_date, AgencyDim.ExpirationDate as eff_to_date\r\n\t\t\t FROM V3.AgencyDim as AgencyDim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_agency_ak_id,eff_from_date,eff_to_date ORDER BY agency_dim_id DESC) = 1\n\t),\n\tLKP_ContractCustomerDim AS (\n\t\tSELECT\n\t\tcontract_cust_dim_id,\n\t\tIN_Trans_Date,\n\t\tedw_contract_cust_ak_id,\n\t\teff_from_date,\n\t\teff_to_date\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tcontract_cust_dim_id,\n\t\t\t\tIN_Trans_Date,\n\t\t\t\tedw_contract_cust_ak_id,\n\t\t\t\teff_from_date,\n\t\t\t\teff_to_date\n\t\t\tFROM contract_customer_dim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_contract_cust_ak_id,eff_from_date,eff_to_date ORDER BY contract_cust_dim_id DESC) = 1\n\t),\n\tlkp_StrategicBusinessDivisionDIM AS (\n\t\tSELECT\n\t\tstrtgc_bus_dvsn_dim_id,\n\t\tedw_strtgc_bus_dvsn_ak_id\n\t\tFROM (\n\t\t\tSELECT strategic_business_division_dim.strtgc_bus_dvsn_dim_id as strtgc_bus_dvsn_dim_id, strategic_business_division_dim.edw_strtgc_bus_dvsn_ak_id as edw_strtgc_bus_dvsn_ak_id \r\n\t\t\tFROM strategic_business_division_dim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_strtgc_bus_dvsn_ak_id ORDER BY strtgc_bus_dvsn_dim_id DESC) = 1\n\t),\n\tEXP_Values AS (\n\t\tSELECT\n\t\tLKP_V3_AgencyDimID.agency_dim_id,\n\t\tLKP_ContractCustomerDim.contract_cust_dim_id,\n\t\tLKP_PolicyDimID.pol_dim_id,\n\t\tLKP_V2_Policy.pol_status_code,\n\t\tLKP_PolicyDimID.pol_eff_date,\n\t\tLKP_PolicyDimID.pol_exp_date,\n\t\tlkp_StrategicBusinessDivisionDIM.strtgc_bus_dvsn_dim_id,\n\t\tLKP_PolicyDimID.pol_key,\n\t\tLKP_PolicyDimID.pms_pol_lob_code,\n\t\tLKP_PolicyDimID.ClassOfBusinessCode\n\t\tFROM \n\t\tLEFT JOIN LKP_ContractCustomerDim\n\t\tON LKP_ContractCustomerDim.edw_contract_cust_ak_id = LKP_V2_Policy.contract_cust_ak_id AND LKP_ContractCustomerDim.eff_from_date <= EXP_Default.IN_Trans_Date AND LKP_ContractCustomerDim.eff_to_date >= EXP_Default.IN_Trans_Date\n\t\tLEFT JOIN LKP_PolicyDimID\n\t\tON LKP_PolicyDimID.edw_pol_ak_id = EXP_Default.PolicyAKID AND LKP_PolicyDimID.eff_from_date <= EXP_Default.IN_Trans_Date AND LKP_PolicyDimID.eff_to_date >= EXP_Default.IN_Trans_Date\n\t\tLEFT JOIN LKP_V2_Policy\n\t\tON LKP_V2_Policy.pol_ak_id = EXP_Default.PolicyAKID AND LKP_V2_Policy.eff_from_date <= EXP_Default.IN_Trans_Date AND LKP_V2_Policy.eff_to_date >= EXP_Default.IN_Trans_Date\n\t\tLEFT JOIN LKP_V3_AgencyDimID\n\t\tON LKP_V3_AgencyDimID.edw_agency_ak_id = LKP_V2_Policy.agencyakid AND LKP_V3_AgencyDimID.eff_from_date <= EXP_Default.IN_Trans_Date AND LKP_V3_AgencyDimID.eff_to_date >= EXP_Default.IN_Trans_Date\n\t\tLEFT JOIN lkp_StrategicBusinessDivisionDIM\n\t\tON lkp_StrategicBusinessDivisionDIM.edw_strtgc_bus_dvsn_ak_id = LKP_V2_Policy.strtgc_bus_dvsn_ak_id\n\t),\n\tOutput AS (\n\t\tSELECT\n\t\tagency_dim_id, \n\t\tcontract_cust_dim_id, \n\t\tpol_dim_id, \n\t\tpol_status_code, \n\t\tpol_eff_date, \n\t\tpol_exp_date, \n\t\tstrtgc_bus_dvsn_dim_id, \n\t\tpol_key, \n\t\tpms_pol_lob_code, \n\t\tClassOfBusinessCode\n\t\tFROM EXP_Values\n\t),\n),\nEXP_GetDimIds AS (\n\tSELECT\n\tLKP_InsuranceReferenceDim.InsuranceReferenceDimId AS i_InsuranceReferenceDimId,\n\tmplt_PolicyDimID_PremiumMaster.agency_dim_id AS i_AgencyDimID,\n\tLKP_SalesDivisionDim.SalesDivisionDimID AS i_SalesDivisionDimId,\n\tmplt_PolicyDimID_PremiumMaster.pol_dim_id AS i_pol_dim_id,\n\tmplt_PolicyDimID_PremiumMaster.contract_cust_dim_id AS i_contract_cust_dim_id,\n\tLKP_DividendTypeDim.DividendTypeDimId AS i_DividendTypeDimId,\n\tLKP_StateDim.StateDimId AS i_StateDimId,\n\tLKP_calendar_dim_DividendTransactionEnteredDate.clndr_id AS i_DividendTransactionEnteredDateId,\n\tLKP_calendar_dim_DividendRunDate.clndr_id AS i_DividendRunDateId,\n\tEXP_GetValues.DividendPaidAmount,\n\tEXP_GetValues.o_PolicyAuditDimId AS PolicyAuditDimId,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditId,\n\t-- *INF*: IIF(ISNULL(i_InsuranceReferenceDimId), -1, i_InsuranceReferenceDimId)\n\tIFF(i_InsuranceReferenceDimId IS NULL, - 1, i_InsuranceReferenceDimId) AS o_InsuranceReferenceDimId,\n\t-- *INF*: IIF(ISNULL(i_AgencyDimID), -1, i_AgencyDimID)\n\tIFF(i_AgencyDimID IS NULL, - 1, i_AgencyDimID) AS o_AgencyDimId,\n\t-- *INF*: IIF(ISNULL(i_SalesDivisionDimId),-1,i_SalesDivisionDimId)\n\tIFF(i_SalesDivisionDimId IS NULL, - 1, i_SalesDivisionDimId) AS o_SalesDivisionDimId,\n\t-- *INF*: IIF(ISNULL(i_pol_dim_id), -1, i_pol_dim_id)\n\tIFF(i_pol_dim_id IS NULL, - 1, i_pol_dim_id) AS o_PolicyDimId,\n\t-- *INF*: IIF(ISNULL(i_contract_cust_dim_id), -1, i_contract_cust_dim_id)\n\tIFF(i_contract_cust_dim_id IS NULL, - 1, i_contract_cust_dim_id) AS o_ContractCustomerDimId,\n\t-- *INF*: IIF(ISNULL(i_DividendTypeDimId),-1,i_DividendTypeDimId)\n\tIFF(i_DividendTypeDimId IS NULL, - 1, i_DividendTypeDimId) AS o_DividendTypeDimId,\n\t-- *INF*: IIF(ISNULL(i_StateDimId),-1,i_StateDimId)\n\tIFF(i_StateDimId IS NULL, - 1, i_StateDimId) AS o_StateDimId,\n\t-- *INF*: IIF(ISNULL(i_DividendTransactionEnteredDateId),-1,i_DividendTransactionEnteredDateId)\n\tIFF(i_DividendTransactionEnteredDateId IS NULL, - 1, i_DividendTransactionEnteredDateId) AS o_DividendTransactionEnteredDateId,\n\t-- *INF*: IIF(ISNULL(i_DividendRunDateId),-1,i_DividendRunDateId)\n\tIFF(i_DividendRunDateId IS NULL, - 1, i_DividendRunDateId) AS o_DividendRunDateId,\n\tEXP_GetValues.DCTDividendId\n\tFROM EXP_GetValues\n\t -- Manually join with mplt_PolicyDimID_PremiumMaster\n\tLEFT JOIN LKP_DividendTypeDim\n\tON LKP_DividendTypeDim.DividendPlan = EXP_GetValues.DividendPlan AND LKP_DividendTypeDim.DividendType = EXP_GetValues.DividendType\n\tLEFT JOIN LKP_InsuranceReferenceDim\n\tON LKP_InsuranceReferenceDim.StrategicProfitCenterCode = EXP_GetValues.StrategicProfitCenterCode AND LKP_InsuranceReferenceDim.InsuranceSegmentCode = EXP_GetValues.InsuranceSegmentCode\n\tLEFT JOIN LKP_SalesDivisionDim\n\tON LKP_SalesDivisionDim.AgencyAKID = EXP_GetValues.AgencyAKId\n\tLEFT JOIN LKP_StateDim\n\tON LKP_StateDim.StateAbbreviation = LKP_sup_state.state_code\n\tLEFT JOIN LKP_calendar_dim_DividendRunDate\n\tON LKP_calendar_dim_DividendRunDate.clndr_date = EXP_GetValues.DividendRunDate\n\tLEFT JOIN LKP_calendar_dim_DividendTransactionEnteredDate\n\tON LKP_calendar_dim_DividendTransactionEnteredDate.clndr_date = EXP_GetValues.DividendTransactionEnteredDate\n),\nLKP_DCTDividendFact AS (\n\tSELECT\n\tDCTDividendFactId,\n\ti_DCTDividendId,\n\tEDWDCTDividendPKId\n\tFROM (\n\t\tSELECT \n\t\t\tDCTDividendFactId,\n\t\t\ti_DCTDividendId,\n\t\t\tEDWDCTDividendPKId\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.DCTDividendFact\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EDWDCTDividendPKId ORDER BY DCTDividendFactId DESC) = 1\n),\nRTR_Target AS (\n\tSELECT\n\tEXP_GetDimIds.o_AuditId AS AuditId,\n\tEXP_GetDimIds.o_InsuranceReferenceDimId AS InsuranceReferenceDimId,\n\tEXP_GetDimIds.o_AgencyDimId AS AgencyDimId,\n\tEXP_GetDimIds.o_SalesDivisionDimId AS SalesDivisionDimId,\n\tEXP_GetDimIds.o_PolicyDimId AS PolicyDimId,\n\tEXP_GetDimIds.o_ContractCustomerDimId AS ContractCustomerDimId,\n\tEXP_GetDimIds.o_DividendTypeDimId AS DividendTypeDimId,\n\tEXP_GetDimIds.o_StateDimId AS StateDimId,\n\tEXP_GetDimIds.o_DividendTransactionEnteredDateId AS DividendTransactionEnteredDateId,\n\tEXP_GetDimIds.o_DividendRunDateId AS DividendRunDateId,\n\tEXP_GetDimIds.DividendPaidAmount,\n\tEXP_GetDimIds.PolicyAuditDimId,\n\tEXP_GetDimIds.DCTDividendId,\n\tLKP_DCTDividendFact.DCTDividendFactId\n\tFROM EXP_GetDimIds\n\tLEFT JOIN LKP_DCTDividendFact\n\tON LKP_DCTDividendFact.EDWDCTDividendPKId = EXP_GetDimIds.DCTDividendId\n),\nRTR_Target_NEW_DCT AS (SELECT * FROM RTR_Target WHERE ISNULL(DCTDividendFactId)),\nDCTDividendFact AS (\n\tINSERT INTO DCTDividendFact\n\t(AuditId, InsuranceReferenceDimId, AgencyDimId, SalesDivisionDimId, PolicyDimId, PolicyAuditDimId, ContractCustomerDimId, DividendTypeDimId, StateDimId, DividendTransactionEnteredDateId, DividendRunDateId, DividendPaidAmount, EDWDCTDividendPKId)\n\tSELECT \n\tAUDITID, \n\tINSURANCEREFERENCEDIMID, \n\tAGENCYDIMID, \n\tSALESDIVISIONDIMID, \n\tPOLICYDIMID, \n\tPOLICYAUDITDIMID, \n\tCONTRACTCUSTOMERDIMID, \n\tDIVIDENDTYPEDIMID, \n\tSTATEDIMID, \n\tDIVIDENDTRANSACTIONENTEREDDATEID, \n\tDIVIDENDRUNDATEID, \n\tDIVIDENDPAIDAMOUNT, \n\tDCTDividendId AS EDWDCTDIVIDENDPKID\n\tFROM RTR_Target_NEW_DCT\n),"
                        }
                    ]
                }
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "244793"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "893107"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7542392"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "07/01/2023 06:20:48"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/01/2023 11:17:11"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_WC_DATA_MART_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "DCT"
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "RPT_EDM"
            },
            "SOURCE_TABLE_OWNER_V2": {
                "type": "string",
                "defaultValue": "V2"
            },
            "TARGET_TABLE_OWNER_V3": {
                "type": "string",
                "defaultValue": "V3"
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": "AND DividendRunDate=convert(date,EOMONTH(getdate(), -1))"
            }
        },
        "folder": {
            "name": "Policy DataMart/"
        },
        "annotations": []
    }
}