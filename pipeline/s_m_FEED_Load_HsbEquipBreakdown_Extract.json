{
    "name": "s_m_FEED_Load_HsbEquipBreakdown_Extract",
    "properties": {
        "activities": [
            {
                "name": "m_FEED_Load_HsbEquipBreakdown_Extract",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_WorkHSBEquipmentBreakdownExtract AS (\n\tSELECT\n\t\tPolicyAKId,\n\t\tLocationXMLId,\n\t\tTransactionNumber,\n\t\tCurrentPolicyNumber,\n\t\tCompanyCode,\n\t\tTransactionCode,\n\t\tNameOfInsured,\n\t\tMailingStreetAddress,\n\t\tMailingCity,\n\t\tMailingStateProvinceAbbreviation,\n\t\tMailingZipCode,\n\t\tTransactionEnteredDate,\n\t\tTransactionEffectiveDate,\n\t\tPolicyEffectiveDate,\n\t\tPolicyExpirationDate,\n\t\tCoverage,\n\t\tEBGrossPremium,\n\t\tEBNetPremium,\n\t\tDeductible,\n\t\tOccupancy,\n\t\tValue,\n\t\tValueType,\n\t\tBranchCode,\n\t\tAgencyCode,\n\t\tPreviousPolicyNumber,\n\t\tProgramId,\n\t\tTreatyNumber,\n\t\tISOType,\n\t\tLocationName,\n\t\tRiskStreetAddress,\n\t\tRiskCity,\n\t\tRiskStateProvinceAbbreviation,\n\t\tRiskZipCode,\n\t\tOTIndicator,\n\t\tInspectionContactName,\n\t\tContactPhoneNumber,\n\t\tReportingPeriod,\n\t\tActiveLocationFlag,\n\t\tOriginalTransactionalEnteredDate,\n\t\tAgencyName,\n\t\tAgencyEmailAddress,\n\t\tAgencyPhoneNumber\n\tFROM WorkHSBEquipmentBreakdownExtract\n\tWHERE ReportingPeriod=@{pipeline().parameters.RUNDATE}\n),\nEXP_Location AS (\n\tSELECT\n\tTransactionNumber,\n\t'3' AS v_RecordType,\n\tv_RecordType AS RecordType,\n\tCurrentPolicyNumber,\n\tCompanyCode,\n\tTransactionCode,\n\tActiveLocationFlag,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- TransactionCode='Cancel','42',\r\n\t-- TransactionCode='NonRenew','42',\r\n\t-- IN(ActiveLocationFlag,'F','0')=1,'42',\r\n\t-- '40')\n\tDECODE(\n\t    TRUE,\n\t    TransactionCode = 'Cancel', '42',\n\t    TransactionCode = 'NonRenew', '42',\n\t    ActiveLocationFlag IN ('F','0') = 1, '42',\n\t    '40'\n\t) AS v_TransactionCode,\n\tLocationName,\n\tRiskStreetAddress,\n\tRiskCity,\n\tRiskStateProvinceAbbreviation,\n\tRiskZipCode,\n\tOTIndicator,\n\tInspectionContactName,\n\tContactPhoneNumber,\n\t-- *INF*: TO_CHAR(ContactPhoneNumber)\n\tTO_CHAR(ContactPhoneNumber) AS v_Char_ContactPhoneNumber,\n\t-- *INF*: RPAD(IIF(NOT ISNULL(v_Char_ContactPhoneNumber),v_Char_ContactPhoneNumber,''),13,' ')\n\tRPAD(\n\t    IFF(\n\t        v_Char_ContactPhoneNumber IS NOT NULL, v_Char_ContactPhoneNumber, ''\n\t    ), 13, ' ') AS v_ContactPhoneNumber,\n\tOccupancy,\n\tValue,\n\t-- *INF*: IIF(Value>0,LPAD(TO_CHAR(Value),9,'0'),RPAD('',9,'0'))\n\tIFF(Value > 0, LPAD(TO_CHAR(Value), 9, '0'), RPAD('', 9, '0')) AS v_Value,\n\tValueType,\n\t-- *INF*: RPAD('',88,' ')\n\tRPAD('', 88, ' ') AS v_Filler1,\n\t-- *INF*: RPAD('',59,' ')\n\tRPAD('', 59, ' ') AS v_Filler2,\n\t-- *INF*: RPAD('',69,' ')\n\tRPAD('', 69, ' ') AS v_Filler3,\n\tReportingPeriod,\n\tAgencyName,\n\tAgencyEmailAddress,\n\tAgencyPhoneNumber,\n\t-- *INF*: RPAD(TO_CHAR(AgencyName),100,'')\n\tRPAD(TO_CHAR(AgencyName), 100, '') AS v_AgencyName,\n\t-- *INF*: RPAD(TO_CHAR(AgencyEmailAddress),100,'')\n\tRPAD(TO_CHAR(AgencyEmailAddress), 100, '') AS v_AgencyEmailAddress,\n\t-- *INF*: RPAD(TO_CHAR(AgencyPhoneNumber),15,'')\n\tRPAD(TO_CHAR(AgencyPhoneNumber), 15, '') AS v_AgencyPhoneNumber,\n\tTransactionNumber||\r\nv_RecordType||\r\nCurrentPolicyNumber||\r\nCompanyCode||\r\nv_TransactionCode||\r\nLocationName||\r\nRiskStreetAddress||\r\nRiskCity||\r\nRiskStateProvinceAbbreviation||\r\nRiskZipCode||\r\nOTIndicator||\r\nInspectionContactName||\r\nv_ContactPhoneNumber||\r\nOccupancy||\r\nv_Value||\r\nValueType||\r\nv_Filler1||\r\nv_Filler2||\r\nv_Filler3\r\n|| v_AgencyName\r\n|| v_AgencyEmailAddress\r\n|| v_AgencyPhoneNumber AS Record\n\tFROM SQ_WorkHSBEquipmentBreakdownExtract\n),\nEXPTRANS AS (\n\tSELECT\n\tPolicyAKId,\n\tTransactionNumber,\n\tCurrentPolicyNumber,\n\tCompanyCode,\n\tTransactionCode,\n\tNameOfInsured,\n\tMailingStreetAddress,\n\tMailingCity,\n\tMailingStateProvinceAbbreviation,\n\tMailingZipCode,\n\tTransactionEnteredDate,\n\tTransactionEffectiveDate,\n\tPolicyEffectiveDate,\n\tPolicyExpirationDate,\n\tCoverage,\n\tEBGrossPremium,\n\tEBNetPremium,\n\tDeductible,\n\tValue,\n\tValueType,\n\t-- *INF*: DECODE(ValueType,\r\n\t-- 'B',1,\r\n\t-- 'C',10,\r\n\t-- 'T',11,\r\n\t-- 0)\n\tDECODE(\n\t    ValueType,\n\t    'B', 1,\n\t    'C', 10,\n\t    'T', 11,\n\t    0\n\t) AS Policy_ValueType,\n\tBranchCode,\n\tAgencyCode,\n\tPreviousPolicyNumber,\n\tProgramId,\n\tTreatyNumber,\n\tISOType,\n\tReportingPeriod,\n\tOriginalTransactionalEnteredDate,\n\tAgencyName,\n\tAgencyEmailAddress,\n\tAgencyPhoneNumber\n\tFROM SQ_WorkHSBEquipmentBreakdownExtract\n),\nAGG_Policy AS (\n\tSELECT\n\tPolicyAKId,\n\tTransactionNumber,\n\tCurrentPolicyNumber,\n\tCompanyCode,\n\tTransactionCode,\n\tNameOfInsured,\n\tMailingStreetAddress,\n\tMailingCity,\n\tMailingStateProvinceAbbreviation,\n\tMailingZipCode,\n\tTransactionEnteredDate,\n\tTransactionEffectiveDate,\n\tPolicyEffectiveDate,\n\tPolicyExpirationDate,\n\tCoverage,\n\tEBGrossPremium,\n\tEBNetPremium,\n\tDeductible,\n\tValue,\n\t-- *INF*: SUM(IIF(Value>0,Value,0))\n\tSUM(\n\t    IFF(\n\t        Value > 0, Value, 0\n\t    )) AS o_Value,\n\tPolicy_ValueType,\n\t-- *INF*: MAX(Policy_ValueType)\n\tMAX(Policy_ValueType) AS o_Policy_ValueType_Max,\n\t-- *INF*: MIN(Policy_ValueType)\n\tMIN(Policy_ValueType) AS o_Policy_ValueType_Min,\n\tBranchCode,\n\tAgencyCode,\n\tPreviousPolicyNumber,\n\tProgramId,\n\tTreatyNumber,\n\tISOType,\n\tReportingPeriod,\n\tOriginalTransactionalEnteredDate,\n\tAgencyName,\n\tAgencyEmailAddress,\n\tAgencyPhoneNumber\n\tFROM EXPTRANS\n\tGROUP BY PolicyAKId, TransactionNumber, TransactionEnteredDate, TransactionEffectiveDate, OriginalTransactionalEnteredDate\n),\nEXP_Policy AS (\n\tSELECT\n\tTransactionNumber,\n\t'2' AS v_RecordType,\n\tv_RecordType AS RecordType,\n\tCurrentPolicyNumber,\n\tCompanyCode,\n\tTransactionCode,\n\t-- *INF*: DECODE(TransactionCode,\r\n\t-- 'New','01',\r\n\t-- 'Endorse','30',\r\n\t-- 'Cancel','03',\r\n\t-- 'Reinstate','10',\r\n\t-- 'Rewrite','04',\r\n\t-- 'Reissue','04',\r\n\t-- 'Renew','07',\r\n\t-- 'NonRenew','03',\r\n\t-- '30')\n\tDECODE(\n\t    TransactionCode,\n\t    'New', '01',\n\t    'Endorse', '30',\n\t    'Cancel', '03',\n\t    'Reinstate', '10',\n\t    'Rewrite', '04',\n\t    'Reissue', '04',\n\t    'Renew', '07',\n\t    'NonRenew', '03',\n\t    '30'\n\t) AS v_TransactionCode,\n\tNameOfInsured,\n\tMailingStreetAddress,\n\tMailingCity,\n\tMailingStateProvinceAbbreviation,\n\tMailingZipCode,\n\tTransactionEnteredDate,\n\t-- *INF*: TO_CHAR(TransactionEnteredDate,'YYYYMMDD')\n\tTO_CHAR(TransactionEnteredDate, 'YYYYMMDD') AS v_TransactionEnteredDate,\n\tTransactionEffectiveDate,\n\t-- *INF*: TO_CHAR(TransactionEffectiveDate,'YYYYMMDD')\n\tTO_CHAR(TransactionEffectiveDate, 'YYYYMMDD') AS v_TransactionEffectiveDate,\n\tPolicyEffectiveDate,\n\t-- *INF*: TO_CHAR(PolicyEffectiveDate,'YYYYMMDD')\n\tTO_CHAR(PolicyEffectiveDate, 'YYYYMMDD') AS v_PolicyEffectiveDate,\n\tPolicyExpirationDate,\n\t-- *INF*: TO_CHAR(PolicyExpirationDate,'YYYYMMDD')\n\tTO_CHAR(PolicyExpirationDate, 'YYYYMMDD') AS v_PolicyExpirationDate,\n\tCoverage,\n\tEBGrossPremium,\n\t-- *INF*: LPAD(TO_CHAR(ABS(EBGrossPremium)),11,'0')\n\tLPAD(TO_CHAR(ABS(EBGrossPremium)), 11, '0') AS v_EBGrossPremium,\n\tEBGrossPremium AS o_EBGrossPremium,\n\tEBNetPremium,\n\t-- *INF*: LPAD(TO_CHAR(ABS(EBNetPremium)),11,'0')\n\tLPAD(TO_CHAR(ABS(EBNetPremium)), 11, '0') AS v_EBNetPremium,\n\tEBNetPremium AS o_EBNetPremium,\n\tDeductible,\n\t-- *INF*: RPAD('',6,' ')\n\tRPAD('', 6, ' ') AS v_Occupancy,\n\to_Value AS Value,\n\t-- *INF*: IIF(Value>0,LPAD(TO_CHAR(Value),9,'0'),LPAD('',9,'0'))\n\tIFF(Value > 0, LPAD(TO_CHAR(Value), 9, '0'), LPAD('', 9, '0')) AS v_Value,\n\to_Policy_ValueType_Max AS ValueType_Max,\n\to_Policy_ValueType_Min AS ValueType_Min,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- ValueType_Max=1,'B',\r\n\t-- ValueType_Max=10 and ValueType_Min=10, 'C',\r\n\t-- ValueType_Max=10 and ValueType_Max<>ValueType_Min,'T',\r\n\t-- ValueType_Max>10,'T')\n\tDECODE(\n\t    TRUE,\n\t    ValueType_Max = 1, 'B',\n\t    ValueType_Max = 10 and ValueType_Min = 10, 'C',\n\t    ValueType_Max = 10 and ValueType_Max <> ValueType_Min, 'T',\n\t    ValueType_Max > 10, 'T'\n\t) AS ValueType,\n\tBranchCode,\n\tAgencyCode,\n\tPreviousPolicyNumber,\n\tProgramId,\n\tTreatyNumber,\n\tISOType,\n\t-- *INF*: RPAD('',88,' ')\n\tRPAD('', 88, ' ') AS v_Filler1,\n\t-- *INF*: RPAD('',59,' ')\n\tRPAD('', 59, ' ') AS v_Filler2,\n\t-- *INF*: RPAD('',13,' ')\n\tRPAD('', 13, ' ') AS v_Filler3,\n\tReportingPeriod,\n\tAgencyName,\n\tAgencyEmailAddress,\n\tAgencyPhoneNumber,\n\t-- *INF*: RPAD(TO_CHAR(AgencyName),100,'')\n\tRPAD(TO_CHAR(AgencyName), 100, '') AS v_AgencyName,\n\t-- *INF*: RPAD(TO_CHAR(AgencyEmailAddress),100,'')\n\tRPAD(TO_CHAR(AgencyEmailAddress), 100, '') AS v_AgencyEmailAddress,\n\t-- *INF*: RPAD(TO_CHAR(AgencyPhoneNumber),15,'')\n\tRPAD(TO_CHAR(AgencyPhoneNumber), 15, '') AS v_AgencyPhoneNumber,\n\t-- *INF*: TransactionNumber||\r\n\t-- v_RecordType||\r\n\t-- CurrentPolicyNumber||\r\n\t-- CompanyCode||\r\n\t-- v_TransactionCode||\r\n\t-- NameOfInsured||\r\n\t-- MailingStreetAddress||\r\n\t-- MailingCity||\r\n\t-- MailingStateProvinceAbbreviation||\r\n\t-- MailingZipCode||\r\n\t-- v_TransactionEnteredDate||\r\n\t-- v_TransactionEffectiveDate||\r\n\t-- v_PolicyEffectiveDate||\r\n\t-- v_PolicyExpirationDate||\r\n\t-- Coverage||\r\n\t-- IIF(EBGrossPremium>=0,v_EBGrossPremium,'-'||SUBSTR(v_EBGrossPremium,2,10))||\r\n\t-- IIF(EBNetPremium>=0,v_EBNetPremium,'-'||SUBSTR(v_EBNetPremium,2,10))||\r\n\t-- Deductible||\r\n\t-- v_Occupancy||\r\n\t-- v_Value||\r\n\t-- ValueType||\r\n\t-- BranchCode||\r\n\t-- AgencyCode||\r\n\t-- PreviousPolicyNumber||\r\n\t-- ProgramId||\r\n\t-- TreatyNumber||\r\n\t-- ISOType||\r\n\t-- v_Filler1||\r\n\t-- v_Filler2||\r\n\t-- v_Filler3\r\n\t-- || v_AgencyName\r\n\t-- || v_AgencyEmailAddress\r\n\t-- || v_AgencyPhoneNumber\n\tTransactionNumber || v_RecordType || CurrentPolicyNumber || CompanyCode || v_TransactionCode || NameOfInsured || MailingStreetAddress || MailingCity || MailingStateProvinceAbbreviation || MailingZipCode || v_TransactionEnteredDate || v_TransactionEffectiveDate || v_PolicyEffectiveDate || v_PolicyExpirationDate || Coverage || IFF(EBGrossPremium >= 0, v_EBGrossPremium, '-' || SUBSTR(v_EBGrossPremium, 2, 10)) || IFF(EBNetPremium >= 0, v_EBNetPremium, '-' || SUBSTR(v_EBNetPremium, 2, 10)) || Deductible || v_Occupancy || v_Value || ValueType || BranchCode || AgencyCode || PreviousPolicyNumber || ProgramId || TreatyNumber || ISOType || v_Filler1 || v_Filler2 || v_Filler3 || v_AgencyName || v_AgencyEmailAddress || v_AgencyPhoneNumber AS Record\n\tFROM AGG_Policy\n),\nUnion_PolicyLocation AS (\n\tSELECT TransactionNumber, RecordType, Record, o_EBGrossPremium AS EBGrossPremium, o_EBNetPremium AS EBNetPremium, ReportingPeriod\n\tFROM EXP_Policy\n\tUNION\n\tSELECT TransactionNumber, RecordType, Record, ReportingPeriod\n\tFROM EXP_Location\n),\nAGG_Control AS (\n\tSELECT\n\tEBGrossPremium,\n\tEBNetPremium,\n\t-- *INF*: COUNT(1)\n\tCOUNT(1) AS RecordCount,\n\t-- *INF*: SUM(EBGrossPremium)\n\tSUM(EBGrossPremium) AS TotalGrossPremium,\n\t-- *INF*: SUM(EBNetPremium)\n\tSUM(EBNetPremium) AS TotalNetPremium,\n\tReportingPeriod\n\tFROM Union_PolicyLocation\n\tGROUP BY \n),\nEXP_Control AS (\n\tSELECT\n\tRecordCount,\n\tTotalGrossPremium,\n\tTotalNetPremium,\n\tReportingPeriod,\n\t-- *INF*: RPAD('',26,'1')\n\tRPAD('', 26, '1') AS v_ControlKey,\n\t'000118' AS v_CompanyCode,\n\t-- *INF*: LPAD(TO_CHAR(RecordCount),7,'0')\n\tLPAD(TO_CHAR(RecordCount), 7, '0') AS v_NumberOfRecords,\n\t-- *INF*: LPAD(TO_CHAR(ABS(TotalGrossPremium)),11,'0')\n\tLPAD(TO_CHAR(ABS(TotalGrossPremium)), 11, '0') AS v_TotalGrossPremium,\n\t-- *INF*: LPAD(TO_CHAR(ABS(TotalNetPremium)),11,'0')\n\tLPAD(TO_CHAR(ABS(TotalNetPremium)), 11, '0') AS v_TotalNetPremium,\n\t-- *INF*: TO_CHAR(ReportingPeriod)\n\tTO_CHAR(ReportingPeriod) AS v_ReportingPeriod,\n\t'06.00' AS v_VersionNumber,\n\t-- *INF*: RPAD('',200,' ')\n\tRPAD('', 200, ' ') AS v_Filer1,\n\t-- *INF*: RPAD('',208,' ')\n\tRPAD('', 208, ' ') AS v_Filter2,\n\t'99999' AS TransactionNumber,\n\t'9' AS RecordType,\n\t-- *INF*: v_ControlKey||\r\n\t-- v_CompanyCode||\r\n\t-- v_NumberOfRecords||\r\n\t-- IIF(TotalGrossPremium>=0,v_TotalGrossPremium,'-'||SUBSTR(v_TotalGrossPremium,2,10))||\r\n\t-- IIF(TotalNetPremium>=0,v_TotalNetPremium,'-'||SUBSTR(v_TotalNetPremium,2,10))||\r\n\t-- v_ReportingPeriod||\r\n\t-- v_VersionNumber||\r\n\t-- v_Filer1||\r\n\t-- v_Filter2\n\tv_ControlKey || v_CompanyCode || v_NumberOfRecords || IFF(TotalGrossPremium >= 0, v_TotalGrossPremium, '-' || SUBSTR(v_TotalGrossPremium, 2, 10)) || IFF(TotalNetPremium >= 0, v_TotalNetPremium, '-' || SUBSTR(v_TotalNetPremium, 2, 10)) || v_ReportingPeriod || v_VersionNumber || v_Filer1 || v_Filter2 AS Record\n\tFROM AGG_Control\n),\nUnion_Control AS (\n\tSELECT TransactionNumber, RecordType, Record\n\tFROM Union_PolicyLocation\n\tUNION\n\tSELECT TransactionNumber, RecordType, Record\n\tFROM EXP_Control\n),\nSRT_Records AS (\n\tSELECT\n\tTransactionNumber, \n\tRecordType, \n\tRecord\n\tFROM Union_Control\n\tORDER BY TransactionNumber ASC, RecordType ASC\n),\nHSBEquipmentBreakdownExtractFile AS (\n\tINSERT INTO HSBEquipmentBreakdownExtractFile\n\t(Record)\n\tSELECT \n\tRECORD\n\tFROM SRT_Records\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "RUNDATE": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "PolicyDataServices/"
        },
        "annotations": []
    }
}