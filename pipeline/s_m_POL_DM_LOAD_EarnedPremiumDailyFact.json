{
    "name": "s_m_POL_DM_LOAD_EarnedPremiumDailyFact",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DM_LOAD_EarnedPremiumDailyFact",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_CoverageDetailDim AS (\n\tSELECT\n\tCoverageDetailDimId,\n\tPremiumTransactionAKId\n\tFROM (\n\t\tdeclare @Date1 as datetime\r\n\t\t\r\n\t\tset @Date1=dateadd(dd,-@{pipeline().parameters.NO_OF_DAYS},cast(getdate() as date))\r\n\t\t\r\n\t\tselect CDD.CoverageDetailDimId as CoverageDetailDimId, \r\n\t\tPT.PremiumTransactionAKId as PremiumTransactionAKId\r\n\t\tfrom @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.PremiumTransaction PT\r\n\t\tjoin @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailDim CDD\r\n\t\ton  PT.PremiumTransactionID=CDD.EDWPremiumTransactionPKID\r\n\t\twhere exists (\r\n\t\tselect 1 from @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.EarnedPremiumDailyCalculation EPDC\r\n\t\twhere EPDC.PremiumTransactionAKId=PT.PremiumTransactionAKId\r\n\t\tand EPDC.RunDate>=@Date1  and EPDC.RunDate<=getdate() )\r\n\t\tor '@{pipeline().parameters.SELECTION_START_TS}'<='01/01/1800 00:00:00'\r\n\t\torder by PT.PremiumTransactionAKId\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionAKId ORDER BY CoverageDetailDimId) = 1\n),\nLKP_CoverageDetailDim_Hist AS (\n\tSELECT\n\tCoverageDetailDimId,\n\tStatisticalCoverageAKID\n\tFROM (\n\t\tdeclare @Date1 as datetime\r\n\t\t\r\n\t\tset @Date1=dateadd(dd,-@{pipeline().parameters.NO_OF_DAYS},cast(getdate() as date))\r\n\t\t\r\n\t\tselect CDD.CoverageDetailDimId as CoverageDetailDimId, \r\n\t\tEPDC.StatisticalCoverageAKID as StatisticalCoverageAKID\r\n\t\tfrom  @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.EarnedPremiumDailyCalculation EPDC\r\n\t\tjoin @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.StatisticalCoverage SC\r\n\t\ton EPDC.StatisticalCoverageAKId=SC.StatisticalCoverageAKId\r\n\t\tjoin @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailDim CDD\r\n\t\ton  SC.CoverageGUID=CDD.CoverageGUID and EPDC.PremiumTransactionEffectiveDate between CDD.EffectiveDate and CDD.ExpirationDate\r\n\t\twhere EPDC.RunDate>=@Date1\r\n\t\tand EPDC.RunDate<=getdate()  \r\n\t\tand EPDC.PremiumTransactionAKID=-1\r\n\t\torder by EPDC.StatisticalCoverageAKID\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY StatisticalCoverageAKID ORDER BY CoverageDetailDimId) = 1\n),\nLKP_InsuranceReferenceCoverageDim_DCT AS (\n\tSELECT\n\tInsuranceReferenceCoverageDimId,\n\tDctRiskTypeCode,\n\tDctCoverageTypeCode,\n\tInsuranceLineCode,\n\tDctPerilGroup,\n\tDctSubCoverageTypeCode,\n\tDctCoverageVersion\n\tFROM (\n\t\tSELECT \n\t\t\tInsuranceReferenceCoverageDimId,\n\t\t\tDctRiskTypeCode,\n\t\t\tDctCoverageTypeCode,\n\t\t\tInsuranceLineCode,\n\t\t\tDctPerilGroup,\n\t\t\tDctSubCoverageTypeCode,\n\t\t\tDctCoverageVersion\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceCoverageDim\n\t\tWHERE NOT (DctRiskTypeCode='N/A' AND DctCoverageTypeCode='N/A' AND DctPerilGroup='N/A' AND DctSubCoverageTypeCode='N/A' AND DctCoverageVersion='N/A')\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY DctRiskTypeCode,DctCoverageTypeCode,InsuranceLineCode,DctPerilGroup,DctSubCoverageTypeCode,DctCoverageVersion ORDER BY InsuranceReferenceCoverageDimId) = 1\n),\nLKP_InsuranceReferenceCoverageDim_PMS AS (\n\tSELECT\n\tInsuranceReferenceCoverageDimId,\n\tInsuranceLineCode,\n\tPmsRiskUnitGroupCode,\n\tPmsRiskUnitCode,\n\tPmsMajorPerilCode,\n\tPmsProductTypeCode\n\tFROM (\n\t\tSELECT \n\t\t\tInsuranceReferenceCoverageDimId,\n\t\t\tInsuranceLineCode,\n\t\t\tPmsRiskUnitGroupCode,\n\t\t\tPmsRiskUnitCode,\n\t\t\tPmsMajorPerilCode,\n\t\t\tPmsProductTypeCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceCoverageDim\n\t\tWHERE DctRiskTypeCode='N/A' AND DctCoverageTypeCode='N/A' AND DctPerilGroup='N/A' AND DctSubCoverageTypeCode='N/A' AND DctCoverageVersion='N/A'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY InsuranceLineCode,PmsRiskUnitGroupCode,PmsRiskUnitCode,PmsMajorPerilCode,PmsProductTypeCode ORDER BY InsuranceReferenceCoverageDimId) = 1\n),\nlkp_sup_reason_amended_code AS (\n\tSELECT\n\tStandardReasonAmendedCode,\n\trsn_amended_code\n\tFROM (\n\t\tSELECT StandardReasonAmendedCode as StandardReasonAmendedCode,\r\n\t\tLOWER(rsn_amended_code) as rsn_amended_code\r\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.sup_reason_amended_code\r\n\t\tWHERE crrnt_snpsht_flag=1 and source_sys_id='DCT'\r\n\t\tORDER BY LOWER(rsn_amended_code)\r\n\t\t--\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY rsn_amended_code ORDER BY StandardReasonAmendedCode) = 1\n),\nLKP_sup_premium_transaction_code AS (\n\tSELECT\n\tStandardPremiumTransactionCode,\n\tsource_sys_id,\n\tprem_trans_code\n\tFROM (\n\t\tSELECT \n\t\t\tStandardPremiumTransactionCode,\n\t\t\tsource_sys_id,\n\t\t\tprem_trans_code\n\t\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_premium_transaction_code\n\t\tWHERE crrnt_snpsht_flag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY source_sys_id,prem_trans_code ORDER BY StandardPremiumTransactionCode) = 1\n),\nLKP_EarnedPremiumDailyFact AS (\n\tSELECT\n\tEarnedPremiumTransactionDailyFactID,\n\tEDWEarnedPremiumDailyCalculationPKID\n\tFROM (\n\t\tSELECT \n\t\t\tEarnedPremiumTransactionDailyFactID,\n\t\t\tEDWEarnedPremiumDailyCalculationPKID\n\t\tFROM EarnedPremiumTransactionDailyFact\n\t\tWHERE AuditID=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EDWEarnedPremiumDailyCalculationPKID ORDER BY EarnedPremiumTransactionDailyFactID) = 1\n),\nLKP_calender_dim AS (\n\tSELECT\n\tclndr_id,\n\tclndr_date\n\tFROM (\n\t\tSELECT \n\t\t\tclndr_id,\n\t\t\tclndr_date\n\t\tFROM calendar_dim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY clndr_date ORDER BY clndr_id) = 1\n),\nSQ_EarnedPremiumDailyCalculation AS (\n\tDeclare @Date1 as date\r\n\t\r\n\tset @Date1=dateadd(dd,-@{pipeline().parameters.NO_OF_DAYS},cast(getdate() as date))\r\n\t\r\n\t\r\n\tSELECT EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID, \r\n\tEarnedPremiumDailyCalculation.SourceSystemID,\r\n\tEarnedPremiumDailyCalculation.PolicyAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.ReinsuranceCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAKID,\r\n\tEarnedPremiumDailyCalculation.BureauStatisticalCodeAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PolicyExpirationDate, \r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageCancellationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEnteredDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionExpirationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionBookedDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionCode, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAmount, \r\n\tEarnedPremiumDailyCalculation.FullTermPremium, \r\n\tEarnedPremiumDailyCalculation.PremiumType, \r\n\tEarnedPremiumDailyCalculation.ReasonAmendedCode, \r\n\tEarnedPremiumDailyCalculation.EarnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInEarnedPremium, \r\n\tEarnedPremiumDailyCalculation.UnearnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInUnearnedPremium,\r\n\tisnull(PRODUCT.ProductCode, '000') as ProductCode, \r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.SubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.NonSubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineProductCode,\r\n\tIsnull(InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessCode, '000') as LineOfBusinessCode, \r\n\tIsnull(PolicyOffering.PolicyOfferingCode, '000') as PolicyOfferingCode, \r\n\tEarnedPremiumDailyCalculation.RunDate, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageAKId, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageEffectiveDate,\r\n\tEarnedPremiumDailyCalculation.RatingCoverageExpirationDate,\r\n\tRiskLocation.RiskLocationHashKey, \r\n\tEnterpriseGroup.EnterpriseGroupCode, \r\n\tInsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityCode,\r\n\tStrategicProfitCenter.StrategicProfitCenterCode, \r\n\tInsuranceSegment.InsuranceSegmentCode,\r\n\t'N/A' as RiskUnitGroup, \r\n\t'N/A' as RiskUnit, \r\n\t'N/A' as RiskUnitSequenceNumber, \r\n\t'N/A' as MajorPerilCode, \r\n\tRC.ClassCode, \r\n\tRC.RiskType, \r\n\tRC.CoverageType, \r\n\tSIL.StandardInsuranceLineCode, \r\n\tPC.TypeBureauCode,\r\n\tRC.PerilGroup,\r\n\tRC.SubCoverageTypeCode,\r\n\tRC.CoverageVersion,\r\n\tPC.CustomerCareCommissionRate,\r\n\tRPDT.RatingPlanCode,\r\n\tPC.PolicyCoverageEffectiveDate,\r\n\tPC.PolicyCoverageExpirationDate\r\n\tFROM\r\n\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.EarnedPremiumDailyCalculation\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation\r\n\tON EarnedPremiumDailyCalculation.RiskLocationAKID=RiskLocation.RiskLocationAKID\r\n\tand EarnedPremiumDailyCalculation.SourceSystemID='DCT' \r\n\tand RiskLocation.SourceSystemID='DCT'\r\n\tAND RiskLocation.CurrentSnapshotFlag=1\r\n\t\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy\r\n\tON EarnedPremiumDailyCalculation.PolicyAKID=policy.pol_ak_id\r\n\tand policy.source_sys_id='DCT'\r\n\tAND policy.crrnt_snpsht_flag=1\r\n\t\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage RC\r\n\t             ON EarnedPremiumDailyCalculation.RatingCoverageAKID=RC.RatingCoverageAKId \r\n\t\t\tAND EarnedPremiumDailyCalculation.PremiumTransactionEnteredDate between RC.EffectiveDate and RC.ExpirationDate\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\t             ON EarnedPremiumDailyCalculation.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\t\t\t\t and PC.SourceSystemID='DCT' \r\n\t             AND PC.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line SIL\r\n\t          ON SIL.ins_line_code=PC.InsuranceLine\r\n\t          AND SIL.crrnt_snpsht_flag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product \r\n\ton EarnedPremiumDailyCalculation.SourceSystemID='DCT' and RC.ProductAKID=Product.ProductAKID and Product.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLineOfBusiness \r\n\tOn EarnedPremiumDailyCalculation.SourceSystemID='DCT' and RC.InsuranceReferenceLineOfBusinessAKID=InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessAKId and InsuranceReferenceLineOfBusiness.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyOffering\r\n\tOn PolicyOffering.PolicyOfferingAKID=policy.PolicyOfferingAKID and PolicyOffering.CurrentSnapshotFlag=1\r\n\t\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter\r\n\tON policy.StrategicProfitCenterAKId=StrategicProfitCenter.StrategicProfitCenterAKId\r\n\tAND StrategicProfitCenter.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment\r\n\tON InsuranceSegment.InsuranceSegmentAKId=policy.InsuranceSegmentAKId\r\n\tAND InsuranceSegment.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.EnterpriseGroup\r\n\tON EnterpriseGroup.EnterpriseGroupId=StrategicProfitCenter.EnterpriseGroupId\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLegalEntity\r\n\tON InsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityId=StrategicProfitCenter.InsuranceReferenceLegalEntityId \r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingPlan RPDT\r\n\t           ON PC.RatingPlanAKId=RPDT.RatingPlanAKId and RPDT.CurrentSnapshotFlag=1\r\n\tWHERE EarnedPremiumDailyCalculation.SourceSystemId='DCT'\r\n\tAND EarnedPremiumDailyCalculation.RunDate>=@Date1 and EarnedPremiumDailyCalculation.RunDate<=getdate()\r\n\tAND EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID%@{pipeline().parameters.NO_OF_PARTITIONS}=0\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\r\n\t\r\n\tUNION ALL\r\n\t\r\n\t-- PMS\r\n\t\r\n\tSELECT EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID, \r\n\tEarnedPremiumDailyCalculation.SourceSystemID,\r\n\tEarnedPremiumDailyCalculation.PolicyAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.ReinsuranceCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAKID,\r\n\tEarnedPremiumDailyCalculation.BureauStatisticalCodeAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PolicyExpirationDate, \r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageCancellationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEnteredDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionExpirationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionBookedDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionCode, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAmount, \r\n\tEarnedPremiumDailyCalculation.FullTermPremium, \r\n\tEarnedPremiumDailyCalculation.PremiumType, \r\n\tEarnedPremiumDailyCalculation.ReasonAmendedCode, \r\n\tEarnedPremiumDailyCalculation.EarnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInEarnedPremium, \r\n\tEarnedPremiumDailyCalculation.UnearnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInUnearnedPremium,\r\n\tisnull(PRODUCT.ProductCode, '000') as ProductCode, \r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.SubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.NonSubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineProductCode,\r\n\tIsnull(InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessCode, '000') as LineOfBusinessCode, \r\n\tIsnull(PolicyOffering.PolicyOfferingCode, '000') as PolicyOfferingCode, \r\n\tEarnedPremiumDailyCalculation.RunDate, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageAKId, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageEffectiveDate,\r\n\tEarnedPremiumDailyCalculation.RatingCoverageExpirationDate,\r\n\tRiskLocation.RiskLocationHashKey, \r\n\tEnterpriseGroup.EnterpriseGroupCode, \r\n\tInsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityCode,\r\n\tStrategicProfitCenter.StrategicProfitCenterCode, \r\n\tInsuranceSegment.InsuranceSegmentCode,\r\n\tSC.RiskUnitGroup, \r\n\tSC.RiskUnit, \r\n\tSC.RiskUnitSequenceNumber, \r\n\tSC.MajorPerilCode, \r\n\tSC.ClassCode, \r\n\t'N/A' as RiskType, \r\n\t'N/A' as CoverageType, \r\n\tSIL.StandardInsuranceLineCode, \r\n\tPC.TypeBureauCode,\r\n\t'N/A' as PerilGroup,\r\n\t'N/A' as SubCoverageTypeCode,\r\n\t'N/A' as CoverageVersion,\r\n\tPC.CustomerCareCommissionRate,\r\n\tRPDT.RatingPlanCode,\r\n\tPC.PolicyCoverageEffectiveDate,\r\n\tPC.PolicyCoverageExpirationDate\r\n\tFROM\r\n\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.EarnedPremiumDailyCalculation\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation\r\n\tON EarnedPremiumDailyCalculation.RiskLocationAKID=RiskLocation.RiskLocationAKID\r\n\tand EarnedPremiumDailyCalculation.SourceSystemID='PMS' \r\n\tand RiskLocation.SourceSystemID='PMS'\r\n\tAND RiskLocation.CurrentSnapshotFlag=1\r\n\t\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy\r\n\tON EarnedPremiumDailyCalculation.PolicyAKID=policy.pol_ak_id\r\n\tand policy.source_sys_id='PMS'\r\n\tAND policy.crrnt_snpsht_flag=1\r\n\t\r\n\tINNER JOIN StatisticalCoverage SC\r\n\t             ON EarnedPremiumDailyCalculation.StatisticalCoverageAKID=SC.StatisticalCoverageAKID\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\t             ON EarnedPremiumDailyCalculation.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\t\t\t\t and PC.SourceSystemID='PMS'\r\n\t             AND PC.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line SIL\r\n\t          ON SIL.ins_line_code=PC.InsuranceLine\r\n\t          AND SIL.crrnt_snpsht_flag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product \r\n\ton EarnedPremiumDailyCalculation.SourceSystemID='PMS' and SC.ProductAKID=Product.ProductAKID and Product.CurrentSnapshotFlag=1 \r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLineOfBusiness \r\n\tOn EarnedPremiumDailyCalculation.SourceSystemID='PMS' and SC.InsuranceReferenceLineOfBusinessAKID=InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessAKId and InsuranceReferenceLineOfBusiness.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyOffering\r\n\tOn PolicyOffering.PolicyOfferingAKID=policy.PolicyOfferingAKID and PolicyOffering.CurrentSnapshotFlag=1\r\n\t\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter\r\n\tON policy.StrategicProfitCenterAKId=StrategicProfitCenter.StrategicProfitCenterAKId\r\n\tAND StrategicProfitCenter.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment\r\n\tON InsuranceSegment.InsuranceSegmentAKId=policy.InsuranceSegmentAKId\r\n\tAND InsuranceSegment.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.EnterpriseGroup\r\n\tON EnterpriseGroup.EnterpriseGroupId=StrategicProfitCenter.EnterpriseGroupId\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLegalEntity\r\n\tON InsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityId=StrategicProfitCenter.InsuranceReferenceLegalEntityId \r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingPlan RPDT\r\n\t           ON PC.RatingPlanAKId=RPDT.RatingPlanAKId and RPDT.CurrentSnapshotFlag=1\r\n\tWHERE EarnedPremiumDailyCalculation.SourceSystemId='PMS'\r\n\tAND EarnedPremiumDailyCalculation.RunDate>=@Date1 and EarnedPremiumDailyCalculation.RunDate<=getdate()\r\n\tAND EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID%@{pipeline().parameters.NO_OF_PARTITIONS}=0\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\r\n\t\r\n\t\r\n\t-- DATEADD(MS, -DATEPART(MS,EarnedPremiumDailyCalculation.RunDate), EarnedPremiumDailyCalculation.RunDate)=DATEADD(SS,-1,CAST(FLOOR(CAST--(DATEADD(dd,-@{pipeline().parameters.NO_OF_DAYS}+1,GETDATE()) as float)) as datetime))\n\t\n\tUNION ALL\n\tDeclare @Date1 as date\r\n\t\r\n\tset @Date1=dateadd(dd,-@{pipeline().parameters.NO_OF_DAYS},cast(getdate() as date))\r\n\t\r\n\t\r\n\tSELECT EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID, \r\n\tEarnedPremiumDailyCalculation.SourceSystemID,\r\n\tEarnedPremiumDailyCalculation.PolicyAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.ReinsuranceCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAKID,\r\n\tEarnedPremiumDailyCalculation.BureauStatisticalCodeAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PolicyExpirationDate, \r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageCancellationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEnteredDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionExpirationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionBookedDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionCode, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAmount, \r\n\tEarnedPremiumDailyCalculation.FullTermPremium, \r\n\tEarnedPremiumDailyCalculation.PremiumType, \r\n\tEarnedPremiumDailyCalculation.ReasonAmendedCode, \r\n\tEarnedPremiumDailyCalculation.EarnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInEarnedPremium, \r\n\tEarnedPremiumDailyCalculation.UnearnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInUnearnedPremium,\r\n\tisnull(PRODUCT.ProductCode, '000') as ProductCode, \r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.SubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.NonSubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineProductCode,\r\n\tIsnull(InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessCode, '000') as LineOfBusinessCode, \r\n\tIsnull(PolicyOffering.PolicyOfferingCode, '000') as PolicyOfferingCode, \r\n\tEarnedPremiumDailyCalculation.RunDate, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageAKId, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageEffectiveDate,\r\n\tEarnedPremiumDailyCalculation.RatingCoverageExpirationDate,\r\n\tRiskLocation.RiskLocationHashKey, \r\n\tEnterpriseGroup.EnterpriseGroupCode, \r\n\tInsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityCode,\r\n\tStrategicProfitCenter.StrategicProfitCenterCode, \r\n\tInsuranceSegment.InsuranceSegmentCode,\r\n\t'N/A' as RiskUnitGroup, \r\n\t'N/A' as RiskUnit, \r\n\t'N/A' as RiskUnitSequenceNumber, \r\n\t'N/A' as MajorPerilCode, \r\n\tRC.ClassCode, \r\n\tRC.RiskType, \r\n\tRC.CoverageType, \r\n\tSIL.StandardInsuranceLineCode, \r\n\tPC.TypeBureauCode,\r\n\tRC.PerilGroup,\r\n\tRC.SubCoverageTypeCode,\r\n\tRC.CoverageVersion,\r\n\tPC.CustomerCareCommissionRate,\r\n\tRPDT.RatingPlanCode,\r\n\tPC.PolicyCoverageEffectiveDate,\r\n\tPC.PolicyCoverageExpirationDate\r\n\tFROM\r\n\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.EarnedPremiumDailyCalculation\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation\r\n\tON EarnedPremiumDailyCalculation.RiskLocationAKID=RiskLocation.RiskLocationAKID\r\n\tand EarnedPremiumDailyCalculation.SourceSystemID='DCT' \r\n\tand RiskLocation.SourceSystemID='DCT'\r\n\tAND RiskLocation.CurrentSnapshotFlag=1\r\n\t\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy\r\n\tON EarnedPremiumDailyCalculation.PolicyAKID=policy.pol_ak_id\r\n\tand policy.source_sys_id='DCT'\r\n\tAND policy.crrnt_snpsht_flag=1\r\n\t\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage RC\r\n\t             ON EarnedPremiumDailyCalculation.RatingCoverageAKID=RC.RatingCoverageAKId \r\n\t\t\tAND EarnedPremiumDailyCalculation.PremiumTransactionEnteredDate between RC.EffectiveDate and RC.ExpirationDate\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\t             ON EarnedPremiumDailyCalculation.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\t\t\t\t and PC.SourceSystemID='DCT' \r\n\t             AND PC.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line SIL\r\n\t          ON SIL.ins_line_code=PC.InsuranceLine\r\n\t          AND SIL.crrnt_snpsht_flag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product \r\n\ton EarnedPremiumDailyCalculation.SourceSystemID='DCT' and RC.ProductAKID=Product.ProductAKID and Product.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLineOfBusiness \r\n\tOn EarnedPremiumDailyCalculation.SourceSystemID='DCT' and RC.InsuranceReferenceLineOfBusinessAKID=InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessAKId and InsuranceReferenceLineOfBusiness.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyOffering\r\n\tOn PolicyOffering.PolicyOfferingAKID=policy.PolicyOfferingAKID and PolicyOffering.CurrentSnapshotFlag=1\r\n\t\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter\r\n\tON policy.StrategicProfitCenterAKId=StrategicProfitCenter.StrategicProfitCenterAKId\r\n\tAND StrategicProfitCenter.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment\r\n\tON InsuranceSegment.InsuranceSegmentAKId=policy.InsuranceSegmentAKId\r\n\tAND InsuranceSegment.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.EnterpriseGroup\r\n\tON EnterpriseGroup.EnterpriseGroupId=StrategicProfitCenter.EnterpriseGroupId\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLegalEntity\r\n\tON InsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityId=StrategicProfitCenter.InsuranceReferenceLegalEntityId \r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingPlan RPDT\r\n\t           ON PC.RatingPlanAKId=RPDT.RatingPlanAKId and RPDT.CurrentSnapshotFlag=1\r\n\tWHERE EarnedPremiumDailyCalculation.SourceSystemId='DCT'\r\n\tAND EarnedPremiumDailyCalculation.RunDate>=@Date1 and EarnedPremiumDailyCalculation.RunDate<=getdate()\r\n\tAND EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID%@{pipeline().parameters.NO_OF_PARTITIONS}=1\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\r\n\t\r\n\tUNION ALL\r\n\t\r\n\t-- PMS\r\n\t\r\n\tSELECT EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID, \r\n\tEarnedPremiumDailyCalculation.SourceSystemID,\r\n\tEarnedPremiumDailyCalculation.PolicyAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.ReinsuranceCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAKID,\r\n\tEarnedPremiumDailyCalculation.BureauStatisticalCodeAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PolicyExpirationDate, \r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageCancellationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEnteredDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionExpirationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionBookedDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionCode, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAmount, \r\n\tEarnedPremiumDailyCalculation.FullTermPremium, \r\n\tEarnedPremiumDailyCalculation.PremiumType, \r\n\tEarnedPremiumDailyCalculation.ReasonAmendedCode, \r\n\tEarnedPremiumDailyCalculation.EarnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInEarnedPremium, \r\n\tEarnedPremiumDailyCalculation.UnearnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInUnearnedPremium,\r\n\tisnull(PRODUCT.ProductCode, '000') as ProductCode, \r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.SubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.NonSubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineProductCode,\r\n\tIsnull(InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessCode, '000') as LineOfBusinessCode, \r\n\tIsnull(PolicyOffering.PolicyOfferingCode, '000') as PolicyOfferingCode, \r\n\tEarnedPremiumDailyCalculation.RunDate, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageAKId, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageEffectiveDate,\r\n\tEarnedPremiumDailyCalculation.RatingCoverageExpirationDate,\r\n\tRiskLocation.RiskLocationHashKey, \r\n\tEnterpriseGroup.EnterpriseGroupCode, \r\n\tInsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityCode,\r\n\tStrategicProfitCenter.StrategicProfitCenterCode, \r\n\tInsuranceSegment.InsuranceSegmentCode,\r\n\tSC.RiskUnitGroup, \r\n\tSC.RiskUnit, \r\n\tSC.RiskUnitSequenceNumber, \r\n\tSC.MajorPerilCode, \r\n\tSC.ClassCode, \r\n\t'N/A' as RiskType, \r\n\t'N/A' as CoverageType, \r\n\tSIL.StandardInsuranceLineCode, \r\n\tPC.TypeBureauCode,\r\n\t'N/A' as PerilGroup,\r\n\t'N/A' as SubCoverageTypeCode,\r\n\t'N/A' as CoverageVersion,\r\n\tPC.CustomerCareCommissionRate,\r\n\tRPDT.RatingPlanCode,\r\n\tPC.PolicyCoverageEffectiveDate,\r\n\tPC.PolicyCoverageExpirationDate\r\n\tFROM\r\n\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.EarnedPremiumDailyCalculation\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation\r\n\tON EarnedPremiumDailyCalculation.RiskLocationAKID=RiskLocation.RiskLocationAKID\r\n\tand EarnedPremiumDailyCalculation.SourceSystemID='PMS' \r\n\tand RiskLocation.SourceSystemID='PMS'\r\n\tAND RiskLocation.CurrentSnapshotFlag=1\r\n\t\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy\r\n\tON EarnedPremiumDailyCalculation.PolicyAKID=policy.pol_ak_id\r\n\tand policy.source_sys_id='PMS'\r\n\tAND policy.crrnt_snpsht_flag=1\r\n\t\r\n\tINNER JOIN StatisticalCoverage SC\r\n\t             ON EarnedPremiumDailyCalculation.StatisticalCoverageAKID=SC.StatisticalCoverageAKID\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\t             ON EarnedPremiumDailyCalculation.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\t\t\t\t and PC.SourceSystemID='PMS'\r\n\t             AND PC.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line SIL\r\n\t          ON SIL.ins_line_code=PC.InsuranceLine\r\n\t          AND SIL.crrnt_snpsht_flag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product \r\n\ton EarnedPremiumDailyCalculation.SourceSystemID='PMS' and SC.ProductAKID=Product.ProductAKID and Product.CurrentSnapshotFlag=1 \r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLineOfBusiness \r\n\tOn EarnedPremiumDailyCalculation.SourceSystemID='PMS' and SC.InsuranceReferenceLineOfBusinessAKID=InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessAKId and InsuranceReferenceLineOfBusiness.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyOffering\r\n\tOn PolicyOffering.PolicyOfferingAKID=policy.PolicyOfferingAKID and PolicyOffering.CurrentSnapshotFlag=1\r\n\t\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter\r\n\tON policy.StrategicProfitCenterAKId=StrategicProfitCenter.StrategicProfitCenterAKId\r\n\tAND StrategicProfitCenter.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment\r\n\tON InsuranceSegment.InsuranceSegmentAKId=policy.InsuranceSegmentAKId\r\n\tAND InsuranceSegment.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.EnterpriseGroup\r\n\tON EnterpriseGroup.EnterpriseGroupId=StrategicProfitCenter.EnterpriseGroupId\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLegalEntity\r\n\tON InsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityId=StrategicProfitCenter.InsuranceReferenceLegalEntityId \r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingPlan RPDT\r\n\t           ON PC.RatingPlanAKId=RPDT.RatingPlanAKId and RPDT.CurrentSnapshotFlag=1\r\n\tWHERE EarnedPremiumDailyCalculation.SourceSystemId='PMS'\r\n\tAND EarnedPremiumDailyCalculation.RunDate>=@Date1 and EarnedPremiumDailyCalculation.RunDate<=getdate()\r\n\tAND EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID%@{pipeline().parameters.NO_OF_PARTITIONS}=1\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\r\n\t\r\n\t\r\n\t-- DATEADD(MS, -DATEPART(MS,EarnedPremiumDailyCalculation.RunDate), EarnedPremiumDailyCalculation.RunDate)=DATEADD(SS,-1,CAST(FLOOR(CAST--(DATEADD(dd,-@{pipeline().parameters.NO_OF_DAYS}+1,GETDATE()) as float)) as datetime))\n\t\n\tUNION ALL\n\tDeclare @Date1 as date\r\n\t\r\n\tset @Date1=dateadd(dd,-@{pipeline().parameters.NO_OF_DAYS},cast(getdate() as date))\r\n\t\r\n\t\r\n\tSELECT EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID, \r\n\tEarnedPremiumDailyCalculation.SourceSystemID,\r\n\tEarnedPremiumDailyCalculation.PolicyAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.ReinsuranceCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAKID,\r\n\tEarnedPremiumDailyCalculation.BureauStatisticalCodeAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PolicyExpirationDate, \r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageCancellationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEnteredDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionExpirationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionBookedDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionCode, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAmount, \r\n\tEarnedPremiumDailyCalculation.FullTermPremium, \r\n\tEarnedPremiumDailyCalculation.PremiumType, \r\n\tEarnedPremiumDailyCalculation.ReasonAmendedCode, \r\n\tEarnedPremiumDailyCalculation.EarnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInEarnedPremium, \r\n\tEarnedPremiumDailyCalculation.UnearnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInUnearnedPremium,\r\n\tisnull(PRODUCT.ProductCode, '000') as ProductCode, \r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.SubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.NonSubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineProductCode,\r\n\tIsnull(InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessCode, '000') as LineOfBusinessCode, \r\n\tIsnull(PolicyOffering.PolicyOfferingCode, '000') as PolicyOfferingCode, \r\n\tEarnedPremiumDailyCalculation.RunDate, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageAKId, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageEffectiveDate,\r\n\tEarnedPremiumDailyCalculation.RatingCoverageExpirationDate,\r\n\tRiskLocation.RiskLocationHashKey, \r\n\tEnterpriseGroup.EnterpriseGroupCode, \r\n\tInsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityCode,\r\n\tStrategicProfitCenter.StrategicProfitCenterCode, \r\n\tInsuranceSegment.InsuranceSegmentCode,\r\n\t'N/A' as RiskUnitGroup, \r\n\t'N/A' as RiskUnit, \r\n\t'N/A' as RiskUnitSequenceNumber, \r\n\t'N/A' as MajorPerilCode, \r\n\tRC.ClassCode, \r\n\tRC.RiskType, \r\n\tRC.CoverageType, \r\n\tSIL.StandardInsuranceLineCode, \r\n\tPC.TypeBureauCode,\r\n\tRC.PerilGroup,\r\n\tRC.SubCoverageTypeCode,\r\n\tRC.CoverageVersion,\r\n\tPC.CustomerCareCommissionRate,\r\n\tRPDT.RatingPlanCode,\r\n\tPC.PolicyCoverageEffectiveDate,\r\n\tPC.PolicyCoverageExpirationDate\r\n\tFROM\r\n\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.EarnedPremiumDailyCalculation\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation\r\n\tON EarnedPremiumDailyCalculation.RiskLocationAKID=RiskLocation.RiskLocationAKID\r\n\tand EarnedPremiumDailyCalculation.SourceSystemID='DCT' \r\n\tand RiskLocation.SourceSystemID='DCT'\r\n\tAND RiskLocation.CurrentSnapshotFlag=1\r\n\t\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy\r\n\tON EarnedPremiumDailyCalculation.PolicyAKID=policy.pol_ak_id\r\n\tand policy.source_sys_id='DCT'\r\n\tAND policy.crrnt_snpsht_flag=1\r\n\t\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage RC\r\n\t             ON EarnedPremiumDailyCalculation.RatingCoverageAKID=RC.RatingCoverageAKId \r\n\t\t\tAND EarnedPremiumDailyCalculation.PremiumTransactionEnteredDate between RC.EffectiveDate and RC.ExpirationDate\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\t             ON EarnedPremiumDailyCalculation.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\t\t\t\t and PC.SourceSystemID='DCT' \r\n\t             AND PC.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line SIL\r\n\t          ON SIL.ins_line_code=PC.InsuranceLine\r\n\t          AND SIL.crrnt_snpsht_flag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product \r\n\ton EarnedPremiumDailyCalculation.SourceSystemID='DCT' and RC.ProductAKID=Product.ProductAKID and Product.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLineOfBusiness \r\n\tOn EarnedPremiumDailyCalculation.SourceSystemID='DCT' and RC.InsuranceReferenceLineOfBusinessAKID=InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessAKId and InsuranceReferenceLineOfBusiness.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyOffering\r\n\tOn PolicyOffering.PolicyOfferingAKID=policy.PolicyOfferingAKID and PolicyOffering.CurrentSnapshotFlag=1\r\n\t\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter\r\n\tON policy.StrategicProfitCenterAKId=StrategicProfitCenter.StrategicProfitCenterAKId\r\n\tAND StrategicProfitCenter.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment\r\n\tON InsuranceSegment.InsuranceSegmentAKId=policy.InsuranceSegmentAKId\r\n\tAND InsuranceSegment.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.EnterpriseGroup\r\n\tON EnterpriseGroup.EnterpriseGroupId=StrategicProfitCenter.EnterpriseGroupId\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLegalEntity\r\n\tON InsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityId=StrategicProfitCenter.InsuranceReferenceLegalEntityId \r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingPlan RPDT\r\n\t           ON PC.RatingPlanAKId=RPDT.RatingPlanAKId and RPDT.CurrentSnapshotFlag=1\r\n\tWHERE EarnedPremiumDailyCalculation.SourceSystemId='DCT'\r\n\tAND EarnedPremiumDailyCalculation.RunDate>=@Date1 and EarnedPremiumDailyCalculation.RunDate<=getdate()\r\n\tAND EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID%@{pipeline().parameters.NO_OF_PARTITIONS}=2\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\r\n\t\r\n\tUNION ALL\r\n\t\r\n\t-- PMS\r\n\t\r\n\tSELECT EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID, \r\n\tEarnedPremiumDailyCalculation.SourceSystemID,\r\n\tEarnedPremiumDailyCalculation.PolicyAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.ReinsuranceCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAKID,\r\n\tEarnedPremiumDailyCalculation.BureauStatisticalCodeAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PolicyExpirationDate, \r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageCancellationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEnteredDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionExpirationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionBookedDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionCode, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAmount, \r\n\tEarnedPremiumDailyCalculation.FullTermPremium, \r\n\tEarnedPremiumDailyCalculation.PremiumType, \r\n\tEarnedPremiumDailyCalculation.ReasonAmendedCode, \r\n\tEarnedPremiumDailyCalculation.EarnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInEarnedPremium, \r\n\tEarnedPremiumDailyCalculation.UnearnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInUnearnedPremium,\r\n\tisnull(PRODUCT.ProductCode, '000') as ProductCode, \r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.SubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.NonSubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineProductCode,\r\n\tIsnull(InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessCode, '000') as LineOfBusinessCode, \r\n\tIsnull(PolicyOffering.PolicyOfferingCode, '000') as PolicyOfferingCode, \r\n\tEarnedPremiumDailyCalculation.RunDate, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageAKId, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageEffectiveDate,\r\n\tEarnedPremiumDailyCalculation.RatingCoverageExpirationDate,\r\n\tRiskLocation.RiskLocationHashKey, \r\n\tEnterpriseGroup.EnterpriseGroupCode, \r\n\tInsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityCode,\r\n\tStrategicProfitCenter.StrategicProfitCenterCode, \r\n\tInsuranceSegment.InsuranceSegmentCode,\r\n\tSC.RiskUnitGroup, \r\n\tSC.RiskUnit, \r\n\tSC.RiskUnitSequenceNumber, \r\n\tSC.MajorPerilCode, \r\n\tSC.ClassCode, \r\n\t'N/A' as RiskType, \r\n\t'N/A' as CoverageType, \r\n\tSIL.StandardInsuranceLineCode, \r\n\tPC.TypeBureauCode,\r\n\t'N/A' as PerilGroup,\r\n\t'N/A' as SubCoverageTypeCode,\r\n\t'N/A' as CoverageVersion,\r\n\tPC.CustomerCareCommissionRate,\r\n\tRPDT.RatingPlanCode,\r\n\tPC.PolicyCoverageEffectiveDate,\r\n\tPC.PolicyCoverageExpirationDate\r\n\tFROM\r\n\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.EarnedPremiumDailyCalculation\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation\r\n\tON EarnedPremiumDailyCalculation.RiskLocationAKID=RiskLocation.RiskLocationAKID\r\n\tand EarnedPremiumDailyCalculation.SourceSystemID='PMS' \r\n\tand RiskLocation.SourceSystemID='PMS'\r\n\tAND RiskLocation.CurrentSnapshotFlag=1\r\n\t\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy\r\n\tON EarnedPremiumDailyCalculation.PolicyAKID=policy.pol_ak_id\r\n\tand policy.source_sys_id='PMS'\r\n\tAND policy.crrnt_snpsht_flag=1\r\n\t\r\n\tINNER JOIN StatisticalCoverage SC\r\n\t             ON EarnedPremiumDailyCalculation.StatisticalCoverageAKID=SC.StatisticalCoverageAKID\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\t             ON EarnedPremiumDailyCalculation.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\t\t\t\t and PC.SourceSystemID='PMS'\r\n\t             AND PC.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line SIL\r\n\t          ON SIL.ins_line_code=PC.InsuranceLine\r\n\t          AND SIL.crrnt_snpsht_flag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product \r\n\ton EarnedPremiumDailyCalculation.SourceSystemID='PMS' and SC.ProductAKID=Product.ProductAKID and Product.CurrentSnapshotFlag=1 \r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLineOfBusiness \r\n\tOn EarnedPremiumDailyCalculation.SourceSystemID='PMS' and SC.InsuranceReferenceLineOfBusinessAKID=InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessAKId and InsuranceReferenceLineOfBusiness.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyOffering\r\n\tOn PolicyOffering.PolicyOfferingAKID=policy.PolicyOfferingAKID and PolicyOffering.CurrentSnapshotFlag=1\r\n\t\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter\r\n\tON policy.StrategicProfitCenterAKId=StrategicProfitCenter.StrategicProfitCenterAKId\r\n\tAND StrategicProfitCenter.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment\r\n\tON InsuranceSegment.InsuranceSegmentAKId=policy.InsuranceSegmentAKId\r\n\tAND InsuranceSegment.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.EnterpriseGroup\r\n\tON EnterpriseGroup.EnterpriseGroupId=StrategicProfitCenter.EnterpriseGroupId\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLegalEntity\r\n\tON InsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityId=StrategicProfitCenter.InsuranceReferenceLegalEntityId \r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingPlan RPDT\r\n\t           ON PC.RatingPlanAKId=RPDT.RatingPlanAKId and RPDT.CurrentSnapshotFlag=1\r\n\tWHERE EarnedPremiumDailyCalculation.SourceSystemId='PMS'\r\n\tAND EarnedPremiumDailyCalculation.RunDate>=@Date1 and EarnedPremiumDailyCalculation.RunDate<=getdate()\r\n\tAND EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID%@{pipeline().parameters.NO_OF_PARTITIONS}=2\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n\t\n\tUNION ALL\n\tDeclare @Date1 as date\r\n\t\r\n\tset @Date1=dateadd(dd,-@{pipeline().parameters.NO_OF_DAYS},cast(getdate() as date))\r\n\t\r\n\t\r\n\tSELECT EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID, \r\n\tEarnedPremiumDailyCalculation.SourceSystemID,\r\n\tEarnedPremiumDailyCalculation.PolicyAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.ReinsuranceCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAKID,\r\n\tEarnedPremiumDailyCalculation.BureauStatisticalCodeAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PolicyExpirationDate, \r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageCancellationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEnteredDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionExpirationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionBookedDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionCode, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAmount, \r\n\tEarnedPremiumDailyCalculation.FullTermPremium, \r\n\tEarnedPremiumDailyCalculation.PremiumType, \r\n\tEarnedPremiumDailyCalculation.ReasonAmendedCode, \r\n\tEarnedPremiumDailyCalculation.EarnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInEarnedPremium, \r\n\tEarnedPremiumDailyCalculation.UnearnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInUnearnedPremium,\r\n\tisnull(PRODUCT.ProductCode, '000') as ProductCode, \r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.SubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.NonSubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineProductCode,\r\n\tIsnull(InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessCode, '000') as LineOfBusinessCode, \r\n\tIsnull(PolicyOffering.PolicyOfferingCode, '000') as PolicyOfferingCode, \r\n\tEarnedPremiumDailyCalculation.RunDate, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageAKId, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageEffectiveDate,\r\n\tEarnedPremiumDailyCalculation.RatingCoverageExpirationDate,\r\n\tRiskLocation.RiskLocationHashKey, \r\n\tEnterpriseGroup.EnterpriseGroupCode, \r\n\tInsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityCode,\r\n\tStrategicProfitCenter.StrategicProfitCenterCode, \r\n\tInsuranceSegment.InsuranceSegmentCode,\r\n\t'N/A' as RiskUnitGroup, \r\n\t'N/A' as RiskUnit, \r\n\t'N/A' as RiskUnitSequenceNumber, \r\n\t'N/A' as MajorPerilCode, \r\n\tRC.ClassCode, \r\n\tRC.RiskType, \r\n\tRC.CoverageType, \r\n\tSIL.StandardInsuranceLineCode, \r\n\tPC.TypeBureauCode,\r\n\tRC.PerilGroup,\r\n\tRC.SubCoverageTypeCode,\r\n\tRC.CoverageVersion,\r\n\tPC.CustomerCareCommissionRate,\r\n\tRPDT.RatingPlanCode,\r\n\tPC.PolicyCoverageEffectiveDate,\r\n\tPC.PolicyCoverageExpirationDate\r\n\tFROM\r\n\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.EarnedPremiumDailyCalculation\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation\r\n\tON EarnedPremiumDailyCalculation.RiskLocationAKID=RiskLocation.RiskLocationAKID\r\n\tand EarnedPremiumDailyCalculation.SourceSystemID='DCT' \r\n\tand RiskLocation.SourceSystemID='DCT'\r\n\tAND RiskLocation.CurrentSnapshotFlag=1\r\n\t\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy\r\n\tON EarnedPremiumDailyCalculation.PolicyAKID=policy.pol_ak_id\r\n\tand policy.source_sys_id='DCT'\r\n\tAND policy.crrnt_snpsht_flag=1\r\n\t\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingCoverage RC\r\n\t             ON EarnedPremiumDailyCalculation.RatingCoverageAKID=RC.RatingCoverageAKId \r\n\t\t\tAND EarnedPremiumDailyCalculation.PremiumTransactionEnteredDate between RC.EffectiveDate and RC.ExpirationDate\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\t             ON EarnedPremiumDailyCalculation.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\t\t\t\t and PC.SourceSystemID='DCT' \r\n\t             AND PC.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line SIL\r\n\t          ON SIL.ins_line_code=PC.InsuranceLine\r\n\t          AND SIL.crrnt_snpsht_flag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product \r\n\ton EarnedPremiumDailyCalculation.SourceSystemID='DCT' and RC.ProductAKID=Product.ProductAKID and Product.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLineOfBusiness \r\n\tOn EarnedPremiumDailyCalculation.SourceSystemID='DCT' and RC.InsuranceReferenceLineOfBusinessAKID=InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessAKId and InsuranceReferenceLineOfBusiness.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyOffering\r\n\tOn PolicyOffering.PolicyOfferingAKID=policy.PolicyOfferingAKID and PolicyOffering.CurrentSnapshotFlag=1\r\n\t\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter\r\n\tON policy.StrategicProfitCenterAKId=StrategicProfitCenter.StrategicProfitCenterAKId\r\n\tAND StrategicProfitCenter.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment\r\n\tON InsuranceSegment.InsuranceSegmentAKId=policy.InsuranceSegmentAKId\r\n\tAND InsuranceSegment.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.EnterpriseGroup\r\n\tON EnterpriseGroup.EnterpriseGroupId=StrategicProfitCenter.EnterpriseGroupId\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLegalEntity\r\n\tON InsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityId=StrategicProfitCenter.InsuranceReferenceLegalEntityId \r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingPlan RPDT\r\n\t           ON PC.RatingPlanAKId=RPDT.RatingPlanAKId and RPDT.CurrentSnapshotFlag=1\r\n\tWHERE EarnedPremiumDailyCalculation.SourceSystemId='DCT'\r\n\tAND EarnedPremiumDailyCalculation.RunDate>=@Date1 and EarnedPremiumDailyCalculation.RunDate<=getdate()\r\n\tAND EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID%@{pipeline().parameters.NO_OF_PARTITIONS}=3\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\r\n\t\r\n\tUNION ALL\r\n\t\r\n\t-- PMS\r\n\t\r\n\tSELECT EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID, \r\n\tEarnedPremiumDailyCalculation.SourceSystemID,\r\n\tEarnedPremiumDailyCalculation.PolicyAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.ReinsuranceCoverageAKID,\r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAKID,\r\n\tEarnedPremiumDailyCalculation.BureauStatisticalCodeAKID, \r\n\tEarnedPremiumDailyCalculation.PolicyEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PolicyExpirationDate, \r\n\tEarnedPremiumDailyCalculation.StatisticalCoverageCancellationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEnteredDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionEffectiveDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionExpirationDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionBookedDate, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionCode, \r\n\tEarnedPremiumDailyCalculation.PremiumTransactionAmount, \r\n\tEarnedPremiumDailyCalculation.FullTermPremium, \r\n\tEarnedPremiumDailyCalculation.PremiumType, \r\n\tEarnedPremiumDailyCalculation.ReasonAmendedCode, \r\n\tEarnedPremiumDailyCalculation.EarnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInEarnedPremium, \r\n\tEarnedPremiumDailyCalculation.UnearnedPremium, \r\n\tEarnedPremiumDailyCalculation.ChangeInUnearnedPremium,\r\n\tisnull(PRODUCT.ProductCode, '000') as ProductCode, \r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.SubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.NonSubAnnualStatementLineCode,\r\n\tEarnedPremiumDailyCalculation.AnnualStatementLineProductCode,\r\n\tIsnull(InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessCode, '000') as LineOfBusinessCode, \r\n\tIsnull(PolicyOffering.PolicyOfferingCode, '000') as PolicyOfferingCode, \r\n\tEarnedPremiumDailyCalculation.RunDate, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageAKId, \r\n\tEarnedPremiumDailyCalculation.RatingCoverageEffectiveDate,\r\n\tEarnedPremiumDailyCalculation.RatingCoverageExpirationDate,\r\n\tRiskLocation.RiskLocationHashKey, \r\n\tEnterpriseGroup.EnterpriseGroupCode, \r\n\tInsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityCode,\r\n\tStrategicProfitCenter.StrategicProfitCenterCode, \r\n\tInsuranceSegment.InsuranceSegmentCode,\r\n\tSC.RiskUnitGroup, \r\n\tSC.RiskUnit, \r\n\tSC.RiskUnitSequenceNumber, \r\n\tSC.MajorPerilCode, \r\n\tSC.ClassCode, \r\n\t'N/A' as RiskType, \r\n\t'N/A' as CoverageType, \r\n\tSIL.StandardInsuranceLineCode, \r\n\tPC.TypeBureauCode,\r\n\t'N/A' as PerilGroup,\r\n\t'N/A' as SubCoverageTypeCode,\r\n\t'N/A' as CoverageVersion,\r\n\tPC.CustomerCareCommissionRate,\r\n\tRPDT.RatingPlanCode,\r\n\tPC.PolicyCoverageEffectiveDate,\r\n\tPC.PolicyCoverageExpirationDate\r\n\tFROM\r\n\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.EarnedPremiumDailyCalculation\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RiskLocation\r\n\tON EarnedPremiumDailyCalculation.RiskLocationAKID=RiskLocation.RiskLocationAKID\r\n\tand EarnedPremiumDailyCalculation.SourceSystemID='PMS' \r\n\tand RiskLocation.SourceSystemID='PMS'\r\n\tAND RiskLocation.CurrentSnapshotFlag=1\r\n\t\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER_V2}.policy\r\n\tON EarnedPremiumDailyCalculation.PolicyAKID=policy.pol_ak_id\r\n\tand policy.source_sys_id='PMS'\r\n\tAND policy.crrnt_snpsht_flag=1\r\n\t\r\n\tINNER JOIN StatisticalCoverage SC\r\n\t             ON EarnedPremiumDailyCalculation.StatisticalCoverageAKID=SC.StatisticalCoverageAKID\r\n\tINNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyCoverage PC\r\n\t             ON EarnedPremiumDailyCalculation.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\t\t\t\t and PC.SourceSystemID='PMS'\r\n\t             AND PC.CurrentSnapshotFlag=1\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.sup_insurance_line SIL\r\n\t          ON SIL.ins_line_code=PC.InsuranceLine\r\n\t          AND SIL.crrnt_snpsht_flag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product \r\n\ton EarnedPremiumDailyCalculation.SourceSystemID='PMS' and SC.ProductAKID=Product.ProductAKID and Product.CurrentSnapshotFlag=1 \r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLineOfBusiness \r\n\tOn EarnedPremiumDailyCalculation.SourceSystemID='PMS' and SC.InsuranceReferenceLineOfBusinessAKID=InsuranceReferenceLineOfBusiness.InsuranceReferenceLineOfBusinessAKId and InsuranceReferenceLineOfBusiness.CurrentSnapshotFlag=1\r\n\t\r\n\tLeft join @{pipeline().parameters.SOURCE_TABLE_OWNER}.PolicyOffering\r\n\tOn PolicyOffering.PolicyOfferingAKID=policy.PolicyOfferingAKID and PolicyOffering.CurrentSnapshotFlag=1\r\n\t\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.StrategicProfitCenter\r\n\tON policy.StrategicProfitCenterAKId=StrategicProfitCenter.StrategicProfitCenterAKId\r\n\tAND StrategicProfitCenter.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceSegment\r\n\tON InsuranceSegment.InsuranceSegmentAKId=policy.InsuranceSegmentAKId\r\n\tAND InsuranceSegment.CurrentSnapshotFlag=1\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.EnterpriseGroup\r\n\tON EnterpriseGroup.EnterpriseGroupId=StrategicProfitCenter.EnterpriseGroupId\r\n\t\r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.InsuranceReferenceLegalEntity\r\n\tON InsuranceReferenceLegalEntity.InsuranceReferenceLegalEntityId=StrategicProfitCenter.InsuranceReferenceLegalEntityId \r\n\tLEFT OUTER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.RatingPlan RPDT\r\n\t           ON PC.RatingPlanAKId=RPDT.RatingPlanAKId and RPDT.CurrentSnapshotFlag=1\r\n\tWHERE EarnedPremiumDailyCalculation.SourceSystemId='PMS'\r\n\tAND EarnedPremiumDailyCalculation.RunDate>=@Date1 and EarnedPremiumDailyCalculation.RunDate<=getdate()\r\n\tAND EarnedPremiumDailyCalculation.EarnedPremiumDailyCalculationID%@{pipeline().parameters.NO_OF_PARTITIONS}=3\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n),\nEXP_EarnedPremiumCalculation_IN AS (\n\tSELECT\n\tEarnedPremiumDailyCalculationID AS EarnedPremiumCalculationID,\n\tSourceSystemID,\n\tPolicyAKID,\n\tPolicyCoverageAKID,\n\tStatisticalCoverageAKID,\n\tReinsuranceCoverageAKID,\n\tBureauStatisticalCodeAKID,\n\tPolicyEffectiveDate,\n\tPolicyExpirationDate,\n\tStatisticalCoverageCancellationDate,\n\tPremiumTransactionEnteredDate,\n\tPremiumTransactionEffectiveDate,\n\tPremiumTransactionExpirationDate,\n\tPremiumTransactionBookedDate,\n\tPremiumTransactionCode,\n\tPremiumTransactionAmount,\n\tFullTermPremium,\n\tPremiumType,\n\tReasonAmendedCode,\n\tEarnedPremium,\n\tChangeInEarnedPremium,\n\tUnearnedPremium,\n\tChangeInUnearnedPremium,\n\tProductCode,\n\tAnnualStatementLineCode,\n\tSubAnnualStatementLineCode,\n\tNonSubAnnualStatementLineCode AS i_NonSubAnnualStatementLineCode,\n\t-- *INF*: IIF(SourceSystemID='DCT','N/A',i_NonSubAnnualStatementLineCode)\n\tIFF(SourceSystemID = 'DCT', 'N/A', i_NonSubAnnualStatementLineCode) AS o_NonSubAnnualStatementLineCode,\n\tAnnualStatementLineProductCode,\n\tLineOfBusinessCode,\n\tPolicyOfferingCode,\n\tRunDate,\n\tRatingCoverageAKId,\n\tRatingCoverageEffectiveDate,\n\tRatingCoverageExpirationDate,\n\t-1 AS PremiumTransactionID,\n\tPremiumTransactionAKID AS PremiumTransactionAKId,\n\t-- *INF*: IIF(PremiumTransactionAKId=-1,\r\n\t-- --Historical records\r\n\t-- :LKP.LKP_COVERAGEDETAILDIM_HIST(StatisticalCoverageAKID),\r\n\t-- --Incremental records\r\n\t-- :LKP.LKP_CoverageDetailDim(PremiumTransactionAKId)\r\n\t-- )\n\tIFF(\n\t    PremiumTransactionAKId = - 1,\n\t    LKP_COVERAGEDETAILDIM_HIST_StatisticalCoverageAKID.CoverageDetailDimId,\n\t    LKP_COVERAGEDETAILDIM_PremiumTransactionAKId.CoverageDetailDimId\n\t) AS v_CoverageDetailDimID,\n\t-- *INF*: IIF(ISNULL(v_CoverageDetailDimID), -1, v_CoverageDetailDimID)\n\tIFF(v_CoverageDetailDimID IS NULL, - 1, v_CoverageDetailDimID) AS CoverageDetailDimID_lkp,\n\tRiskLocationHashKey,\n\tEnterpriseGroupCode AS i_EnterpriseGroupCode,\n\tInsuranceReferenceLegalEntityCode AS i_InsuranceReferenceLegalEntityCode,\n\tStrategicProfitCenterCode AS i_StrategicProfitCenterCode,\n\tInsuranceSegmentCode AS i_InsuranceSegmentCode,\n\t-- *INF*: IIF(NOT ISNULL(i_EnterpriseGroupCode), i_EnterpriseGroupCode, '1')\n\tIFF(i_EnterpriseGroupCode IS NOT NULL, i_EnterpriseGroupCode, '1') AS EnterpriseGroupCode,\n\t-- *INF*: IIF(NOT ISNULL(i_InsuranceReferenceLegalEntityCode), i_InsuranceReferenceLegalEntityCode, '1')\n\tIFF(\n\t    i_InsuranceReferenceLegalEntityCode IS NOT NULL, i_InsuranceReferenceLegalEntityCode, '1'\n\t) AS InsuranceReferenceLegalEntityCode,\n\t-- *INF*: IIF(NOT ISNULL(i_StrategicProfitCenterCode), i_StrategicProfitCenterCode, '6')\n\tIFF(i_StrategicProfitCenterCode IS NOT NULL, i_StrategicProfitCenterCode, '6') AS StrategicProfitCenterCode,\n\t-- *INF*: IIF(NOT ISNULL(i_InsuranceSegmentCode), i_InsuranceSegmentCode, 'N/A')\n\tIFF(i_InsuranceSegmentCode IS NOT NULL, i_InsuranceSegmentCode, 'N/A') AS InsuranceSegmentCode,\n\tRiskUnitGroup AS i_RiskUnitGroup,\n\tRiskUnit AS i_RiskUnit,\n\tRiskUnitSequenceNumber AS i_RiskUnitSequenceNumber,\n\tMajorPerilCode AS i_MajorPerilCode,\n\tClassCode AS i_ClassCode,\n\tRiskType AS i_RiskType,\n\tCoverageType AS i_CoverageType,\n\tStandardInsuranceLineCode AS i_StandardInsuranceLineCode,\n\tTypeBureauCode AS i_TypeBureauCode,\n\tPerilGroup AS i_PerilGroup,\n\tSubCoverageTypeCode AS i_SubCoverageTypeCode,\n\tCoverageVersion AS i_CoverageVersion,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(SUBSTR(i_RiskUnitSequenceNumber,2,1))\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(SUBSTR(i_RiskUnitSequenceNumber, 2, 1)) AS v_ProductTypeCode,\n\t-- *INF*: IIF(REG_MATCH(i_StandardInsuranceLineCode,'[^0-9a-zA-Z]'),'N/A',i_StandardInsuranceLineCode)\n\tIFF(\n\t    REGEXP_LIKE(i_StandardInsuranceLineCode, '[^0-9a-zA-Z]'), 'N/A', i_StandardInsuranceLineCode\n\t) AS v_Reg_StandardInsuranceLineCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_MajorPerilCode)\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_MajorPerilCode) AS v_MajorPerilCode,\n\t-- *INF*: IIF(LTRIM(v_MajorPerilCode,'0')='','N/A',v_MajorPerilCode)\n\tIFF(LTRIM(v_MajorPerilCode, '0') = '', 'N/A', v_MajorPerilCode) AS v_Zero_MajorPerilCode,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_ClassCode)\n\tUDF_DEFAULT_VALUE_FOR_STRINGS(i_ClassCode) AS v_ClassCode,\n\t-- *INF*: IIF(v_Reg_StandardInsuranceLineCode='N/A' AND (IN(i_TypeBureauCode,'AL','AN','AP') OR IN(v_Zero_MajorPerilCode,'930','931')),'CA',v_Reg_StandardInsuranceLineCode)\n\tIFF(\n\t    v_Reg_StandardInsuranceLineCode = 'N/A'\n\t    and (i_TypeBureauCode IN ('AL','AN','AP')\n\t    or v_Zero_MajorPerilCode IN ('930','931')),\n\t    'CA',\n\t    v_Reg_StandardInsuranceLineCode\n\t) AS v_StandardInsuranceLineCode,\n\t-- *INF*: IIF(v_StandardInsuranceLineCode='N/A' AND IN(i_TypeBureauCode,'CF','B2','BB','BE','BF','BM','BT','FT','GL','GS','IM','MS','PF','PH','PI','PL','PQ','WC','WP','NB','RL','RN','RP','BC','N/A'),1,0)\n\tIFF(\n\t    v_StandardInsuranceLineCode = 'N/A'\n\t    and i_TypeBureauCode IN ('CF','B2','BB','BE','BF','BM','BT','FT','GL','GS','IM','MS','PF','PH','PI','PL','PQ','WC','WP','NB','RL','RN','RP','BC','N/A'),\n\t    1,\n\t    0\n\t) AS v_flag,\n\t-- *INF*: IIF(IN(v_StandardInsuranceLineCode,'CR') OR v_flag=1,'N/A',:UDF.DEFAULT_VALUE_FOR_STRINGS(i_RiskUnitGroup))\n\tIFF(\n\t    v_StandardInsuranceLineCode IN ('CR') OR v_flag = 1, 'N/A',\n\t    UDF_DEFAULT_VALUE_FOR_STRINGS(i_RiskUnitGroup)\n\t) AS v_RiskUnitGroup,\n\t-- *INF*: IIF(LTRIM(v_RiskUnitGroup,'0')='','N/A',v_RiskUnitGroup)\n\tIFF(LTRIM(v_RiskUnitGroup, '0') = '', 'N/A', v_RiskUnitGroup) AS v_Zero_RiskUnitGroup,\n\t-- *INF*: IIF( v_flag=1 OR   (v_StandardInsuranceLineCode='GL' AND (NOT IN(v_MajorPerilCode,'540','599','919')    OR NOT IN(v_ClassCode,'11111','22222','22250','92100','17000','17001','17002','80051','80052','80053','80054','80055','80056','80057','80058')))   OR IN(v_StandardInsuranceLineCode,'WC','IM','CG','CA')=1,  'N/A',:UDF.DEFAULT_VALUE_FOR_STRINGS(i_RiskUnit))\n\tIFF(\n\t    v_flag = 1\n\t    or (v_StandardInsuranceLineCode = 'GL'\n\t    and (NOT v_MajorPerilCode IN ('540','599','919')\n\t    or NOT v_ClassCode IN ('11111','22222','22250','92100','17000','17001','17002','80051','80052','80053','80054','80055','80056','80057','80058')))\n\t    or v_StandardInsuranceLineCode IN ('WC','IM','CG','CA') = 1,\n\t    'N/A',\n\t    UDF_DEFAULT_VALUE_FOR_STRINGS(i_RiskUnit)\n\t) AS v_RiskUnit,\n\t-- *INF*: IIF(LTRIM(v_RiskUnit,'0')='','N/A',v_RiskUnit)\n\tIFF(LTRIM(v_RiskUnit, '0') = '', 'N/A', v_RiskUnit) AS v_Zero_RiskUnit,\n\t-- *INF*: IIF(REG_MATCH(v_Zero_RiskUnitGroup,'[^0-9a-zA-Z]'),'N/A',v_Zero_RiskUnitGroup)\n\tIFF(REGEXP_LIKE(v_Zero_RiskUnitGroup, '[^0-9a-zA-Z]'), 'N/A', v_Zero_RiskUnitGroup) AS v_PmsRiskUnitGroupCode,\n\t-- *INF*: IIF(REG_MATCH(v_Zero_RiskUnit,'[^0-9a-zA-Z]'),'N/A',v_Zero_RiskUnit)\n\tIFF(REGEXP_LIKE(v_Zero_RiskUnit, '[^0-9a-zA-Z]'), 'N/A', v_Zero_RiskUnit) AS v_PmsRiskUnitCode,\n\t-- *INF*: SUBSTR(v_PmsRiskUnitCode, 1, 3)\n\tSUBSTR(v_PmsRiskUnitCode, 1, 3) AS v_PmsRiskUnitCode_1_3,\n\t-- *INF*: IIF(SourceSystemID='PMS',v_StandardInsuranceLineCode,i_StandardInsuranceLineCode)\n\tIFF(SourceSystemID = 'PMS', v_StandardInsuranceLineCode, i_StandardInsuranceLineCode) AS v_InsuranceLineCode,\n\t-- *INF*: IIF(REG_MATCH(v_Zero_MajorPerilCode,'[^0-9a-zA-Z]'),'N/A',v_Zero_MajorPerilCode)\n\tIFF(REGEXP_LIKE(v_Zero_MajorPerilCode, '[^0-9a-zA-Z]'), 'N/A', v_Zero_MajorPerilCode) AS v_PmsMajorPerilCode,\n\t-- *INF*: IIF(   REG_MATCH(v_ProductTypeCode,'[^0-9a-zA-Z]') OR v_Reg_StandardInsuranceLineCode<>'GL' OR v_ProductTypeCode='0' OR LENGTH(v_ProductTypeCode)=0,   'N/A',v_ProductTypeCode )\n\tIFF(\n\t    REGEXP_LIKE(v_ProductTypeCode, '[^0-9a-zA-Z]')\n\t    or v_Reg_StandardInsuranceLineCode <> 'GL'\n\t    or v_ProductTypeCode = '0'\n\t    or LENGTH(v_ProductTypeCode) = 0,\n\t    'N/A',\n\t    v_ProductTypeCode\n\t) AS v_PmsProductTypeCode,\n\t-- *INF*: :LKP.LKP_INSURANCEREFERENCECOVERAGEDIM_PMS(v_PmsRiskUnitGroupCode, v_PmsRiskUnitCode, v_PmsMajorPerilCode, v_InsuranceLineCode, v_PmsProductTypeCode)\n\tLKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode.InsuranceReferenceCoverageDimId AS v_InsuranceReferenceCoverageDimId_PMS_1,\n\t-- *INF*: v_InsuranceReferenceCoverageDimId_PMS_1\r\n\t-- \r\n\t-- --IIF(ISNULL(v_InsuranceReferenceCoverageDimId_PMS_1), :LKP.LKP_INSURANCEREFERENCECOVERAGEDIM_PMS(v_PmsRiskUnitGroupCode, v_PmsRiskUnitCode_1_3, v_PmsMajorPerilCode, v_InsuranceLineCode, v_PmsProductTypeCode), v_InsuranceReferenceCoverageDimId_PMS_1)\n\tv_InsuranceReferenceCoverageDimId_PMS_1 AS v_InsuranceReferenceCoverageDimId_PMS_2,\n\t-- *INF*: :LKP.LKP_INSURANCEREFERENCECOVERAGEDIM_DCT(i_RiskType, i_CoverageType, v_InsuranceLineCode, i_PerilGroup,i_SubCoverageTypeCode,i_CoverageVersion)\n\tLKP_INSURANCEREFERENCECOVERAGEDIM_DCT_i_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.InsuranceReferenceCoverageDimId AS v_InsuranceReferenceCoverageDimId_DCT,\n\t-- *INF*: IIF(ISNULL(v_InsuranceReferenceCoverageDimId_PMS_2), -1, v_InsuranceReferenceCoverageDimId_PMS_2)\n\tIFF(\n\t    v_InsuranceReferenceCoverageDimId_PMS_2 IS NULL, - 1,\n\t    v_InsuranceReferenceCoverageDimId_PMS_2\n\t) AS o_InsuranceReferenceCoverageDimId_PMS,\n\t-- *INF*: IIF(ISNULL(v_InsuranceReferenceCoverageDimId_DCT), -1, v_InsuranceReferenceCoverageDimId_DCT)\n\tIFF(\n\t    v_InsuranceReferenceCoverageDimId_DCT IS NULL, - 1, v_InsuranceReferenceCoverageDimId_DCT\n\t) AS o_InsuranceReferenceCoverageDimId_DCT,\n\tCustomerCareCommissionRate,\n\tRatingPlanCode AS i_RatingPlanCode,\n\t-- *INF*: IIF(ISNULL(i_RatingPlanCode), '1', i_RatingPlanCode)\n\tIFF(i_RatingPlanCode IS NULL, '1', i_RatingPlanCode) AS o_RatingPlanCode,\n\tPolicyCoverageEffectiveDate,\n\tPolicyCoverageExpirationDate\n\tFROM SQ_EarnedPremiumDailyCalculation\n\tLEFT JOIN LKP_COVERAGEDETAILDIM_HIST LKP_COVERAGEDETAILDIM_HIST_StatisticalCoverageAKID\n\tON LKP_COVERAGEDETAILDIM_HIST_StatisticalCoverageAKID.StatisticalCoverageAKID = StatisticalCoverageAKID\n\n\tLEFT JOIN LKP_COVERAGEDETAILDIM LKP_COVERAGEDETAILDIM_PremiumTransactionAKId\n\tON LKP_COVERAGEDETAILDIM_PremiumTransactionAKId.PremiumTransactionAKId = PremiumTransactionAKId\n\n\tLEFT JOIN LKP_INSURANCEREFERENCECOVERAGEDIM_PMS LKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode\n\tON LKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode.InsuranceLineCode = v_PmsRiskUnitGroupCode\n\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode.PmsRiskUnitGroupCode = v_PmsRiskUnitCode\n\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode.PmsRiskUnitCode = v_PmsMajorPerilCode\n\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode.PmsMajorPerilCode = v_InsuranceLineCode\n\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_PMS_v_PmsRiskUnitGroupCode_v_PmsRiskUnitCode_v_PmsMajorPerilCode_v_InsuranceLineCode_v_PmsProductTypeCode.PmsProductTypeCode = v_PmsProductTypeCode\n\n\tLEFT JOIN LKP_INSURANCEREFERENCECOVERAGEDIM_DCT LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_i_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion\n\tON LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_i_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.DctRiskTypeCode = i_RiskType\n\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_i_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.DctCoverageTypeCode = i_CoverageType\n\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_i_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.InsuranceLineCode = v_InsuranceLineCode\n\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_i_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.DctPerilGroup = i_PerilGroup\n\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_i_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.DctSubCoverageTypeCode = i_SubCoverageTypeCode\n\tAND LKP_INSURANCEREFERENCECOVERAGEDIM_DCT_i_RiskType_i_CoverageType_v_InsuranceLineCode_i_PerilGroup_i_SubCoverageTypeCode_i_CoverageVersion.DctCoverageVersion = i_CoverageVersion\n\n),\nLKP_InsuranceReferenceDim AS (\n\tSELECT\n\tInsuranceReferenceDimId,\n\tEnterpriseGroupCode,\n\tInsuranceReferenceLegalEntityCode,\n\tStrategicProfitCenterCode,\n\tInsuranceSegmentCode,\n\tPolicyOfferingCode,\n\tProductCode,\n\tInsuranceReferenceLineOfBusinessCode,\n\tRatingPlanCode\n\tFROM (\n\t\tSELECT \n\t\t\tInsuranceReferenceDimId,\n\t\t\tEnterpriseGroupCode,\n\t\t\tInsuranceReferenceLegalEntityCode,\n\t\t\tStrategicProfitCenterCode,\n\t\t\tInsuranceSegmentCode,\n\t\t\tPolicyOfferingCode,\n\t\t\tProductCode,\n\t\t\tInsuranceReferenceLineOfBusinessCode,\n\t\t\tRatingPlanCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.InsuranceReferenceDim\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EnterpriseGroupCode,InsuranceReferenceLegalEntityCode,StrategicProfitCenterCode,InsuranceSegmentCode,PolicyOfferingCode,ProductCode,InsuranceReferenceLineOfBusinessCode,RatingPlanCode ORDER BY InsuranceReferenceDimId) = 1\n),\nLKP_RiskLocationDim AS (\n\tSELECT\n\tRiskLocationDimID,\n\tRiskLocationHashKey\n\tFROM (\n\t\tSELECT \n\t\t\tRiskLocationDimID,\n\t\t\tRiskLocationHashKey\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocationDim\n\t\tWHERE CurrentSnapshotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY RiskLocationHashKey ORDER BY RiskLocationDimID) = 1\n),\nLKP_asl_dim AS (\n\tSELECT\n\tasl_dim_id,\n\tasl_code,\n\tsub_asl_code,\n\tsub_non_asl_code\n\tFROM (\n\t\tSELECT \n\t\t\tasl_dim_id,\n\t\t\tasl_code,\n\t\t\tsub_asl_code,\n\t\t\tsub_non_asl_code\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.asl_dim\n\t\tWHERE crrnt_snpsht_flag='1'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY asl_code,sub_asl_code,sub_non_asl_code ORDER BY asl_dim_id DESC) = 1\n),\nLKP_asl_product_code AS (\n\tSELECT\n\tasl_prdct_code_dim_id,\n\tasl_prdct_code\n\tFROM (\n\t\tSELECT \n\t\t\tasl_prdct_code_dim_id,\n\t\t\tasl_prdct_code\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.asl_product_code_dim\n\t\tWHERE crrnt_snpsht_flag='1'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY asl_prdct_code ORDER BY asl_prdct_code_dim_id DESC) = 1\n),\nLKP_reinsurance_coverage_dim AS (\n\tSELECT\n\treins_cov_dim_id,\n\tedw_reins_cov_ak_id,\n\teff_from_date,\n\teff_to_date\n\tFROM (\n\t\tSELECT \n\t\t\treins_cov_dim_id,\n\t\t\tedw_reins_cov_ak_id,\n\t\t\teff_from_date,\n\t\t\teff_to_date\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.reinsurance_coverage_dim\n\t\tWHERE crrnt_snpsht_flag='1'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_reins_cov_ak_id,eff_from_date,eff_to_date ORDER BY reins_cov_dim_id DESC) = 1\n),\nlkp_PremiumTransactionTypeDim AS (\n\tSELECT\n\tPremiumTransactionTypeDimID,\n\tin_CustomerCareCommissionRate,\n\tPremiumTransactionCode,\n\tReasonAmendedCode,\n\tPremiumTypeCode,\n\tCustomerCareCommissionRate\n\tFROM (\n\t\tSELECT \r\n\t\tPTTD.PremiumTransactionTypeDimID as PremiumTransactionTypeDimID,\r\n\t\tLTRIM(RTRIM(PTTD.PremiumTransactionCode)) as PremiumTransactionCode, \r\n\t\tLTRIM(RTRIM(PTTD.ReasonAmendedCode)) as ReasonAmendedCode, \r\n\t\tLTRIM(RTRIM(PTTD.PremiumTypeCode)) as PremiumTypeCode,\r\n\t\tPTTD.CustomerCareCommissionRate as CustomerCareCommissionRate\r\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransactionTypeDim PTTD\r\n\t\twhere PTTD.CurrentSnapShotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionCode,ReasonAmendedCode,PremiumTypeCode,CustomerCareCommissionRate ORDER BY PremiumTransactionTypeDimID DESC) = 1\n),\nmplt_PolicyDimID_PremiumMaster AS (WITH\n\tInput AS (\n\t\t\n\t),\n\tEXP_Default AS (\n\t\tSELECT\n\t\tIN_PolicyAKID AS PolicyAKID,\n\t\tIN_Trans_Date\n\t\tFROM Input\n\t),\n\tLKP_V2_Policy AS (\n\t\tSELECT\n\t\tcontract_cust_ak_id,\n\t\tagencyakid,\n\t\tpol_status_code,\n\t\tstrtgc_bus_dvsn_ak_id,\n\t\tIN_Trans_Date,\n\t\tpol_ak_id,\n\t\teff_from_date,\n\t\teff_to_date\n\t\tFROM (\n\t\t\tSELECT policy.contract_cust_ak_id as contract_cust_ak_id, policy.agencyakid as agencyakid, policy.pol_status_code as pol_status_code, policy.strtgc_bus_dvsn_ak_id as strtgc_bus_dvsn_ak_id, policy.pol_ak_id as pol_ak_id, policy.eff_from_date as eff_from_date, policy.eff_to_date as eff_to_date FROM \r\n\t\t\tV2.policy\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY pol_ak_id,eff_from_date,eff_to_date ORDER BY contract_cust_ak_id DESC) = 1\n\t),\n\tLKP_PolicyDimID AS (\n\t\tSELECT\n\t\tpol_dim_id,\n\t\tpol_key,\n\t\tpol_eff_date,\n\t\tpol_exp_date,\n\t\tpms_pol_lob_code,\n\t\tClassOfBusinessCode,\n\t\tIN_Trans_Date,\n\t\tedw_pol_ak_id,\n\t\teff_from_date,\n\t\teff_to_date\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tpol_dim_id,\n\t\t\t\tpol_key,\n\t\t\t\tpol_eff_date,\n\t\t\t\tpol_exp_date,\n\t\t\t\tpms_pol_lob_code,\n\t\t\t\tClassOfBusinessCode,\n\t\t\t\tIN_Trans_Date,\n\t\t\t\tedw_pol_ak_id,\n\t\t\t\teff_from_date,\n\t\t\t\teff_to_date\n\t\t\tFROM policy_dim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_pol_ak_id,eff_from_date,eff_to_date ORDER BY pol_dim_id DESC) = 1\n\t),\n\tLKP_V3_AgencyDimID AS (\n\t\tSELECT\n\t\tagency_dim_id,\n\t\tedw_agency_ak_id,\n\t\teff_from_date,\n\t\teff_to_date\n\t\tFROM (\n\t\t\tSELECT AgencyDim.AgencyDimID as agency_dim_id, AgencyDim.EDWAgencyAKID as edw_agency_ak_id, AgencyDim.EffectiveDate as eff_from_date, AgencyDim.ExpirationDate as eff_to_date\r\n\t\t\t FROM V3.AgencyDim as AgencyDim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_agency_ak_id,eff_from_date,eff_to_date ORDER BY agency_dim_id DESC) = 1\n\t),\n\tLKP_ContractCustomerDim AS (\n\t\tSELECT\n\t\tcontract_cust_dim_id,\n\t\tIN_Trans_Date,\n\t\tedw_contract_cust_ak_id,\n\t\teff_from_date,\n\t\teff_to_date\n\t\tFROM (\n\t\t\tSELECT \n\t\t\t\tcontract_cust_dim_id,\n\t\t\t\tIN_Trans_Date,\n\t\t\t\tedw_contract_cust_ak_id,\n\t\t\t\teff_from_date,\n\t\t\t\teff_to_date\n\t\t\tFROM contract_customer_dim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_contract_cust_ak_id,eff_from_date,eff_to_date ORDER BY contract_cust_dim_id DESC) = 1\n\t),\n\tlkp_StrategicBusinessDivisionDIM AS (\n\t\tSELECT\n\t\tstrtgc_bus_dvsn_dim_id,\n\t\tedw_strtgc_bus_dvsn_ak_id\n\t\tFROM (\n\t\t\tSELECT strategic_business_division_dim.strtgc_bus_dvsn_dim_id as strtgc_bus_dvsn_dim_id, strategic_business_division_dim.edw_strtgc_bus_dvsn_ak_id as edw_strtgc_bus_dvsn_ak_id \r\n\t\t\tFROM strategic_business_division_dim\n\t\t)\n\t\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_strtgc_bus_dvsn_ak_id ORDER BY strtgc_bus_dvsn_dim_id DESC) = 1\n\t),\n\tEXP_Values AS (\n\t\tSELECT\n\t\tLKP_V3_AgencyDimID.agency_dim_id,\n\t\tLKP_ContractCustomerDim.contract_cust_dim_id,\n\t\tLKP_PolicyDimID.pol_dim_id,\n\t\tLKP_V2_Policy.pol_status_code,\n\t\tLKP_PolicyDimID.pol_eff_date,\n\t\tLKP_PolicyDimID.pol_exp_date,\n\t\tlkp_StrategicBusinessDivisionDIM.strtgc_bus_dvsn_dim_id,\n\t\tLKP_PolicyDimID.pol_key,\n\t\tLKP_PolicyDimID.pms_pol_lob_code,\n\t\tLKP_PolicyDimID.ClassOfBusinessCode\n\t\tFROM \n\t\tLEFT JOIN LKP_ContractCustomerDim\n\t\tON LKP_ContractCustomerDim.edw_contract_cust_ak_id = LKP_V2_Policy.contract_cust_ak_id AND LKP_ContractCustomerDim.eff_from_date <= EXP_Default.IN_Trans_Date AND LKP_ContractCustomerDim.eff_to_date >= EXP_Default.IN_Trans_Date\n\t\tLEFT JOIN LKP_PolicyDimID\n\t\tON LKP_PolicyDimID.edw_pol_ak_id = EXP_Default.PolicyAKID AND LKP_PolicyDimID.eff_from_date <= EXP_Default.IN_Trans_Date AND LKP_PolicyDimID.eff_to_date >= EXP_Default.IN_Trans_Date\n\t\tLEFT JOIN LKP_V2_Policy\n\t\tON LKP_V2_Policy.pol_ak_id = EXP_Default.PolicyAKID AND LKP_V2_Policy.eff_from_date <= EXP_Default.IN_Trans_Date AND LKP_V2_Policy.eff_to_date >= EXP_Default.IN_Trans_Date\n\t\tLEFT JOIN LKP_V3_AgencyDimID\n\t\tON LKP_V3_AgencyDimID.edw_agency_ak_id = LKP_V2_Policy.agencyakid AND LKP_V3_AgencyDimID.eff_from_date <= EXP_Default.IN_Trans_Date AND LKP_V3_AgencyDimID.eff_to_date >= EXP_Default.IN_Trans_Date\n\t\tLEFT JOIN lkp_StrategicBusinessDivisionDIM\n\t\tON lkp_StrategicBusinessDivisionDIM.edw_strtgc_bus_dvsn_ak_id = LKP_V2_Policy.strtgc_bus_dvsn_ak_id\n\t),\n\tOutput AS (\n\t\tSELECT\n\t\tagency_dim_id, \n\t\tcontract_cust_dim_id, \n\t\tpol_dim_id, \n\t\tpol_status_code, \n\t\tpol_eff_date, \n\t\tpol_exp_date, \n\t\tstrtgc_bus_dvsn_dim_id, \n\t\tpol_key, \n\t\tpms_pol_lob_code, \n\t\tClassOfBusinessCode\n\t\tFROM EXP_Values\n\t),\n),\nEXP_Consolidate_Data_from_Lookups AS (\n\tSELECT\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditID,\n\tmplt_PolicyDimID_PremiumMaster.agency_dim_id AS AgencyDimID,\n\t-- *INF*: IIF(NOT ISNULL(AgencyDimID),AgencyDimID,-1)\n\tIFF(AgencyDimID IS NOT NULL, AgencyDimID, - 1) AS AgencyDimID_out,\n\tmplt_PolicyDimID_PremiumMaster.pol_dim_id AS PolicyDimID,\n\tmplt_PolicyDimID_PremiumMaster.pol_status_code,\n\t-- *INF*: IIF(NOT ISNULL(PolicyDimID),PolicyDimID,-1)\n\tIFF(PolicyDimID IS NOT NULL, PolicyDimID, - 1) AS PolicyDimID_out,\n\tmplt_PolicyDimID_PremiumMaster.contract_cust_dim_id AS ContractCustomerDimID,\n\t-- *INF*: IIF(NOT ISNULL(ContractCustomerDimID),ContractCustomerDimID,-1)\n\tIFF(ContractCustomerDimID IS NOT NULL, ContractCustomerDimID, - 1) AS ContractCustomerDimID_out,\n\tLKP_RiskLocationDim.RiskLocationDimID,\n\t-- *INF*: IIF(NOT ISNULL(RiskLocationDimID),RiskLocationDimID,-1)\n\tIFF(RiskLocationDimID IS NOT NULL, RiskLocationDimID, - 1) AS RiskLocationDimID_out,\n\tLKP_reinsurance_coverage_dim.reins_cov_dim_id AS ReinsuranceCoverageDimID,\n\t-- *INF*: IIF(NOT ISNULL(ReinsuranceCoverageDimID),ReinsuranceCoverageDimID,-1)\n\tIFF(ReinsuranceCoverageDimID IS NOT NULL, ReinsuranceCoverageDimID, - 1) AS ReinsuranceCoverageDimID_out,\n\tlkp_PremiumTransactionTypeDim.PremiumTransactionTypeDimID,\n\t-- *INF*: IIF(NOT ISNULL(PremiumTransactionTypeDimID),PremiumTransactionTypeDimID,-1)\n\tIFF(PremiumTransactionTypeDimID IS NOT NULL, PremiumTransactionTypeDimID, - 1) AS PremiumTransactionTypeDimID_out,\n\tEXP_EarnedPremiumCalculation_IN.PremiumTransactionID AS EDWPremiumTransactionPKID,\n\t-- *INF*: IIF(NOT ISNULL(EDWPremiumTransactionPKID),EDWPremiumTransactionPKID,-1)\n\tIFF(EDWPremiumTransactionPKID IS NOT NULL, EDWPremiumTransactionPKID, - 1) AS EDWPremiumTransactionPKID_out,\n\tEXP_EarnedPremiumCalculation_IN.PremiumTransactionAmount,\n\tEXP_EarnedPremiumCalculation_IN.FullTermPremium,\n\tEXP_EarnedPremiumCalculation_IN.EarnedPremium,\n\tEXP_EarnedPremiumCalculation_IN.ChangeInEarnedPremium,\n\tEXP_EarnedPremiumCalculation_IN.UnearnedPremium,\n\tEXP_EarnedPremiumCalculation_IN.ChangeInUnearnedPremium,\n\tEXP_EarnedPremiumCalculation_IN.PremiumTransactionBookedDate,\n\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PremiumTransactionBookedDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\tLKP_CALENDER_DIM_to_date_to_char_PremiumTransactionBookedDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PremiumTransactionBookedDateID,\n\t-- *INF*: IIF(NOT ISNULL(v_PremiumTransactionBookedDateID),v_PremiumTransactionBookedDateID,-1)\n\tIFF(v_PremiumTransactionBookedDateID IS NOT NULL, v_PremiumTransactionBookedDateID, - 1) AS PremiumTransactionBookedDateID_out,\n\tEXP_EarnedPremiumCalculation_IN.RunDate AS PremiumTransactionRunDate,\n\t-- *INF*: IIF((PremiumTransactionBookedDate<=LAST_DAY(PremiumTransactionRunDate)) AND (PremiumTransactionBookedDate>=\r\n\t-- SET_DATE_PART(SET_DATE_PART(SET_DATE_PART(SET_DATE_PART( PremiumTransactionRunDate, 'DD', 1 ),'HH',0),'MI',0),'SS',0)),'Y','N')\n\tIFF(\n\t    (PremiumTransactionBookedDate <= LAST_DAY(PremiumTransactionRunDate))\n\t    and (PremiumTransactionBookedDate >= DATEADD(SECOND,0-DATE_PART(SECOND,DATEADD(MINUTE,0-DATE_PART(MINUTE,DATEADD(HOUR,0-DATE_PART(HOUR,DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate)),DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate))),DATEADD(HOUR,0-DATE_PART(HOUR,DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate)),DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate)))),DATEADD(MINUTE,0-DATE_PART(MINUTE,DATEADD(HOUR,0-DATE_PART(HOUR,DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate)),DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate))),DATEADD(HOUR,0-DATE_PART(HOUR,DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate)),DATEADD(DAY,1-DATE_PART(DAY,PremiumTransactionRunDate),PremiumTransactionRunDate))))),\n\t    'Y',\n\t    'N'\n\t) AS DateFlagForWittenPremium,\n\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PremiumTransactionRunDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\tLKP_CALENDER_DIM_to_date_to_char_PremiumTransactionRunDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PremiumTransactionRunDateID,\n\t-- *INF*: IIF(NOT ISNULL(v_PremiumTransactionRunDateID),v_PremiumTransactionRunDateID,-1)\n\tIFF(v_PremiumTransactionRunDateID IS NOT NULL, v_PremiumTransactionRunDateID, - 1) AS PremiumTransactionRunDateID_out,\n\tEXP_EarnedPremiumCalculation_IN.PolicyCoverageEffectiveDate,\n\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PolicyCoverageEffectiveDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\tLKP_CALENDER_DIM_to_date_to_char_PolicyCoverageEffectiveDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PolicyCoverageEffectiveDateID,\n\t-- *INF*: IIF(NOT ISNULL(v_PolicyCoverageEffectiveDateID),v_PolicyCoverageEffectiveDateID,-1)\n\tIFF(v_PolicyCoverageEffectiveDateID IS NOT NULL, v_PolicyCoverageEffectiveDateID, - 1) AS PolicyCoverageEffectiveDateID_out,\n\tEXP_EarnedPremiumCalculation_IN.PolicyCoverageExpirationDate,\n\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PolicyCoverageExpirationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\tLKP_CALENDER_DIM_to_date_to_char_PolicyCoverageExpirationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PolicyCoverageExpirationDateID,\n\t-- *INF*: IIF(NOT ISNULL(v_PolicyCoverageExpirationDateID),v_PolicyCoverageExpirationDateID,-1)\n\tIFF(v_PolicyCoverageExpirationDateID IS NOT NULL, v_PolicyCoverageExpirationDateID, - 1) AS PolicyCoverageExpirationDateID_out,\n\tEXP_EarnedPremiumCalculation_IN.PremiumTransactionEnteredDate,\n\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PremiumTransactionEnteredDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\tLKP_CALENDER_DIM_to_date_to_char_PremiumTransactionEnteredDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PremiumTransactionEnteredDateID,\n\t-- *INF*: IIF(NOT ISNULL(v_PremiumTransactionEnteredDateID),v_PremiumTransactionEnteredDateID,-1)\n\tIFF(v_PremiumTransactionEnteredDateID IS NOT NULL, v_PremiumTransactionEnteredDateID, - 1) AS PremiumTransactionEnteredDateID_out,\n\tEXP_EarnedPremiumCalculation_IN.PremiumTransactionEffectiveDate,\n\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PremiumTransactionEffectiveDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\tLKP_CALENDER_DIM_to_date_to_char_PremiumTransactionEffectiveDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PremiumTransactionEffectiveDateID,\n\t-- *INF*: IIF(NOT ISNULL(v_PremiumTransactionEffectiveDateID),v_PremiumTransactionEffectiveDateID,-1)\n\tIFF(\n\t    v_PremiumTransactionEffectiveDateID IS NOT NULL, v_PremiumTransactionEffectiveDateID, - 1\n\t) AS PremiumTransactionEffectiveDateID_out,\n\tEXP_EarnedPremiumCalculation_IN.PremiumTransactionExpirationDate,\n\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PremiumTransactionExpirationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\tLKP_CALENDER_DIM_to_date_to_char_PremiumTransactionExpirationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PremiumTransactionExpirationDateID,\n\t-- *INF*: IIF(NOT ISNULL(v_PremiumTransactionExpirationDateID),v_PremiumTransactionExpirationDateID,-1)\n\tIFF(\n\t    v_PremiumTransactionExpirationDateID IS NOT NULL, v_PremiumTransactionExpirationDateID, - 1\n\t) AS PremiumTransactionExpirationDateID_out,\n\tEXP_EarnedPremiumCalculation_IN.PremiumType,\n\tLKP_asl_dim.asl_dim_id AS ASLdimID,\n\t-- *INF*: IIF(NOT ISNULL(ASLdimID),ASLdimID,-1)\n\tIFF(ASLdimID IS NOT NULL, ASLdimID, - 1) AS ASLdimID_out,\n\tLKP_asl_product_code.asl_prdct_code_dim_id AS ASLproductcodedimID,\n\t-- *INF*: IIF(NOT ISNULL(ASLproductcodedimID),ASLproductcodedimID,-1)\n\tIFF(ASLproductcodedimID IS NOT NULL, ASLproductcodedimID, - 1) AS ASLproductcodedimID_out,\n\tEXP_EarnedPremiumCalculation_IN.PolicyEffectiveDate,\n\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PolicyEffectiveDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\tLKP_CALENDER_DIM_to_date_to_char_PolicyEffectiveDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PolicyEffectiveDateID,\n\tv_PolicyEffectiveDateID AS PolicyEffectiveDateID_out,\n\tEXP_EarnedPremiumCalculation_IN.PolicyExpirationDate,\n\t-- *INF*: :LKP.LKP_CALENDER_DIM(to_date(to_char(PolicyExpirationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\tLKP_CALENDER_DIM_to_date_to_char_PolicyExpirationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_PolicyExpirationDateID,\n\t-- *INF*: IIF(ISNULL(v_PolicyExpirationDateID),-1,v_PolicyExpirationDateID)\n\tIFF(v_PolicyExpirationDateID IS NULL, - 1, v_PolicyExpirationDateID) AS PolicyExpirationDateID_out,\n\tEXP_EarnedPremiumCalculation_IN.EarnedPremiumCalculationID AS EDWEarnedPremiumDailyCalculationPKID,\n\t-- *INF*: :LKP.LKP_CALENDER_DIM(TO_DATE(TO_CHAR(RatingCoverageEffectiveDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\tLKP_CALENDER_DIM_TO_DATE_TO_CHAR_RatingCoverageEffectiveDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS RatingCoverageEffectiveDateId,\n\t-- *INF*: :LKP.LKP_CALENDER_DIM(TO_DATE(TO_CHAR(RatingCoverageExpirationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\tLKP_CALENDER_DIM_TO_DATE_TO_CHAR_RatingCoverageExpirationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS RatingCoverageExpirationDateId,\n\t-- *INF*: --IIF(ISNULL(RatingCoverageDimId), -1, RatingCoverageDimId)\n\t'' AS RatingCoverageDimId_out,\n\tLKP_InsuranceReferenceDim.InsuranceReferenceDimId,\n\t-- *INF*: IIF(ISNULL(InsuranceReferenceDimId), -1, InsuranceReferenceDimId)\n\tIFF(InsuranceReferenceDimId IS NULL, - 1, InsuranceReferenceDimId) AS o_InsuranceReferenceDimId,\n\t-- *INF*: --IIF(ISNULL(SalesDivisionDimID), -1, SalesDivisionDimID)\n\t'' AS o_SalesDivisionDimID,\n\tEXP_EarnedPremiumCalculation_IN.CoverageDetailDimID_lkp AS CoverageDetailDimID,\n\tEXP_EarnedPremiumCalculation_IN.StatisticalCoverageCancellationDate AS i_StatisticalCoverageCancellationDate,\n\t-- *INF*: :LKP.LKP_CALENDER_DIM(TO_DATE(TO_CHAR(i_StatisticalCoverageCancellationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY'))\n\tLKP_CALENDER_DIM_TO_DATE_TO_CHAR_i_StatisticalCoverageCancellationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_id AS v_StatisticalCoverageCancellationDate,\n\t-- *INF*: IIF(NOT ISNULL(v_StatisticalCoverageCancellationDate),v_StatisticalCoverageCancellationDate,-1)\n\tIFF(\n\t    v_StatisticalCoverageCancellationDate IS NOT NULL, v_StatisticalCoverageCancellationDate,\n\t    - 1\n\t) AS o_StatisticalCoverageCancellationDate,\n\tEXP_EarnedPremiumCalculation_IN.SourceSystemID,\n\tEXP_EarnedPremiumCalculation_IN.o_InsuranceReferenceCoverageDimId_PMS AS InsuranceReferenceCoverageDimId_PMS,\n\tEXP_EarnedPremiumCalculation_IN.o_InsuranceReferenceCoverageDimId_DCT AS InsuranceReferenceCoverageDimId_DCT,\n\t-- *INF*: DECODE(SourceSystemID,'DCT',InsuranceReferenceCoverageDimId_DCT,'PMS',InsuranceReferenceCoverageDimId_PMS)\n\tDECODE(\n\t    SourceSystemID,\n\t    'DCT', InsuranceReferenceCoverageDimId_DCT,\n\t    'PMS', InsuranceReferenceCoverageDimId_PMS\n\t) AS o_InsuranceReferenceCoverageDimId\n\tFROM EXP_EarnedPremiumCalculation_IN\n\t -- Manually join with mplt_PolicyDimID_PremiumMaster\n\tLEFT JOIN LKP_InsuranceReferenceDim\n\tON LKP_InsuranceReferenceDim.EnterpriseGroupCode = EXP_EarnedPremiumCalculation_IN.EnterpriseGroupCode AND LKP_InsuranceReferenceDim.InsuranceReferenceLegalEntityCode = EXP_EarnedPremiumCalculation_IN.InsuranceReferenceLegalEntityCode AND LKP_InsuranceReferenceDim.StrategicProfitCenterCode = EXP_EarnedPremiumCalculation_IN.StrategicProfitCenterCode AND LKP_InsuranceReferenceDim.InsuranceSegmentCode = EXP_EarnedPremiumCalculation_IN.InsuranceSegmentCode AND LKP_InsuranceReferenceDim.PolicyOfferingCode = EXP_EarnedPremiumCalculation_IN.PolicyOfferingCode AND LKP_InsuranceReferenceDim.ProductCode = EXP_EarnedPremiumCalculation_IN.ProductCode AND LKP_InsuranceReferenceDim.InsuranceReferenceLineOfBusinessCode = EXP_EarnedPremiumCalculation_IN.LineOfBusinessCode AND LKP_InsuranceReferenceDim.RatingPlanCode = EXP_EarnedPremiumCalculation_IN.o_RatingPlanCode\n\tLEFT JOIN LKP_RiskLocationDim\n\tON LKP_RiskLocationDim.RiskLocationHashKey = EXP_EarnedPremiumCalculation_IN.RiskLocationHashKey\n\tLEFT JOIN LKP_asl_dim\n\tON LKP_asl_dim.asl_code = EXP_EarnedPremiumCalculation_IN.AnnualStatementLineCode AND LKP_asl_dim.sub_asl_code = EXP_EarnedPremiumCalculation_IN.SubAnnualStatementLineCode AND LKP_asl_dim.sub_non_asl_code = EXP_EarnedPremiumCalculation_IN.o_NonSubAnnualStatementLineCode\n\tLEFT JOIN LKP_asl_product_code\n\tON LKP_asl_product_code.asl_prdct_code = EXP_EarnedPremiumCalculation_IN.AnnualStatementLineProductCode\n\tLEFT JOIN LKP_reinsurance_coverage_dim\n\tON LKP_reinsurance_coverage_dim.edw_reins_cov_ak_id = EXP_EarnedPremiumCalculation_IN.ReinsuranceCoverageAKID AND LKP_reinsurance_coverage_dim.eff_from_date <= EXP_EarnedPremiumCalculation_IN.PremiumTransactionEffectiveDate AND LKP_reinsurance_coverage_dim.eff_to_date >= EXP_EarnedPremiumCalculation_IN.PremiumTransactionEffectiveDate\n\tLEFT JOIN lkp_PremiumTransactionTypeDim\n\tON lkp_PremiumTransactionTypeDim.PremiumTransactionCode = EXP_EarnedPremiumCalculation_IN.PremiumTransactionCode AND lkp_PremiumTransactionTypeDim.ReasonAmendedCode = EXP_EarnedPremiumCalculation_IN.ReasonAmendedCode AND lkp_PremiumTransactionTypeDim.PremiumTypeCode = EXP_EarnedPremiumCalculation_IN.PremiumType AND lkp_PremiumTransactionTypeDim.CustomerCareCommissionRate = EXP_EarnedPremiumCalculation_IN.CustomerCareCommissionRate\n\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionBookedDate_MM_DD_YYYY_MM_DD_YYYY\n\tON LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionBookedDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PremiumTransactionBookedDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\n\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionRunDate_MM_DD_YYYY_MM_DD_YYYY\n\tON LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionRunDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PremiumTransactionRunDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\n\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PolicyCoverageEffectiveDate_MM_DD_YYYY_MM_DD_YYYY\n\tON LKP_CALENDER_DIM_to_date_to_char_PolicyCoverageEffectiveDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PolicyCoverageEffectiveDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\n\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PolicyCoverageExpirationDate_MM_DD_YYYY_MM_DD_YYYY\n\tON LKP_CALENDER_DIM_to_date_to_char_PolicyCoverageExpirationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PolicyCoverageExpirationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\n\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionEnteredDate_MM_DD_YYYY_MM_DD_YYYY\n\tON LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionEnteredDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PremiumTransactionEnteredDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\n\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionEffectiveDate_MM_DD_YYYY_MM_DD_YYYY\n\tON LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionEffectiveDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PremiumTransactionEffectiveDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\n\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionExpirationDate_MM_DD_YYYY_MM_DD_YYYY\n\tON LKP_CALENDER_DIM_to_date_to_char_PremiumTransactionExpirationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PremiumTransactionExpirationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\n\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PolicyEffectiveDate_MM_DD_YYYY_MM_DD_YYYY\n\tON LKP_CALENDER_DIM_to_date_to_char_PolicyEffectiveDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PolicyEffectiveDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\n\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_to_date_to_char_PolicyExpirationDate_MM_DD_YYYY_MM_DD_YYYY\n\tON LKP_CALENDER_DIM_to_date_to_char_PolicyExpirationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(to_char(PolicyExpirationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\n\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_TO_DATE_TO_CHAR_RatingCoverageEffectiveDate_MM_DD_YYYY_MM_DD_YYYY\n\tON LKP_CALENDER_DIM_TO_DATE_TO_CHAR_RatingCoverageEffectiveDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(TO_CHAR(RatingCoverageEffectiveDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\n\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_TO_DATE_TO_CHAR_RatingCoverageExpirationDate_MM_DD_YYYY_MM_DD_YYYY\n\tON LKP_CALENDER_DIM_TO_DATE_TO_CHAR_RatingCoverageExpirationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(TO_CHAR(RatingCoverageExpirationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\n\tLEFT JOIN LKP_CALENDER_DIM LKP_CALENDER_DIM_TO_DATE_TO_CHAR_i_StatisticalCoverageCancellationDate_MM_DD_YYYY_MM_DD_YYYY\n\tON LKP_CALENDER_DIM_TO_DATE_TO_CHAR_i_StatisticalCoverageCancellationDate_MM_DD_YYYY_MM_DD_YYYY.clndr_date = TO_TIMESTAMP(TO_CHAR(i_StatisticalCoverageCancellationDate, 'MM/DD/YYYY'), 'MM/DD/YYYY')\n\n),\nEXP_Evaluate_Fields AS (\n\tSELECT\n\tAuditID,\n\tEDWEarnedPremiumDailyCalculationPKID,\n\tEDWPremiumTransactionPKID_out AS EDWPremiumTransactionPKID,\n\tASLdimID_out AS AnnualStatementLineDimID,\n\tASLproductcodedimID_out AS AnnualStatementLineProductCodeDimID,\n\tAgencyDimID_out AS AgencyDimID,\n\tPolicyDimID_out AS PolicyDimID,\n\tpol_status_code,\n\tContractCustomerDimID_out AS ContractCustomerDimID,\n\tRiskLocationDimID_out AS RiskLocationDimID,\n\tReinsuranceCoverageDimID_out AS ReinsuranceCoverageDimID,\n\tPremiumTransactionTypeDimID_out AS PremiumTransactionTypeDimID,\n\tPolicyEffectiveDateID_out AS PolicyEffectiveDateID,\n\tPolicyExpirationDateID_out AS PolicyExpirationDateID,\n\tPolicyCoverageEffectiveDateID_out AS PolicyCoverageEffectiveDateID,\n\tPolicyCoverageExpirationDateID_out AS PolicyCoverageExpirationDateID,\n\tPremiumTransactionEnteredDateID_out AS PremiumTransactionEnteredDateID,\n\tPremiumTransactionEffectiveDateID_out AS PremiumTransactionEffectiveDateID,\n\tPremiumTransactionExpirationDateID_out AS PremiumTransactionExpirationDateID,\n\tPremiumTransactionBookedDateID_out AS PremiumTransactionBookedDateID,\n\tPremiumTransactionRunDateID_out AS PremiumTransactionRunDateID,\n\tPremiumType,\n\tPremiumTransactionAmount,\n\tFullTermPremium,\n\tDateFlagForWittenPremium,\n\t-- *INF*: IIF(rtrim(PremiumType)='D' AND DateFlagForWittenPremium='Y',PremiumTransactionAmount,0)\n\tIFF(\n\t    rtrim(PremiumType) = 'D' AND DateFlagForWittenPremium = 'Y', PremiumTransactionAmount, 0\n\t) AS v_TotalDirectWrittenPremium,\n\tv_TotalDirectWrittenPremium AS TotalDirectWrittenPremium,\n\t-- *INF*: IIF(rtrim(PremiumType)='C' AND DateFlagForWittenPremium='Y',PremiumTransactionAmount,0)\n\tIFF(\n\t    rtrim(PremiumType) = 'C' AND DateFlagForWittenPremium = 'Y', PremiumTransactionAmount, 0\n\t) AS v_TotalCededWrittenPremium,\n\tv_TotalCededWrittenPremium AS TotalCededWrittenPremium,\n\tv_TotalDirectWrittenPremium - v_TotalCededWrittenPremium AS TotalNetWrittenPremium,\n\tEarnedPremium,\n\t-- *INF*: IIF(rtrim(PremiumType)='D',EarnedPremium,0)\n\tIFF(rtrim(PremiumType) = 'D', EarnedPremium, 0) AS v_DirectEarnedPremium,\n\tv_DirectEarnedPremium AS DirectEarnedPremium,\n\t-- *INF*: IIF(rtrim(PremiumType)='C',EarnedPremium,0)\n\tIFF(rtrim(PremiumType) = 'C', EarnedPremium, 0) AS v_CededEarnedPremium,\n\tv_CededEarnedPremium AS CededEarnedPremium,\n\tv_DirectEarnedPremium - v_CededEarnedPremium AS NetEarnedPremium,\n\tChangeInEarnedPremium,\n\t-- *INF*: IIF(rtrim(PremiumType)='D',ChangeInEarnedPremium,0)\n\tIFF(rtrim(PremiumType) = 'D', ChangeInEarnedPremium, 0) AS v_ChangeinDirectEarnedPremium,\n\tv_ChangeinDirectEarnedPremium AS ChangeinDirectEarnedPremium,\n\t-- *INF*: IIF(rtrim(PremiumType)='C',ChangeInEarnedPremium,0)\n\tIFF(rtrim(PremiumType) = 'C', ChangeInEarnedPremium, 0) AS v_ChangeinCededEarnedPremium,\n\tv_ChangeinCededEarnedPremium AS ChangeinCededEarnedPremium,\n\tv_ChangeinDirectEarnedPremium - v_ChangeinCededEarnedPremium AS NetChangeinEarnedPremium,\n\tUnearnedPremium AS Direct_UnearnedPremium,\n\t-- *INF*: IIF(rtrim(PremiumType)='D',Direct_UnearnedPremium,0)\n\tIFF(rtrim(PremiumType) = 'D', Direct_UnearnedPremium, 0) AS v_Direct_UnearnedPremium,\n\tv_Direct_UnearnedPremium AS O_Direct_UnearnedPremium,\n\tChangeInUnearnedPremium AS DirectChangeInUnearnedPremium,\n\t-- *INF*: IIF(rtrim(PremiumType)='D',DirectChangeInUnearnedPremium,0)\n\tIFF(rtrim(PremiumType) = 'D', DirectChangeInUnearnedPremium, 0) AS DailyDirectChangeInUnearnedPremium,\n\t-- *INF*: IIF(rtrim(PremiumType)='C',v_TotalCededWrittenPremium - v_CededEarnedPremium,0)\n\tIFF(rtrim(PremiumType) = 'C', v_TotalCededWrittenPremium - v_CededEarnedPremium, 0) AS v_CededUnearnedPremium,\n\tv_CededUnearnedPremium AS CededUnearnedPremium,\n\tv_Direct_UnearnedPremium - v_CededUnearnedPremium AS NetUnearnedPremium,\n\t-- *INF*: IIF(pol_status_code='I' AND PremiumType='D', PremiumTransactionAmount, 0)\n\tIFF(pol_status_code = 'I' AND PremiumType = 'D', PremiumTransactionAmount, 0) AS v_DirectInforcePremium,\n\tv_DirectInforcePremium AS DirectInforcePremium,\n\t-- *INF*: IIF(pol_status_code='I' AND PremiumType='C', PremiumTransactionAmount, 0)\n\tIFF(pol_status_code = 'I' AND PremiumType = 'C', PremiumTransactionAmount, 0) AS v_CededInforcePremium,\n\tv_CededInforcePremium AS CededInforcePremium,\n\tv_DirectInforcePremium - v_CededInforcePremium AS v_NetInforcePremium,\n\tv_NetInforcePremium AS NetInforcePremium,\n\t-- *INF*: IIF(rtrim(PremiumType)='C',v_ChangeinCededEarnedPremium*(-1),0)\n\tIFF(rtrim(PremiumType) = 'C', v_ChangeinCededEarnedPremium * (- 1), 0) AS DailyChangeInCededUnearnedPremium,\n\tRatingCoverageEffectiveDateId,\n\tRatingCoverageExpirationDateId,\n\tRatingCoverageDimId_out,\n\to_InsuranceReferenceDimId AS InsuranceReferenceDimId,\n\to_SalesDivisionDimID AS SalesDivisionDimID,\n\tCoverageDetailDimID,\n\to_StatisticalCoverageCancellationDate AS StatisticalCoverageCancellationDate,\n\to_InsuranceReferenceCoverageDimId AS InsuranceReferenceCoverageDimId,\n\t-- *INF*: :LKP.LKP_EARNEDPREMIUMDAILYFACT(EDWEarnedPremiumDailyCalculationPKID)\n\tLKP_EARNEDPREMIUMDAILYFACT_EDWEarnedPremiumDailyCalculationPKID.EarnedPremiumTransactionDailyFactID AS LKP_EDWEarnedPremiumDailyCalcID\n\tFROM EXP_Consolidate_Data_from_Lookups\n\tLEFT JOIN LKP_EARNEDPREMIUMDAILYFACT LKP_EARNEDPREMIUMDAILYFACT_EDWEarnedPremiumDailyCalculationPKID\n\tON LKP_EARNEDPREMIUMDAILYFACT_EDWEarnedPremiumDailyCalculationPKID.EDWEarnedPremiumDailyCalculationPKID = EDWEarnedPremiumDailyCalculationPKID\n\n),\nFIL_Duplicate_EDWEarnedPremiumCalc_Daily AS (\n\tSELECT\n\tAuditID, \n\tEDWEarnedPremiumDailyCalculationPKID, \n\tEDWPremiumTransactionPKID, \n\tAnnualStatementLineDimID, \n\tAnnualStatementLineProductCodeDimID, \n\tAgencyDimID, \n\tPolicyDimID, \n\tContractCustomerDimID, \n\tRiskLocationDimID, \n\tReinsuranceCoverageDimID, \n\tPremiumTransactionTypeDimID, \n\tPolicyEffectiveDateID, \n\tPolicyExpirationDateID, \n\tPolicyCoverageEffectiveDateID, \n\tPolicyCoverageExpirationDateID, \n\tPremiumTransactionEnteredDateID, \n\tPremiumTransactionEffectiveDateID, \n\tPremiumTransactionExpirationDateID, \n\tPremiumTransactionBookedDateID, \n\tPremiumTransactionRunDateID, \n\tTotalDirectWrittenPremium, \n\tTotalCededWrittenPremium, \n\tTotalNetWrittenPremium, \n\tDirectEarnedPremium, \n\tCededEarnedPremium, \n\tNetEarnedPremium, \n\tChangeinDirectEarnedPremium, \n\tChangeinCededEarnedPremium, \n\tNetChangeinEarnedPremium, \n\tO_Direct_UnearnedPremium, \n\tDailyDirectChangeInUnearnedPremium, \n\tCededUnearnedPremium, \n\tNetUnearnedPremium, \n\tDirectInforcePremium, \n\tCededInforcePremium, \n\tNetInforcePremium, \n\tDailyChangeInCededUnearnedPremium, \n\tRatingCoverageEffectiveDateId, \n\tRatingCoverageExpirationDateId, \n\tRatingCoverageDimId_out, \n\tInsuranceReferenceDimId, \n\tSalesDivisionDimID, \n\tCoverageDetailDimID, \n\tStatisticalCoverageCancellationDate, \n\tInsuranceReferenceCoverageDimId, \n\tLKP_EDWEarnedPremiumDailyCalcID\n\tFROM EXP_Evaluate_Fields\n\tWHERE ISNULL(LKP_EDWEarnedPremiumDailyCalcID)\n),\nEXP_Pre_Insert AS (\n\tSELECT\n\tAuditID,\n\tEDWEarnedPremiumDailyCalculationPKID,\n\tEDWPremiumTransactionPKID,\n\tAnnualStatementLineDimID,\n\tAnnualStatementLineProductCodeDimID,\n\tAgencyDimID,\n\tPolicyDimID,\n\tContractCustomerDimID,\n\tRiskLocationDimID,\n\tReinsuranceCoverageDimID,\n\tPremiumTransactionTypeDimID,\n\tPolicyEffectiveDateID,\n\tPolicyExpirationDateID,\n\tPolicyCoverageEffectiveDateID,\n\tPolicyCoverageExpirationDateID,\n\tPremiumTransactionEnteredDateID,\n\tPremiumTransactionEffectiveDateID,\n\tPremiumTransactionExpirationDateID,\n\tPremiumTransactionBookedDateID,\n\tPremiumTransactionRunDateID,\n\tTotalDirectWrittenPremium,\n\tTotalCededWrittenPremium,\n\tTotalNetWrittenPremium,\n\tDirectEarnedPremium,\n\tCededEarnedPremium,\n\tNetEarnedPremium,\n\tChangeinDirectEarnedPremium,\n\tChangeinCededEarnedPremium,\n\tNetChangeinEarnedPremium AS NetChangeinCededEarnedPremium,\n\tO_Direct_UnearnedPremium AS DirectUnearnedPremium,\n\tDailyDirectChangeInUnearnedPremium AS DirectChangeInUnearnedPremium,\n\tCededUnearnedPremium,\n\tNetUnearnedPremium,\n\tDirectInforcePremium,\n\tCededInforcePremium,\n\tNetInforcePremium,\n\tDailyChangeInCededUnearnedPremium,\n\tRatingCoverageEffectiveDateId,\n\tRatingCoverageExpirationDateId,\n\tRatingCoverageDimId_out,\n\tInsuranceReferenceDimId,\n\tSalesDivisionDimID,\n\tCoverageDetailDimID,\n\tStatisticalCoverageCancellationDate,\n\tInsuranceReferenceCoverageDimId\n\tFROM FIL_Duplicate_EDWEarnedPremiumCalc_Daily\n),\nTGT_EarnedPremiumTransactionDailyFact_INSERT AS (\n\n\t------------ PRE SQL ----------\n\tif exists(select * from @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}. EarnedPremiumTransactionDailyFact where substring(CONVERT(varchar(8),DATEADD(d, -@{pipeline().parameters.NO_OF_DAYS}+1, getdate()),112),7,2)='02')\r\n\tbegin\r\n\t            exec ('truncate table @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}. EarnedPremiumTransactionDailyFact')\r\n\tend\n\t-------------------------------\n\n\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.EarnedPremiumTransactionDailyFact\n\t(AuditID, EDWEarnedPremiumDailyCalculationPKID, AnnualStatementLineDimID, AnnualStatementLineProductCodeDimID, AgencyDimID, PolicyDimID, ContractCustomerDimID, RiskLocationDimID, ReinsuranceCoverageDimID, PremiumTransactionTypeDimID, PolicyEffectiveDateID, PolicyExpirationDateID, PolicyCoverageEffectiveDateID, PolicyCoverageExpirationDateID, PremiumTransactionEnteredDateID, PremiumTransactionEffectiveDateID, PremiumTransactionExpirationDateID, PremiumTransactionBookedDateID, PremiumTransactionRunDateID, DailyTotalDirectWrittenPremium, DailyTotalCededWrittenPremium, DailyTotalNetWrittenPremium, DailyDirectEarnedPremium, DailyCededEarnedPremium, DailyNetEarnedPremium, DailyChangeinDirectEarnedPremium, DailyChangeinCededEarnedPremium, DailyNetChangeinCededEarnedPremium, DailyDirectUnearnedPremium, DailyCededUnearnedPremium, DailyNetUnearnedPremium, DailyChangeInDirectUnearnedPremium, DailyChangeInCededUnearnedPremium, DailyDirectInforcePremium, DailyCededInforcePremium, DailyNetInforcePremium, InsuranceReferenceDimId, CoverageDetailDimId, InsuranceReferenceCoverageDimId, CoverageCancellationDateId)\n\tSELECT \n\tAUDITID, \n\tEDWEARNEDPREMIUMDAILYCALCULATIONPKID, \n\tANNUALSTATEMENTLINEDIMID, \n\tANNUALSTATEMENTLINEPRODUCTCODEDIMID, \n\tAGENCYDIMID, \n\tPOLICYDIMID, \n\tCONTRACTCUSTOMERDIMID, \n\tRISKLOCATIONDIMID, \n\tREINSURANCECOVERAGEDIMID, \n\tPREMIUMTRANSACTIONTYPEDIMID, \n\tPOLICYEFFECTIVEDATEID, \n\tPOLICYEXPIRATIONDATEID, \n\tPOLICYCOVERAGEEFFECTIVEDATEID, \n\tPOLICYCOVERAGEEXPIRATIONDATEID, \n\tPREMIUMTRANSACTIONENTEREDDATEID, \n\tPREMIUMTRANSACTIONEFFECTIVEDATEID, \n\tPREMIUMTRANSACTIONEXPIRATIONDATEID, \n\tPREMIUMTRANSACTIONBOOKEDDATEID, \n\tPREMIUMTRANSACTIONRUNDATEID, \n\tTotalDirectWrittenPremium AS DAILYTOTALDIRECTWRITTENPREMIUM, \n\tTotalCededWrittenPremium AS DAILYTOTALCEDEDWRITTENPREMIUM, \n\tTotalNetWrittenPremium AS DAILYTOTALNETWRITTENPREMIUM, \n\tDirectEarnedPremium AS DAILYDIRECTEARNEDPREMIUM, \n\tCededEarnedPremium AS DAILYCEDEDEARNEDPREMIUM, \n\tNetEarnedPremium AS DAILYNETEARNEDPREMIUM, \n\tChangeinDirectEarnedPremium AS DAILYCHANGEINDIRECTEARNEDPREMIUM, \n\tChangeinCededEarnedPremium AS DAILYCHANGEINCEDEDEARNEDPREMIUM, \n\tNetChangeinCededEarnedPremium AS DAILYNETCHANGEINCEDEDEARNEDPREMIUM, \n\tDirectUnearnedPremium AS DAILYDIRECTUNEARNEDPREMIUM, \n\tCededUnearnedPremium AS DAILYCEDEDUNEARNEDPREMIUM, \n\tNetUnearnedPremium AS DAILYNETUNEARNEDPREMIUM, \n\tDirectChangeInUnearnedPremium AS DAILYCHANGEINDIRECTUNEARNEDPREMIUM, \n\tDAILYCHANGEINCEDEDUNEARNEDPREMIUM, \n\tDirectInforcePremium AS DAILYDIRECTINFORCEPREMIUM, \n\tCededInforcePremium AS DAILYCEDEDINFORCEPREMIUM, \n\tNetInforcePremium AS DAILYNETINFORCEPREMIUM, \n\tINSURANCEREFERENCEDIMID, \n\tCoverageDetailDimID AS COVERAGEDETAILDIMID, \n\tINSURANCEREFERENCECOVERAGEDIMID, \n\tStatisticalCoverageCancellationDate AS COVERAGECANCELLATIONDATEID\n\tFROM EXP_Pre_Insert\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "NO_OF_DAYS": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_TABLE_OWNER_V2": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "NO_OF_PARTITIONS": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "TARGET_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "RPT_EDM and EDW/Policy DataMart/"
        },
        "annotations": []
    }
}