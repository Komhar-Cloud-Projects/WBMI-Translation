{
    "name": "s_m_FEED_Load_HSBCyber_Extract_File",
    "properties": {
        "activities": [
            {
                "name": "m_FEED_Load_HSBCyber_Extract_File",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_HSBCyberPolicyExtract AS (\n\tSELECT\n\t\tHSBCyberPolicyExtractId,\n\t\tAuditId AS AuditID,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tRunDate,\n\t\tCompany,\n\t\tProductCode,\n\t\tContractNumber,\n\t\tPolicyNumber,\n\t\tCyberCoverageEffectiveDate AS PolicyEffectiveDate,\n\t\tCyberCoverageExpirationDate AS PolicyExpirationDate,\n\t\tNameOfInsured,\n\t\tMailingAddressStreetName,\n\t\tMailingAddressCity,\n\t\tMailingAddressState,\n\t\tMailingAddressZipCode,\n\t\tTotalPackageGrossPremium,\n\t\tTotalPropertyGrossPremium,\n\t\tCyberGrossPremium AS GrossPremium,\n\t\tCyberNetPremium AS NetPremium,\n\t\tFirstPartyLimit,\n\t\tFirstPartyDeductible,\n\t\tOccupancyCode,\n\t\tPolicyTotalInsuredValue,\n\t\tPreviousPolicyNumber,\n\t\tAgentCode AS AgencyCode,\n\t\tBranchCode,\n\t\tFirstPartyCoverage,\n\t\tThirdPartyLimit,\n\t\tThirdPartyDeductible,\n\t\tThirdPartyCoverage,\n\t\tExtortionSublimit\n\tFROM HSBCyberPolicyExtract_Record\n\tWHERE convert(date,CyberCoverageEffectiveDate)<=@{pipeline().parameters.RUNDATE}\r\n\tAND \r\n\tconvert(date,CyberCoverageExpirationDate)>=@{pipeline().parameters.RUNDATE}\n),\nEXP_PolicyExtract AS (\n\tSELECT\n\tCompany,\n\tProductCode,\n\tContractNumber,\n\tPolicyNumber,\n\tPolicyEffectiveDate,\n\t-- *INF*: TO_CHAR(PolicyEffectiveDate, 'YYYYMMDD')\n\tTO_CHAR(PolicyEffectiveDate, 'YYYYMMDD') AS PolicyEffectiveDateYYYYMMDD,\n\tPolicyExpirationDate,\n\t-- *INF*: TO_CHAR(PolicyExpirationDate, 'YYYYMMDD')\n\tTO_CHAR(PolicyExpirationDate, 'YYYYMMDD') AS PolicyExpirationDateYYYYMMDD,\n\tNameOfInsured,\n\tMailingAddressStreetName,\n\tMailingAddressCity,\n\tMailingAddressState,\n\tMailingAddressZipCode,\n\tTotalPackageGrossPremium,\n\tTotalPropertyGrossPremium,\n\tGrossPremium,\n\tNetPremium,\n\tFirstPartyLimit AS CyberOneFirstPartyLimit,\n\tFirstPartyDeductible,\n\tOccupancyCode,\n\tPolicyTotalInsuredValue,\n\tPreviousPolicyNumber,\n\tAgencyCode,\n\tBranchCode,\n\tThirdPartyLimit AS CyberOneThirdPartyLimit,\n\tThirdPartyDeductible AS CyberOneThirdPartyDeductible,\n\tThirdPartyCoverage,\n\tFirstPartyCoverage,\n\tExtortionSublimit\n\tFROM SQ_HSBCyberPolicyExtract\n),\nHSBCyberPolicyRecordFile AS (\n\tINSERT INTO HSBCyberPolicyRecordFile\n\t(Company, ProductCode, ContractNumber, PolicyNumber, CyberOneCoverageEffectiveDate, CyberOneCoverageExpirationDate, NameOfInsured, MailingAddressStreetName, MailingAddressCity, MailingAddressState, MailingAddressZipCode, TotalPackageGrossPremium, TotalPropertyGrossPremium, CyberOneGrossPremium, CyberOneNetPremium, OccupancyCode, PolicyTotalInsuredValue, PreviousPolicyNumber, AgencyCode, BranchCode, CyberOneFirstPartyLimit, CyberOneFirstPartyDeductible, FirstPartyCoverage, CyberOneThirdPartyLimit, CyberOneThirdPartyDeductible, ThirdPartyCoverage, ExtortionSublimit)\n\tSELECT \n\tCOMPANY, \n\tPRODUCTCODE, \n\tCONTRACTNUMBER, \n\tPOLICYNUMBER, \n\tPolicyEffectiveDateYYYYMMDD AS CYBERONECOVERAGEEFFECTIVEDATE, \n\tPolicyExpirationDateYYYYMMDD AS CYBERONECOVERAGEEXPIRATIONDATE, \n\tNAMEOFINSURED, \n\tMAILINGADDRESSSTREETNAME, \n\tMAILINGADDRESSCITY, \n\tMAILINGADDRESSSTATE, \n\tMAILINGADDRESSZIPCODE, \n\tTOTALPACKAGEGROSSPREMIUM, \n\tTOTALPROPERTYGROSSPREMIUM, \n\tGrossPremium AS CYBERONEGROSSPREMIUM, \n\tNetPremium AS CYBERONENETPREMIUM, \n\tOCCUPANCYCODE, \n\tPOLICYTOTALINSUREDVALUE, \n\tPREVIOUSPOLICYNUMBER, \n\tAGENCYCODE, \n\tBRANCHCODE, \n\tCYBERONEFIRSTPARTYLIMIT, \n\tFirstPartyDeductible AS CYBERONEFIRSTPARTYDEDUCTIBLE, \n\tFIRSTPARTYCOVERAGE, \n\tCYBERONETHIRDPARTYLIMIT, \n\tCYBERONETHIRDPARTYDEDUCTIBLE, \n\tTHIRDPARTYCOVERAGE, \n\tEXTORTIONSUBLIMIT\n\tFROM EXP_PolicyExtract\n),\nSQ_HSBCyberPaymentBordereauExtract AS (\n\tSELECT\n\t\tHSBCyberPaymentBordereauExtractId,\n\t\tAuditId AS AuditID,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tRunDate,\n\t\tProductCode,\n\t\tCompany,\n\t\tPolicyNumber,\n\t\tTransactionCode,\n\t\tTransactionEffectiveDate,\n\t\tCoverageEffectiveDate,\n\t\tCoverageExpirationDate,\n\t\tCoverageGrossPremium,\n\t\tCoverageNetPremium,\n\t\tPreviousPolicyNumber,\n\t\tProgramID,\n\t\tNameOfInsured,\n\t\tContractNumber\n\tFROM HSBCyberPaymentBordereauExtract2\n\tWHERE AuditId=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\n),\nEXP_BordereauExtract AS (\n\tSELECT\n\tProductCode,\n\tCompany,\n\tPolicyNumber,\n\tTransactionCode,\n\tTransactionEffectiveDate,\n\tCoverageEffectiveDate,\n\tCoverageExpirationDate,\n\t-- *INF*: TO_CHAR(TransactionEffectiveDate,'YYYYMMDD')\r\n\t-- \n\tTO_CHAR(TransactionEffectiveDate, 'YYYYMMDD') AS TransactionEffectiveDateYYYYMMDD,\n\t-- *INF*: TO_CHAR(CoverageEffectiveDate,'YYYYMMDD')\n\tTO_CHAR(CoverageEffectiveDate, 'YYYYMMDD') AS CoverageEffectiveDateYYYYMMDD,\n\t-- *INF*: TO_CHAR(CoverageExpirationDate,'YYYYMMDD')\n\tTO_CHAR(CoverageExpirationDate, 'YYYYMMDD') AS CoverageExpirationDateYYYYMMDD,\n\tCoverageGrossPremium,\n\tCoverageNetPremium,\n\tPreviousPolicyNumber,\n\tProgramID,\n\tNameOfInsured,\n\tContractNumber\n\tFROM SQ_HSBCyberPaymentBordereauExtract\n),\nHSBCyberPaymentBordereauxRecordFile AS (\n\tINSERT INTO HSBCyberPaymentBordereauxRecordFile\n\t(ProductCode, Company, PolicyNumber, TransactionCode, TransactionEffectiveDate, CoverageEffectiveDate, CoverageExpirationDate, CoverageGrossPremium, CoverageNetPremium, PreviousPolicyNumber, ProgramID, NameOfInsured, ContractNumber)\n\tSELECT \n\tPRODUCTCODE, \n\tCOMPANY, \n\tPOLICYNUMBER, \n\tTRANSACTIONCODE, \n\tTransactionEffectiveDateYYYYMMDD AS TRANSACTIONEFFECTIVEDATE, \n\tCoverageEffectiveDateYYYYMMDD AS COVERAGEEFFECTIVEDATE, \n\tCoverageExpirationDateYYYYMMDD AS COVERAGEEXPIRATIONDATE, \n\tCOVERAGEGROSSPREMIUM, \n\tCOVERAGENETPREMIUM, \n\tPREVIOUSPOLICYNUMBER, \n\tPROGRAMID, \n\tNAMEOFINSURED, \n\tCONTRACTNUMBER\n\tFROM EXP_BordereauExtract\n),\nSQ_HSBCyberPaymentBordereauExtractCntl AS (\n\tSELECT\n\t\tHSBCyberPaymentBordereauExtractId,\n\t\tAuditId AS AuditID,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tRunDate,\n\t\tProductCode,\n\t\tCompany,\n\t\tPolicyNumber,\n\t\tTransactionCode,\n\t\tTransactionEffectiveDate,\n\t\tCoverageEffectiveDate,\n\t\tCoverageExpirationDate,\n\t\tCoverageGrossPremium,\n\t\tCoverageNetPremium,\n\t\tPreviousPolicyNumber,\n\t\tProgramID,\n\t\tNameOfInsured,\n\t\tContractNumber\n\tFROM HSBCyberPaymentBordereauExtract\n\tWHERE AuditId=@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID}\n),\nAGG_PaymentBordereauxRecord AS (\n\tSELECT\n\t'CONTROL' AS Record_Type,\n\tRunDate,\n\tCompany,\n\tCoverageGrossPremium,\n\tCoverageNetPremium,\n\t-- *INF*: Count(1)\n\tCount(1) AS RecordCount,\n\t-- *INF*: Sum(CoverageGrossPremium)\n\tSum(CoverageGrossPremium) AS SumCoverageGrossPremium,\n\t-- *INF*: Sum(CoverageNetPremium)\n\tSum(CoverageNetPremium) AS SumCoverageNetPremium,\n\t-- *INF*: to_char(RunDate, 'YYYYMM')\n\tto_char(RunDate, 'YYYYMM') AS Reporting_Period,\n\t'08.04' AS Version_Number,\n\t'' AS Filler\n\tFROM SQ_HSBCyberPaymentBordereauExtractCntl\n\tGROUP BY Company, Reporting_Period\n),\nHSBCyberPaymentBordereauxRecordControlFile AS (\n\tINSERT INTO HSBCyberPaymentBordereauxRecordControlFile\n\t(Control, Company, RecordCount, SumCoverageGrossPremium, SumCoverageNetPremium, RunDateYYYYMMDD, HardCodeString, HardCodeString2)\n\tSELECT \n\tRecord_Type AS CONTROL, \n\tCOMPANY, \n\tRECORDCOUNT, \n\tSUMCOVERAGEGROSSPREMIUM, \n\tSUMCOVERAGENETPREMIUM, \n\tReporting_Period AS RUNDATEYYYYMMDD, \n\tVersion_Number AS HARDCODESTRING, \n\tFiller AS HARDCODESTRING2\n\tFROM AGG_PaymentBordereauxRecord\n),\nSQ_HSBCyberPolicyExtractCntl AS (\n\tSELECT\n\t\tHSBCyberPolicyExtractId,\n\t\tAuditId AS AuditID,\n\t\tCreatedDate,\n\t\tModifiedDate,\n\t\tRunDate,\n\t\tCompany,\n\t\tProductCode,\n\t\tContractNumber,\n\t\tPolicyNumber,\n\t\tCyberCoverageEffectiveDate AS PolicyEffectiveDate,\n\t\tCyberCoverageExpirationDate AS PolicyExpirationDate,\n\t\tNameOfInsured,\n\t\tMailingAddressStreetName,\n\t\tMailingAddressCity,\n\t\tMailingAddressState,\n\t\tMailingAddressZipCode,\n\t\tTotalPackageGrossPremium,\n\t\tTotalPropertyGrossPremium,\n\t\tCyberGrossPremium AS GrossPremium,\n\t\tCyberNetPremium AS NetPremium,\n\t\tFirstPartyLimit,\n\t\tFirstPartyDeductible,\n\t\tOccupancyCode,\n\t\tPolicyTotalInsuredValue,\n\t\tPreviousPolicyNumber,\n\t\tAgentCode AS AgencyCode,\n\t\tBranchCode,\n\t\tFirstPartyCoverage,\n\t\tThirdPartyLimit,\n\t\tThirdPartyDeductible,\n\t\tThirdPartyCoverage,\n\t\tExtortionSublimit\n\tFROM HSBCyberPolicyExtract\n\tWHERE convert(date,CyberCoverageEffectiveDate)<=@{pipeline().parameters.RUNDATE}\r\n\tAND \r\n\tconvert(date,CyberCoverageExpirationDate)>=@{pipeline().parameters.RUNDATE}\n),\nAGGTRANS AS (\n\tSELECT\n\tRunDate,\n\tCompany,\n\tProductCode AS ProductName,\n\t'CONTROL' AS Record_Type,\n\t-- *INF*: COUNT(1)\n\tCOUNT(1) AS Number_of_Records,\n\t-- *INF*: TO_CHAR(RunDate, 'YYYYMMDD')\n\tTO_CHAR(RunDate, 'YYYYMMDD') AS Inforce_Date,\n\t'01.01' AS Version_Number,\n\t'' AS Filler\n\tFROM SQ_HSBCyberPolicyExtractCntl\n\tGROUP BY \n),\nHSBCyberPolicyRecordControlFile AS (\n\tINSERT INTO HSBCyberPolicyRecordControlFile\n\t(Company, ProductCode, Control, RecordCount, RunDateYYYYMMDD, HardCodeString, HardCodeString2)\n\tSELECT \n\tCOMPANY, \n\tProductName AS PRODUCTCODE, \n\tRecord_Type AS CONTROL, \n\tNumber_of_Records AS RECORDCOUNT, \n\tInforce_Date AS RUNDATEYYYYMMDD, \n\tVersion_Number AS HARDCODESTRING, \n\tFiller AS HARDCODESTRING2\n\tFROM AGGTRANS\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "RUNDATE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "PolicyDataServices/"
        },
        "annotations": []
    }
}