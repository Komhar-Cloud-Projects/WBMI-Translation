{
    "name": "m_QTE_DW_Load_Party_DCT",
    "properties": {
        "activities": [
            {
                "name": "m_QTE_DW_Load_Party_DCT",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_WorkDCTPolicy AS (\n\tSELECT\n\t\tSessionId,\n\t\tName,\n\t\tFirstName,\n\t\tLastName,\n\t\tMiddleName,\n\t\tTitle,\n\t\tCustomerNum,\n\t\tSICCode,\n\t\tSICCodeDesc,\n\t\tNAICSCode,\n\t\tNAICSCodeDesc,\n\t\tInceptionDate,\n\t\tEntityType,\n\t\tAssociation,\n\t\tDoingBusinessAs,\n\t\tPhoneNumber\n\tFROM WorkDCTPolicy\n\tON WorkDCTPolicy.QuoteActionTimeStamp is not null\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n),\nAGG_Remove_Duplicates AS (\n\tSELECT\n\tSessionId AS i_SessionId, \n\tName AS i_Name, \n\tFirstName AS i_FirstName, \n\tLastName AS i_LastName, \n\tMiddleName AS i_MiddleName, \n\tTitle AS i_Title, \n\tCustomerNum, \n\tSICCode AS i_SICCode, \n\tSICCodeDesc AS i_SICCodeDesc, \n\tNAICSCode AS i_NAICSCode, \n\tNAICSCodeDesc AS i_NAICSCodeDesc, \n\tInceptionDate AS i_InceptionDate, \n\tEntityType AS i_EntityType, \n\tAssociation AS i_Association, \n\tDoingBusinessAs AS i_DoingBusinessAs, \n\tPhoneNumber AS PrimaryPhoneNumber, \n\ti_Name AS o_Name, \n\ti_FirstName AS o_FirstName, \n\ti_LastName AS o_LastName, \n\ti_MiddleName AS o_MiddleName, \n\ti_Title AS o_PrefixTitleCode, \n\tLTRIM(RTRIM(CustomerNum)) AS o_PartyNumber, \n\ti_SICCode AS o_SicCode, \n\ti_SICCodeDesc AS o_SicCodeTitle, \n\ti_NAICSCode AS o_NaicsCode, \n\ti_NAICSCodeDesc AS o_NaicsCodeTitle, \n\ti_InceptionDate AS o_OriginalPolicyInceptionDate, \n\ti_EntityType AS o_EntityType, \n\ti_Association AS o_Association, \n\ti_DoingBusinessAs AS o_DoingBusinessAs\n\tFROM SQ_WorkDCTPolicy\n\tGROUP BY o_PartyNumber\n),\nLKP_Party AS (\n\tSELECT\n\tPartyAKId,\n\tPrimaryPhoneNumber,\n\tOriginalPolicyInceptionDate,\n\tName,\n\tDoingBusinessAs,\n\tLegalEntityTypeCode,\n\tSicCode,\n\tSicCodeTitle,\n\tNaicsCode,\n\tNaicsCodeTitle,\n\tPrefixTitleCode,\n\tFirstName,\n\tMiddleName,\n\tLastName,\n\tPartyNumber\n\tFROM (\n\t\tSELECT \n\t\t\tPartyAKId,\n\t\t\tPrimaryPhoneNumber,\n\t\t\tOriginalPolicyInceptionDate,\n\t\t\tName,\n\t\t\tDoingBusinessAs,\n\t\t\tLegalEntityTypeCode,\n\t\t\tSicCode,\n\t\t\tSicCodeTitle,\n\t\t\tNaicsCode,\n\t\t\tNaicsCodeTitle,\n\t\t\tPrefixTitleCode,\n\t\t\tFirstName,\n\t\t\tMiddleName,\n\t\t\tLastName,\n\t\t\tPartyNumber\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.Party\n\t\tWHERE CurrentSnapshotFlag='1' AND SourceSystemID = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\r\n\t\tand exists (\r\n\t\tselect 1 from @{pipeline().parameters.SOURCE_DATABASE_NAME}.@{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkDCTPolicy w\r\n\t\twhere LTRIM(RTRIM(w.CustomerNum))=Party.PartyNumber)\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PartyNumber ORDER BY PartyAKId) = 1\n),\nEXP_Detect_Change AS (\n\tSELECT\n\tLKP_Party.PartyAKId AS lkp_PartyAKId,\n\tLKP_Party.PrimaryPhoneNumber AS lkp_PrimaryPhoneNumber,\n\tLKP_Party.OriginalPolicyInceptionDate AS lkp_OriginalPolicyInceptionDate,\n\tLKP_Party.Name AS lkp_Name,\n\tLKP_Party.DoingBusinessAs AS lkp_DoingBusinessAs,\n\tLKP_Party.LegalEntityTypeCode AS lkp_LegalEntityTypeCode,\n\tLKP_Party.SicCode AS lkp_SicCode,\n\tLKP_Party.SicCodeTitle AS lkp_SicCodeTitle,\n\tLKP_Party.NaicsCode AS lkp_NaicsCode,\n\tLKP_Party.NaicsCodeTitle AS lkp_NaicsCodeTitle,\n\tLKP_Party.PrefixTitleCode AS lkp_PrefixTitleCode,\n\tLKP_Party.FirstName AS lkp_FirstName,\n\tLKP_Party.MiddleName AS lkp_MiddleName,\n\tLKP_Party.LastName AS lkp_LastName,\n\tAGG_Remove_Duplicates.PrimaryPhoneNumber AS i_PrimaryPhoneNumber,\n\tAGG_Remove_Duplicates.o_Name AS i_Name,\n\tAGG_Remove_Duplicates.o_FirstName AS i_FirstName,\n\tAGG_Remove_Duplicates.o_LastName AS i_LastName,\n\tAGG_Remove_Duplicates.o_MiddleName AS i_MiddleName,\n\tAGG_Remove_Duplicates.o_PrefixTitleCode AS i_PrefixTitleCode,\n\tAGG_Remove_Duplicates.o_PartyNumber AS i_PartyNumber,\n\tAGG_Remove_Duplicates.o_SicCode AS i_SicCode,\n\tAGG_Remove_Duplicates.o_SicCodeTitle AS i_SicCodeTitle,\n\tAGG_Remove_Duplicates.o_NaicsCode AS i_NaicsCode,\n\tAGG_Remove_Duplicates.o_NaicsCodeTitle AS i_NaicsCodeTitle,\n\tAGG_Remove_Duplicates.o_OriginalPolicyInceptionDate AS i_OriginalPolicyInceptionDate,\n\tAGG_Remove_Duplicates.o_EntityType AS i_EntityType,\n\tAGG_Remove_Duplicates.o_Association AS i_AssociationCode,\n\tAGG_Remove_Duplicates.o_DoingBusinessAs AS i_DoingBusinessAs,\n\t'TBD' AS i_PrimaryEmailAddress,\n\t'N/A' AS i_LegalName,\n\t'N/A' AS i_LegalEntityTypeDescription,\n\t'N/A' AS i_OrganizationLegalStatusName,\n\t'N/A' AS i_OrganizationLegalStatusAbbreviation,\n\t'N/A' AS i_PrimaryOperationsDescription,\n\t'N/A' AS i_Suffix,\n\t'TBD' AS i_SocialSecurityNumber,\n\t-- *INF*: IIF(ISNULL(i_PrimaryPhoneNumber) or IS_SPACES(i_PrimaryPhoneNumber) or LENGTH(i_PrimaryPhoneNumber)=0,'N/A',LTRIM(RTRIM(i_PrimaryPhoneNumber)))\n\tIFF(i_PrimaryPhoneNumber IS NULL OR IS_SPACES(i_PrimaryPhoneNumber) OR LENGTH(i_PrimaryPhoneNumber) = 0, 'N/A', LTRIM(RTRIM(i_PrimaryPhoneNumber))) AS v_PrimaryPhoneNumber,\n\t-- *INF*: IIF(ISNULL(i_Name) or IS_SPACES(i_Name) or LENGTH(i_Name)=0,'N/A',LTRIM(RTRIM(i_Name)))\n\tIFF(i_Name IS NULL OR IS_SPACES(i_Name) OR LENGTH(i_Name) = 0, 'N/A', LTRIM(RTRIM(i_Name))) AS v_Name,\n\t-- *INF*: IIF(ISNULL(i_DoingBusinessAs) or IS_SPACES(i_DoingBusinessAs) or LENGTH(i_DoingBusinessAs)=0,'N/A',LTRIM(RTRIM(i_DoingBusinessAs)))\n\tIFF(i_DoingBusinessAs IS NULL OR IS_SPACES(i_DoingBusinessAs) OR LENGTH(i_DoingBusinessAs) = 0, 'N/A', LTRIM(RTRIM(i_DoingBusinessAs))) AS v_DoingBusinessAs,\n\t-- *INF*: IIF(ISNULL(i_EntityType) OR IS_SPACES(i_EntityType) OR LENGTH(i_EntityType)=0,'N/A',LTRIM(RTRIM(i_EntityType)))\n\tIFF(i_EntityType IS NULL OR IS_SPACES(i_EntityType) OR LENGTH(i_EntityType) = 0, 'N/A', LTRIM(RTRIM(i_EntityType))) AS v_LegalEntityTypeCode,\n\t-- *INF*: IIF(ISNULL(i_SicCode) OR IS_SPACES(i_SicCode) OR LENGTH(i_SicCode)=0,'N/A',LTRIM(RTRIM(i_SicCode)))\n\tIFF(i_SicCode IS NULL OR IS_SPACES(i_SicCode) OR LENGTH(i_SicCode) = 0, 'N/A', LTRIM(RTRIM(i_SicCode))) AS v_SicCode,\n\t-- *INF*: IIF(ISNULL(i_SicCodeTitle) OR IS_SPACES(i_SicCodeTitle) OR LENGTH(i_SicCodeTitle)=0,'N/A',LTRIM(RTRIM(i_SicCodeTitle)))\n\tIFF(i_SicCodeTitle IS NULL OR IS_SPACES(i_SicCodeTitle) OR LENGTH(i_SicCodeTitle) = 0, 'N/A', LTRIM(RTRIM(i_SicCodeTitle))) AS v_SicCodeTitle,\n\t-- *INF*: IIF(ISNULL(i_NaicsCode) OR IS_SPACES(i_NaicsCode) OR LENGTH(i_NaicsCode)=0,'N/A',LTRIM(RTRIM(i_NaicsCode)))\n\tIFF(i_NaicsCode IS NULL OR IS_SPACES(i_NaicsCode) OR LENGTH(i_NaicsCode) = 0, 'N/A', LTRIM(RTRIM(i_NaicsCode))) AS v_NaicsCode,\n\t-- *INF*: IIF(ISNULL(i_NaicsCodeTitle) OR IS_SPACES(i_NaicsCodeTitle) OR LENGTH(i_NaicsCodeTitle)=0,'N/A',LTRIM(RTRIM(i_NaicsCodeTitle)))\n\tIFF(i_NaicsCodeTitle IS NULL OR IS_SPACES(i_NaicsCodeTitle) OR LENGTH(i_NaicsCodeTitle) = 0, 'N/A', LTRIM(RTRIM(i_NaicsCodeTitle))) AS v_NaicsCodeTitle,\n\t-- *INF*: IIF(ISNULL(i_PrefixTitleCode) OR IS_SPACES(i_PrefixTitleCode) OR LENGTH(i_PrefixTitleCode)=0,'N/A',LTRIM(RTRIM(i_PrefixTitleCode)))\n\tIFF(i_PrefixTitleCode IS NULL OR IS_SPACES(i_PrefixTitleCode) OR LENGTH(i_PrefixTitleCode) = 0, 'N/A', LTRIM(RTRIM(i_PrefixTitleCode))) AS v_PrefixTitleCode,\n\t-- *INF*: IIF(ISNULL(i_FirstName) OR IS_SPACES(i_FirstName) OR LENGTH(i_FirstName)=0,'N/A',LTRIM(RTRIM(i_FirstName)))\n\tIFF(i_FirstName IS NULL OR IS_SPACES(i_FirstName) OR LENGTH(i_FirstName) = 0, 'N/A', LTRIM(RTRIM(i_FirstName))) AS v_FirstName,\n\t-- *INF*: IIF(ISNULL(i_MiddleName) OR IS_SPACES(i_MiddleName) OR LENGTH(i_MiddleName)=0,'N/A',LTRIM(RTRIM(i_MiddleName)))\n\tIFF(i_MiddleName IS NULL OR IS_SPACES(i_MiddleName) OR LENGTH(i_MiddleName) = 0, 'N/A', LTRIM(RTRIM(i_MiddleName))) AS v_MiddleName,\n\t-- *INF*: IIF(ISNULL(i_LastName) OR IS_SPACES(i_LastName) OR LENGTH(i_LastName)=0,'N/A',LTRIM(RTRIM(i_LastName)))\n\tIFF(i_LastName IS NULL OR IS_SPACES(i_LastName) OR LENGTH(i_LastName) = 0, 'N/A', LTRIM(RTRIM(i_LastName))) AS v_LastName,\n\t-- *INF*: IIF(ISNULL(i_OriginalPolicyInceptionDate), TO_DATE('01/01/1800 00:00:00','MM/DD/YYYY HH24:MI:SS'), i_OriginalPolicyInceptionDate)\n\tIFF(i_OriginalPolicyInceptionDate IS NULL, TO_DATE('01/01/1800 00:00:00', 'MM/DD/YYYY HH24:MI:SS'), i_OriginalPolicyInceptionDate) AS v_OriginalPolicyInceptionDate,\n\t-- *INF*: IIF(ISNULL(i_AssociationCode) OR IS_SPACES(i_AssociationCode) OR LENGTH(i_AssociationCode)=0,'N/A',LTRIM(RTRIM(i_AssociationCode)))\n\tIFF(i_AssociationCode IS NULL OR IS_SPACES(i_AssociationCode) OR LENGTH(i_AssociationCode) = 0, 'N/A', LTRIM(RTRIM(i_AssociationCode))) AS v_AssociationCode,\n\t-- *INF*: IIF(ISNULL(lkp_PartyAKId), 'NEW', \r\n\t-- IIF(\r\n\t-- lkp_PrimaryPhoneNumber != v_PrimaryPhoneNumber OR\r\n\t-- lkp_OriginalPolicyInceptionDate != v_OriginalPolicyInceptionDate OR\r\n\t-- lkp_Name != v_Name OR\t\r\n\t-- lkp_DoingBusinessAs != v_DoingBusinessAs OR \r\n\t-- lkp_LegalEntityTypeCode != v_LegalEntityTypeCode OR \r\n\t-- lkp_SicCode != v_SicCode OR\r\n\t-- lkp_SicCodeTitle != v_SicCodeTitle OR\r\n\t-- lkp_NaicsCode != v_NaicsCode OR\r\n\t-- lkp_NaicsCodeTitle != v_NaicsCodeTitle OR\r\n\t-- lkp_PrefixTitleCode != v_PrefixTitleCode OR\r\n\t-- lkp_FirstName != v_FirstName OR\r\n\t-- lkp_MiddleName != v_MiddleName OR\r\n\t-- lkp_LastName != v_LastName,\r\n\t-- 'UPDATE', 'NOCHANGE'))\n\tIFF(lkp_PartyAKId IS NULL, 'NEW', IFF(lkp_PrimaryPhoneNumber != v_PrimaryPhoneNumber OR lkp_OriginalPolicyInceptionDate != v_OriginalPolicyInceptionDate OR lkp_Name != v_Name OR lkp_DoingBusinessAs != v_DoingBusinessAs OR lkp_LegalEntityTypeCode != v_LegalEntityTypeCode OR lkp_SicCode != v_SicCode OR lkp_SicCodeTitle != v_SicCodeTitle OR lkp_NaicsCode != v_NaicsCode OR lkp_NaicsCodeTitle != v_NaicsCodeTitle OR lkp_PrefixTitleCode != v_PrefixTitleCode OR lkp_FirstName != v_FirstName OR lkp_MiddleName != v_MiddleName OR lkp_LastName != v_LastName, 'UPDATE', 'NOCHANGE')) AS o_ChangeFlag,\n\tlkp_PartyAKId AS o_PartyAKId,\n\t-- *INF*: IIF(ISNULL(i_PartyNumber),'N/A',i_PartyNumber)\n\tIFF(i_PartyNumber IS NULL, 'N/A', i_PartyNumber) AS o_PartyNumber,\n\tv_PrimaryPhoneNumber AS o_PrimaryPhoneNumber,\n\tv_OriginalPolicyInceptionDate AS o_OriginalPolicyInceptionDate,\n\t'Not Deleted' AS o_DeletedIndicator,\n\t'Active' AS o_StatusCode,\n\tv_Name AS o_Name,\n\tv_DoingBusinessAs AS o_DoingBusinessAs,\n\tv_LegalEntityTypeCode AS o_LegalEntityTypeCode,\n\tv_SicCode AS o_SicCode,\n\tv_SicCodeTitle AS o_SicCodeTitle,\n\tv_NaicsCode AS o_NaicsCode,\n\tv_NaicsCodeTitle AS o_NaicsCodeTitle,\n\tv_PrefixTitleCode AS o_PrefixTitleCode,\n\tv_FirstName AS o_FirstName,\n\tv_MiddleName AS o_MiddleName,\n\tv_LastName AS o_LastName,\n\tv_AssociationCode AS o_AssociationCode\n\tFROM AGG_Remove_Duplicates\n\tLEFT JOIN LKP_Party\n\tON LKP_Party.PartyNumber = AGG_Remove_Duplicates.o_PartyNumber\n),\nLKP_Association AS (\n\tSELECT\n\tAssociationId,\n\tAssociationCode\n\tFROM (\n\t\tSELECT \n\t\t\tAssociationId,\n\t\t\tAssociationCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.Association\n\t\tWHERE CurrentSnapshotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY AssociationCode ORDER BY AssociationId) = 1\n),\nFIL_Insert AS (\n\tSELECT\n\tEXP_Detect_Change.o_ChangeFlag AS ChangeFlag, \n\tEXP_Detect_Change.o_PartyAKId AS PartyAKId, \n\tEXP_Detect_Change.o_PartyNumber AS PartyNumber, \n\tEXP_Detect_Change.o_PrimaryPhoneNumber AS PrimaryPhoneNumber, \n\tEXP_Detect_Change.o_OriginalPolicyInceptionDate AS OriginalPolicyInceptionDate, \n\tEXP_Detect_Change.o_DeletedIndicator AS DeletedIndicator, \n\tEXP_Detect_Change.o_StatusCode AS StatusCode, \n\tEXP_Detect_Change.o_Name AS Name, \n\tEXP_Detect_Change.o_DoingBusinessAs AS DoingBusinessAs, \n\tEXP_Detect_Change.o_LegalEntityTypeCode AS LegalEntityTypeCode, \n\tEXP_Detect_Change.o_SicCode AS SicCode, \n\tEXP_Detect_Change.o_SicCodeTitle AS SicCodeTitle, \n\tEXP_Detect_Change.o_NaicsCode AS NaicsCode, \n\tEXP_Detect_Change.o_NaicsCodeTitle AS NaicsCodeTitle, \n\tEXP_Detect_Change.o_PrefixTitleCode AS PrefixTitleCode, \n\tEXP_Detect_Change.o_FirstName AS FirstName, \n\tEXP_Detect_Change.o_MiddleName AS MiddleName, \n\tEXP_Detect_Change.o_LastName AS LastName, \n\tLKP_Association.AssociationId, \n\tEXP_Detect_Change.o_AssociationCode AS AssociationCode\n\tFROM EXP_Detect_Change\n\tLEFT JOIN LKP_Association\n\tON LKP_Association.AssociationCode = EXP_Detect_Change.o_AssociationCode\n\tWHERE (ChangeFlag='NEW' OR ChangeFlag='UPDATE')\n),\nSEQ_Party_AK_ID AS (\n\tCREATE SEQUENCE SEQ_Party_AK_ID\n\tSTART = 0\n\tINCREMENT = 1;\n),\nEXP_Determine_AK_ID AS (\n\tSELECT\n\tSEQ_Party_AK_ID.NEXTVAL,\n\tChangeFlag AS i_ChangeFlag,\n\tPartyAKId AS i_PartyAKId,\n\tPartyNumber AS i_PartyNumber,\n\tPrimaryPhoneNumber AS i_PrimaryPhoneNumber,\n\tOriginalPolicyInceptionDate AS i_OriginalPolicyInceptionDate,\n\tDeletedIndicator AS i_DeletedIndicator,\n\tStatusCode AS i_StatusCode,\n\tName AS i_Name,\n\tDoingBusinessAs AS i_DoingBusinessAs,\n\tLegalEntityTypeCode AS i_LegalEntityTypeCode,\n\tSicCode AS i_SicCode,\n\tSicCodeTitle AS i_SicCodeTitle,\n\tNaicsCode AS i_NaicsCode,\n\tNaicsCodeTitle AS i_NaicsCodeTitle,\n\tPrefixTitleCode AS i_PrefixTitleCode,\n\tFirstName AS i_FirstName,\n\tMiddleName AS i_MiddleName,\n\tLastName AS i_LastName,\n\tAssociationId AS i_AssociationId,\n\tAssociationCode AS i_AssociationCode,\n\t'1' AS o_CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t-- *INF*: IIF(i_ChangeFlag='NEW',\r\n\t-- \tTO_DATE('01/01/1800 00:00:00','MM/DD/YYYY HH24:MI:SS'),SYSDATE)\n\tIFF(i_ChangeFlag = 'NEW', TO_DATE('01/01/1800 00:00:00', 'MM/DD/YYYY HH24:MI:SS'), SYSDATE) AS o_EffectiveDate,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS o_ExpirationDate,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemID,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\t-- *INF*: IIF(ISNULL(i_PartyAKId),NEXTVAL,i_PartyAKId)\n\tIFF(i_PartyAKId IS NULL, NEXTVAL, i_PartyAKId) AS o_PartyAKId,\n\ti_PartyNumber AS o_PartyNumber,\n\ti_PrimaryPhoneNumber AS o_PrimaryPhoneNumber,\n\ti_OriginalPolicyInceptionDate AS o_OriginalPolicyInceptionDate,\n\ti_DeletedIndicator AS o_DeletedIndicator,\n\ti_StatusCode AS o_StatusCode,\n\ti_Name AS o_Name,\n\ti_DoingBusinessAs AS o_DoingBusinessAs,\n\ti_LegalEntityTypeCode AS o_LegalEntityTypeCode,\n\ti_SicCode AS o_SicCode,\n\ti_SicCodeTitle AS o_SicCodeTitle,\n\ti_NaicsCode AS o_NaicsCode,\n\ti_NaicsCodeTitle AS o_NaicsCodeTitle,\n\ti_PrefixTitleCode AS o_PrefixTitleCode,\n\ti_FirstName AS o_FirstName,\n\ti_MiddleName AS o_MiddleName,\n\ti_LastName AS o_LastName,\n\t-- *INF*: IIF(ISNULL(i_AssociationId),-1,i_AssociationId)\n\tIFF(i_AssociationId IS NULL, - 1, i_AssociationId) AS o_AssociationId,\n\ti_AssociationCode AS o_AssociationCode\n\tFROM FIL_Insert\n),\nTGT_Party_Insert AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.Party\n\t(CurrentSnapshotFlag, AuditId, EffectiveDate, ExpirationDate, SourceSystemId, CreatedDate, ModifiedDate, PartyAKId, PartyNumber, PrimaryPhoneNumber, OriginalPolicyInceptionDate, DeletedIndicator, StatusCode, Name, DoingBusinessAs, LegalEntityTypeCode, SICCode, SICCodeTitle, NAICSCode, NAICSCodeTitle, PrefixTitleCode, FirstName, MiddleName, LastName, AssociationId, AssociationCode)\n\tSELECT \n\to_CurrentSnapshotFlag AS CURRENTSNAPSHOTFLAG, \n\to_AuditID AS AUDITID, \n\to_EffectiveDate AS EFFECTIVEDATE, \n\to_ExpirationDate AS EXPIRATIONDATE, \n\to_SourceSystemID AS SOURCESYSTEMID, \n\to_CreatedDate AS CREATEDDATE, \n\to_ModifiedDate AS MODIFIEDDATE, \n\to_PartyAKId AS PARTYAKID, \n\to_PartyNumber AS PARTYNUMBER, \n\to_PrimaryPhoneNumber AS PRIMARYPHONENUMBER, \n\to_OriginalPolicyInceptionDate AS ORIGINALPOLICYINCEPTIONDATE, \n\to_DeletedIndicator AS DELETEDINDICATOR, \n\to_StatusCode AS STATUSCODE, \n\to_Name AS NAME, \n\to_DoingBusinessAs AS DOINGBUSINESSAS, \n\to_LegalEntityTypeCode AS LEGALENTITYTYPECODE, \n\to_SicCode AS SICCODE, \n\to_SicCodeTitle AS SICCODETITLE, \n\to_NaicsCode AS NAICSCODE, \n\to_NaicsCodeTitle AS NAICSCODETITLE, \n\to_PrefixTitleCode AS PREFIXTITLECODE, \n\to_FirstName AS FIRSTNAME, \n\to_MiddleName AS MIDDLENAME, \n\to_LastName AS LASTNAME, \n\to_AssociationId AS ASSOCIATIONID, \n\to_AssociationCode AS ASSOCIATIONCODE\n\tFROM EXP_Determine_AK_ID\n),\nSQ_Party AS (\n\tSELECT \r\n\t\tPartyId,\r\n\t\tEffectiveDate, \r\n\t\tExpirationDate,\r\n\t\tPartyAKId\r\n\tFROM\r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.Party a\r\n\tWHERE  EXISTS\r\n\t\t (SELECT 1\r\n\t\t FROM @{pipeline().parameters.TARGET_TABLE_OWNER}.Party b \r\n\t\t   WHERE CurrentSnapshotFlag = 1 and SourceSystemID = '@{pipeline().parameters.SOURCE_SYSTEM_ID}' \r\n\t\t    and a.PartyAKId= b.PartyAKId\r\n\tGROUP BY  PartyAKId  HAVING count(*) > 1)\r\n\tORDER BY  PartyAKId ,EffectiveDate  DESC\n),\nEXP_Lag_eff_from_date AS (\n\tSELECT\n\tPartyId AS i_PartyId,\n\tEffectiveDate AS i_eff_from_date,\n\tExpirationDate AS i_orig_eff_to_date,\n\tPartyAKId AS i_PartyAKID,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_PartyAKID = v_PrevPartyAKID ,\r\n\t-- ADD_TO_DATE(v_prev_eff_from_date,'SS',-1),i_orig_eff_to_date)\n\tDECODE(TRUE,\n\ti_PartyAKID = v_PrevPartyAKID, ADD_TO_DATE(v_prev_eff_from_date, 'SS', - 1),\n\ti_orig_eff_to_date) AS v_eff_to_date,\n\ti_PartyAKID AS v_PrevPartyAKID,\n\ti_eff_from_date AS v_prev_eff_from_date,\n\ti_PartyId AS o_PartyId,\n\ti_orig_eff_to_date AS o_orig_eff_to_date,\n\t0 AS o_crrnt_snpsht_flag,\n\tv_eff_to_date AS o_eff_to_date,\n\tSYSDATE AS o_modified_date\n\tFROM SQ_Party\n),\nFIL_FirstRowInAKGroup AS (\n\tSELECT\n\to_PartyId AS PartyId, \n\to_orig_eff_to_date AS orig_eff_to_date, \n\to_crrnt_snpsht_flag AS crrnt_snpsht_flag, \n\to_eff_to_date AS eff_to_date, \n\to_modified_date AS modified_date\n\tFROM EXP_Lag_eff_from_date\n\tWHERE orig_eff_to_date != eff_to_date\n),\nUPD_Party AS (\n\tSELECT\n\tPartyId, \n\tcrrnt_snpsht_flag, \n\teff_to_date, \n\tmodified_date\n\tFROM FIL_FirstRowInAKGroup\n),\nTGT_Party_Update AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.Party AS T\n\tUSING UPD_Party AS S\n\tON T.PartyId = S.PartyId\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.CurrentSnapshotFlag = S.crrnt_snpsht_flag, T.ExpirationDate = S.eff_to_date, T.ModifiedDate = S.modified_date\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246494"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905492"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7603303"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/29/2023 22:45:05"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 23:03:49"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Stage_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "DCT"
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "WC_Stage"
            },
            "WHERE_CLAUSE ": {
                "type": "string",
                "defaultValue": "and WorkDCTPolicy.QuoteActionStatus IS NOT NULL and WorkDCTPolicy.TransactionType='New'"
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "Quote DataWarehouse/"
        },
        "annotations": []
    }
}