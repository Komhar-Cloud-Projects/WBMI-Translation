{
    "name": "s_m_CLM_DW_LOAD_EOR_medical_bill_CLogic",
    "properties": {
        "activities": [
            {
                "name": "m_CLM_DW_LOAD_EOR_medical_bill_CLogic",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_claim_occurrence AS (\n\tSELECT\n\tclaim_occurrence_ak_id,\n\tclaim_occurrence_key,\n\tin_claim_occurrence_key\n\tFROM (\n\t\tSELECT \r\n\t\tclaim_occurrence.claim_occurrence_ak_id as claim_occurrence_ak_id, \r\n\t\trtrim(claim_occurrence.claim_occurrence_key) as claim_occurrence_key \r\n\t\tFROM \r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.claim_occurrence claim_occurrence\r\n\t\tWHERE\r\n\t\tcrrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_occurrence_key ORDER BY claim_occurrence_ak_id) = 1\n),\nSQ_med_bill_stage AS (\n\tSELECT \r\n\trtrim(med_bill_stage.med_bill_id), \r\n\tCASE rtrim(med_bill_stage.vendor_bill_num) when '' then 'N/A' ELSE rtrim(med_bill_stage.vendor_bill_num) END, \r\n\tCASE rtrim(med_bill_stage.pt_acct_num) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.pt_acct_num) END,\r\n\tCASE rtrim(med_bill_stage.pt_last_name) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.pt_last_name) END ,\r\n\tCASE rtrim(med_bill_stage.pt_first_name) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.pt_first_name) END,\r\n\tCASE rtrim(med_bill_stage.pt_mid_name) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.pt_mid_name) END,\r\n\tCASE rtrim(med_bill_stage.pt_addr) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.pt_addr) END,\r\n\tCASE rtrim(med_bill_stage.pt_city) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.pt_city) END ,\r\n\tCASE rtrim(med_bill_stage.pt_state) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.pt_state) END,\r\n\tCASE  rtrim(med_bill_stage.pt_zip_code) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.pt_zip_code) END,\r\n\tmed_bill_stage.pt_dob  ,\r\n\tCASE rtrim(med_bill_stage.pt_gndr) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.pt_gndr) END,\r\n\tCASE rtrim(med_bill_stage.pt_ssn) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.pt_ssn) END,\r\n\tmed_bill_stage.pt_inj_dt,\r\n\tCASE rtrim(med_bill_stage.refer_physician) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.refer_physician) END,\r\n\tmed_bill_stage.serv_from_date,\r\n\tmed_bill_stage.serv_to_date ,\r\n\tCASE rtrim(med_bill_stage.inpt_outpt_ind) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.inpt_outpt_ind) END,\r\n\tmed_bill_stage.bill_issued_date,\r\n\tmed_bill_stage.bill_rcvd_date,\r\n\tmed_bill_stage.bus_rcvd_date,\r\n\tmed_bill_stage.bill_process_date,\r\n\tmed_bill_stage.pt_admit_date,\r\n\tmed_bill_stage.pt_discharge_date ,\r\n\tCASE med_bill_stage.daily_hospital_rt WHEN NULL THEN 0 ELSE med_bill_stage.daily_hospital_rt END ,\r\n\tCASE med_bill_stage.bill_review_cost WHEN NULL THEN 0 ELSE med_bill_stage.bill_review_cost  END,\r\n\tCASE med_bill_stage.total_bill_charge WHEN NULL THEN 0 ELSE med_bill_stage.total_bill_charge  END,\r\n\tCASE med_bill_stage.total_bill_red WHEN NULL THEN 0 ELSE med_bill_stage.total_bill_red  END,\r\n\tCASE med_bill_stage.total_network_red WHEN NULL THEN 0 ELSE med_bill_stage.total_network_red  END,\r\n\tCASE med_bill_stage.total_recom_pay WHEN NULL THEN 0 ELSE med_bill_stage.total_recom_pay  END,\r\n\tCASE med_bill_stage.total_addtl_charge WHEN NULL THEN 0 ELSE med_bill_stage.total_addtl_charge  END,\r\n\tCASE rtrim(med_bill_stage.bill_type) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.bill_type) END ,\r\n\tCASE rtrim(med_bill_stage.bill_status_code) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.bill_status_code) END ,\r\n\tCASE rtrim(med_bill_stage.fee_sched_code) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.fee_sched_code) END,\r\n\tCASE rtrim(med_bill_stage.network_name) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.network_name) END,\r\n\tCASE rtrim(med_bill_stage.network_num) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.network_num) END,\r\n\tCASE med_bill_stage.serv_line_num WHEN NULL THEN 0 ELSE med_bill_stage.serv_line_num END,\r\n\tCASE rtrim(med_bill_stage.deleted_ind) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.deleted_ind) END,\r\n\tCASE rtrim(med_bill_stage.emplyr) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.emplyr) END,\r\n\tCASE rtrim(med_bill_stage.acct_id) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.acct_id) END,\r\n\tCASE rtrim(med_bill_stage.vendor_code) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.vendor_code) END,\r\n\tCASE rtrim(med_bill_stage.ebill_ind) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.ebill_ind) END,\r\n\tCASE rtrim(med_bill_stage.autopay_ind) WHEN '' THEN 'N/A' ELSE rtrim(med_bill_stage.autopay_ind) END,\r\n\tmed_bill_stage.eor_rcvd_date, \r\n\tmed_bill_stage.original_vendor_bill_num,\r\n\tCASE RTRIM(auto_adjudicated) WHEN '' THEN 'N/A' ELSE RTRIM(auto_adjudicated) END \r\n\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.med_bill_stage \r\n\torder by med_bill_stage.med_bill_id\n),\nLKP_clm_clt_eor_stage AS (\n\tSELECT\n\tin_cce_tch_bill_nbr,\n\tcce_claim_nbr,\n\tcce_client_id,\n\tcce_eor_status,\n\tdenial_reason_cd,\n\tcce_draft_nbr,\n\tcce_tch_bill_nbr\n\tFROM (\n\t\tSELECT\tRTRIM(cce_claim_nbr) as cce_claim_nbr\r\n\t\t,\t\tRTRIM(cce_client_id) as cce_client_id \r\n\t\t,\t\tRTRIM(cce_eor_status) as cce_eor_status\r\n\t\t,\t\tRTRIM(denial_reason_cd) as denial_reason_cd\r\n\t\t,\t\tRTRIM(cce_draft_nbr) as cce_draft_nbr\r\n\t\t,\t\tRTRIM(cce_tch_bill_nbr) as cce_tch_bill_nbr \r\n\t\tFROM clm_clt_eor_stage\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY cce_tch_bill_nbr ORDER BY in_cce_tch_bill_nbr) = 1\n),\nLKP_claim_party_occurrence AS (\n\tSELECT\n\tclaim_party_occurrence_ak_id,\n\tclaim_party_key,\n\tclaim_occurrence_key\n\tFROM (\n\t\tSELECT\tCPO.claim_party_occurrence_ak_id\tAS claim_party_occurrence_ak_id\r\n\t\t,\t\tRTRIM(CP.claim_party_key)\t\t\tAS claim_party_key\r\n\t\t,\t\tRTRIM(CO.claim_occurrence_key)\t\tAS claim_occurrence_key\r\n\t\tFROM\tclaim_party_occurrence\t\t\t\tCPO\r\n\t\tINNER\tJOIN vw_claim_party1\t\t\t\tCP\r\n\t\t\tON\tCP.claim_party_ak_id\t\t\t\t= CPO.claim_party_ak_id\r\n\t\tINNER\tJOIN claim_occurrence\t\t\t\tCO\r\n\t\t\tON\tCO.claim_occurrence_ak_id\t\t\t= CPO.claim_occurrence_ak_id\r\n\t\tWHERE\tCPO.crrnt_snpsht_flag = 1\r\n\t\tAND\t\tCP.crrnt_snpsht_flag = 1\r\n\t\tAND\t\tCO.crrnt_snpsht_flag = 1\r\n\t\tAND\t\tCPO.claim_party_role_code = 'CLMT'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_party_key,claim_occurrence_key ORDER BY claim_party_occurrence_ak_id) = 1\n),\nLKP_claim_payment AS (\n\tSELECT\n\tmicro_ecd_draft_num,\n\ttotal_pay_amt,\n\tpay_disbursement_date,\n\tclaim_pay_num\n\tFROM (\n\t\tSELECT \r\n\t\tclaim_payment.micro_ecd_draft_num as micro_ecd_draft_num, \r\n\t\tclaim_payment.total_pay_amt as total_pay_amt, \r\n\t\tclaim_payment.pay_disbursement_date as pay_disbursement_date, \r\n\t\trtrim(claim_payment.claim_pay_num) as claim_pay_num \r\n\t\tFROM claim_payment\r\n\t\tWHERE source_sys_Id = 'EXCEED'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_pay_num ORDER BY micro_ecd_draft_num DESC) = 1\n),\nLKP_medical_bill_vendor AS (\n\tSELECT\n\tmed_bill_vendor_ak_id,\n\tvendor_code\n\tFROM (\n\t\tSELECT\tmed_bill_vendor_ak_id AS med_bill_vendor_ak_id\r\n\t\t,\t\tvendor_code AS vendor_code\r\n\t\tFROM\tmedical_bill_vendor\r\n\t\tWHERE\tcrrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY vendor_code ORDER BY med_bill_vendor_ak_id) = 1\n),\nLKP_pms_clt_eor_stage AS (\n\tSELECT\n\tpce_policy_sym,\n\tpce_policy_num,\n\tpce_policy_mod,\n\tpce_date_of_loss,\n\tpce_occurrence,\n\tpce_paid_ts,\n\tcheck_number,\n\tamount_paid_by_chk,\n\tdenial_reason_cd,\n\tpce_tch_bill_nbr\n\tFROM (\n\t\tSELECT pms_clt_eor_stage.pce_policy_sym as pce_policy_sym, pms_clt_eor_stage.pce_policy_num as pce_policy_num, pms_clt_eor_stage.pce_policy_mod as pce_policy_mod, pms_clt_eor_stage.pce_date_of_loss as pce_date_of_loss, pms_clt_eor_stage.pce_occurrence as pce_occurrence, pms_clt_eor_stage.pce_paid_ts as pce_paid_ts, pms_clt_eor_stage.check_number as check_number, pms_clt_eor_stage.amount_paid_by_chk as amount_paid_by_chk, pms_clt_eor_stage.denial_reason_cd as denial_reason_cd, \r\n\t\trtrim(pms_clt_eor_stage.pce_tch_bill_nbr) as pce_tch_bill_nbr \r\n\t\tFROM pms_clt_eor_stage\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY pce_tch_bill_nbr ORDER BY pce_policy_sym) = 1\n),\nEXP_ASSIGN_DEFAULTS AS (\n\tSELECT\n\tSQ_med_bill_stage.med_bill_id,\n\tvendor_bill_num AS vendor_bill_num_out,\n\tpt_acct_num AS pt_acct_num_out,\n\tpt_last_name AS pt_last_name_out,\n\tpt_first_name AS pt_first_name_out,\n\tpt_mid_name AS pt_mid_name_out,\n\t-- *INF*: IIF(pt_first_name='N/A','', ' '  || pt_first_name) || \r\n\t-- IIF(pt_mid_name='N/A','', ' '  ||  pt_mid_name) || \r\n\t-- IIF(pt_last_name='N/A','', ' '  || pt_last_name) \n\tIFF(pt_first_name = 'N/A',\n\t\t'',\n\t\t' ' || pt_first_name\n\t) || IFF(pt_mid_name = 'N/A',\n\t\t'',\n\t\t' ' || pt_mid_name\n\t) || IFF(pt_last_name = 'N/A',\n\t\t'',\n\t\t' ' || pt_last_name\n\t) AS out_pt_full_name,\n\tpt_addr AS pt_addr_out,\n\tpt_city AS pt_city_out,\n\tpt_state AS pt_state_out,\n\tpt_zip_code AS pt_zip_code_out,\n\tpt_dob AS pt_dob_out,\n\tpt_gndr AS pt_gndr_out,\n\tpt_ssn AS pt_ssn_out,\n\tpt_inj_dt AS pt_inj_dt_out,\n\trefer_physician AS refer_physician_out,\n\tserv_from_date AS serv_from_date_out,\n\tserv_to_date AS serv_to_date_out,\n\tinpt_outpt_ind AS inpt_outpt_ind_out,\n\tbill_issued_date AS bill_issued_date_out,\n\tbill_rcvd_date AS bill_rcvd_date_out,\n\tbus_rcvd_date AS bus_rcvd_date_out,\n\tbill_process_date AS bill_process_date_out,\n\tpt_admit_date AS pt_admit_date_out,\n\tpt_discharge_date AS pt_discharge_date_out,\n\tdaily_hospital_rt AS daily_hospital_rt_out,\n\tbill_review_cost AS bill_review_cost_out,\n\ttotal_bill_charge AS total_bill_charge_out,\n\ttotal_bill_red AS total_bill_red_out,\n\ttotal_network_red AS total_network_red_out,\n\ttotal_recom_pay AS total_recom_pay_out,\n\ttotal_addtl_charge AS total_addtl_charge_out,\n\tbill_type AS bill_type_out,\n\tbill_status_code AS bill_status_code_out,\n\tfee_sched_code AS fee_sched_code_out,\n\tnetwork_name AS network_name_out,\n\tnetwork_num AS network_num_out,\n\tserv_line_num AS serv_line_num_out,\n\tdeleted_ind AS deleted_ind_out,\n\templyr AS emplyr_out,\n\tacct_id AS acct_id_out,\n\tvendor_code AS vendor_code_out,\n\t1 AS crrnt_snpsht_flag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS audit_id,\n\tSQ_med_bill_stage.vendor_bill_num,\n\tSQ_med_bill_stage.pt_acct_num,\n\tSQ_med_bill_stage.pt_last_name,\n\tSQ_med_bill_stage.pt_first_name,\n\tSQ_med_bill_stage.pt_mid_name,\n\tSQ_med_bill_stage.pt_addr,\n\tSQ_med_bill_stage.pt_city,\n\tSQ_med_bill_stage.pt_state,\n\tSQ_med_bill_stage.pt_zip_code,\n\tSQ_med_bill_stage.pt_dob,\n\tSQ_med_bill_stage.pt_gndr,\n\tSQ_med_bill_stage.pt_ssn,\n\tSQ_med_bill_stage.pt_inj_dt,\n\tSQ_med_bill_stage.refer_physician,\n\tSQ_med_bill_stage.serv_from_date,\n\tSQ_med_bill_stage.serv_to_date,\n\tSQ_med_bill_stage.inpt_outpt_ind,\n\tSQ_med_bill_stage.bill_issued_date,\n\tSQ_med_bill_stage.bill_rcvd_date,\n\tSQ_med_bill_stage.bus_rcvd_date,\n\tSQ_med_bill_stage.bill_process_date,\n\tSQ_med_bill_stage.pt_admit_date,\n\tSQ_med_bill_stage.pt_discharge_date,\n\tSQ_med_bill_stage.daily_hospital_rt,\n\tSQ_med_bill_stage.bill_review_cost,\n\tSQ_med_bill_stage.total_bill_charge,\n\tSQ_med_bill_stage.total_bill_red,\n\tSQ_med_bill_stage.total_network_red,\n\tSQ_med_bill_stage.total_recom_pay,\n\tSQ_med_bill_stage.total_addtl_charge,\n\tSQ_med_bill_stage.bill_type,\n\tSQ_med_bill_stage.bill_status_code,\n\tSQ_med_bill_stage.fee_sched_code,\n\tSQ_med_bill_stage.network_name,\n\tSQ_med_bill_stage.network_num,\n\tSQ_med_bill_stage.serv_line_num,\n\tSQ_med_bill_stage.deleted_ind,\n\tSQ_med_bill_stage.emplyr,\n\tSQ_med_bill_stage.acct_id,\n\tSQ_med_bill_stage.vendor_code,\n\tSQ_med_bill_stage.ebill_ind,\n\tSQ_med_bill_stage.autopay_ind AS in_autopay_ind,\n\tLKP_clm_clt_eor_stage.cce_claim_nbr AS EXD_claim_num,\n\tLKP_clm_clt_eor_stage.denial_reason_cd AS EXD_denial_reason_cd,\n\tLKP_claim_payment.micro_ecd_draft_num AS EXD_draft_num,\n\tLKP_claim_payment.total_pay_amt AS EXD_draft_amt,\n\tLKP_claim_payment.pay_disbursement_date AS EXD_paid_date,\n\tLKP_pms_clt_eor_stage.pce_policy_sym,\n\tLKP_pms_clt_eor_stage.pce_policy_num,\n\tLKP_pms_clt_eor_stage.pce_policy_mod,\n\tLKP_pms_clt_eor_stage.pce_date_of_loss,\n\tLKP_pms_clt_eor_stage.pce_occurrence,\n\t-- *INF*: replaceChr(0,to_char(pce_date_of_loss),'/','')\n\tREGEXP_REPLACE(to_char(pce_date_of_loss\n\t),'/','','i') AS v_PMS_date_of_loss,\n\t-- *INF*: pce_policy_sym || pce_policy_num || pce_policy_mod ||  \r\n\t-- v_PMS_date_of_loss \r\n\t-- || lpad(to_char(pce_occurrence),3,'0')\r\n\t-- \n\tpce_policy_sym || pce_policy_num || pce_policy_mod || v_PMS_date_of_loss || lpad(to_char(pce_occurrence\n\t\t), 3, '0'\n\t) AS v_PMS_claim_num,\n\tLKP_pms_clt_eor_stage.pce_paid_ts AS PMS_paid_date,\n\tLKP_pms_clt_eor_stage.check_number AS PMS_draft_num,\n\tLKP_pms_clt_eor_stage.amount_paid_by_chk AS PMS_draft_amt,\n\tLKP_pms_clt_eor_stage.denial_reason_cd AS PMS_denial_reason_cd,\n\t-- *INF*: IIF(NOT ISNULL(EXD_claim_num), EXD_claim_num,\r\n\t-- IIF(NOT ISNULL(v_PMS_claim_num), v_PMS_claim_num,\r\n\t-- 'N/A'))\n\tIFF(EXD_claim_num IS NOT NULL,\n\t\tEXD_claim_num,\n\t\tIFF(v_PMS_claim_num IS NOT NULL,\n\t\t\tv_PMS_claim_num,\n\t\t\t'N/A'\n\t\t)\n\t) AS v_claim_num,\n\t-- *INF*: :LKP.LKP_claim_occurrence(v_claim_num)\n\tLKP_CLAIM_OCCURRENCE_v_claim_num.claim_occurrence_ak_id AS v_claim_occ_ak_id,\n\t-- *INF*: IIF(isnull(v_claim_occ_ak_id),-1,v_claim_occ_ak_id)\n\tIFF(v_claim_occ_ak_id IS NULL,\n\t\t- 1,\n\t\tv_claim_occ_ak_id\n\t) AS claim_occ_ak_id_out,\n\tLKP_claim_party_occurrence.claim_party_occurrence_ak_id AS in_claim_party_occurrence_ak_id,\n\t-- *INF*: iif(isnull(in_claim_party_occurrence_ak_id),-1,in_claim_party_occurrence_ak_id)\n\tIFF(in_claim_party_occurrence_ak_id IS NULL,\n\t\t- 1,\n\t\tin_claim_party_occurrence_ak_id\n\t) AS claim_party_occurrence_ak_id,\n\tLKP_medical_bill_vendor.med_bill_vendor_ak_id AS in_med_bill_vendor_ak_id,\n\t-- *INF*: iif(isnull(in_med_bill_vendor_ak_id),-1,in_med_bill_vendor_ak_id)\n\tIFF(in_med_bill_vendor_ak_id IS NULL,\n\t\t- 1,\n\t\tin_med_bill_vendor_ak_id\n\t) AS med_bill_vendor_ak_id,\n\t-- *INF*: IIF(length(ebill_ind)=0,'N/A',ebill_ind)\n\tIFF(length(ebill_ind\n\t\t) = 0,\n\t\t'N/A',\n\t\tebill_ind\n\t) AS ebill_ind_out,\n\t-- *INF*: IIF(NOT ISNULL(EXD_denial_reason_cd), EXD_denial_reason_cd,\r\n\t-- IIF(NOT ISNULL(PMS_denial_reason_cd), PMS_denial_reason_cd,\r\n\t-- 'N/A'))\n\tIFF(EXD_denial_reason_cd IS NOT NULL,\n\t\tEXD_denial_reason_cd,\n\t\tIFF(PMS_denial_reason_cd IS NOT NULL,\n\t\t\tPMS_denial_reason_cd,\n\t\t\t'N/A'\n\t\t)\n\t) AS denial_rsn_cd_out,\n\t-- *INF*: IIF(NOT isnull(EXD_draft_num) , EXD_draft_num,\r\n\t-- IIF(NOT isnull(PMS_draft_num) , PMS_draft_num,\r\n\t-- 'N/A'))\n\tIFF(EXD_draft_num IS NOT NULL,\n\t\tEXD_draft_num,\n\t\tIFF(PMS_draft_num IS NOT NULL,\n\t\t\tPMS_draft_num,\n\t\t\t'N/A'\n\t\t)\n\t) AS draft_num_out,\n\t-- *INF*: IIF(NOT isnull(EXD_draft_amt) ,EXD_draft_amt,\r\n\t-- IIF(NOT isnull(PMS_draft_amt) , PMS_draft_amt,\r\n\t-- 0))\r\n\t-- \r\n\t-- \n\tIFF(EXD_draft_amt IS NOT NULL,\n\t\tEXD_draft_amt,\n\t\tIFF(PMS_draft_amt IS NOT NULL,\n\t\t\tPMS_draft_amt,\n\t\t\t0\n\t\t)\n\t) AS draft_amt_out,\n\t-- *INF*: IIF(NOT ISNULL(EXD_paid_date) ,EXD_paid_date,\r\n\t-- IIF(NOT ISNULL(PMS_paid_date) ,PMS_paid_date,\r\n\t-- TO_DATE('1/1/1800','MM/DD/YYYY')))\r\n\t-- \n\tIFF(EXD_paid_date IS NOT NULL,\n\t\tEXD_paid_date,\n\t\tIFF(PMS_paid_date IS NOT NULL,\n\t\t\tPMS_paid_date,\n\t\t\tTO_DATE('1/1/1800', 'MM/DD/YYYY'\n\t\t\t)\n\t\t)\n\t) AS draft_paid_date_out,\n\tLKP_clm_clt_eor_stage.cce_eor_status AS in_med_bill_review_code,\n\t-- *INF*: iif(isnull(in_med_bill_review_code),'N/A',in_med_bill_review_code)\n\tIFF(in_med_bill_review_code IS NULL,\n\t\t'N/A',\n\t\tin_med_bill_review_code\n\t) AS med_bill_review_code,\n\t-- *INF*: iif(isnull(in_autopay_ind),'N/A',in_autopay_ind)\r\n\t-- \r\n\t--  \n\tIFF(in_autopay_ind IS NULL,\n\t\t'N/A',\n\t\tin_autopay_ind\n\t) AS autopay_ind_out,\n\tSQ_med_bill_stage.eor_rcvd_date AS in_eor_rcvd_date,\n\t-- *INF*: IIF(ISNULL( in_eor_rcvd_date) ,\r\n\t-- TO_DATE('1/1/1800','MM/DD/YYYY'),in_eor_rcvd_date)\n\tIFF(in_eor_rcvd_date IS NULL,\n\t\tTO_DATE('1/1/1800', 'MM/DD/YYYY'\n\t\t),\n\t\tin_eor_rcvd_date\n\t) AS o_eor_rcvd_date,\n\tSQ_med_bill_stage.original_vendor_bill_num AS in_original_vendor_bill_num,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(in_original_vendor_bill_num)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(in_original_vendor_bill_num\n\t) AS o_original_vendor_bill_num,\n\tSQ_med_bill_stage.auto_adjudicated,\n\t-- *INF*: IIF(ISNULL(auto_adjudicated) OR RTRIM(auto_adjudicated)='','N/A',auto_adjudicated)\n\tIFF(auto_adjudicated IS NULL \n\t\tOR RTRIM(auto_adjudicated\n\t\t) = '',\n\t\t'N/A',\n\t\tauto_adjudicated\n\t) AS o_auto_adjudicated\n\tFROM SQ_med_bill_stage\n\tLEFT JOIN LKP_claim_party_occurrence\n\tON LKP_claim_party_occurrence.claim_party_key = LKP_clm_clt_eor_stage.cce_client_id AND LKP_claim_party_occurrence.claim_occurrence_key = LKP_clm_clt_eor_stage.cce_claim_nbr\n\tLEFT JOIN LKP_claim_payment\n\tON LKP_claim_payment.claim_pay_num = LKP_clm_clt_eor_stage.cce_draft_nbr\n\tLEFT JOIN LKP_clm_clt_eor_stage\n\tON LKP_clm_clt_eor_stage.cce_tch_bill_nbr = SQ_med_bill_stage.med_bill_id\n\tLEFT JOIN LKP_medical_bill_vendor\n\tON LKP_medical_bill_vendor.vendor_code = SQ_med_bill_stage.vendor_code\n\tLEFT JOIN LKP_pms_clt_eor_stage\n\tON LKP_pms_clt_eor_stage.pce_tch_bill_nbr = SQ_med_bill_stage.med_bill_id\n\tLEFT JOIN LKP_CLAIM_OCCURRENCE LKP_CLAIM_OCCURRENCE_v_claim_num\n\tON LKP_CLAIM_OCCURRENCE_v_claim_num.claim_occurrence_key = v_claim_num\n\n),\nLKP_medical_bill AS (\n\tSELECT\n\tmed_bill_ak_id,\n\tclaim_occurrence_ak_id,\n\tmed_bill_key,\n\tin_med_bill_id,\n\tvendor_bill_num,\n\tpatient_acct_num,\n\tpatient_last_name,\n\tpatient_first_name,\n\tpatient_mid_name,\n\tpatient_full_name,\n\tpatient_addr,\n\tpatient_city,\n\tpatient_state,\n\tpatient_zip_code,\n\tpatient_birthdate,\n\tpatient_gndr,\n\tpatient_ssn,\n\tpatient_inj_date,\n\trefer_physician,\n\tserv_from_date,\n\tserv_to_date,\n\tinpatient_outpatient_ind,\n\tbill_issued_date,\n\tbill_rcvd_date,\n\tbus_rcvd_date,\n\tbill_process_date,\n\tpatient_admit_date,\n\tpatient_discharge_date,\n\tdaily_hospital_rate,\n\tbill_review_cost,\n\ttotal_bill_charge,\n\ttotal_bill_review_red,\n\ttotal_network_red,\n\ttotal_recommend_pay,\n\ttotal_addtional_charge,\n\tbill_type,\n\tbill_status_code,\n\tfee_sched_code,\n\tnetwork_name,\n\tnetwork_num,\n\tserv_line_num,\n\tdeleted_ind,\n\templyr,\n\tacct_id,\n\tbill_review_vendor_code,\n\tebill_ind,\n\tdenial_rsn_code,\n\tdraft_num,\n\tdraft_amt,\n\tdraft_paid_date,\n\tclaim_party_occurrence_ak_id,\n\tmed_bill_vendor_ak_id,\n\tmed_bill_review_code,\n\tautopay_ind,\n\teor_rcvd_date,\n\tOriginalVendorBillNumber,\n\tAutoAdjudicatedIndicator\n\tFROM (\n\t\tSELECT \tmed_bill_ak_id\t\t\t\t\tAS med_bill_ak_id \r\n\t\t,\t\tclaim_occurrence_ak_id\t\t\tAS claim_occurrence_ak_id \r\n\t\t, med_bill_key as med_bill_key\r\n\t\t,\t\trtrim(vendor_bill_num)\t\t\tAS vendor_bill_num \r\n\t\t,\t\trtrim(patient_acct_num)\t\t\tAS patient_acct_num \r\n\t\t,\t\trtrim(patient_last_name)\t\tAS patient_last_name \r\n\t\t,\t\trtrim(patient_first_name)\t\tAS patient_first_name \r\n\t\t,\t\trtrim(patient_mid_name)\t\t\tAS patient_mid_name \r\n\t\t,\t\trtrim(patient_full_name)\t\t\tAS patient_full_name \r\n\t\t,\t\trtrim(patient_addr)\t\t\t\tAS patient_addr \r\n\t\t,\t\trtrim(patient_city)\t\t\t\tAS patient_city \r\n\t\t,\t\trtrim(patient_state)\t\t\tAS patient_state \r\n\t\t,\t\trtrim(patient_zip_code)\t\t\tAS patient_zip_code \r\n\t\t,\t\tpatient_birthdate\t\t\t\tAS patient_birthdate \r\n\t\t,\t\trtrim(patient_gndr)\t\t\t\tAS patient_gndr \r\n\t\t,\t\trtrim(patient_ssn)\t\t\t\tAS patient_ssn \r\n\t\t,\t\tpatient_inj_date\t\t\t\tAS patient_inj_date \r\n\t\t,\t\trtrim(refer_physician)\t\t\tAS refer_physician \r\n\t\t,\t\tserv_from_date\t\t\t\t\tAS serv_from_date \r\n\t\t,\t\tserv_to_date\t\t\t\t\tAS serv_to_date \r\n\t\t,\t\trtrim(inpatient_outpatient_ind) AS inpatient_outpatient_ind \r\n\t\t,\t\tbill_issued_date\t\t\t\tAS bill_issued_date \r\n\t\t,\t\tbill_rcvd_date\t\t\t\t\tAS bill_rcvd_date \r\n\t\t,\t\tbus_rcvd_date\t\t\t\t\tAS bus_rcvd_date \r\n\t\t,\t\tbill_process_date\t\t\t\tAS bill_process_date \r\n\t\t,\t\tpatient_admit_date\t\t\t\tAS patient_admit_date \r\n\t\t,\t\tpatient_discharge_date\t\t\tAS patient_discharge_date \r\n\t\t,\t\tdaily_hospital_rate\t\t\t\tAS daily_hospital_rate \r\n\t\t,\t\tbill_review_cost\t\t\t\tAS bill_review_cost \r\n\t\t,\t\ttotal_bill_charge\t\t\t\tAS total_bill_charge \r\n\t\t,\t\ttotal_bill_review_red\t\t\tAS total_bill_review_red \r\n\t\t,\t\ttotal_network_red\t\t\t\tAS total_network_red \r\n\t\t,\t\ttotal_recommend_pay\t\t\t\tAS total_recommend_pay \r\n\t\t,\t\ttotal_addtional_charge\t\t\tAS total_addtional_charge \r\n\t\t,\t\trtrim(bill_type)\t\t\t\tAS bill_type \r\n\t\t,\t\trtrim(bill_status_code)\t\t\tAS bill_status_code \r\n\t\t,\t\trtrim(fee_sched_code)\t\t\tAS fee_sched_code \r\n\t\t,\t\trtrim(network_name)\t\t\t\tAS network_name \r\n\t\t,\t\tnetwork_num\t\t\t\t\t\tAS network_num \r\n\t\t,\t\tserv_line_num\t\t\t\t\tAS serv_line_num \r\n\t\t,\t\trtrim(deleted_ind)\t\t\t\tAS deleted_ind \r\n\t\t,\t\trtrim(emplyr)\t\t\t\t\tAS emplyr \r\n\t\t,\t\trtrim(acct_id)\t\t\t\t\tAS acct_id \r\n\t\t,\t\trtrim(bill_review_vendor_code)\tAS bill_review_vendor_code \r\n\t\t,\t\trtrim(ebill_ind)\t\t\t\tAS ebill_ind \r\n\t\t,\t\trtrim(denial_rsn_code)\t\t\tAS denial_rsn_code \r\n\t\t,\t\trtrim(draft_num)\t\t\t\tAS draft_num \r\n\t\t,\t\tdraft_amt\t\t\t\t\t\tAS draft_amt \r\n\t\t,\t\tdraft_paid_date\t\t\t\t\tAS draft_paid_date\r\n\t\t,\t\tclaim_party_occurrence_ak_id\tAS claim_party_occurrence_ak_id\r\n\t\t,\t\tmed_bill_key\t\t\t\t\tAS med_bill_key \r\n\t\t,\t\tmed_bill_vendor_ak_id\t\t\tAS med_bill_vendor_ak_id\r\n\t\t,           med_bill_review_code       as med_bill_review_code\r\n\t\t,           autopay_ind                            as autopay_ind\r\n\t\t,           eor_rcvd_date                       as eor_rcvd_date\r\n\t\t,           OriginalVendorBillNumber    AS OriginalVendorBillNumber\r\n\t\t,           AutoAdjudicatedIndicator    AS AutoAdjudicatedIndicator\r\n\t\tFROM\t@{pipeline().parameters.TARGET_TABLE_OWNER}.medical_bill\r\n\t\tWHERE\tcrrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY med_bill_key ORDER BY med_bill_ak_id DESC) = 1\n),\nEXPTRANS AS (\n\tSELECT\n\tLKP_medical_bill.med_bill_ak_id,\n\tLKP_medical_bill.claim_occurrence_ak_id,\n\tEXP_ASSIGN_DEFAULTS.med_bill_id,\n\tLKP_medical_bill.vendor_bill_num,\n\tLKP_medical_bill.patient_acct_num,\n\tLKP_medical_bill.patient_last_name,\n\tLKP_medical_bill.patient_first_name,\n\tLKP_medical_bill.patient_mid_name,\n\tLKP_medical_bill.patient_full_name,\n\tLKP_medical_bill.patient_addr,\n\tLKP_medical_bill.patient_city,\n\tLKP_medical_bill.patient_state,\n\tLKP_medical_bill.patient_zip_code,\n\tLKP_medical_bill.patient_birthdate,\n\tLKP_medical_bill.patient_gndr,\n\tLKP_medical_bill.patient_ssn,\n\tLKP_medical_bill.patient_inj_date,\n\tLKP_medical_bill.refer_physician,\n\tLKP_medical_bill.serv_from_date,\n\tLKP_medical_bill.serv_to_date,\n\tLKP_medical_bill.inpatient_outpatient_ind,\n\tLKP_medical_bill.bill_issued_date,\n\tLKP_medical_bill.bill_rcvd_date,\n\tLKP_medical_bill.bus_rcvd_date,\n\tLKP_medical_bill.bill_process_date,\n\tLKP_medical_bill.patient_admit_date,\n\tLKP_medical_bill.patient_discharge_date,\n\tLKP_medical_bill.daily_hospital_rate,\n\tLKP_medical_bill.bill_review_cost,\n\tLKP_medical_bill.total_bill_charge,\n\tLKP_medical_bill.total_bill_review_red,\n\tLKP_medical_bill.total_network_red,\n\tLKP_medical_bill.total_recommend_pay,\n\tLKP_medical_bill.total_addtional_charge,\n\tLKP_medical_bill.bill_type,\n\tLKP_medical_bill.bill_status_code,\n\tLKP_medical_bill.fee_sched_code,\n\tLKP_medical_bill.network_name,\n\tLKP_medical_bill.network_num,\n\tLKP_medical_bill.serv_line_num,\n\tLKP_medical_bill.deleted_ind,\n\tLKP_medical_bill.emplyr,\n\tLKP_medical_bill.acct_id,\n\tLKP_medical_bill.bill_review_vendor_code,\n\tLKP_medical_bill.ebill_ind,\n\tLKP_medical_bill.denial_rsn_code,\n\tLKP_medical_bill.draft_num,\n\tLKP_medical_bill.draft_amt,\n\tLKP_medical_bill.draft_paid_date,\n\tLKP_medical_bill.claim_party_occurrence_ak_id,\n\tLKP_medical_bill.med_bill_vendor_ak_id,\n\tLKP_medical_bill.med_bill_review_code,\n\tLKP_medical_bill.autopay_ind,\n\tLKP_medical_bill.eor_rcvd_date,\n\tLKP_medical_bill.OriginalVendorBillNumber,\n\tLKP_medical_bill.AutoAdjudicatedIndicator,\n\tEXP_ASSIGN_DEFAULTS.crrnt_snpsht_flag,\n\tEXP_ASSIGN_DEFAULTS.audit_id,\n\t-- *INF*: IIF(ISnull(med_bill_ak_id),'NEW',\r\n\t-- iif (\r\n\t-- in_vendor_bill_num<>vendor_bill_num or\r\n\t-- in_pt_acct_num <> patient_acct_num or\r\n\t-- in_pt_last_name <>patient_last_name or\r\n\t-- in_pt_first_name<>patient_first_name or\r\n\t-- in_pt_mid_name <>patient_mid_name or\r\n\t-- in_pt_addr <> patient_addr or\r\n\t-- in_pt_city<>patient_city or\r\n\t-- in_pt_state<>patient_state or\r\n\t-- in_pt_zip_code <> patient_zip_code or\r\n\t-- in_pt_dob <> patient_birthdate or\r\n\t-- in_pt_gndr<> patient_gndr or\r\n\t-- in_pt_ssn <> patient_ssn or\r\n\t-- in_pt_inj_dt <> patient_inj_date or\r\n\t-- in_refer_physician <> refer_physician or\r\n\t-- in_serv_from_date<>serv_from_date or\r\n\t-- in_serv_to_date<>serv_to_date or\r\n\t-- in_inpt_outpt_ind<>inpatient_outpatient_ind or\r\n\t-- in_bill_issued_date<>bill_issued_date or\r\n\t-- in_bill_rcvd_date<>bill_rcvd_date or\r\n\t-- in_bus_rcvd_date<>bus_rcvd_date or\r\n\t-- in_bill_process_date<>bill_process_date or\r\n\t-- in_pt_admit_date<>patient_admit_date or\r\n\t-- in_pt_discharge_date<>patient_discharge_date or \r\n\t-- in_daily_hospital_rt<>daily_hospital_rate or \r\n\t-- in_bill_review_cost<>bill_review_cost or \r\n\t-- in_total_bill_charge<>total_bill_charge or \r\n\t-- in_total_bill_red<>total_bill_review_red or \r\n\t-- in_total_network_red<>total_network_red or \r\n\t-- in_total_recom_pay<>total_recommend_pay or \r\n\t-- in_total_addtl_charge<>total_addtional_charge or \r\n\t-- in_bill_type<>bill_type or \r\n\t-- in_bill_status_code<>bill_status_code or \r\n\t-- in_fee_sched_code<>fee_sched_code or \r\n\t-- in_network_name<>network_name or \r\n\t-- in_network_num<>network_num or \r\n\t-- in_serv_line_num<>serv_line_num or \r\n\t-- in_deleted_ind<>deleted_ind or \r\n\t-- in_emplyr<>emplyr or \r\n\t-- in_acct_id<>acct_id or \r\n\t-- in_vendor_code<>bill_review_vendor_code or \r\n\t-- in_autopay_ind<>autopay_ind or \r\n\t-- in_ebill_ind<> ebill_ind or\r\n\t-- in_med_bill_review_code<>med_bill_review_code or \r\n\t-- in_original_vendor_bill_num<>OriginalVendorBillNumber or \r\n\t-- in_auto_adjudicated<>AutoAdjudicatedIndicator or \r\n\t-- in_denial_rsn_cd<>denial_rsn_code or \r\n\t-- in_draft_num<>draft_num or \r\n\t-- in_draft_paid_date <> draft_paid_date\r\n\t-- , 'UPDATE','NOCHANGE')) \n\tIFF(med_bill_ak_id IS NULL,\n\t\t'NEW',\n\t\tIFF(in_vendor_bill_num <> vendor_bill_num \n\t\t\tOR in_pt_acct_num <> patient_acct_num \n\t\t\tOR in_pt_last_name <> patient_last_name \n\t\t\tOR in_pt_first_name <> patient_first_name \n\t\t\tOR in_pt_mid_name <> patient_mid_name \n\t\t\tOR in_pt_addr <> patient_addr \n\t\t\tOR in_pt_city <> patient_city \n\t\t\tOR in_pt_state <> patient_state \n\t\t\tOR in_pt_zip_code <> patient_zip_code \n\t\t\tOR in_pt_dob <> patient_birthdate \n\t\t\tOR in_pt_gndr <> patient_gndr \n\t\t\tOR in_pt_ssn <> patient_ssn \n\t\t\tOR in_pt_inj_dt <> patient_inj_date \n\t\t\tOR in_refer_physician <> refer_physician \n\t\t\tOR in_serv_from_date <> serv_from_date \n\t\t\tOR in_serv_to_date <> serv_to_date \n\t\t\tOR in_inpt_outpt_ind <> inpatient_outpatient_ind \n\t\t\tOR in_bill_issued_date <> bill_issued_date \n\t\t\tOR in_bill_rcvd_date <> bill_rcvd_date \n\t\t\tOR in_bus_rcvd_date <> bus_rcvd_date \n\t\t\tOR in_bill_process_date <> bill_process_date \n\t\t\tOR in_pt_admit_date <> patient_admit_date \n\t\t\tOR in_pt_discharge_date <> patient_discharge_date \n\t\t\tOR in_daily_hospital_rt <> daily_hospital_rate \n\t\t\tOR in_bill_review_cost <> bill_review_cost \n\t\t\tOR in_total_bill_charge <> total_bill_charge \n\t\t\tOR in_total_bill_red <> total_bill_review_red \n\t\t\tOR in_total_network_red <> total_network_red \n\t\t\tOR in_total_recom_pay <> total_recommend_pay \n\t\t\tOR in_total_addtl_charge <> total_addtional_charge \n\t\t\tOR in_bill_type <> bill_type \n\t\t\tOR in_bill_status_code <> bill_status_code \n\t\t\tOR in_fee_sched_code <> fee_sched_code \n\t\t\tOR in_network_name <> network_name \n\t\t\tOR in_network_num <> network_num \n\t\t\tOR in_serv_line_num <> serv_line_num \n\t\t\tOR in_deleted_ind <> deleted_ind \n\t\t\tOR in_emplyr <> emplyr \n\t\t\tOR in_acct_id <> acct_id \n\t\t\tOR in_vendor_code <> bill_review_vendor_code \n\t\t\tOR in_autopay_ind <> autopay_ind \n\t\t\tOR in_ebill_ind <> ebill_ind \n\t\t\tOR in_med_bill_review_code <> med_bill_review_code \n\t\t\tOR in_original_vendor_bill_num <> OriginalVendorBillNumber \n\t\t\tOR in_auto_adjudicated <> AutoAdjudicatedIndicator \n\t\t\tOR in_denial_rsn_cd <> denial_rsn_code \n\t\t\tOR in_draft_num <> draft_num \n\t\t\tOR in_draft_paid_date <> draft_paid_date,\n\t\t\t'UPDATE',\n\t\t\t'NOCHANGE'\n\t\t)\n\t) AS VChange_flag,\n\tVChange_flag AS Change_flag,\n\tEXP_ASSIGN_DEFAULTS.claim_occ_ak_id_out AS in_claim_occurrence_ak_id,\n\tEXP_ASSIGN_DEFAULTS.claim_party_occurrence_ak_id AS in_claim_party_occurrence_ak_id,\n\tEXP_ASSIGN_DEFAULTS.med_bill_vendor_ak_id AS in_med_bill_vendor_ak_id,\n\tEXP_ASSIGN_DEFAULTS.vendor_bill_num_out AS in_vendor_bill_num,\n\tEXP_ASSIGN_DEFAULTS.pt_acct_num_out AS in_pt_acct_num,\n\tEXP_ASSIGN_DEFAULTS.pt_last_name_out AS in_pt_last_name,\n\tEXP_ASSIGN_DEFAULTS.pt_first_name_out AS in_pt_first_name,\n\tEXP_ASSIGN_DEFAULTS.pt_mid_name_out AS in_pt_mid_name,\n\tEXP_ASSIGN_DEFAULTS.out_pt_full_name AS in_pt_full_name,\n\tEXP_ASSIGN_DEFAULTS.pt_addr_out AS in_pt_addr,\n\tEXP_ASSIGN_DEFAULTS.pt_city_out AS in_pt_city,\n\tEXP_ASSIGN_DEFAULTS.pt_state_out AS in_pt_state,\n\tEXP_ASSIGN_DEFAULTS.pt_zip_code_out AS in_pt_zip_code,\n\tEXP_ASSIGN_DEFAULTS.pt_dob_out AS in_pt_dob,\n\tEXP_ASSIGN_DEFAULTS.pt_gndr_out AS in_pt_gndr,\n\tEXP_ASSIGN_DEFAULTS.pt_ssn_out AS in_pt_ssn,\n\tEXP_ASSIGN_DEFAULTS.pt_inj_dt_out AS in_pt_inj_dt,\n\tEXP_ASSIGN_DEFAULTS.refer_physician_out AS in_refer_physician,\n\tEXP_ASSIGN_DEFAULTS.serv_from_date_out AS in_serv_from_date,\n\tEXP_ASSIGN_DEFAULTS.serv_to_date_out AS in_serv_to_date,\n\tEXP_ASSIGN_DEFAULTS.inpt_outpt_ind_out AS in_inpt_outpt_ind,\n\tEXP_ASSIGN_DEFAULTS.bill_issued_date_out AS in_bill_issued_date,\n\tEXP_ASSIGN_DEFAULTS.bill_rcvd_date_out AS in_bill_rcvd_date,\n\tEXP_ASSIGN_DEFAULTS.bus_rcvd_date_out AS in_bus_rcvd_date,\n\tEXP_ASSIGN_DEFAULTS.bill_process_date_out AS in_bill_process_date,\n\tEXP_ASSIGN_DEFAULTS.pt_admit_date_out AS in_pt_admit_date,\n\tEXP_ASSIGN_DEFAULTS.pt_discharge_date_out AS in_pt_discharge_date,\n\tEXP_ASSIGN_DEFAULTS.daily_hospital_rt_out AS in_daily_hospital_rt,\n\tEXP_ASSIGN_DEFAULTS.bill_review_cost_out AS in_bill_review_cost,\n\tEXP_ASSIGN_DEFAULTS.total_bill_charge_out AS in_total_bill_charge,\n\tEXP_ASSIGN_DEFAULTS.total_bill_red_out AS in_total_bill_red,\n\tEXP_ASSIGN_DEFAULTS.total_network_red_out AS in_total_network_red,\n\tEXP_ASSIGN_DEFAULTS.total_recom_pay_out AS in_total_recom_pay,\n\tEXP_ASSIGN_DEFAULTS.total_addtl_charge_out AS in_total_addtl_charge,\n\tEXP_ASSIGN_DEFAULTS.bill_type_out AS in_bill_type,\n\tEXP_ASSIGN_DEFAULTS.bill_status_code_out AS in_bill_status_code,\n\tEXP_ASSIGN_DEFAULTS.fee_sched_code_out AS in_fee_sched_code,\n\tEXP_ASSIGN_DEFAULTS.network_name_out AS in_network_name,\n\tEXP_ASSIGN_DEFAULTS.network_num_out AS in_network_num,\n\tEXP_ASSIGN_DEFAULTS.serv_line_num_out AS in_serv_line_num,\n\tEXP_ASSIGN_DEFAULTS.deleted_ind_out AS in_deleted_ind,\n\tEXP_ASSIGN_DEFAULTS.emplyr_out AS in_emplyr,\n\tEXP_ASSIGN_DEFAULTS.acct_id_out AS in_acct_id,\n\tEXP_ASSIGN_DEFAULTS.vendor_code_out AS in_vendor_code,\n\tEXP_ASSIGN_DEFAULTS.ebill_ind_out AS in_ebill_ind,\n\tEXP_ASSIGN_DEFAULTS.denial_rsn_cd_out AS in_denial_rsn_cd,\n\tEXP_ASSIGN_DEFAULTS.draft_num_out AS in_draft_num,\n\tEXP_ASSIGN_DEFAULTS.draft_amt_out AS in_draft_amt,\n\tEXP_ASSIGN_DEFAULTS.draft_paid_date_out AS in_draft_paid_date,\n\tEXP_ASSIGN_DEFAULTS.med_bill_review_code AS in_med_bill_review_code,\n\tEXP_ASSIGN_DEFAULTS.autopay_ind_out AS in_autopay_ind,\n\tEXP_ASSIGN_DEFAULTS.o_eor_rcvd_date AS in_eor_rcvd_date,\n\tEXP_ASSIGN_DEFAULTS.o_original_vendor_bill_num AS in_original_vendor_bill_num,\n\tEXP_ASSIGN_DEFAULTS.o_auto_adjudicated AS in_auto_adjudicated\n\tFROM EXP_ASSIGN_DEFAULTS\n\tLEFT JOIN LKP_medical_bill\n\tON LKP_medical_bill.med_bill_key = EXP_ASSIGN_DEFAULTS.med_bill_id\n),\nFIL_NEW_CHANGED_ROWS AS (\n\tSELECT\n\tin_claim_occurrence_ak_id AS claim_occurrence_ak_id, \n\tin_claim_party_occurrence_ak_id AS claim_party_occurrence_ak_id, \n\tin_med_bill_vendor_ak_id AS med_bill_vendor_ak_id, \n\tmed_bill_ak_id, \n\tmed_bill_id, \n\tin_vendor_bill_num AS vendor_bill_num, \n\tin_pt_acct_num AS pt_acct_num, \n\tin_pt_last_name AS pt_last_name, \n\tin_pt_first_name AS pt_first_name, \n\tin_pt_mid_name AS pt_mid_name, \n\tin_pt_full_name AS pt_full_name, \n\tin_pt_addr AS pt_addr, \n\tin_pt_city AS pt_city, \n\tin_pt_state AS pt_state, \n\tin_pt_zip_code AS pt_zip_code, \n\tin_pt_dob AS pt_dob, \n\tin_pt_gndr AS pt_gndr, \n\tin_pt_ssn AS pt_ssn, \n\tin_pt_inj_dt AS pt_inj_dt, \n\tin_refer_physician AS refer_physician, \n\tin_serv_from_date AS serv_from_date, \n\tin_serv_to_date AS serv_to_date, \n\tin_inpt_outpt_ind AS inpt_outpt_ind, \n\tin_bill_issued_date AS bill_issued_date, \n\tin_bill_rcvd_date AS bill_rcvd_date, \n\tin_bus_rcvd_date AS bus_rcvd_date, \n\tin_bill_process_date AS bill_process_date, \n\tin_pt_admit_date AS pt_admit_date, \n\tin_pt_discharge_date AS pt_discharge_date, \n\tin_daily_hospital_rt AS daily_hospital_rt, \n\tin_bill_review_cost AS bill_review_cost, \n\tin_total_bill_charge AS total_bill_charge, \n\tin_total_bill_red AS total_bill_red, \n\tin_total_network_red AS total_network_red, \n\tin_total_recom_pay AS total_recom_pay, \n\tin_total_addtl_charge AS total_addtl_charge, \n\tin_bill_type AS bill_type, \n\tin_bill_status_code AS bill_status_code, \n\tin_fee_sched_code AS fee_sched_code, \n\tin_network_name AS network_name, \n\tin_network_num AS network_num, \n\tin_serv_line_num AS serv_line_num, \n\tin_deleted_ind AS deleted_ind, \n\tin_emplyr AS emplyr, \n\tin_acct_id AS acct_id, \n\tin_vendor_code AS vendor_code, \n\tcrrnt_snpsht_flag, \n\taudit_id, \n\tin_ebill_ind AS ebill_ind, \n\tin_denial_rsn_cd AS denial_rsn_code, \n\tin_draft_num AS draft_num, \n\tin_draft_amt AS draft_amt, \n\tin_draft_paid_date AS draft_paid_date, \n\tin_med_bill_review_code AS med_bill_review_code, \n\tin_autopay_ind AS autopay_ind, \n\tin_eor_rcvd_date AS eor_rcvd_date, \n\tin_original_vendor_bill_num AS OriginalVendorBillNumber, \n\tin_auto_adjudicated AS AutoAdjudicatedIndicator, \n\tChange_flag\n\tFROM EXPTRANS\n\tWHERE Change_flag='NEW' or Change_flag='UPDATE'\n),\nSEQ_med_bill_ak_id AS (\n\tCREATE SEQUENCE SEQ_med_bill_ak_id\n\tSTART = 2000000\n\tINCREMENT = 1;\n),\nEXP_AUDIT_FIELDS AS (\n\tSELECT\n\tmed_bill_ak_id,\n\tclaim_occurrence_ak_id,\n\tmed_bill_id,\n\tvendor_bill_num,\n\tpt_acct_num,\n\tpt_last_name,\n\tpt_first_name AS patient_first_name,\n\tpt_mid_name,\n\tpt_addr,\n\tpt_city,\n\tpt_state,\n\tpt_zip_code,\n\tpt_dob,\n\tpt_gndr,\n\tpt_ssn,\n\tpt_inj_dt,\n\trefer_physician,\n\tserv_from_date,\n\tserv_to_date,\n\tinpt_outpt_ind,\n\tbill_issued_date,\n\tbill_rcvd_date,\n\tbus_rcvd_date,\n\tbill_process_date,\n\tpt_admit_date,\n\tpt_discharge_date,\n\t-- *INF*: TO_DATE('1/1/1800','mm/dd/yyyy')\n\tTO_DATE('1/1/1800', 'mm/dd/yyyy'\n\t) AS bill_cov_from_to_dt_default,\n\tdaily_hospital_rt,\n\tbill_review_cost,\n\ttotal_bill_charge,\n\ttotal_bill_red,\n\ttotal_network_red,\n\ttotal_recom_pay,\n\ttotal_addtl_charge,\n\tbill_type,\n\tbill_status_code,\n\tfee_sched_code,\n\tnetwork_name,\n\tnetwork_num,\n\tserv_line_num,\n\tdeleted_ind,\n\templyr,\n\tacct_id,\n\tvendor_code,\n\tcrrnt_snpsht_flag,\n\taudit_id,\n\t-- *INF*: IIF(Change_flag='NEW',\r\n\t-- \tTO_DATE('01/01/1800 01:00:00','MM/DD/YYYY HH24:MI:SS'),SYSDATE)\n\tIFF(Change_flag = 'NEW',\n\t\tTO_DATE('01/01/1800 01:00:00', 'MM/DD/YYYY HH24:MI:SS'\n\t\t),\n\t\tSYSDATE\n\t) AS eff_from_date,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS'\n\t) AS eff_to_date,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS source_sys_id,\n\tsysdate AS created_date,\n\tpt_full_name,\n\tebill_ind,\n\tdenial_rsn_code,\n\tdraft_num,\n\tdraft_amt,\n\tdraft_paid_date,\n\tclaim_party_occurrence_ak_id,\n\tmed_bill_vendor_ak_id,\n\tmed_bill_review_code,\n\tautopay_ind AS in_autopay_ind,\n\teor_rcvd_date,\n\tOriginalVendorBillNumber,\n\tAutoAdjudicatedIndicator,\n\tChange_flag,\n\tSEQ_med_bill_ak_id.NEXTVAL,\n\t-- *INF*: IIF(Change_flag='NEW', NEXTVAL, med_bill_ak_id)\n\tIFF(Change_flag = 'NEW',\n\t\tNEXTVAL,\n\t\tmed_bill_ak_id\n\t) AS med_bill_ak_id_out\n\tFROM FIL_NEW_CHANGED_ROWS\n),\nmedical_bill_insert AS (\n\tINSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.medical_bill\n\t(med_bill_ak_id, claim_occurrence_ak_id, med_bill_key, vendor_bill_num, patient_acct_num, patient_full_name, patient_last_name, patient_first_name, patient_mid_name, patient_addr, patient_city, patient_state, patient_zip_code, patient_birthdate, patient_gndr, patient_ssn, patient_inj_date, refer_physician, serv_from_date, serv_to_date, inpatient_outpatient_ind, bill_issued_date, bill_rcvd_date, bus_rcvd_date, bill_process_date, patient_admit_date, patient_discharge_date, bill_cover_from_date, bill_cover_to_date, daily_hospital_rate, bill_review_cost, total_bill_charge, total_bill_review_red, total_network_red, total_recommend_pay, total_addtional_charge, bill_type, bill_status_code, fee_sched_code, network_name, network_num, serv_line_num, deleted_ind, emplyr, acct_id, bill_review_vendor_code, crrnt_snpsht_flag, audit_id, eff_from_date, eff_to_date, source_sys_id, created_date, modified_date, ebill_ind, draft_num, draft_amt, draft_paid_date, denial_rsn_code, med_bill_vendor_ak_id, claim_party_occurrence_ak_id, med_bill_review_code, autopay_ind, eor_rcvd_date, OriginalVendorBillNumber, AutoAdjudicatedIndicator)\n\tSELECT \n\tmed_bill_ak_id_out AS MED_BILL_AK_ID, \n\tCLAIM_OCCURRENCE_AK_ID, \n\tmed_bill_id AS MED_BILL_KEY, \n\tVENDOR_BILL_NUM, \n\tpt_acct_num AS PATIENT_ACCT_NUM, \n\tpt_full_name AS PATIENT_FULL_NAME, \n\tpt_last_name AS PATIENT_LAST_NAME, \n\tPATIENT_FIRST_NAME, \n\tpt_mid_name AS PATIENT_MID_NAME, \n\tpt_addr AS PATIENT_ADDR, \n\tpt_city AS PATIENT_CITY, \n\tpt_state AS PATIENT_STATE, \n\tpt_zip_code AS PATIENT_ZIP_CODE, \n\tpt_dob AS PATIENT_BIRTHDATE, \n\tpt_gndr AS PATIENT_GNDR, \n\tpt_ssn AS PATIENT_SSN, \n\tpt_inj_dt AS PATIENT_INJ_DATE, \n\tREFER_PHYSICIAN, \n\tSERV_FROM_DATE, \n\tSERV_TO_DATE, \n\tinpt_outpt_ind AS INPATIENT_OUTPATIENT_IND, \n\tBILL_ISSUED_DATE, \n\tBILL_RCVD_DATE, \n\tBUS_RCVD_DATE, \n\tBILL_PROCESS_DATE, \n\tpt_admit_date AS PATIENT_ADMIT_DATE, \n\tpt_discharge_date AS PATIENT_DISCHARGE_DATE, \n\tbill_cov_from_to_dt_default AS BILL_COVER_FROM_DATE, \n\tbill_cov_from_to_dt_default AS BILL_COVER_TO_DATE, \n\tdaily_hospital_rt AS DAILY_HOSPITAL_RATE, \n\tBILL_REVIEW_COST, \n\tTOTAL_BILL_CHARGE, \n\ttotal_bill_red AS TOTAL_BILL_REVIEW_RED, \n\tTOTAL_NETWORK_RED, \n\ttotal_recom_pay AS TOTAL_RECOMMEND_PAY, \n\ttotal_addtl_charge AS TOTAL_ADDTIONAL_CHARGE, \n\tBILL_TYPE, \n\tBILL_STATUS_CODE, \n\tFEE_SCHED_CODE, \n\tNETWORK_NAME, \n\tNETWORK_NUM, \n\tSERV_LINE_NUM, \n\tDELETED_IND, \n\tEMPLYR, \n\tACCT_ID, \n\tvendor_code AS BILL_REVIEW_VENDOR_CODE, \n\tCRRNT_SNPSHT_FLAG, \n\tAUDIT_ID, \n\tEFF_FROM_DATE, \n\tEFF_TO_DATE, \n\tSOURCE_SYS_ID, \n\tCREATED_DATE, \n\tcreated_date AS MODIFIED_DATE, \n\tEBILL_IND, \n\tDRAFT_NUM, \n\tDRAFT_AMT, \n\tDRAFT_PAID_DATE, \n\tDENIAL_RSN_CODE, \n\tMED_BILL_VENDOR_AK_ID, \n\tCLAIM_PARTY_OCCURRENCE_AK_ID, \n\tMED_BILL_REVIEW_CODE, \n\tin_autopay_ind AS AUTOPAY_IND, \n\tEOR_RCVD_DATE, \n\tORIGINALVENDORBILLNUMBER, \n\tAUTOADJUDICATEDINDICATOR\n\tFROM EXP_AUDIT_FIELDS\n),\nSQ_medical_bill AS (\n\tSELECT \r\n\tmedical_bill.med_bill_id, \r\n\tmedical_bill.med_bill_key, \r\n\tmedical_bill.eff_from_date, \r\n\tmedical_bill.eff_to_date \r\n\tFROM\r\n\t@{pipeline().parameters.TARGET_TABLE_OWNER}.medical_bill medical_bill\r\n\tWHERE\r\n\tmedical_bill.source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}' and exists\r\n\t(\r\n\tselect 1 from @{pipeline().parameters.TARGET_TABLE_OWNER}.medical_bill medical_bill2\r\n\twhere source_sys_id = '@{pipeline().parameters.SOURCE_SYSTEM_ID}' and crrnt_snpsht_flag = 1 and\r\n\tmedical_bill.med_bill_key = medical_bill2.med_bill_key \r\n\tgroup by medical_bill2.med_bill_key having count(*) > 1\r\n\t)\r\n\t\r\n\torder by medical_bill.med_bill_key, medical_bill.eff_from_date desc\n),\nEXP_Lag_eff_from_date1 AS (\n\tSELECT\n\tmed_bill_id,\n\tmed_bill_key,\n\teff_from_date,\n\teff_to_date AS orig_eff_to_date,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- \tmed_bill_key = v_PREV_ROW_occurrence_key, ADD_TO_DATE(v_PREV_ROW_eff_from_date,'SS',-1),\r\n\t-- \torig_eff_to_date)\n\tDECODE(TRUE,\n\t\tmed_bill_key = v_PREV_ROW_occurrence_key, DATEADD(SECOND,- 1,v_PREV_ROW_eff_from_date),\n\t\torig_eff_to_date\n\t) AS v_eff_to_date,\n\tv_eff_to_date AS eff_to_date,\n\teff_from_date AS v_PREV_ROW_eff_from_date,\n\tmed_bill_key AS v_PREV_ROW_occurrence_key,\n\tSYSDATE AS modified_date,\n\t0 AS crrnt_snpsht_flag\n\tFROM SQ_medical_bill\n),\nFILTRANS AS (\n\tSELECT\n\tmed_bill_id, \n\torig_eff_to_date, \n\teff_to_date, \n\tmodified_date, \n\tcrrnt_snpsht_flag\n\tFROM EXP_Lag_eff_from_date1\n\tWHERE orig_eff_to_date <> eff_to_date\n),\nUPD_EFF_TO_DATE AS (\n\tSELECT\n\tmed_bill_id, \n\teff_to_date, \n\tmodified_date, \n\tcrrnt_snpsht_flag\n\tFROM FILTRANS\n),\nmedical_bill_update AS (\n\tMERGE INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.medical_bill AS T\n\tUSING UPD_EFF_TO_DATE AS S\n\tON T.med_bill_id = S.med_bill_id\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.crrnt_snpsht_flag = S.crrnt_snpsht_flag, T.eff_to_date = S.eff_to_date, T.modified_date = S.modified_date\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246497"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905526"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604445"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 02:30:37"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 02:35:40"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Stage_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "Claims DataWarehouse/"
        },
        "annotations": []
    }
}