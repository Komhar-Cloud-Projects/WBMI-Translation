{
    "name": "s_m_POL_DW_Update_CoverageDetailCommercialProperty_Detail_MonthlyLoad",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DW_Update_CoverageDetailCommercialProperty_Det_00",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_SupISOSpecialCauseOfLossCategoryRule AS (\n\tSELECT\n\tISOSpecialCauseOfLossCategoryCode,\n\tPmsPMACode\n\tFROM (\n\t\tSELECT \n\t\t\tISOSpecialCauseOfLossCategoryCode,\n\t\t\tPmsPMACode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupISOSpecialCauseOfLossCategoryRule\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PmsPMACode ORDER BY ISOSpecialCauseOfLossCategoryCode) = 1\n),\nLKP_SupISOCommercialPropertyCauseOfLossGroup_PMS AS (\n\tSELECT\n\tISOCommercialPropertyCauseOfLossGroup,\n\tProductCode,\n\tMajorPerilCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOCommercialPropertyCauseOfLossGroup,\n\t\t\tProductCode,\n\t\t\tMajorPerilCode\n\t\tFROM SupISOCommercialPropertyCauseOfLossGroup\n\t\tWHERE CurrentSnapshotFlag=1 and SourceSystemID='PMS'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ProductCode,MajorPerilCode ORDER BY ISOCommercialPropertyCauseOfLossGroup) = 1\n),\nLKP_SupISOCommercialPropertyCauseOfLossGroup_DCT AS (\n\tSELECT\n\tISOCommercialPropertyCauseOfLossGroup,\n\tProductCode,\n\tSublineCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOCommercialPropertyCauseOfLossGroup,\n\t\t\tProductCode,\n\t\t\tSublineCode\n\t\tFROM SupISOCommercialPropertyCauseOfLossGroup\n\t\tWHERE CurrentSnapshotFlag=1 and SourceSystemID='DCT'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ProductCode,SublineCode ORDER BY ISOCommercialPropertyCauseOfLossGroup) = 1\n),\nLKP_SupISOSpecialCauseOfLossCategoryRule_PMS AS (\n\tSELECT\n\tISOSpecialCauseOfLossCategoryCode,\n\tClassCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOSpecialCauseOfLossCategoryCode,\n\t\t\tClassCode\n\t\tFROM SupISOSpecialCauseOfLossCategoryRule\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ClassCode ORDER BY ISOSpecialCauseOfLossCategoryCode) = 1\n),\nSQ_PMS AS (\n\tDECLARE @Date1 DATE = DATEADD(D, -1, DATEADD(M,DATEDIFF(M,0,GETDATE())@{pipeline().parameters.NO_MONTHS},0)) \r\n\tSELECT distinct  pt.PremiumTransactionId,\r\n\tsc.MajorPerilCode,\r\n\tsc.ClassCode,\r\n\tsc.InsuranceReferenceLineOfBusinessAKId,\r\n\tbsc.BureauCode2,\r\n\tsc.SubLineCode,\r\n\tbsc.BureauCode1,\r\n\tRL.StateProvinceCode,\r\n\tproduct.ProductCode\r\n\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialProperty cp\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction pt on cp.PremiumTransactionId=pt.PremiumTransactionId \r\n\t\tand cp.SourceSystemID='PMS' AND pt.SourceSystemId='PMS'\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.StatisticalCoverage sc ON pt.StatisticalCoverageAKID=sc.StatisticalCoverageAKID \r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.Product product ON product.ProductAKId=sc.ProductAKId\r\n\tINNER JOIN ( \r\n\t  SELECT b2.PremiumTransactionAKID,b2.BureauCode1,b2.BureauCode2,b2.BureauCode6,b2.BureauCode9\r\n\t  FROM \r\n\t  (\r\n\t  SELECT  b.PremiumTransactionAKID,b.BureauCode1,b.BureauCode2,b.BureauCode6,b.BureauCode9\r\n\t          ,ROW_NUMBER() OVER (PARTITION BY b.PremiumTransactionAKID  ORDER BY b.CurrentSnapshotFlag desc)  AS RN\r\n\t  FROM    @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.BureauStatisticalCode   b\r\n\t  WHERE B.SourceSystemID='PMS'\r\n\t  ) b2 \r\n\t  WHERE b2.RN=1\r\n\t) bsc on bsc.PremiumTransactionAKID=pt.PremiumTransactionAKID\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage PC ON SC.PolicyCoverageAKID=PC.PolicyCoverageAKID and PC.SourceSystemID='PMS'\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocation RL ON   PC.RiskLocationAKId=RL.RiskLocationAKId and RL.SourceSystemID='PMS'\r\n\twhere @{pipeline().parameters.PCOLUMN}%@{pipeline().parameters.NUM_OF_PARTITIONS}=0\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n\t\n\tUNION ALL\n\tDECLARE @Date1 DATE = DATEADD(D, -1, DATEADD(M,DATEDIFF(M,0,GETDATE())@{pipeline().parameters.NO_MONTHS},0)) \r\n\tSELECT distinct  pt.PremiumTransactionId,\r\n\tsc.MajorPerilCode,\r\n\tsc.ClassCode,\r\n\tsc.InsuranceReferenceLineOfBusinessAKId,\r\n\tbsc.BureauCode2,\r\n\tsc.SubLineCode,\r\n\tbsc.BureauCode1,\r\n\tRL.StateProvinceCode,\r\n\tproduct.ProductCode\r\n\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialProperty cp\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction pt on cp.PremiumTransactionId=pt.PremiumTransactionId \r\n\t\tand cp.SourceSystemID='PMS' AND pt.SourceSystemId='PMS'\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.StatisticalCoverage sc ON pt.StatisticalCoverageAKID=sc.StatisticalCoverageAKID \r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.Product product ON product.ProductAKId=sc.ProductAKId\r\n\tINNER JOIN ( \r\n\t  SELECT b2.PremiumTransactionAKID,b2.BureauCode1,b2.BureauCode2,b2.BureauCode6,b2.BureauCode9\r\n\t  FROM \r\n\t  (\r\n\t  SELECT  b.PremiumTransactionAKID,b.BureauCode1,b.BureauCode2,b.BureauCode6,b.BureauCode9\r\n\t          ,ROW_NUMBER() OVER (PARTITION BY b.PremiumTransactionAKID  ORDER BY b.CurrentSnapshotFlag desc)  AS RN\r\n\t  FROM    @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.BureauStatisticalCode   b\r\n\t  WHERE B.SourceSystemID='PMS'\r\n\t  ) b2 \r\n\t  WHERE b2.RN=1\r\n\t) bsc on bsc.PremiumTransactionAKID=pt.PremiumTransactionAKID\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage PC ON SC.PolicyCoverageAKID=PC.PolicyCoverageAKID and PC.SourceSystemID='PMS'\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocation RL ON   PC.RiskLocationAKId=RL.RiskLocationAKId and RL.SourceSystemID='PMS'\r\n\twhere @{pipeline().parameters.PCOLUMN}%@{pipeline().parameters.NUM_OF_PARTITIONS}=1\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n\t\n\tUNION ALL\n\tDECLARE @Date1 DATE = DATEADD(D, -1, DATEADD(M,DATEDIFF(M,0,GETDATE())@{pipeline().parameters.NO_MONTHS},0)) \r\n\tSELECT distinct  pt.PremiumTransactionId,\r\n\tsc.MajorPerilCode,\r\n\tsc.ClassCode,\r\n\tsc.InsuranceReferenceLineOfBusinessAKId,\r\n\tbsc.BureauCode2,\r\n\tsc.SubLineCode,\r\n\tbsc.BureauCode1,\r\n\tRL.StateProvinceCode,\r\n\tproduct.ProductCode\r\n\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialProperty cp\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction pt on cp.PremiumTransactionId=pt.PremiumTransactionId \r\n\t\tand cp.SourceSystemID='PMS' AND pt.SourceSystemId='PMS'\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.StatisticalCoverage sc ON pt.StatisticalCoverageAKID=sc.StatisticalCoverageAKID \r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.Product product ON product.ProductAKId=sc.ProductAKId\r\n\tINNER JOIN ( \r\n\t  SELECT b2.PremiumTransactionAKID,b2.BureauCode1,b2.BureauCode2,b2.BureauCode6,b2.BureauCode9\r\n\t  FROM \r\n\t  (\r\n\t  SELECT  b.PremiumTransactionAKID,b.BureauCode1,b.BureauCode2,b.BureauCode6,b.BureauCode9\r\n\t          ,ROW_NUMBER() OVER (PARTITION BY b.PremiumTransactionAKID  ORDER BY b.CurrentSnapshotFlag desc)  AS RN\r\n\t  FROM    @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.BureauStatisticalCode   b\r\n\t  WHERE B.SourceSystemID='PMS'\r\n\t  ) b2 \r\n\t  WHERE b2.RN=1\r\n\t) bsc on bsc.PremiumTransactionAKID=pt.PremiumTransactionAKID\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage PC ON SC.PolicyCoverageAKID=PC.PolicyCoverageAKID and PC.SourceSystemID='PMS'\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocation RL ON   PC.RiskLocationAKId=RL.RiskLocationAKId and RL.SourceSystemID='PMS'\r\n\twhere @{pipeline().parameters.PCOLUMN}%@{pipeline().parameters.NUM_OF_PARTITIONS}=2\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n\t\n\tUNION ALL\n\tDECLARE @Date1 DATE = DATEADD(D, -1, DATEADD(M,DATEDIFF(M,0,GETDATE())@{pipeline().parameters.NO_MONTHS},0)) \r\n\tSELECT distinct  pt.PremiumTransactionId,\r\n\tsc.MajorPerilCode,\r\n\tsc.ClassCode,\r\n\tsc.InsuranceReferenceLineOfBusinessAKId,\r\n\tbsc.BureauCode2,\r\n\tsc.SubLineCode,\r\n\tbsc.BureauCode1,\r\n\tRL.StateProvinceCode,\r\n\tproduct.ProductCode\r\n\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialProperty cp\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction pt on cp.PremiumTransactionId=pt.PremiumTransactionId \r\n\t\tand cp.SourceSystemID='PMS' AND pt.SourceSystemId='PMS'\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.StatisticalCoverage sc ON pt.StatisticalCoverageAKID=sc.StatisticalCoverageAKID \r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.Product product ON product.ProductAKId=sc.ProductAKId\r\n\tINNER JOIN ( \r\n\t  SELECT b2.PremiumTransactionAKID,b2.BureauCode1,b2.BureauCode2,b2.BureauCode6,b2.BureauCode9\r\n\t  FROM \r\n\t  (\r\n\t  SELECT  b.PremiumTransactionAKID,b.BureauCode1,b.BureauCode2,b.BureauCode6,b.BureauCode9\r\n\t          ,ROW_NUMBER() OVER (PARTITION BY b.PremiumTransactionAKID  ORDER BY b.CurrentSnapshotFlag desc)  AS RN\r\n\t  FROM    @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.BureauStatisticalCode   b\r\n\t  WHERE B.SourceSystemID='PMS'\r\n\t  ) b2 \r\n\t  WHERE b2.RN=1\r\n\t) bsc on bsc.PremiumTransactionAKID=pt.PremiumTransactionAKID\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage PC ON SC.PolicyCoverageAKID=PC.PolicyCoverageAKID and PC.SourceSystemID='PMS'\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocation RL ON   PC.RiskLocationAKId=RL.RiskLocationAKId and RL.SourceSystemID='PMS'\r\n\twhere @{pipeline().parameters.PCOLUMN}%@{pipeline().parameters.NUM_OF_PARTITIONS}=3\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n),\nEXP_CoverageDetailCommercialProperty AS (\n\tSELECT\n\tPremiumTransactionID AS i_PremiumTransactionID,\n\tMajorPerilCode AS i_MajorPerilCode,\n\tClassCode AS i_ClassCode,\n\tInsuranceReferenceLineOfBusinessAKId AS i_InsuranceReferenceLineOfBusinessAKId,\n\tBureauCode2 AS i_BureauCode2,\n\tSublineCode AS i_SublineCode,\n\tBureauCode1 AS i_BureauCode1,\n\tStateProvinceCode AS i_StateProvinceCode,\n\tProductCode AS i_ProductCode,\n\t-- *INF*: :LKP.LKP_SupISOCommercialPropertyCauseOfLossGroup_PMS(i_ProductCode,i_MajorPerilCode)\n\tLKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_PMS_i_ProductCode_i_MajorPerilCode.ISOCommercialPropertyCauseOfLossGroup AS v_ISOPropertyCauseofLossGroup,\n\t-- *INF*: DECODE(true,\r\n\t-- v_ISOPropertyCauseofLossGroup='SCL' and i_BureauCode1='2',:LKP.LKP_SupISOSpecialCauseOfLossCategoryRule_PMS(i_ClassCode),\r\n\t-- v_ISOPropertyCauseofLossGroup='SCL' and i_BureauCode1!='2', '01',\r\n\t--  'N/A')\n\tDECODE(true,\n\t\tv_ISOPropertyCauseofLossGroup = 'SCL' AND i_BureauCode1 = '2', LKP_SUPISOSPECIALCAUSEOFLOSSCATEGORYRULE_PMS_i_ClassCode.ISOSpecialCauseOfLossCategoryCode,\n\t\tv_ISOPropertyCauseofLossGroup = 'SCL' AND i_BureauCode1 != '2', '01',\n\t\t'N/A') AS v_ISOSpecialCauseOfLossCategoryCode,\n\ti_PremiumTransactionID AS o_PremiumTransactionID,\n\t-- *INF*: iif(isnull(v_ISOPropertyCauseofLossGroup),'N/A',\r\n\t-- v_ISOPropertyCauseofLossGroup)\n\tIFF(v_ISOPropertyCauseofLossGroup IS NULL, 'N/A', v_ISOPropertyCauseofLossGroup) AS o_ISOPropertyCauseofLossGroup,\n\t-- *INF*: IIF(ISNULL(v_ISOSpecialCauseOfLossCategoryCode), 'Unassigned', v_ISOSpecialCauseOfLossCategoryCode)\n\tIFF(v_ISOSpecialCauseOfLossCategoryCode IS NULL, 'Unassigned', v_ISOSpecialCauseOfLossCategoryCode) AS o_ISOSpecialCauseOfLossCategory,\n\t-- *INF*: SUBSTR(i_ClassCode,1,4)\r\n\t-- \r\n\t-- \r\n\t-- --LPAD(i_ClassCode,6, '0')\n\tSUBSTR(i_ClassCode, 1, 4) AS o_ClassCode,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- IN(i_BureauCode2, '1', '4', '5', '8'), 'Specific',\r\n\t-- IN(i_BureauCode2, '2', '3', '6', '7'), 'Class', \r\n\t-- 'N/A')\n\tDECODE(TRUE,\n\t\tIN(i_BureauCode2, '1', '4', '5', '8'), 'Specific',\n\t\tIN(i_BureauCode2, '2', '3', '6', '7'), 'Class',\n\t\t'N/A') AS o_RateType,\n\ti_StateProvinceCode AS o_StateProvinceCode\n\tFROM SQ_PMS\n\tLEFT JOIN LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_PMS LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_PMS_i_ProductCode_i_MajorPerilCode\n\tON LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_PMS_i_ProductCode_i_MajorPerilCode.ProductCode = i_ProductCode\n\tAND LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_PMS_i_ProductCode_i_MajorPerilCode.MajorPerilCode = i_MajorPerilCode\n\n\tLEFT JOIN LKP_SUPISOSPECIALCAUSEOFLOSSCATEGORYRULE_PMS LKP_SUPISOSPECIALCAUSEOFLOSSCATEGORYRULE_PMS_i_ClassCode\n\tON LKP_SUPISOSPECIALCAUSEOFLOSSCATEGORYRULE_PMS_i_ClassCode.ClassCode = i_ClassCode\n\n),\nSQ_DCT AS (\n\tDECLARE @Date1 DATE = DATEADD(D, -1, DATEADD(M,DATEDIFF(M,0,GETDATE())@{pipeline().parameters.NO_MONTHS},0)) \r\n\tSELECT DISTINCT pt.PremiumTransactionID as PremiumTransactionID,\r\n\trc.ClassCode as ClassCode, \r\n\tbridge.CauseOfLoss as CauseOfLoss, \r\n\tbridge.PerilGroup as PerilGroup, \r\n\tbridge.RateType as RateType, \r\n\tbridge.PropertyType as PropertyType, \r\n\tbridge.OccupancyCategory as OccupancyCategory,\r\n\tRL.StateProvinceCode,\r\n\tPC.InsuranceLine as LineType,\r\n\tproduct.ProductCode,\r\n\trc.SublineCode\r\n\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialProperty cp\r\n\tinner join @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction pt on cp.PremiumTransactionId=pt.PremiumTransactionId\r\n\t\tand cp.SourceSystemID='DCT' and pt.SourceSystemID='DCT'\r\n\t\r\n\tinner join @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.ArchWorkPremiumTransaction wpt on pt.PremiumTransactionAKID=wpt.PremiumTransactionAKId\r\n\t\tand pt.SourceSystemID='DCT' and wpt.SourceSystemID='DCT' and WPT.AuditID=PT.AuditID \r\n\tinner join @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RatingCoverage rc on rc.RatingCoverageAKID=pt.RatingCoverageAKId \r\n\t\tand RC.EffectiveDate=PT.EffectiveDate\r\n\tinner join (\r\n\tselect CauseOfLoss, PerilGroup, RateType, PropertyType, OccupancyCategory, CoverageId--, LineId \r\n\t\tfrom\r\n\t\t(select CauseOfLoss, PerilGroup, RateType, PropertyType, OccupancyCategory, CoverageId,-- LineId,\r\n\t\tROW_NUMBER() OVER (PARTITION BY BR.CoverageId ORDER BY BR.ExtractDate desc)  AS RN\r\n\t\tfrom ArchWorkDCTTransactionInsuranceLineLocationBridge BR\r\n\t\tinner join ArchWorkDCTInsuranceLine L on BR.LineId=L.LineId and BR.AuditId=L.AuditId and L.LineType in ('Property','SBOPProperty','BusinessOwners')\r\n\t\t)b\r\n\t\twhere RN=1\r\n\t\t)bridge \r\n\ton bridge.CoverageId=wpt.PremiumTransactionStageId\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage PC ON RC.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\t\tand PC.SourceSystemID='DCT' and PC.InsuranceLine IN ('Property','SBOPProperty','BusinessOwners')\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocation RL ON   PC.RiskLocationAKId=RL.RiskLocationAKId \r\n\t\tand RL.SourceSystemID='DCT' and RL.CurrentSnapshotFlag=1\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.Product product ON product.ProductAKId=rc.ProductAKId \r\n\twhere @{pipeline().parameters.PCOLUMN}%@{pipeline().parameters.NUM_OF_PARTITIONS}=0\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n\t\n\tUNION ALL\n\tDECLARE @Date1 DATE = DATEADD(D, -1, DATEADD(M,DATEDIFF(M,0,GETDATE())@{pipeline().parameters.NO_MONTHS},0)) \r\n\tSELECT DISTINCT pt.PremiumTransactionID as PremiumTransactionID,\r\n\trc.ClassCode as ClassCode, \r\n\tbridge.CauseOfLoss as CauseOfLoss, \r\n\tbridge.PerilGroup as PerilGroup, \r\n\tbridge.RateType as RateType, \r\n\tbridge.PropertyType as PropertyType, \r\n\tbridge.OccupancyCategory as OccupancyCategory,\r\n\tRL.StateProvinceCode,\r\n\tPC.InsuranceLine as LineType,\r\n\tproduct.ProductCode,\r\n\trc.SublineCode\r\n\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialProperty cp\r\n\tinner join @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction pt on cp.PremiumTransactionId=pt.PremiumTransactionId\r\n\t\tand cp.SourceSystemID='DCT' and pt.SourceSystemID='DCT'\r\n\t\r\n\tinner join @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.ArchWorkPremiumTransaction wpt on pt.PremiumTransactionAKID=wpt.PremiumTransactionAKId\r\n\t\tand pt.SourceSystemID='DCT' and wpt.SourceSystemID='DCT' and WPT.AuditID=PT.AuditID \r\n\tinner join @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RatingCoverage rc on rc.RatingCoverageAKID=pt.RatingCoverageAKId \r\n\t\tand RC.EffectiveDate=PT.EffectiveDate\r\n\tinner join (\r\n\tselect CauseOfLoss, PerilGroup, RateType, PropertyType, OccupancyCategory, CoverageId--, LineId \r\n\t\tfrom\r\n\t\t(select CauseOfLoss, PerilGroup, RateType, PropertyType, OccupancyCategory, CoverageId,-- LineId,\r\n\t\tROW_NUMBER() OVER (PARTITION BY BR.CoverageId ORDER BY BR.ExtractDate desc)  AS RN\r\n\t\tfrom ArchWorkDCTTransactionInsuranceLineLocationBridge BR\r\n\t\tinner join ArchWorkDCTInsuranceLine L on BR.LineId=L.LineId and BR.AuditId=L.AuditId and L.LineType in ('Property','SBOPProperty','BusinessOwners')\r\n\t\t)b\r\n\t\twhere RN=1\r\n\t\t)bridge \r\n\ton bridge.CoverageId=wpt.PremiumTransactionStageId\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage PC ON RC.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\t\tand PC.SourceSystemID='DCT' and PC.InsuranceLine IN ('Property','SBOPProperty','BusinessOwners')\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocation RL ON   PC.RiskLocationAKId=RL.RiskLocationAKId \r\n\t\tand RL.SourceSystemID='DCT' and RL.CurrentSnapshotFlag=1\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.Product product ON product.ProductAKId=rc.ProductAKId \r\n\twhere @{pipeline().parameters.PCOLUMN}%@{pipeline().parameters.NUM_OF_PARTITIONS}=1\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n\t\n\tUNION ALL\n\tDECLARE @Date1 DATE = DATEADD(D, -1, DATEADD(M,DATEDIFF(M,0,GETDATE())@{pipeline().parameters.NO_MONTHS},0)) \r\n\tSELECT DISTINCT pt.PremiumTransactionID as PremiumTransactionID,\r\n\trc.ClassCode as ClassCode, \r\n\tbridge.CauseOfLoss as CauseOfLoss, \r\n\tbridge.PerilGroup as PerilGroup, \r\n\tbridge.RateType as RateType, \r\n\tbridge.PropertyType as PropertyType, \r\n\tbridge.OccupancyCategory as OccupancyCategory,\r\n\tRL.StateProvinceCode,\r\n\tPC.InsuranceLine as LineType,\r\n\tproduct.ProductCode,\r\n\trc.SublineCode\r\n\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialProperty cp\r\n\tinner join @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction pt on cp.PremiumTransactionId=pt.PremiumTransactionId\r\n\t\tand cp.SourceSystemID='DCT' and pt.SourceSystemID='DCT'\r\n\t\r\n\tinner join @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.ArchWorkPremiumTransaction wpt on pt.PremiumTransactionAKID=wpt.PremiumTransactionAKId\r\n\t\tand pt.SourceSystemID='DCT' and wpt.SourceSystemID='DCT' and WPT.AuditID=PT.AuditID \r\n\tinner join @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RatingCoverage rc on rc.RatingCoverageAKID=pt.RatingCoverageAKId \r\n\t\tand RC.EffectiveDate=PT.EffectiveDate\r\n\tinner join (\r\n\tselect CauseOfLoss, PerilGroup, RateType, PropertyType, OccupancyCategory, CoverageId--, LineId \r\n\t\tfrom\r\n\t\t(select CauseOfLoss, PerilGroup, RateType, PropertyType, OccupancyCategory, CoverageId,-- LineId,\r\n\t\tROW_NUMBER() OVER (PARTITION BY BR.CoverageId ORDER BY BR.ExtractDate desc)  AS RN\r\n\t\tfrom ArchWorkDCTTransactionInsuranceLineLocationBridge BR\r\n\t\tinner join ArchWorkDCTInsuranceLine L on BR.LineId=L.LineId and BR.AuditId=L.AuditId and L.LineType in ('Property','SBOPProperty','BusinessOwners')\r\n\t\t)b\r\n\t\twhere RN=1\r\n\t\t)bridge \r\n\ton bridge.CoverageId=wpt.PremiumTransactionStageId\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage PC ON RC.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\t\tand PC.SourceSystemID='DCT' and PC.InsuranceLine IN ('Property','SBOPProperty','BusinessOwners')\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocation RL ON   PC.RiskLocationAKId=RL.RiskLocationAKId \r\n\t\tand RL.SourceSystemID='DCT' and RL.CurrentSnapshotFlag=1\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.Product product ON product.ProductAKId=rc.ProductAKId \r\n\twhere @{pipeline().parameters.PCOLUMN}%@{pipeline().parameters.NUM_OF_PARTITIONS}=2\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n\t\n\tUNION ALL\n\tDECLARE @Date1 DATE = DATEADD(D, -1, DATEADD(M,DATEDIFF(M,0,GETDATE())@{pipeline().parameters.NO_MONTHS},0)) \r\n\tSELECT DISTINCT pt.PremiumTransactionID as PremiumTransactionID,\r\n\trc.ClassCode as ClassCode, \r\n\tbridge.CauseOfLoss as CauseOfLoss, \r\n\tbridge.PerilGroup as PerilGroup, \r\n\tbridge.RateType as RateType, \r\n\tbridge.PropertyType as PropertyType, \r\n\tbridge.OccupancyCategory as OccupancyCategory,\r\n\tRL.StateProvinceCode,\r\n\tPC.InsuranceLine as LineType,\r\n\tproduct.ProductCode,\r\n\trc.SublineCode\r\n\tFROM @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialProperty cp\r\n\tinner join @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction pt on cp.PremiumTransactionId=pt.PremiumTransactionId\r\n\t\tand cp.SourceSystemID='DCT' and pt.SourceSystemID='DCT'\r\n\t\r\n\tinner join @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.ArchWorkPremiumTransaction wpt on pt.PremiumTransactionAKID=wpt.PremiumTransactionAKId\r\n\t\tand pt.SourceSystemID='DCT' and wpt.SourceSystemID='DCT' and WPT.AuditID=PT.AuditID \r\n\tinner join @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RatingCoverage rc on rc.RatingCoverageAKID=pt.RatingCoverageAKId \r\n\t\tand RC.EffectiveDate=PT.EffectiveDate\r\n\tinner join (\r\n\tselect CauseOfLoss, PerilGroup, RateType, PropertyType, OccupancyCategory, CoverageId--, LineId \r\n\t\tfrom\r\n\t\t(select CauseOfLoss, PerilGroup, RateType, PropertyType, OccupancyCategory, CoverageId,-- LineId,\r\n\t\tROW_NUMBER() OVER (PARTITION BY BR.CoverageId ORDER BY BR.ExtractDate desc)  AS RN\r\n\t\tfrom ArchWorkDCTTransactionInsuranceLineLocationBridge BR\r\n\t\tinner join ArchWorkDCTInsuranceLine L on BR.LineId=L.LineId and BR.AuditId=L.AuditId and L.LineType in ('Property','SBOPProperty','BusinessOwners')\r\n\t\t)b\r\n\t\twhere RN=1\r\n\t\t)bridge \r\n\ton bridge.CoverageId=wpt.PremiumTransactionStageId\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage PC ON RC.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\t\tand PC.SourceSystemID='DCT' and PC.InsuranceLine IN ('Property','SBOPProperty','BusinessOwners')\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocation RL ON   PC.RiskLocationAKId=RL.RiskLocationAKId \r\n\t\tand RL.SourceSystemID='DCT' and RL.CurrentSnapshotFlag=1\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.Product product ON product.ProductAKId=rc.ProductAKId \r\n\twhere @{pipeline().parameters.PCOLUMN}%@{pipeline().parameters.NUM_OF_PARTITIONS}=3\r\n\t@{pipeline().parameters.WHERE_CLAUSE}\n),\nEXP_CoverageDetailCommercialProperty1 AS (\n\tSELECT\n\tPremiumTransactionID AS i_PremiumTransactionID,\n\tClassCode AS i_ClassCode,\n\tCauseOfLoss AS i_CauseOfLoss,\n\tPerilGroup AS i_PerilGroup,\n\tRateType AS i_RateType,\n\tPropertyType AS i_PropertyType,\n\tOccupanyCategory AS i_OccupanyCategory,\n\tStateProvinceCode AS i_StateProvinceCode,\n\tLineType AS i_LineType,\n\tProductCode AS i_ProductCode,\n\tSublineCode AS i_SublineCode,\n\t-- *INF*: LTRIM(RTRIM(:LKP.LKP_SupISOCommercialPropertyCauseOfLossGroup_DCT(i_ProductCode,i_SublineCode)))\n\tLTRIM(RTRIM(LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_DCT_i_ProductCode_i_SublineCode.ISOCommercialPropertyCauseOfLossGroup)) AS v_ISOPropertyCauseofLossGroup,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_ISOPropertyCauseofLossGroup='SCL' AND (i_PropertyType='' OR ISNULL(i_PropertyType)), 'Buildings',\r\n\t-- v_ISOPropertyCauseofLossGroup='SCL' ,iif(isnull(i_OccupanyCategory),'N/A',i_OccupanyCategory),\r\n\t-- 'N/A')\n\tDECODE(TRUE,\n\t\tv_ISOPropertyCauseofLossGroup = 'SCL' AND ( i_PropertyType = '' OR i_PropertyType IS NULL ), 'Buildings',\n\t\tv_ISOPropertyCauseofLossGroup = 'SCL', IFF(i_OccupanyCategory IS NULL, 'N/A', i_OccupanyCategory),\n\t\t'N/A') AS v_ISOSpecialCauseOfLossCategory,\n\ti_PremiumTransactionID AS o_PremiumTransactionID,\n\t-- *INF*: IIF((i_LineType='Property' or i_LineType='SBOPProperty')and not  isnull(v_ISOPropertyCauseofLossGroup),\r\n\t-- v_ISOPropertyCauseofLossGroup,'N/A')\n\tIFF(( i_LineType = 'Property' OR i_LineType = 'SBOPProperty' ) AND NOT v_ISOPropertyCauseofLossGroup IS NULL, v_ISOPropertyCauseofLossGroup, 'N/A') AS o_ISOPropertyCauseofLossGroup,\n\t-- *INF*: IIF(i_LineType='Property' or i_LineType='SBOPProperty',\r\n\t-- v_ISOSpecialCauseOfLossCategory,'N/A')\n\tIFF(i_LineType = 'Property' OR i_LineType = 'SBOPProperty', v_ISOSpecialCauseOfLossCategory, 'N/A') AS o_ISOSpecialCauseOfLossCategory,\n\t-- *INF*: IIF(i_LineType='Property' or i_LineType='SBOPProperty',\r\n\t-- SUBSTR(i_ClassCode,1,4),'N/A')\n\tIFF(i_LineType = 'Property' OR i_LineType = 'SBOPProperty', SUBSTR(i_ClassCode, 1, 4), 'N/A') AS o_ClassCode,\n\t-- *INF*: IIF(i_LineType='Property' or i_LineType='SBOPProperty',\r\n\t-- DECODE(TRUE,\r\n\t-- i_RateType='S', 'Specific',\r\n\t-- i_RateType='C', 'Class',\r\n\t-- 'N/A'),'N/A')\n\tIFF(i_LineType = 'Property' OR i_LineType = 'SBOPProperty', DECODE(TRUE,\n\t\ti_RateType = 'S', 'Specific',\n\t\ti_RateType = 'C', 'Class',\n\t\t'N/A'), 'N/A') AS o_RateType,\n\t-- *INF*: IIF(i_LineType='Property' or i_LineType='SBOPProperty',\r\n\t-- i_StateProvinceCode,'N/A')\r\n\t-- \n\tIFF(i_LineType = 'Property' OR i_LineType = 'SBOPProperty', i_StateProvinceCode, 'N/A') AS o_StateProvinceCode\n\tFROM SQ_DCT\n\tLEFT JOIN LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_DCT LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_DCT_i_ProductCode_i_SublineCode\n\tON LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_DCT_i_ProductCode_i_SublineCode.ProductCode = i_ProductCode\n\tAND LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_DCT_i_ProductCode_i_SublineCode.SublineCode = i_SublineCode\n\n),\nLKP_ISOSpecialCauseOfLossCategoryCode AS (\n\tSELECT\n\tISOSpecialCauseOfLossCategoryCode,\n\tISOSpecialCauseOfLossCategoryDCTCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOSpecialCauseOfLossCategoryCode,\n\t\t\tISOSpecialCauseOfLossCategoryDCTCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupISOSpecialCauseOfLossCategory\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ISOSpecialCauseOfLossCategoryDCTCode ORDER BY ISOSpecialCauseOfLossCategoryCode) = 1\n),\nUnion_PMS_DCT AS (\n\tSELECT o_PremiumTransactionID, o_ISOPropertyCauseofLossGroup, o_ISOSpecialCauseOfLossCategory, o_ClassCode, o_RateType, o_StateProvinceCode\n\tFROM EXP_CoverageDetailCommercialProperty\n\tUNION\n\tSELECT o_PremiumTransactionID, o_ISOPropertyCauseofLossGroup, ISOSpecialCauseOfLossCategoryCode AS o_ISOSpecialCauseOfLossCategory, o_ClassCode, o_RateType, o_StateProvinceCode\n\tFROM EXP_CoverageDetailCommercialProperty1\n\t-- Manually join with LKP_ISOSpecialCauseOfLossCategoryCode\n),\nLKP_SupClassificationCommercialProperty AS (\n\tSELECT\n\tISOCPRatingGroup,\n\tCommercialPropertySpecialClass,\n\tClassCode,\n\tRatingStateCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOCPRatingGroup,\n\t\t\tCommercialPropertySpecialClass,\n\t\t\tClassCode,\n\t\t\tRatingStateCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupClassificationCommercialProperty\n\t\tWHERE CurrentSnapshotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ClassCode,RatingStateCode ORDER BY ISOCPRatingGroup) = 1\n),\nLKP_SupClassificationCommercialProperty_default AS (\n\tSELECT\n\tISOCPRatingGroup,\n\tCommercialPropertySpecialClass,\n\tClassCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOCPRatingGroup,\n\t\t\tCommercialPropertySpecialClass,\n\t\t\tClassCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupClassificationCommercialProperty\n\t\tWHERE CurrentSnapshotFlag=1 and RatingStateCode='99'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ClassCode ORDER BY ISOCPRatingGroup) = 1\n),\nEXP_Cal AS (\n\tSELECT\n\tUnion_PMS_DCT.o_PremiumTransactionID AS PremiumTransactionID,\n\tUnion_PMS_DCT.o_ISOPropertyCauseofLossGroup AS i_ISOPropertyCauseofLossGroup,\n\tUnion_PMS_DCT.o_ISOSpecialCauseOfLossCategory AS i_ISOSpecialCauseOfLossCategory,\n\tUnion_PMS_DCT.o_RateType AS i_RateType,\n\tLKP_SupClassificationCommercialProperty.ISOCPRatingGroup AS lk_ISOCPRatingGroup,\n\tLKP_SupClassificationCommercialProperty.CommercialPropertySpecialClass AS lk_PropertySpecialClass,\n\tLKP_SupClassificationCommercialProperty_default.ISOCPRatingGroup AS lk_ISOCPRatingGroup_default,\n\tLKP_SupClassificationCommercialProperty_default.CommercialPropertySpecialClass AS lk_PropertySpecialClass_default,\n\t-- *INF*: RTRIM(LTrim(IIF(i_ISOPropertyCauseofLossGroup='BGI',\r\n\t-- DECODE(TRUE,\r\n\t-- not isnull(lk_ISOCPRatingGroup),lk_ISOCPRatingGroup,\r\n\t-- not isnull(lk_ISOCPRatingGroup_default),lk_ISOCPRatingGroup_default,\r\n\t-- 'N/A'),'N/A')))\n\tRTRIM(LTrim(IFF(i_ISOPropertyCauseofLossGroup = 'BGI', DECODE(TRUE,\n\t\tNOT lk_ISOCPRatingGroup IS NULL, lk_ISOCPRatingGroup,\n\t\tNOT lk_ISOCPRatingGroup_default IS NULL, lk_ISOCPRatingGroup_default,\n\t\t'N/A'), 'N/A'))) AS v_ISOCPRatingGroup,\n\t-- *INF*: Rtrim(LTrim(DECODE(TRUE,\r\n\t-- not isnull(lk_PropertySpecialClass),lk_PropertySpecialClass,\r\n\t-- not isnull(lk_PropertySpecialClass_default),lk_PropertySpecialClass_default,\r\n\t-- 'N/A')))\n\tRtrim(LTrim(DECODE(TRUE,\n\t\tNOT lk_PropertySpecialClass IS NULL, lk_PropertySpecialClass,\n\t\tNOT lk_PropertySpecialClass_default IS NULL, lk_PropertySpecialClass_default,\n\t\t'N/A'))) AS v_PropertySpecialClass,\n\tv_ISOCPRatingGroup AS o_ISOCPRatingGroup,\n\tv_PropertySpecialClass AS o_PropertySpecialClass,\n\t-- *INF*: iif(isnull(i_ISOPropertyCauseofLossGroup),'N/A',i_ISOPropertyCauseofLossGroup)\n\tIFF(i_ISOPropertyCauseofLossGroup IS NULL, 'N/A', i_ISOPropertyCauseofLossGroup) AS o_ISOPropertyCauseofLossGroup,\n\t-- *INF*: iif(isnull(i_ISOSpecialCauseOfLossCategory),'N/A',i_ISOSpecialCauseOfLossCategory)\n\tIFF(i_ISOSpecialCauseOfLossCategory IS NULL, 'N/A', i_ISOSpecialCauseOfLossCategory) AS o_ISOSpecialCauseOfLossCategory,\n\t-- *INF*: iif(isnull(i_RateType),'N/A',i_RateType)\n\tIFF(i_RateType IS NULL, 'N/A', i_RateType) AS o_RateType\n\tFROM Union_PMS_DCT\n\tLEFT JOIN LKP_SupClassificationCommercialProperty\n\tON LKP_SupClassificationCommercialProperty.ClassCode = Union_PMS_DCT.o_ClassCode AND LKP_SupClassificationCommercialProperty.RatingStateCode = Union_PMS_DCT.o_StateProvinceCode\n\tLEFT JOIN LKP_SupClassificationCommercialProperty_default\n\tON LKP_SupClassificationCommercialProperty_default.ClassCode = Union_PMS_DCT.o_ClassCode\n),\nUPD_Target AS (\n\tSELECT\n\tPremiumTransactionID AS PremiumTransactionId, \n\to_ISOPropertyCauseofLossGroup AS ISOPropertyCauseofLossGroup, \n\to_ISOCPRatingGroup AS ISOCPRatingGroup, \n\to_ISOSpecialCauseOfLossCategory AS ISOSpecialCauseOfLossCategory2, \n\to_RateType AS RateType, \n\to_PropertySpecialClass AS PropertySpecialClass\n\tFROM EXP_Cal\n),\nCoverageDetailCommercialProperty_Update AS (\n\tMERGE INTO CoverageDetailCommercialProperty AS T\n\tUSING UPD_Target AS S\n\tON T.PremiumTransactionID = S.PremiumTransactionId\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.ISOCommercialPropertyCauseofLossGroup = S.ISOPropertyCauseofLossGroup, T.ISOCommercialPropertyRatingGroupCode = S.ISOCPRatingGroup, T.ISOSpecialCauseOfLossCategoryCode = S.ISOSpecialCauseOfLossCategory2, T.RateType = S.RateType, T.CommercialPropertySpecialClass = S.PropertySpecialClass\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246244"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "903271"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7594679"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "07/26/2023 05:02:27"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/26/2023 03:40:27"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Stage_Policy"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Policy"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "TARGET_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "RPT_EDM"
            },
            "PCOLUMN": {
                "type": "string",
                "defaultValue": "CP.PremiumTransactionID"
            },
            "NUM_OF_PARTITIONS": {
                "type": "string",
                "defaultValue": "4"
            },
            "NO_MONTHS": {
                "type": "string",
                "defaultValue": ""
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": "and (cp.ISOCommercialPropertyCauseofLossGroup  ='N/A' or cp.ISOCommercialPropertyRatingGroupCode ='N/A' or cp.ISOSpecialCauseOfLossCategoryCode ='Unassigned' or cp.ISOSpecialCauseOfLossCategoryCode ='N/A' or cp.RateType ='N/A' or cp.CommercialPropertySpecialClass ='N/A' or cp.ISOCommercialPropertyCauseofLossGroup is NULL or cp.ISOCommercialPropertyRatingGroupCode is NULL or cp.ISOSpecialCauseOfLossCategoryCode is NULL or cp.RateType is NULL or cp.CommercialPropertySpecialClass is NULL) and PT.CreatedDate > @Date1"
            }
        },
        "folder": {
            "name": "Policy DataWarehouse/"
        },
        "annotations": []
    }
}