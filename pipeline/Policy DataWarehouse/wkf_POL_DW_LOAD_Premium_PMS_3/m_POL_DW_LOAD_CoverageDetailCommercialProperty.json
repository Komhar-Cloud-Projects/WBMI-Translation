{
    "name": "m_POL_DW_LOAD_CoverageDetailCommercialProperty",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DW_LOAD_CoverageDetailCommercialProperty",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_SupISOSpecialCauseOfLossCategoryRule_PMS AS (\n\tSELECT\n\tISOSpecialCauseOfLossCategoryCode,\n\tClassCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOSpecialCauseOfLossCategoryCode,\n\t\t\tClassCode\n\t\tFROM SupISOSpecialCauseOfLossCategoryRule\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ClassCode ORDER BY ISOSpecialCauseOfLossCategoryCode) = 1\n),\nLKP_SupISOCommercialPropertyCauseOfLossGroup_PMS AS (\n\tSELECT\n\tISOCommercialPropertyCauseOfLossGroup,\n\tProductCode,\n\tMajorPerilCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOCommercialPropertyCauseOfLossGroup,\n\t\t\tProductCode,\n\t\t\tMajorPerilCode\n\t\tFROM SupISOCommercialPropertyCauseOfLossGroup\n\t\tWHERE CurrentSnapshotFlag=1 and SourceSystemID='PMS'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ProductCode,MajorPerilCode ORDER BY ISOCommercialPropertyCauseOfLossGroup) = 1\n),\nSQ_CoverageDetailCommericalPropery AS (\n\tSELECT distinct  pt.PremiumTransactionId,\r\n\tpt.CurrentSnapshotFlag,\r\n\tsc.CoverageGuid,\r\n\tpif_43.Pmdnxp1InsuranceLine,\r\n\tpif_43.Pmdnxp1OtherMod,\r\n\tpif_43.Pmdnxp1ProtectionClassPart1,\r\n\tpif_43.Pmdnxp1SprinklerType,\r\n\tsc.MajorPerilCode,\r\n\tsc.ClassCode,\r\n\tsc.InsuranceReferenceLineOfBusinessAKId,\r\n\tbsc.BureauCode2,\r\n\tsc.SubLineCode,\r\n\tbsc.BureauCode1,\r\n\trl.StateProvinceCode as StateProvinceCode,\r\n\tproduct.ProductCode,\r\n\tpif_4514.sar_code_2 ,\r\n\tpif_4514.sar_code_4\r\n\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.pif_4514_stage pif_4514\r\n\tJOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.WorkPremiumTransaction work\r\n\tON pif_4514.pif_4514_stage_id=work.PremiumTransactionStageID\r\n\tAND pif_4514.sar_insurance_line='CF'\r\n\tJOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction pt\r\n\tON work.PremiumTransactionAKId=pt.PremiumTransactionAKID\r\n\tAND pt.SourceSystemId='PMS'\r\n\tJOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.StatisticalCoverage sc\r\n\tON pt.StatisticalCoverageAKID=sc.StatisticalCoverageAKID\r\n\tJOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.Product product\r\n\tON product.ProductAKId=sc.ProductAKId\r\n\tLEFT JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Pif43NXCPStage pif_43\r\n\tON pif_43.PifSymbol=pif_4514.pif_symbol\r\n\tand pif_43.PifPolicyNumber=pif_4514.pif_policy_number\r\n\tand pif_43.PifModule=pif_4514.pif_module\r\n\tand pif_43.Pmdnxp1InsuranceLine=pif_4514.sar_insurance_line\r\n\tand pif_43.Pmdnxp1LocationNumber=case when LEN(ltrim(rtrim(sar_location_x)))=0\r\n\tthen 0 when patindex('%[^0-9]%',sar_location_x)=0\r\n\tthen convert(numeric(4,0),sar_location_x) else -1 end\r\n\tand pif_43.Pmdnxp1SubLocationNumber=case when LEN(ltrim(rtrim(sar_sub_location_x)))=0\r\n\tthen 0 when patindex('%[^0-9]%',sar_sub_location_x)=0\r\n\tthen convert(numeric(3,0),sar_sub_location_x) else -1 end\r\n\tLEFT JOIN ( \r\n\t  SELECT b2.PremiumTransactionAKID,b2.BureauCode1,b2.BureauCode2,b2.BureauCode6,b2.BureauCode9\r\n\t  FROM \r\n\t  (\r\n\t  SELECT  b.PremiumTransactionAKID,b.BureauCode1,b.BureauCode2,b.BureauCode6,b.BureauCode9\r\n\t          ,ROW_NUMBER() OVER (PARTITION BY b.PremiumTransactionAKID  ORDER BY b.CurrentSnapshotFlag desc)  AS RN\r\n\t  FROM    @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.BureauStatisticalCode   b\r\n\t  ) b2 \r\n\t  WHERE b2.RN=1\r\n\t) bsc \r\n\tON bsc.PremiumTransactionAKID=pt.PremiumTransactionAKID\r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage PC\r\n\tON SC.PolicyCoverageAKID=PC.PolicyCoverageAKID \r\n\tINNER JOIN @{pipeline().parameters.TARGET_DATABASE_NAME}.@{pipeline().parameters.TARGET_TABLE_OWNER}.RiskLocation RL\r\n\tON   PC.RiskLocationAKId=RL.RiskLocationAKId\n),\nEXP_CoverageDetailCommercialProperty AS (\n\tSELECT\n\tPremiumTransactionID AS i_PremiumTransactionID,\n\tCurrentSnapshotFlag AS i_CurrentSnapshotFlag,\n\tCoverageGuid AS i_CoverageGuid,\n\tPmdnxp1InsuranceLine AS i_Pmdnxp1InsuranceLine,\n\tPmdnxp1OtherMod AS i_Pmdnxp1OtherMod,\n\tPmdnxp1ProtectionClassPart1 AS i_Pmdnxp1ProtectionClassPart1,\n\tPmdnxp1SprinklerType AS i_Pmdnxp1SprinklerType,\n\tMajorPerilCode AS i_MajorPerilCode,\n\tClassCode AS i_ClassCode,\n\tInsuranceReferenceLineOfBusinessAKId AS i_InsuranceReferenceLineOfBusinessAKId,\n\tBureauCode2 AS i_BureauCode2,\n\tSublineCode AS i_SublineCode,\n\tBureauCode1 AS i_BureauCode1,\n\tStateProvinceCode AS i_StateProvinceCode,\n\tProductCode AS i_ProductCode,\n\tsar_code_2 AS i_sar_code_2,\n\tsar_code_4 AS i_sar_code_4,\n\t-- *INF*: :LKP.LKP_SupISOCommercialPropertyCauseOfLossGroup_PMS(i_ProductCode,i_MajorPerilCode)\n\tLKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_PMS_i_ProductCode_i_MajorPerilCode.ISOCommercialPropertyCauseOfLossGroup AS v_ISOPropertyCauseofLossGroup,\n\t-- *INF*: DECODE(true,\r\n\t-- v_ISOPropertyCauseofLossGroup='SCL' and i_BureauCode1='2',:LKP.LKP_SupISOSpecialCauseOfLossCategoryRule_PMS(i_ClassCode),\r\n\t-- v_ISOPropertyCauseofLossGroup='SCL' and i_BureauCode1!='2', '01',\r\n\t--  'N/A')\n\tDECODE(true,\n\tv_ISOPropertyCauseofLossGroup = 'SCL' AND i_BureauCode1 = '2', LKP_SUPISOSPECIALCAUSEOFLOSSCATEGORYRULE_PMS_i_ClassCode.ISOSpecialCauseOfLossCategoryCode,\n\tv_ISOPropertyCauseofLossGroup = 'SCL' AND i_BureauCode1 != '2', '01',\n\t'N/A') AS v_ISOSpecialCauseOfLossCategoryCode,\n\ti_PremiumTransactionID AS o_PremiumTransactionID,\n\t-- *INF*: IIF(i_CurrentSnapshotFlag='True',1,0)\n\tIFF(i_CurrentSnapshotFlag = 'True', 1, 0) AS o_CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t-- *INF*: TO_DATE('01/01/1800 00:00:00', 'MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('01/01/1800 00:00:00', 'MM/DD/YYYY HH24:MI:SS') AS o_EffectiveDate,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59' , 'MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS o_ExpirationDate,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemID,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\ti_CoverageGuid AS o_CoverageGuid,\n\t-- *INF*: IIF(\r\n\t-- ISNULL(i_Pmdnxp1ProtectionClassPart1) OR IS_SPACES(LTRIM(RTRIM(i_Pmdnxp1ProtectionClassPart1))),\r\n\t-- IIF( ISNULL(i_sar_code_4) OR IS_SPACES(LTRIM(RTRIM(i_sar_code_4))), 'N/A',i_sar_code_4),\r\n\t-- LTRIM(RTRIM(i_Pmdnxp1ProtectionClassPart1))--'N/A'\r\n\t-- )\r\n\t-- --:UDF.DEFAULT_VALUE_FOR_STRINGS(i_Pmdnxp1ProtectionClassPart1)\n\tIFF(i_Pmdnxp1ProtectionClassPart1 IS NULL OR IS_SPACES(LTRIM(RTRIM(i_Pmdnxp1ProtectionClassPart1))), IFF(i_sar_code_4 IS NULL OR IS_SPACES(LTRIM(RTRIM(i_sar_code_4))), 'N/A', i_sar_code_4), LTRIM(RTRIM(i_Pmdnxp1ProtectionClassPart1))) AS o_IsoFireProtectionCode,\n\t-- *INF*: IIF(LTRIM(RTRIM(i_Pmdnxp1InsuranceLine))='CF',i_Pmdnxp1OtherMod,0)\n\tIFF(LTRIM(RTRIM(i_Pmdnxp1InsuranceLine)) = 'CF', i_Pmdnxp1OtherMod, 0) AS o_MultiLocationCreditFactor,\n\t-- *INF*: IIF(LTRIM(RTRIM(i_Pmdnxp1InsuranceLine))='CF',i_Pmdnxp1OtherMod,0)\n\tIFF(LTRIM(RTRIM(i_Pmdnxp1InsuranceLine)) = 'CF', i_Pmdnxp1OtherMod, 0) AS o_PreferredPropertyFactor,\n\t-- *INF*: IIF(\r\n\t-- \tIN(i_Pmdnxp1SprinklerType,'F','P')=1,'1',\r\n\t-- \t\tIIF( IN(i_sar_code_2,'4','8')=1,'1', '0')\r\n\t-- )\n\tIFF(IN(i_Pmdnxp1SprinklerType, 'F', 'P') = 1, '1', IFF(IN(i_sar_code_2, '4', '8') = 1, '1', '0')) AS o_SprinklerFlag,\n\t-- *INF*: iif(isnull(v_ISOPropertyCauseofLossGroup),'N/A',\r\n\t-- v_ISOPropertyCauseofLossGroup)\n\tIFF(v_ISOPropertyCauseofLossGroup IS NULL, 'N/A', v_ISOPropertyCauseofLossGroup) AS o_ISOPropertyCauseofLossGroup,\n\t-- *INF*: IIF(ISNULL(v_ISOSpecialCauseOfLossCategoryCode), 'Unassigned', v_ISOSpecialCauseOfLossCategoryCode)\n\tIFF(v_ISOSpecialCauseOfLossCategoryCode IS NULL, 'Unassigned', v_ISOSpecialCauseOfLossCategoryCode) AS o_ISOSpecialCauseOfLossCategory,\n\t-- *INF*: SUBSTR(i_ClassCode,1,4)\r\n\t-- \r\n\t-- \r\n\t-- --LPAD(i_ClassCode,6, '0')\n\tSUBSTR(i_ClassCode, 1, 4) AS o_ClassCode,\n\ti_StateProvinceCode AS o_StateProvinceCode,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- IN(i_BureauCode2, '1', '4', '5', '8'), 'Specific',\r\n\t-- IN(i_BureauCode2, '2', '3', '6', '7'), 'Class', \r\n\t-- 'N/A')\n\tDECODE(TRUE,\n\tIN(i_BureauCode2, '1', '4', '5', '8'), 'Specific',\n\tIN(i_BureauCode2, '2', '3', '6', '7'), 'Class',\n\t'N/A') AS o_RateType\n\tFROM SQ_CoverageDetailCommericalPropery\n\tLEFT JOIN LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_PMS LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_PMS_i_ProductCode_i_MajorPerilCode\n\tON LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_PMS_i_ProductCode_i_MajorPerilCode.ProductCode = i_ProductCode\n\tAND LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_PMS_i_ProductCode_i_MajorPerilCode.MajorPerilCode = i_MajorPerilCode\n\n\tLEFT JOIN LKP_SUPISOSPECIALCAUSEOFLOSSCATEGORYRULE_PMS LKP_SUPISOSPECIALCAUSEOFLOSSCATEGORYRULE_PMS_i_ClassCode\n\tON LKP_SUPISOSPECIALCAUSEOFLOSSCATEGORYRULE_PMS_i_ClassCode.ClassCode = i_ClassCode\n\n),\nLKP_CoverageDetailCommercialProperty AS (\n\tSELECT\n\tPremiumTransactionId,\n\tIsoFireProtectionCode,\n\tMultiLocationCreditFactor,\n\tPreferredPropertyFactor,\n\tSprinklerFlag,\n\tISOCommercialPropertyCauseofLossGroup,\n\tISOCommercialPropertyRatingGroupCode,\n\tISOSpecialCauseOfLossCategoryCode,\n\tRateType,\n\tCommercialPropertySpecialClass\n\tFROM (\n\t\tSELECT \n\t\t\tPremiumTransactionId,\n\t\t\tIsoFireProtectionCode,\n\t\t\tMultiLocationCreditFactor,\n\t\t\tPreferredPropertyFactor,\n\t\t\tSprinklerFlag,\n\t\t\tISOCommercialPropertyCauseofLossGroup,\n\t\t\tISOCommercialPropertyRatingGroupCode,\n\t\t\tISOSpecialCauseOfLossCategoryCode,\n\t\t\tRateType,\n\t\t\tCommercialPropertySpecialClass\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialProperty\n\t\tWHERE SourceSystemId='PMS'\r\n\t\tand  PremiumTransactionID  in (select pt.PremiumTransactionID from\r\n\t\tPremiumTransaction pt\r\n\t\tinner join WorkPremiumTransaction wpt\r\n\t\ton pt.PremiumTransactionAKID=wpt.PremiumTransactionAKId)\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionId ORDER BY PremiumTransactionId) = 1\n),\nLKP_SupClassificationCommercialProperty AS (\n\tSELECT\n\tISOCPRatingGroup,\n\tCommercialPropertySpecialClass,\n\tClassCode,\n\tRatingStateCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOCPRatingGroup,\n\t\t\tCommercialPropertySpecialClass,\n\t\t\tClassCode,\n\t\t\tRatingStateCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupClassificationCommercialProperty\n\t\tWHERE CurrentSnapshotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ClassCode,RatingStateCode ORDER BY ISOCPRatingGroup) = 1\n),\nLKP_SupClassificationCommercialProperty_default AS (\n\tSELECT\n\tISOCPRatingGroup,\n\tCommercialPropertySpecialClass,\n\tClassCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOCPRatingGroup,\n\t\t\tCommercialPropertySpecialClass,\n\t\t\tClassCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupClassificationCommercialProperty\n\t\tWHERE CurrentSnapshotFlag=1 and RatingStateCode='99'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ClassCode ORDER BY ISOCPRatingGroup) = 1\n),\nEXP_Cal AS (\n\tSELECT\n\tLKP_CoverageDetailCommercialProperty.PremiumTransactionId AS lkp_PremiumTransactionId,\n\tLKP_CoverageDetailCommercialProperty.IsoFireProtectionCode AS lkp_IsoFireProtectionCode,\n\tLKP_CoverageDetailCommercialProperty.MultiLocationCreditFactor AS lkp_MultiLocationCreditFactor,\n\tLKP_CoverageDetailCommercialProperty.PreferredPropertyFactor AS lkp_PreferredPropertyFactor,\n\tLKP_CoverageDetailCommercialProperty.SprinklerFlag AS lkp_SprinklerFlag_Origin,\n\t-- *INF*: DECODE(lkp_SprinklerFlag_Origin,'T',1,'F',0,NULL)\n\tDECODE(lkp_SprinklerFlag_Origin,\n\t'T', 1,\n\t'F', 0,\n\tNULL) AS lkp_SprinklerFlag,\n\tLKP_CoverageDetailCommercialProperty.ISOCommercialPropertyCauseofLossGroup AS lkp_ISOPropertyCauseofLossGroup,\n\tLKP_CoverageDetailCommercialProperty.ISOCommercialPropertyRatingGroupCode AS lkp_ISOCPRatingGroup,\n\tLKP_CoverageDetailCommercialProperty.ISOSpecialCauseOfLossCategoryCode AS lkp_ISOSpecialCauseOfLossCategory,\n\tLKP_CoverageDetailCommercialProperty.RateType AS lkp_RateType,\n\tLKP_CoverageDetailCommercialProperty.CommercialPropertySpecialClass AS lkp_PropertySpecialClass,\n\tEXP_CoverageDetailCommercialProperty.o_PremiumTransactionID AS PremiumTransactionID,\n\tEXP_CoverageDetailCommercialProperty.o_CurrentSnapshotFlag AS CurrentSnapshotFlag,\n\tEXP_CoverageDetailCommercialProperty.o_AuditID AS AuditID,\n\tEXP_CoverageDetailCommercialProperty.o_EffectiveDate AS EffectiveDate,\n\tEXP_CoverageDetailCommercialProperty.o_ExpirationDate AS ExpirationDate,\n\tEXP_CoverageDetailCommercialProperty.o_SourceSystemID AS SourceSystemID,\n\tEXP_CoverageDetailCommercialProperty.o_CreatedDate AS CreatedDate,\n\tEXP_CoverageDetailCommercialProperty.o_ModifiedDate AS ModifiedDate,\n\tEXP_CoverageDetailCommercialProperty.o_CoverageGuid AS CoverageGuid,\n\tEXP_CoverageDetailCommercialProperty.o_IsoFireProtectionCode AS IsoFireProtectionCode,\n\tEXP_CoverageDetailCommercialProperty.o_MultiLocationCreditFactor AS MultiLocationCreditFactor,\n\tEXP_CoverageDetailCommercialProperty.o_PreferredPropertyFactor AS PreferredPropertyFactor,\n\tEXP_CoverageDetailCommercialProperty.o_SprinklerFlag AS SprinklerFlag,\n\tEXP_CoverageDetailCommercialProperty.o_ISOPropertyCauseofLossGroup AS ISOPropertyCauseofLossGroup,\n\tEXP_CoverageDetailCommercialProperty.o_ISOSpecialCauseOfLossCategory AS ISOSpecialCauseOfLossCategory,\n\tEXP_CoverageDetailCommercialProperty.o_RateType AS RateType,\n\tLKP_SupClassificationCommercialProperty.ISOCPRatingGroup AS lk_ISOCPRatingGroup,\n\tLKP_SupClassificationCommercialProperty.CommercialPropertySpecialClass AS lk_PropertySpecialClass,\n\tLKP_SupClassificationCommercialProperty_default.ISOCPRatingGroup AS lk_ISOCPRatingGroup_default,\n\tLKP_SupClassificationCommercialProperty_default.CommercialPropertySpecialClass AS lk_PropertySpecialClass_default,\n\t-- *INF*: IIF(ISOPropertyCauseofLossGroup='BGI',\r\n\t-- DECODE(TRUE,\r\n\t-- not isnull(lk_ISOCPRatingGroup),lk_ISOCPRatingGroup,\r\n\t-- not isnull(lk_ISOCPRatingGroup_default),lk_ISOCPRatingGroup_default,\r\n\t-- 'N/A'),'N/A')\n\tIFF(ISOPropertyCauseofLossGroup = 'BGI', DECODE(TRUE,\n\tNOT lk_ISOCPRatingGroup IS NULL, lk_ISOCPRatingGroup,\n\tNOT lk_ISOCPRatingGroup_default IS NULL, lk_ISOCPRatingGroup_default,\n\t'N/A'), 'N/A') AS v_ISOCPRatingGroup,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- not isnull(lk_PropertySpecialClass),lk_PropertySpecialClass,\r\n\t-- not isnull(lk_PropertySpecialClass_default),lk_PropertySpecialClass_default,\r\n\t-- 'N/A')\n\tDECODE(TRUE,\n\tNOT lk_PropertySpecialClass IS NULL, lk_PropertySpecialClass,\n\tNOT lk_PropertySpecialClass_default IS NULL, lk_PropertySpecialClass_default,\n\t'N/A') AS v_PropertySpecialClass,\n\tv_ISOCPRatingGroup AS o_ISOCPRatingGroup,\n\tv_PropertySpecialClass AS o_PropertySpecialClass,\n\t-- *INF*: Decode(true,\r\n\t-- isnull(lkp_PremiumTransactionId),'INSERT',\r\n\t--  lkp_IsoFireProtectionCode!=IsoFireProtectionCode\r\n\t-- or lkp_MultiLocationCreditFactor!=MultiLocationCreditFactor\r\n\t-- or lkp_PreferredPropertyFactor!=PreferredPropertyFactor\r\n\t-- or lkp_SprinklerFlag!=SprinklerFlag\r\n\t-- or lkp_ISOPropertyCauseofLossGroup!=ISOPropertyCauseofLossGroup\r\n\t-- or lkp_ISOCPRatingGroup!=v_ISOCPRatingGroup\r\n\t-- or lkp_ISOSpecialCauseOfLossCategory!=ISOSpecialCauseOfLossCategory\r\n\t-- or lkp_RateType!=RateType\r\n\t-- or lkp_PropertySpecialClass!=v_PropertySpecialClass,'UPDATE',\r\n\t-- 'UNCHANGE')\n\tDecode(true,\n\tlkp_PremiumTransactionId IS NULL, 'INSERT',\n\tlkp_IsoFireProtectionCode != IsoFireProtectionCode OR lkp_MultiLocationCreditFactor != MultiLocationCreditFactor OR lkp_PreferredPropertyFactor != PreferredPropertyFactor OR lkp_SprinklerFlag != SprinklerFlag OR lkp_ISOPropertyCauseofLossGroup != ISOPropertyCauseofLossGroup OR lkp_ISOCPRatingGroup != v_ISOCPRatingGroup OR lkp_ISOSpecialCauseOfLossCategory != ISOSpecialCauseOfLossCategory OR lkp_RateType != RateType OR lkp_PropertySpecialClass != v_PropertySpecialClass, 'UPDATE',\n\t'UNCHANGE') AS ChangeFlag,\n\t-- *INF*: TO_DATE('1800-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS')\n\tTO_DATE('1800-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS') AS RetroactiveDate\n\tFROM EXP_CoverageDetailCommercialProperty\n\tLEFT JOIN LKP_CoverageDetailCommercialProperty\n\tON LKP_CoverageDetailCommercialProperty.PremiumTransactionId = EXP_CoverageDetailCommercialProperty.o_PremiumTransactionID\n\tLEFT JOIN LKP_SupClassificationCommercialProperty\n\tON LKP_SupClassificationCommercialProperty.ClassCode = EXP_CoverageDetailCommercialProperty.o_ClassCode AND LKP_SupClassificationCommercialProperty.RatingStateCode = EXP_CoverageDetailCommercialProperty.o_StateProvinceCode\n\tLEFT JOIN LKP_SupClassificationCommercialProperty_default\n\tON LKP_SupClassificationCommercialProperty_default.ClassCode = EXP_CoverageDetailCommercialProperty.o_ClassCode\n),\nRTR_Target AS (\n\tSELECT\n\tChangeFlag,\n\tPremiumTransactionID AS PremiumTransactionId,\n\tCurrentSnapshotFlag,\n\tAuditID,\n\tEffectiveDate,\n\tExpirationDate,\n\tSourceSystemID,\n\tCreatedDate,\n\tModifiedDate,\n\tCoverageGuid,\n\tIsoFireProtectionCode,\n\tMultiLocationCreditFactor,\n\tPreferredPropertyFactor,\n\tSprinklerFlag,\n\tISOPropertyCauseofLossGroup,\n\to_ISOCPRatingGroup AS ISOCPRatingGroup,\n\tISOSpecialCauseOfLossCategory,\n\tRateType,\n\to_PropertySpecialClass AS PropertySpecialClass,\n\tRetroactiveDate\n\tFROM EXP_Cal\n),\nRTR_Target_INSERT AS (SELECT * FROM RTR_Target WHERE ChangeFlag='INSERT'),\nRTR_Target_UPDATE AS (SELECT * FROM RTR_Target WHERE ChangeFlag='UPDATE'),\nUPD_Target AS (\n\tSELECT\n\tPremiumTransactionId, \n\tCurrentSnapshotFlag, \n\tAuditID, \n\tEffectiveDate, \n\tExpirationDate, \n\tSourceSystemID, \n\tModifiedDate, \n\tCoverageGuid, \n\tIsoFireProtectionCode, \n\tMultiLocationCreditFactor, \n\tPreferredPropertyFactor, \n\tSprinklerFlag, \n\tISOPropertyCauseofLossGroup, \n\tISOCPRatingGroup, \n\tISOSpecialCauseOfLossCategory AS ISOSpecialCauseOfLossCategory2, \n\tRateType, \n\tPropertySpecialClass, \n\tRetroactiveDate AS RetroactiveDate3\n\tFROM RTR_Target_UPDATE\n),\nCoverageDetailCommercialProperty_Update AS (\n\tMERGE INTO CoverageDetailCommercialProperty AS T\n\tUSING UPD_Target AS S\n\tON T.PremiumTransactionID = S.PremiumTransactionId\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.CurrentSnapshotFlag = S.CurrentSnapshotFlag, T.EffectiveDate = S.EffectiveDate, T.ExpirationDate = S.ExpirationDate, T.SourceSystemID = S.SourceSystemID, T.ModifiedDate = S.ModifiedDate, T.CoverageGuid = S.CoverageGuid, T.IsoFireProtectionCode = S.IsoFireProtectionCode, T.MultiLocationCreditFactor = S.MultiLocationCreditFactor, T.PreferredPropertyFactor = S.PreferredPropertyFactor, T.RetroactiveDate = S.RetroactiveDate3, T.ISOCommercialPropertyCauseofLossGroup = S.ISOPropertyCauseofLossGroup, T.ISOCommercialPropertyRatingGroupCode = S.ISOCPRatingGroup, T.ISOSpecialCauseOfLossCategoryCode = S.ISOSpecialCauseOfLossCategory2, T.RateType = S.RateType, T.CommercialPropertySpecialClass = S.PropertySpecialClass\n),\nCoverageDetailCommercialProperty_Insert AS (\n\tINSERT INTO CoverageDetailCommercialProperty\n\t(PremiumTransactionID, CurrentSnapshotFlag, AuditID, EffectiveDate, ExpirationDate, SourceSystemID, CreatedDate, ModifiedDate, CoverageGuid, IsoFireProtectionCode, MultiLocationCreditFactor, PreferredPropertyFactor, SprinklerFlag, RetroactiveDate, ISOCommercialPropertyCauseofLossGroup, ISOCommercialPropertyRatingGroupCode, ISOSpecialCauseOfLossCategoryCode, RateType, CommercialPropertySpecialClass)\n\tSELECT \n\tPremiumTransactionId AS PREMIUMTRANSACTIONID, \n\tCURRENTSNAPSHOTFLAG, \n\tAUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tSOURCESYSTEMID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tCOVERAGEGUID, \n\tISOFIREPROTECTIONCODE, \n\tMULTILOCATIONCREDITFACTOR, \n\tPREFERREDPROPERTYFACTOR, \n\tSPRINKLERFLAG, \n\tRETROACTIVEDATE, \n\tISOPropertyCauseofLossGroup AS ISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP, \n\tISOCPRatingGroup AS ISOCOMMERCIALPROPERTYRATINGGROUPCODE, \n\tISOSpecialCauseOfLossCategory AS ISOSPECIALCAUSEOFLOSSCATEGORYCODE, \n\tRATETYPE, \n\tPropertySpecialClass AS COMMERCIALPROPERTYSPECIALCLASS\n\tFROM RTR_Target_INSERT\n),"
                        }
                    ]
                }
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246483"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905516"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604203"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 01:21:59"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 01:54:57"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Stage_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "PMS"
            },
            "TARGET_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "RPT_EDM"
            }
        },
        "folder": {
            "name": ""
        },
        "annotations": []
    }
}