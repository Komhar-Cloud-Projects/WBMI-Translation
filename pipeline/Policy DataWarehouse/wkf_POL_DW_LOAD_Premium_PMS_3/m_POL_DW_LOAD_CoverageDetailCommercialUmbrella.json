{
    "name": "m_POL_DW_LOAD_CoverageDetailCommercialUmbrella",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DW_LOAD_CoverageDetailCommercialUmbrella",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_PifDept1553Stage AS (\n\tselect dept.PifSymbol,\r\n\tdept.PifPolicyNumber,\r\n\tdept.PifModule,\r\n\tdept.DECLPTText1701+dept.DECLPTText71791 as Text01,\r\n\tdept.DECLPTText1702+dept.DECLPTText71792 as Text02\r\n\tfrom @{pipeline().parameters.SOURCE_TABLE_OWNER}.PifDept1553Stage dept\r\n\twhere left(dept.PifSymbol,2) in ('CU','NU')\r\n\tand right(dept.DECLPTFormNumber,2)<>'01'\r\n\t-----------DEBUG----------------------------------\r\n\t--AND PifSymbol + PifPolicyNumber + PifModule = 'NUT179931501' and 1=2\r\n\t-----------DEBUG----------------------------------\r\n\torder by dept.PifDept1553StageId\n),\nEXP_GetValues AS (\n\tSELECT\n\tPifSymbol AS i_PifSymbol,\n\tPifPolicyNumber AS i_PifPolicyNumber,\n\tPifModule AS i_PifModule,\n\ti_PifSymbol || i_PifPolicyNumber || i_PifModule AS o_PolicyKey,\n\tText1 AS i_Text1,\n\tText2 AS i_Text2,\n\tv_Text1_Cur AS v_Text1_Prev,\n\tv_Text2_Cur AS v_Text2_Prev,\n\t-- *INF*: LTRIM(RTRIM(i_Text1))\n\tLTRIM(RTRIM(i_Text1)) AS v_Text1_Cur,\n\t-- *INF*: LTRIM(RTRIM(i_Text2))\n\tLTRIM(RTRIM(i_Text2)) AS v_Text2_Cur,\n\t-- *INF*: LTRIM(RTRIM(SUBSTR(v_Text1_Prev,INSTR(v_Text1_Prev,'@')+1,INSTR(v_Text1_Prev,'')-INSTR(v_Text1_Prev,'@')-1)))\n\tLTRIM(RTRIM(SUBSTR(v_Text1_Prev, INSTR(v_Text1_Prev, '@') + 1, INSTR(v_Text1_Prev, '') - INSTR(v_Text1_Prev, '@') - 1))) AS v_UnderlyingInsurer_1_Prev,\n\t-- *INF*: LTRIM(RTRIM(SUBSTR(v_Text1_Cur,INSTR(v_Text1_Cur,'@')+1,INSTR(v_Text1_Cur,'')-INSTR(v_Text1_Cur,'@')-1)))\n\tLTRIM(RTRIM(SUBSTR(v_Text1_Cur, INSTR(v_Text1_Cur, '@') + 1, INSTR(v_Text1_Cur, '') - INSTR(v_Text1_Cur, '@') - 1))) AS v_UnderlyingInsurer_1_Cur,\n\t-- *INF*: LTRIM(RTRIM(SUBSTR(v_Text2_Prev,INSTR(v_Text2_Prev,'@')+1,INSTR(v_Text2_Prev,'')-INSTR(v_Text2_Prev,'@')-1)))\n\tLTRIM(RTRIM(SUBSTR(v_Text2_Prev, INSTR(v_Text2_Prev, '@') + 1, INSTR(v_Text2_Prev, '') - INSTR(v_Text2_Prev, '@') - 1))) AS v_UnderlyingInsurer_2_Prev,\n\t-- *INF*: LTRIM(RTRIM(SUBSTR(v_Text2_Cur,INSTR(v_Text2_Cur,'@')+1,INSTR(v_Text2_Cur,'')-INSTR(v_Text2_Cur,'@')-1)))\n\tLTRIM(RTRIM(SUBSTR(v_Text2_Cur, INSTR(v_Text2_Cur, '@') + 1, INSTR(v_Text2_Cur, '') - INSTR(v_Text2_Cur, '@') - 1))) AS v_UnderlyingInsurer_2_Cur,\n\t-- *INF*: LTRIM(RTRIM(SUBSTR(v_Text1_Prev,INSTR(v_Text1_Prev,'@')+1,INSTR(v_Text1_Prev,'')-INSTR(v_Text1_Prev,'@')-1)))\n\tLTRIM(RTRIM(SUBSTR(v_Text1_Prev, INSTR(v_Text1_Prev, '@') + 1, INSTR(v_Text1_Prev, '') - INSTR(v_Text1_Prev, '@') - 1))) AS v_UnderlyingPolicyKey_1_Prev,\n\t-- *INF*: LTRIM(RTRIM(SUBSTR(v_Text1_Cur,INSTR(v_Text1_Cur,'@')+1,INSTR(v_Text1_Cur,'')-INSTR(v_Text1_Cur,'@')-1)))\n\tLTRIM(RTRIM(SUBSTR(v_Text1_Cur, INSTR(v_Text1_Cur, '@') + 1, INSTR(v_Text1_Cur, '') - INSTR(v_Text1_Cur, '@') - 1))) AS v_UnderlyingPolicyKey_1_Cur,\n\t-- *INF*: LTRIM(RTRIM(SUBSTR(v_Text2_Prev,INSTR(v_Text2_Prev,'@')+1,INSTR(v_Text2_Prev,'')-INSTR(v_Text2_Prev,'@')-1)))\n\tLTRIM(RTRIM(SUBSTR(v_Text2_Prev, INSTR(v_Text2_Prev, '@') + 1, INSTR(v_Text2_Prev, '') - INSTR(v_Text2_Prev, '@') - 1))) AS v_UnderlyingPolicyKey_2_Prev,\n\t-- *INF*: LTRIM(RTRIM(SUBSTR(v_Text2_Cur,INSTR(v_Text2_Cur,'@')+1,INSTR(v_Text2_Cur,'')-INSTR(v_Text2_Cur,'@')-1)))\n\tLTRIM(RTRIM(SUBSTR(v_Text2_Cur, INSTR(v_Text2_Cur, '@') + 1, INSTR(v_Text2_Cur, '') - INSTR(v_Text2_Cur, '@') - 1))) AS v_UnderlyingPolicyKey_2_Cur,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- INSTR(v_Text1_Prev,'EMPLOYERS' || CHR(39) || ' LIABILITY INSURANCE')>0,1,\r\n\t-- INSTR(v_Text2_Prev,'EMPLOYERS' || CHR(39) || ' LIABILITY INSURANCE')>0,2,\r\n\t-- 0)\n\tDECODE(TRUE,\n\tINSTR(v_Text1_Prev, 'EMPLOYERS' || CHR(39) || ' LIABILITY INSURANCE') > 0, 1,\n\tINSTR(v_Text2_Prev, 'EMPLOYERS' || CHR(39) || ' LIABILITY INSURANCE') > 0, 2,\n\t0) AS v_EPLI_Indicator,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_EPLI_Indicator=1,v_UnderlyingInsurer_2_Prev,\r\n\t-- v_EPLI_Indicator=2,v_UnderlyingInsurer_1_Cur,\r\n\t-- v_EPLI_Indicator=0,''\r\n\t-- )\n\tDECODE(TRUE,\n\tv_EPLI_Indicator = 1, v_UnderlyingInsurer_2_Prev,\n\tv_EPLI_Indicator = 2, v_UnderlyingInsurer_1_Cur,\n\tv_EPLI_Indicator = 0, '') AS o_EPLI_Company_Name,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_EPLI_Indicator=1,v_UnderlyingPolicyKey_1_Cur,\r\n\t-- v_EPLI_Indicator=2,v_UnderlyingPolicyKey_2_Cur,\r\n\t-- v_EPLI_Indicator=0,''\r\n\t-- )\n\tDECODE(TRUE,\n\tv_EPLI_Indicator = 1, v_UnderlyingPolicyKey_1_Cur,\n\tv_EPLI_Indicator = 2, v_UnderlyingPolicyKey_2_Cur,\n\tv_EPLI_Indicator = 0, '') AS o_EPLI_PolicyKey,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- INSTR(v_Text1_Prev,'BUSINESSOWNERS LIABILITY')>0,1,\r\n\t-- INSTR(v_Text2_Prev,'BUSINESSOWNERS LIABILITY')>0,2,\r\n\t-- 0)\n\tDECODE(TRUE,\n\tINSTR(v_Text1_Prev, 'BUSINESSOWNERS LIABILITY') > 0, 1,\n\tINSTR(v_Text2_Prev, 'BUSINESSOWNERS LIABILITY') > 0, 2,\n\t0) AS v_Business_Indicator,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_Business_Indicator=1,v_UnderlyingInsurer_2_Prev,\r\n\t-- v_Business_Indicator=2,v_UnderlyingInsurer_1_Cur,\r\n\t-- v_Business_Indicator=0,''\r\n\t-- )\n\tDECODE(TRUE,\n\tv_Business_Indicator = 1, v_UnderlyingInsurer_2_Prev,\n\tv_Business_Indicator = 2, v_UnderlyingInsurer_1_Cur,\n\tv_Business_Indicator = 0, '') AS v_Business_Company_Name,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_Business_Indicator=1,v_UnderlyingPolicyKey_1_Cur,\r\n\t-- v_Business_Indicator=2,v_UnderlyingPolicyKey_2_Cur,\r\n\t-- v_Business_Indicator=0,''\r\n\t-- )\n\tDECODE(TRUE,\n\tv_Business_Indicator = 1, v_UnderlyingPolicyKey_1_Cur,\n\tv_Business_Indicator = 2, v_UnderlyingPolicyKey_2_Cur,\n\tv_Business_Indicator = 0, '') AS v_Business_PolicyKey,\n\t-- *INF*: IIF(IN(SUBSTR(v_Business_PolicyKey,1,2),'BO','NA','NB'),'',v_Business_Company_Name)\n\tIFF(IN(SUBSTR(v_Business_PolicyKey, 1, 2), 'BO', 'NA', 'NB'), '', v_Business_Company_Name) AS o_BusinessOwners_Company_Name,\n\t-- *INF*: IIF(IN(SUBSTR(v_Business_PolicyKey,1,2),'BO','NA','NB'),'',v_Business_PolicyKey)\n\tIFF(IN(SUBSTR(v_Business_PolicyKey, 1, 2), 'BO', 'NA', 'NB'), '', v_Business_PolicyKey) AS o_BusinessOwners_PolicyKey,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- INSTR(v_Text1_Prev,'GENERAL LIABILITY INSURANCE')>0,1,\r\n\t-- INSTR(v_Text2_Prev,'GENERAL LIABILITY INSURANCE')>0,2,\r\n\t-- 0)\n\tDECODE(TRUE,\n\tINSTR(v_Text1_Prev, 'GENERAL LIABILITY INSURANCE') > 0, 1,\n\tINSTR(v_Text2_Prev, 'GENERAL LIABILITY INSURANCE') > 0, 2,\n\t0) AS v_GL_Indicator,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_GL_Indicator=1,v_UnderlyingInsurer_2_Prev,\r\n\t-- v_GL_Indicator=2,v_UnderlyingInsurer_1_Cur,\r\n\t-- v_GL_Indicator=0,''\r\n\t-- )\n\tDECODE(TRUE,\n\tv_GL_Indicator = 1, v_UnderlyingInsurer_2_Prev,\n\tv_GL_Indicator = 2, v_UnderlyingInsurer_1_Cur,\n\tv_GL_Indicator = 0, '') AS o_GL_Company_Name,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_GL_Indicator=1,v_UnderlyingPolicyKey_1_Cur,\r\n\t-- v_GL_Indicator=2,v_UnderlyingPolicyKey_2_Cur,\r\n\t-- v_GL_Indicator=0,''\r\n\t-- )\n\tDECODE(TRUE,\n\tv_GL_Indicator = 1, v_UnderlyingPolicyKey_1_Cur,\n\tv_GL_Indicator = 2, v_UnderlyingPolicyKey_2_Cur,\n\tv_GL_Indicator = 0, '') AS o_GL_PolicyKey,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- INSTR(v_Text1_Prev,'AUTOMOBILE LIABILITY INSURANCE')>0,1,\r\n\t-- INSTR(v_Text2_Prev,'AUTOMOBILE LIABILITY INSURANCE')>0,2,\r\n\t-- 0)\n\tDECODE(TRUE,\n\tINSTR(v_Text1_Prev, 'AUTOMOBILE LIABILITY INSURANCE') > 0, 1,\n\tINSTR(v_Text2_Prev, 'AUTOMOBILE LIABILITY INSURANCE') > 0, 2,\n\t0) AS v_CA_Indicator,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_CA_Indicator=1,v_UnderlyingInsurer_2_Prev,\r\n\t-- v_CA_Indicator=2,v_UnderlyingInsurer_1_Cur,\r\n\t-- v_CA_Indicator=0,''\r\n\t-- )\n\tDECODE(TRUE,\n\tv_CA_Indicator = 1, v_UnderlyingInsurer_2_Prev,\n\tv_CA_Indicator = 2, v_UnderlyingInsurer_1_Cur,\n\tv_CA_Indicator = 0, '') AS o_CA_Company_Name,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_CA_Indicator=1,v_UnderlyingPolicyKey_1_Cur,\r\n\t-- v_CA_Indicator=2,v_UnderlyingPolicyKey_2_Cur,\r\n\t-- v_CA_Indicator=0,''\r\n\t-- )\n\tDECODE(TRUE,\n\tv_CA_Indicator = 1, v_UnderlyingPolicyKey_1_Cur,\n\tv_CA_Indicator = 2, v_UnderlyingPolicyKey_2_Cur,\n\tv_CA_Indicator = 0, '') AS o_CA_PolicyKey,\n\t-- *INF*: IIF(SUBSTR(v_Business_PolicyKey,1,2)='BO',v_Business_Company_Name,'')\n\tIFF(SUBSTR(v_Business_PolicyKey, 1, 2) = 'BO', v_Business_Company_Name, '') AS o_SMARTBusiness_Company_Name,\n\t-- *INF*: IIF(SUBSTR(v_Business_PolicyKey,1,2)='BO',v_Business_PolicyKey,'')\n\tIFF(SUBSTR(v_Business_PolicyKey, 1, 2) = 'BO', v_Business_PolicyKey, '') AS o_SMARTBusiness_PolicyKey,\n\t-- *INF*: IIF(IN(SUBSTR(v_Business_PolicyKey,1,2),'NA','NB'),v_Business_Company_Name,'')\n\tIFF(IN(SUBSTR(v_Business_PolicyKey, 1, 2), 'NA', 'NB'), v_Business_Company_Name, '') AS o_SBOP_Company_Name,\n\t-- *INF*: IIF(IN(SUBSTR(v_Business_PolicyKey,1,2),'NA','NB'),v_Business_PolicyKey,'')\n\tIFF(IN(SUBSTR(v_Business_PolicyKey, 1, 2), 'NA', 'NB'), v_Business_PolicyKey, '') AS o_SBOP_PolicyKey,\n\t'N/A' AS o_UmbrellaCoverageScope,\n\t-- *INF*: TO_DATE('20140101','yyyymmdd')\n\tTO_DATE('20140101', 'yyyymmdd') AS o_RetroactiveDate\n\tFROM SQ_PifDept1553Stage\n),\nSQ_EDW AS (\n\tselect distinct pt.PremiumTransactionID,\r\n\tsc.StatisticalCoverageHashKey,\r\n\tpol.pol_key,\r\n\tpt.PremiumTransactionHashKey,\r\n\tsc.MajorPerilSequenceNumber\r\n\tfrom @{pipeline().parameters.TARGET_TABLE_OWNER}.PremiumTransaction pt\r\n\tjoin @{pipeline().parameters.TARGET_TABLE_OWNER}.StatisticalCoverage sc\r\n\ton pt.StatisticalCoverageAKID=sc.StatisticalCoverageAKID\r\n\tand sc.SourceSystemID='PMS'\r\n\tand pt.SourceSystemID='PMS'\r\n\tjoin @{pipeline().parameters.TARGET_TABLE_OWNER}.PolicyCoverage pc\r\n\ton sc.PolicyCoverageAKID=pc.PolicyCoverageAKID\r\n\tand pc.SourceSystemID='PMS'\r\n\tjoin @{pipeline().parameters.TARGET_TABLE_OWNER_V2}.policy pol\r\n\ton pc.PolicyAKID=pol.pol_ak_id\r\n\tand pol.crrnt_snpsht_flag=1\r\n\tand left(pol.pol_sym,2) in ('CU','NU')\r\n\tand pol.source_sys_id='PMS'\r\n\t--------DEBUG-----------------------------\r\n\t--and pol.pol_key='CUA102598804'\r\n\t--------DEBUG-----------------------------\n),\nJNR_Umbrella AS (SELECT\n\tSQ_EDW.PremiumTransactionID, \n\tSQ_EDW.StatisticalCoverageHashKey, \n\tSQ_EDW.pol_key, \n\tSQ_EDW.PremiumTransactionHashKey, \n\tSQ_EDW.MajorPerilSequenceNumber, \n\tEXP_GetValues.o_PolicyKey AS PolicyKey, \n\tEXP_GetValues.o_EPLI_Company_Name AS EPLI_Company_Name, \n\tEXP_GetValues.o_EPLI_PolicyKey AS EPLI_PolicyKey, \n\tEXP_GetValues.o_BusinessOwners_Company_Name AS BusinessOwner_Company_Name, \n\tEXP_GetValues.o_BusinessOwners_PolicyKey AS BusinessOwner_PolicyKey, \n\tEXP_GetValues.o_GL_Company_Name AS GL_Company_Name, \n\tEXP_GetValues.o_GL_PolicyKey AS GL_PolicyKey, \n\tEXP_GetValues.o_CA_Company_Name AS CA_Company_Name, \n\tEXP_GetValues.o_CA_PolicyKey AS CA_PolicyKey, \n\tEXP_GetValues.o_SMARTBusiness_Company_Name AS SMARTBusiness_Company_Name, \n\tEXP_GetValues.o_SMARTBusiness_PolicyKey AS SMARTBusiness_PolicyKey, \n\tEXP_GetValues.o_SBOP_Company_Name AS SBOP_Company_Name, \n\tEXP_GetValues.o_SBOP_PolicyKey AS SBOP_PolicyKey, \n\tEXP_GetValues.o_UmbrellaCoverageScope AS UmbrellaCoverageScope, \n\tEXP_GetValues.o_RetroactiveDate AS RetroactiveDate\n\tFROM SQ_EDW\n\tINNER JOIN EXP_GetValues\n\tON EXP_GetValues.o_PolicyKey = SQ_EDW.pol_key\n),\nAGG_Umbrella AS (\n\tSELECT\n\tPremiumTransactionID, \n\tStatisticalCoverageHashKey, \n\tPremiumTransactionHashKey, \n\tMajorPerilSequenceNumber, \n\tEPLI_Company_Name AS i_EPLI_Company_Name, \n\tMAX(i_EPLI_Company_Name) AS o_EPLI_Company_Name, \n\tEPLI_PolicyKey AS i_EPLI_PolicyKey, \n\tMAX(i_EPLI_PolicyKey) AS o_EPLI_PolicyKey, \n\tBusinessOwner_Company_Name AS i_BusinessOwners_Company_Name, \n\tMAX(i_BusinessOwners_Company_Name) AS o_BusinessOwners_Company_Name, \n\tBusinessOwner_PolicyKey AS i_BusinessOwners_PolicyKey, \n\tMAX(i_BusinessOwners_PolicyKey) AS o_BusinessOwners_PolicyKey, \n\tGL_Company_Name AS i_GL_Company_Name, \n\tMAX(i_GL_Company_Name) AS o_GL_Company_Name, \n\tGL_PolicyKey AS i_GL_PolicyKey, \n\tMAX(i_GL_PolicyKey) AS o_GL_PolicyKey, \n\tCA_Company_Name AS i_CA_Company_Name, \n\tMAX(i_CA_Company_Name) AS o_CA_Company_Name, \n\tCA_PolicyKey AS i_CA_PolicyKey, \n\tMAX(i_CA_PolicyKey) AS o_CA_PolicyKey, \n\tSMARTBusiness_Company_Name AS i_SMARTBusiness_Company_Name, \n\tMAX(i_SMARTBusiness_Company_Name) AS o_SMARTBusiness_Company_Name, \n\tSMARTBusiness_PolicyKey AS i_SMARTBusiness_PolicyKey, \n\tMAX(i_SMARTBusiness_PolicyKey) AS o_SMARTBusiness_PolicyKey, \n\tSBOP_Company_Name AS i_SBOP_Company_Name, \n\tMAX(i_SBOP_Company_Name) AS o_SBOP_Company_Name, \n\tSBOP_PolicyKey AS i_SBOP_PolicyKey, \n\tMAX(i_SBOP_PolicyKey) AS o_SBOP_PolicyKey, \n\tUmbrellaCoverageScope, \n\tRetroactiveDate\n\tFROM JNR_Umbrella\n\tGROUP BY PremiumTransactionID\n),\nEXP_DefaultValue AS (\n\tSELECT\n\tPremiumTransactionID AS i_PremiumTransactionID,\n\t1 AS o_CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t-- *INF*: TO_DATE('1800/01/01 00:00:00','YYYY/MM/DD HH24:MI:SS')\n\tTO_DATE('1800/01/01 00:00:00', 'YYYY/MM/DD HH24:MI:SS') AS o_EffectiveDate,\n\t-- *INF*: TO_DATE('2100/12/31 23:59:59','YYYY/MM/DD HH24:MI:SS')\n\tTO_DATE('2100/12/31 23:59:59', 'YYYY/MM/DD HH24:MI:SS') AS o_ExpirationDate,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemID,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\tStatisticalCoverageHashKey,\n\tMajorPerilSequenceNumber,\n\to_EPLI_Company_Name AS i_EPLI_Company_Name,\n\t-- *INF*: IIF(i_EPLI_Company_Name='' OR i_EPLI_PolicyKey='','N/A',i_EPLI_Company_Name)\n\tIFF(i_EPLI_Company_Name = '' OR i_EPLI_PolicyKey = '', 'N/A', i_EPLI_Company_Name) AS o_EPLI_Company_Name,\n\to_EPLI_PolicyKey AS i_EPLI_PolicyKey,\n\t-- *INF*: IIF(i_EPLI_PolicyKey='' OR i_EPLI_Company_Name='','N/A',REPLACESTR(0,i_EPLI_PolicyKey,' ',''))\n\tIFF(i_EPLI_PolicyKey = '' OR i_EPLI_Company_Name = '', 'N/A', REPLACESTR(0, i_EPLI_PolicyKey, ' ', '')) AS o_EPLI_PolicyKey,\n\to_BusinessOwners_Company_Name AS i_BO_Company_Name,\n\t-- *INF*: IIF(i_BO_Company_Name='' OR i_BO_PolicyKey='','N/A',i_BO_Company_Name)\n\tIFF(i_BO_Company_Name = '' OR i_BO_PolicyKey = '', 'N/A', i_BO_Company_Name) AS o_BO_Company_Name,\n\to_BusinessOwners_PolicyKey AS i_BO_PolicyKey,\n\t-- *INF*: IIF(i_BO_PolicyKey='' OR i_BO_Company_Name='','N/A',REPLACESTR(0,i_BO_PolicyKey,' ',''))\n\tIFF(i_BO_PolicyKey = '' OR i_BO_Company_Name = '', 'N/A', REPLACESTR(0, i_BO_PolicyKey, ' ', '')) AS o_BO_PolicyKey,\n\to_GL_Company_Name AS i_GL_Company_Name,\n\t-- *INF*: IIF(i_GL_Company_Name='' OR i_GL_PolicyKey='','N/A',i_GL_Company_Name)\n\tIFF(i_GL_Company_Name = '' OR i_GL_PolicyKey = '', 'N/A', i_GL_Company_Name) AS o_GL_Company_Name,\n\to_GL_PolicyKey AS i_GL_PolicyKey,\n\t-- *INF*: IIF(i_GL_PolicyKey='' OR i_GL_Company_Name='','N/A',REPLACESTR(0,i_GL_PolicyKey,' ',''))\n\tIFF(i_GL_PolicyKey = '' OR i_GL_Company_Name = '', 'N/A', REPLACESTR(0, i_GL_PolicyKey, ' ', '')) AS o_GL_PolicyKey,\n\to_CA_Company_Name AS i_CA_Company_Name,\n\t-- *INF*: IIF(i_CA_Company_Name='' OR i_CA_PolicyKey='','N/A',i_CA_Company_Name)\n\tIFF(i_CA_Company_Name = '' OR i_CA_PolicyKey = '', 'N/A', i_CA_Company_Name) AS o_CA_Company_Name,\n\to_CA_PolicyKey AS i_CA_PolicyKey,\n\t-- *INF*: IIF(i_CA_PolicyKey='' OR i_CA_Company_Name='','N/A',REPLACESTR(0,i_CA_PolicyKey,' ',''))\n\tIFF(i_CA_PolicyKey = '' OR i_CA_Company_Name = '', 'N/A', REPLACESTR(0, i_CA_PolicyKey, ' ', '')) AS o_CA_PolicyKey,\n\to_SMARTBusiness_Company_Name AS i_SMARTBusiness_Company_Name,\n\t-- *INF*: IIF(i_SMARTBusiness_Company_Name='' OR i_SMARTBusiness_PolicyKey='','N/A',i_SMARTBusiness_Company_Name)\n\tIFF(i_SMARTBusiness_Company_Name = '' OR i_SMARTBusiness_PolicyKey = '', 'N/A', i_SMARTBusiness_Company_Name) AS o_SMARTBusiness_Company_Name,\n\to_SMARTBusiness_PolicyKey AS i_SMARTBusiness_PolicyKey,\n\t-- *INF*: IIF(i_SMARTBusiness_PolicyKey='' OR i_SMARTBusiness_Company_Name='','N/A',REPLACESTR(0,i_SMARTBusiness_PolicyKey,' ',''))\n\tIFF(i_SMARTBusiness_PolicyKey = '' OR i_SMARTBusiness_Company_Name = '', 'N/A', REPLACESTR(0, i_SMARTBusiness_PolicyKey, ' ', '')) AS o_SMARTBusiness_PolicyKey,\n\to_SBOP_Company_Name AS i_SBOP_Company_Name,\n\t-- *INF*: IIF(i_SBOP_Company_Name='' OR i_SBOP_PolicyKey='','N/A',i_SBOP_Company_Name)\n\tIFF(i_SBOP_Company_Name = '' OR i_SBOP_PolicyKey = '', 'N/A', i_SBOP_Company_Name) AS o_SBOP_Company_Name,\n\to_SBOP_PolicyKey AS i_SBOP_PolicyKey,\n\t-- *INF*: IIF(i_SBOP_PolicyKey='' OR i_SBOP_Company_Name='','N/A',REPLACESTR(0,i_SBOP_PolicyKey,' ',''))\n\tIFF(i_SBOP_PolicyKey = '' OR i_SBOP_Company_Name = '', 'N/A', REPLACESTR(0, i_SBOP_PolicyKey, ' ', '')) AS o_SBOP_PolicyKey,\n\tUmbrellaCoverageScope,\n\tRetroactiveDate,\n\t-- *INF*: IIF(ISNULL(MajorPerilSequenceNumber) or MajorPerilSequenceNumber='N/A', -1, TO_INTEGER(MajorPerilSequenceNumber))\n\tIFF(MajorPerilSequenceNumber IS NULL OR MajorPerilSequenceNumber = 'N/A', - 1, TO_INTEGER(MajorPerilSequenceNumber)) AS v_UmbrellaLayer,\n\ti_PremiumTransactionID AS o_PremiumTransactionID,\n\tv_UmbrellaLayer AS o_UmbrellaLayer\n\tFROM AGG_Umbrella\n),\nLKP_CoverageDetailCommercialUmbrella AS (\n\tSELECT\n\tPremiumTransactionID,\n\tCoverageGuid,\n\tUmbrellaCoverageScope,\n\tRetroactiveDate,\n\tUmbrellaLayer\n\tFROM (\n\t\tSELECT \n\t\t\tPremiumTransactionID,\n\t\t\tCoverageGuid,\n\t\t\tUmbrellaCoverageScope,\n\t\t\tRetroactiveDate,\n\t\t\tUmbrellaLayer\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialUmbrella\n\t\tWHERE SourceSystemID='@{pipeline().parameters.SOURCE_SYSTEM_ID}'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionID ORDER BY PremiumTransactionID) = 1\n),\nEXP_DetectChange AS (\n\tSELECT\n\tLKP_CoverageDetailCommercialUmbrella.PremiumTransactionID AS lkp_PremiumTransactionID,\n\tLKP_CoverageDetailCommercialUmbrella.CoverageGuid AS lkp_CoverageGuid,\n\tLKP_CoverageDetailCommercialUmbrella.UmbrellaCoverageScope AS lkp_UmbrellaCoverageScope,\n\tLKP_CoverageDetailCommercialUmbrella.RetroactiveDate AS lkp_RetroactiveDate,\n\tLKP_CoverageDetailCommercialUmbrella.UmbrellaLayer AS lkp_UmbrellaLayer,\n\tEXP_DefaultValue.o_PremiumTransactionID AS PremiumTransactionID,\n\tEXP_DefaultValue.o_CurrentSnapshotFlag AS CurrentSnapshotFlag,\n\tEXP_DefaultValue.o_AuditID AS AuditID,\n\tEXP_DefaultValue.o_EffectiveDate AS EffectiveDate,\n\tEXP_DefaultValue.o_ExpirationDate AS ExpirationDate,\n\tEXP_DefaultValue.o_SourceSystemID AS SourceSystemID,\n\tEXP_DefaultValue.o_CreatedDate AS CreatedDate,\n\tEXP_DefaultValue.o_ModifiedDate AS ModifiedDate,\n\tEXP_DefaultValue.StatisticalCoverageHashKey AS CoverageGuid,\n\tEXP_DefaultValue.o_EPLI_Company_Name AS UmbrellaEmployersLiabilityUnderlyingInsuranceCompanyName,\n\tEXP_DefaultValue.o_EPLI_PolicyKey AS UmbrellaEmployersLiabilityUnderlyingInsurancePolicyKey,\n\tEXP_DefaultValue.o_BO_Company_Name AS UmbrellaBusinessOwnersUnderlyingInsuranceCompanyName,\n\tEXP_DefaultValue.o_BO_PolicyKey AS UmbrellaBusinessOwnersUnderlyingInsurancePolicyKey,\n\tEXP_DefaultValue.o_GL_Company_Name AS UmbrellaGeneralLiabilityUnderlyingInsuranceCompanyName,\n\tEXP_DefaultValue.o_GL_PolicyKey AS UmbrellaGeneralLiabilityUnderlyingInsurancePolicyKey,\n\tEXP_DefaultValue.o_CA_Company_Name AS UmbrellaCommercialAutoUnderlyingInsuranceCompanyName,\n\tEXP_DefaultValue.o_CA_PolicyKey AS UmbrellaCommercialAutoUnderlyingInsurancePolicyKey,\n\tEXP_DefaultValue.o_SMARTBusiness_Company_Name AS UmbrellaSMARTbusinessUnderlyingInsuranceCompanyName,\n\tEXP_DefaultValue.o_SMARTBusiness_PolicyKey AS UmbrellaSMARTbusinessUnderlyingInsurancePolicyKey,\n\tEXP_DefaultValue.o_SBOP_Company_Name AS UmbrellaSBOPUnderlyingInsuranceCompanyName,\n\tEXP_DefaultValue.o_SBOP_PolicyKey AS UmbrellaSBOPUnderlyingInsurancePolicyKey,\n\tEXP_DefaultValue.UmbrellaCoverageScope,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- ISNULL(lkp_PremiumTransactionID), 'New', \r\n\t-- lkp_CoverageGuid<>CoverageGuid\r\n\t-- or lkp_UmbrellaCoverageScope<>UmbrellaCoverageScope OR lkp_RetroactiveDate != RetroactiveDate\r\n\t-- or lkp_UmbrellaLayer<>UmbrellaLayer, 'Update',\r\n\t-- 'No Change'\r\n\t-- ) \r\n\t-- \n\tDECODE(TRUE,\n\tlkp_PremiumTransactionID IS NULL, 'New',\n\tlkp_CoverageGuid <> CoverageGuid OR lkp_UmbrellaCoverageScope <> UmbrellaCoverageScope OR lkp_RetroactiveDate != RetroactiveDate OR lkp_UmbrellaLayer <> UmbrellaLayer, 'Update',\n\t'No Change') AS v_ChangeFlag,\n\tv_ChangeFlag AS o_ChangeFlag,\n\tEXP_DefaultValue.RetroactiveDate,\n\tEXP_DefaultValue.o_UmbrellaLayer AS UmbrellaLayer\n\tFROM EXP_DefaultValue\n\tLEFT JOIN LKP_CoverageDetailCommercialUmbrella\n\tON LKP_CoverageDetailCommercialUmbrella.PremiumTransactionID = EXP_DefaultValue.o_PremiumTransactionID\n),\nRTR_InsertElseUpdate AS (\n\tSELECT\n\tlkp_PremiumTransactionID,\n\tPremiumTransactionID,\n\tCurrentSnapshotFlag,\n\tAuditID,\n\tEffectiveDate,\n\tExpirationDate,\n\tSourceSystemID,\n\tCreatedDate,\n\tModifiedDate,\n\tCoverageGuid,\n\tUmbrellaEmployersLiabilityUnderlyingInsuranceCompanyName,\n\tUmbrellaEmployersLiabilityUnderlyingInsurancePolicyKey,\n\tUmbrellaBusinessOwnersUnderlyingInsuranceCompanyName,\n\tUmbrellaBusinessOwnersUnderlyingInsurancePolicyKey,\n\tUmbrellaGeneralLiabilityUnderlyingInsuranceCompanyName,\n\tUmbrellaGeneralLiabilityUnderlyingInsurancePolicyKey,\n\tUmbrellaCommercialAutoUnderlyingInsuranceCompanyName,\n\tUmbrellaCommercialAutoUnderlyingInsurancePolicyKey,\n\tUmbrellaSMARTbusinessUnderlyingInsuranceCompanyName,\n\tUmbrellaSMARTbusinessUnderlyingInsurancePolicyKey,\n\tUmbrellaSBOPUnderlyingInsuranceCompanyName,\n\tUmbrellaSBOPUnderlyingInsurancePolicyKey,\n\tUmbrellaCoverageScope,\n\to_ChangeFlag AS ChangeFlag,\n\tRetroactiveDate,\n\tUmbrellaLayer\n\tFROM EXP_DetectChange\n),\nRTR_InsertElseUpdate_INSERT AS (SELECT * FROM RTR_InsertElseUpdate WHERE ChangeFlag='New'),\nRTR_InsertElseUpdate_UPDATE AS (SELECT * FROM RTR_InsertElseUpdate WHERE ChangeFlag='Update'),\nTGT_CoverageDetailCommercialUmbrella_Insert AS (\n\tINSERT INTO CoverageDetailCommercialUmbrella\n\t(PremiumTransactionID, CurrentSnapshotFlag, AuditID, EffectiveDate, ExpirationDate, SourceSystemID, CreatedDate, ModifiedDate, CoverageGuid, UmbrellaCoverageScope, RetroactiveDate, UmbrellaLayer)\n\tSELECT \n\tPREMIUMTRANSACTIONID, \n\tCURRENTSNAPSHOTFLAG, \n\tAUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tSOURCESYSTEMID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tCOVERAGEGUID, \n\tUMBRELLACOVERAGESCOPE, \n\tRETROACTIVEDATE, \n\tUMBRELLALAYER\n\tFROM RTR_InsertElseUpdate_INSERT\n),\nUPD_UpdateData AS (\n\tSELECT\n\tlkp_PremiumTransactionID AS PremiumTransactionID, \n\tCurrentSnapshotFlag, \n\tAuditID, \n\tEffectiveDate, \n\tExpirationDate, \n\tSourceSystemID, \n\tCreatedDate, \n\tModifiedDate, \n\tCoverageGuid, \n\tUmbrellaEmployersLiabilityUnderlyingInsuranceCompanyName, \n\tUmbrellaEmployersLiabilityUnderlyingInsurancePolicyKey, \n\tUmbrellaBusinessOwnersUnderlyingInsuranceCompanyName, \n\tUmbrellaBusinessOwnersUnderlyingInsurancePolicyKey, \n\tUmbrellaGeneralLiabilityUnderlyingInsuranceCompanyName, \n\tUmbrellaGeneralLiabilityUnderlyingInsurancePolicyKey, \n\tUmbrellaCommercialAutoUnderlyingInsuranceCompanyName, \n\tUmbrellaCommercialAutoUnderlyingInsurancePolicyKey, \n\tUmbrellaSMARTbusinessUnderlyingInsuranceCompanyName, \n\tUmbrellaSMARTbusinessUnderlyingInsurancePolicyKey, \n\tUmbrellaSBOPUnderlyingInsuranceCompanyName, \n\tUmbrellaSBOPUnderlyingInsurancePolicyKey, \n\tUmbrellaCoverageScope, \n\tRetroactiveDate, \n\tUmbrellaLayer\n\tFROM RTR_InsertElseUpdate_UPDATE\n),\nTGT_CoverageDetailCommercialUmbrella_Update AS (\n\tMERGE INTO CoverageDetailCommercialUmbrella AS T\n\tUSING UPD_UpdateData AS S\n\tON T.PremiumTransactionID = S.PremiumTransactionID\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.ModifiedDate = S.ModifiedDate, T.CoverageGuid = S.CoverageGuid, T.UmbrellaCoverageScope = S.UmbrellaCoverageScope, T.RetroactiveDate = S.RetroactiveDate, T.UmbrellaLayer = S.UmbrellaLayer\n),"
                        }
                    ]
                }
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246483"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905516"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604202"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 01:21:59"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 01:54:57"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Stage_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "dbo"
            },
            "TARGET_TABLE_OWNER_V2": {
                "type": "string",
                "defaultValue": "V2"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "PMS"
            },
            "MERGED_SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "EXCEED AND PMS"
            },
            "SOURCE_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "WC_Stage"
            },
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": ""
            }
        },
        "folder": {
            "name": ""
        },
        "annotations": []
    }
}