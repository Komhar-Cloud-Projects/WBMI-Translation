{
    "name": "m_POL_DW_LOAD_CoverageDetailCommercialProperty_DCT",
    "properties": {
        "activities": [
            {
                "name": "m_POL_DW_LOAD_CoverageDetailCommercialProperty_DCT",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_SupISOCommercialPropertyCauseOfLossGroup_DCT AS (\n\tSELECT\n\tISOCommercialPropertyCauseOfLossGroup,\n\tProductCode,\n\tSublineCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOCommercialPropertyCauseOfLossGroup,\n\t\t\tProductCode,\n\t\t\tSublineCode\n\t\tFROM SupISOCommercialPropertyCauseOfLossGroup\n\t\tWHERE CurrentSnapshotFlag=1 and SourceSystemID='DCT'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ProductCode,SublineCode ORDER BY ISOCommercialPropertyCauseOfLossGroup) = 1\n),\nSQ_DCTWorkTables AS (\n\tSELECT\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.CoverageId,\n\t\tWorkDCTCoverageTransaction.CoverageGUID,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.MultipleLocationCreditFactor,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.PreferredPropertyCreditFactor,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.ProtectionClass,\n\t\tWorkDCTInsuranceLine.LineId,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.SprinkerFlag AS SprinklerFlag,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.CauseOfLoss,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.PerilGroup,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.RateType,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.PropertyType,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.OccupancyCategory,\n\t\tWorkDCTInsuranceLine.LineType,\n\t\tWorkDCTTransactionInsuranceLineLocationBridge.RetroactiveDate\n\tFROM WorkDCTTransactionInsuranceLineLocationBridge\n\tINNER JOIN WorkDCTInsuranceLine\n\tINNER JOIN WorkDCTCoverageTransaction\n\tON WorkDCTCoverageTransaction.CoverageId=WorkDCTTransactionInsuranceLineLocationBridge.CoverageId\r\n\tand\r\n\tWorkDCTTransactionInsuranceLineLocationBridge.LineId=WorkDCTInsuranceLine.LineId\r\n\tand\r\n\tWorkDCTInsuranceLine.LineType in ('Property','SBOPProperty','BusinessOwners')\n),\nSQ_WorkPremiumTransaction AS (\n\tSELECT PT.Premiumtransactionid, \r\n\t       PT.Currentsnapshotflag, \r\n\t       WPT.PremiumTransactionStageId, \r\n\t       RC.Classcode, \r\n\t       RL.Stateprovincecode, \r\n\t       P.Productcode, \r\n\t       RC.Sublinecode \r\n\tFROM   @{pipeline().parameters.SOURCE_TABLE_OWNER}.WorkPremiumTransaction WPT \r\n\t       INNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Premiumtransaction PT ON PT.PremiumTransactionAKID = WPT.PremiumTransactionAKID \r\n\t       INNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Ratingcoverage RC ON RC.RatingCoverageAKID = PT.RatingCoverageAKID AND RC.Effectivedate = PT.Effectivedate \r\n\t       INNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Policycoverage PC ON RC.PolicyCoverageAKID = PC.PolicyCoverageAKID AND PC.Currentsnapshotflag =1 \r\n\t\t  INNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Risklocation RL ON PC.RiskLocationAKID = RL.RiskLocationAKID AND RL.Currentsnapshotflag =1 \r\n\t       INNER JOIN @{pipeline().parameters.SOURCE_TABLE_OWNER}.Product P ON P.ProductAKID = RC.ProductAKID and P.Currentsnapshotflag =1\r\n\tWHERE  PT.Sourcesystemid = '@{pipeline().parameters.SOURCE_SYSTEM_ID}' AND WPT.Sourcesystemid = '@{pipeline().parameters.SOURCE_SYSTEM_ID}'\r\n\tAND PC.InsuranceLine in ('Property','SBOPProperty','BusinessOwners')\n),\nJNR_Property AS (SELECT\n\tSQ_WorkPremiumTransaction.PremiumTransactionID, \n\tSQ_WorkPremiumTransaction.CurrentSnapshotFlag, \n\tSQ_WorkPremiumTransaction.PremiumTransactionStageId, \n\tSQ_WorkPremiumTransaction.ClassCode, \n\tSQ_WorkPremiumTransaction.StateProvinceCode, \n\tSQ_WorkPremiumTransaction.ProductCode, \n\tSQ_WorkPremiumTransaction.SublineCode, \n\tSQ_DCTWorkTables.CoverageId, \n\tSQ_DCTWorkTables.CoverageGUID, \n\tSQ_DCTWorkTables.MultipleLocationCreditFactor, \n\tSQ_DCTWorkTables.PreferredPropertyCreditFactor, \n\tSQ_DCTWorkTables.ProtectionClass, \n\tSQ_DCTWorkTables.SprinklerFlag, \n\tSQ_DCTWorkTables.CauseOfLoss, \n\tSQ_DCTWorkTables.PerilGroup, \n\tSQ_DCTWorkTables.RateType, \n\tSQ_DCTWorkTables.PropertyType, \n\tSQ_DCTWorkTables.OccupancyCategory AS OccupanyCategory, \n\tSQ_DCTWorkTables.LineType, \n\tSQ_DCTWorkTables.RetroactiveDate\n\tFROM SQ_WorkPremiumTransaction\n\tINNER JOIN SQ_DCTWorkTables\n\tON SQ_DCTWorkTables.CoverageId = SQ_WorkPremiumTransaction.PremiumTransactionStageId\n),\nAGG_Property AS (\n\tSELECT\n\tPremiumTransactionID, \n\tCurrentSnapshotFlag, \n\tClassCode, \n\tStateProvinceCode, \n\tProductCode, \n\tSublineCode, \n\tCoverageGUID, \n\tMultipleLocationCreditFactor, \n\tPreferredPropertyCreditFactor, \n\tProtectionClass, \n\tSprinklerFlag, \n\tCauseOfLoss, \n\tPerilGroup, \n\tRateType, \n\tPropertyType, \n\tOccupanyCategory, \n\tLineType, \n\tRetroactiveDate\n\tFROM JNR_Property\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionID ORDER BY NULL) = 1\n),\nEXP_CoverageDetailCommercialProperty AS (\n\tSELECT\n\tPremiumTransactionID AS i_PremiumTransactionID,\n\tCurrentSnapshotFlag AS i_CurrentSnapshotFlag,\n\tClassCode AS i_ClassCode,\n\tStateProvinceCode AS i_StateProvinceCode,\n\tProductCode AS i_ProductCode,\n\tSublineCode AS i_SublineCode,\n\tCoverageGUID AS i_CoverageGuid,\n\tMultipleLocationCreditFactor AS i_MultipleLocationCreditFactor,\n\tPreferredPropertyCreditFactor AS i_PreferredPropertyCredit,\n\tProtectionClass AS i_TerritoryProtectionClass,\n\tSprinklerFlag AS i_SprinklerFlag,\n\tCauseOfLoss AS i_CauseOfLoss,\n\tPerilGroup AS i_PerilGroup,\n\tRateType AS i_RateType,\n\tPropertyType AS i_PropertyType,\n\tOccupanyCategory AS i_OccupanyCategory,\n\tLineType AS i_LineType,\n\tRetroactiveDate AS i_RetroactiveDate,\n\t-- *INF*: :LKP.LKP_SupISOCommercialPropertyCauseOfLossGroup_DCT(i_ProductCode,i_SublineCode)\n\tLKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_DCT_i_ProductCode_i_SublineCode.ISOCommercialPropertyCauseOfLossGroup AS v_ISOPropertyCauseofLossGroup,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_ISOPropertyCauseofLossGroup='SCL'  AND (i_PropertyType='' OR ISNULL(i_PropertyType)), 'Buildings',\r\n\t-- v_ISOPropertyCauseofLossGroup='SCL'  , i_OccupanyCategory,\r\n\t-- 'N/A')\n\tDECODE(TRUE,\n\tv_ISOPropertyCauseofLossGroup = 'SCL' AND ( i_PropertyType = '' OR i_PropertyType IS NULL ), 'Buildings',\n\tv_ISOPropertyCauseofLossGroup = 'SCL', i_OccupanyCategory,\n\t'N/A') AS v_ISOSpecialCauseOfLossCategory,\n\ti_PremiumTransactionID AS o_PremiumTransactionID,\n\t-- *INF*: IIF(i_CurrentSnapshotFlag='T',1,0)\n\tIFF(i_CurrentSnapshotFlag = 'T', 1, 0) AS o_CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS o_AuditID,\n\t-- *INF*: TO_DATE('01/01/1800 00:00:00', 'MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('01/01/1800 00:00:00', 'MM/DD/YYYY HH24:MI:SS') AS o_EffectiveDate,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59' , 'MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS o_ExpirationDate,\n\t@{pipeline().parameters.SOURCE_SYSTEM_ID} AS o_SourceSystemID,\n\tSYSDATE AS o_CreatedDate,\n\tSYSDATE AS o_ModifiedDate,\n\ti_CoverageGuid AS o_CoverageGuid,\n\t-- *INF*: :UDF.DEFAULT_VALUE_FOR_STRINGS(i_TerritoryProtectionClass)\n\t:UDF.DEFAULT_VALUE_FOR_STRINGS(i_TerritoryProtectionClass) AS o_IsoFireProtectionCode,\n\t-- *INF*: IIF(ISNULL(i_MultipleLocationCreditFactor),0,i_MultipleLocationCreditFactor)\n\tIFF(i_MultipleLocationCreditFactor IS NULL, 0, i_MultipleLocationCreditFactor) AS o_MultiLocationCreditFactor,\n\t-- *INF*: IIF(ISNULL(i_PreferredPropertyCredit),0,TO_DECIMAL(i_PreferredPropertyCredit))\n\tIFF(i_PreferredPropertyCredit IS NULL, 0, TO_DECIMAL(i_PreferredPropertyCredit)) AS o_PreferredPropertyFactor,\n\t-- *INF*: DECODE(i_SprinklerFlag,'T',1,'F',0,0)\n\tDECODE(i_SprinklerFlag,\n\t'T', 1,\n\t'F', 0,\n\t0) AS o_SprinklerFlag,\n\t-- *INF*: iif(isnull(v_ISOPropertyCauseofLossGroup),'N/A',v_ISOPropertyCauseofLossGroup)\n\tIFF(v_ISOPropertyCauseofLossGroup IS NULL, 'N/A', v_ISOPropertyCauseofLossGroup) AS o_ISOPropertyCauseofLossGroup,\n\t-- *INF*: IIF(ISNULL(v_ISOSpecialCauseOfLossCategory),'N/A',v_ISOSpecialCauseOfLossCategory)\n\tIFF(v_ISOSpecialCauseOfLossCategory IS NULL, 'N/A', v_ISOSpecialCauseOfLossCategory) AS o_ISOSpecialCauseOfLossCategory,\n\t-- *INF*: --LPAD(i_ClassCode,6, '0')\r\n\t-- SUBSTR(i_ClassCode,1,4)\n\tSUBSTR(i_ClassCode, 1, 4) AS o_ClassCode,\n\ti_StateProvinceCode AS o_StateProvinceCode,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- i_RateType='S', 'Specific',\r\n\t-- i_RateType='C', 'Class',\r\n\t-- 'N/A')\n\tDECODE(TRUE,\n\ti_RateType = 'S', 'Specific',\n\ti_RateType = 'C', 'Class',\n\t'N/A') AS o_RateType,\n\ti_LineType AS o_LineType,\n\t-- *INF*: IIF(ISNULL(i_RetroactiveDate),\r\n\t-- TO_DATE('1800-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS'),\r\n\t-- i_RetroactiveDate\r\n\t-- )\n\tIFF(i_RetroactiveDate IS NULL, TO_DATE('1800-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), i_RetroactiveDate) AS o_RetroactiveDate\n\tFROM AGG_Property\n\tLEFT JOIN LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_DCT LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_DCT_i_ProductCode_i_SublineCode\n\tON LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_DCT_i_ProductCode_i_SublineCode.ProductCode = i_ProductCode\n\tAND LKP_SUPISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP_DCT_i_ProductCode_i_SublineCode.SublineCode = i_SublineCode\n\n),\nLKP_ISOSpecialCauseOfLossCategoryCode AS (\n\tSELECT\n\tISOSpecialCauseOfLossCategoryCode,\n\tISOSpecialCauseOfLossCategoryDCTCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOSpecialCauseOfLossCategoryCode,\n\t\t\tISOSpecialCauseOfLossCategoryDCTCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupISOSpecialCauseOfLossCategory\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ISOSpecialCauseOfLossCategoryDCTCode ORDER BY ISOSpecialCauseOfLossCategoryCode) = 1\n),\nLKP_SupClassificationCommercialProperty AS (\n\tSELECT\n\tISOCPRatingGroup,\n\tCommercialPropertySpecialClass,\n\tClassCode,\n\tRatingStateCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOCPRatingGroup,\n\t\t\tCommercialPropertySpecialClass,\n\t\t\tClassCode,\n\t\t\tRatingStateCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupClassificationCommercialProperty\n\t\tWHERE CurrentSnapshotFlag=1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ClassCode,RatingStateCode ORDER BY ISOCPRatingGroup) = 1\n),\nLKP_SupClassificationCommercialProperty_default AS (\n\tSELECT\n\tISOCPRatingGroup,\n\tCommercialPropertySpecialClass,\n\tClassCode\n\tFROM (\n\t\tSELECT \n\t\t\tISOCPRatingGroup,\n\t\t\tCommercialPropertySpecialClass,\n\t\t\tClassCode\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.SupClassificationCommercialProperty\n\t\tWHERE CurrentSnapshotFlag=1 and RatingStateCode='99'\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY ClassCode ORDER BY ISOCPRatingGroup) = 1\n),\nEXP_Calc AS (\n\tSELECT\n\tEXP_CoverageDetailCommercialProperty.o_PremiumTransactionID AS PremiumTransactionID,\n\tEXP_CoverageDetailCommercialProperty.o_CurrentSnapshotFlag AS CurrentSnapshotFlag,\n\tEXP_CoverageDetailCommercialProperty.o_AuditID AS AuditID,\n\tEXP_CoverageDetailCommercialProperty.o_LineType AS i_LineType,\n\tEXP_CoverageDetailCommercialProperty.o_EffectiveDate AS EffectiveDate,\n\tEXP_CoverageDetailCommercialProperty.o_ExpirationDate AS ExpirationDate,\n\tEXP_CoverageDetailCommercialProperty.o_SourceSystemID AS SourceSystemID,\n\tEXP_CoverageDetailCommercialProperty.o_CreatedDate AS CreatedDate,\n\tEXP_CoverageDetailCommercialProperty.o_ModifiedDate AS ModifiedDate,\n\tEXP_CoverageDetailCommercialProperty.o_CoverageGuid AS CoverageGuid,\n\tEXP_CoverageDetailCommercialProperty.o_IsoFireProtectionCode AS IsoFireProtectionCode,\n\tEXP_CoverageDetailCommercialProperty.o_MultiLocationCreditFactor AS MultiLocationCreditFactor,\n\tEXP_CoverageDetailCommercialProperty.o_PreferredPropertyFactor AS PreferredPropertyFactor,\n\tEXP_CoverageDetailCommercialProperty.o_SprinklerFlag AS SprinklerFlag,\n\tEXP_CoverageDetailCommercialProperty.o_ISOPropertyCauseofLossGroup AS ISOPropertyCauseofLossGroup,\n\tLKP_ISOSpecialCauseOfLossCategoryCode.ISOSpecialCauseOfLossCategoryCode AS i_ISOSpecialCauseOfLossCategory,\n\tEXP_CoverageDetailCommercialProperty.o_RateType AS RateType,\n\tLKP_SupClassificationCommercialProperty.ISOCPRatingGroup AS lk_ISOCPRatingGroup,\n\tLKP_SupClassificationCommercialProperty.CommercialPropertySpecialClass AS lk_PropertySpecialClass,\n\tLKP_SupClassificationCommercialProperty_default.ISOCPRatingGroup AS lk_ISOCPRatingGroup_default,\n\tLKP_SupClassificationCommercialProperty_default.CommercialPropertySpecialClass AS lk_PropertySpecialClass_default,\n\t-- *INF*: IIF(ISOPropertyCauseofLossGroup='BGI',\r\n\t-- DECODE(TRUE,\r\n\t-- not isnull(lk_ISOCPRatingGroup),lk_ISOCPRatingGroup,\r\n\t-- not isnull(lk_ISOCPRatingGroup_default),lk_ISOCPRatingGroup_default,\r\n\t-- 'N/A'),'N/A')\n\tIFF(ISOPropertyCauseofLossGroup = 'BGI', DECODE(TRUE,\n\tNOT lk_ISOCPRatingGroup IS NULL, lk_ISOCPRatingGroup,\n\tNOT lk_ISOCPRatingGroup_default IS NULL, lk_ISOCPRatingGroup_default,\n\t'N/A'), 'N/A') AS v_ISOCPRatingGroup,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- not isnull(lk_PropertySpecialClass),lk_PropertySpecialClass,\r\n\t-- not isnull(lk_PropertySpecialClass_default),lk_PropertySpecialClass_default,\r\n\t-- 'N/A')\n\tDECODE(TRUE,\n\tNOT lk_PropertySpecialClass IS NULL, lk_PropertySpecialClass,\n\tNOT lk_PropertySpecialClass_default IS NULL, lk_PropertySpecialClass_default,\n\t'N/A') AS v_PropertySpecialClass,\n\t-- *INF*: IIF(i_LineType='Property' or i_LineType='SBOPProperty',\r\n\t-- ISOPropertyCauseofLossGroup,'N/A')\n\tIFF(i_LineType = 'Property' OR i_LineType = 'SBOPProperty', ISOPropertyCauseofLossGroup, 'N/A') AS o_ISOPropertyCauseofLossGroup,\n\t-- *INF*: IIF(i_LineType='Property' or i_LineType='SBOPProperty',\r\n\t-- iif(isnull(i_ISOSpecialCauseOfLossCategory),'N/A',i_ISOSpecialCauseOfLossCategory),'N/A')\n\tIFF(i_LineType = 'Property' OR i_LineType = 'SBOPProperty', IFF(i_ISOSpecialCauseOfLossCategory IS NULL, 'N/A', i_ISOSpecialCauseOfLossCategory), 'N/A') AS o_ISOSpecialCauseOfLossCategory,\n\t-- *INF*: IIF(i_LineType='Property' or i_LineType='SBOPProperty',RateType,'N/A')\n\tIFF(i_LineType = 'Property' OR i_LineType = 'SBOPProperty', RateType, 'N/A') AS o_RateType,\n\t-- *INF*: IIF(i_LineType='Property' or i_LineType='SBOPProperty',v_ISOCPRatingGroup,'N/A')\n\tIFF(i_LineType = 'Property' OR i_LineType = 'SBOPProperty', v_ISOCPRatingGroup, 'N/A') AS o_ISOCPRatingGroup,\n\t-- *INF*: IIF(i_LineType='Property' or i_LineType='SBOPProperty',v_PropertySpecialClass,'N/A')\n\tIFF(i_LineType = 'Property' OR i_LineType = 'SBOPProperty', v_PropertySpecialClass, 'N/A') AS o_PropertySpecialClass,\n\tEXP_CoverageDetailCommercialProperty.o_RetroactiveDate\n\tFROM EXP_CoverageDetailCommercialProperty\n\tLEFT JOIN LKP_ISOSpecialCauseOfLossCategoryCode\n\tON LKP_ISOSpecialCauseOfLossCategoryCode.ISOSpecialCauseOfLossCategoryDCTCode = EXP_CoverageDetailCommercialProperty.o_ISOSpecialCauseOfLossCategory\n\tLEFT JOIN LKP_SupClassificationCommercialProperty\n\tON LKP_SupClassificationCommercialProperty.ClassCode = EXP_CoverageDetailCommercialProperty.o_ClassCode AND LKP_SupClassificationCommercialProperty.RatingStateCode = EXP_CoverageDetailCommercialProperty.o_StateProvinceCode\n\tLEFT JOIN LKP_SupClassificationCommercialProperty_default\n\tON LKP_SupClassificationCommercialProperty_default.ClassCode = EXP_CoverageDetailCommercialProperty.o_ClassCode\n),\nLKP_CoverageDetailCommercialProperty AS (\n\tSELECT\n\tPremiumTransactionId,\n\tIsoFireProtectionCode,\n\tMultiLocationCreditFactor,\n\tPreferredPropertyFactor,\n\tSprinklerFlag,\n\tISOCommercialPropertyCauseofLossGroup,\n\tISOCommercialPropertyRatingGroupCode,\n\tISOSpecialCauseOfLossCategoryCode,\n\tRateType,\n\tCommercialPropertySpecialClass\n\tFROM (\n\t\tSELECT \n\t\t\tPremiumTransactionId,\n\t\t\tIsoFireProtectionCode,\n\t\t\tMultiLocationCreditFactor,\n\t\t\tPreferredPropertyFactor,\n\t\t\tSprinklerFlag,\n\t\t\tISOCommercialPropertyCauseofLossGroup,\n\t\t\tISOCommercialPropertyRatingGroupCode,\n\t\t\tISOSpecialCauseOfLossCategoryCode,\n\t\t\tRateType,\n\t\t\tCommercialPropertySpecialClass\n\t\tFROM @{pipeline().parameters.TARGET_TABLE_OWNER}.CoverageDetailCommercialProperty\n\t\tWHERE PremiumTransactionID  in (select pt.PremiumTransactionID from\r\n\t\tPremiumTransaction pt\r\n\t\tinner join WorkPremiumTransaction wpt\r\n\t\ton pt.PremiumTransactionAKID=wpt.PremiumTransactionAKId)\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY PremiumTransactionId ORDER BY PremiumTransactionId) = 1\n),\nEXP_DetectChanges AS (\n\tSELECT\n\tLKP_CoverageDetailCommercialProperty.PremiumTransactionId AS lkp_PremiumTransactionId,\n\tLKP_CoverageDetailCommercialProperty.IsoFireProtectionCode AS lkp_IsoFireProtectionCode,\n\tLKP_CoverageDetailCommercialProperty.MultiLocationCreditFactor AS lkp_MultiLocationCreditFactor,\n\tLKP_CoverageDetailCommercialProperty.PreferredPropertyFactor AS lkp_PreferredPropertyFactor,\n\tLKP_CoverageDetailCommercialProperty.SprinklerFlag AS lkp_SprinklerFlag_origin,\n\t-- *INF*: DECODE(lkp_SprinklerFlag_origin,'T',1,'F',0,NULL)\n\tDECODE(lkp_SprinklerFlag_origin,\n\t'T', 1,\n\t'F', 0,\n\tNULL) AS lkp_SprinklerFlag,\n\tLKP_CoverageDetailCommercialProperty.ISOCommercialPropertyCauseofLossGroup AS lkp_ISOPropertyCauseofLossGroup,\n\tLKP_CoverageDetailCommercialProperty.ISOCommercialPropertyRatingGroupCode AS lkp_ISOCPRatingGroup,\n\tLKP_CoverageDetailCommercialProperty.ISOSpecialCauseOfLossCategoryCode AS lkp_ISOSpecialCauseOfLossCategory,\n\tLKP_CoverageDetailCommercialProperty.RateType AS lkp_RateType,\n\tLKP_CoverageDetailCommercialProperty.CommercialPropertySpecialClass AS lkp_PropertySpecialClass,\n\tEXP_Calc.PremiumTransactionID,\n\tEXP_Calc.CurrentSnapshotFlag,\n\tEXP_Calc.AuditID,\n\tEXP_Calc.EffectiveDate,\n\tEXP_Calc.ExpirationDate,\n\tEXP_Calc.SourceSystemID,\n\tEXP_Calc.CreatedDate,\n\tEXP_Calc.ModifiedDate,\n\tEXP_Calc.CoverageGuid,\n\tEXP_Calc.IsoFireProtectionCode,\n\tEXP_Calc.MultiLocationCreditFactor,\n\tEXP_Calc.PreferredPropertyFactor,\n\tEXP_Calc.SprinklerFlag,\n\tEXP_Calc.o_ISOPropertyCauseofLossGroup AS ISOPropertyCauseofLossGroup,\n\tEXP_Calc.o_ISOSpecialCauseOfLossCategory AS ISOSpecialCauseOfLossCategory,\n\tEXP_Calc.o_RateType AS RateType,\n\tEXP_Calc.o_ISOCPRatingGroup AS ISOCPRatingGroup,\n\tEXP_Calc.o_PropertySpecialClass AS PropertySpecialClass,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- ISNULL(lkp_PremiumTransactionId),'INSERT',\r\n\t--  lkp_IsoFireProtectionCode<>IsoFireProtectionCode \r\n\t-- OR lkp_MultiLocationCreditFactor<>MultiLocationCreditFactor \r\n\t-- OR lkp_PreferredPropertyFactor<>PreferredPropertyFactor \r\n\t-- OR lkp_SprinklerFlag<>SprinklerFlag\r\n\t-- OR lkp_ISOPropertyCauseofLossGroup<>ISOPropertyCauseofLossGroup \r\n\t-- OR lkp_ISOCPRatingGroup<>ISOCPRatingGroup \r\n\t-- OR lkp_ISOSpecialCauseOfLossCategory<>ISOSpecialCauseOfLossCategory \r\n\t-- OR lkp_RateType<>RateType\r\n\t-- OR lkp_PropertySpecialClass<>PropertySpecialClass\r\n\t-- \r\n\t-- , 'UPDATE',\r\n\t-- 'NO CHANGE'\r\n\t-- )\n\tDECODE(TRUE,\n\tlkp_PremiumTransactionId IS NULL, 'INSERT',\n\tlkp_IsoFireProtectionCode <> IsoFireProtectionCode OR lkp_MultiLocationCreditFactor <> MultiLocationCreditFactor OR lkp_PreferredPropertyFactor <> PreferredPropertyFactor OR lkp_SprinklerFlag <> SprinklerFlag OR lkp_ISOPropertyCauseofLossGroup <> ISOPropertyCauseofLossGroup OR lkp_ISOCPRatingGroup <> ISOCPRatingGroup OR lkp_ISOSpecialCauseOfLossCategory <> ISOSpecialCauseOfLossCategory OR lkp_RateType <> RateType OR lkp_PropertySpecialClass <> PropertySpecialClass, 'UPDATE',\n\t'NO CHANGE') AS o_ChangeFlag,\n\tEXP_Calc.o_RetroactiveDate AS RetroactiveDate\n\tFROM EXP_Calc\n\tLEFT JOIN LKP_CoverageDetailCommercialProperty\n\tON LKP_CoverageDetailCommercialProperty.PremiumTransactionId = EXP_Calc.PremiumTransactionID\n),\nFILT_Records AS (\n\tSELECT\n\tPremiumTransactionID, \n\tCurrentSnapshotFlag, \n\tAuditID, \n\tEffectiveDate, \n\tExpirationDate, \n\tSourceSystemID, \n\tCreatedDate, \n\tModifiedDate, \n\tCoverageGuid, \n\tIsoFireProtectionCode, \n\tMultiLocationCreditFactor, \n\tPreferredPropertyFactor, \n\tSprinklerFlag, \n\tISOPropertyCauseofLossGroup, \n\tISOSpecialCauseOfLossCategory, \n\tRateType, \n\tISOCPRatingGroup, \n\tPropertySpecialClass, \n\tRetroactiveDate, \n\to_ChangeFlag AS ChangeFlag\n\tFROM EXP_DetectChanges\n\tWHERE ChangeFlag='INSERT'\n),\nCoverageDetailCommercialProperty_Insert AS (\n\tINSERT INTO CoverageDetailCommercialProperty\n\t(PremiumTransactionID, CurrentSnapshotFlag, AuditID, EffectiveDate, ExpirationDate, SourceSystemID, CreatedDate, ModifiedDate, CoverageGuid, IsoFireProtectionCode, MultiLocationCreditFactor, PreferredPropertyFactor, SprinklerFlag, RetroactiveDate, ISOCommercialPropertyCauseofLossGroup, ISOCommercialPropertyRatingGroupCode, ISOSpecialCauseOfLossCategoryCode, RateType, CommercialPropertySpecialClass)\n\tSELECT \n\tPREMIUMTRANSACTIONID, \n\tCURRENTSNAPSHOTFLAG, \n\tAUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tSOURCESYSTEMID, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tCOVERAGEGUID, \n\tISOFIREPROTECTIONCODE, \n\tMULTILOCATIONCREDITFACTOR, \n\tPREFERREDPROPERTYFACTOR, \n\tSPRINKLERFLAG, \n\tRETROACTIVEDATE, \n\tISOPropertyCauseofLossGroup AS ISOCOMMERCIALPROPERTYCAUSEOFLOSSGROUP, \n\tISOCPRatingGroup AS ISOCOMMERCIALPROPERTYRATINGGROUPCODE, \n\tISOSpecialCauseOfLossCategory AS ISOSPECIALCAUSEOFLOSSCATEGORYCODE, \n\tRATETYPE, \n\tPropertySpecialClass AS COMMERCIALPROPERTYSPECIALCLASS\n\tFROM FILT_Records\n),\nSQ_CoverageDetailCommercialProperty AS (\n\tSELECT \r\n\tCDCPPrevious.IsoFireProtectionCode, \r\n\tCDCPPrevious.MultiLocationCreditFactor, \r\n\tCDCPPrevious.PreferredPropertyFactor, \r\n\tCDCPPrevious.SprinklerFlag,\r\n\tCDCPPrevious.RetroactiveDate,\r\n\tCDCPPrevious.ISOCommercialPropertyCauseofLossGroup,\r\n\tCDCPPrevious.ISOCommercialPropertyRatingGroupCode,\r\n\tCDCPPrevious.ISOSpecialCauseOfLossCategoryCode,   \r\n\tCDCPPrevious.RateType, \r\n\tCDCPPrevious.CommercialPropertySpecialClass, \r\n\tWPTOL.PremiumTransactionID AS Wrk_PremiumTransactionID\r\n\tFROM\r\n\tWorkPremiumTransactionOffsetLineage WPTOL inner join CoverageDetailCommercialProperty CDCPPrevious\r\n\ton ( CDCPPrevious.PremiumTransactionID= WPTOL.previouspremiumtransactionid)\r\n\tinner join CoverageDetailCommercialProperty CDCPToUpdate\r\n\ton ( CDCPToUpdate.PremiumTransactionID= WPTOL.PremiumTransactionid)\r\n\tINNER JOIN premiumtransaction pt WITH (NOLOCK) on\r\n\t\tWPTOL .premiumtransactionid=pt.premiumtransactionid and PT.OffsetOnsetCode='Offset'\r\n\tWHERE\r\n\tWPTOL.UpdateAttributeFlag = 1 \r\n\tAND (\r\n\t  CDCPPrevious.CommercialPropertySpecialClass <> CDCPToUpdate.CommercialPropertySpecialClass\r\n\t  OR CDCPPrevious.ISOCommercialPropertyCauseofLossGroup <> CDCPToUpdate.ISOCommercialPropertyCauseofLossGroup\r\n\t  OR CDCPPrevious.ISOCommercialPropertyRatingGroupCode <> CDCPToUpdate.ISOCommercialPropertyRatingGroupCode\r\n\t  OR CDCPPrevious.IsoFireProtectionCode <> CDCPToUpdate.IsoFireProtectionCode\r\n\t  OR CDCPPrevious.ISOSpecialCauseOfLossCategoryCode <> CDCPToUpdate.ISOSpecialCauseOfLossCategoryCode\r\n\t  OR CDCPPrevious.MultiLocationCreditFactor <> CDCPToUpdate.MultiLocationCreditFactor\r\n\t  OR CDCPPrevious.PreferredPropertyFactor <> CDCPToUpdate.PreferredPropertyFactor\r\n\t  OR CDCPPrevious.RateType <> CDCPToUpdate.RateType\r\n\t  OR CDCPPrevious.SprinklerFlag <> CDCPToUpdate.SprinklerFlag\r\n\t  )\n),\nExp_CoverageDetailCommercialProperty_Upd_Offset AS (\n\tSELECT\n\tIsoFireProtectionCode,\n\tMultiLocationCreditFactor,\n\tPreferredPropertyFactor,\n\tSprinklerFlag,\n\tRetroactiveDate,\n\tISOCommercialPropertyCauseofLossGroup,\n\tISOCommercialPropertyRatingGroupCode,\n\tISOSpecialCauseOfLossCategoryCode,\n\tRateType,\n\tCommercialPropertySpecialClass,\n\tWrk_PremiumTransactionID,\n\tSYSDATE AS o_ModifiedDate\n\tFROM SQ_CoverageDetailCommercialProperty\n),\nUPD_CoverageDetailCommercialProperty AS (\n\tSELECT\n\tIsoFireProtectionCode, \n\tMultiLocationCreditFactor, \n\tPreferredPropertyFactor, \n\tSprinklerFlag, \n\tRetroactiveDate, \n\tISOCommercialPropertyCauseofLossGroup, \n\tISOCommercialPropertyRatingGroupCode, \n\tISOSpecialCauseOfLossCategoryCode, \n\tRateType, \n\tCommercialPropertySpecialClass, \n\tWrk_PremiumTransactionID, \n\to_ModifiedDate AS ModifiedDate\n\tFROM Exp_CoverageDetailCommercialProperty_Upd_Offset\n),\nTGT_CoverageDetailCommercialProperty_Upd_Offset AS (\n\tMERGE INTO CoverageDetailCommercialProperty AS T\n\tUSING UPD_CoverageDetailCommercialProperty AS S\n\tON T.PremiumTransactionID = S.Wrk_PremiumTransactionID\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.ModifiedDate = S.ModifiedDate, T.IsoFireProtectionCode = S.IsoFireProtectionCode, T.MultiLocationCreditFactor = S.MultiLocationCreditFactor, T.PreferredPropertyFactor = S.PreferredPropertyFactor, T.SprinklerFlag = S.SprinklerFlag, T.RetroactiveDate = S.RetroactiveDate, T.ISOCommercialPropertyCauseofLossGroup = S.ISOCommercialPropertyCauseofLossGroup, T.ISOCommercialPropertyRatingGroupCode = S.ISOCommercialPropertyRatingGroupCode, T.ISOSpecialCauseOfLossCategoryCode = S.ISOSpecialCauseOfLossCategoryCode, T.RateType = S.RateType, T.CommercialPropertySpecialClass = S.CommercialPropertySpecialClass\n),\nSQ_CoverageDetailCommercialProperty_Deprecated AS (\n\tSELECT \r\n\tCDCPPrevious.IsoFireProtectionCode, \r\n\tCDCPPrevious.MultiLocationCreditFactor, \r\n\tCDCPPrevious.PreferredPropertyFactor, \r\n\tCDCPPrevious.SprinklerFlag,\r\n\tCDCPPrevious.RetroactiveDate,\r\n\tCDCPPrevious.ISOCommercialPropertyCauseofLossGroup,\r\n\tCDCPPrevious.ISOCommercialPropertyRatingGroupCode,\r\n\tCDCPPrevious.ISOSpecialCauseOfLossCategoryCode,   \r\n\tCDCPPrevious.RateType, \r\n\tCDCPPrevious.CommercialPropertySpecialClass, \r\n\tWPTOL.PremiumTransactionID AS Wrk_PremiumTransactionID\r\n\tFROM\r\n\tWorkPremiumTransactionOffsetLineage WPTOL inner join CoverageDetailCommercialProperty CDCPPrevious\r\n\ton ( CDCPPrevious.PremiumTransactionID= WPTOL.previouspremiumtransactionid)\r\n\tinner join CoverageDetailCommercialProperty CDCPToUpdate\r\n\ton ( CDCPToUpdate.PremiumTransactionID= WPTOL.PremiumTransactionid)\r\n\tINNER JOIN premiumtransaction pt WITH (NOLOCK) on\r\n\t\tWPTOL .premiumtransactionid=pt.premiumtransactionid and PT.OffsetOnsetCode='Deprecated'\r\n\tWHERE\r\n\tWPTOL.UpdateAttributeFlag = 1 \r\n\tAND (\r\n\t  CDCPPrevious.CommercialPropertySpecialClass <> CDCPToUpdate.CommercialPropertySpecialClass\r\n\t  OR CDCPPrevious.ISOCommercialPropertyCauseofLossGroup <> CDCPToUpdate.ISOCommercialPropertyCauseofLossGroup\r\n\t  OR CDCPPrevious.ISOCommercialPropertyRatingGroupCode <> CDCPToUpdate.ISOCommercialPropertyRatingGroupCode\r\n\t  OR CDCPPrevious.IsoFireProtectionCode <> CDCPToUpdate.IsoFireProtectionCode\r\n\t  OR CDCPPrevious.ISOSpecialCauseOfLossCategoryCode <> CDCPToUpdate.ISOSpecialCauseOfLossCategoryCode\r\n\t  OR CDCPPrevious.MultiLocationCreditFactor <> CDCPToUpdate.MultiLocationCreditFactor\r\n\t  OR CDCPPrevious.PreferredPropertyFactor <> CDCPToUpdate.PreferredPropertyFactor\r\n\t  OR CDCPPrevious.RateType <> CDCPToUpdate.RateType\r\n\t  OR CDCPPrevious.SprinklerFlag <> CDCPToUpdate.SprinklerFlag\r\n\t  )\n),\nExp_CoverageDetailCommercialProperty_Upd_Deprecated AS (\n\tSELECT\n\tIsoFireProtectionCode,\n\tMultiLocationCreditFactor,\n\tPreferredPropertyFactor,\n\tSprinklerFlag,\n\tRetroactiveDate,\n\tISOCommercialPropertyCauseofLossGroup,\n\tISOCommercialPropertyRatingGroupCode,\n\tISOSpecialCauseOfLossCategoryCode,\n\tRateType,\n\tCommercialPropertySpecialClass,\n\tWrk_PremiumTransactionID,\n\tSYSDATE AS o_ModifiedDate\n\tFROM SQ_CoverageDetailCommercialProperty_Deprecated\n),\nUPD_CoverageDetailCommercialProperty_Deprecated AS (\n\tSELECT\n\tIsoFireProtectionCode, \n\tMultiLocationCreditFactor, \n\tPreferredPropertyFactor, \n\tSprinklerFlag, \n\tRetroactiveDate, \n\tISOCommercialPropertyCauseofLossGroup, \n\tISOCommercialPropertyRatingGroupCode, \n\tISOSpecialCauseOfLossCategoryCode, \n\tRateType, \n\tCommercialPropertySpecialClass, \n\tWrk_PremiumTransactionID, \n\to_ModifiedDate AS ModifiedDate\n\tFROM Exp_CoverageDetailCommercialProperty_Upd_Deprecated\n),\nTGT_CoverageDetailCommercialProperty_Upd_Deprecated AS (\n\tMERGE INTO CoverageDetailCommercialProperty AS T\n\tUSING UPD_CoverageDetailCommercialProperty_Deprecated AS S\n\tON T.PremiumTransactionID = S.Wrk_PremiumTransactionID\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.ModifiedDate = S.ModifiedDate, T.IsoFireProtectionCode = S.IsoFireProtectionCode, T.MultiLocationCreditFactor = S.MultiLocationCreditFactor, T.PreferredPropertyFactor = S.PreferredPropertyFactor, T.SprinklerFlag = S.SprinklerFlag, T.RetroactiveDate = S.RetroactiveDate, T.ISOCommercialPropertyCauseofLossGroup = S.ISOCommercialPropertyCauseofLossGroup, T.ISOCommercialPropertyRatingGroupCode = S.ISOCommercialPropertyRatingGroupCode, T.ISOSpecialCauseOfLossCategoryCode = S.ISOSpecialCauseOfLossCategoryCode, T.RateType = S.RateType, T.CommercialPropertySpecialClass = S.CommercialPropertySpecialClass\n),"
                        }
                    ]
                }
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246483"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905491"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7603290"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/29/2023 22:44:58"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 23:03:38"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Stage_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "DCT"
            },
            "TARGET_TABLE_OWNER_V2": {
                "type": "string",
                "defaultValue": "V2"
            },
            "TARGET_DATABASE_NAME": {
                "type": "string",
                "defaultValue": "RPT_EDM"
            }
        },
        "folder": {
            "name": ""
        },
        "annotations": []
    }
}