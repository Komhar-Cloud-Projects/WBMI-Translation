WITH
SQ_claim_medical_stage AS (
	SELECT
		claim_medical_stage_id,
		injured_party_id,
		medicare_hicn,
		medicare_elig,
		cms_date_of_incid,
		cause_code,
		diag_code1,
		diag_code2,
		diag_code3,
		diag_code4,
		diag_code5,
		diag_code6,
		diag_code7,
		diag_code8,
		diag_code9,
		diag_code10,
		diag_code11,
		diag_code12,
		diag_code13,
		diag_code14,
		diag_code15,
		diag_code16,
		diag_code17,
		diag_code18,
		diag_code19,
		self_insd_ind,
		self_insd_type,
		self_insd_fst_nm,
		self_insd_last_nm,
		self_insd_dba_nm,
		self_insd_lgl_nm,
		product_liab_ind,
		prod_generic_nm,
		prod_brand_nm,
		prod_manufacturer,
		prod_allege_harm,
		inj_par_rep_firm,
		exceed_claim_key,
		exceed_claimnt_key,
		pms_policy_sym,
		pms_policy_num,
		pms_policy_mod,
		pms_date_of_loss,
		pms_loss_occurence,
		pms_loss_claimant,
		cms_source_system_id,
		clmt1_rep_firm,
		clmt2_rep_firm,
		clmt3_rep_firm,
		clmt4_rep_firm,
		created_ts,
		created_user_id,
		modified_ts,
		modified_user_id,
		extract_date,
		as_of_date,
		record_count,
		source_system_id,
		query_requested,
		query_request_date,
		last_cms_hicn,
		icd_code_version
	FROM claim_medical_stage
	WHERE CREATED_TS >= '@{pipeline().parameters.SELECTION_START_TS}'  OR MODIFIED_TS >= '@{pipeline().parameters.SELECTION_START_TS}'
),
EXP_values AS (
	SELECT
	claim_medical_stage_id,
	injured_party_id,
	medicare_hicn,
	medicare_elig,
	cms_date_of_incid,
	cause_code,
	diag_code1,
	diag_code2,
	diag_code3,
	diag_code4,
	diag_code5,
	diag_code6,
	diag_code7,
	diag_code8,
	diag_code9,
	diag_code10,
	diag_code11,
	diag_code12,
	diag_code13,
	diag_code14,
	diag_code15,
	diag_code16,
	diag_code17,
	diag_code18,
	diag_code19,
	self_insd_ind,
	self_insd_type,
	self_insd_fst_nm,
	self_insd_last_nm,
	self_insd_dba_nm,
	self_insd_lgl_nm,
	product_liab_ind,
	prod_generic_nm,
	prod_brand_nm,
	prod_manufacturer,
	prod_allege_harm,
	inj_par_rep_firm,
	exceed_claim_key,
	exceed_claimnt_key,
	pms_policy_sym,
	pms_policy_num,
	pms_policy_mod,
	pms_date_of_loss,
	pms_loss_occurence,
	pms_loss_claimant,
	cms_source_system_id,
	clmt1_rep_firm,
	clmt2_rep_firm,
	clmt3_rep_firm,
	clmt4_rep_firm,
	created_ts,
	created_user_id,
	modified_ts,
	modified_user_id,
	extract_date,
	as_of_date,
	record_count,
	source_system_id,
	@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AUDIT_ID,
	query_requested,
	query_request_date,
	last_cms_hicn,
	icd_code_version
	FROM SQ_claim_medical_stage
),
arch_claim_medical_stage AS (
	INSERT INTO @{pipeline().parameters.TARGET_TABLE_OWNER}.arch_claim_medical_stage
	(claim_medical_stage_id, injured_party_id, medicare_hicn, medicare_elig, cms_date_of_incid, cause_code, diag_code1, diag_code2, diag_code3, diag_code4, diag_code5, diag_code6, diag_code7, diag_code8, diag_code9, diag_code10, diag_code11, diag_code12, diag_code13, diag_code14, diag_code15, diag_code16, diag_code17, diag_code18, diag_code19, self_insd_ind, self_insd_type, self_insd_fst_nm, self_insd_last_nm, self_insd_dba_nm, self_insd_lgl_nm, product_liab_ind, prod_generic_nm, prod_brand_nm, prod_manufacturer, prod_allege_harm, inj_par_rep_firm, exceed_claim_key, exceed_claimnt_key, pms_policy_sym, pms_policy_num, pms_policy_mod, pms_date_of_loss, pms_loss_occurence, pms_loss_claimant, cms_source_system_id, clmt1_rep_firm, clmt2_rep_firm, clmt3_rep_firm, clmt4_rep_firm, created_ts, created_user_id, modified_ts, modified_user_id, extract_date, as_of_date, record_count, source_system_id, audit_id, query_requested, query_request_date, last_cms_hicn, icd_code_version)
	SELECT 
	CLAIM_MEDICAL_STAGE_ID, 
	INJURED_PARTY_ID, 
	MEDICARE_HICN, 
	MEDICARE_ELIG, 
	CMS_DATE_OF_INCID, 
	CAUSE_CODE, 
	DIAG_CODE1, 
	DIAG_CODE2, 
	DIAG_CODE3, 
	DIAG_CODE4, 
	DIAG_CODE5, 
	DIAG_CODE6, 
	DIAG_CODE7, 
	DIAG_CODE8, 
	DIAG_CODE9, 
	DIAG_CODE10, 
	DIAG_CODE11, 
	DIAG_CODE12, 
	DIAG_CODE13, 
	DIAG_CODE14, 
	DIAG_CODE15, 
	DIAG_CODE16, 
	DIAG_CODE17, 
	DIAG_CODE18, 
	DIAG_CODE19, 
	SELF_INSD_IND, 
	SELF_INSD_TYPE, 
	SELF_INSD_FST_NM, 
	SELF_INSD_LAST_NM, 
	SELF_INSD_DBA_NM, 
	SELF_INSD_LGL_NM, 
	PRODUCT_LIAB_IND, 
	PROD_GENERIC_NM, 
	PROD_BRAND_NM, 
	PROD_MANUFACTURER, 
	PROD_ALLEGE_HARM, 
	INJ_PAR_REP_FIRM, 
	EXCEED_CLAIM_KEY, 
	EXCEED_CLAIMNT_KEY, 
	PMS_POLICY_SYM, 
	PMS_POLICY_NUM, 
	PMS_POLICY_MOD, 
	PMS_DATE_OF_LOSS, 
	PMS_LOSS_OCCURENCE, 
	PMS_LOSS_CLAIMANT, 
	CMS_SOURCE_SYSTEM_ID, 
	CLMT1_REP_FIRM, 
	CLMT2_REP_FIRM, 
	CLMT3_REP_FIRM, 
	CLMT4_REP_FIRM, 
	CREATED_TS, 
	CREATED_USER_ID, 
	MODIFIED_TS, 
	MODIFIED_USER_ID, 
	EXTRACT_DATE, 
	AS_OF_DATE, 
	RECORD_COUNT, 
	SOURCE_SYSTEM_ID, 
	AUDIT_ID AS AUDIT_ID, 
	QUERY_REQUESTED, 
	QUERY_REQUEST_DATE, 
	LAST_CMS_HICN, 
	ICD_CODE_VERSION
	FROM EXP_values
),