{
    "name": "s_m_FEED_Load_EARS_Extract_File",
    "properties": {
        "activities": [
            {
                "name": "m_FEED_Load_EARS_Extract_File",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nSQ_ExploreEARSDriverRecord_Detail AS (\n\tSELECT\n\t\tExploreEARSDriverRecordId,\n\t\tAuditId,\n\t\tCreatedDate,\n\t\tLicenseState,\n\t\tLicenseNumber,\n\t\tLastName,\n\t\tFirstName,\n\t\tMiddleName,\n\t\tBirthdate,\n\t\tZipCode,\n\t\tStreetAddress,\n\t\tGender,\n\t\tPolicyNumber,\n\t\tPolicyExpirationDate,\n\t\tQuotebackPolicyNumber,\n\t\tQuotebackAgencyNumber,\n\t\tQuotebackDriverLicense,\n\t\tQuotebackState,\n\t\tInsuranceIndicator,\n\t\tProductFlags,\n\t\tAccountNumber\n\tFROM ExploreEARSDriverRecord\n\tWHERE @{pipeline().parameters.WHERE_CLAUSE}\n),\nEXP_Input AS (\n\tSELECT\n\tLicenseNumber AS i_LicenseNumber,\n\t-- *INF*: LTRIM(RTRIM(i_LicenseNumber))\n\tLTRIM(RTRIM(i_LicenseNumber)) AS v_LicenseNumber,\n\t-- *INF*: LTRIM(v_LicenseNumber, '0')\n\tLTRIM(v_LicenseNumber, '0') AS v_LicenseNumber_Remove0,\n\t-- *INF*: LENGTH(v_LicenseNumber)\n\tLENGTH(v_LicenseNumber) AS v_LicenseNumber_LEN1,\n\t-- *INF*: LENGTH(v_LicenseNumber_Remove0)\n\tLENGTH(v_LicenseNumber_Remove0) AS v_LicenseNumber_LEN2,\n\tv_LicenseNumber_LEN1 - v_LicenseNumber_LEN2 AS v_LicenseNumber_LEN_Diff,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_LicenseNumber_LEN_Diff > 0, SUBSTR(v_LicenseNumber, 1, v_LicenseNumber_LEN_Diff), '')\n\tDECODE(\n\t    TRUE,\n\t    v_LicenseNumber_LEN_Diff > 0, SUBSTR(v_LicenseNumber, 1, v_LicenseNumber_LEN_Diff),\n\t    ''\n\t) AS v_SubString_LicenseNumber,\n\t-- *INF*: IIF(LENGTH(v_LicenseNumber) < 8, UPPER(LPAD(v_LicenseNumber, 8, '@')), UPPER(v_LicenseNumber))\r\n\t-- \r\n\t-- --IIF(IS_NUMBER(v_LicenseNumber) = 1, v_LicenseNumber_Remove0, v_LicenseNumber)\r\n\t-- \r\n\t-- --IIF(LENGTH(LTRIM(RTRIM(v_LicenseNumber_Remove0))) < 8, LPAD(LTRIM(RTRIM(v_LicenseNumber_Remove0)), 8, '@'), LTRIM(RTRIM(v_LicenseNumber_Remove0)))\n\tIFF(\n\t    LENGTH(v_LicenseNumber) < 8, UPPER(LPAD(v_LicenseNumber, 8, '@')), UPPER(v_LicenseNumber)\n\t) AS lkp_LicenseNumber\n\tFROM SQ_ExploreEARSDriverRecord_Detail\n),\nLKP_TokenExFile AS (\n),\nEXP_Input_QB AS (\n\tSELECT\n\tQuotebackDriverLicense AS i_Quoteback,\n\t-- *INF*: LTRIM(RTRIM(i_Quoteback))\n\tLTRIM(RTRIM(i_Quoteback)) AS v_Quoteback,\n\t-- *INF*: LTRIM(v_Quoteback, '0')\n\tLTRIM(v_Quoteback, '0') AS v_Quoteback_Remove0,\n\t-- *INF*: LENGTH(v_Quoteback)\n\tLENGTH(v_Quoteback) AS v_Quoteback_LEN1,\n\t-- *INF*: LENGTH(v_Quoteback_Remove0)\n\tLENGTH(v_Quoteback_Remove0) AS v_Quoteback_LEN2,\n\tv_Quoteback_LEN1 - v_Quoteback_LEN2 AS v_Quoteback_LEN_Diff,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- v_Quoteback_LEN_Diff > 0, SUBSTR(v_Quoteback, 1, v_Quoteback_LEN_Diff), '')\n\tDECODE(\n\t    TRUE,\n\t    v_Quoteback_LEN_Diff > 0, SUBSTR(v_Quoteback, 1, v_Quoteback_LEN_Diff),\n\t    ''\n\t) AS v_SubString_Quoteback,\n\t-- *INF*: IIF(LENGTH(v_Quoteback) < 8, UPPER(LPAD(v_Quoteback, 8, '@')), UPPER(v_Quoteback))\r\n\t-- \r\n\t-- --IIF(IS_NUMBER(v_Quoteback) = 1, v_Quoteback_Remove0, v_Quoteback)\r\n\t-- \r\n\t-- --IIF(LENGTH(LTRIM(RTRIM(v_Quoteback_Remove0))) < 8, LPAD(LTRIM(RTRIM(v_Quoteback_Remove0)), 8, '@'), LTRIM(RTRIM(v_Quoteback_Remove0)))\n\tIFF(LENGTH(v_Quoteback) < 8, UPPER(LPAD(v_Quoteback, 8, '@')), UPPER(v_Quoteback)) AS lkp_Quoteback\n\tFROM SQ_ExploreEARSDriverRecord_Detail\n),\nLKP_TokenExFile_QB AS (\n),\nEXP_CalculateDetail AS (\n\tSELECT\n\tSQ_ExploreEARSDriverRecord_Detail.LicenseState AS i_LicenseState,\n\tSQ_ExploreEARSDriverRecord_Detail.LicenseNumber AS i_LicenseNumber,\n\tLKP_TokenExFile.o_LicenseNumber AS lkp_LicenseNumber,\n\tSQ_ExploreEARSDriverRecord_Detail.LastName AS i_LastName,\n\tSQ_ExploreEARSDriverRecord_Detail.FirstName AS i_FirstName,\n\tSQ_ExploreEARSDriverRecord_Detail.MiddleName AS i_MiddleName,\n\tSQ_ExploreEARSDriverRecord_Detail.Birthdate AS i_Birthdate,\n\tSQ_ExploreEARSDriverRecord_Detail.ZipCode AS i_ZipCode,\n\tSQ_ExploreEARSDriverRecord_Detail.StreetAddress AS i_StreetAddress,\n\tSQ_ExploreEARSDriverRecord_Detail.Gender AS i_Gender,\n\tSQ_ExploreEARSDriverRecord_Detail.PolicyNumber AS i_PolicyNumber,\n\tSQ_ExploreEARSDriverRecord_Detail.PolicyExpirationDate AS i_PolicyExpirationDate,\n\tSQ_ExploreEARSDriverRecord_Detail.QuotebackPolicyNumber AS i_QuotebackPolicyNumber,\n\tSQ_ExploreEARSDriverRecord_Detail.QuotebackAgencyNumber AS i_QuotebackAgencyNumber,\n\tSQ_ExploreEARSDriverRecord_Detail.QuotebackDriverLicense AS i_QuotebackDriverLicense,\n\tLKP_TokenExFile_QB.o_Quoteback AS lkp_QuotebackDriverLicense,\n\tSQ_ExploreEARSDriverRecord_Detail.QuotebackState AS i_QuotebackState,\n\tSQ_ExploreEARSDriverRecord_Detail.InsuranceIndicator AS i_InsuranceIndicator,\n\tSQ_ExploreEARSDriverRecord_Detail.ProductFlags AS i_ProductFlags,\n\tSQ_ExploreEARSDriverRecord_Detail.AccountNumber AS i_AccountNumber,\n\t-- *INF*: TO_CHAR(TRUNC(SYSDATE, 'DD'),'YYYYMMDD')\n\tTO_CHAR(CAST(TRUNC(CURRENT_TIMESTAMP, 'DAY') AS TIMESTAMP_NTZ(0)), 'YYYYMMDD') AS v_FileDate,\n\t-- *INF*: IIF(i_LicenseState='N/A', '  ', i_LicenseState)\n\tIFF(i_LicenseState = 'N/A', '  ', i_LicenseState) AS v_LicenseState,\n\t-- *INF*: LTRIM(LTRIM(RTRIM(lkp_LicenseNumber)), '@')\n\tLTRIM(LTRIM(RTRIM(lkp_LicenseNumber)), '@') AS v_lkp_LicenseNumber,\n\t-- *INF*: IIF(ISNULL(lkp_LicenseNumber), RPAD( i_LicenseNumber, 22, ' '), RPAD(LTRIM(RTRIM(v_lkp_LicenseNumber)), 22,  ' '))\n\tIFF(\n\t    lkp_LicenseNumber IS NULL, RPAD(i_LicenseNumber, 22, ' '),\n\t    RPAD(LTRIM(RTRIM(v_lkp_LicenseNumber)), 22, ' ')\n\t) AS v_LicenseNumber,\n\t-- *INF*: RPAD(IIF(i_LastName='N/A', '', i_LastName),25, ' ')\n\tRPAD(\n\t    IFF(\n\t        i_LastName = 'N/A', '', i_LastName\n\t    ), 25, ' ') AS v_LastName,\n\t-- *INF*: RPAD(IIF(i_FirstName='N/A', '', i_FirstName),20, ' ')\n\tRPAD(\n\t    IFF(\n\t        i_FirstName = 'N/A', '', i_FirstName\n\t    ), 20, ' ') AS v_FirstName,\n\t-- *INF*: RPAD(IIF(i_MiddleName='N/A', '', i_MiddleName),20, ' ')\n\tRPAD(\n\t    IFF(\n\t        i_MiddleName = 'N/A', '', i_MiddleName\n\t    ), 20, ' ') AS v_MiddleName,\n\t-- *INF*: RPAD(i_Birthdate,8, ' ')\n\tRPAD(i_Birthdate, 8, ' ') AS v_Birthdate,\n\t-- *INF*: RPAD( i_ZipCode,9, ' ')\n\tRPAD(i_ZipCode, 9, ' ') AS v_ZipCode,\n\t-- *INF*: RPAD(IIF(i_StreetAddress='N/A', '', SUBSTR(i_StreetAddress, 1, 25)),25, ' ')\n\tRPAD(\n\t    IFF(\n\t        i_StreetAddress = 'N/A', '', SUBSTR(i_StreetAddress, 1, 25)\n\t    ), 25, ' ') AS v_StreetAddress,\n\t-- *INF*: RPAD(i_Gender,1, ' ')\n\tRPAD(i_Gender, 1, ' ') AS v_Gender,\n\t' ' AS v_Reserved_133,\n\t-- *INF*: RPAD(i_PolicyNumber,32, ' ')\n\tRPAD(i_PolicyNumber, 32, ' ') AS v_PolicyNumber,\n\t-- *INF*: RPAD(IIF(i_PolicyExpirationDate='21001231', '', i_PolicyExpirationDate),8, ' ')\n\tRPAD(\n\t    IFF(\n\t        i_PolicyExpirationDate = '21001231', '', i_PolicyExpirationDate\n\t    ), 8, ' ') AS v_PolicyExpirationDate,\n\t'  ' AS v_Reserved_174_175,\n\t-- *INF*: RPAD(i_PolicyNumber,32, ' ')\n\tRPAD(i_PolicyNumber, 32, ' ') AS v_QuotebackPolicyNumber,\n\t-- *INF*: RPAD(i_QuotebackAgencyNumber,5, ' ')\n\tRPAD(i_QuotebackAgencyNumber, 5, ' ') AS v_QuotebackAgencyNumber,\n\t-- *INF*: LTRIM(LTRIM(RTRIM(lkp_QuotebackDriverLicense)), '@')\n\tLTRIM(LTRIM(RTRIM(lkp_QuotebackDriverLicense)), '@') AS v_lkp_QuotebackDriverLicense,\n\t-- *INF*: IIF(ISNULL(lkp_QuotebackDriverLicense), RPAD( i_QuotebackDriverLicense, 22, ' '), RPAD(LTRIM(RTRIM(v_lkp_QuotebackDriverLicense)), 22,  ' '))\n\tIFF(\n\t    lkp_QuotebackDriverLicense IS NULL, RPAD(i_QuotebackDriverLicense, 22, ' '),\n\t    RPAD(LTRIM(RTRIM(v_lkp_QuotebackDriverLicense)), 22, ' ')\n\t) AS v_QuotebackDriverLicense,\n\t-- *INF*: RPAD(IIF(i_QuotebackState='N/A', '', i_QuotebackState),3, ' ')\n\tRPAD(\n\t    IFF(\n\t        i_QuotebackState = 'N/A', '', i_QuotebackState\n\t    ), 3, ' ') AS v_QuotebackState,\n\t-- *INF*: RPAD('', 18, ' ')\n\tRPAD('', 18, ' ') AS v_Reserved_238_255,\n\t-- *INF*: RPAD(i_InsuranceIndicator,1, ' ')\n\tRPAD(i_InsuranceIndicator, 1, ' ') AS v_InsuranceIndicator,\n\t-- *INF*: RPAD('', 8, ' ')\n\tRPAD('', 8, ' ') AS v_Reserved_257_264,\n\ti_ProductFlags AS v_ProductFlags,\n\t-- *INF*: RPAD(i_AccountNumber,9, ' ')\n\tRPAD(i_AccountNumber, 9, ' ') AS v_AccountNumber,\n\t-- *INF*: RPAD('', 23, ' ')\n\tRPAD('', 23, ' ') AS v_Reserved_283_305,\n\tv_LicenseState || \r\nv_LicenseNumber || \r\nv_LastName || \r\nv_FirstName || \r\nv_MiddleName || \r\nv_Birthdate || \r\nv_ZipCode || \r\nv_StreetAddress || \r\nv_Gender ||\r\nv_Reserved_133 || \r\nv_PolicyNumber || \r\nv_PolicyExpirationDate || \r\nv_Reserved_174_175|| \r\nv_QuotebackPolicyNumber || \r\nv_QuotebackAgencyNumber || \r\nv_QuotebackDriverLicense || \r\nv_QuotebackState || \r\nv_Reserved_238_255 || \r\nv_InsuranceIndicator || \r\nv_Reserved_257_264 || \r\nv_ProductFlags || \r\nv_AccountNumber || \r\nv_Reserved_283_305 AS o_Detail,\n\t-- *INF*: i_AccountNumber || @{pipeline().parameters.FILE_EXTENSION} || IIF(@{pipeline().parameters.PMINTEGRATIONSERVICENAME}='IntegrationServiceProd2', '', '.TEST')\r\n\t-- \r\n\t-- --i_AccountNumber||IIF(@{pipeline().parameters.PMINTEGRATIONSERVICENAME}='IntegrationServiceProd2', '.EAR', '.EAR_TEST')||'_'||SUBSTR(v_FileDate,1,6)||--@{pipeline().parameters.FILE_EXTENSION}\n\ti_AccountNumber || @{pipeline().parameters.FILE_EXTENSION} || IFF(@{pipeline().parameters.PMINTEGRATIONSERVICENAME} = 'IntegrationServiceProd2', '', '.TEST') AS o_FileName,\n\tv_LicenseState || v_LicenseNumber AS o_SortOrder\n\tFROM SQ_ExploreEARSDriverRecord_Detail\n\tLEFT JOIN LKP_TokenExFile\n\tON LKP_TokenExFile.lkp_LicenseNumber = EXP_Input.lkp_LicenseNumber\n\tLEFT JOIN LKP_TokenExFile_QB\n\tON LKP_TokenExFile_QB.lkp_Quoteback = EXP_Input_QB.lkp_Quoteback\n),\nSQ_ExploreEARSDriverRecord_Header AS (\n\tSELECT DISTINCT AccountNumber \r\n\tFROM @{pipeline().parameters.SOURCE_TABLE_OWNER}.ExploreEARSDriverRecord \r\n\tWHERE @{pipeline().parameters.WHERE_CLAUSE}\n),\nEXP_CalculateHeader AS (\n\tSELECT\n\tAccountNumber AS i_AccountNumber,\n\t'FH' AS v_RecordID,\n\t-- *INF*: TO_CHAR(TRUNC(SYSDATE, 'DD'),'YYYYMMDD')\n\tTO_CHAR(CAST(TRUNC(CURRENT_TIMESTAMP, 'DAY') AS TIMESTAMP_NTZ(0)), 'YYYYMMDD') AS v_FileDate,\n\t'DR' AS v_FileIDCode,\n\t-- *INF*: RPAD('West Bend Insurance',30, ' ')\n\tRPAD('West Bend Insurance', 30, ' ') AS v_SenderName,\n\t-- *INF*: RPAD(i_AccountNumber,9, ' ')\n\tRPAD(i_AccountNumber, 9, ' ') AS v_SenderNumber,\n\t'0800' AS v_Version,\n\t-- *INF*: RPAD('',250, ' ')\n\tRPAD('', 250, ' ') AS v_Reserved,\n\tv_RecordID||v_FileDate||v_FileIDCode||v_SenderName||v_SenderNumber||v_Version||v_Reserved AS o_Header,\n\t-- *INF*: i_AccountNumber || @{pipeline().parameters.FILE_EXTENSION} || IIF(@{pipeline().parameters.PMINTEGRATIONSERVICENAME}='IntegrationServiceProd2', '', '.TEST')\r\n\t-- \r\n\t-- \r\n\t-- --i_AccountNumber||IIF(@{pipeline().parameters.PMINTEGRATIONSERVICENAME}='IntegrationServiceProd2', '.EAR', '.EAR_TEST')||'_'||SUBSTR(v_FileDate,1,6)||--@{pipeline().parameters.FILE_EXTENSION}\n\ti_AccountNumber || @{pipeline().parameters.FILE_EXTENSION} || IFF(@{pipeline().parameters.PMINTEGRATIONSERVICENAME} = 'IntegrationServiceProd2', '', '.TEST') AS o_FileName,\n\t-- *INF*: CHR(0)\n\tCHR(0) AS o_SortOrder\n\tFROM SQ_ExploreEARSDriverRecord_Header\n),\nSQ_ExploreEARSDriverRecord_Trailer AS (\n\tSELECT\n\t\tExploreEARSDriverRecordId,\n\t\tAuditId,\n\t\tCreatedDate,\n\t\tLicenseState,\n\t\tLicenseNumber,\n\t\tLastName,\n\t\tFirstName,\n\t\tMiddleName,\n\t\tBirthdate,\n\t\tZipCode,\n\t\tStreetAddress,\n\t\tGender,\n\t\tPolicyNumber,\n\t\tPolicyExpirationDate,\n\t\tQuotebackPolicyNumber,\n\t\tQuotebackAgencyNumber,\n\t\tQuotebackDriverLicense,\n\t\tQuotebackState,\n\t\tInsuranceIndicator,\n\t\tProductFlags,\n\t\tAccountNumber\n\tFROM ExploreEARSDriverRecord\n\tWHERE @{pipeline().parameters.WHERE_CLAUSE}\n),\nAGG_Count AS (\n\tSELECT\n\tAccountNumber,\n\t-- *INF*: COUNT(AccountNumber)\n\tCOUNT(AccountNumber) AS o_Count\n\tFROM SQ_ExploreEARSDriverRecord_Trailer\n\tGROUP BY AccountNumber\n),\nEXP_CalculateTrailer AS (\n\tSELECT\n\tAccountNumber AS i_AccountNumber,\n\to_Count AS i_Count,\n\t-- *INF*: TO_CHAR(TRUNC(SYSDATE, 'DD'),'YYYYMMDD')\n\tTO_CHAR(CAST(TRUNC(CURRENT_TIMESTAMP, 'DAY') AS TIMESTAMP_NTZ(0)), 'YYYYMMDD') AS v_FileDate,\n\t'FT' AS v_RecordID,\n\t-- *INF*: RPAD('',6, ' ')\n\tRPAD('', 6, ' ') AS v_Reserved,\n\t-- *INF*: LPAD(TO_CHAR(i_Count+2),10, '0')\n\tLPAD(TO_CHAR(i_Count + 2), 10, '0') AS v_TotalRecords,\n\t-- *INF*: RPAD('EXPLORE',30,' ')\n\tRPAD('EXPLORE', 30, ' ') AS v_ReceivingName,\n\t-- *INF*: RPAD('',9, ' ')\n\tRPAD('', 9, ' ') AS v_ReceivingNumber,\n\t'DR' AS v_FileIDCode,\n\t-- *INF*: RPAD('',246, ' ')\n\tRPAD('', 246, ' ') AS v_Filler,\n\tv_RecordID || \r\nv_Reserved || \r\nv_TotalRecords || \r\nv_ReceivingName ||\r\nv_ReceivingNumber || \r\nv_FileIDCode || \r\nv_Filler AS o_Trailer,\n\t-- *INF*: i_AccountNumber || @{pipeline().parameters.FILE_EXTENSION} || IIF(@{pipeline().parameters.PMINTEGRATIONSERVICENAME}='IntegrationServiceProd2', '', '.TEST')\r\n\t-- \r\n\t-- --i_AccountNumber||IIF(@{pipeline().parameters.PMINTEGRATIONSERVICENAME}='IntegrationServiceProd2', '.EAR', '.EAR_TEST')||'_'||SUBSTR(v_FileDate,1,6)||--@{pipeline().parameters.FILE_EXTENSION}\n\ti_AccountNumber || @{pipeline().parameters.FILE_EXTENSION} || IFF(@{pipeline().parameters.PMINTEGRATIONSERVICENAME} = 'IntegrationServiceProd2', '', '.TEST') AS o_FileName,\n\t-- *INF*: CHR(127)\n\tCHR(127) AS o_SortOrder\n\tFROM AGG_Count\n),\nUN_All AS (\n\tSELECT o_Header AS Record, o_FileName AS FileName, o_SortOrder AS SortOrder\n\tFROM EXP_CalculateHeader\n\tUNION\n\tSELECT o_Detail AS Record, o_FileName AS FileName, o_SortOrder AS SortOrder\n\tFROM EXP_CalculateDetail\n\tUNION\n\tSELECT o_Trailer AS Record, o_FileName AS FileName, o_SortOrder AS SortOrder\n\tFROM EXP_CalculateTrailer\n),\nSRT_Records AS (\n\tSELECT\n\tRecord, \n\tFileName, \n\tSortOrder\n\tFROM UN_All\n\tORDER BY SortOrder ASC\n),\nEARS_FlatFile AS (\n\tINSERT INTO EPLIFlatFile\n\t(Record, FileName)\n\tSELECT \n\tRECORD, \n\tFILENAME\n\tFROM SRT_Records\n),"
                        }
                    ]
                },
                "state": "Inactive",
                "onInactiveMarkAs": "Succeeded"
            }
        ],
        "parameters": {
            "WHERE_CLAUSE": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "FILE_EXTENSION": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "PMINTEGRATIONSERVICENAME": {
                "type": "string",
                "defaultValue": "Default Value"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "Default Value"
            }
        },
        "folder": {
            "name": "DataFeed -Informatica/PolicyDataServices/"
        },
        "annotations": []
    }
}