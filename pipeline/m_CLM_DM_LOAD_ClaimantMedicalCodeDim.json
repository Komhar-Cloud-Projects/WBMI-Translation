{
    "name": "m_CLM_DM_LOAD_ClaimantMedicalCodeDim",
    "properties": {
        "activities": [
            {
                "name": "m_CLM_DM_LOAD_ClaimantMedicalCodeDim",
                "type": "Script",
                "dependsOn": [],
                "policy": {
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "linkedServiceName": {
                    "referenceName": "ls_SNOWFLAKE_WBMI",
                    "type": "LinkedServiceReference"
                },
                "typeProperties": {
                    "scripts": [
                        {
                            "type": "Query",
                            "text": "WITH\nLKP_claimant_dim AS (\n\tSELECT\n\tclaimant_dim_id,\n\tedw_claim_party_occurrence_ak_id\n\tFROM (\n\t\tSELECT \r\n\t\tC.claimant_dim_id as claimant_dim_id, C.edw_claim_party_occurrence_ak_id as edw_claim_party_occurrence_ak_id \r\n\t\t\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.claimant_dim C\r\n\t\t\r\n\t\twhere\r\n\t\tC.crrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY edw_claim_party_occurrence_ak_id ORDER BY claimant_dim_id) = 1\n),\nLKP_claim_party_occurrence AS (\n\tSELECT\n\tclaim_party_occurrence_id,\n\tclaim_party_occurrence_ak_id\n\tFROM (\n\t\tSELECT \r\n\t\tCPO.claim_party_occurrence_id as claim_party_occurrence_id, CPO.claim_party_occurrence_ak_id as claim_party_occurrence_ak_id \r\n\t\t\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.claim_party_occurrence CPO\r\n\t\t\r\n\t\twhere\r\n\t\tCPO.crrnt_snpsht_flag = 1\r\n\t\tAND\r\n\t\tCPO.claim_party_role_code in ('CMT','CLMT')\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_party_occurrence_ak_id ORDER BY claim_party_occurrence_id) = 1\n),\nLKP_ClaimantMedicalCodeDim AS (\n\tSELECT\n\tClaimantMedicalCodeDimId,\n\tEdwClaimPartyOccurrenceAkId,\n\tEdwSupMedicalDiagnosisCodePkId,\n\tEdwSupMedicalCauseCodePkId,\n\tEdwSupSurgeryTypePkId,\n\tMedicalCode,\n\tMedicalCodeType\n\tFROM (\n\t\tSELECT \r\n\t\tC.ClaimantMedicalCodeDimId as ClaimantMedicalCodeDimId, \r\n\t\tC.EdwClaimPartyOccurrenceAkId as EdwClaimPartyOccurrenceAkId, \r\n\t\tC.EdwSupMedicalDiagnosisCodePkId as EdwSupMedicalDiagnosisCodePkId, \r\n\t\tC.EdwSupMedicalCauseCodePkId as EdwSupMedicalCauseCodePkId, \r\n\t\tC.EdwSupSurgeryTypePkId as EdwSupSurgeryTypePkId, \r\n\t\tC.MedicalCode as MedicalCode, \r\n\t\tC.MedicalCodeDescription as MedicalCodeDescription, \r\n\t\tC.MedicalCodeType as MedicalCodeType \r\n\t\t\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.TARGET_TABLE_OWNER}.ClaimantMedicalCodeDim C\r\n\t\t\r\n\t\twhere\r\n\t\tC.CurrentSnapshotFlag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY EdwClaimPartyOccurrenceAkId,EdwSupMedicalDiagnosisCodePkId,EdwSupMedicalCauseCodePkId,EdwSupSurgeryTypePkId,MedicalCode,MedicalCodeType ORDER BY ClaimantMedicalCodeDimId) = 1\n),\nSQ_claim_medical_Cause AS (\n\tSELECT \r\n\tCM.claim_med_id, \r\n\tCM.eff_from_date, \r\n\tCM.claim_med_ak_id, \r\n\tCM.claim_party_occurrence_ak_id, \r\n\tCM.patient_cause_code \r\n\t\r\n\t\r\n\tFROM\r\n\t @{pipeline().parameters.SOURCE_TABLE_OWNER}.claim_medical CM\r\n\t\r\n\twhere\r\n\tCM.crrnt_snpsht_flag = 1\r\n\tAND\r\n\tCM.patient_cause_code <> 'N/A'\r\n\tAND\r\n\tCM.created_date >= '@{pipeline().parameters.SELECTION_START_TS}'\r\n\t\r\n\torder by\r\n\tCM.claim_med_ak_id\n),\nEXP_Src_Value_CAUSE AS (\n\tSELECT\n\tclaim_med_id,\n\tEffectiveDate,\n\tclaim_med_ak_id,\n\tclaim_party_occurrence_ak_id,\n\tpatient_cause_code AS IN_patient_cause_code,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- ISNULL(IN_patient_cause_code),'N/A',\r\n\t-- IS_SPACES(IN_patient_cause_code),'N/A',\r\n\t-- LENGTH(IN_patient_cause_code)=0,'N/A',\r\n\t-- LTRIM(RTRIM(IN_patient_cause_code)))\n\tDECODE(TRUE,\n\tIN_patient_cause_code IS NULL, 'N/A',\n\tIS_SPACES(IN_patient_cause_code), 'N/A',\n\tLENGTH(IN_patient_cause_code) = 0, 'N/A',\n\tLTRIM(RTRIM(IN_patient_cause_code))) AS patient_cause_code\n\tFROM SQ_claim_medical_Cause\n),\nLKP_SupMedicalCauseCode_Src AS (\n\tSELECT\n\tSupMedicalCauseCodeId,\n\tShortDescription,\n\tMedicalCauseCode\n\tFROM (\n\t\tSELECT \r\n\t\tSC.SupMedicalCauseCodeId as SupMedicalCauseCodeId, \r\n\t\tltrim(rtrim(SC.ShortDescription)) as ShortDescription, \r\n\t\tltrim(rtrim(SC.MedicalCauseCode)) as MedicalCauseCode \r\n\t\t\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.SupMedicalCauseCode SC\r\n\t\t\r\n\t\twhere\r\n\t\tSC.CurrentSnapshotFlag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY MedicalCauseCode ORDER BY SupMedicalCauseCodeId) = 1\n),\nEXP_Defualt_Values_CAUSE AS (\n\tSELECT\n\tEXP_Src_Value_CAUSE.claim_party_occurrence_ak_id AS IN_claim_party_occurrence_ak_id,\n\t-- *INF*: iif(isnull(IN_claim_party_occurrence_ak_id),-1,IN_claim_party_occurrence_ak_id)\n\tIFF(IN_claim_party_occurrence_ak_id IS NULL, - 1, IN_claim_party_occurrence_ak_id) AS v_claim_party_occurrence_ak_id,\n\tv_claim_party_occurrence_ak_id AS EdwClaimPartyOccurrenceAkId,\n\t-- *INF*: iif(isnull(:LKP.LKP_CLAIM_PARTY_OCCURRENCE(IN_claim_party_occurrence_ak_id)),\r\n\t-- -1,\r\n\t-- :LKP.LKP_CLAIM_PARTY_OCCURRENCE(IN_claim_party_occurrence_ak_id))\n\tIFF(LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_id.claim_party_occurrence_id IS NULL, - 1, LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_id.claim_party_occurrence_id) AS v_claim_party_occurrence_id,\n\tv_claim_party_occurrence_id AS EdwClaimPartyOccurrencePkId,\n\t-- *INF*: iif(isnull(:LKP.LKP_CLAIMANT_DIM(IN_claim_party_occurrence_ak_id))\r\n\t-- ,-1,\r\n\t-- :LKP.LKP_CLAIMANT_DIM(IN_claim_party_occurrence_ak_id))\n\tIFF(LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_id.claimant_dim_id IS NULL, - 1, LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_id.claimant_dim_id) AS v_claimant_dim_id,\n\tv_claimant_dim_id AS claimant_dim_id,\n\t-1 AS v_SupMedicalDiagnosisCodeId,\n\tv_SupMedicalDiagnosisCodeId AS EdwSupMedicalDiagnosisCodePkId,\n\tLKP_SupMedicalCauseCode_Src.SupMedicalCauseCodeId AS IN_SupMedicalCauseCodeId,\n\t-- *INF*: iif(isnull(IN_SupMedicalCauseCodeId),-1,IN_SupMedicalCauseCodeId)\n\tIFF(IN_SupMedicalCauseCodeId IS NULL, - 1, IN_SupMedicalCauseCodeId) AS v_SupMedicalCauseCodeId,\n\tv_SupMedicalCauseCodeId AS EdwSupMedicalCauseCodePkId,\n\t-1 AS v_SupMedicalSurgeryCodeId,\n\tv_SupMedicalSurgeryCodeId AS EdwSupSurgeryTypePkId,\n\t'CAUSE' AS v_MedicalCauseType,\n\tv_MedicalCauseType AS MedicalCodeType,\n\tEXP_Src_Value_CAUSE.patient_cause_code AS IN_MedicalCauseCode,\n\t-- *INF*: iif(isnull(IN_MedicalCauseCode),'N/A',IN_MedicalCauseCode)\n\tIFF(IN_MedicalCauseCode IS NULL, 'N/A', IN_MedicalCauseCode) AS v_MedicalCauseCode,\n\tv_MedicalCauseCode AS MedicalCode,\n\tLKP_SupMedicalCauseCode_Src.ShortDescription AS IN_MedicalCauseDescription,\n\t-- *INF*: iif(isnull(IN_MedicalCauseDescription),'N/A',IN_MedicalCauseDescription)\n\tIFF(IN_MedicalCauseDescription IS NULL, 'N/A', IN_MedicalCauseDescription) AS v_MedicalCauseDescription,\n\tv_MedicalCauseDescription AS MedicalCodeDescription,\n\tEXP_Src_Value_CAUSE.EffectiveDate,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS ExpirationDate,\n\t1 AS CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditID,\n\tsysdate AS CreatedDate,\n\tsysdate AS ModifiedDate,\n\t-- *INF*: :LKP.LKP_CLAIMANTMEDICALCODEDIM(v_claim_party_occurrence_ak_id, v_SupMedicalDiagnosisCodeId, v_SupMedicalCauseCodeId, v_SupMedicalSurgeryCodeId,v_MedicalCauseCode,v_MedicalCauseType)\n\tLKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalCauseCode_v_MedicalCauseType.ClaimantMedicalCodeDimId AS v_ClaimantMedicalDimId,\n\tv_ClaimantMedicalDimId AS ClaimantMedicalCodeDimId\n\tFROM EXP_Src_Value_CAUSE\n\tLEFT JOIN LKP_SupMedicalCauseCode_Src\n\tON LKP_SupMedicalCauseCode_Src.MedicalCauseCode = EXP_Src_Value_CAUSE.patient_cause_code\n\tLEFT JOIN LKP_CLAIM_PARTY_OCCURRENCE LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_id\n\tON LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_id.claim_party_occurrence_ak_id = IN_claim_party_occurrence_ak_id\n\n\tLEFT JOIN LKP_CLAIMANT_DIM LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_id\n\tON LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_id.edw_claim_party_occurrence_ak_id = IN_claim_party_occurrence_ak_id\n\n\tLEFT JOIN LKP_CLAIMANTMEDICALCODEDIM LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalCauseCode_v_MedicalCauseType\n\tON LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalCauseCode_v_MedicalCauseType.EdwClaimPartyOccurrenceAkId = v_claim_party_occurrence_ak_id\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalCauseCode_v_MedicalCauseType.EdwSupMedicalDiagnosisCodePkId = v_SupMedicalDiagnosisCodeId\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalCauseCode_v_MedicalCauseType.EdwSupMedicalCauseCodePkId = v_SupMedicalCauseCodeId\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalCauseCode_v_MedicalCauseType.EdwSupSurgeryTypePkId = v_SupMedicalSurgeryCodeId\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalCauseCode_v_MedicalCauseType.MedicalCode = v_MedicalCauseCode\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalCauseCode_v_MedicalCauseType.MedicalCodeType = v_MedicalCauseType\n\n),\nRTR_Cause AS (\n\tSELECT\n\tClaimantMedicalCodeDimId,\n\tEdwClaimPartyOccurrencePkId,\n\tEdwClaimPartyOccurrenceAkId,\n\tclaimant_dim_id,\n\tEdwSupMedicalDiagnosisCodePkId,\n\tEdwSupMedicalCauseCodePkId,\n\tEdwSupSurgeryTypePkId,\n\tMedicalCodeType,\n\tMedicalCode,\n\tMedicalCodeDescription,\n\tEffectiveDate,\n\tExpirationDate,\n\tCurrentSnapshotFlag,\n\tAuditID,\n\tCreatedDate,\n\tModifiedDate\n\tFROM EXP_Defualt_Values_CAUSE\n),\nRTR_Cause_Insert_Cause AS (SELECT * FROM RTR_Cause WHERE isnull(ClaimantMedicalCodeDimId)),\nRTR_Cause_DEFAULT1 AS (SELECT * FROM RTR_Cause WHERE NOT ( (isnull(ClaimantMedicalCodeDimId)) )),\nUPD_Update_CAUSE AS (\n\tSELECT\n\tClaimantMedicalCodeDimId, \n\tEdwClaimPartyOccurrencePkId, \n\tEdwClaimPartyOccurrenceAkId, \n\tclaimant_dim_id, \n\tEdwSupMedicalDiagnosisCodePkId, \n\tEdwSupMedicalCauseCodePkId, \n\tEdwSupSurgeryTypePkId, \n\tMedicalCodeType, \n\tMedicalCode, \n\tMedicalCodeDescription, \n\tEffectiveDate, \n\tExpirationDate, \n\tCurrentSnapshotFlag, \n\tAuditID, \n\tCreatedDate, \n\tModifiedDate\n\tFROM RTR_Cause_DEFAULT1\n),\nClaimantMedicalCodeDim_Update_CAUSE AS (\n\tMERGE INTO ClaimantMedicalCodeDim AS T\n\tUSING UPD_Update_CAUSE AS S\n\tON T.ClaimantMedicalCodeDimId = S.ClaimantMedicalCodeDimId\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.CurrentSnapshotFlag = S.CurrentSnapshotFlag, T.AuditID = S.AuditID, T.EffectiveDate = S.EffectiveDate, T.ExpirationDate = S.ExpirationDate, T.CreatedDate = S.CreatedDate, T.ModifiedDate = S.ModifiedDate, T.EdwClaimPartyOccurrencePkId = S.EdwClaimPartyOccurrencePkId, T.EdwClaimPartyOccurrenceAkId = S.EdwClaimPartyOccurrenceAkId, T.claimant_dim_id = S.claimant_dim_id, T.EdwSupMedicalDiagnosisCodePkId = S.EdwSupMedicalDiagnosisCodePkId, T.EdwSupMedicalCauseCodePkId = S.EdwSupMedicalCauseCodePkId, T.EdwSupSurgeryTypePkId = S.EdwSupSurgeryTypePkId, T.MedicalCodeType = S.MedicalCodeType, T.MedicalCode = S.MedicalCode, T.MedicalCodeDescription = S.MedicalCodeDescription\n),\nUPD_Insert_CAUSE AS (\n\tSELECT\n\tEdwClaimPartyOccurrencePkId, \n\tEdwClaimPartyOccurrenceAkId, \n\tclaimant_dim_id, \n\tEdwSupMedicalDiagnosisCodePkId, \n\tEdwSupMedicalCauseCodePkId, \n\tEdwSupSurgeryTypePkId, \n\tMedicalCodeType, \n\tMedicalCode, \n\tMedicalCodeDescription, \n\tEffectiveDate, \n\tExpirationDate, \n\tCurrentSnapshotFlag, \n\tAuditID, \n\tCreatedDate, \n\tModifiedDate\n\tFROM RTR_Cause_Insert_Cause\n),\nClaimantMedicalCodeDim_Insert_CAUSE AS (\n\tINSERT INTO ClaimantMedicalCodeDim\n\t(CurrentSnapshotFlag, AuditID, EffectiveDate, ExpirationDate, CreatedDate, ModifiedDate, EdwClaimPartyOccurrencePkId, EdwClaimPartyOccurrenceAkId, claimant_dim_id, EdwSupMedicalDiagnosisCodePkId, EdwSupMedicalCauseCodePkId, EdwSupSurgeryTypePkId, MedicalCodeType, MedicalCode, MedicalCodeDescription)\n\tSELECT \n\tCURRENTSNAPSHOTFLAG, \n\tAUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tEDWCLAIMPARTYOCCURRENCEPKID, \n\tEDWCLAIMPARTYOCCURRENCEAKID, \n\tCLAIMANT_DIM_ID, \n\tEDWSUPMEDICALDIAGNOSISCODEPKID, \n\tEDWSUPMEDICALCAUSECODEPKID, \n\tEDWSUPSURGERYTYPEPKID, \n\tMEDICALCODETYPE, \n\tMEDICALCODE, \n\tMEDICALCODEDESCRIPTION\n\tFROM UPD_Insert_CAUSE\n),\nSQ_Claim_medical_DIAG AS (\n\tSELECT\r\n\tCM.claim_med_id, \r\n\tCM.eff_from_date,\r\n\tCM.claim_med_ak_id, \r\n\tCM.claim_party_occurrence_ak_id,\r\n\tCM.patient_diag_code\r\n\t\r\n\tFROM\r\n\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.claim_medical CM \r\n\t\r\n\twhere\r\n\tCM.crrnt_snpsht_flag = 1\r\n\tAND\r\n\tCM.patient_diag_code <> 'N/A'\r\n\tAND\r\n\tCM.created_date >= '@{pipeline().parameters.SELECTION_START_TS}'\r\n\t\r\n\torder by \r\n\tCM.claim_med_ak_id\n),\nEXP_Src_Value_DIAG AS (\n\tSELECT\n\tclaim_med_id,\n\tEffectiveDate,\n\tclaim_med_ak_id,\n\tclaim_party_occurrence_ak_id,\n\tpatient_diag_code AS IN_patient_diag_code,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- ISNULL(IN_patient_diag_code),'N/A',\r\n\t-- IS_SPACES(IN_patient_diag_code),'N/A',\r\n\t-- LENGTH(IN_patient_diag_code)=0,'N/A',\r\n\t-- LTRIM(RTRIM(IN_patient_diag_code)))\n\tDECODE(TRUE,\n\tIN_patient_diag_code IS NULL, 'N/A',\n\tIS_SPACES(IN_patient_diag_code), 'N/A',\n\tLENGTH(IN_patient_diag_code) = 0, 'N/A',\n\tLTRIM(RTRIM(IN_patient_diag_code))) AS patient_diag_code\n\tFROM SQ_Claim_medical_DIAG\n),\nLKP_SupMedicalDiagnosisCode_Src AS (\n\tSELECT\n\tSupMedicalDiagnosisCodeId,\n\tShortDescription,\n\tMedicalDiagnosisCode\n\tFROM (\n\t\tSELECT \r\n\t\tSD.SupMedicalDiagnosisCodeId as SupMedicalDiagnosisCodeId, \r\n\t\tltrim(rtrim(SD.ShortDescription)) as ShortDescription, \r\n\t\tltrim(rtrim(SD.MedicalDiagnosisCode)) as MedicalDiagnosisCode \r\n\t\t\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.SupMedicalDiagnosisCode SD\r\n\t\t\r\n\t\twhere\r\n\t\tSD.CurrentSnapshotFlag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY MedicalDiagnosisCode ORDER BY SupMedicalDiagnosisCodeId) = 1\n),\nEXP_Defualt_Values_DIAG AS (\n\tSELECT\n\tEXP_Src_Value_DIAG.claim_party_occurrence_ak_id AS IN_claim_party_occurrence_ak_id,\n\t-- *INF*: iif(isnull(IN_claim_party_occurrence_ak_id),-1,IN_claim_party_occurrence_ak_id)\n\tIFF(IN_claim_party_occurrence_ak_id IS NULL, - 1, IN_claim_party_occurrence_ak_id) AS v_claim_party_occurrence_ak_id,\n\tv_claim_party_occurrence_ak_id AS EdwClaimPartyOccurrenceAkId,\n\t-- *INF*: iif(isnull(:LKP.LKP_CLAIM_PARTY_OCCURRENCE(IN_claim_party_occurrence_ak_id)),\r\n\t-- -1,\r\n\t-- :LKP.LKP_CLAIM_PARTY_OCCURRENCE(IN_claim_party_occurrence_ak_id))\n\tIFF(LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_id.claim_party_occurrence_id IS NULL, - 1, LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_id.claim_party_occurrence_id) AS v_claim_party_occurrence_id,\n\tv_claim_party_occurrence_id AS EdwClaimPartyOccurrencePkId,\n\t-- *INF*: iif(isnull(:LKP.LKP_CLAIMANT_DIM(IN_claim_party_occurrence_ak_id))\r\n\t-- ,-1,\r\n\t-- :LKP.LKP_CLAIMANT_DIM(IN_claim_party_occurrence_ak_id))\n\tIFF(LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_id.claimant_dim_id IS NULL, - 1, LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_id.claimant_dim_id) AS v_claimant_dim_id,\n\tv_claimant_dim_id AS claimant_dim_id,\n\tLKP_SupMedicalDiagnosisCode_Src.SupMedicalDiagnosisCodeId AS IN_SupMedicalDiagnosisCodeId,\n\t-- *INF*: iif(isnull(IN_SupMedicalDiagnosisCodeId),-1,IN_SupMedicalDiagnosisCodeId)\n\tIFF(IN_SupMedicalDiagnosisCodeId IS NULL, - 1, IN_SupMedicalDiagnosisCodeId) AS v_SupMedicalDiagnosisCodeId,\n\tv_SupMedicalDiagnosisCodeId AS EdwSupMedicalDiagnosisCodePkId,\n\t-1 AS v_SupMedicalCauseCodeId,\n\tv_SupMedicalCauseCodeId AS EdwSupMedicalCauseCodePkId,\n\t-1 AS v_SupMedicalSurgeryCodeId,\n\tv_SupMedicalSurgeryCodeId AS EdwSupSurgeryTypePkId,\n\t'DIAG' AS v_MedicalDiagnosisType,\n\tv_MedicalDiagnosisType AS MedicalCodeType,\n\tEXP_Src_Value_DIAG.patient_diag_code AS IN_MedicalDiagnosisCode,\n\t-- *INF*: iif(isnull(IN_MedicalDiagnosisCode),'N/A',IN_MedicalDiagnosisCode)\n\tIFF(IN_MedicalDiagnosisCode IS NULL, 'N/A', IN_MedicalDiagnosisCode) AS v_MedicalDiagnosisCode,\n\tv_MedicalDiagnosisCode AS MedicalCode,\n\tLKP_SupMedicalDiagnosisCode_Src.ShortDescription AS IN_MedicalDiagnosisDescription,\n\t-- *INF*: iif(isnull(IN_MedicalDiagnosisDescription),'N/A',IN_MedicalDiagnosisDescription)\n\tIFF(IN_MedicalDiagnosisDescription IS NULL, 'N/A', IN_MedicalDiagnosisDescription) AS v_MedicalDiagnosisDescription,\n\tv_MedicalDiagnosisDescription AS MedicalCodeDescription,\n\tEXP_Src_Value_DIAG.EffectiveDate,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS ExpirationDate,\n\t1 AS CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditID,\n\tsysdate AS CreatedDate,\n\tsysdate AS ModifiedDate,\n\t-- *INF*: :LKP.LKP_CLAIMANTMEDICALCODEDIM(v_claim_party_occurrence_ak_id,v_SupMedicalDiagnosisCodeId,v_SupMedicalCauseCodeId,v_SupMedicalSurgeryCodeId,v_MedicalDiagnosisCode,v_MedicalDiagnosisType)\n\tLKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_v_MedicalDiagnosisType.ClaimantMedicalCodeDimId AS v_ClaimantMedicalDimId,\n\tv_ClaimantMedicalDimId AS ClaimantMedicalCodeDimId\n\tFROM EXP_Src_Value_DIAG\n\tLEFT JOIN LKP_SupMedicalDiagnosisCode_Src\n\tON LKP_SupMedicalDiagnosisCode_Src.MedicalDiagnosisCode = EXP_Src_Value_DIAG.patient_diag_code\n\tLEFT JOIN LKP_CLAIM_PARTY_OCCURRENCE LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_id\n\tON LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_id.claim_party_occurrence_ak_id = IN_claim_party_occurrence_ak_id\n\n\tLEFT JOIN LKP_CLAIMANT_DIM LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_id\n\tON LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_id.edw_claim_party_occurrence_ak_id = IN_claim_party_occurrence_ak_id\n\n\tLEFT JOIN LKP_CLAIMANTMEDICALCODEDIM LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_v_MedicalDiagnosisType\n\tON LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_v_MedicalDiagnosisType.EdwClaimPartyOccurrenceAkId = v_claim_party_occurrence_ak_id\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_v_MedicalDiagnosisType.EdwSupMedicalDiagnosisCodePkId = v_SupMedicalDiagnosisCodeId\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_v_MedicalDiagnosisType.EdwSupMedicalCauseCodePkId = v_SupMedicalCauseCodeId\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_v_MedicalDiagnosisType.EdwSupSurgeryTypePkId = v_SupMedicalSurgeryCodeId\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_v_MedicalDiagnosisType.MedicalCode = v_MedicalDiagnosisCode\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_v_MedicalDiagnosisType.MedicalCodeType = v_MedicalDiagnosisType\n\n),\nRTR_Diag AS (\n\tSELECT\n\tClaimantMedicalCodeDimId,\n\tEdwClaimPartyOccurrencePkId,\n\tEdwClaimPartyOccurrenceAkId,\n\tclaimant_dim_id,\n\tEdwSupMedicalDiagnosisCodePkId,\n\tEdwSupMedicalCauseCodePkId,\n\tEdwSupSurgeryTypePkId,\n\tMedicalCodeType,\n\tMedicalCode,\n\tMedicalCodeDescription,\n\tEffectiveDate,\n\tExpirationDate,\n\tCurrentSnapshotFlag,\n\tAuditID,\n\tCreatedDate,\n\tModifiedDate\n\tFROM EXP_Defualt_Values_DIAG\n),\nRTR_Diag_Insert_Diag AS (SELECT * FROM RTR_Diag WHERE isnull(ClaimantMedicalCodeDimId)),\nRTR_Diag_DEFAULT1 AS (SELECT * FROM RTR_Diag WHERE NOT ( (isnull(ClaimantMedicalCodeDimId)) )),\nUPD_update_DIAG AS (\n\tSELECT\n\tClaimantMedicalCodeDimId, \n\tEdwClaimPartyOccurrencePkId, \n\tEdwClaimPartyOccurrenceAkId, \n\tclaimant_dim_id, \n\tEdwSupMedicalDiagnosisCodePkId, \n\tEdwSupMedicalCauseCodePkId, \n\tEdwSupSurgeryTypePkId, \n\tMedicalCodeType, \n\tMedicalCode, \n\tMedicalCodeDescription, \n\tEffectiveDate, \n\tExpirationDate, \n\tCurrentSnapshotFlag, \n\tAuditID, \n\tCreatedDate, \n\tModifiedDate\n\tFROM RTR_Diag_DEFAULT1\n),\nClaimantMedicalCodeDim_Update_DIAG AS (\n\tMERGE INTO ClaimantMedicalCodeDim AS T\n\tUSING UPD_update_DIAG AS S\n\tON T.ClaimantMedicalCodeDimId = S.ClaimantMedicalCodeDimId\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.CurrentSnapshotFlag = S.CurrentSnapshotFlag, T.AuditID = S.AuditID, T.EffectiveDate = S.EffectiveDate, T.ExpirationDate = S.ExpirationDate, T.CreatedDate = S.CreatedDate, T.ModifiedDate = S.ModifiedDate, T.EdwClaimPartyOccurrencePkId = S.EdwClaimPartyOccurrencePkId, T.EdwClaimPartyOccurrenceAkId = S.EdwClaimPartyOccurrenceAkId, T.claimant_dim_id = S.claimant_dim_id, T.EdwSupMedicalDiagnosisCodePkId = S.EdwSupMedicalDiagnosisCodePkId, T.EdwSupMedicalCauseCodePkId = S.EdwSupMedicalCauseCodePkId, T.EdwSupSurgeryTypePkId = S.EdwSupSurgeryTypePkId, T.MedicalCodeType = S.MedicalCodeType, T.MedicalCode = S.MedicalCode, T.MedicalCodeDescription = S.MedicalCodeDescription\n),\nUPD_Insert_DIAG AS (\n\tSELECT\n\tEdwClaimPartyOccurrencePkId, \n\tEdwClaimPartyOccurrenceAkId, \n\tclaimant_dim_id, \n\tEdwSupMedicalDiagnosisCodePkId, \n\tEdwSupMedicalCauseCodePkId, \n\tEdwSupSurgeryTypePkId, \n\tMedicalCodeType, \n\tMedicalCode, \n\tMedicalCodeDescription, \n\tEffectiveDate, \n\tExpirationDate, \n\tCurrentSnapshotFlag, \n\tAuditID, \n\tCreatedDate, \n\tModifiedDate\n\tFROM RTR_Diag_Insert_Diag\n),\nClaimantMedicalCodeDim_Insert_DIAG AS (\n\tINSERT INTO ClaimantMedicalCodeDim\n\t(CurrentSnapshotFlag, AuditID, EffectiveDate, ExpirationDate, CreatedDate, ModifiedDate, EdwClaimPartyOccurrencePkId, EdwClaimPartyOccurrenceAkId, claimant_dim_id, EdwSupMedicalDiagnosisCodePkId, EdwSupMedicalCauseCodePkId, EdwSupSurgeryTypePkId, MedicalCodeType, MedicalCode, MedicalCodeDescription)\n\tSELECT \n\tCURRENTSNAPSHOTFLAG, \n\tAUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tEDWCLAIMPARTYOCCURRENCEPKID, \n\tEDWCLAIMPARTYOCCURRENCEAKID, \n\tCLAIMANT_DIM_ID, \n\tEDWSUPMEDICALDIAGNOSISCODEPKID, \n\tEDWSUPMEDICALCAUSECODEPKID, \n\tEDWSUPSURGERYTYPEPKID, \n\tMEDICALCODETYPE, \n\tMEDICALCODE, \n\tMEDICALCODEDESCRIPTION\n\tFROM UPD_Insert_DIAG\n),\nSQ_claim_medical_patient_diagnosis_additional AS (\n\tSELECT \r\n\tCMDA.claim_med_patient_diag_add_id, \r\n\tCMDA.eff_from_date, \r\n\tCMDA.claim_med_patient_diag_add_ak_id, \r\n\tCMDA.claim_med_ak_id, \r\n\tCMDA.patient_add_code, \r\n\tCMDA.patient_diag_code \r\n\t\r\n\tFROM\r\n\t @{pipeline().parameters.SOURCE_TABLE_OWNER}.claim_medical_patient_diagnosis_additional CMDA\r\n\t \r\n\t where\r\n\t CMDA.crrnt_snpsht_flag = 1\r\n\t AND\r\n\t CMDA.patient_diag_code <> 'N/A'\n),\nEXP_Src_Values_DIAG_ADD AS (\n\tSELECT\n\tclaim_med_patient_diag_add_id,\n\tEffectiveDate,\n\tclaim_med_patient_diag_add_ak_id,\n\tclaim_med_ak_id,\n\tpatient_add_code,\n\tpatient_diag_code AS IN_patient_diag_code,\n\t-- *INF*: iif(isnull(IN_patient_diag_code), 'N/A',IN_patient_diag_code)\n\tIFF(IN_patient_diag_code IS NULL, 'N/A', IN_patient_diag_code) AS patient_diag_code\n\tFROM SQ_claim_medical_patient_diagnosis_additional\n),\nLKP_SupMedicalDiagnosisCode_Add AS (\n\tSELECT\n\tSupMedicalDiagnosisCodeId,\n\tShortDescription,\n\tMedicalDiagnosisCode\n\tFROM (\n\t\tSELECT \r\n\t\tSD.SupMedicalDiagnosisCodeId as SupMedicalDiagnosisCodeId, \r\n\t\tltrim(rtrim(SD.ShortDescription)) as ShortDescription, \r\n\t\tltrim(rtrim(SD.MedicalDiagnosisCode)) as MedicalDiagnosisCode \r\n\t\t\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.SupMedicalDiagnosisCode SD\r\n\t\t\r\n\t\twhere\r\n\t\tSD.CurrentSnapshotFlag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY MedicalDiagnosisCode ORDER BY SupMedicalDiagnosisCodeId) = 1\n),\nLKP_claim_medical_ADD AS (\n\tSELECT\n\tclaim_party_occurrence_ak_id,\n\tclaim_med_ak_id\n\tFROM (\n\t\tSELECT \r\n\t\tCM.claim_party_occurrence_ak_id as claim_party_occurrence_ak_id, \r\n\t\tCM.claim_med_ak_id as claim_med_ak_id \r\n\t\t\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.claim_medical CM\r\n\t\t\r\n\t\twhere\r\n\t\tCM.crrnt_snpsht_flag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY claim_med_ak_id ORDER BY claim_party_occurrence_ak_id) = 1\n),\nEXP_Defualt_Values_DIAG_ADD AS (\n\tSELECT\n\tLKP_claim_medical_ADD.claim_party_occurrence_ak_id AS IN_claim_party_occurrence_ak_id,\n\t-- *INF*: iif(isnull(IN_claim_party_occurrence_ak_id),-1,IN_claim_party_occurrence_ak_id)\n\tIFF(IN_claim_party_occurrence_ak_id IS NULL, - 1, IN_claim_party_occurrence_ak_id) AS v_claim_party_occurrence_ak_id,\n\tv_claim_party_occurrence_ak_id AS EdwClaimPartyOccurrenceAkId,\n\t-- *INF*: iif(isnull(:LKP.LKP_CLAIM_PARTY_OCCURRENCE(IN_claim_party_occurrence_ak_id)),\r\n\t-- -1,\r\n\t-- :LKP.LKP_CLAIM_PARTY_OCCURRENCE(IN_claim_party_occurrence_ak_id))\n\tIFF(LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_id.claim_party_occurrence_id IS NULL, - 1, LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_id.claim_party_occurrence_id) AS v_claim_party_occurrence_id,\n\tv_claim_party_occurrence_id AS EdwClaimPartyOccurrencePkId,\n\t-- *INF*: iif(isnull(:LKP.LKP_CLAIMANT_DIM(IN_claim_party_occurrence_ak_id))\r\n\t-- ,-1,\r\n\t-- :LKP.LKP_CLAIMANT_DIM(IN_claim_party_occurrence_ak_id))\n\tIFF(LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_id.claimant_dim_id IS NULL, - 1, LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_id.claimant_dim_id) AS v_claimant_dim_id,\n\tv_claimant_dim_id AS claimant_dim_id,\n\tLKP_SupMedicalDiagnosisCode_Add.SupMedicalDiagnosisCodeId AS IN_SupMedicalDiagnosisCodeId_ADD,\n\t-- *INF*: iif(isnull(IN_SupMedicalDiagnosisCodeId_ADD),-1,IN_SupMedicalDiagnosisCodeId_ADD)\n\tIFF(IN_SupMedicalDiagnosisCodeId_ADD IS NULL, - 1, IN_SupMedicalDiagnosisCodeId_ADD) AS v_SupMedicalDiagnosisCodeId_ADD,\n\tv_SupMedicalDiagnosisCodeId_ADD AS EdwSupMedicalDiagnosisCodePkId,\n\t-1 AS v_SupMedicalCauseCodeId,\n\tv_SupMedicalCauseCodeId AS EdwSupMedicalCauseCodePkId,\n\t-1 AS v_SupMedicalSurgeryCodeId,\n\tv_SupMedicalSurgeryCodeId AS EdwSupSurgeryTypePkId,\n\t'DIAG' AS v_MedicalDiagnosisType_ADD,\n\tv_MedicalDiagnosisType_ADD AS MedicalCodeType,\n\tEXP_Src_Values_DIAG_ADD.patient_diag_code AS IN_MedicalDiagnosisCode_ADD,\n\t-- *INF*: iif(isnull(IN_MedicalDiagnosisCode_ADD),'N/A',IN_MedicalDiagnosisCode_ADD)\n\tIFF(IN_MedicalDiagnosisCode_ADD IS NULL, 'N/A', IN_MedicalDiagnosisCode_ADD) AS v_MedicalDiagnosisCode_ADD,\n\tv_MedicalDiagnosisCode_ADD AS MedicalCode,\n\tLKP_SupMedicalDiagnosisCode_Add.ShortDescription AS IN_MedicalDiagnosisDescription_ADD,\n\t-- *INF*: iif(isnull(IN_MedicalDiagnosisDescription_ADD),'N/A',IN_MedicalDiagnosisDescription_ADD)\n\tIFF(IN_MedicalDiagnosisDescription_ADD IS NULL, 'N/A', IN_MedicalDiagnosisDescription_ADD) AS v_MedicalDiagnosisDescription_ADD,\n\tv_MedicalDiagnosisDescription_ADD AS MedicalCodeDescription,\n\tEXP_Src_Values_DIAG_ADD.EffectiveDate,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS ExpirationDate,\n\t1 AS CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditID,\n\tsysdate AS CreatedDate,\n\tsysdate AS ModifiedDate,\n\t-- *INF*: :LKP.LKP_CLAIMANTMEDICALCODEDIM(v_claim_party_occurrence_ak_id, v_SupMedicalDiagnosisCodeId_ADD, v_SupMedicalCauseCodeId, v_SupMedicalSurgeryCodeId,v_MedicalDiagnosisCode_ADD,v_MedicalDiagnosisType_ADD)\r\n\t-- \n\tLKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_ADD_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_ADD_v_MedicalDiagnosisType_ADD.ClaimantMedicalCodeDimId AS v_ClaimantMedicalCodeDimId,\n\tv_ClaimantMedicalCodeDimId AS ClaimantMedicalCodeDimId\n\tFROM EXP_Src_Values_DIAG_ADD\n\tLEFT JOIN LKP_SupMedicalDiagnosisCode_Add\n\tON LKP_SupMedicalDiagnosisCode_Add.MedicalDiagnosisCode = EXP_Src_Values_DIAG_ADD.patient_diag_code\n\tLEFT JOIN LKP_claim_medical_ADD\n\tON LKP_claim_medical_ADD.claim_med_ak_id = EXP_Src_Values_DIAG_ADD.claim_med_ak_id\n\tLEFT JOIN LKP_CLAIM_PARTY_OCCURRENCE LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_id\n\tON LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_id.claim_party_occurrence_ak_id = IN_claim_party_occurrence_ak_id\n\n\tLEFT JOIN LKP_CLAIMANT_DIM LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_id\n\tON LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_id.edw_claim_party_occurrence_ak_id = IN_claim_party_occurrence_ak_id\n\n\tLEFT JOIN LKP_CLAIMANTMEDICALCODEDIM LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_ADD_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_ADD_v_MedicalDiagnosisType_ADD\n\tON LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_ADD_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_ADD_v_MedicalDiagnosisType_ADD.EdwClaimPartyOccurrenceAkId = v_claim_party_occurrence_ak_id\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_ADD_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_ADD_v_MedicalDiagnosisType_ADD.EdwSupMedicalDiagnosisCodePkId = v_SupMedicalDiagnosisCodeId_ADD\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_ADD_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_ADD_v_MedicalDiagnosisType_ADD.EdwSupMedicalCauseCodePkId = v_SupMedicalCauseCodeId\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_ADD_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_ADD_v_MedicalDiagnosisType_ADD.EdwSupSurgeryTypePkId = v_SupMedicalSurgeryCodeId\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_ADD_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_ADD_v_MedicalDiagnosisType_ADD.MedicalCode = v_MedicalDiagnosisCode_ADD\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_id_v_SupMedicalDiagnosisCodeId_ADD_v_SupMedicalCauseCodeId_v_SupMedicalSurgeryCodeId_v_MedicalDiagnosisCode_ADD_v_MedicalDiagnosisType_ADD.MedicalCodeType = v_MedicalDiagnosisType_ADD\n\n),\nRTR_Diag_ADD AS (\n\tSELECT\n\tClaimantMedicalCodeDimId,\n\tEdwClaimPartyOccurrencePkId,\n\tEdwClaimPartyOccurrenceAkId,\n\tclaimant_dim_id,\n\tEdwSupMedicalDiagnosisCodePkId,\n\tEdwSupMedicalCauseCodePkId,\n\tEdwSupSurgeryTypePkId,\n\tMedicalCodeType,\n\tMedicalCode,\n\tMedicalCodeDescription,\n\tEffectiveDate,\n\tExpirationDate,\n\tCurrentSnapshotFlag,\n\tAuditID,\n\tCreatedDate,\n\tModifiedDate\n\tFROM EXP_Defualt_Values_DIAG_ADD\n),\nRTR_Diag_ADD_Insert_Diag_ADD AS (SELECT * FROM RTR_Diag_ADD WHERE isnull(ClaimantMedicalCodeDimId)),\nRTR_Diag_ADD_DEFAULT1 AS (SELECT * FROM RTR_Diag_ADD WHERE NOT ( (isnull(ClaimantMedicalCodeDimId)) )),\nUPD_Update_DIAG_ADD AS (\n\tSELECT\n\tClaimantMedicalCodeDimId, \n\tEdwClaimPartyOccurrencePkId, \n\tEdwClaimPartyOccurrenceAkId, \n\tclaimant_dim_id, \n\tEdwSupMedicalDiagnosisCodePkId, \n\tEdwSupMedicalCauseCodePkId, \n\tEdwSupSurgeryTypePkId, \n\tMedicalCodeType, \n\tMedicalCode, \n\tMedicalCodeDescription, \n\tEffectiveDate, \n\tExpirationDate, \n\tCurrentSnapshotFlag, \n\tAuditID, \n\tCreatedDate, \n\tModifiedDate\n\tFROM RTR_Diag_ADD_DEFAULT1\n),\nClaimantMedicalCodeDim_DIAG_ADD_Update AS (\n\tMERGE INTO ClaimantMedicalCodeDim AS T\n\tUSING UPD_Update_DIAG_ADD AS S\n\tON T.ClaimantMedicalCodeDimId = S.ClaimantMedicalCodeDimId\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.CurrentSnapshotFlag = S.CurrentSnapshotFlag, T.AuditID = S.AuditID, T.EffectiveDate = S.EffectiveDate, T.ExpirationDate = S.ExpirationDate, T.CreatedDate = S.CreatedDate, T.ModifiedDate = S.ModifiedDate, T.EdwClaimPartyOccurrencePkId = S.EdwClaimPartyOccurrencePkId, T.EdwClaimPartyOccurrenceAkId = S.EdwClaimPartyOccurrenceAkId, T.claimant_dim_id = S.claimant_dim_id, T.EdwSupMedicalDiagnosisCodePkId = S.EdwSupMedicalDiagnosisCodePkId, T.EdwSupMedicalCauseCodePkId = S.EdwSupMedicalCauseCodePkId, T.EdwSupSurgeryTypePkId = S.EdwSupSurgeryTypePkId, T.MedicalCodeType = S.MedicalCodeType, T.MedicalCode = S.MedicalCode, T.MedicalCodeDescription = S.MedicalCodeDescription\n),\nUPD_Insert_DIAG_ADD AS (\n\tSELECT\n\tEdwClaimPartyOccurrencePkId, \n\tEdwClaimPartyOccurrenceAkId, \n\tclaimant_dim_id, \n\tEdwSupMedicalDiagnosisCodePkId, \n\tEdwSupMedicalCauseCodePkId, \n\tEdwSupSurgeryTypePkId, \n\tMedicalCodeType, \n\tMedicalCode, \n\tMedicalCodeDescription, \n\tEffectiveDate, \n\tExpirationDate, \n\tCurrentSnapshotFlag, \n\tAuditID, \n\tCreatedDate, \n\tModifiedDate\n\tFROM RTR_Diag_ADD_Insert_Diag_ADD\n),\nClaimantMedicalCodeDim_DIAG_ADD_Insert AS (\n\tINSERT INTO ClaimantMedicalCodeDim\n\t(CurrentSnapshotFlag, AuditID, EffectiveDate, ExpirationDate, CreatedDate, ModifiedDate, EdwClaimPartyOccurrencePkId, EdwClaimPartyOccurrenceAkId, claimant_dim_id, EdwSupMedicalDiagnosisCodePkId, EdwSupMedicalCauseCodePkId, EdwSupSurgeryTypePkId, MedicalCodeType, MedicalCode, MedicalCodeDescription)\n\tSELECT \n\tCURRENTSNAPSHOTFLAG, \n\tAUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tEDWCLAIMPARTYOCCURRENCEPKID, \n\tEDWCLAIMPARTYOCCURRENCEAKID, \n\tCLAIMANT_DIM_ID, \n\tEDWSUPMEDICALDIAGNOSISCODEPKID, \n\tEDWSUPMEDICALCAUSECODEPKID, \n\tEDWSUPSURGERYTYPEPKID, \n\tMEDICALCODETYPE, \n\tMEDICALCODE, \n\tMEDICALCODEDESCRIPTION\n\tFROM UPD_Insert_DIAG_ADD\n),\nSQ_ClaimantSurgeryDetail AS (\n\tSELECT \r\n\tC.ClaimantSurgeryDetailId, \r\n\tC.EffectiveDate, \r\n\tC.claim_party_occurrence_ak_Id, \r\n\tC.SupSurgeryTypeId, \r\n\tC.clmt_surgery_detail_id \r\n\t\r\n\tFROM\r\n\t @{pipeline().parameters.SOURCE_TABLE_OWNER}.ClaimantSurgeryDetail C\r\n\t\r\n\twhere\r\n\tC.CurrentSnapshotFlag = 1\r\n\tAND\r\n\tC.CreatedDate >= '@{pipeline().parameters.SELECTION_START_TS}'\n),\nEXP_Src_Values_SURGERY AS (\n\tSELECT\n\tClaimantSurgeryDetailId,\n\tEffectiveDate,\n\tclaim_party_occurrence_ak_Id,\n\tSupSurgeryTypeId,\n\tclmt_surgery_detail_id\n\tFROM SQ_ClaimantSurgeryDetail\n),\nLKP_SupSurgeryType AS (\n\tSELECT\n\tSupSurgeryTypeId,\n\tSurgeryTypeCode,\n\tSurgeryTypeDescription\n\tFROM (\n\t\tSELECT \r\n\t\tS.SurgeryTypeCode as SurgeryTypeCode, \r\n\t\tS.SurgeryTypeDescription as SurgeryTypeDescription, \r\n\t\tS.SupSurgeryTypeId as SupSurgeryTypeId \r\n\t\t\r\n\t\tFROM \r\n\t\t@{pipeline().parameters.SOURCE_TABLE_OWNER}.SupSurgeryType S\r\n\t\t\r\n\t\twhere\r\n\t\tS.CurrentSnapshotFlag = 1\n\t)\n\tQUALIFY ROW_NUMBER() OVER (PARTITION BY SupSurgeryTypeId ORDER BY SupSurgeryTypeId) = 1\n),\nEXP_Lkp_Extract_SURGERY AS (\n\tSELECT\n\tEXP_Src_Values_SURGERY.claim_party_occurrence_ak_Id AS IN_claim_party_occurrence_ak_Id,\n\t-- *INF*: iif(isnull(IN_claim_party_occurrence_ak_Id),-1,IN_claim_party_occurrence_ak_Id)\n\tIFF(IN_claim_party_occurrence_ak_Id IS NULL, - 1, IN_claim_party_occurrence_ak_Id) AS v_claim_party_occurrence_ak_Id,\n\tv_claim_party_occurrence_ak_Id AS EdwClaimPartyOccurrenceAkId,\n\t-- *INF*: iif(isnull(:LKP.LKP_CLAIM_PARTY_OCCURRENCE(IN_claim_party_occurrence_ak_Id)),\r\n\t-- -1,\r\n\t-- :LKP.LKP_CLAIM_PARTY_OCCURRENCE(IN_claim_party_occurrence_ak_Id))\n\tIFF(LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_Id.claim_party_occurrence_id IS NULL, - 1, LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_Id.claim_party_occurrence_id) AS v_claim_party_occurrence_id,\n\tv_claim_party_occurrence_id AS EdwClaimPartyOccurrencePkId,\n\t-- *INF*: iif(isnull(:LKP.LKP_CLAIMANT_DIM(IN_claim_party_occurrence_ak_Id))\r\n\t-- ,-1,\r\n\t-- :LKP.LKP_CLAIMANT_DIM(IN_claim_party_occurrence_ak_Id))\n\tIFF(LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_Id.claimant_dim_id IS NULL, - 1, LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_Id.claimant_dim_id) AS v_claimant_dim_id,\n\tv_claimant_dim_id AS claimant_dim_id,\n\t-1 AS v_SupMedicalDiagnosisCodeId,\n\tv_SupMedicalDiagnosisCodeId AS EdwSupMedicalDiagnosisCodePkId,\n\t-1 AS v_SupMedicalCauseCodeId,\n\tv_SupMedicalCauseCodeId AS EdwSupMedicalCauseCodePkId,\n\tLKP_SupSurgeryType.SupSurgeryTypeId AS IN_SupSurgeryTypeId,\n\t-- *INF*: iif(isnull(IN_SupSurgeryTypeId), -1, IN_SupSurgeryTypeId)\n\tIFF(IN_SupSurgeryTypeId IS NULL, - 1, IN_SupSurgeryTypeId) AS v_SupSurgeryTypeId,\n\tv_SupSurgeryTypeId AS EdwSupSurgeryTypePkId,\n\tLKP_SupSurgeryType.SurgeryTypeCode AS IN_SurgeryTypeCode,\n\t-- *INF*: iif(isnull(ltrim(rtrim(IN_SurgeryTypeCode))),'N/A',IN_SurgeryTypeCode)\n\tIFF(ltrim(rtrim(IN_SurgeryTypeCode)) IS NULL, 'N/A', IN_SurgeryTypeCode) AS v_SurgeryTypeCode,\n\tv_SurgeryTypeCode AS MedicalCode,\n\tLKP_SupSurgeryType.SurgeryTypeDescription AS IN_SurgeryTypeDescription,\n\t-- *INF*: iif(isnull(Ltrim(Rtrim(IN_SurgeryTypeDescription))),'N/A',IN_SurgeryTypeDescription)\n\tIFF(Ltrim(Rtrim(IN_SurgeryTypeDescription)) IS NULL, 'N/A', IN_SurgeryTypeDescription) AS v_SurgeryDescription,\n\tv_SurgeryDescription AS MedicalCodeDescription,\n\t'SURGERY' AS v_SurgeryType,\n\tv_SurgeryType AS MedicalCodeType,\n\tEXP_Src_Values_SURGERY.EffectiveDate,\n\t-- *INF*: TO_DATE('12/31/2100 23:59:59','MM/DD/YYYY HH24:MI:SS')\n\tTO_DATE('12/31/2100 23:59:59', 'MM/DD/YYYY HH24:MI:SS') AS ExpirationDate,\n\tsysdate AS CreatedDate,\n\tsysdate AS ModifiedDate,\n\t1 AS CurrentSnapshotFlag,\n\t@{pipeline().parameters.WBMI_AUDIT_CONTROL_RUN_ID} AS AuditId,\n\t-- *INF*: :LKP.LKP_CLAIMANTMEDICALCODEDIM(v_claim_party_occurrence_ak_Id,v_SupMedicalDiagnosisCodeId,v_SupMedicalCauseCodeId,v_SupSurgeryTypeId,v_SurgeryTypeCode,v_SurgeryType)\r\n\t-- \n\tLKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_Id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupSurgeryTypeId_v_SurgeryTypeCode_v_SurgeryType.ClaimantMedicalCodeDimId AS v_ClaimantMedicalCodeDimId,\n\tv_ClaimantMedicalCodeDimId AS ClaimantMedicalCodeDimId\n\tFROM EXP_Src_Values_SURGERY\n\tLEFT JOIN LKP_SupSurgeryType\n\tON LKP_SupSurgeryType.SupSurgeryTypeId = EXP_Src_Values_SURGERY.SupSurgeryTypeId\n\tLEFT JOIN LKP_CLAIM_PARTY_OCCURRENCE LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_Id\n\tON LKP_CLAIM_PARTY_OCCURRENCE_IN_claim_party_occurrence_ak_Id.claim_party_occurrence_ak_id = IN_claim_party_occurrence_ak_Id\n\n\tLEFT JOIN LKP_CLAIMANT_DIM LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_Id\n\tON LKP_CLAIMANT_DIM_IN_claim_party_occurrence_ak_Id.edw_claim_party_occurrence_ak_id = IN_claim_party_occurrence_ak_Id\n\n\tLEFT JOIN LKP_CLAIMANTMEDICALCODEDIM LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_Id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupSurgeryTypeId_v_SurgeryTypeCode_v_SurgeryType\n\tON LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_Id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupSurgeryTypeId_v_SurgeryTypeCode_v_SurgeryType.EdwClaimPartyOccurrenceAkId = v_claim_party_occurrence_ak_Id\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_Id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupSurgeryTypeId_v_SurgeryTypeCode_v_SurgeryType.EdwSupMedicalDiagnosisCodePkId = v_SupMedicalDiagnosisCodeId\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_Id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupSurgeryTypeId_v_SurgeryTypeCode_v_SurgeryType.EdwSupMedicalCauseCodePkId = v_SupMedicalCauseCodeId\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_Id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupSurgeryTypeId_v_SurgeryTypeCode_v_SurgeryType.EdwSupSurgeryTypePkId = v_SupSurgeryTypeId\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_Id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupSurgeryTypeId_v_SurgeryTypeCode_v_SurgeryType.MedicalCode = v_SurgeryTypeCode\n\tAND LKP_CLAIMANTMEDICALCODEDIM_v_claim_party_occurrence_ak_Id_v_SupMedicalDiagnosisCodeId_v_SupMedicalCauseCodeId_v_SupSurgeryTypeId_v_SurgeryTypeCode_v_SurgeryType.MedicalCodeType = v_SurgeryType\n\n),\nRTR_Surgery AS (\n\tSELECT\n\tClaimantMedicalCodeDimId,\n\tCurrentSnapshotFlag,\n\tAuditId AS AuditID,\n\tEffectiveDate,\n\tExpirationDate,\n\tCreatedDate,\n\tModifiedDate,\n\tEdwClaimPartyOccurrencePkId,\n\tEdwClaimPartyOccurrenceAkId,\n\tclaimant_dim_id,\n\tEdwSupMedicalDiagnosisCodePkId,\n\tEdwSupMedicalCauseCodePkId,\n\tEdwSupSurgeryTypePkId,\n\tMedicalCodeType,\n\tMedicalCode,\n\tMedicalCodeDescription\n\tFROM EXP_Lkp_Extract_SURGERY\n),\nRTR_Surgery_Insert_Surgery AS (SELECT * FROM RTR_Surgery WHERE isnull(ClaimantMedicalCodeDimId)),\nRTR_Surgery_DEFAULT1 AS (SELECT * FROM RTR_Surgery WHERE NOT ( (isnull(ClaimantMedicalCodeDimId)) )),\nUPD_Update_SURGERY AS (\n\tSELECT\n\tClaimantMedicalCodeDimId, \n\tCurrentSnapshotFlag, \n\tAuditID, \n\tEffectiveDate, \n\tExpirationDate, \n\tCreatedDate, \n\tModifiedDate, \n\tEdwClaimPartyOccurrencePkId, \n\tEdwClaimPartyOccurrenceAkId, \n\tclaimant_dim_id, \n\tEdwSupMedicalDiagnosisCodePkId, \n\tEdwSupMedicalCauseCodePkId, \n\tEdwSupSurgeryTypePkId, \n\tMedicalCodeType, \n\tMedicalCode, \n\tMedicalCodeDescription\n\tFROM RTR_Surgery_DEFAULT1\n),\nClaimantMedicalCodeDim_Update_SURGERY AS (\n\tMERGE INTO ClaimantMedicalCodeDim AS T\n\tUSING UPD_Update_SURGERY AS S\n\tON T.ClaimantMedicalCodeDimId = S.ClaimantMedicalCodeDimId\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.CurrentSnapshotFlag = S.CurrentSnapshotFlag, T.AuditID = S.AuditID, T.EffectiveDate = S.EffectiveDate, T.ExpirationDate = S.ExpirationDate, T.CreatedDate = S.CreatedDate, T.ModifiedDate = S.ModifiedDate, T.EdwClaimPartyOccurrencePkId = S.EdwClaimPartyOccurrencePkId, T.EdwClaimPartyOccurrenceAkId = S.EdwClaimPartyOccurrenceAkId, T.claimant_dim_id = S.claimant_dim_id, T.EdwSupMedicalDiagnosisCodePkId = S.EdwSupMedicalDiagnosisCodePkId, T.EdwSupMedicalCauseCodePkId = S.EdwSupMedicalCauseCodePkId, T.EdwSupSurgeryTypePkId = S.EdwSupSurgeryTypePkId, T.MedicalCodeType = S.MedicalCodeType, T.MedicalCode = S.MedicalCode, T.MedicalCodeDescription = S.MedicalCodeDescription\n),\nUPD_Insert_SURGERY AS (\n\tSELECT\n\tCurrentSnapshotFlag, \n\tAuditID, \n\tEffectiveDate, \n\tExpirationDate, \n\tCreatedDate, \n\tModifiedDate, \n\tEdwClaimPartyOccurrencePkId, \n\tEdwClaimPartyOccurrenceAkId, \n\tclaimant_dim_id, \n\tEdwSupMedicalDiagnosisCodePkId, \n\tEdwSupMedicalCauseCodePkId, \n\tEdwSupSurgeryTypePkId, \n\tMedicalCodeType, \n\tMedicalCode, \n\tMedicalCodeDescription\n\tFROM RTR_Surgery_Insert_Surgery\n),\nClaimantMedicalCodeDim_Insert_SURGERY AS (\n\tINSERT INTO ClaimantMedicalCodeDim\n\t(CurrentSnapshotFlag, AuditID, EffectiveDate, ExpirationDate, CreatedDate, ModifiedDate, EdwClaimPartyOccurrencePkId, EdwClaimPartyOccurrenceAkId, claimant_dim_id, EdwSupMedicalDiagnosisCodePkId, EdwSupMedicalCauseCodePkId, EdwSupSurgeryTypePkId, MedicalCodeType, MedicalCode, MedicalCodeDescription)\n\tSELECT \n\tCURRENTSNAPSHOTFLAG, \n\tAUDITID, \n\tEFFECTIVEDATE, \n\tEXPIRATIONDATE, \n\tCREATEDDATE, \n\tMODIFIEDDATE, \n\tEDWCLAIMPARTYOCCURRENCEPKID, \n\tEDWCLAIMPARTYOCCURRENCEAKID, \n\tCLAIMANT_DIM_ID, \n\tEDWSUPMEDICALDIAGNOSISCODEPKID, \n\tEDWSUPMEDICALCAUSECODEPKID, \n\tEDWSUPSURGERYTYPEPKID, \n\tMEDICALCODETYPE, \n\tMEDICALCODE, \n\tMEDICALCODEDESCRIPTION\n\tFROM UPD_Insert_SURGERY\n),\nSQ_ClaimantMedicalCodeDim AS (\n\tSELECT \r\n\tA.ClaimantMedicalCodeDimId, \r\n\tA.EffectiveDate, \r\n\tA.ExpirationDate, \r\n\tA.EdwClaimPartyOccurrenceAkId \r\n\t\r\n\tFROM\r\n\t @{pipeline().parameters.SOURCE_TABLE_OWNER}.ClaimantMedicalCodeDim A\r\n\t\r\n\twhere Exists \r\n\t    (\r\n\tSelect 1 \r\n\tfrom\r\n\t@{pipeline().parameters.TARGET_TABLE_OWNER}.ClaimantMedicalCodeDim B\r\n\t\r\n\twhere\r\n\tA.EdwClaimPartyOccurrenceAkId = B.EdwClaimPartyOccurrenceAkId \r\n\tAND\r\n\tA.MedicalCode = B.MedicalCode\r\n\tAND\r\n\tA.MedicalCodeType = B.MedicalCodeType\r\n\tAND\r\n\tB.CurrentSnapshotFlag = 1\r\n\t\r\n\tGroup by\r\n\tB.EdwClaimPartyOccurrenceAkId,\r\n\tB.MedicalCode,\r\n\tB.MedicalCodeType\r\n\t\r\n\tHaving\r\n\tCount(*) > 1\r\n\t   )\r\n\t\r\n\tOrder by\r\n\tA.EdwClaimPartyOccurrenceAkId,\r\n\tA.EffectiveDate DESC\n),\nEXP_Lag_ExpirationDate AS (\n\tSELECT\n\tClaimantMedicalCodeDimId,\n\tEffectiveDate,\n\tExpirationDate AS Orig_ExpirationDate,\n\t-- *INF*: DECODE(TRUE,\r\n\t-- \tEdwClaimPartyOccurrenceAkId= v_PREV_ROW_EdwClaimPartyOccurrenceAkId, ADD_TO_DATE(v_PREV_ROW_EffectiveDate,'SS',-1),\r\n\t-- \tOrig_ExpirationDate)\n\tDECODE(TRUE,\n\tEdwClaimPartyOccurrenceAkId = v_PREV_ROW_EdwClaimPartyOccurrenceAkId, ADD_TO_DATE(v_PREV_ROW_EffectiveDate, 'SS', - 1),\n\tOrig_ExpirationDate) AS v_ExpirationDate,\n\tv_ExpirationDate AS ExpirationDate,\n\tEdwClaimPartyOccurrenceAkId,\n\tEdwClaimPartyOccurrenceAkId AS v_PREV_ROW_EdwClaimPartyOccurrenceAkId,\n\tEffectiveDate AS v_PREV_ROW_EffectiveDate,\n\t0 AS CurrentSnapshotFlag,\n\tsysdate AS ModifiedDate\n\tFROM SQ_ClaimantMedicalCodeDim\n),\nFIL_ExpirationDate AS (\n\tSELECT\n\tClaimantMedicalCodeDimId, \n\tExpirationDate, \n\tCurrentSnapshotFlag, \n\tModifiedDate, \n\tOrig_ExpirationDate\n\tFROM EXP_Lag_ExpirationDate\n\tWHERE ExpirationDate <> Orig_ExpirationDate\n),\nUPD_ExpirationDate AS (\n\tSELECT\n\tClaimantMedicalCodeDimId, \n\tExpirationDate, \n\tCurrentSnapshotFlag, \n\tModifiedDate\n\tFROM FIL_ExpirationDate\n),\nClaimantMedicalCodeDim_Expire AS (\n\tMERGE INTO ClaimantMedicalCodeDim AS T\n\tUSING UPD_ExpirationDate AS S\n\tON T.ClaimantMedicalCodeDimId = S.ClaimantMedicalCodeDimId\n\tWHEN MATCHED BY TARGET THEN\n\tUPDATE SET T.CurrentSnapshotFlag = S.CurrentSnapshotFlag, T.ExpirationDate = S.ExpirationDate, T.ModifiedDate = S.ModifiedDate\n),"
                        }
                    ]
                }
            }
        ],
        "parameters": {
            "WBMI_AUDIT_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "246514"
            },
            "WBMI_BATCH_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "905534"
            },
            "WBMI_SESSION_CONTROL_RUN_ID": {
                "type": "string",
                "defaultValue": "7604551"
            },
            "SELECTION_START_TS": {
                "type": "string",
                "defaultValue": "08/30/2023 03:42:21"
            },
            "SELECTION_END_TS": {
                "type": "string",
                "defaultValue": "08/31/2023 04:16:04"
            },
            "DBCONNECTION_SOURCE": {
                "type": "string",
                "defaultValue": "SQLServer_RPT_EDM_Claim"
            },
            "DBCONNECTION_TARGET": {
                "type": "string",
                "defaultValue": "SQLServer_WC_Data_Mart_Claim"
            },
            "SOURCE_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "TARGET_TABLE_OWNER": {
                "type": "string",
                "defaultValue": "DBO"
            },
            "SOURCE_SYSTEM_ID": {
                "type": "string",
                "defaultValue": "PMS and EXCEED"
            }
        },
        "folder": {
            "name": "Claims DataMart/"
        },
        "annotations": []
    }
}